Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5B07898721
	for <lists+amd-gfx@lfdr.de>; Thu, 22 Aug 2019 00:24:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 658216EA1E;
	Wed, 21 Aug 2019 22:24:25 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qk1-x734.google.com (mail-qk1-x734.google.com
 [IPv6:2607:f8b0:4864:20::734])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 37C596EA1D
 for <amd-gfx@lists.freedesktop.org>; Wed, 21 Aug 2019 22:24:23 +0000 (UTC)
Received: by mail-qk1-x734.google.com with SMTP id 125so3351112qkl.6
 for <amd-gfx@lists.freedesktop.org>; Wed, 21 Aug 2019 15:24:23 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=oMDxiQHBlTslmyBboo+0xwMIOGquYciluO6SOw1sExo=;
 b=uI5XAi2RMdufvmjKLvLAAbtxNq6QQfZT4y9sdViLOCZUs72hMruUkWFS6z3ngTmNP6
 3wXXdM80RbLCzRmyNpSSc/tdET1VHyrQ1MQP92sHOUpz1prEu5cxEYbd0qfUIGcex9S1
 bGMkeJE9M1rRGaIKaQQ9aySyn2p+R5YUaijDcv+vMx4dwKIV0Wri9yM01VlJdoQn/cXj
 s8kuWuknlOMBbluacLxeoLZCRLKuiDMcUQnRZauHP9UV9RzU2JXN2zJ8WUpr4Idev0Ix
 ePb27fKAkx6wnqjBSPzLZhjaUlnJ+5bd/aH29xKm0ogHf7Cq7gRJGnK1/voOcNtH3EBa
 w6/w==
X-Gm-Message-State: APjAAAUxKSjpS1tyU7KhukbgA/wBwWmCQy/5Z4rBkOB+Hm88fHAsI85J
 OE27GNRt4s2kbnL+eQgYvJ37V8XL
X-Google-Smtp-Source: APXvYqziNa56p5sdrZuPvPXVhZjbvwFUN++uQ6QgtHd24pVxFjE/kRn6qL8Y0DEg/3ga9IWG1hmYyg==
X-Received: by 2002:a37:6844:: with SMTP id d65mr33150193qkc.398.1566426262059; 
 Wed, 21 Aug 2019 15:24:22 -0700 (PDT)
Received: from localhost.localdomain ([71.219.73.178])
 by smtp.gmail.com with ESMTPSA id w1sm10853983qte.36.2019.08.21.15.24.21
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 21 Aug 2019 15:24:21 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 12/37] drm/amdgpu: add and enable gfxoff feature
Date: Wed, 21 Aug 2019 17:23:34 -0500
Message-Id: <20190821222359.13578-13-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190821222359.13578-1-alexander.deucher@amd.com>
References: <20190821222359.13578-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=oMDxiQHBlTslmyBboo+0xwMIOGquYciluO6SOw1sExo=;
 b=cDcncZWcbo4rXJanSyXGENmn4rlimFwj5+SrPKZKk4pkbmwL1tEYaH76Nba6JDlydP
 +RmmFEX22L/RtGXMOzbntJSco1khi3mjBzjiTcgqbJvj/6Hqx75iiKLAhHoO3OZTuHv4
 p91ORWHryFMLTtOYdshejR70ZZHLz35r2GQMChPiLq3CSpVl99fcxTGdIuiLXPINaQrW
 yk1UxGVOZM6RyBe5lUxKJ05oyJpy1+bWMoXEJ7itiKyn1SUNfrkOgawI3SMNc7DoWchm
 rsuGDhMveiCdHqvMNdouzJQAzt8pzoBB1xCOkPrAxuu/+j3pEQL+vAN3vNU28PkHgDfP
 oM5Q==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Kevin Wang <kevin1.wang@amd.com>,
 Huang Rui <ray.huang@amd.com>, Aaron Liu <aaron.liu@amd.com>,
 Evan Quan <evan.quan@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogQWFyb24gTGl1IDxhYXJvbi5saXVAYW1kLmNvbT4KClRoaXMgcGF0Y2ggdXBkYXRlcyBn
ZnhvZmYgZmVhdHVyZS4KClNpZ25lZC1vZmYtYnk6IEFhcm9uIExpdSA8YWFyb24ubGl1QGFtZC5j
b20+ClJldmlld2VkLWJ5OiBIdWFuZyBSdWkgPHJheS5odWFuZ0BhbWQuY29tPgpSZXZpZXdlZC1i
eTogRXZhbiBRdWFuIDxldmFuLnF1YW5AYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IEtldmluIFdhbmcg
PGtldmluMS53YW5nQGFtZC5jb20+ClNpZ25lZC1vZmYtYnk6IEFsZXggRGV1Y2hlciA8YWxleGFu
ZGVyLmRldWNoZXJAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zb2Mx
NS5jICAgICAgICAgfCAgNSArKysKIGRyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2FtZGdw
dV9zbXUuYyB8ICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTJfMC5j
ICB8IDQ0ICsrKysrKysrKysrKysrKysrKysrKysKIDMgZmlsZXMgY2hhbmdlZCwgNDkgaW5zZXJ0
aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L3NvYzE1LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zb2MxNS5jCmluZGV4
IGIyMjY4ODMwMzllNC4uYzA5MmJlNDVmNWUyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9zb2MxNS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NvYzE1
LmMKQEAgLTExNTcsNiArMTE1NywxMSBAQCBzdGF0aWMgaW50IHNvYzE1X2NvbW1vbl9lYXJseV9p
bml0KHZvaWQgKmhhbmRsZSkKIAkJYWRldi0+Y2dfZmxhZ3MgPSAwOwogCQlhZGV2LT5wZ19mbGFn
cyA9IDA7CiAJCWFkZXYtPmV4dGVybmFsX3Jldl9pZCA9IGFkZXYtPnJldl9pZCArIDB4OTE7CisK
KwkJaWYgKGFkZXYtPnBtLnBwX2ZlYXR1cmUgJiBQUF9HRlhPRkZfTUFTSykKKwkJCWFkZXYtPnBn
X2ZsYWdzIHw9IEFNRF9QR19TVVBQT1JUX0dGWF9QRyB8CisJCQkJQU1EX1BHX1NVUFBPUlRfQ1Ag
fAorCQkJCUFNRF9QR19TVVBQT1JUX1JMQ19TTVVfSFM7CiAJCWJyZWFrOwogCWRlZmF1bHQ6CiAJ
CS8qIEZJWE1FOiBub3Qgc3VwcG9ydGVkIHlldCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dl
cnBsYXkvYW1kZ3B1X3NtdS5jCmluZGV4IDg1ZjUyNDAxZDVhMS4uNjUwNTY5MGNmYTc2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9hbWRncHVfc211LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jCkBAIC03MzcsNyArNzM3
LDYgQEAgc3RhdGljIGludCBzbXVfc2V0X2Z1bmNzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KQogCQlzbXVfdjExXzBfc2V0X3NtdV9mdW5jcyhzbXUpOwogCQlicmVhazsKIAljYXNlIENISVBf
UkVOT0lSOgotCQlhZGV2LT5wbS5wcF9mZWF0dXJlICY9IH5QUF9HRlhPRkZfTUFTSzsKIAkJaWYg
KGFkZXYtPnBtLnBwX2ZlYXR1cmUgJiBQUF9PVkVSRFJJVkVfTUFTSykKIAkJCXNtdS0+b2RfZW5h
YmxlZCA9IHRydWU7CiAJCXNtdV92MTJfMF9zZXRfc211X2Z1bmNzKHNtdSk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjEyXzAuYyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTJfMC5jCmluZGV4IGNmNTIzYjhiMmFlYi4uN2Q0ZTk2
NmNjOWYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjEy
XzAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjEyXzAuYwpAQCAt
MzYsNiArMzYsMTMgQEAKIAogI2RlZmluZSBzbW5NUDFfRklSTVdBUkVfRkxBR1MgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIDB4MzAxMDAyNAogCisjZGVmaW5lIG1tUFdSX01JU0NfQ05U
TF9TVEFUVVMJCQkJCTB4MDE4MworI2RlZmluZSBtbVBXUl9NSVNDX0NOVExfU1RBVFVTX0JBU0Vf
SURYCQkJCTAKKyNkZWZpbmUgUFdSX01JU0NfQ05UTF9TVEFUVVNfX1BXUl9HRlhfUkxDX0NHUEdf
RU5fX1NISUZUCTB4MAorI2RlZmluZSBQV1JfTUlTQ19DTlRMX1NUQVRVU19fUFdSX0dGWE9GRl9T
VEFUVVNfX1NISUZUCQkweDEKKyNkZWZpbmUgUFdSX01JU0NfQ05UTF9TVEFUVVNfX1BXUl9HRlhf
UkxDX0NHUEdfRU5fTUFTSwkJMHgwMDAwMDAwMUwKKyNkZWZpbmUgUFdSX01JU0NfQ05UTF9TVEFU
VVNfX1BXUl9HRlhPRkZfU1RBVFVTX01BU0sJCTB4MDAwMDAwMDZMCisKIHN0YXRpYyBpbnQgc211
X3YxMl8wX3NlbmRfbXNnX3dpdGhvdXRfd2FpdGluZyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwK
IAkJCQkJICAgICAgdWludDE2X3QgbXNnKQogewpAQCAtMjA3LDYgKzIxNCw0MiBAQCBzdGF0aWMg
aW50IHNtdV92MTJfMF9zZXRfZ2Z4X2NncGcoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGJvb2wg
ZW5hYmxlKQogCQlTTVVfTVNHX1NldEdmeENHUEcsIGVuYWJsZSA/IDEgOiAwKTsKIH0KIAorc3Rh
dGljIGJvb2wgc211X3YxMl8wX2lzX2dmeF9vbihzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKK3sK
Kwl1aW50MzJfdCByZWc7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBzbXUtPmFkZXY7
CisKKwlyZWcgPSBSUkVHMzJfU09DMTUoUFdSLCAwLCBtbVBXUl9NSVNDX0NOVExfU1RBVFVTKTsK
KwlpZiAoKHJlZyAmIFBXUl9NSVNDX0NOVExfU1RBVFVTX19QV1JfR0ZYT0ZGX1NUQVRVU19NQVNL
KSA9PQorCSAgICAoMHgyIDw8IFBXUl9NSVNDX0NOVExfU1RBVFVTX19QV1JfR0ZYT0ZGX1NUQVRV
U19fU0hJRlQpKQorCQlyZXR1cm4gdHJ1ZTsKKworCXJldHVybiBmYWxzZTsKK30KKworc3RhdGlj
IGludCBzbXVfdjEyXzBfZ2Z4X29mZl9jb250cm9sKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBi
b29sIGVuYWJsZSkKK3sKKwlpbnQgcmV0ID0gMCwgdGltZW91dCA9IDEwOworCisJaWYgKGVuYWJs
ZSkgeworCQlyZXQgPSBzbXVfc2VuZF9zbWNfbXNnKHNtdSwgU01VX01TR19BbGxvd0dmeE9mZik7
CisJfSBlbHNlIHsKKwkJcmV0ID0gc211X3NlbmRfc21jX21zZyhzbXUsIFNNVV9NU0dfRGlzYWxs
b3dHZnhPZmYpOworCisJCS8qIGNvbmZpcm0gZ2Z4IGlzIGJhY2sgdG8gIm9uIiBzdGF0ZSAqLwor
CQl3aGlsZSAoIXNtdV92MTJfMF9pc19nZnhfb24oc211KSkgeworCQkJbXNsZWVwKDEpOworCQkJ
dGltZW91dC0tOworCQkJaWYgKHRpbWVvdXQgPT0gMCkgeworCQkJCURSTV9FUlJPUigiZGlzYWJs
ZSBnZnhvZmYgdGltZW91dCBhbmQgZmFpbGVkIVxuIik7CisJCQkJYnJlYWs7CisJCQl9CisJCX0K
Kwl9CisKKwlyZXR1cm4gcmV0OworfQorCiBzdGF0aWMgY29uc3Qgc3RydWN0IHNtdV9mdW5jcyBz
bXVfdjEyXzBfZnVuY3MgPSB7CiAJLmNoZWNrX2Z3X3N0YXR1cyA9IHNtdV92MTJfMF9jaGVja19m
d19zdGF0dXMsCiAJLmNoZWNrX2Z3X3ZlcnNpb24gPSBzbXVfdjEyXzBfY2hlY2tfZndfdmVyc2lv
biwKQEAgLTIxNiw2ICsyNTksNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHNtdV9mdW5jcyBzbXVf
djEyXzBfZnVuY3MgPSB7CiAJLnNlbmRfc21jX21zZ193aXRoX3BhcmFtID0gc211X3YxMl8wX3Nl
bmRfbXNnX3dpdGhfcGFyYW0sCiAJLnJlYWRfc21jX2FyZyA9IHNtdV92MTJfMF9yZWFkX2FyZywK
IAkuc2V0X2dmeF9jZ3BnID0gc211X3YxMl8wX3NldF9nZnhfY2dwZywKKwkuZ2Z4X29mZl9jb250
cm9sID0gc211X3YxMl8wX2dmeF9vZmZfY29udHJvbCwKIH07CiAKIHZvaWQgc211X3YxMl8wX3Nl
dF9zbXVfZnVuY3Moc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCi0tIAoyLjIwLjEKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBs
aXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
