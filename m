Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0C4D669D99
	for <lists+amd-gfx@lfdr.de>; Mon, 15 Jul 2019 23:21:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 75CDF89B99;
	Mon, 15 Jul 2019 21:21:17 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM03-CO1-obe.outbound.protection.outlook.com
 (mail-co1nam03on0611.outbound.protection.outlook.com
 [IPv6:2a01:111:f400:fe48::611])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C718489BAF
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 21:21:16 +0000 (UTC)
Received: from MWHPR12CA0041.namprd12.prod.outlook.com (2603:10b6:301:2::27)
 by CH2PR12MB3927.namprd12.prod.outlook.com (2603:10b6:610:2d::13) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2052.19; Mon, 15 Jul
 2019 21:21:14 +0000
Received: from CO1NAM03FT009.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e48::209) by MWHPR12CA0041.outlook.office365.com
 (2603:10b6:301:2::27) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id 15.20.2073.14 via Frontend
 Transport; Mon, 15 Jul 2019 21:21:13 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV01.amd.com (165.204.84.17) by
 CO1NAM03FT009.mail.protection.outlook.com (10.152.80.67) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2052.18 via Frontend Transport; Mon, 15 Jul 2019 21:21:13 +0000
Received: from localhost.localdomain (10.180.168.240) by SATLEXCHOV01.amd.com
 (10.181.40.71) with Microsoft SMTP Server id 14.3.389.1;
 Mon, 15 Jul 2019 16:21:05 -0500
From: <sunpeng.li@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 07/87] drm/amd/display: move bw calc code into helpers
Date: Mon, 15 Jul 2019 17:19:29 -0400
Message-ID: <20190715212049.4584-8-sunpeng.li@amd.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190715212049.4584-1-sunpeng.li@amd.com>
References: <20190715212049.4584-1-sunpeng.li@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(39860400002)(396003)(376002)(136003)(346002)(2980300002)(428003)(189003)(199004)(54906003)(2870700001)(316002)(68736007)(1076003)(6666004)(356004)(86362001)(4326008)(49486002)(48376002)(478600001)(5660300002)(30864003)(36756003)(50466002)(26005)(6916009)(70586007)(51416003)(14444005)(186003)(2616005)(126002)(8936002)(486006)(81166006)(11346002)(81156014)(2906002)(426003)(8676002)(76176011)(446003)(476003)(50226002)(336012)(2351001)(47776003)(2876002)(305945005)(53936002)(70206006);
 DIR:OUT; SFP:1101; SCL:1; SRVR:CH2PR12MB3927; H:SATLEXCHOV01.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: c1b03381-bec9-449a-e078-08d7096a5dac
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(2017052603328);
 SRVR:CH2PR12MB3927; 
X-MS-TrafficTypeDiagnostic: CH2PR12MB3927:
X-Microsoft-Antispam-PRVS: <CH2PR12MB3927A924861E4E36A3A9FEB982CF0@CH2PR12MB3927.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:257;
X-Forefront-PRVS: 00997889E7
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: KGOSzgL4y6dF8puawYEGfTJfGqxGphGB9sgyQDoaFVaHTfrgbLW0auGcaHz65fru1MNi8KCPQ6RfOJ5+CqkQwuGvel08ZHQ0t1/fGh+mpvtteWKOcybmUwRSs/Ihf49CY96p/Sl2eUmxaIq0I0xAcqLKQgojgNZQyvgOHHcUjVgnMfScVBbGeBnPgBxd19idbMDTBgVzFMnxIqxc04CBfUHeGwk7TOuA9nKvqpTHoZW9HTWE9S11wVoIZY/2HgsOvf9/U0ene0goA3TebkKBHdJ8XmxiivZ10vPShByF1yxH++lfnyus5nB1onOZZMzskUgIJAcUClRbQ/ET+IcVtTHSfK3iYYx2T0SCKX67OFWszNbe6zhNPJEMuWuQbcZtnTh3EQex4jQhEgMIjFrE5qKZaVkbVhbXV1XjiPx/5HU=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 15 Jul 2019 21:21:13.7135 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: c1b03381-bec9-449a-e078-08d7096a5dac
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV01.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: CH2PR12MB3927
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=eiolikERCpTwZt4fmY9lyjYV/kBiCXydiBHpwXlF9Ic=;
 b=l+xQ2/ZCrstNdcM/zxkhz8N5Rc23qHJk8ry71cDrHeWRvWDZO+Y/c9BVHsk0B8MlruW2vW0icAeaNz2EeSoEIeCeudE74/s/VHAoeeGSQvU7OB393rx9miTr9ahEKd1hBssMOxyB1vNliIEie0tM0G9hpLMSi/2q7Js+zaQyTVU=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Leo Li <sunpeng.li@amd.com>, Fatemeh Darbehani <Fatemeh.Darbehani@amd.com>,
 Eric Yang <Eric.Yang2@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogRXJpYyBZYW5nIDxFcmljLllhbmcyQGFtZC5jb20+CgpbV2h5XQpGb3IgYmV0dGVyIHJl
YWRhYmlsaXR5IGFuZCByZXVzYWJpbGl0eQoKW0hvd10KTW92ZSBzbmlwcGV0cyBvZiBCVyBjYWxj
dWxhdGlvbiBjb2RlIGludG8gaGVscGVycy4KClNpZ25lZC1vZmYtYnk6IEVyaWMgWWFuZyA8RXJp
Yy5ZYW5nMkBhbWQuY29tPgpSZXZpZXdlZC1ieTogRmF0ZW1laCBEYXJiZWhhbmkgPEZhdGVtZWgu
RGFyYmVoYW5pQGFtZC5jb20+CkFja2VkLWJ5OiBMZW8gTGkgPHN1bnBlbmcubGlAYW1kLmNvbT4K
LS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMgICAgfCAgIDEg
KwogLi4uL2Rpc3BsYXkvZGMvY2xrX21nci9kY24yMC9kY24yMF9jbGtfbWdyLmMgIHwgICAyIC0K
IC4uLi9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2UuYyB8IDI1MCArKysr
KysrKysrKy0tLS0tLS0KIC4uLi9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfcmVzb3Vy
Y2UuaCB8ICAxMSArCiAuLi4vYW1kL2Rpc3BsYXkvZGMvaW5jL2h3L2Nsa19tZ3JfaW50ZXJuYWwu
aCAgfCAgIDIgKwogNSBmaWxlcyBjaGFuZ2VkLCAxNjcgaW5zZXJ0aW9ucygrKSwgOTkgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rl
dmljZS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCmluZGV4
IDA4NmQyZjNiMGRiMy4uZTljY2Y0MWUzMWVlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2RldmljZS5jCkBAIC0xMjYsNiArMTI2LDcgQEAgc3RhdGljIERFVklDRV9BVFRS
KHBjaWVfcmVwbGF5X2NvdW50LCBTX0lSVUdPLAogCQlhbWRncHVfZGV2aWNlX2dldF9wY2llX3Jl
cGxheV9jb3VudCwgTlVMTCk7CiAKIHN0YXRpYyB2b2lkIGFtZGdwdV9kZXZpY2VfZ2V0X3BjaWVf
aW5mbyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7CitzdGF0aWMgdm9pZCBhbWRncHVfZGV2
aWNlX3BhcnNlX2Zha2VkX2RpZChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7CiAKIC8qKgog
ICogYW1kZ3B1X2RldmljZV9pc19weCAtIElzIHRoZSBkZXZpY2UgaXMgYSBkR1BVIHdpdGggSEcv
UFggcG93ZXIgY29udHJvbApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5
L2RjL2Nsa19tZ3IvZGNuMjAvZGNuMjBfY2xrX21nci5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9k
aXNwbGF5L2RjL2Nsa19tZ3IvZGNuMjAvZGNuMjBfY2xrX21nci5jCmluZGV4IDc0MGY1ZGIyMmJi
NS4uNjE0YTk0MWViOWYyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkv
ZGMvY2xrX21nci9kY24yMC9kY24yMF9jbGtfbWdyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9kaXNwbGF5L2RjL2Nsa19tZ3IvZGNuMjAvZGNuMjBfY2xrX21nci5jCkBAIC0yNiw4ICsyNiw2
IEBACiAjaW5jbHVkZSAiZGNjZy5oIgogI2luY2x1ZGUgImNsa19tZ3JfaW50ZXJuYWwuaCIKIAot
Ci0jaW5jbHVkZSAiZGNuMjAvZGNuMjBfY2xrX21nci5oIgogI2luY2x1ZGUgImRjZTEwMC9kY2Vf
Y2xrX21nci5oIgogI2luY2x1ZGUgInJlZ19oZWxwZXIuaCIKICNpbmNsdWRlICJjb3JlX3R5cGVz
LmgiCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNu
MjBfcmVzb3VyY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24y
MF9yZXNvdXJjZS5jCmluZGV4IDIwY2Y5OGYwOTBiMC4uODQyZjQ4NDAzMjI2IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2UuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2Uu
YwpAQCAtMjAxNiwxNSArMjAxNiwxNiBAQCBzdGF0aWMgYm9vbCBkY24yMF92YWxpZGF0ZV9kc2Mo
c3RydWN0IGRjICpkYywgc3RydWN0IGRjX3N0YXRlICpuZXdfY3R4KQogfQogI2VuZGlmCiAKLWJv
b2wgZGNuMjBfdmFsaWRhdGVfYmFuZHdpZHRoKHN0cnVjdCBkYyAqZGMsIHN0cnVjdCBkY19zdGF0
ZSAqY29udGV4dCwKLQkJYm9vbCBmYXN0X3ZhbGlkYXRlKQorYm9vbCBkY24yMF9mYXN0X3ZhbGlk
YXRlX2J3KAorCQlzdHJ1Y3QgZGMgKmRjLAorCQlzdHJ1Y3QgZGNfc3RhdGUgKmNvbnRleHQsCisJ
CWRpc3BsYXlfZTJlX3BpcGVfcGFyYW1zX3N0ICpwaXBlcywKKwkJaW50ICpwaXBlX3NwbGl0X2Zy
b20sCisJCWludCAqdmxldmVsX291dCkKIHsKIAlib29sIG91dCA9IGZhbHNlOwogCi0JQldfVkFM
X1RSQUNFX1NFVFVQKCk7Ci0KIAlpbnQgcGlwZV9jbnQsIGksIHBpcGVfaWR4LCB2bGV2ZWwsIHZs
ZXZlbF91bnNwbGl0OwotCWludCBwaXBlX3NwbGl0X2Zyb21bTUFYX1BJUEVTXTsKIAlib29sIG9k
bV9jYXBhYmxlID0gY29udGV4dC0+YndfY3R4LmRtbC5pcC5vZG1fY2FwYWJsZTsKIAlib29sIGZv
cmNlX3NwbGl0ID0gZmFsc2U7CiAjaWZkZWYgQ09ORklHX0RSTV9BTURfRENfRFNDX1NVUFBPUlQK
QEAgLTIwMzIsMTAgKzIwMzMsNyBAQCBib29sIGRjbjIwX3ZhbGlkYXRlX2JhbmR3aWR0aChzdHJ1
Y3QgZGMgKmRjLCBzdHJ1Y3QgZGNfc3RhdGUgKmNvbnRleHQsCiAjZW5kaWYKIAlpbnQgc3BsaXRf
dGhyZXNob2xkID0gZGMtPnJlc19wb29sLT5waXBlX2NvdW50IC8gMjsKIAlib29sIGF2b2lkX3Nw
bGl0ID0gZGMtPmRlYnVnLnBpcGVfc3BsaXRfcG9saWN5ICE9IE1QQ19TUExJVF9EWU5BTUlDOwot
CWRpc3BsYXlfZTJlX3BpcGVfcGFyYW1zX3N0ICpwaXBlcyA9IGt6YWxsb2MoZGMtPnJlc19wb29s
LT5waXBlX2NvdW50ICogc2l6ZW9mKGRpc3BsYXlfZTJlX3BpcGVfcGFyYW1zX3N0KSwgR0ZQX0tF
Uk5FTCk7Ci0JRENfTE9HR0VSX0lOSVQoZGMtPmN0eC0+bG9nZ2VyKTsKIAotCUJXX1ZBTF9UUkFD
RV9DT1VOVCgpOwogCiAJQVNTRVJUKHBpcGVzKTsKIAlpZiAoIXBpcGVzKQpAQCAtMjA3NSw3ICsy
MDczLDYgQEAgYm9vbCBkY24yMF92YWxpZGF0ZV9iYW5kd2lkdGgoc3RydWN0IGRjICpkYywgc3Ry
dWN0IGRjX3N0YXRlICpjb250ZXh0LAogCQkJJmNvbnRleHQtPnJlc19jdHgsIHBpcGVzKTsKIAog
CWlmICghcGlwZV9jbnQpIHsKLQkJQldfVkFMX1RSQUNFX1NLSVAocGFzcyk7CiAJCW91dCA9IHRy
dWU7CiAJCWdvdG8gdmFsaWRhdGVfb3V0OwogCX0KQEAgLTIyNDAsMTAxICsyMjM3LDEyOCBAQCBi
b29sIGRjbjIwX3ZhbGlkYXRlX2JhbmR3aWR0aChzdHJ1Y3QgZGMgKmRjLCBzdHJ1Y3QgZGNfc3Rh
dGUgKmNvbnRleHQsCiAJfQogI2VuZGlmCiAKLQlCV19WQUxfVFJBQ0VfRU5EX1ZPTFRBR0VfTEVW
RUwoKTsKKwkqdmxldmVsX291dCA9IHZsZXZlbDsKIAotCWlmIChmYXN0X3ZhbGlkYXRlKSB7Ci0J
CUJXX1ZBTF9UUkFDRV9TS0lQKGZhc3QpOwotCQlvdXQgPSB0cnVlOwotCQlnb3RvIHZhbGlkYXRl
X291dDsKLQl9CisJb3V0ID0gdHJ1ZTsKKwlnb3RvIHZhbGlkYXRlX291dDsKKwordmFsaWRhdGVf
ZmFpbDoKKwlvdXQgPSBmYWxzZTsKKwordmFsaWRhdGVfb3V0OgorCXJldHVybiBvdXQ7Cit9CisK
K3ZvaWQgZGNuMjBfY2FsY3VsYXRlX3dtKAorCQlzdHJ1Y3QgZGMgKmRjLCBzdHJ1Y3QgZGNfc3Rh
dGUgKmNvbnRleHQsCisJCWRpc3BsYXlfZTJlX3BpcGVfcGFyYW1zX3N0ICpwaXBlcywKKwkJaW50
ICpvdXRfcGlwZV9jbnQsCisJCWludCAqcGlwZV9zcGxpdF9mcm9tLAorCQlpbnQgdmxldmVsKQor
eworCWludCBwaXBlX2NudCwgaSwgcGlwZV9pZHg7CiAKIAlmb3IgKGkgPSAwLCBwaXBlX2lkeCA9
IDAsIHBpcGVfY250ID0gMDsgaSA8IGRjLT5yZXNfcG9vbC0+cGlwZV9jb3VudDsgaSsrKSB7Ci0J
CWlmICghY29udGV4dC0+cmVzX2N0eC5waXBlX2N0eFtpXS5zdHJlYW0pCi0JCQljb250aW51ZTsK
KwkJCWlmICghY29udGV4dC0+cmVzX2N0eC5waXBlX2N0eFtpXS5zdHJlYW0pCisJCQkJY29udGlu
dWU7CiAKLQkJcGlwZXNbcGlwZV9jbnRdLmNsa3NfY2ZnLnJlZmNsa19taHogPSBkYy0+cmVzX3Bv
b2wtPnJlZl9jbG9ja3MuZGNodWJfcmVmX2Nsb2NrX2luS2h6IC8gMTAwMC4wOwotCQlwaXBlc1tw
aXBlX2NudF0uY2xrc19jZmcuZGlzcGNsa19taHogPSBjb250ZXh0LT5id19jdHguZG1sLnZiYS5S
ZXF1aXJlZERJU1BDTEtbdmxldmVsXVtjb250ZXh0LT5id19jdHguZG1sLnZiYS5tYXhNcGNDb21i
XTsKKwkJCXBpcGVzW3BpcGVfY250XS5jbGtzX2NmZy5yZWZjbGtfbWh6ID0gZGMtPnJlc19wb29s
LT5yZWZfY2xvY2tzLmRjaHViX3JlZl9jbG9ja19pbktoeiAvIDEwMDAuMDsKKwkJCXBpcGVzW3Bp
cGVfY250XS5jbGtzX2NmZy5kaXNwY2xrX21oeiA9IGNvbnRleHQtPmJ3X2N0eC5kbWwudmJhLlJl
cXVpcmVkRElTUENMS1t2bGV2ZWxdW2NvbnRleHQtPmJ3X2N0eC5kbWwudmJhLm1heE1wY0NvbWJd
OwogCi0JCWlmIChwaXBlX3NwbGl0X2Zyb21baV0gPCAwKSB7Ci0JCQlwaXBlc1twaXBlX2NudF0u
Y2xrc19jZmcuZHBwY2xrX21oeiA9Ci0JCQkJCWNvbnRleHQtPmJ3X2N0eC5kbWwudmJhLlJlcXVp
cmVkRFBQQ0xLW3ZsZXZlbF1bY29udGV4dC0+YndfY3R4LmRtbC52YmEubWF4TXBjQ29tYl1bcGlw
ZV9pZHhdOwotCQkJaWYgKGNvbnRleHQtPmJ3X2N0eC5kbWwudmJhLkJsZW5kaW5nQW5kVGltaW5n
W3BpcGVfaWR4XSA9PSBwaXBlX2lkeCkKLQkJCQlwaXBlc1twaXBlX2NudF0ucGlwZS5kZXN0Lm9k
bV9jb21iaW5lID0KLQkJCQkJCWNvbnRleHQtPmJ3X2N0eC5kbWwudmJhLk9ETUNvbWJpbmVFbmFi
bGVQZXJTdGF0ZVt2bGV2ZWxdW3BpcGVfaWR4XTsKLQkJCWVsc2UKLQkJCQlwaXBlc1twaXBlX2Nu
dF0ucGlwZS5kZXN0Lm9kbV9jb21iaW5lID0gMDsKLQkJCXBpcGVfaWR4Kys7Ci0JCX0gZWxzZSB7
Ci0JCQlwaXBlc1twaXBlX2NudF0uY2xrc19jZmcuZHBwY2xrX21oeiA9Ci0JCQkJCWNvbnRleHQt
PmJ3X2N0eC5kbWwudmJhLlJlcXVpcmVkRFBQQ0xLW3ZsZXZlbF1bY29udGV4dC0+YndfY3R4LmRt
bC52YmEubWF4TXBjQ29tYl1bcGlwZV9zcGxpdF9mcm9tW2ldXTsKLQkJCWlmIChjb250ZXh0LT5i
d19jdHguZG1sLnZiYS5CbGVuZGluZ0FuZFRpbWluZ1twaXBlX3NwbGl0X2Zyb21baV1dID09IHBp
cGVfc3BsaXRfZnJvbVtpXSkKLQkJCQlwaXBlc1twaXBlX2NudF0ucGlwZS5kZXN0Lm9kbV9jb21i
aW5lID0KLQkJCQkJCWNvbnRleHQtPmJ3X2N0eC5kbWwudmJhLk9ETUNvbWJpbmVFbmFibGVQZXJT
dGF0ZVt2bGV2ZWxdW3BpcGVfc3BsaXRfZnJvbVtpXV07CisJCQlpZiAocGlwZV9zcGxpdF9mcm9t
W2ldIDwgMCkgeworCQkJCXBpcGVzW3BpcGVfY250XS5jbGtzX2NmZy5kcHBjbGtfbWh6ID0KKwkJ
CQkJCWNvbnRleHQtPmJ3X2N0eC5kbWwudmJhLlJlcXVpcmVkRFBQQ0xLW3ZsZXZlbF1bY29udGV4
dC0+YndfY3R4LmRtbC52YmEubWF4TXBjQ29tYl1bcGlwZV9pZHhdOworCQkJCWlmIChjb250ZXh0
LT5id19jdHguZG1sLnZiYS5CbGVuZGluZ0FuZFRpbWluZ1twaXBlX2lkeF0gPT0gcGlwZV9pZHgp
CisJCQkJCXBpcGVzW3BpcGVfY250XS5waXBlLmRlc3Qub2RtX2NvbWJpbmUgPQorCQkJCQkJCWNv
bnRleHQtPmJ3X2N0eC5kbWwudmJhLk9ETUNvbWJpbmVFbmFibGVQZXJTdGF0ZVt2bGV2ZWxdW3Bp
cGVfaWR4XTsKKwkJCQllbHNlCisJCQkJCXBpcGVzW3BpcGVfY250XS5waXBlLmRlc3Qub2RtX2Nv
bWJpbmUgPSAwOworCQkJCXBpcGVfaWR4Kys7CisJCQl9IGVsc2UgeworCQkJCXBpcGVzW3BpcGVf
Y250XS5jbGtzX2NmZy5kcHBjbGtfbWh6ID0KKwkJCQkJCWNvbnRleHQtPmJ3X2N0eC5kbWwudmJh
LlJlcXVpcmVkRFBQQ0xLW3ZsZXZlbF1bY29udGV4dC0+YndfY3R4LmRtbC52YmEubWF4TXBjQ29t
Yl1bcGlwZV9zcGxpdF9mcm9tW2ldXTsKKwkJCQlpZiAoY29udGV4dC0+YndfY3R4LmRtbC52YmEu
QmxlbmRpbmdBbmRUaW1pbmdbcGlwZV9zcGxpdF9mcm9tW2ldXSA9PSBwaXBlX3NwbGl0X2Zyb21b
aV0pCisJCQkJCXBpcGVzW3BpcGVfY250XS5waXBlLmRlc3Qub2RtX2NvbWJpbmUgPQorCQkJCQkJ
CWNvbnRleHQtPmJ3X2N0eC5kbWwudmJhLk9ETUNvbWJpbmVFbmFibGVQZXJTdGF0ZVt2bGV2ZWxd
W3BpcGVfc3BsaXRfZnJvbVtpXV07CisJCQkJZWxzZQorCQkJCQlwaXBlc1twaXBlX2NudF0ucGlw
ZS5kZXN0Lm9kbV9jb21iaW5lID0gMDsKKwkJCX0KKworCQkJaWYgKGRjLT5jb25maWcuZm9yY2Vk
X2Nsb2NrcykgeworCQkJCXBpcGVzW3BpcGVfY250XS5jbGtzX2NmZy5kaXNwY2xrX21oeiA9IGNv
bnRleHQtPmJ3X2N0eC5kbWwuc29jLmNsb2NrX2xpbWl0c1swXS5kaXNwY2xrX21oejsKKwkJCQlw
aXBlc1twaXBlX2NudF0uY2xrc19jZmcuZHBwY2xrX21oeiA9IGNvbnRleHQtPmJ3X2N0eC5kbWwu
c29jLmNsb2NrX2xpbWl0c1swXS5kcHBjbGtfbWh6OworCQkJfQorCisJCQlwaXBlX2NudCsrOwor
CQl9CisKKwkJaWYgKHBpcGVfY250ICE9IHBpcGVfaWR4KSB7CisJCQlpZiAoZGMtPnJlc19wb29s
LT5mdW5jcy0+cG9wdWxhdGVfZG1sX3BpcGVzKQorCQkJCXBpcGVfY250ID0gZGMtPnJlc19wb29s
LT5mdW5jcy0+cG9wdWxhdGVfZG1sX3BpcGVzKGRjLAorCQkJCQkmY29udGV4dC0+cmVzX2N0eCwg
cGlwZXMpOwogCQkJZWxzZQotCQkJCXBpcGVzW3BpcGVfY250XS5waXBlLmRlc3Qub2RtX2NvbWJp
bmUgPSAwOworCQkJCXBpcGVfY250ID0gZGNuMjBfcG9wdWxhdGVfZG1sX3BpcGVzX2Zyb21fY29u
dGV4dChkYywKKwkJCQkJJmNvbnRleHQtPnJlc19jdHgsIHBpcGVzKTsKIAkJfQotCQlpZiAoZGMt
PmNvbmZpZy5mb3JjZWRfY2xvY2tzKSB7Ci0JCQlwaXBlc1twaXBlX2NudF0uY2xrc19jZmcuZGlz
cGNsa19taHogPSBjb250ZXh0LT5id19jdHguZG1sLnNvYy5jbG9ja19saW1pdHNbMF0uZGlzcGNs
a19taHo7Ci0JCQlwaXBlc1twaXBlX2NudF0uY2xrc19jZmcuZHBwY2xrX21oeiA9IGNvbnRleHQt
PmJ3X2N0eC5kbWwuc29jLmNsb2NrX2xpbWl0c1swXS5kcHBjbGtfbWh6OworCisJCSpvdXRfcGlw
ZV9jbnQgPSBwaXBlX2NudDsKKworCQlwaXBlc1swXS5jbGtzX2NmZy52b2x0YWdlID0gdmxldmVs
OworCQlwaXBlc1swXS5jbGtzX2NmZy5kY2ZjbGtfbWh6ID0gY29udGV4dC0+YndfY3R4LmRtbC5z
b2MuY2xvY2tfbGltaXRzW3ZsZXZlbF0uZGNmY2xrX21oejsKKwkJcGlwZXNbMF0uY2xrc19jZmcu
c29jY2xrX21oeiA9IGNvbnRleHQtPmJ3X2N0eC5kbWwuc29jLmNsb2NrX2xpbWl0c1t2bGV2ZWxd
LnNvY2Nsa19taHo7CisKKwkJLyogb25seSBwaXBlIDAgaXMgcmVhZCBmb3Igdm9sdGFnZSBhbmQg
ZGNmL3NvYyBjbG9ja3MgKi8KKwkJaWYgKHZsZXZlbCA8IDEpIHsKKwkJCXBpcGVzWzBdLmNsa3Nf
Y2ZnLnZvbHRhZ2UgPSAxOworCQkJcGlwZXNbMF0uY2xrc19jZmcuZGNmY2xrX21oeiA9IGNvbnRl
eHQtPmJ3X2N0eC5kbWwuc29jLmNsb2NrX2xpbWl0c1sxXS5kY2ZjbGtfbWh6OworCQkJcGlwZXNb
MF0uY2xrc19jZmcuc29jY2xrX21oeiA9IGNvbnRleHQtPmJ3X2N0eC5kbWwuc29jLmNsb2NrX2xp
bWl0c1sxXS5zb2NjbGtfbWh6OwogCQl9Ci0JCXBpcGVfY250Kys7Ci0JfQorCQljb250ZXh0LT5i
d19jdHguYncuZGNuLndhdGVybWFya3MuYi51cmdlbnRfbnMgPSBnZXRfd21fdXJnZW50KCZjb250
ZXh0LT5id19jdHguZG1sLCBwaXBlcywgcGlwZV9jbnQpICogMTAwMDsKKwkJY29udGV4dC0+Yndf
Y3R4LmJ3LmRjbi53YXRlcm1hcmtzLmIuY3N0YXRlX3BzdGF0ZS5jc3RhdGVfZW50ZXJfcGx1c19l
eGl0X25zID0gZ2V0X3dtX3N0dXR0ZXJfZW50ZXJfZXhpdCgmY29udGV4dC0+YndfY3R4LmRtbCwg
cGlwZXMsIHBpcGVfY250KSAqIDEwMDA7CisJCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJt
YXJrcy5iLmNzdGF0ZV9wc3RhdGUuY3N0YXRlX2V4aXRfbnMgPSBnZXRfd21fc3R1dHRlcl9leGl0
KCZjb250ZXh0LT5id19jdHguZG1sLCBwaXBlcywgcGlwZV9jbnQpICogMTAwMDsKKwkJY29udGV4
dC0+YndfY3R4LmJ3LmRjbi53YXRlcm1hcmtzLmIuY3N0YXRlX3BzdGF0ZS5wc3RhdGVfY2hhbmdl
X25zID0gZ2V0X3dtX2RyYW1fY2xvY2tfY2hhbmdlKCZjb250ZXh0LT5id19jdHguZG1sLCBwaXBl
cywgcGlwZV9jbnQpICogMTAwMDsKKwkJY29udGV4dC0+YndfY3R4LmJ3LmRjbi53YXRlcm1hcmtz
LmIucHRlX21ldGFfdXJnZW50X25zID0gZ2V0X3dtX21lbW9yeV90cmlwKCZjb250ZXh0LT5id19j
dHguZG1sLCBwaXBlcywgcGlwZV9jbnQpICogMTAwMDsKKworCQlpZiAodmxldmVsIDwgMikgewor
CQkJcGlwZXNbMF0uY2xrc19jZmcudm9sdGFnZSA9IDI7CisJCQlwaXBlc1swXS5jbGtzX2NmZy5k
Y2ZjbGtfbWh6ID0gY29udGV4dC0+YndfY3R4LmRtbC5zb2MuY2xvY2tfbGltaXRzWzJdLmRjZmNs
a19taHo7CisJCQlwaXBlc1swXS5jbGtzX2NmZy5zb2NjbGtfbWh6ID0gY29udGV4dC0+YndfY3R4
LmRtbC5zb2MuY2xvY2tfbGltaXRzWzJdLnNvY2Nsa19taHo7CisJCX0KKwkJY29udGV4dC0+Yndf
Y3R4LmJ3LmRjbi53YXRlcm1hcmtzLmMudXJnZW50X25zID0gZ2V0X3dtX3VyZ2VudCgmY29udGV4
dC0+YndfY3R4LmRtbCwgcGlwZXMsIHBpcGVfY250KSAqIDEwMDA7CisJCWNvbnRleHQtPmJ3X2N0
eC5idy5kY24ud2F0ZXJtYXJrcy5jLmNzdGF0ZV9wc3RhdGUuY3N0YXRlX2VudGVyX3BsdXNfZXhp
dF9ucyA9IGdldF93bV9zdHV0dGVyX2VudGVyX2V4aXQoJmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBp
cGVzLCBwaXBlX2NudCkgKiAxMDAwOworCQljb250ZXh0LT5id19jdHguYncuZGNuLndhdGVybWFy
a3MuYy5jc3RhdGVfcHN0YXRlLmNzdGF0ZV9leGl0X25zID0gZ2V0X3dtX3N0dXR0ZXJfZXhpdCgm
Y29udGV4dC0+YndfY3R4LmRtbCwgcGlwZXMsIHBpcGVfY250KSAqIDEwMDA7CisJCWNvbnRleHQt
PmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5jLmNzdGF0ZV9wc3RhdGUucHN0YXRlX2NoYW5nZV9u
cyA9IGdldF93bV9kcmFtX2Nsb2NrX2NoYW5nZSgmY29udGV4dC0+YndfY3R4LmRtbCwgcGlwZXMs
IHBpcGVfY250KSAqIDEwMDA7CisJCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5j
LnB0ZV9tZXRhX3VyZ2VudF9ucyA9IGdldF93bV9tZW1vcnlfdHJpcCgmY29udGV4dC0+YndfY3R4
LmRtbCwgcGlwZXMsIHBpcGVfY250KSAqIDEwMDA7CisKKwkJaWYgKHZsZXZlbCA8IDMpIHsKKwkJ
CXBpcGVzWzBdLmNsa3NfY2ZnLnZvbHRhZ2UgPSAzOworCQkJcGlwZXNbMF0uY2xrc19jZmcuZGNm
Y2xrX21oeiA9IGNvbnRleHQtPmJ3X2N0eC5kbWwuc29jLmNsb2NrX2xpbWl0c1syXS5kY2ZjbGtf
bWh6OworCQkJcGlwZXNbMF0uY2xrc19jZmcuc29jY2xrX21oeiA9IGNvbnRleHQtPmJ3X2N0eC5k
bWwuc29jLmNsb2NrX2xpbWl0c1syXS5zb2NjbGtfbWh6OworCQl9CisJCWNvbnRleHQtPmJ3X2N0
eC5idy5kY24ud2F0ZXJtYXJrcy5kLnVyZ2VudF9ucyA9IGdldF93bV91cmdlbnQoJmNvbnRleHQt
PmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOworCQljb250ZXh0LT5id19jdHgu
YncuZGNuLndhdGVybWFya3MuZC5jc3RhdGVfcHN0YXRlLmNzdGF0ZV9lbnRlcl9wbHVzX2V4aXRf
bnMgPSBnZXRfd21fc3R1dHRlcl9lbnRlcl9leGl0KCZjb250ZXh0LT5id19jdHguZG1sLCBwaXBl
cywgcGlwZV9jbnQpICogMTAwMDsKKwkJY29udGV4dC0+YndfY3R4LmJ3LmRjbi53YXRlcm1hcmtz
LmQuY3N0YXRlX3BzdGF0ZS5jc3RhdGVfZXhpdF9ucyA9IGdldF93bV9zdHV0dGVyX2V4aXQoJmNv
bnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOworCQljb250ZXh0LT5i
d19jdHguYncuZGNuLndhdGVybWFya3MuZC5jc3RhdGVfcHN0YXRlLnBzdGF0ZV9jaGFuZ2VfbnMg
PSBnZXRfd21fZHJhbV9jbG9ja19jaGFuZ2UoJmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBw
aXBlX2NudCkgKiAxMDAwOworCQljb250ZXh0LT5id19jdHguYncuZGNuLndhdGVybWFya3MuZC5w
dGVfbWV0YV91cmdlbnRfbnMgPSBnZXRfd21fbWVtb3J5X3RyaXAoJmNvbnRleHQtPmJ3X2N0eC5k
bWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOworCisJCXBpcGVzWzBdLmNsa3NfY2ZnLnZvbHRh
Z2UgPSB2bGV2ZWw7CisJCXBpcGVzWzBdLmNsa3NfY2ZnLmRjZmNsa19taHogPSBjb250ZXh0LT5i
d19jdHguZG1sLnNvYy5jbG9ja19saW1pdHNbdmxldmVsXS5kY2ZjbGtfbWh6OworCQlwaXBlc1sw
XS5jbGtzX2NmZy5zb2NjbGtfbWh6ID0gY29udGV4dC0+YndfY3R4LmRtbC5zb2MuY2xvY2tfbGlt
aXRzW3ZsZXZlbF0uc29jY2xrX21oejsKKwkJY29udGV4dC0+YndfY3R4LmJ3LmRjbi53YXRlcm1h
cmtzLmEudXJnZW50X25zID0gZ2V0X3dtX3VyZ2VudCgmY29udGV4dC0+YndfY3R4LmRtbCwgcGlw
ZXMsIHBpcGVfY250KSAqIDEwMDA7CisJCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJr
cy5hLmNzdGF0ZV9wc3RhdGUuY3N0YXRlX2VudGVyX3BsdXNfZXhpdF9ucyA9IGdldF93bV9zdHV0
dGVyX2VudGVyX2V4aXQoJmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAx
MDAwOworCQljb250ZXh0LT5id19jdHguYncuZGNuLndhdGVybWFya3MuYS5jc3RhdGVfcHN0YXRl
LmNzdGF0ZV9leGl0X25zID0gZ2V0X3dtX3N0dXR0ZXJfZXhpdCgmY29udGV4dC0+YndfY3R4LmRt
bCwgcGlwZXMsIHBpcGVfY250KSAqIDEwMDA7CisJCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0
ZXJtYXJrcy5hLmNzdGF0ZV9wc3RhdGUucHN0YXRlX2NoYW5nZV9ucyA9IGdldF93bV9kcmFtX2Ns
b2NrX2NoYW5nZSgmY29udGV4dC0+YndfY3R4LmRtbCwgcGlwZXMsIHBpcGVfY250KSAqIDEwMDA7
CisJCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5hLnB0ZV9tZXRhX3VyZ2VudF9u
cyA9IGdldF93bV9tZW1vcnlfdHJpcCgmY29udGV4dC0+YndfY3R4LmRtbCwgcGlwZXMsIHBpcGVf
Y250KSAqIDEwMDA7Cit9CisKK3ZvaWQgZGNuMjBfY2FsY3VsYXRlX2RsZ19wYXJhbXMoCisJCXN0
cnVjdCBkYyAqZGMsIHN0cnVjdCBkY19zdGF0ZSAqY29udGV4dCwKKwkJZGlzcGxheV9lMmVfcGlw
ZV9wYXJhbXNfc3QgKnBpcGVzLAorCQlpbnQgcGlwZV9jbnQsCisJCWludCB2bGV2ZWwpCit7CisJ
aW50IGksIHBpcGVfaWR4OwogCi0JaWYgKHBpcGVfY250ICE9IHBpcGVfaWR4KSB7Ci0JCWlmIChk
Yy0+cmVzX3Bvb2wtPmZ1bmNzLT5wb3B1bGF0ZV9kbWxfcGlwZXMpCi0JCQlwaXBlX2NudCA9IGRj
LT5yZXNfcG9vbC0+ZnVuY3MtPnBvcHVsYXRlX2RtbF9waXBlcyhkYywKLQkJCQkmY29udGV4dC0+
cmVzX2N0eCwgcGlwZXMpOwotCQllbHNlCi0JCQlwaXBlX2NudCA9IGRjbjIwX3BvcHVsYXRlX2Rt
bF9waXBlc19mcm9tX2NvbnRleHQoZGMsCi0JCQkJJmNvbnRleHQtPnJlc19jdHgsIHBpcGVzKTsK
LQl9Ci0KLQlwaXBlc1swXS5jbGtzX2NmZy52b2x0YWdlID0gdmxldmVsOwotCXBpcGVzWzBdLmNs
a3NfY2ZnLmRjZmNsa19taHogPSBjb250ZXh0LT5id19jdHguZG1sLnNvYy5jbG9ja19saW1pdHNb
dmxldmVsXS5kY2ZjbGtfbWh6OwotCXBpcGVzWzBdLmNsa3NfY2ZnLnNvY2Nsa19taHogPSBjb250
ZXh0LT5id19jdHguZG1sLnNvYy5jbG9ja19saW1pdHNbdmxldmVsXS5zb2NjbGtfbWh6OwotCi0J
Lyogb25seSBwaXBlIDAgaXMgcmVhZCBmb3Igdm9sdGFnZSBhbmQgZGNmL3NvYyBjbG9ja3MgKi8K
LQlpZiAodmxldmVsIDwgMSkgewotCQlwaXBlc1swXS5jbGtzX2NmZy52b2x0YWdlID0gMTsKLQkJ
cGlwZXNbMF0uY2xrc19jZmcuZGNmY2xrX21oeiA9IGNvbnRleHQtPmJ3X2N0eC5kbWwuc29jLmNs
b2NrX2xpbWl0c1sxXS5kY2ZjbGtfbWh6OwotCQlwaXBlc1swXS5jbGtzX2NmZy5zb2NjbGtfbWh6
ID0gY29udGV4dC0+YndfY3R4LmRtbC5zb2MuY2xvY2tfbGltaXRzWzFdLnNvY2Nsa19taHo7Ci0J
fQotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5iLnVyZ2VudF9ucyA9IGdldF93
bV91cmdlbnQoJmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOwot
CWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5iLmNzdGF0ZV9wc3RhdGUuY3N0YXRl
X2VudGVyX3BsdXNfZXhpdF9ucyA9IGdldF93bV9zdHV0dGVyX2VudGVyX2V4aXQoJmNvbnRleHQt
PmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0eC5i
dy5kY24ud2F0ZXJtYXJrcy5iLmNzdGF0ZV9wc3RhdGUuY3N0YXRlX2V4aXRfbnMgPSBnZXRfd21f
c3R1dHRlcl9leGl0KCZjb250ZXh0LT5id19jdHguZG1sLCBwaXBlcywgcGlwZV9jbnQpICogMTAw
MDsKLQljb250ZXh0LT5id19jdHguYncuZGNuLndhdGVybWFya3MuYi5jc3RhdGVfcHN0YXRlLnBz
dGF0ZV9jaGFuZ2VfbnMgPSBnZXRfd21fZHJhbV9jbG9ja19jaGFuZ2UoJmNvbnRleHQtPmJ3X2N0
eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24u
d2F0ZXJtYXJrcy5iLnB0ZV9tZXRhX3VyZ2VudF9ucyA9IGdldF93bV9tZW1vcnlfdHJpcCgmY29u
dGV4dC0+YndfY3R4LmRtbCwgcGlwZXMsIHBpcGVfY250KSAqIDEwMDA7Ci0KLQlpZiAodmxldmVs
IDwgMikgewotCQlwaXBlc1swXS5jbGtzX2NmZy52b2x0YWdlID0gMjsKLQkJcGlwZXNbMF0uY2xr
c19jZmcuZGNmY2xrX21oeiA9IGNvbnRleHQtPmJ3X2N0eC5kbWwuc29jLmNsb2NrX2xpbWl0c1sy
XS5kY2ZjbGtfbWh6OwotCQlwaXBlc1swXS5jbGtzX2NmZy5zb2NjbGtfbWh6ID0gY29udGV4dC0+
YndfY3R4LmRtbC5zb2MuY2xvY2tfbGltaXRzWzJdLnNvY2Nsa19taHo7Ci0JfQotCWNvbnRleHQt
PmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5jLnVyZ2VudF9ucyA9IGdldF93bV91cmdlbnQoJmNv
bnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOwotCWNvbnRleHQtPmJ3
X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5jLmNzdGF0ZV9wc3RhdGUuY3N0YXRlX2VudGVyX3BsdXNf
ZXhpdF9ucyA9IGdldF93bV9zdHV0dGVyX2VudGVyX2V4aXQoJmNvbnRleHQtPmJ3X2N0eC5kbWws
IHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJt
YXJrcy5jLmNzdGF0ZV9wc3RhdGUuY3N0YXRlX2V4aXRfbnMgPSBnZXRfd21fc3R1dHRlcl9leGl0
KCZjb250ZXh0LT5id19jdHguZG1sLCBwaXBlcywgcGlwZV9jbnQpICogMTAwMDsKLQljb250ZXh0
LT5id19jdHguYncuZGNuLndhdGVybWFya3MuYy5jc3RhdGVfcHN0YXRlLnBzdGF0ZV9jaGFuZ2Vf
bnMgPSBnZXRfd21fZHJhbV9jbG9ja19jaGFuZ2UoJmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVz
LCBwaXBlX2NudCkgKiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5j
LnB0ZV9tZXRhX3VyZ2VudF9ucyA9IGdldF93bV9tZW1vcnlfdHJpcCgmY29udGV4dC0+YndfY3R4
LmRtbCwgcGlwZXMsIHBpcGVfY250KSAqIDEwMDA7Ci0KLQlpZiAodmxldmVsIDwgMykgewotCQlw
aXBlc1swXS5jbGtzX2NmZy52b2x0YWdlID0gMzsKLQkJcGlwZXNbMF0uY2xrc19jZmcuZGNmY2xr
X21oeiA9IGNvbnRleHQtPmJ3X2N0eC5kbWwuc29jLmNsb2NrX2xpbWl0c1syXS5kY2ZjbGtfbWh6
OwotCQlwaXBlc1swXS5jbGtzX2NmZy5zb2NjbGtfbWh6ID0gY29udGV4dC0+YndfY3R4LmRtbC5z
b2MuY2xvY2tfbGltaXRzWzJdLnNvY2Nsa19taHo7Ci0JfQotCWNvbnRleHQtPmJ3X2N0eC5idy5k
Y24ud2F0ZXJtYXJrcy5kLnVyZ2VudF9ucyA9IGdldF93bV91cmdlbnQoJmNvbnRleHQtPmJ3X2N0
eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24u
d2F0ZXJtYXJrcy5kLmNzdGF0ZV9wc3RhdGUuY3N0YXRlX2VudGVyX3BsdXNfZXhpdF9ucyA9IGdl
dF93bV9zdHV0dGVyX2VudGVyX2V4aXQoJmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBl
X2NudCkgKiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5kLmNzdGF0
ZV9wc3RhdGUuY3N0YXRlX2V4aXRfbnMgPSBnZXRfd21fc3R1dHRlcl9leGl0KCZjb250ZXh0LT5i
d19jdHguZG1sLCBwaXBlcywgcGlwZV9jbnQpICogMTAwMDsKLQljb250ZXh0LT5id19jdHguYncu
ZGNuLndhdGVybWFya3MuZC5jc3RhdGVfcHN0YXRlLnBzdGF0ZV9jaGFuZ2VfbnMgPSBnZXRfd21f
ZHJhbV9jbG9ja19jaGFuZ2UoJmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkg
KiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5kLnB0ZV9tZXRhX3Vy
Z2VudF9ucyA9IGdldF93bV9tZW1vcnlfdHJpcCgmY29udGV4dC0+YndfY3R4LmRtbCwgcGlwZXMs
IHBpcGVfY250KSAqIDEwMDA7Ci0KLQlwaXBlc1swXS5jbGtzX2NmZy52b2x0YWdlID0gdmxldmVs
OwotCXBpcGVzWzBdLmNsa3NfY2ZnLmRjZmNsa19taHogPSBjb250ZXh0LT5id19jdHguZG1sLnNv
Yy5jbG9ja19saW1pdHNbdmxldmVsXS5kY2ZjbGtfbWh6OwotCXBpcGVzWzBdLmNsa3NfY2ZnLnNv
Y2Nsa19taHogPSBjb250ZXh0LT5id19jdHguZG1sLnNvYy5jbG9ja19saW1pdHNbdmxldmVsXS5z
b2NjbGtfbWh6OwotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5hLnVyZ2VudF9u
cyA9IGdldF93bV91cmdlbnQoJmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkg
KiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5hLmNzdGF0ZV9wc3Rh
dGUuY3N0YXRlX2VudGVyX3BsdXNfZXhpdF9ucyA9IGdldF93bV9zdHV0dGVyX2VudGVyX2V4aXQo
JmNvbnRleHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOwotCWNvbnRleHQt
PmJ3X2N0eC5idy5kY24ud2F0ZXJtYXJrcy5hLmNzdGF0ZV9wc3RhdGUuY3N0YXRlX2V4aXRfbnMg
PSBnZXRfd21fc3R1dHRlcl9leGl0KCZjb250ZXh0LT5id19jdHguZG1sLCBwaXBlcywgcGlwZV9j
bnQpICogMTAwMDsKLQljb250ZXh0LT5id19jdHguYncuZGNuLndhdGVybWFya3MuYS5jc3RhdGVf
cHN0YXRlLnBzdGF0ZV9jaGFuZ2VfbnMgPSBnZXRfd21fZHJhbV9jbG9ja19jaGFuZ2UoJmNvbnRl
eHQtPmJ3X2N0eC5kbWwsIHBpcGVzLCBwaXBlX2NudCkgKiAxMDAwOwotCWNvbnRleHQtPmJ3X2N0
eC5idy5kY24ud2F0ZXJtYXJrcy5hLnB0ZV9tZXRhX3VyZ2VudF9ucyA9IGdldF93bV9tZW1vcnlf
dHJpcCgmY29udGV4dC0+YndfY3R4LmRtbCwgcGlwZXMsIHBpcGVfY250KSAqIDEwMDA7CiAJLyog
V3JpdGViYWNrIE1DSUZfV0IgYXJiaXRyYXRpb24gcGFyYW1ldGVycyAqLwogCWRjLT5yZXNfcG9v
bC0+ZnVuY3MtPnNldF9tY2lmX2FyYl9wYXJhbXMoZGMsIGNvbnRleHQsIHBpcGVzLCBwaXBlX2Nu
dCk7CiAKQEAgLTIzNDksNyArMjM3Myw3IEBAIGJvb2wgZGNuMjBfdmFsaWRhdGVfYmFuZHdpZHRo
KHN0cnVjdCBkYyAqZGMsIHN0cnVjdCBkY19zdGF0ZSAqY29udGV4dCwKIAkJCQkJCQkhPSBkbV9k
cmFtX2Nsb2NrX2NoYW5nZV91bnN1cHBvcnRlZDsKIAljb250ZXh0LT5id19jdHguYncuZGNuLmNs
ay5kcHBjbGtfa2h6ID0gMDsKIAotCUJXX1ZBTF9UUkFDRV9FTkRfV0FURVJNQVJLUygpOworCiAK
IAlmb3IgKGkgPSAwLCBwaXBlX2lkeCA9IDA7IGkgPCBkYy0+cmVzX3Bvb2wtPnBpcGVfY291bnQ7
IGkrKykgewogCQlpZiAoIWNvbnRleHQtPnJlc19jdHgucGlwZV9jdHhbaV0uc3RyZWFtKQpAQCAt
MjM5MSw4ICsyNDE1LDQwIEBAIGJvb2wgZGNuMjBfdmFsaWRhdGVfYmFuZHdpZHRoKHN0cnVjdCBk
YyAqZGMsIHN0cnVjdCBkY19zdGF0ZSAqY29udGV4dCwKIAkJCQlwaXBlc1twaXBlX2lkeF0ucGlw
ZSk7CiAJCXBpcGVfaWR4Kys7CiAJfQorfQorCitib29sIGRjbjIwX3ZhbGlkYXRlX2JhbmR3aWR0
aChzdHJ1Y3QgZGMgKmRjLCBzdHJ1Y3QgZGNfc3RhdGUgKmNvbnRleHQsCisJCWJvb2wgZmFzdF92
YWxpZGF0ZSkKK3sKKwlib29sIG91dCA9IGZhbHNlOworCisJQldfVkFMX1RSQUNFX1NFVFVQKCk7
CisKKwlpbnQgdmxldmVsID0gMDsKKwlpbnQgcGlwZV9zcGxpdF9mcm9tW01BWF9QSVBFU107CisJ
aW50IHBpcGVfY250ID0gMDsKKwlkaXNwbGF5X2UyZV9waXBlX3BhcmFtc19zdCAqcGlwZXMgPSBr
emFsbG9jKGRjLT5yZXNfcG9vbC0+cGlwZV9jb3VudCAqIHNpemVvZihkaXNwbGF5X2UyZV9waXBl
X3BhcmFtc19zdCksIEdGUF9LRVJORUwpOworCURDX0xPR0dFUl9JTklUKGRjLT5jdHgtPmxvZ2dl
cik7CisKKwlCV19WQUxfVFJBQ0VfQ09VTlQoKTsKKworCW91dCA9IGRjbjIwX2Zhc3RfdmFsaWRh
dGVfYncoZGMsIGNvbnRleHQsIHBpcGVzLCBwaXBlX3NwbGl0X2Zyb20sICZ2bGV2ZWwpOworCisJ
aWYgKCFvdXQpCisJCWdvdG8gdmFsaWRhdGVfZmFpbDsKKworCUJXX1ZBTF9UUkFDRV9FTkRfVk9M
VEFHRV9MRVZFTCgpOworCisJaWYgKGZhc3RfdmFsaWRhdGUpIHsKKwkJQldfVkFMX1RSQUNFX1NL
SVAoZmFzdCk7CisJCWdvdG8gdmFsaWRhdGVfb3V0OworCX0KKworCWRjbjIwX2NhbGN1bGF0ZV93
bShkYywgY29udGV4dCwgcGlwZXMsICZwaXBlX2NudCwgcGlwZV9zcGxpdF9mcm9tLCB2bGV2ZWwp
OworCWRjbjIwX2NhbGN1bGF0ZV9kbGdfcGFyYW1zKGRjLCBjb250ZXh0LCBwaXBlcywgcGlwZV9j
bnQsIHZsZXZlbCk7CisKKwlCV19WQUxfVFJBQ0VfRU5EX1dBVEVSTUFSS1MoKTsKIAotCW91dCA9
IHRydWU7CiAJZ290byB2YWxpZGF0ZV9vdXQ7CiAKIHZhbGlkYXRlX2ZhaWw6CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2UuaCBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24yMF9yZXNvdXJjZS5oCmlu
ZGV4IGI1YTc1Mjg5ZjQ0NC4uMmIzNjkyZTBjNDhkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2UuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2UuaApAQCAtMTE2LDYgKzEx
NiwxNyBAQCB2b2lkIGRjbjIwX3NldF9tY2lmX2FyYl9wYXJhbXMoCiAJCWRpc3BsYXlfZTJlX3Bp
cGVfcGFyYW1zX3N0ICpwaXBlcywKIAkJaW50IHBpcGVfY250KTsKIGJvb2wgZGNuMjBfdmFsaWRh
dGVfYmFuZHdpZHRoKHN0cnVjdCBkYyAqZGMsIHN0cnVjdCBkY19zdGF0ZSAqY29udGV4dCwgYm9v
bCBmYXN0X3ZhbGlkYXRlKTsKK2Jvb2wgZGNuMjBfZmFzdF92YWxpZGF0ZV9idygKKwkJc3RydWN0
IGRjICpkYywKKwkJc3RydWN0IGRjX3N0YXRlICpjb250ZXh0LAorCQlkaXNwbGF5X2UyZV9waXBl
X3BhcmFtc19zdCAqcGlwZXMsCisJCWludCAqcGlwZV9zcGxpdF9mcm9tLAorCQlpbnQgKnZsZXZl
bF9vdXQpOwordm9pZCBkY24yMF9jYWxjdWxhdGVfZGxnX3BhcmFtcygKKwkJc3RydWN0IGRjICpk
Yywgc3RydWN0IGRjX3N0YXRlICpjb250ZXh0LAorCQlkaXNwbGF5X2UyZV9waXBlX3BhcmFtc19z
dCAqcGlwZXMsCisJCWludCBwaXBlX2NudCwKKwkJaW50IHZsZXZlbCk7CiAKIGVudW0gZGNfc3Rh
dHVzIGRjbjIwX2J1aWxkX21hcHBlZF9yZXNvdXJjZShjb25zdCBzdHJ1Y3QgZGMgKmRjLCBzdHJ1
Y3QgZGNfc3RhdGUgKmNvbnRleHQsIHN0cnVjdCBkY19zdHJlYW1fc3RhdGUgKnN0cmVhbSk7CiBl
bnVtIGRjX3N0YXR1cyBkY24yMF9hZGRfc3RyZWFtX3RvX2N0eChzdHJ1Y3QgZGMgKmRjLCBzdHJ1
Y3QgZGNfc3RhdGUgKm5ld19jdHgsIHN0cnVjdCBkY19zdHJlYW1fc3RhdGUgKmRjX3N0cmVhbSk7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvaW5jL2h3L2Nsa19t
Z3JfaW50ZXJuYWwuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9pbmMvaHcvY2xr
X21ncl9pbnRlcm5hbC5oCmluZGV4IDA4MzVhYzA0MWFjZi4uM2MxMDUxMjRkY2RkIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvaW5jL2h3L2Nsa19tZ3JfaW50ZXJu
YWwuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvaW5jL2h3L2Nsa19tZ3Jf
aW50ZXJuYWwuaApAQCAtNjQsNiArNjQsOCBAQCBlbnVtIGRlbnRpc3RfZGl2aWRlcl9yYW5nZSB7
CiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgKi8KIAorLyogTWFjcm9zICovCisK
ICNkZWZpbmUgVE9fQ0xLX01HUl9JTlRFUk5BTChjbGtfbWdyKVwKIAljb250YWluZXJfb2YoY2xr
X21nciwgc3RydWN0IGNsa19tZ3JfaW50ZXJuYWwsIGJhc2UpCiAKLS0gCjIuMjIuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5n
IGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
