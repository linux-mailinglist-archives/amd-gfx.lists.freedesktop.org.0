Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5BD2DDA46D
	for <lists+amd-gfx@lfdr.de>; Thu, 17 Oct 2019 05:55:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DB9A86E0EB;
	Thu, 17 Oct 2019 03:55:56 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM05-BY2-obe.outbound.protection.outlook.com
 (mail-eopbgr710084.outbound.protection.outlook.com [40.107.71.84])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8E9866E0EB
 for <amd-gfx@lists.freedesktop.org>; Thu, 17 Oct 2019 03:55:55 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=ewcNULM+jypJ/EEOjV3pSXB/8JHD69Zb07FeLiNri3QYcFKjAS6ekLUXEZ7RQr+B0dpNRye1bQcvwHcLF/hg4L4ae1nt2y+Tcu5iCPJRwcBgwJgGEwBPx1oMOhds/X0YU1y19f363nbD7chZnF62n03WZ4DF2CnuLu56ACVk38b16iht90Yy55Q5JThybISzKKoqNmahS1mXNwazXk83Gj2AHI7JR/kVIkVizc7SkgFyMUJkhlif0O0/JRCaykfj7IGIGTCXasLr4eK2M6L+t/ov42e+Iw63ikYAE+FkaUVyP5VpAVUqmWYK/NDtg4kMqTZNJ0VNdthsZ2ftoIlbzg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=2bMGPxMUPyue9J29vurXQgWpR3DK48dL/n1H9i2ZELk=;
 b=Us74b5cPv+RGVab/fsahMJdo6VLkR9Wycr7nx8O1HcC9aEFF/9WfykqJqGpDKGvDcikDqnEN75rtoZsygYhrhRtSjQl9jWLfYlaYYEGka5wYeF4yo9L0R8yHranwrM7f1ukB9PuWeXek8MVuSNKDnxnib60TsG8JPJFDIKPdfeGInP2ZakW4NUCp+MA8wdGMLblJmFKMliIylJWIdAS4EOviiPRszS3nvdQgZYZ+pxNrWNet3j4xZ5JbHEWaO4a28cB8EdX6K7KCIvI/T+KyHDH7S0IcxRClwc/qGp7X6JaGAUcc8vWDvQRZlj1uQ5DNgm31jSOamNKmYz8W4wRO0w==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
Received: from MN2PR12MB3344.namprd12.prod.outlook.com (20.178.241.74) by
 MN2PR12MB3967.namprd12.prod.outlook.com (10.255.238.208) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2347.16; Thu, 17 Oct 2019 03:55:53 +0000
Received: from MN2PR12MB3344.namprd12.prod.outlook.com
 ([fe80::435:bdca:bac1:a26d]) by MN2PR12MB3344.namprd12.prod.outlook.com
 ([fe80::435:bdca:bac1:a26d%5]) with mapi id 15.20.2347.023; Thu, 17 Oct 2019
 03:55:53 +0000
From: "Quan, Evan" <Evan.Quan@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: [PATCH] drm/amd/powerplay: add lock protection for swSMU APIs
Thread-Topic: [PATCH] drm/amd/powerplay: add lock protection for swSMU APIs
Thread-Index: AQHVhJ7FlmM4UII0ZkOOWAgJrddWNQ==
Date: Thu, 17 Oct 2019 03:55:53 +0000
Message-ID: <20191017035532.24894-1-evan.quan@amd.com>
Accept-Language: en-US, zh-CN
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: HK0PR03CA0119.apcprd03.prod.outlook.com
 (2603:1096:203:b0::35) To MN2PR12MB3344.namprd12.prod.outlook.com
 (2603:10b6:208:c5::10)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.23.0
x-originating-ip: [180.167.199.189]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 5c1794fe-36ab-4afe-ba08-08d752b5e7ca
x-ms-office365-filtering-ht: Tenant
x-ms-traffictypediagnostic: MN2PR12MB3967:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <MN2PR12MB39675ACD3EE5231FB2CCC97BE46D0@MN2PR12MB3967.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:3826;
x-forefront-prvs: 01930B2BA8
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(4636009)(376002)(346002)(396003)(136003)(39860400002)(366004)(189003)(199004)(478600001)(71200400001)(256004)(386003)(6506007)(66476007)(66946007)(66556008)(64756008)(66446008)(14454004)(186003)(36756003)(102836004)(26005)(71190400001)(14444005)(2501003)(66066001)(476003)(2616005)(486006)(2351001)(2906002)(25786009)(5660300002)(86362001)(305945005)(316002)(6916009)(1076003)(81156014)(6436002)(8936002)(50226002)(4326008)(3846002)(66574012)(81166006)(6486002)(30864003)(6512007)(8676002)(7736002)(99286004)(52116002)(6116002)(5640700003)(569006);
 DIR:OUT; SFP:1101; SCL:1; SRVR:MN2PR12MB3967;
 H:MN2PR12MB3344.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: xDAU994oSF6p4S+bPG/F8/zxbNP9ilYdttm4bua0dQwRV65pA9EOni3QGVsEEoYVSn6AEa0SD6uOQ2pTwJyGzOP9nIZ5WwXk2ci0VcnGoF7yr0WkKfND5N93/D7PXYayZrBeyrhH3XqSlGdspErF6JvbEc4NtxPaPYKB7znAPQXLzfH0uvCHvY/TdrTeWli7mBlAGHqS/pvkXf/sKfJQJrQsx23Bvl+RaDqreDd7EcJh2I6mfOwKgV1AEEtaVuwCRe5mPg9jbKW8v2txHvdg1bEMelXaQOXaFNBSgEkO89bbFoTnLFm9Uw9T/sXLAPFNp7bP3cCVbmAyHEPoMgCMJI/p3JQ6DdzcagFxBAraVJHlKuTnRlhUy3hBsZ6pXMjpnitu3RH1rxtBcUMTDB3ZGXCwkoOfjfC7u2pJWO8FggI=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 5c1794fe-36ab-4afe-ba08-08d752b5e7ca
X-MS-Exchange-CrossTenant-originalarrivaltime: 17 Oct 2019 03:55:53.1383 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: jnkBqfxf5YER2/IeVmYFFIkpQB0i9H78WJkSR05mwPdTTsKZ4V6ctL20r7uDIOeK
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MN2PR12MB3967
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=2bMGPxMUPyue9J29vurXQgWpR3DK48dL/n1H9i2ZELk=;
 b=1hqa2hzd4OzNN1qPRY/skQt+DdRIvG5G9mAkIt2IgJ7zh4HS3ucRsRVuLFkIt2d8Umi40AX88bv6yKbsipXa/SVDB1c8q72nzwEDKLLoF6/tj9KxOEF3cmq92xhF14zfg0zl6N53oG0bc1Y66brpt5ysMQKke9gY8rN/tZHc+mk=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Evan.Quan@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Quan, Evan" <Evan.Quan@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhpcyBpcyBhIHF1aWNrIGFuZCBsb3cgcmlzayBmaXguIFRob3NlIEFQSXMgd2hpY2gKYXJlIGV4
cG9zZWQgdG8gb3RoZXIgSVBzIG9yIHRvIHN1cHBvcnQgc3lzZnMvaHdtb24KaW50ZXJmYWNlcyBv
ciBEQUwgd2lsbCBoYXZlIGxvY2sgcHJvdGVjdGlvbi4gTWVhbndoaWxlCm5vIGxvY2sgcHJvdGVj
dGlvbiBpcyBlbmZvcmNlZCBmb3Igc3dTTVUgaW50ZXJuYWwgdXNlZApBUElzLiBGdXR1cmUgb3B0
aW1pemF0aW9uIGlzIG5lZWRlZC4KCkNoYW5nZS1JZDogSTgzOTI2NTJjOWRhMTU3NGE4NWFjZDli
MTcxZjA0MzgwZjM2MzA4NTIKU2lnbmVkLW9mZi1ieTogRXZhbiBRdWFuIDxldmFuLnF1YW5AYW1k
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHBtLmMgICAgICAg
fCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcG0uaCAgICAgICB8
ICAgNiAtCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcG0uYyAgICAgICAgfCAg
MjMgKy0KIC4uLi9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX3BwX3NtdS5jICB8ICAg
NCArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jICAgIHwgNjg0
ICsrKysrKysrKysrKysrKystLQogLi4uL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9pbmMvYW1kZ3B1
X3NtdS5oICAgIHwgMTYzICsrKy0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9uYXZp
MTBfcHB0LmMgICAgfCAgMTUgKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3Jlbm9p
cl9wcHQuYyAgICB8ICAxMiArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211X3Yx
MV8wLmMgICAgIHwgICA3ICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS92ZWdhMjBf
cHB0LmMgICAgfCAgIDYgKy0KIDEwIGZpbGVzIGNoYW5nZWQsIDc3MyBpbnNlcnRpb25zKCspLCAx
NTMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2RwbS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RwbS5jCmlu
ZGV4IDI2MzI2NTI0NWUxOS4uMjhkMzI3MjUyODViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZHBtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2RwbS5jCkBAIC05MTIsNyArOTEyLDggQEAgaW50IGFtZGdwdV9kcG1fZ2V0X3Nj
bGsoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGJvb2wgbG93KQogCWlmIChpc19zdXBwb3J0
X3N3X3NtdShhZGV2KSkgewogCQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKCZhZGV2LT5z
bXUsIFNNVV9HRlhDTEssCiAJCQkJCSAgICAgbG93ID8gJmNsa19mcmVxIDogTlVMTCwKLQkJCQkJ
ICAgICAhbG93ID8gJmNsa19mcmVxIDogTlVMTCk7CisJCQkJCSAgICAgIWxvdyA/ICZjbGtfZnJl
cSA6IE5VTEwsCisJCQkJCSAgICAgdHJ1ZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gMDsKIAkJ
cmV0dXJuIGNsa19mcmVxICogMTAwOwpAQCAtOTMwLDcgKzkzMSw4IEBAIGludCBhbWRncHVfZHBt
X2dldF9tY2xrKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBib29sIGxvdykKIAlpZiAoaXNf
c3VwcG9ydF9zd19zbXUoYWRldikpIHsKIAkJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZSgm
YWRldi0+c211LCBTTVVfVUNMSywKIAkJCQkJICAgICBsb3cgPyAmY2xrX2ZyZXEgOiBOVUxMLAot
CQkJCQkgICAgICFsb3cgPyAmY2xrX2ZyZXEgOiBOVUxMKTsKKwkJCQkJICAgICAhbG93ID8gJmNs
a19mcmVxIDogTlVMTCwKKwkJCQkJICAgICB0cnVlKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiAw
OwogCQlyZXR1cm4gY2xrX2ZyZXEgKiAxMDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZHBtLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZHBtLmgKaW5kZXggMWM1YzBmZDc2ZGJmLi4yY2ZiNjc3MjcyYWYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcG0uaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZHBtLmgKQEAgLTI5OCwxMiArMjk4LDYgQEAgZW51bSBhbWRn
cHVfcGNpZV9nZW4gewogI2RlZmluZSBhbWRncHVfZHBtX2dldF9jdXJyZW50X3Bvd2VyX3N0YXRl
KGFkZXYpIFwKIAkJKChhZGV2KS0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfY3VycmVudF9wb3dl
cl9zdGF0ZSgoYWRldiktPnBvd2VycGxheS5wcF9oYW5kbGUpKQogCi0jZGVmaW5lIGFtZGdwdV9z
bXVfZ2V0X2N1cnJlbnRfcG93ZXJfc3RhdGUoYWRldikgXAotCQkoKGFkZXYpLT5zbXUucHB0X2Z1
bmNzLT5nZXRfY3VycmVudF9wb3dlcl9zdGF0ZSgmKChhZGV2KS0+c211KSkpCi0KLSNkZWZpbmUg
YW1kZ3B1X3NtdV9zZXRfcG93ZXJfc3RhdGUoYWRldikgXAotCQkoKGFkZXYpLT5zbXUucHB0X2Z1
bmNzLT5zZXRfcG93ZXJfc3RhdGUoJigoYWRldiktPnNtdSkpKQotCiAjZGVmaW5lIGFtZGdwdV9k
cG1fZ2V0X3BwX251bV9zdGF0ZXMoYWRldiwgZGF0YSkgXAogCQkoKGFkZXYpLT5wb3dlcnBsYXku
cHBfZnVuY3MtPmdldF9wcF9udW1fc3RhdGVzKChhZGV2KS0+cG93ZXJwbGF5LnBwX2hhbmRsZSwg
ZGF0YSkpCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9w
bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3BtLmMKaW5kZXggYzUwZDVm
MWU3NWU1Li4zNmYzNmIzNTAwMGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9w
bS5jCkBAIC0yMTEsNyArMjExLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9kcG1fc3Rh
dGUoc3RydWN0IGRldmljZSAqZGV2LAogCiAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKSB7
CiAJCWlmIChhZGV2LT5zbXUucHB0X2Z1bmNzLT5nZXRfY3VycmVudF9wb3dlcl9zdGF0ZSkKLQkJ
CXBtID0gYW1kZ3B1X3NtdV9nZXRfY3VycmVudF9wb3dlcl9zdGF0ZShhZGV2KTsKKwkJCXBtID0g
c211X2dldF9jdXJyZW50X3Bvd2VyX3N0YXRlKCZhZGV2LT5zbXUpOwogCQllbHNlCiAJCQlwbSA9
IGFkZXYtPnBtLmRwbS51c2VyX3N0YXRlOwogCX0gZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBw
X2Z1bmNzLT5nZXRfY3VycmVudF9wb3dlcl9zdGF0ZSkgewpAQCAtOTU3LDcgKzk1Nyw3IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfZHBtX3NjbGsoc3RydWN0IGRldmljZSAqZGV2LAog
CQlyZXR1cm4gcmV0OwogCiAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQotCQlyZXQgPSBz
bXVfZm9yY2VfY2xrX2xldmVscygmYWRldi0+c211LCBTTVVfU0NMSywgbWFzayk7CisJCXJldCA9
IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9TQ0xLLCBtYXNrLCB0cnVlKTsK
IAllbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmZvcmNlX2Nsb2NrX2xldmVsKQog
CQlyZXQgPSBhbWRncHVfZHBtX2ZvcmNlX2Nsb2NrX2xldmVsKGFkZXYsIFBQX1NDTEssIG1hc2sp
OwogCkBAIC0xMDA0LDcgKzEwMDQsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2Rw
bV9tY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJcmV0dXJuIHJldDsKIAogCWlmIChpc19zdXBw
b3J0X3N3X3NtdShhZGV2KSkKLQkJcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNt
dSwgU01VX01DTEssIG1hc2spOworCQlyZXQgPSBzbXVfZm9yY2VfY2xrX2xldmVscygmYWRldi0+
c211LCBTTVVfTUNMSywgbWFzaywgdHJ1ZSk7CiAJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBw
X2Z1bmNzLT5mb3JjZV9jbG9ja19sZXZlbCkKIAkJcmV0ID0gYW1kZ3B1X2RwbV9mb3JjZV9jbG9j
a19sZXZlbChhZGV2LCBQUF9NQ0xLLCBtYXNrKTsKIApAQCAtMTA0NCw3ICsxMDQ0LDcgQEAgc3Rh
dGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fc29jY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwK
IAkJcmV0dXJuIHJldDsKIAogCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKLQkJcmV0ID0g
c211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX1NPQ0NMSywgbWFzayk7CisJCXJl
dCA9IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9TT0NDTEssIG1hc2ssIHRy
dWUpOwogCWVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Zm9yY2VfY2xvY2tfbGV2
ZWwpCiAJCXJldCA9IGFtZGdwdV9kcG1fZm9yY2VfY2xvY2tfbGV2ZWwoYWRldiwgUFBfU09DQ0xL
LCBtYXNrKTsKIApAQCAtMTA4NCw3ICsxMDg0LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3Nl
dF9wcF9kcG1fZmNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCiAJCXJldHVybiByZXQ7CiAKIAlpZiAo
aXNfc3VwcG9ydF9zd19zbXUoYWRldikpCi0JCXJldCA9IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZh
ZGV2LT5zbXUsIFNNVV9GQ0xLLCBtYXNrKTsKKwkJcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMo
JmFkZXYtPnNtdSwgU01VX0ZDTEssIG1hc2ssIHRydWUpOwogCWVsc2UgaWYgKGFkZXYtPnBvd2Vy
cGxheS5wcF9mdW5jcy0+Zm9yY2VfY2xvY2tfbGV2ZWwpCiAJCXJldCA9IGFtZGdwdV9kcG1fZm9y
Y2VfY2xvY2tfbGV2ZWwoYWRldiwgUFBfRkNMSywgbWFzayk7CiAKQEAgLTExMjQsNyArMTEyNCw3
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfZHBtX2RjZWZjbGsoc3RydWN0IGRldmlj
ZSAqZGV2LAogCQlyZXR1cm4gcmV0OwogCiAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQot
CQlyZXQgPSBzbXVfZm9yY2VfY2xrX2xldmVscygmYWRldi0+c211LCBTTVVfRENFRkNMSywgbWFz
ayk7CisJCXJldCA9IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9EQ0VGQ0xL
LCBtYXNrLCB0cnVlKTsKIAllbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmZvcmNl
X2Nsb2NrX2xldmVsKQogCQlyZXQgPSBhbWRncHVfZHBtX2ZvcmNlX2Nsb2NrX2xldmVsKGFkZXYs
IFBQX0RDRUZDTEssIG1hc2spOwogCkBAIC0xMTY0LDcgKzExNjQsNyBAQCBzdGF0aWMgc3NpemVf
dCBhbWRncHVfc2V0X3BwX2RwbV9wY2llKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJcmV0dXJuIHJl
dDsKIAogCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKLQkJcmV0ID0gc211X2ZvcmNlX2Ns
a19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX1BDSUUsIG1hc2spOworCQlyZXQgPSBzbXVfZm9yY2Vf
Y2xrX2xldmVscygmYWRldi0+c211LCBTTVVfUENJRSwgbWFzaywgdHJ1ZSk7CiAJZWxzZSBpZiAo
YWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5mb3JjZV9jbG9ja19sZXZlbCkKIAkJcmV0ID0gYW1k
Z3B1X2RwbV9mb3JjZV9jbG9ja19sZXZlbChhZGV2LCBQUF9QQ0lFLCBtYXNrKTsKIApAQCAtMTM1
Niw3ICsxMzU2LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9wb3dlcl9wcm9maWxl
X21vZGUoc3RydWN0IGRldmljZSAqZGV2LAogCX0KIAlwYXJhbWV0ZXJbcGFyYW1ldGVyX3NpemVd
ID0gcHJvZmlsZV9tb2RlOwogCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKLQkJcmV0ID0g
c211X3NldF9wb3dlcl9wcm9maWxlX21vZGUoJmFkZXYtPnNtdSwgcGFyYW1ldGVyLCBwYXJhbWV0
ZXJfc2l6ZSk7CisJCXJldCA9IHNtdV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKCZhZGV2LT5zbXUs
IHBhcmFtZXRlciwgcGFyYW1ldGVyX3NpemUsIHRydWUpOwogCWVsc2UgaWYgKGFkZXYtPnBvd2Vy
cGxheS5wcF9mdW5jcy0+c2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZSkKIAkJcmV0ID0gYW1kZ3B1X2Rw
bV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKGFkZXYsIHBhcmFtZXRlciwgcGFyYW1ldGVyX3NpemUp
OwogCWlmICghcmV0KQpAQCAtMjA2NSw3ICsyMDY1LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1
X2h3bW9uX3Nob3dfcG93ZXJfY2FwX21heChzdHJ1Y3QgZGV2aWNlICpkZXYsCiAJdWludDMyX3Qg
bGltaXQgPSAwOwogCiAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKSB7Ci0JCXNtdV9nZXRf
cG93ZXJfbGltaXQoJmFkZXYtPnNtdSwgJmxpbWl0LCB0cnVlKTsKKwkJc211X2dldF9wb3dlcl9s
aW1pdCgmYWRldi0+c211LCAmbGltaXQsIHRydWUsIHRydWUpOwogCQlyZXR1cm4gc25wcmludGYo
YnVmLCBQQUdFX1NJWkUsICIldVxuIiwgbGltaXQgKiAxMDAwMDAwKTsKIAl9IGVsc2UgaWYgKGFk
ZXYtPnBvd2VycGxheS5wcF9mdW5jcyAmJiBhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9w
b3dlcl9saW1pdCkgewogCQlhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9wb3dlcl9saW1p
dChhZGV2LT5wb3dlcnBsYXkucHBfaGFuZGxlLCAmbGltaXQsIHRydWUpOwpAQCAtMjA4Myw3ICsy
MDgzLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfcG93ZXJfY2FwKHN0cnVj
dCBkZXZpY2UgKmRldiwKIAl1aW50MzJfdCBsaW1pdCA9IDA7CiAKIAlpZiAoaXNfc3VwcG9ydF9z
d19zbXUoYWRldikpIHsKLQkJc211X2dldF9wb3dlcl9saW1pdCgmYWRldi0+c211LCAmbGltaXQs
IGZhbHNlKTsKKwkJc211X2dldF9wb3dlcl9saW1pdCgmYWRldi0+c211LCAmbGltaXQsIGZhbHNl
LCAgdHJ1ZSk7CiAJCXJldHVybiBzbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiV1XG4iLCBsaW1p
dCAqIDEwMDAwMDApOwogCX0gZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzICYmIGFk
ZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Z2V0X3Bvd2VyX2xpbWl0KSB7CiAJCWFkZXYtPnBvd2Vy
cGxheS5wcF9mdW5jcy0+Z2V0X3Bvd2VyX2xpbWl0KGFkZXYtPnBvd2VycGxheS5wcF9oYW5kbGUs
ICZsaW1pdCwgZmFsc2UpOwpAQCAtMzA2NCw3ICszMDY0LDggQEAgdm9pZCBhbWRncHVfcG1fY29t
cHV0ZV9jbG9ja3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCXN0cnVjdCBzbXVfZHBt
X2NvbnRleHQgKnNtdV9kcG0gPSAmYWRldi0+c211LnNtdV9kcG07CiAJCXNtdV9oYW5kbGVfdGFz
aygmYWRldi0+c211LAogCQkJCXNtdV9kcG0tPmRwbV9sZXZlbCwKLQkJCQlBTURfUFBfVEFTS19E
SVNQTEFZX0NPTkZJR19DSEFOR0UpOworCQkJCUFNRF9QUF9UQVNLX0RJU1BMQVlfQ09ORklHX0NI
QU5HRSwKKwkJCQl0cnVlKTsKIAl9IGVsc2UgewogCQlpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1
bmNzLT5kaXNwYXRjaF90YXNrcykgewogCQkJaWYgKCFhbWRncHVfZGV2aWNlX2hhc19kY19zdXBw
b3J0KGFkZXYpKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1k
Z3B1X2RtL2FtZGdwdV9kbV9wcF9zbXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9h
bWRncHVfZG0vYW1kZ3B1X2RtX3BwX3NtdS5jCmluZGV4IDEzNTIwMTk2NDhjMC4uZWU5OTE1ZDYx
Y2YxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2Ft
ZGdwdV9kbV9wcF9zbXUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1
X2RtL2FtZGdwdV9kbV9wcF9zbXUuYwpAQCAtODc2LDcgKzg3Niw3IEBAIGVudW0gcHBfc211X3N0
YXR1cyBwcF9udl9nZXRfbWF4aW11bV9zdXN0YWluYWJsZV9jbG9ja3MoCiAJaWYgKCFzbXUtPmZ1
bmNzLT5nZXRfbWF4X3N1c3RhaW5hYmxlX2Nsb2Nrc19ieV9kYykKIAkJcmV0dXJuIFBQX1NNVV9S
RVNVTFRfVU5TVVBQT1JURUQ7CiAKLQlpZiAoIXNtdS0+ZnVuY3MtPmdldF9tYXhfc3VzdGFpbmFi
bGVfY2xvY2tzX2J5X2RjKHNtdSwgbWF4X2Nsb2NrcykpCisJaWYgKCFzbXVfZ2V0X21heF9zdXN0
YWluYWJsZV9jbG9ja3NfYnlfZGMoc211LCBtYXhfY2xvY2tzKSkKIAkJcmV0dXJuIFBQX1NNVV9S
RVNVTFRfT0s7CiAKIAlyZXR1cm4gUFBfU01VX1JFU1VMVF9GQUlMOwpAQCAtODk1LDcgKzg5NSw3
IEBAIGVudW0gcHBfc211X3N0YXR1cyBwcF9udl9nZXRfdWNsa19kcG1fc3RhdGVzKHN0cnVjdCBw
cF9zbXUgKnBwLAogCWlmICghc211LT5wcHRfZnVuY3MtPmdldF91Y2xrX2RwbV9zdGF0ZXMpCiAJ
CXJldHVybiBQUF9TTVVfUkVTVUxUX1VOU1VQUE9SVEVEOwogCi0JaWYgKCFzbXUtPnBwdF9mdW5j
cy0+Z2V0X3VjbGtfZHBtX3N0YXRlcyhzbXUsCisJaWYgKCFzbXVfZ2V0X3VjbGtfZHBtX3N0YXRl
cyhzbXUsCiAJCQljbG9ja192YWx1ZXNfaW5fa2h6LCBudW1fc3RhdGVzKSkKIAkJcmV0dXJuIFBQ
X1NNVV9SRVNVTFRfT0s7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJw
bGF5L2FtZGdwdV9zbXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2FtZGdwdV9z
bXUuYwppbmRleCAyNmNhY2M4OTlkZmUuLmRhM2ViOGU0NzEyYiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvcG93ZXJwbGF5L2FtZGdwdV9zbXUuYwpAQCAtNjcsNiArNjcsOCBAQCBzaXplX3Qgc211
X3N5c19nZXRfcHBfZmVhdHVyZV9tYXNrKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBjaGFyICpi
dWYpCiAJdWludDMyX3Qgc29ydF9mZWF0dXJlW1NNVV9GRUFUVVJFX0NPVU5UXTsKIAl1aW50NjRf
dCBod19mZWF0dXJlX2NvdW50ID0gMDsKIAorCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCiAJ
cmV0ID0gc211X2ZlYXR1cmVfZ2V0X2VuYWJsZWRfbWFzayhzbXUsIGZlYXR1cmVfbWFzaywgMik7
CiAJaWYgKHJldCkKIAkJZ290byBmYWlsZWQ7CkBAIC05Miw2ICs5NCw4IEBAIHNpemVfdCBzbXVf
c3lzX2dldF9wcF9mZWF0dXJlX21hc2soc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGNoYXIgKmJ1
ZikKIAl9CiAKIGZhaWxlZDoKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCiAJcmV0dXJu
IHNpemU7CiB9CiAKQEAgLTE0OSw5ICsxNTMsMTEgQEAgaW50IHNtdV9zeXNfc2V0X3BwX2ZlYXR1
cmVfbWFzayhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgdWludDY0X3QgbmV3X21hc2spCiAJdWlu
dDY0X3QgZmVhdHVyZV8yX2Rpc2FibGVkID0gMDsKIAl1aW50NjRfdCBmZWF0dXJlX2VuYWJsZXMg
PSAwOwogCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKIAlyZXQgPSBzbXVfZmVhdHVyZV9n
ZXRfZW5hYmxlZF9tYXNrKHNtdSwgZmVhdHVyZV9tYXNrLCAyKTsKIAlpZiAocmV0KQotCQlyZXR1
cm4gcmV0OworCQlnb3RvIG91dDsKIAogCWZlYXR1cmVfZW5hYmxlcyA9ICgodWludDY0X3QpZmVh
dHVyZV9tYXNrWzFdIDw8IDMyIHwgKHVpbnQ2NF90KWZlYXR1cmVfbWFza1swXSk7CiAKQEAgLTE2
MSwxNCArMTY3LDE3IEBAIGludCBzbXVfc3lzX3NldF9wcF9mZWF0dXJlX21hc2soc3RydWN0IHNt
dV9jb250ZXh0ICpzbXUsIHVpbnQ2NF90IG5ld19tYXNrKQogCWlmIChmZWF0dXJlXzJfZW5hYmxl
ZCkgewogCQlyZXQgPSBzbXVfZmVhdHVyZV91cGRhdGVfZW5hYmxlX3N0YXRlKHNtdSwgZmVhdHVy
ZV8yX2VuYWJsZWQsIHRydWUpOwogCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKKwkJCWdvdG8g
b3V0OwogCX0KIAlpZiAoZmVhdHVyZV8yX2Rpc2FibGVkKSB7CiAJCXJldCA9IHNtdV9mZWF0dXJl
X3VwZGF0ZV9lbmFibGVfc3RhdGUoc211LCBmZWF0dXJlXzJfZGlzYWJsZWQsIGZhbHNlKTsKIAkJ
aWYgKHJldCkKLQkJCXJldHVybiByZXQ7CisJCQlnb3RvIG91dDsKIAl9CiAKK291dDoKKwltdXRl
eF91bmxvY2soJnNtdS0+bXV0ZXgpOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMjU0LDcgKzI2
Myw3IEBAIGludCBzbXVfc2V0X2hhcmRfZnJlcV9yYW5nZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNt
dSwgZW51bSBzbXVfY2xrX3R5cGUgY2xrX3R5cGUsCiB9CiAKIGludCBzbXVfZ2V0X2RwbV9mcmVx
X3JhbmdlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlw
ZSwKLQkJCSAgIHVpbnQzMl90ICptaW4sIHVpbnQzMl90ICptYXgpCisJCQkgICB1aW50MzJfdCAq
bWluLCB1aW50MzJfdCAqbWF4LCBib29sIGxvY2tfbmVlZGVkKQogewogCXVpbnQzMl90IGNsb2Nr
X2xpbWl0OwogCWludCByZXQgPSAwOwpAQCAtMjg4LDExICsyOTcsMTkgQEAgaW50IHNtdV9nZXRf
ZHBtX2ZyZXFfcmFuZ2Uoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGVudW0gc211X2Nsa190eXBl
IGNsa190eXBlLAogCiAJCXJldHVybiAwOwogCX0KKworCWlmIChsb2NrX25lZWRlZCkKKwkJbXV0
ZXhfbG9jaygmc211LT5tdXRleCk7CisKIAkvKgogCSAqIFRvZG86IFVzZSBlYWNoIGFzaWMoQVNJ
Q19wcHQgZnVuY3MpIGNvbnRyb2wgdGhlIGNhbGxiYWNrcyBleHBvc2VkIHRvIHRoZQogCSAqIGNv
cmUgZHJpdmVyIGFuZCB0aGVuIGhhdmUgaGVscGVycyBmb3Igc3R1ZmYgdGhhdCBpcyBjb21tb24o
U01VX3YxMV94IHwgU01VX3YxMl94IGZ1bmNzKS4KIAkgKi8KIAlyZXQgPSBzbXVfZ2V0X2RwbV91
bHRpbWF0ZV9mcmVxKHNtdSwgY2xrX3R5cGUsIG1pbiwgbWF4KTsKKworCWlmIChsb2NrX25lZWRl
ZCkKKwkJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKwogCXJldHVybiByZXQ7CiB9CiAKQEAg
LTM2OSw2ICszODYsOCBAQCBpbnQgc211X2RwbV9zZXRfcG93ZXJfZ2F0ZShzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwgdWludDMyX3QgYmxvY2tfdHlwZSwKIHsKIAlpbnQgcmV0ID0gMDsKIAorCW11
dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCiAJc3dpdGNoIChibG9ja190eXBlKSB7CiAJY2FzZSBB
TURfSVBfQkxPQ0tfVFlQRV9VVkQ6CiAJCXJldCA9IHNtdV9kcG1fc2V0X3V2ZF9lbmFibGUoc211
LCBnYXRlKTsKQEAgLTM4NiwxMyArNDA1LDkgQEAgaW50IHNtdV9kcG1fc2V0X3Bvd2VyX2dhdGUo
c3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQzMl90IGJsb2NrX3R5cGUsCiAJCWJyZWFrOwog
CX0KIAotCXJldHVybiByZXQ7Ci19CisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKIAotZW51
bSBhbWRfcG1fc3RhdGVfdHlwZSBzbXVfZ2V0X2N1cnJlbnRfcG93ZXJfc3RhdGUoc3RydWN0IHNt
dV9jb250ZXh0ICpzbXUpCi17Ci0JLyogbm90IHN1cHBvcnQgcG93ZXIgc3RhdGUgKi8KLQlyZXR1
cm4gUE9XRVJfU1RBVEVfVFlQRV9ERUZBVUxUOworCXJldHVybiByZXQ7CiB9CiAKIGludCBzbXVf
Z2V0X3Bvd2VyX251bV9zdGF0ZXMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCkBAIC01MjAsMTYg
KzUzNSwyMyBAQCBib29sIGlzX3N1cHBvcnRfc3dfc211X3hnbWkoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYpCiBpbnQgc211X3N5c19nZXRfcHBfdGFibGUoc3RydWN0IHNtdV9jb250ZXh0ICpz
bXUsIHZvaWQgKip0YWJsZSkKIHsKIAlzdHJ1Y3Qgc211X3RhYmxlX2NvbnRleHQgKnNtdV90YWJs
ZSA9ICZzbXUtPnNtdV90YWJsZTsKKwl1aW50MzJfdCBwb3dlcnBsYXlfdGFibGVfc2l6ZTsKIAog
CWlmICghc211X3RhYmxlLT5wb3dlcl9wbGF5X3RhYmxlICYmICFzbXVfdGFibGUtPmhhcmRjb2Rl
X3BwdGFibGUpCiAJCXJldHVybiAtRUlOVkFMOwogCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7
CisKIAlpZiAoc211X3RhYmxlLT5oYXJkY29kZV9wcHRhYmxlKQogCQkqdGFibGUgPSBzbXVfdGFi
bGUtPmhhcmRjb2RlX3BwdGFibGU7CiAJZWxzZQogCQkqdGFibGUgPSBzbXVfdGFibGUtPnBvd2Vy
X3BsYXlfdGFibGU7CiAKLQlyZXR1cm4gc211X3RhYmxlLT5wb3dlcl9wbGF5X3RhYmxlX3NpemU7
CisJcG93ZXJwbGF5X3RhYmxlX3NpemUgPSBzbXVfdGFibGUtPnBvd2VyX3BsYXlfdGFibGVfc2l6
ZTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcG93ZXJwbGF5X3Rh
YmxlX3NpemU7CiB9CiAKIGludCBzbXVfc3lzX3NldF9wcF90YWJsZShzdHJ1Y3Qgc211X2NvbnRl
eHQgKnNtdSwgIHZvaWQgKmJ1Ziwgc2l6ZV90IHNpemUpCkBAIC01NTYsMTIgKzU3OCwxMyBAQCBp
bnQgc211X3N5c19zZXRfcHBfdGFibGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsICB2b2lkICpi
dWYsIHNpemVfdCBzaXplKQogCW1lbWNweShzbXVfdGFibGUtPmhhcmRjb2RlX3BwdGFibGUsIGJ1
Ziwgc2l6ZSk7CiAJc211X3RhYmxlLT5wb3dlcl9wbGF5X3RhYmxlID0gc211X3RhYmxlLT5oYXJk
Y29kZV9wcHRhYmxlOwogCXNtdV90YWJsZS0+cG93ZXJfcGxheV90YWJsZV9zaXplID0gc2l6ZTsK
LQltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOwogCiAJcmV0ID0gc211X3Jlc2V0KHNtdSk7CiAJ
aWYgKHJldCkKIAkJcHJfaW5mbygic211IHJlc2V0IGZhaWxlZCwgcmV0ID0gJWRcbiIsIHJldCk7
CiAKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCiAJcmV0dXJuIHJldDsKIAogZmFpbGVk
OgpAQCAtNzI2LDExICs3NDksMTAgQEAgc3RhdGljIGludCBzbXVfbGF0ZV9pbml0KHZvaWQgKmhh
bmRsZSkKIAlpZiAoIXNtdS0+cG1fZW5hYmxlZCkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2Nr
KCZzbXUtPm11dGV4KTsKIAlzbXVfaGFuZGxlX3Rhc2soJmFkZXYtPnNtdSwKIAkJCXNtdS0+c211
X2RwbS5kcG1fbGV2ZWwsCi0JCQlBTURfUFBfVEFTS19DT01QTEVURV9JTklUKTsKLQltdXRleF91
bmxvY2soJnNtdS0+bXV0ZXgpOworCQkJQU1EX1BQX1RBU0tfQ09NUExFVEVfSU5JVCwKKwkJCWZh
bHNlKTsKIAogCXJldHVybiAwOwogfQpAQCAtMTA3NCw3ICsxMDk2LDcgQEAgc3RhdGljIGludCBz
bXVfc21jX3RhYmxlX2h3X2luaXQoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJCWlmIChyZXQp
CiAJCQlyZXR1cm4gcmV0OwogCi0JCXJldCA9IHNtdV9nZXRfcG93ZXJfbGltaXQoc211LCAmc211
LT5kZWZhdWx0X3Bvd2VyX2xpbWl0LCB0cnVlKTsKKwkJcmV0ID0gc211X2dldF9wb3dlcl9saW1p
dChzbXUsICZzbXUtPmRlZmF1bHRfcG93ZXJfbGltaXQsIHRydWUsIGZhbHNlKTsKIAkJaWYgKHJl
dCkKIAkJCXJldHVybiByZXQ7CiAJfQpAQCAtMTE2MCwxNSArMTE4MiwxOSBAQCBzdGF0aWMgaW50
IHNtdV9zdGFydF9zbWNfZW5naW5lKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQogCiAJaWYgKGFk
ZXYtPmZpcm13YXJlLmxvYWRfdHlwZSAhPSBBTURHUFVfRldfTE9BRF9QU1ApIHsKIAkJaWYgKGFk
ZXYtPmFzaWNfdHlwZSA8IENISVBfTkFWSTEwKSB7Ci0JCQlyZXQgPSBzbXVfbG9hZF9taWNyb2Nv
ZGUoc211KTsKLQkJCWlmIChyZXQpCi0JCQkJcmV0dXJuIHJldDsKKwkJCWlmIChzbXUtPmZ1bmNz
LT5sb2FkX21pY3JvY29kZSkgeworCQkJCXJldCA9IHNtdS0+ZnVuY3MtPmxvYWRfbWljcm9jb2Rl
KHNtdSk7CisJCQkJaWYgKHJldCkKKwkJCQkJcmV0dXJuIHJldDsKKwkJCX0KIAkJfQogCX0KIAot
CXJldCA9IHNtdV9jaGVja19md19zdGF0dXMoc211KTsKLQlpZiAocmV0KQotCQlwcl9lcnIoIlNN
QyBpcyBub3QgcmVhZHlcbiIpOworCWlmIChzbXUtPmZ1bmNzLT5jaGVja19md19zdGF0dXMpIHsK
KwkJcmV0ID0gc211LT5mdW5jcy0+Y2hlY2tfZndfc3RhdHVzKHNtdSk7CisJCWlmIChyZXQpCisJ
CQlwcl9lcnIoIlNNQyBpcyBub3QgcmVhZHlcbiIpOworCX0KIAogCXJldHVybiByZXQ7CiB9CkBA
IC0xMzM0LDggKzEzNjAsNiBAQCBzdGF0aWMgaW50IHNtdV9yZXN1bWUodm9pZCAqaGFuZGxlKQog
CiAJcHJfaW5mbygiU01VIGlzIHJlc3VtaW5nLi4uXG4iKTsKIAotCW11dGV4X2xvY2soJnNtdS0+
bXV0ZXgpOwotCiAJcmV0ID0gc211X3N0YXJ0X3NtY19lbmdpbmUoc211KTsKIAlpZiAocmV0KSB7
CiAJCXByX2VycigiU01VIGlzIG5vdCByZWFkeSB5ZXQhXG4iKTsKQEAgLTEzNTAsMTMgKzEzNzQs
MTEgQEAgc3RhdGljIGludCBzbXVfcmVzdW1lKHZvaWQgKmhhbmRsZSkKIAlpZiAocmV0KQogCQln
b3RvIGZhaWxlZDsKIAotCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7Ci0KIAlwcl9pbmZvKCJT
TVUgaXMgcmVzdW1lZCBzdWNjZXNzZnVsbHkhXG4iKTsKIAogCXJldHVybiAwOworCiBmYWlsZWQ6
Ci0JbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0xMzc0
LDggKzEzOTYsOSBAQCBpbnQgc211X2Rpc3BsYXlfY29uZmlndXJhdGlvbl9jaGFuZ2Uoc3RydWN0
IHNtdV9jb250ZXh0ICpzbXUsCiAKIAltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKIAotCXNtdV9z
ZXRfZGVlcF9zbGVlcF9kY2VmY2xrKHNtdSwKLQkJCQkgICBkaXNwbGF5X2NvbmZpZy0+bWluX2Rj
ZWZfZGVlcF9zbGVlcF9zZXRfY2xrIC8gMTAwKTsKKwlpZiAoc211LT5mdW5jcy0+c2V0X2RlZXBf
c2xlZXBfZGNlZmNsaykKKwkJc211LT5mdW5jcy0+c2V0X2RlZXBfc2xlZXBfZGNlZmNsayhzbXUs
CisJCQkJZGlzcGxheV9jb25maWctPm1pbl9kY2VmX2RlZXBfc2xlZXBfc2V0X2NsayAvIDEwMCk7
CiAKIAlmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBkaXNwbGF5X2NvbmZpZy0+bnVtX3BhdGhfaW5j
bHVkaW5nX25vbl9kaXNwbGF5OyBpbmRleCsrKSB7CiAJCWlmIChkaXNwbGF5X2NvbmZpZy0+ZGlz
cGxheXNbaW5kZXhdLmNvbnRyb2xsZXJfaWQgIT0gMCkKQEAgLTE1NTMsOSArMTU3Niw5IEBAIHN0
YXRpYyBpbnQgc211X2RlZmF1bHRfc2V0X3BlcmZvcm1hbmNlX2xldmVsKHN0cnVjdCBzbXVfY29u
dGV4dCAqc211LCBlbnVtIGFtZF9kCiAJCQkJCQkgJnNvY19tYXNrKTsKIAkJaWYgKHJldCkKIAkJ
CXJldHVybiByZXQ7Ci0JCXNtdV9mb3JjZV9jbGtfbGV2ZWxzKHNtdSwgU01VX1NDTEssIDEgPDwg
c2Nsa19tYXNrKTsKLQkJc211X2ZvcmNlX2Nsa19sZXZlbHMoc211LCBTTVVfTUNMSywgMSA8PCBt
Y2xrX21hc2spOwotCQlzbXVfZm9yY2VfY2xrX2xldmVscyhzbXUsIFNNVV9TT0NDTEssIDEgPDwg
c29jX21hc2spOworCQlzbXVfZm9yY2VfY2xrX2xldmVscyhzbXUsIFNNVV9TQ0xLLCAxIDw8IHNj
bGtfbWFzaywgZmFsc2UpOworCQlzbXVfZm9yY2VfY2xrX2xldmVscyhzbXUsIFNNVV9NQ0xLLCAx
IDw8IG1jbGtfbWFzaywgZmFsc2UpOworCQlzbXVfZm9yY2VfY2xrX2xldmVscyhzbXUsIFNNVV9T
T0NDTEssIDEgPDwgc29jX21hc2ssIGZhbHNlKTsKIAkJYnJlYWs7CiAJY2FzZSBBTURfRFBNX0ZP
UkNFRF9MRVZFTF9NQU5VQUw6CiAJY2FzZSBBTURfRFBNX0ZPUkNFRF9MRVZFTF9QUk9GSUxFX0VY
SVQ6CkBAIC0xNjE5LDcgKzE2NDIsNyBAQCBpbnQgc211X2FkanVzdF9wb3dlcl9zdGF0ZV9keW5h
bWljKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCQl3b3JrbG9hZCA9IHNtdS0+d29ya2xvYWRf
c2V0dGluZ1tpbmRleF07CiAKIAkJaWYgKHNtdS0+cG93ZXJfcHJvZmlsZV9tb2RlICE9IHdvcmts
b2FkKQotCQkJc211X3NldF9wb3dlcl9wcm9maWxlX21vZGUoc211LCAmd29ya2xvYWQsIDApOwor
CQkJc211X3NldF9wb3dlcl9wcm9maWxlX21vZGUoc211LCAmd29ya2xvYWQsIDAsIGZhbHNlKTsK
IAl9CiAKIAlyZXR1cm4gcmV0OwpAQCAtMTYyNywxOCArMTY1MCwyMiBAQCBpbnQgc211X2FkanVz
dF9wb3dlcl9zdGF0ZV9keW5hbWljKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCiBpbnQgc211
X2hhbmRsZV90YXNrKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCQkgICAgZW51bSBhbWRfZHBt
X2ZvcmNlZF9sZXZlbCBsZXZlbCwKLQkJICAgIGVudW0gYW1kX3BwX3Rhc2sgdGFza19pZCkKKwkJ
ICAgIGVudW0gYW1kX3BwX3Rhc2sgdGFza19pZCwKKwkJICAgIGJvb2wgbG9ja19uZWVkZWQpCiB7
CiAJaW50IHJldCA9IDA7CiAKKwlpZiAobG9ja19uZWVkZWQpCisJCW11dGV4X2xvY2soJnNtdS0+
bXV0ZXgpOworCiAJc3dpdGNoICh0YXNrX2lkKSB7CiAJY2FzZSBBTURfUFBfVEFTS19ESVNQTEFZ
X0NPTkZJR19DSEFOR0U6CiAJCXJldCA9IHNtdV9wcmVfZGlzcGxheV9jb25maWdfY2hhbmdlZChz
bXUpOwogCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKKwkJCWdvdG8gb3V0OwogCQlyZXQgPSBz
bXVfc2V0X2NwdV9wb3dlcl9zdGF0ZShzbXUpOwogCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsK
KwkJCWdvdG8gb3V0OwogCQlyZXQgPSBzbXVfYWRqdXN0X3Bvd2VyX3N0YXRlX2R5bmFtaWMoc211
LCBsZXZlbCwgZmFsc2UpOwogCQlicmVhazsKIAljYXNlIEFNRF9QUF9UQVNLX0NPTVBMRVRFX0lO
SVQ6CkBAIC0xNjQ5LDYgKzE2NzYsMTAgQEAgaW50IHNtdV9oYW5kbGVfdGFzayhzdHJ1Y3Qgc211
X2NvbnRleHQgKnNtdSwKIAkJYnJlYWs7CiAJfQogCitvdXQ6CisJaWYgKGxvY2tfbmVlZGVkKQor
CQltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTY4
MSw3ICsxNzEyLDcgQEAgaW50IHNtdV9zd2l0Y2hfcG93ZXJfcHJvZmlsZShzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwKIAl9CiAKIAlpZiAoc211X2RwbV9jdHgtPmRwbV9sZXZlbCAhPSBBTURfRFBN
X0ZPUkNFRF9MRVZFTF9NQU5VQUwpCi0JCXNtdV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHNtdSwg
Jndvcmtsb2FkLCAwKTsKKwkJc211X3NldF9wb3dlcl9wcm9maWxlX21vZGUoc211LCAmd29ya2xv
YWQsIDAsIGZhbHNlKTsKIAogCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CiAKQEAgLTE3MTEs
MTIgKzE3NDIsMTkgQEAgaW50IHNtdV9mb3JjZV9wZXJmb3JtYW5jZV9sZXZlbChzdHJ1Y3Qgc211
X2NvbnRleHQgKnNtdSwgZW51bSBhbWRfZHBtX2ZvcmNlZF9sZXYKIAlpZiAoIXNtdS0+aXNfYXB1
ICYmICFzbXVfZHBtX2N0eC0+ZHBtX2NvbnRleHQpCiAJCXJldHVybiAtRUlOVkFMOwogCisJbXV0
ZXhfbG9jaygmc211LT5tdXRleCk7CisKIAlyZXQgPSBzbXVfZW5hYmxlX3VtZF9wc3RhdGUoc211
LCAmbGV2ZWwpOwotCWlmIChyZXQpCisJaWYgKHJldCkgeworCQltdXRleF91bmxvY2soJnNtdS0+
bXV0ZXgpOwogCQlyZXR1cm4gcmV0OworCX0KIAogCXJldCA9IHNtdV9oYW5kbGVfdGFzayhzbXUs
IGxldmVsLAotCQkJICAgICAgQU1EX1BQX1RBU0tfUkVBREpVU1RfUE9XRVJfU1RBVEUpOworCQkJ
ICAgICAgQU1EX1BQX1RBU0tfUkVBREpVU1RfUE9XRVJfU1RBVEUsCisJCQkgICAgICBmYWxzZSk7
CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTE3
MzQsNyArMTc3Miw4IEBAIGludCBzbXVfc2V0X2Rpc3BsYXlfY291bnQoc3RydWN0IHNtdV9jb250
ZXh0ICpzbXUsIHVpbnQzMl90IGNvdW50KQogCiBpbnQgc211X2ZvcmNlX2Nsa19sZXZlbHMoc3Ry
dWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJCQkgZW51bSBzbXVfY2xrX3R5cGUgY2xrX3R5cGUsCi0J
CQkgdWludDMyX3QgbWFzaykKKwkJCSB1aW50MzJfdCBtYXNrLAorCQkJIGJvb2wgbG9ja19uZWVk
ZWQpCiB7CiAJc3RydWN0IHNtdV9kcG1fY29udGV4dCAqc211X2RwbV9jdHggPSAmKHNtdS0+c211
X2RwbSk7CiAJaW50IHJldCA9IDA7CkBAIC0xNzQ0LDkgKzE3ODMsMTUgQEAgaW50IHNtdV9mb3Jj
ZV9jbGtfbGV2ZWxzKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCQlyZXR1cm4gLUVJTlZBTDsK
IAl9CiAKKwlpZiAobG9ja19uZWVkZWQpCisJCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCiAJ
aWYgKHNtdS0+cHB0X2Z1bmNzICYmIHNtdS0+cHB0X2Z1bmNzLT5mb3JjZV9jbGtfbGV2ZWxzKQog
CQlyZXQgPSBzbXUtPnBwdF9mdW5jcy0+Zm9yY2VfY2xrX2xldmVscyhzbXUsIGNsa190eXBlLCBt
YXNrKTsKIAorCWlmIChsb2NrX25lZWRlZCkKKwkJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsK
KwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTE3NjQsNiArMTgwOSw4IEBAIGludCBzbXVfc2V0X21w
MV9zdGF0ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAlpZiAoIXNtdS0+cG1fZW5hYmxlZCkK
IAkJcmV0dXJuIDA7CiAKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKwogCXN3aXRjaCAobXAx
X3N0YXRlKSB7CiAJY2FzZSBQUF9NUDFfU1RBVEVfU0hVVERPV046CiAJCW1zZyA9IFNNVV9NU0df
UHJlcGFyZU1wMUZvclNodXRkb3duOwpAQCAtMTc3NiwxNyArMTgyMywyMiBAQCBpbnQgc211X3Nl
dF9tcDFfc3RhdGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJCWJyZWFrOwogCWNhc2UgUFBf
TVAxX1NUQVRFX05PTkU6CiAJZGVmYXVsdDoKKwkJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsK
IAkJcmV0dXJuIDA7CiAJfQogCiAJLyogc29tZSBhc2ljcyBtYXkgbm90IHN1cHBvcnQgdGhvc2Ug
bWVzc2FnZXMgKi8KLQlpZiAoc211X21zZ19nZXRfaW5kZXgoc211LCBtc2cpIDwgMCkKKwlpZiAo
c211X21zZ19nZXRfaW5kZXgoc211LCBtc2cpIDwgMCkgeworCQltdXRleF91bmxvY2soJnNtdS0+
bXV0ZXgpOwogCQlyZXR1cm4gMDsKKwl9CiAKIAlyZXQgPSBzbXVfc2VuZF9zbWNfbXNnKHNtdSwg
bXNnKTsKIAlpZiAocmV0KQogCQlwcl9lcnIoIltQcmVwYXJlTXAxXSBGYWlsZWQhXG4iKTsKIAor
CW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0xODA2
LDEwICsxODU4LDE0IEBAIGludCBzbXVfc2V0X2RmX2NzdGF0ZShzdHJ1Y3Qgc211X2NvbnRleHQg
KnNtdSwKIAlpZiAoIXNtdS0+cHB0X2Z1bmNzIHx8ICFzbXUtPnBwdF9mdW5jcy0+c2V0X2RmX2Nz
dGF0ZSkKIAkJcmV0dXJuIDA7CiAKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKwogCXJldCA9
IHNtdS0+cHB0X2Z1bmNzLT5zZXRfZGZfY3N0YXRlKHNtdSwgc3RhdGUpOwogCWlmIChyZXQpCiAJ
CXByX2VycigiW1NldERmQ3N0YXRlXSBmYWlsZWQhXG4iKTsKIAorCW11dGV4X3VubG9jaygmc211
LT5tdXRleCk7CisKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0xODQ5LDMgKzE5MDUsNTQ5IEBAIGNv
bnN0IHN0cnVjdCBhbWRncHVfaXBfYmxvY2tfdmVyc2lvbiBzbXVfdjEyXzBfaXBfYmxvY2sgPQog
CS5yZXYgPSAwLAogCS5mdW5jcyA9ICZzbXVfaXBfZnVuY3MsCiB9OworCitpbnQgc211X2xvYWRf
bWljcm9jb2RlKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQoreworCWludCByZXQgPSAwOworCisJ
bXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5mdW5jcy0+bG9hZF9taWNyb2Nv
ZGUpCisJCXJldCA9IHNtdS0+ZnVuY3MtPmxvYWRfbWljcm9jb2RlKHNtdSk7CisKKwltdXRleF91
bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9jaGVja19m
d19zdGF0dXMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCit7CisJaW50IHJldCA9IDA7CisKKwlt
dXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5jaGVja19md19zdGF0
dXMpCisJCXJldCA9IHNtdS0+ZnVuY3MtPmNoZWNrX2Z3X3N0YXR1cyhzbXUpOworCisJbXV0ZXhf
dW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfc2V0X2dm
eF9jZ3BnKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBib29sIGVuYWJsZWQpCit7CisJaW50IHJl
dCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5z
ZXRfZ2Z4X2NncGcpCisJCXJldCA9IHNtdS0+ZnVuY3MtPnNldF9nZnhfY2dwZyhzbXUsIGVuYWJs
ZWQpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisK
K2ludCBzbXVfc2V0X2Zhbl9zcGVlZF9ycG0oc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQz
Ml90IHNwZWVkKQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7
CisKKwlpZiAoc211LT5mdW5jcy0+c2V0X2Zhbl9zcGVlZF9ycG0pCisJCXJldCA9IHNtdS0+ZnVu
Y3MtPnNldF9mYW5fc3BlZWRfcnBtKHNtdSwgc3BlZWQpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUt
Pm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfZ2V0X3Bvd2VyX2xpbWl0KHN0
cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJdWludDMyX3QgKmxpbWl0LAorCQkJYm9vbCBkZWYs
CisJCQlib29sIGxvY2tfbmVlZGVkKQoreworCWludCByZXQgPSAwOworCisJaWYgKGxvY2tfbmVl
ZGVkKQorCQltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+
Z2V0X3Bvd2VyX2xpbWl0KQorCQlyZXQgPSBzbXUtPnBwdF9mdW5jcy0+Z2V0X3Bvd2VyX2xpbWl0
KHNtdSwgbGltaXQsIGRlZik7CisKKwlpZiAobG9ja19uZWVkZWQpCisJCW11dGV4X3VubG9jaygm
c211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X3NldF9wb3dlcl9saW1p
dChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgdWludDMyX3QgbGltaXQpCit7CisJaW50IHJldCA9
IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5zZXRf
cG93ZXJfbGltaXQpCisJCXJldCA9IHNtdS0+ZnVuY3MtPnNldF9wb3dlcl9saW1pdChzbXUsIGxp
bWl0KTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQor
CitpbnQgc211X3ByaW50X2Nsa19sZXZlbHMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGVudW0g
c211X2Nsa190eXBlIGNsa190eXBlLCBjaGFyICpidWYpCit7CisJaW50IHJldCA9IDA7CisKKwlt
dXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+cHJpbnRfY2xr
X2xldmVscykKKwkJcmV0ID0gc211LT5wcHRfZnVuY3MtPnByaW50X2Nsa19sZXZlbHMoc211LCBj
bGtfdHlwZSwgYnVmKTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4g
cmV0OworfQorCitpbnQgc211X2dldF9vZF9wZXJjZW50YWdlKHN0cnVjdCBzbXVfY29udGV4dCAq
c211LCBlbnVtIHNtdV9jbGtfdHlwZSB0eXBlKQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhf
bG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5wcHRfZnVuY3MtPmdldF9vZF9wZXJjZW50
YWdlKQorCQlyZXQgPSBzbXUtPnBwdF9mdW5jcy0+Z2V0X29kX3BlcmNlbnRhZ2Uoc211LCB0eXBl
KTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitp
bnQgc211X3NldF9vZF9wZXJjZW50YWdlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNt
dV9jbGtfdHlwZSB0eXBlLCB1aW50MzJfdCB2YWx1ZSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11
dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+cHB0X2Z1bmNzLT5zZXRfb2RfcGVy
Y2VudGFnZSkKKwkJcmV0ID0gc211LT5wcHRfZnVuY3MtPnNldF9vZF9wZXJjZW50YWdlKHNtdSwg
dHlwZSwgdmFsdWUpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiBy
ZXQ7Cit9CisKK2ludCBzbXVfb2RfZWRpdF9kcG1fdGFibGUoc3RydWN0IHNtdV9jb250ZXh0ICpz
bXUsCisJCQkgIGVudW0gUFBfT0RfRFBNX1RBQkxFX0NPTU1BTkQgdHlwZSwKKwkJCSAgbG9uZyAq
aW5wdXQsIHVpbnQzMl90IHNpemUpCit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZz
bXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+b2RfZWRpdF9kcG1fdGFibGUpCisJ
CXJldCA9IHNtdS0+cHB0X2Z1bmNzLT5vZF9lZGl0X2RwbV90YWJsZShzbXUsIHR5cGUsIGlucHV0
LCBzaXplKTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0Owor
fQorCitpbnQgc211X3JlYWRfc2Vuc29yKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkgICAg
ZW51bSBhbWRfcHBfc2Vuc29ycyBzZW5zb3IsCisJCSAgICB2b2lkICpkYXRhLCB1aW50MzJfdCAq
c2l6ZSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJ
aWYgKHNtdS0+cHB0X2Z1bmNzLT5yZWFkX3NlbnNvcikKKwkJcmV0ID0gc211LT5wcHRfZnVuY3Mt
PnJlYWRfc2Vuc29yKHNtdSwgc2Vuc29yLCBkYXRhLCBzaXplKTsKKworCW11dGV4X3VubG9jaygm
c211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X2dldF9wb3dlcl9wcm9m
aWxlX21vZGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGNoYXIgKmJ1ZikKK3sKKwlpbnQgcmV0
ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+cHB0X2Z1bmNz
LT5nZXRfcG93ZXJfcHJvZmlsZV9tb2RlKQorCQlyZXQgPSBzbXUtPnBwdF9mdW5jcy0+Z2V0X3Bv
d2VyX3Byb2ZpbGVfbW9kZShzbXUsIGJ1Zik7CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgp
OworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHN0
cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJICAgICAgIGxvbmcgKnBhcmFtLAorCQkJICAgICAg
IHVpbnQzMl90IHBhcmFtX3NpemUsCisJCQkgICAgICAgYm9vbCBsb2NrX25lZWRlZCkKK3sKKwlp
bnQgcmV0ID0gMDsKKworCWlmIChsb2NrX25lZWRlZCkKKwkJbXV0ZXhfbG9jaygmc211LT5tdXRl
eCk7CisKKwlpZiAoc211LT5wcHRfZnVuY3MtPnNldF9wb3dlcl9wcm9maWxlX21vZGUpCisJCXJl
dCA9IHNtdS0+cHB0X2Z1bmNzLT5zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHNtdSwgcGFyYW0sIHBh
cmFtX3NpemUpOworCisJaWYgKGxvY2tfbmVlZGVkKQorCQltdXRleF91bmxvY2soJnNtdS0+bXV0
ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworCitpbnQgc211X2dldF9mYW5fY29udHJvbF9tb2Rl
KHN0cnVjdCBzbXVfY29udGV4dCAqc211KQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9j
aygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5mdW5jcy0+Z2V0X2Zhbl9jb250cm9sX21vZGUp
CisJCXJldCA9IHNtdS0+ZnVuY3MtPmdldF9mYW5fY29udHJvbF9tb2RlKHNtdSk7CisKKwltdXRl
eF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9zZXRf
ZmFuX2NvbnRyb2xfbW9kZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgaW50IHZhbHVlKQorewor
CWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5m
dW5jcy0+c2V0X2Zhbl9jb250cm9sX21vZGUpCisJCXJldCA9IHNtdS0+ZnVuY3MtPnNldF9mYW5f
Y29udHJvbF9tb2RlKHNtdSwgdmFsdWUpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsK
KworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfZ2V0X2Zhbl9zcGVlZF9wZXJjZW50KHN0cnVj
dCBzbXVfY29udGV4dCAqc211LCB1aW50MzJfdCAqc3BlZWQpCit7CisJaW50IHJldCA9IDA7CisK
KwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+Z2V0X2Zh
bl9zcGVlZF9wZXJjZW50KQorCQlyZXQgPSBzbXUtPnBwdF9mdW5jcy0+Z2V0X2Zhbl9zcGVlZF9w
ZXJjZW50KHNtdSwgc3BlZWQpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJl
dHVybiByZXQ7Cit9CisKK2ludCBzbXVfc2V0X2Zhbl9zcGVlZF9wZXJjZW50KHN0cnVjdCBzbXVf
Y29udGV4dCAqc211LCB1aW50MzJfdCBzcGVlZCkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4
X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPnNldF9mYW5fc3BlZWRfcGVy
Y2VudCkKKwkJcmV0ID0gc211LT5mdW5jcy0+c2V0X2Zhbl9zcGVlZF9wZXJjZW50KHNtdSwgc3Bl
ZWQpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisK
K2ludCBzbXVfZ2V0X2Zhbl9zcGVlZF9ycG0oc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQz
Ml90ICpzcGVlZCkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgp
OworCisJaWYgKHNtdS0+cHB0X2Z1bmNzLT5nZXRfZmFuX3NwZWVkX3JwbSkKKwkJcmV0ID0gc211
LT5wcHRfZnVuY3MtPmdldF9mYW5fc3BlZWRfcnBtKHNtdSwgc3BlZWQpOworCisJbXV0ZXhfdW5s
b2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfc2V0X2RlZXBf
c2xlZXBfZGNlZmNsayhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgaW50IGNsaykKK3sKKwlpbnQg
cmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3Mt
PnNldF9kZWVwX3NsZWVwX2RjZWZjbGspCisJCXJldCA9IHNtdS0+ZnVuY3MtPnNldF9kZWVwX3Ns
ZWVwX2RjZWZjbGsoc211LCBjbGspOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKwor
CXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfc2V0X2FjdGl2ZV9kaXNwbGF5X2NvdW50KHN0cnVj
dCBzbXVfY29udGV4dCAqc211LCB1aW50MzJfdCBjb3VudCkKK3sKKwlpbnQgcmV0ID0gMDsKKwor
CW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPnNldF9hY3RpdmVf
ZGlzcGxheV9jb3VudCkKKwkJcmV0ID0gc211LT5mdW5jcy0+c2V0X2FjdGl2ZV9kaXNwbGF5X2Nv
dW50KHNtdSwgY291bnQpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVy
biByZXQ7Cit9CisKK2ludCBzbXVfZ2V0X2Nsb2NrX2J5X3R5cGUoc3RydWN0IHNtdV9jb250ZXh0
ICpzbXUsCisJCQkgIGVudW0gYW1kX3BwX2Nsb2NrX3R5cGUgdHlwZSwKKwkJCSAgc3RydWN0IGFt
ZF9wcF9jbG9ja3MgKmNsb2NrcykKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNt
dS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPmdldF9jbG9ja19ieV90eXBlKQorCQlyZXQg
PSBzbXUtPmZ1bmNzLT5nZXRfY2xvY2tfYnlfdHlwZShzbXUsIHR5cGUsIGNsb2Nrcyk7CisKKwlt
dXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9n
ZXRfbWF4X2hpZ2hfY2xvY2tzKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJICAgIHN0cnVj
dCBhbWRfcHBfc2ltcGxlX2Nsb2NrX2luZm8gKmNsb2NrcykKK3sKKwlpbnQgcmV0ID0gMDsKKwor
CW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPmdldF9tYXhfaGln
aF9jbG9ja3MpCisJCXJldCA9IHNtdS0+ZnVuY3MtPmdldF9tYXhfaGlnaF9jbG9ja3Moc211LCBj
bG9ja3MpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9
CisKK2ludCBzbXVfZ2V0X2Nsb2NrX2J5X3R5cGVfd2l0aF9sYXRlbmN5KHN0cnVjdCBzbXVfY29u
dGV4dCAqc211LAorCQkJCSAgICAgICBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlwZSwKKwkJCQkg
ICAgICAgc3RydWN0IHBwX2Nsb2NrX2xldmVsc193aXRoX2xhdGVuY3kgKmNsb2NrcykKK3sKKwlp
bnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+cHB0
X2Z1bmNzLT5nZXRfY2xvY2tfYnlfdHlwZV93aXRoX2xhdGVuY3kpCisJCXJldCA9IHNtdS0+cHB0
X2Z1bmNzLT5nZXRfY2xvY2tfYnlfdHlwZV93aXRoX2xhdGVuY3koc211LCBjbGtfdHlwZSwgY2xv
Y2tzKTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQor
CitpbnQgc211X2dldF9jbG9ja19ieV90eXBlX3dpdGhfdm9sdGFnZShzdHJ1Y3Qgc211X2NvbnRl
eHQgKnNtdSwKKwkJCQkgICAgICAgZW51bSBhbWRfcHBfY2xvY2tfdHlwZSB0eXBlLAorCQkJCSAg
ICAgICBzdHJ1Y3QgcHBfY2xvY2tfbGV2ZWxzX3dpdGhfdm9sdGFnZSAqY2xvY2tzKQoreworCWlu
dCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5wcHRf
ZnVuY3MtPmdldF9jbG9ja19ieV90eXBlX3dpdGhfdm9sdGFnZSkKKwkJcmV0ID0gc211LT5wcHRf
ZnVuY3MtPmdldF9jbG9ja19ieV90eXBlX3dpdGhfdm9sdGFnZShzbXUsIHR5cGUsIGNsb2Nrcyk7
CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworCitp
bnQgc211X2Rpc3BsYXlfY2xvY2tfdm9sdGFnZV9yZXF1ZXN0KHN0cnVjdCBzbXVfY29udGV4dCAq
c211LAorCQkJCSAgICAgIHN0cnVjdCBwcF9kaXNwbGF5X2Nsb2NrX3JlcXVlc3QgKmNsb2NrX3Jl
cSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYg
KHNtdS0+ZnVuY3MtPmRpc3BsYXlfY2xvY2tfdm9sdGFnZV9yZXF1ZXN0KQorCQlyZXQgPSBzbXUt
PmZ1bmNzLT5kaXNwbGF5X2Nsb2NrX3ZvbHRhZ2VfcmVxdWVzdChzbXUsIGNsb2NrX3JlcSk7CisK
KwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworCitpbnQg
c211X2Rpc3BsYXlfZGlzYWJsZV9tZW1vcnlfY2xvY2tfc3dpdGNoKHN0cnVjdCBzbXVfY29udGV4
dCAqc211LCBib29sIGRpc2FibGVfbWVtb3J5X2Nsb2NrX3N3aXRjaCkKK3sKKwlpbnQgcmV0ID0g
LUVJTlZBTDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+cHB0X2Z1
bmNzLT5kaXNwbGF5X2Rpc2FibGVfbWVtb3J5X2Nsb2NrX3N3aXRjaCkKKwkJcmV0ID0gc211LT5w
cHRfZnVuY3MtPmRpc3BsYXlfZGlzYWJsZV9tZW1vcnlfY2xvY2tfc3dpdGNoKHNtdSwgZGlzYWJs
ZV9tZW1vcnlfY2xvY2tfc3dpdGNoKTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisK
KwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X25vdGlmeV9zbXVfZW5hYmxlX3B3ZShzdHJ1Y3Qg
c211X2NvbnRleHQgKnNtdSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+
bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPm5vdGlmeV9zbXVfZW5hYmxlX3B3ZSkKKwkJcmV0
ID0gc211LT5mdW5jcy0+bm90aWZ5X3NtdV9lbmFibGVfcHdlKHNtdSk7CisKKwltdXRleF91bmxv
Y2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9zZXRfd2F0ZXJt
YXJrc19mb3JfY2xvY2tfcmFuZ2VzKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJCQlzdHJ1
Y3QgZG1fcHBfd21fc2V0c193aXRoX2Nsb2NrX3Jhbmdlc19zb2MxNSAqY2xvY2tfcmFuZ2VzKQor
eworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211
LT5mdW5jcy0+c2V0X3dhdGVybWFya3NfZm9yX2Nsb2NrX3JhbmdlcykKKwkJcmV0ID0gc211LT5m
dW5jcy0+c2V0X3dhdGVybWFya3NfZm9yX2Nsb2NrX3JhbmdlcyhzbXUsIGNsb2NrX3Jhbmdlcyk7
CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50
IHNtdV9zZXRfeGdtaV9wc3RhdGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCisJCQl1aW50MzJf
dCBwc3RhdGUpCit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsK
KworCWlmIChzbXUtPmZ1bmNzLT5zZXRfeGdtaV9wc3RhdGUpCisJCXJldCA9IHNtdS0+ZnVuY3Mt
PnNldF94Z21pX3BzdGF0ZShzbXUsIHBzdGF0ZSk7CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0
ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9zZXRfYXphbGlhX2QzX3BtZShzdHJ1
Y3Qgc211X2NvbnRleHQgKnNtdSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNt
dS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPnNldF9hemFsaWFfZDNfcG1lKQorCQlyZXQg
PSBzbXUtPmZ1bmNzLT5zZXRfYXphbGlhX2QzX3BtZShzbXUpOworCisJbXV0ZXhfdW5sb2NrKCZz
bXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKK2Jvb2wgc211X2JhY29faXNfc3VwcG9y
dChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKK3sKKwlib29sIHJldCA9IGZhbHNlOworCisJbXV0
ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5mdW5jcy0+YmFjb19pc19zdXBwb3J0
KQorCQlyZXQgPSBzbXUtPmZ1bmNzLT5iYWNvX2lzX3N1cHBvcnQoc211KTsKKworCW11dGV4X3Vu
bG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X2JhY29fZ2V0
X3N0YXRlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9iYWNvX3N0YXRlICpzdGF0
ZSkKK3sKKwlpZiAoc211LT5mdW5jcy0+YmFjb19nZXRfc3RhdGUpCisJCXJldHVybiAtRUlOVkFM
OworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisJKnN0YXRlID0gc211LT5mdW5jcy0+YmFj
b19nZXRfc3RhdGUoc211KTsKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJu
IDA7Cit9CisKK2ludCBzbXVfYmFjb19yZXNldChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKK3sK
KwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+
ZnVuY3MtPmJhY29fcmVzZXQpCisJCXJldCA9IHNtdS0+ZnVuY3MtPmJhY29fcmVzZXQoc211KTsK
KworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQg
c211X21vZGUyX3Jlc2V0KHN0cnVjdCBzbXVfY29udGV4dCAqc211KQoreworCWludCByZXQgPSAw
OworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5mdW5jcy0+bW9kZTJf
cmVzZXQpCisJCXJldCA9IHNtdS0+ZnVuY3MtPm1vZGUyX3Jlc2V0KHNtdSk7CisKKwltdXRleF91
bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9nZXRfbWF4
X3N1c3RhaW5hYmxlX2Nsb2Nrc19ieV9kYyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKKwkJCQkJ
IHN0cnVjdCBwcF9zbXVfbnZfY2xvY2tfdGFibGUgKm1heF9jbG9ja3MpCit7CisJaW50IHJldCA9
IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5nZXRf
bWF4X3N1c3RhaW5hYmxlX2Nsb2Nrc19ieV9kYykKKwkJcmV0ID0gc211LT5mdW5jcy0+Z2V0X21h
eF9zdXN0YWluYWJsZV9jbG9ja3NfYnlfZGMoc211LCBtYXhfY2xvY2tzKTsKKworCW11dGV4X3Vu
bG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X2dldF91Y2xr
X2RwbV9zdGF0ZXMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCisJCQkgICAgdW5zaWduZWQgaW50
ICpjbG9ja192YWx1ZXNfaW5fa2h6LAorCQkJICAgIHVuc2lnbmVkIGludCAqbnVtX3N0YXRlcykK
K3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNt
dS0+cHB0X2Z1bmNzLT5nZXRfdWNsa19kcG1fc3RhdGVzKQorCQlyZXQgPSBzbXUtPnBwdF9mdW5j
cy0+Z2V0X3VjbGtfZHBtX3N0YXRlcyhzbXUsIGNsb2NrX3ZhbHVlc19pbl9raHosIG51bV9zdGF0
ZXMpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisK
K2VudW0gYW1kX3BtX3N0YXRlX3R5cGUgc211X2dldF9jdXJyZW50X3Bvd2VyX3N0YXRlKHN0cnVj
dCBzbXVfY29udGV4dCAqc211KQoreworCWVudW0gYW1kX3BtX3N0YXRlX3R5cGUgcG1fc3RhdGUg
PSBQT1dFUl9TVEFURV9UWVBFX0RFRkFVTFQ7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsK
KworCWlmIChzbXUtPnBwdF9mdW5jcy0+Z2V0X2N1cnJlbnRfcG93ZXJfc3RhdGUpCisJCXBtX3N0
YXRlID0gc211LT5wcHRfZnVuY3MtPmdldF9jdXJyZW50X3Bvd2VyX3N0YXRlKHNtdSk7CisKKwlt
dXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHBtX3N0YXRlOworfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvaW5jL2FtZGdwdV9zbXUuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2luYy9hbWRncHVfc211LmgKaW5kZXggY2RiODQ1
ZjVmMjNlLi4zZTM0NjRmYTJmZjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93
ZXJwbGF5L2luYy9hbWRncHVfc211LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBs
YXkvaW5jL2FtZGdwdV9zbXUuaApAQCAtNTY1LDE4ICs1NjUsMTcgQEAgc3RydWN0IHNtdV9mdW5j
cwogCSgoc211KS0+ZnVuY3MtPmluaXRfcG93ZXIgPyAoc211KS0+ZnVuY3MtPmluaXRfcG93ZXIo
KHNtdSkpIDogMCkKICNkZWZpbmUgc211X2ZpbmlfcG93ZXIoc211KSBcCiAJKChzbXUpLT5mdW5j
cy0+ZmluaV9wb3dlciA/IChzbXUpLT5mdW5jcy0+ZmluaV9wb3dlcigoc211KSkgOiAwKQotI2Rl
ZmluZSBzbXVfbG9hZF9taWNyb2NvZGUoc211KSBcCi0JKChzbXUpLT5mdW5jcy0+bG9hZF9taWNy
b2NvZGUgPyAoc211KS0+ZnVuY3MtPmxvYWRfbWljcm9jb2RlKChzbXUpKSA6IDApCi0jZGVmaW5l
IHNtdV9jaGVja19md19zdGF0dXMoc211KSBcCi0JKChzbXUpLT5mdW5jcy0+Y2hlY2tfZndfc3Rh
dHVzID8gKHNtdSktPmZ1bmNzLT5jaGVja19md19zdGF0dXMoKHNtdSkpIDogMCkKK2ludCBzbXVf
bG9hZF9taWNyb2NvZGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpOworCitpbnQgc211X2NoZWNr
X2Z3X3N0YXR1cyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSk7CisKICNkZWZpbmUgc211X3NldHVw
X3BwdGFibGUoc211KSBcCiAJKChzbXUpLT5mdW5jcy0+c2V0dXBfcHB0YWJsZSA/IChzbXUpLT5m
dW5jcy0+c2V0dXBfcHB0YWJsZSgoc211KSkgOiAwKQogI2RlZmluZSBzbXVfcG93ZXJnYXRlX3Nk
bWEoc211LCBnYXRlKSBcCiAJKChzbXUpLT5mdW5jcy0+cG93ZXJnYXRlX3NkbWEgPyAoc211KS0+
ZnVuY3MtPnBvd2VyZ2F0ZV9zZG1hKChzbXUpLCAoZ2F0ZSkpIDogMCkKICNkZWZpbmUgc211X3Bv
d2VyZ2F0ZV92Y24oc211LCBnYXRlKSBcCiAJKChzbXUpLT5mdW5jcy0+cG93ZXJnYXRlX3ZjbiA/
IChzbXUpLT5mdW5jcy0+cG93ZXJnYXRlX3Zjbigoc211KSwgKGdhdGUpKSA6IDApCi0jZGVmaW5l
IHNtdV9zZXRfZ2Z4X2NncGcoc211LCBlbmFibGVkKSBcCi0JKChzbXUpLT5mdW5jcy0+c2V0X2dm
eF9jZ3BnID8gKHNtdSktPmZ1bmNzLT5zZXRfZ2Z4X2NncGcoKHNtdSksIChlbmFibGVkKSkgOiAw
KQoraW50IHNtdV9zZXRfZ2Z4X2NncGcoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGJvb2wgZW5h
YmxlZCk7CiAjZGVmaW5lIHNtdV9nZXRfdmJpb3NfYm9vdHVwX3ZhbHVlcyhzbXUpIFwKIAkoKHNt
dSktPmZ1bmNzLT5nZXRfdmJpb3NfYm9vdHVwX3ZhbHVlcyA/IChzbXUpLT5mdW5jcy0+Z2V0X3Zi
aW9zX2Jvb3R1cF92YWx1ZXMoKHNtdSkpIDogMCkKICNkZWZpbmUgc211X2dldF9jbGtfaW5mb19m
cm9tX3ZiaW9zKHNtdSkgXApAQCAtNjEwLDggKzYwOSw4IEBAIHN0cnVjdCBzbXVfZnVuY3MKIAko
KHNtdSktPmZ1bmNzLT5pbml0X21heF9zdXN0YWluYWJsZV9jbG9ja3MgPyAoc211KS0+ZnVuY3Mt
PmluaXRfbWF4X3N1c3RhaW5hYmxlX2Nsb2Nrcygoc211KSkgOiAwKQogI2RlZmluZSBzbXVfc2V0
X2RlZmF1bHRfb2Rfc2V0dGluZ3Moc211LCBpbml0aWFsaXplKSBcCiAJKChzbXUpLT5wcHRfZnVu
Y3MtPnNldF9kZWZhdWx0X29kX3NldHRpbmdzID8gKHNtdSktPnBwdF9mdW5jcy0+c2V0X2RlZmF1
bHRfb2Rfc2V0dGluZ3MoKHNtdSksIChpbml0aWFsaXplKSkgOiAwKQotI2RlZmluZSBzbXVfc2V0
X2Zhbl9zcGVlZF9ycG0oc211LCBzcGVlZCkgXAotCSgoc211KS0+ZnVuY3MtPnNldF9mYW5fc3Bl
ZWRfcnBtID8gKHNtdSktPmZ1bmNzLT5zZXRfZmFuX3NwZWVkX3JwbSgoc211KSwgKHNwZWVkKSkg
OiAwKQoraW50IHNtdV9zZXRfZmFuX3NwZWVkX3JwbShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwg
dWludDMyX3Qgc3BlZWQpOworCiAjZGVmaW5lIHNtdV9zZW5kX3NtY19tc2coc211LCBtc2cpIFwK
IAkoKHNtdSktPmZ1bmNzLT5zZW5kX3NtY19tc2c/IChzbXUpLT5mdW5jcy0+c2VuZF9zbWNfbXNn
KChzbXUpLCAobXNnKSkgOiAwKQogI2RlZmluZSBzbXVfc2VuZF9zbWNfbXNnX3dpdGhfcGFyYW0o
c211LCBtc2csIHBhcmFtKSBcCkBAIC02NDIsMjAgKzY0MSwyMiBAQCBzdHJ1Y3Qgc211X2Z1bmNz
CiAJKChzbXUpLT5wcHRfZnVuY3MtPnBvcHVsYXRlX3VtZF9zdGF0ZV9jbGsgPyAoc211KS0+cHB0
X2Z1bmNzLT5wb3B1bGF0ZV91bWRfc3RhdGVfY2xrKChzbXUpKSA6IDApCiAjZGVmaW5lIHNtdV9z
ZXRfZGVmYXVsdF9vZDhfc2V0dGluZ3Moc211KSBcCiAJKChzbXUpLT5wcHRfZnVuY3MtPnNldF9k
ZWZhdWx0X29kOF9zZXR0aW5ncyA/IChzbXUpLT5wcHRfZnVuY3MtPnNldF9kZWZhdWx0X29kOF9z
ZXR0aW5ncygoc211KSkgOiAwKQotI2RlZmluZSBzbXVfZ2V0X3Bvd2VyX2xpbWl0KHNtdSwgbGlt
aXQsIGRlZikgXAotCSgoc211KS0+cHB0X2Z1bmNzLT5nZXRfcG93ZXJfbGltaXQgPyAoc211KS0+
cHB0X2Z1bmNzLT5nZXRfcG93ZXJfbGltaXQoKHNtdSksIChsaW1pdCksIChkZWYpKSA6IDApCi0j
ZGVmaW5lIHNtdV9zZXRfcG93ZXJfbGltaXQoc211LCBsaW1pdCkgXAotCSgoc211KS0+ZnVuY3Mt
PnNldF9wb3dlcl9saW1pdCA/IChzbXUpLT5mdW5jcy0+c2V0X3Bvd2VyX2xpbWl0KChzbXUpLCAo
bGltaXQpKSA6IDApCisKK2ludCBzbXVfZ2V0X3Bvd2VyX2xpbWl0KHN0cnVjdCBzbXVfY29udGV4
dCAqc211LAorCQkJdWludDMyX3QgKmxpbWl0LAorCQkJYm9vbCBkZWYsCisJCQlib29sIGxvY2tf
bmVlZGVkKTsKKworaW50IHNtdV9zZXRfcG93ZXJfbGltaXQoc3RydWN0IHNtdV9jb250ZXh0ICpz
bXUsIHVpbnQzMl90IGxpbWl0KTsKICNkZWZpbmUgc211X2dldF9jdXJyZW50X2Nsa19mcmVxKHNt
dSwgY2xrX2lkLCB2YWx1ZSkgXAogCSgoc211KS0+ZnVuY3MtPmdldF9jdXJyZW50X2Nsa19mcmVx
PyAoc211KS0+ZnVuY3MtPmdldF9jdXJyZW50X2Nsa19mcmVxKChzbXUpLCAoY2xrX2lkKSwgKHZh
bHVlKSkgOiAwKQotI2RlZmluZSBzbXVfcHJpbnRfY2xrX2xldmVscyhzbXUsIGNsa190eXBlLCBi
dWYpIFwKLQkoKHNtdSktPnBwdF9mdW5jcy0+cHJpbnRfY2xrX2xldmVscyA/IChzbXUpLT5wcHRf
ZnVuY3MtPnByaW50X2Nsa19sZXZlbHMoKHNtdSksIChjbGtfdHlwZSksIChidWYpKSA6IDApCi0j
ZGVmaW5lIHNtdV9nZXRfb2RfcGVyY2VudGFnZShzbXUsIHR5cGUpIFwKLQkoKHNtdSktPnBwdF9m
dW5jcy0+Z2V0X29kX3BlcmNlbnRhZ2UgPyAoc211KS0+cHB0X2Z1bmNzLT5nZXRfb2RfcGVyY2Vu
dGFnZSgoc211KSwgKHR5cGUpKSA6IDApCi0jZGVmaW5lIHNtdV9zZXRfb2RfcGVyY2VudGFnZShz
bXUsIHR5cGUsIHZhbHVlKSBcCi0JKChzbXUpLT5wcHRfZnVuY3MtPnNldF9vZF9wZXJjZW50YWdl
ID8gKHNtdSktPnBwdF9mdW5jcy0+c2V0X29kX3BlcmNlbnRhZ2UoKHNtdSksICh0eXBlKSwgKHZh
bHVlKSkgOiAwKQotI2RlZmluZSBzbXVfb2RfZWRpdF9kcG1fdGFibGUoc211LCB0eXBlLCBpbnB1
dCwgc2l6ZSkgXAotCSgoc211KS0+cHB0X2Z1bmNzLT5vZF9lZGl0X2RwbV90YWJsZSA/IChzbXUp
LT5wcHRfZnVuY3MtPm9kX2VkaXRfZHBtX3RhYmxlKChzbXUpLCAodHlwZSksIChpbnB1dCksIChz
aXplKSkgOiAwKQoraW50IHNtdV9wcmludF9jbGtfbGV2ZWxzKHN0cnVjdCBzbXVfY29udGV4dCAq
c211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlwZSwgY2hhciAqYnVmKTsKK2ludCBzbXVfZ2V0
X29kX3BlcmNlbnRhZ2Uoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGVudW0gc211X2Nsa190eXBl
IHR5cGUpOworaW50IHNtdV9zZXRfb2RfcGVyY2VudGFnZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNt
dSwgZW51bSBzbXVfY2xrX3R5cGUgdHlwZSwgdWludDMyX3QgdmFsdWUpOworCitpbnQgc211X29k
X2VkaXRfZHBtX3RhYmxlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJICBlbnVtIFBQX09E
X0RQTV9UQUJMRV9DT01NQU5EIHR5cGUsCisJCQkgIGxvbmcgKmlucHV0LCB1aW50MzJfdCBzaXpl
KTsKICNkZWZpbmUgc211X3RhYmxlc19pbml0KHNtdSwgdGFiKSBcCiAJKChzbXUpLT5wcHRfZnVu
Y3MtPnRhYmxlc19pbml0ID8gKHNtdSktPnBwdF9mdW5jcy0+dGFibGVzX2luaXQoKHNtdSksICh0
YWIpKSA6IDApCiAjZGVmaW5lIHNtdV9zZXRfdGhlcm1hbF9mYW5fdGFibGUoc211KSBcCkBAIC02
NjQsMTQgKzY2NSwxOCBAQCBzdHJ1Y3Qgc211X2Z1bmNzCiAJKChzbXUpLT5mdW5jcy0+c3RhcnRf
dGhlcm1hbF9jb250cm9sPyAoc211KS0+ZnVuY3MtPnN0YXJ0X3RoZXJtYWxfY29udHJvbCgoc211
KSkgOiAwKQogI2RlZmluZSBzbXVfc3RvcF90aGVybWFsX2NvbnRyb2woc211KSBcCiAJKChzbXUp
LT5mdW5jcy0+c3RvcF90aGVybWFsX2NvbnRyb2w/IChzbXUpLT5mdW5jcy0+c3RvcF90aGVybWFs
X2NvbnRyb2woKHNtdSkpIDogMCkKLSNkZWZpbmUgc211X3JlYWRfc2Vuc29yKHNtdSwgc2Vuc29y
LCBkYXRhLCBzaXplKSBcCi0JKChzbXUpLT5wcHRfZnVuY3MtPnJlYWRfc2Vuc29yPyAoc211KS0+
cHB0X2Z1bmNzLT5yZWFkX3NlbnNvcigoc211KSwgKHNlbnNvciksIChkYXRhKSwgKHNpemUpKSA6
IDApCisKK2ludCBzbXVfcmVhZF9zZW5zb3Ioc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCisJCSAg
ICBlbnVtIGFtZF9wcF9zZW5zb3JzIHNlbnNvciwKKwkJICAgIHZvaWQgKmRhdGEsIHVpbnQzMl90
ICpzaXplKTsKICNkZWZpbmUgc211X3NtY19yZWFkX3NlbnNvcihzbXUsIHNlbnNvciwgZGF0YSwg
c2l6ZSkgXAogCSgoc211KS0+ZnVuY3MtPnJlYWRfc2Vuc29yPyAoc211KS0+ZnVuY3MtPnJlYWRf
c2Vuc29yKChzbXUpLCAoc2Vuc29yKSwgKGRhdGEpLCAoc2l6ZSkpIDogLUVJTlZBTCkKLSNkZWZp
bmUgc211X2dldF9wb3dlcl9wcm9maWxlX21vZGUoc211LCBidWYpIFwKLQkoKHNtdSktPnBwdF9m
dW5jcy0+Z2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZSA/IChzbXUpLT5wcHRfZnVuY3MtPmdldF9wb3dl
cl9wcm9maWxlX21vZGUoKHNtdSksIGJ1ZikgOiAwKQotI2RlZmluZSBzbXVfc2V0X3Bvd2VyX3By
b2ZpbGVfbW9kZShzbXUsIHBhcmFtLCBwYXJhbV9zaXplKSBcCi0JKChzbXUpLT5wcHRfZnVuY3Mt
PnNldF9wb3dlcl9wcm9maWxlX21vZGUgPyAoc211KS0+cHB0X2Z1bmNzLT5zZXRfcG93ZXJfcHJv
ZmlsZV9tb2RlKChzbXUpLCAocGFyYW0pLCAocGFyYW1fc2l6ZSkpIDogMCkKK2ludCBzbXVfZ2V0
X3Bvd2VyX3Byb2ZpbGVfbW9kZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgY2hhciAqYnVmKTsK
KworaW50IHNtdV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHN0cnVjdCBzbXVfY29udGV4dCAqc211
LAorCQkJICAgICAgIGxvbmcgKnBhcmFtLAorCQkJICAgICAgIHVpbnQzMl90IHBhcmFtX3NpemUs
CisJCQkgICAgICAgYm9vbCBsb2NrX25lZWRlZCk7CiAjZGVmaW5lIHNtdV9wcmVfZGlzcGxheV9j
b25maWdfY2hhbmdlZChzbXUpIFwKIAkoKHNtdSktPnBwdF9mdW5jcy0+cHJlX2Rpc3BsYXlfY29u
ZmlnX2NoYW5nZWQgPyAoc211KS0+cHB0X2Z1bmNzLT5wcmVfZGlzcGxheV9jb25maWdfY2hhbmdl
ZCgoc211KSkgOiAwKQogI2RlZmluZSBzbXVfZGlzcGxheV9jb25maWdfY2hhbmdlZChzbXUpIFwK
QEAgLTY4OCwxNiArNjkzLDExIEBAIHN0cnVjdCBzbXVfZnVuY3MKIAkoKHNtdSktPnBwdF9mdW5j
cy0+Z2V0X3Byb2ZpbGluZ19jbGtfbWFzayA/IChzbXUpLT5wcHRfZnVuY3MtPmdldF9wcm9maWxp
bmdfY2xrX21hc2soKHNtdSksIChsZXZlbCksIChzY2xrX21hc2spLCAobWNsa19tYXNrKSwgKHNv
Y19tYXNrKSkgOiAwKQogI2RlZmluZSBzbXVfc2V0X2NwdV9wb3dlcl9zdGF0ZShzbXUpIFwKIAko
KHNtdSktPnBwdF9mdW5jcy0+c2V0X2NwdV9wb3dlcl9zdGF0ZSA/IChzbXUpLT5wcHRfZnVuY3Mt
PnNldF9jcHVfcG93ZXJfc3RhdGUoKHNtdSkpIDogMCkKLSNkZWZpbmUgc211X2dldF9mYW5fY29u
dHJvbF9tb2RlKHNtdSkgXAotCSgoc211KS0+ZnVuY3MtPmdldF9mYW5fY29udHJvbF9tb2RlID8g
KHNtdSktPmZ1bmNzLT5nZXRfZmFuX2NvbnRyb2xfbW9kZSgoc211KSkgOiAwKQotI2RlZmluZSBz
bXVfc2V0X2Zhbl9jb250cm9sX21vZGUoc211LCB2YWx1ZSkgXAotCSgoc211KS0+ZnVuY3MtPnNl
dF9mYW5fY29udHJvbF9tb2RlID8gKHNtdSktPmZ1bmNzLT5zZXRfZmFuX2NvbnRyb2xfbW9kZSgo
c211KSwgKHZhbHVlKSkgOiAwKQotI2RlZmluZSBzbXVfZ2V0X2Zhbl9zcGVlZF9wZXJjZW50KHNt
dSwgc3BlZWQpIFwKLQkoKHNtdSktPnBwdF9mdW5jcy0+Z2V0X2Zhbl9zcGVlZF9wZXJjZW50ID8g
KHNtdSktPnBwdF9mdW5jcy0+Z2V0X2Zhbl9zcGVlZF9wZXJjZW50KChzbXUpLCAoc3BlZWQpKSA6
IDApCi0jZGVmaW5lIHNtdV9zZXRfZmFuX3NwZWVkX3BlcmNlbnQoc211LCBzcGVlZCkgXAotCSgo
c211KS0+ZnVuY3MtPnNldF9mYW5fc3BlZWRfcGVyY2VudCA/IChzbXUpLT5mdW5jcy0+c2V0X2Zh
bl9zcGVlZF9wZXJjZW50KChzbXUpLCAoc3BlZWQpKSA6IDApCi0jZGVmaW5lIHNtdV9nZXRfZmFu
X3NwZWVkX3JwbShzbXUsIHNwZWVkKSBcCi0JKChzbXUpLT5wcHRfZnVuY3MtPmdldF9mYW5fc3Bl
ZWRfcnBtID8gKHNtdSktPnBwdF9mdW5jcy0+Z2V0X2Zhbl9zcGVlZF9ycG0oKHNtdSksIChzcGVl
ZCkpIDogMCkKK2ludCBzbXVfZ2V0X2Zhbl9jb250cm9sX21vZGUoc3RydWN0IHNtdV9jb250ZXh0
ICpzbXUpOworaW50IHNtdV9zZXRfZmFuX2NvbnRyb2xfbW9kZShzdHJ1Y3Qgc211X2NvbnRleHQg
KnNtdSwgaW50IHZhbHVlKTsKK2ludCBzbXVfZ2V0X2Zhbl9zcGVlZF9wZXJjZW50KHN0cnVjdCBz
bXVfY29udGV4dCAqc211LCB1aW50MzJfdCAqc3BlZWQpOworaW50IHNtdV9zZXRfZmFuX3NwZWVk
X3BlcmNlbnQoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQzMl90IHNwZWVkKTsKK2ludCBz
bXVfZ2V0X2Zhbl9zcGVlZF9ycG0oc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQzMl90ICpz
cGVlZCk7CiAKICNkZWZpbmUgc211X21zZ19nZXRfaW5kZXgoc211LCBtc2cpIFwKIAkoKHNtdSkt
PnBwdF9mdW5jcz8gKChzbXUpLT5wcHRfZnVuY3MtPmdldF9zbXVfbXNnX2luZGV4PyAoc211KS0+
cHB0X2Z1bmNzLT5nZXRfc211X21zZ19pbmRleCgoc211KSwgKG1zZykpIDogLUVJTlZBTCkgOiAt
RUlOVkFMKQpAQCAtNzE1LDQwICs3MTUsNDYgQEAgc3RydWN0IHNtdV9mdW5jcwogCSgoc211KS0+
cHB0X2Z1bmNzPyAoKHNtdSktPnBwdF9mdW5jcy0+cnVuX2J0Yz8gKHNtdSktPnBwdF9mdW5jcy0+
cnVuX2J0Yygoc211KSkgOiAwKSA6IDApCiAjZGVmaW5lIHNtdV9nZXRfYWxsb3dlZF9mZWF0dXJl
X21hc2soc211LCBmZWF0dXJlX21hc2ssIG51bSkgXAogCSgoc211KS0+cHB0X2Z1bmNzPyAoKHNt
dSktPnBwdF9mdW5jcy0+Z2V0X2FsbG93ZWRfZmVhdHVyZV9tYXNrPyAoc211KS0+cHB0X2Z1bmNz
LT5nZXRfYWxsb3dlZF9mZWF0dXJlX21hc2soKHNtdSksIChmZWF0dXJlX21hc2spLCAobnVtKSkg
OiAwKSA6IDApCi0jZGVmaW5lIHNtdV9zZXRfZGVlcF9zbGVlcF9kY2VmY2xrKHNtdSwgY2xrKSBc
Ci0JKChzbXUpLT5mdW5jcy0+c2V0X2RlZXBfc2xlZXBfZGNlZmNsayA/IChzbXUpLT5mdW5jcy0+
c2V0X2RlZXBfc2xlZXBfZGNlZmNsaygoc211KSwgKGNsaykpIDogMCkKLSNkZWZpbmUgc211X3Nl
dF9hY3RpdmVfZGlzcGxheV9jb3VudChzbXUsIGNvdW50KSBcCi0JKChzbXUpLT5mdW5jcy0+c2V0
X2FjdGl2ZV9kaXNwbGF5X2NvdW50ID8gKHNtdSktPmZ1bmNzLT5zZXRfYWN0aXZlX2Rpc3BsYXlf
Y291bnQoKHNtdSksIChjb3VudCkpIDogMCkKK2ludCBzbXVfc2V0X2RlZXBfc2xlZXBfZGNlZmNs
ayhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgaW50IGNsayk7CitpbnQgc211X3NldF9hY3RpdmVf
ZGlzcGxheV9jb3VudChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgdWludDMyX3QgY291bnQpOwog
I2RlZmluZSBzbXVfc3RvcmVfY2M2X2RhdGEoc211LCBzdCwgY2M2X2RpcywgcHN0X2RpcywgcHN0
X3N3X2RpcykgXAogCSgoc211KS0+ZnVuY3MtPnN0b3JlX2NjNl9kYXRhID8gKHNtdSktPmZ1bmNz
LT5zdG9yZV9jYzZfZGF0YSgoc211KSwgKHN0KSwgKGNjNl9kaXMpLCAocHN0X2RpcyksIChwc3Rf
c3dfZGlzKSkgOiAwKQotI2RlZmluZSBzbXVfZ2V0X2Nsb2NrX2J5X3R5cGUoc211LCB0eXBlLCBj
bG9ja3MpIFwKLQkoKHNtdSktPmZ1bmNzLT5nZXRfY2xvY2tfYnlfdHlwZSA/IChzbXUpLT5mdW5j
cy0+Z2V0X2Nsb2NrX2J5X3R5cGUoKHNtdSksICh0eXBlKSwgKGNsb2NrcykpIDogMCkKLSNkZWZp
bmUgc211X2dldF9tYXhfaGlnaF9jbG9ja3Moc211LCBjbG9ja3MpIFwKLQkoKHNtdSktPmZ1bmNz
LT5nZXRfbWF4X2hpZ2hfY2xvY2tzID8gKHNtdSktPmZ1bmNzLT5nZXRfbWF4X2hpZ2hfY2xvY2tz
KChzbXUpLCAoY2xvY2tzKSkgOiAwKQotI2RlZmluZSBzbXVfZ2V0X2Nsb2NrX2J5X3R5cGVfd2l0
aF9sYXRlbmN5KHNtdSwgY2xrX3R5cGUsIGNsb2NrcykgXAotCSgoc211KS0+cHB0X2Z1bmNzLT5n
ZXRfY2xvY2tfYnlfdHlwZV93aXRoX2xhdGVuY3kgPyAoc211KS0+cHB0X2Z1bmNzLT5nZXRfY2xv
Y2tfYnlfdHlwZV93aXRoX2xhdGVuY3koKHNtdSksIChjbGtfdHlwZSksIChjbG9ja3MpKSA6IDAp
Ci0jZGVmaW5lIHNtdV9nZXRfY2xvY2tfYnlfdHlwZV93aXRoX3ZvbHRhZ2Uoc211LCB0eXBlLCBj
bG9ja3MpIFwKLQkoKHNtdSktPnBwdF9mdW5jcy0+Z2V0X2Nsb2NrX2J5X3R5cGVfd2l0aF92b2x0
YWdlID8gKHNtdSktPnBwdF9mdW5jcy0+Z2V0X2Nsb2NrX2J5X3R5cGVfd2l0aF92b2x0YWdlKChz
bXUpLCAodHlwZSksIChjbG9ja3MpKSA6IDApCi0jZGVmaW5lIHNtdV9kaXNwbGF5X2Nsb2NrX3Zv
bHRhZ2VfcmVxdWVzdChzbXUsIGNsb2NrX3JlcSkgXAotCSgoc211KS0+ZnVuY3MtPmRpc3BsYXlf
Y2xvY2tfdm9sdGFnZV9yZXF1ZXN0ID8gKHNtdSktPmZ1bmNzLT5kaXNwbGF5X2Nsb2NrX3ZvbHRh
Z2VfcmVxdWVzdCgoc211KSwgKGNsb2NrX3JlcSkpIDogMCkKLSNkZWZpbmUgc211X2Rpc3BsYXlf
ZGlzYWJsZV9tZW1vcnlfY2xvY2tfc3dpdGNoKHNtdSwgZGlzYWJsZV9tZW1vcnlfY2xvY2tfc3dp
dGNoKSBcCi0JKChzbXUpLT5wcHRfZnVuY3MtPmRpc3BsYXlfZGlzYWJsZV9tZW1vcnlfY2xvY2tf
c3dpdGNoID8gKHNtdSktPnBwdF9mdW5jcy0+ZGlzcGxheV9kaXNhYmxlX21lbW9yeV9jbG9ja19z
d2l0Y2goKHNtdSksIChkaXNhYmxlX21lbW9yeV9jbG9ja19zd2l0Y2gpKSA6IC1FSU5WQUwpCisK
K2ludCBzbXVfZ2V0X2Nsb2NrX2J5X3R5cGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCisJCQkg
IGVudW0gYW1kX3BwX2Nsb2NrX3R5cGUgdHlwZSwKKwkJCSAgc3RydWN0IGFtZF9wcF9jbG9ja3Mg
KmNsb2Nrcyk7CisKK2ludCBzbXVfZ2V0X21heF9oaWdoX2Nsb2NrcyhzdHJ1Y3Qgc211X2NvbnRl
eHQgKnNtdSwKKwkJCSAgICBzdHJ1Y3QgYW1kX3BwX3NpbXBsZV9jbG9ja19pbmZvICpjbG9ja3Mp
OworCitpbnQgc211X2dldF9jbG9ja19ieV90eXBlX3dpdGhfbGF0ZW5jeShzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwKKwkJCQkgICAgICAgZW51bSBzbXVfY2xrX3R5cGUgY2xrX3R5cGUsCisJCQkJ
ICAgICAgIHN0cnVjdCBwcF9jbG9ja19sZXZlbHNfd2l0aF9sYXRlbmN5ICpjbG9ja3MpOworCitp
bnQgc211X2dldF9jbG9ja19ieV90eXBlX3dpdGhfdm9sdGFnZShzdHJ1Y3Qgc211X2NvbnRleHQg
KnNtdSwKKwkJCQkgICAgICAgZW51bSBhbWRfcHBfY2xvY2tfdHlwZSB0eXBlLAorCQkJCSAgICAg
ICBzdHJ1Y3QgcHBfY2xvY2tfbGV2ZWxzX3dpdGhfdm9sdGFnZSAqY2xvY2tzKTsKKworaW50IHNt
dV9kaXNwbGF5X2Nsb2NrX3ZvbHRhZ2VfcmVxdWVzdChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwK
KwkJCQkgICAgICBzdHJ1Y3QgcHBfZGlzcGxheV9jbG9ja19yZXF1ZXN0ICpjbG9ja19yZXEpOwor
aW50IHNtdV9kaXNwbGF5X2Rpc2FibGVfbWVtb3J5X2Nsb2NrX3N3aXRjaChzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwgYm9vbCBkaXNhYmxlX21lbW9yeV9jbG9ja19zd2l0Y2gpOwogI2RlZmluZSBz
bXVfZ2V0X2RhbF9wb3dlcl9sZXZlbChzbXUsIGNsb2NrcykgXAogCSgoc211KS0+ZnVuY3MtPmdl
dF9kYWxfcG93ZXJfbGV2ZWwgPyAoc211KS0+ZnVuY3MtPmdldF9kYWxfcG93ZXJfbGV2ZWwoKHNt
dSksIChjbG9ja3MpKSA6IDApCiAjZGVmaW5lIHNtdV9nZXRfcGVyZl9sZXZlbChzbXUsIGRlc2ln
bmF0aW9uLCBsZXZlbCkgXAogCSgoc211KS0+ZnVuY3MtPmdldF9wZXJmX2xldmVsID8gKHNtdSkt
PmZ1bmNzLT5nZXRfcGVyZl9sZXZlbCgoc211KSwgKGRlc2lnbmF0aW9uKSwgKGxldmVsKSkgOiAw
KQogI2RlZmluZSBzbXVfZ2V0X2N1cnJlbnRfc2hhbGxvd19zbGVlcF9jbG9ja3Moc211LCBjbG9j
a3MpIFwKIAkoKHNtdSktPmZ1bmNzLT5nZXRfY3VycmVudF9zaGFsbG93X3NsZWVwX2Nsb2NrcyA/
IChzbXUpLT5mdW5jcy0+Z2V0X2N1cnJlbnRfc2hhbGxvd19zbGVlcF9jbG9ja3MoKHNtdSksIChj
bG9ja3MpKSA6IDApCi0jZGVmaW5lIHNtdV9ub3RpZnlfc211X2VuYWJsZV9wd2Uoc211KSBcCi0J
KChzbXUpLT5mdW5jcy0+bm90aWZ5X3NtdV9lbmFibGVfcHdlID8gKHNtdSktPmZ1bmNzLT5ub3Rp
Znlfc211X2VuYWJsZV9wd2UoKHNtdSkpIDogMCkKLSNkZWZpbmUgc211X3NldF93YXRlcm1hcmtz
X2Zvcl9jbG9ja19yYW5nZXMoc211LCBjbG9ja19yYW5nZXMpIFwKLQkoKHNtdSktPmZ1bmNzLT5z
ZXRfd2F0ZXJtYXJrc19mb3JfY2xvY2tfcmFuZ2VzID8gKHNtdSktPmZ1bmNzLT5zZXRfd2F0ZXJt
YXJrc19mb3JfY2xvY2tfcmFuZ2VzKChzbXUpLCAoY2xvY2tfcmFuZ2VzKSkgOiAwKQoraW50IHNt
dV9ub3RpZnlfc211X2VuYWJsZV9wd2Uoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpOworCitpbnQg
c211X3NldF93YXRlcm1hcmtzX2Zvcl9jbG9ja19yYW5nZXMoc3RydWN0IHNtdV9jb250ZXh0ICpz
bXUsCisJCQkJCXN0cnVjdCBkbV9wcF93bV9zZXRzX3dpdGhfY2xvY2tfcmFuZ2VzX3NvYzE1ICpj
bG9ja19yYW5nZXMpOwogI2RlZmluZSBzbXVfZHBtX3NldF91dmRfZW5hYmxlKHNtdSwgZW5hYmxl
KSBcCiAJKChzbXUpLT5wcHRfZnVuY3MtPmRwbV9zZXRfdXZkX2VuYWJsZSA/IChzbXUpLT5wcHRf
ZnVuY3MtPmRwbV9zZXRfdXZkX2VuYWJsZSgoc211KSwgKGVuYWJsZSkpIDogMCkKICNkZWZpbmUg
c211X2RwbV9zZXRfdmNlX2VuYWJsZShzbXUsIGVuYWJsZSkgXAogCSgoc211KS0+cHB0X2Z1bmNz
LT5kcG1fc2V0X3ZjZV9lbmFibGUgPyAoc211KS0+cHB0X2Z1bmNzLT5kcG1fc2V0X3ZjZV9lbmFi
bGUoKHNtdSksIChlbmFibGUpKSA6IDApCi0jZGVmaW5lIHNtdV9zZXRfeGdtaV9wc3RhdGUoc211
LCBwc3RhdGUpIFwKLQkJKChzbXUpLT5mdW5jcy0+c2V0X3hnbWlfcHN0YXRlID8gKHNtdSktPmZ1
bmNzLT5zZXRfeGdtaV9wc3RhdGUoKHNtdSksIChwc3RhdGUpKSA6IDApCisKK2ludCBzbXVfc2V0
X3hnbWlfcHN0YXRlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJdWludDMyX3QgcHN0YXRl
KTsKICNkZWZpbmUgc211X3NldF93YXRlcm1hcmtzX3RhYmxlKHNtdSwgdGFiLCBjbG9ja19yYW5n
ZXMpIFwKIAkoKHNtdSktPnBwdF9mdW5jcy0+c2V0X3dhdGVybWFya3NfdGFibGUgPyAoc211KS0+
cHB0X2Z1bmNzLT5zZXRfd2F0ZXJtYXJrc190YWJsZSgoc211KSwgKHRhYiksIChjbG9ja19yYW5n
ZXMpKSA6IDApCiAjZGVmaW5lIHNtdV9nZXRfY3VycmVudF9jbGtfZnJlcV9ieV90YWJsZShzbXUs
IGNsa190eXBlLCB2YWx1ZSkgXApAQCAtNzU5LDIyICs3NjUsMTggQEAgc3RydWN0IHNtdV9mdW5j
cwogCSgoc211KS0+cHB0X2Z1bmNzLT5nZXRfdGhlcm1hbF90ZW1wZXJhdHVyZV9yYW5nZT8gKHNt
dSktPnBwdF9mdW5jcy0+Z2V0X3RoZXJtYWxfdGVtcGVyYXR1cmVfcmFuZ2UoKHNtdSksIChyYW5n
ZSkpIDogMCkKICNkZWZpbmUgc211X3JlZ2lzdGVyX2lycV9oYW5kbGVyKHNtdSkgXAogCSgoc211
KS0+ZnVuY3MtPnJlZ2lzdGVyX2lycV9oYW5kbGVyID8gKHNtdSktPmZ1bmNzLT5yZWdpc3Rlcl9p
cnFfaGFuZGxlcihzbXUpIDogMCkKLSNkZWZpbmUgc211X3NldF9hemFsaWFfZDNfcG1lKHNtdSkg
XAotCSgoc211KS0+ZnVuY3MtPnNldF9hemFsaWFfZDNfcG1lID8gKHNtdSktPmZ1bmNzLT5zZXRf
YXphbGlhX2QzX3BtZSgoc211KSkgOiAwKQorCitpbnQgc211X3NldF9hemFsaWFfZDNfcG1lKHN0
cnVjdCBzbXVfY29udGV4dCAqc211KTsKICNkZWZpbmUgc211X2dldF9kcG1fdWx0aW1hdGVfZnJl
cShzbXUsIHBhcmFtLCBtaW4sIG1heCkgXAogCQkoKHNtdSktPmZ1bmNzLT5nZXRfZHBtX3VsdGlt
YXRlX2ZyZXEgPyAoc211KS0+ZnVuY3MtPmdldF9kcG1fdWx0aW1hdGVfZnJlcSgoc211KSwgKHBh
cmFtKSwgKG1pbiksIChtYXgpKSA6IDApCi0jZGVmaW5lIHNtdV9nZXRfdWNsa19kcG1fc3RhdGVz
KHNtdSwgY2xvY2tzX2luX2toeiwgbnVtX3N0YXRlcykgXAotCSgoc211KS0+cHB0X2Z1bmNzLT5n
ZXRfdWNsa19kcG1fc3RhdGVzID8gKHNtdSktPnBwdF9mdW5jcy0+Z2V0X3VjbGtfZHBtX3N0YXRl
cygoc211KSwgKGNsb2Nrc19pbl9raHopLCAobnVtX3N0YXRlcykpIDogMCkKLSNkZWZpbmUgc211
X2dldF9tYXhfc3VzdGFpbmFibGVfY2xvY2tzX2J5X2RjKHNtdSwgbWF4X2Nsb2NrcykgXAotCSgo
c211KS0+ZnVuY3MtPmdldF9tYXhfc3VzdGFpbmFibGVfY2xvY2tzX2J5X2RjID8gKHNtdSktPmZ1
bmNzLT5nZXRfbWF4X3N1c3RhaW5hYmxlX2Nsb2Nrc19ieV9kYygoc211KSwgKG1heF9jbG9ja3Mp
KSA6IDApCi0jZGVmaW5lIHNtdV9iYWNvX2lzX3N1cHBvcnQoc211KSBcCi0JKChzbXUpLT5mdW5j
cy0+YmFjb19pc19zdXBwb3J0PyAoc211KS0+ZnVuY3MtPmJhY29faXNfc3VwcG9ydCgoc211KSkg
OiBmYWxzZSkKLSNkZWZpbmUgc211X2JhY29fZ2V0X3N0YXRlKHNtdSwgc3RhdGUpIFwKLQkoKHNt
dSktPmZ1bmNzLT5iYWNvX2dldF9zdGF0ZT8gKHNtdSktPmZ1bmNzLT5iYWNvX2dldF9zdGF0ZSgo
c211KSwgKHN0YXRlKSkgOiAwKQotI2RlZmluZSBzbXVfYmFjb19yZXNldChzbXUpIFwKLQkoKHNt
dSktPmZ1bmNzLT5iYWNvX3Jlc2V0PyAoc211KS0+ZnVuY3MtPmJhY29fcmVzZXQoKHNtdSkpIDog
MCkKLSNkZWZpbmUgc211X21vZGUyX3Jlc2V0KHNtdSkgXAotCSgoc211KS0+ZnVuY3MtPm1vZGUy
X3Jlc2V0PyAoc211KS0+ZnVuY3MtPm1vZGUyX3Jlc2V0KChzbXUpKSA6IDApCisKK2Jvb2wgc211
X2JhY29faXNfc3VwcG9ydChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSk7CisKK2ludCBzbXVfYmFj
b19nZXRfc3RhdGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGVudW0gc211X2JhY29fc3RhdGUg
KnN0YXRlKTsKKworaW50IHNtdV9iYWNvX3Jlc2V0KHN0cnVjdCBzbXVfY29udGV4dCAqc211KTsK
KworaW50IHNtdV9tb2RlMl9yZXNldChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSk7CiAjZGVmaW5l
IHNtdV9hc2ljX3NldF9wZXJmb3JtYW5jZV9sZXZlbChzbXUsIGxldmVsKSBcCiAJKChzbXUpLT5w
cHRfZnVuY3MtPnNldF9wZXJmb3JtYW5jZV9sZXZlbD8gKHNtdSktPnBwdF9mdW5jcy0+c2V0X3Bl
cmZvcm1hbmNlX2xldmVsKChzbXUpLCAobGV2ZWwpKSA6IC1FSU5WQUwpOwogI2RlZmluZSBzbXVf
ZHVtcF9wcHRhYmxlKHNtdSkgXApAQCAtODMzLDcgKzgzNSw4IEBAIGV4dGVybiBpbnQgc211X2dl
dF9jdXJyZW50X2Nsb2NrcyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIGV4dGVybiBpbnQgc211
X2RwbV9zZXRfcG93ZXJfZ2F0ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSx1aW50MzJfdCBibG9j
a190eXBlLCBib29sIGdhdGUpOwogZXh0ZXJuIGludCBzbXVfaGFuZGxlX3Rhc2soc3RydWN0IHNt
dV9jb250ZXh0ICpzbXUsCiAJCQkgICBlbnVtIGFtZF9kcG1fZm9yY2VkX2xldmVsIGxldmVsLAot
CQkJICAgZW51bSBhbWRfcHBfdGFzayB0YXNrX2lkKTsKKwkJCSAgIGVudW0gYW1kX3BwX3Rhc2sg
dGFza19pZCwKKwkJCSAgIGJvb2wgbG9ja19uZWVkZWQpOwogaW50IHNtdV9zd2l0Y2hfcG93ZXJf
cHJvZmlsZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAkJCSAgICAgZW51bSBQUF9TTUNfUE9X
RVJfUFJPRklMRSB0eXBlLAogCQkJICAgICBib29sIGVuKTsKQEAgLTg0Myw3ICs4NDYsNyBAQCBp
bnQgc211X2dldF9kcG1fZnJlcV9ieV9pbmRleChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgZW51
bSBzbXVfY2xrX3R5cGUgY2xrX3R5cAogaW50IHNtdV9nZXRfZHBtX2xldmVsX2NvdW50KHN0cnVj
dCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlwZSwKIAkJCSAgICB1
aW50MzJfdCAqdmFsdWUpOwogaW50IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc3RydWN0IHNtdV9j
b250ZXh0ICpzbXUsIGVudW0gc211X2Nsa190eXBlIGNsa190eXBlLAotCQkJICAgdWludDMyX3Qg
Km1pbiwgdWludDMyX3QgKm1heCk7CisJCQkgICB1aW50MzJfdCAqbWluLCB1aW50MzJfdCAqbWF4
LCBib29sIGxvY2tfbmVlZGVkKTsKIGludCBzbXVfc2V0X3NvZnRfZnJlcV9yYW5nZShzdHJ1Y3Qg
c211X2NvbnRleHQgKnNtdSwgZW51bSBzbXVfY2xrX3R5cGUgY2xrX3R5cGUsCiAJCQkgICAgdWlu
dDMyX3QgbWluLCB1aW50MzJfdCBtYXgpOwogaW50IHNtdV9zZXRfaGFyZF9mcmVxX3JhbmdlKHN0
cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlwZSwKQEAgLTg1
OCwxMCArODYxLDIwIEBAIHNpemVfdCBzbXVfc3lzX2dldF9wcF9mZWF0dXJlX21hc2soc3RydWN0
IHNtdV9jb250ZXh0ICpzbXUsIGNoYXIgKmJ1Zik7CiBpbnQgc211X3N5c19zZXRfcHBfZmVhdHVy
ZV9tYXNrKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB1aW50NjRfdCBuZXdfbWFzayk7CiBpbnQg
c211X2ZvcmNlX2Nsa19sZXZlbHMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJCQkgZW51bSBz
bXVfY2xrX3R5cGUgY2xrX3R5cGUsCi0JCQkgdWludDMyX3QgbWFzayk7CisJCQkgdWludDMyX3Qg
bWFzaywKKwkJCSBib29sIGxvY2tfbmVlZGVkKTsKIGludCBzbXVfc2V0X21wMV9zdGF0ZShzdHJ1
Y3Qgc211X2NvbnRleHQgKnNtdSwKIAkJICAgICAgZW51bSBwcF9tcDFfc3RhdGUgbXAxX3N0YXRl
KTsKIGludCBzbXVfc2V0X2RmX2NzdGF0ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAkJICAg
ICAgZW51bSBwcF9kZl9jc3RhdGUgc3RhdGUpOwogCitpbnQgc211X2dldF9tYXhfc3VzdGFpbmFi
bGVfY2xvY2tzX2J5X2RjKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJCQkgc3RydWN0IHBw
X3NtdV9udl9jbG9ja190YWJsZSAqbWF4X2Nsb2Nrcyk7CisKK2ludCBzbXVfZ2V0X3VjbGtfZHBt
X3N0YXRlcyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKKwkJCSAgICB1bnNpZ25lZCBpbnQgKmNs
b2NrX3ZhbHVlc19pbl9raHosCisJCQkgICAgdW5zaWduZWQgaW50ICpudW1fc3RhdGVzKTsKKwor
ZW51bSBhbWRfcG1fc3RhdGVfdHlwZSBzbXVfZ2V0X2N1cnJlbnRfcG93ZXJfc3RhdGUoc3RydWN0
IHNtdV9jb250ZXh0ICpzbXUpOworCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvcG93ZXJwbGF5L25hdmkxMF9wcHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJw
bGF5L25hdmkxMF9wcHQuYwppbmRleCBiODhhYWU5YmIyNDIuLmVhZDQwYjI4NDBmOSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvbmF2aTEwX3BwdC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L25hdmkxMF9wcHQuYwpAQCAtNzk1LDEzICs3OTUs
MTMgQEAgc3RhdGljIGludCBuYXZpMTBfcG9wdWxhdGVfdW1kX3N0YXRlX2NsayhzdHJ1Y3Qgc211
X2NvbnRleHQgKnNtdSkKIAlpbnQgcmV0ID0gMDsKIAl1aW50MzJfdCBtaW5fc2Nsa19mcmVxID0g
MCwgbWluX21jbGtfZnJlcSA9IDA7CiAKLQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNt
dSwgU01VX1NDTEssICZtaW5fc2Nsa19mcmVxLCBOVUxMKTsKKwlyZXQgPSBzbXVfZ2V0X2RwbV9m
cmVxX3JhbmdlKHNtdSwgU01VX1NDTEssICZtaW5fc2Nsa19mcmVxLCBOVUxMLCBmYWxzZSk7CiAJ
aWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAogCXNtdS0+cHN0YXRlX3NjbGsgPSBtaW5fc2Nsa19m
cmVxICogMTAwOwogCi0JcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShzbXUsIFNNVV9NQ0xL
LCAmbWluX21jbGtfZnJlcSwgTlVMTCk7CisJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShz
bXUsIFNNVV9NQ0xLLCAmbWluX21jbGtfZnJlcSwgTlVMTCwgZmFsc2UpOwogCWlmIChyZXQpCiAJ
CXJldHVybiByZXQ7CiAKQEAgLTg1NCw3ICs4NTQsNyBAQCBzdGF0aWMgaW50IG5hdmkxMF9wcmVf
ZGlzcGxheV9jb25maWdfY2hhbmdlZChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKIAkJcmV0dXJu
IHJldDsKIAogCWlmIChzbXVfZmVhdHVyZV9pc19lbmFibGVkKHNtdSwgU01VX0ZFQVRVUkVfRFBN
X1VDTEtfQklUKSkgewotCQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNtdSwgU01VX1VD
TEssIE5VTEwsICZtYXhfZnJlcSk7CisJCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211
LCBTTVVfVUNMSywgTlVMTCwgJm1heF9mcmVxLCBmYWxzZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1
cm4gcmV0OwogCQlyZXQgPSBzbXVfc2V0X2hhcmRfZnJlcV9yYW5nZShzbXUsIFNNVV9VQ0xLLCAw
LCBtYXhfZnJlcSk7CkBAIC05MDQsNyArOTA0LDcgQEAgc3RhdGljIGludCBuYXZpMTBfZm9yY2Vf
ZHBtX2xpbWl0X3ZhbHVlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBib29sIGhpZ2hlc3QpCiAK
IAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjbGtzKTsgaSsrKSB7CiAJCWNsa190eXBlID0g
Y2xrc1tpXTsKLQkJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShzbXUsIGNsa190eXBlLCAm
bWluX2ZyZXEsICZtYXhfZnJlcSk7CisJCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211
LCBjbGtfdHlwZSwgJm1pbl9mcmVxLCAmbWF4X2ZyZXEsIGZhbHNlKTsKIAkJaWYgKHJldCkKIAkJ
CXJldHVybiByZXQ7CiAKQEAgLTkzMSw3ICs5MzEsNyBAQCBzdGF0aWMgaW50IG5hdmkxMF91bmZv
cmNlX2RwbV9sZXZlbHMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCiAKIAlmb3IgKGkgPSAwOyBp
IDwgQVJSQVlfU0laRShjbGtzKTsgaSsrKSB7CiAJCWNsa190eXBlID0gY2xrc1tpXTsKLQkJcmV0
ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShzbXUsIGNsa190eXBlLCAmbWluX2ZyZXEsICZtYXhf
ZnJlcSk7CisJCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211LCBjbGtfdHlwZSwgJm1p
bl9mcmVxLCAmbWF4X2ZyZXEsIGZhbHNlKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAK
QEAgLTEyNjYsNyArMTI2NiwxMCBAQCBzdGF0aWMgaW50IG5hdmkxMF9ub3RpZnlfc21jX2Rpc3Bh
bHlfY29uZmlnKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQogCWlmIChzbXVfZmVhdHVyZV9pc19z
dXBwb3J0ZWQoc211LCBTTVVfRkVBVFVSRV9EUE1fRENFRkNMS19CSVQpKSB7CiAJCWNsb2NrX3Jl
cS5jbG9ja190eXBlID0gYW1kX3BwX2RjZWZfY2xvY2s7CiAJCWNsb2NrX3JlcS5jbG9ja19mcmVx
X2luX2toeiA9IG1pbl9jbG9ja3MuZGNlZl9jbG9jayAqIDEwOwotCQlpZiAoIXNtdV9kaXNwbGF5
X2Nsb2NrX3ZvbHRhZ2VfcmVxdWVzdChzbXUsICZjbG9ja19yZXEpKSB7CisKKwkJaWYgKHNtdS0+
ZnVuY3MtPmRpc3BsYXlfY2xvY2tfdm9sdGFnZV9yZXF1ZXN0KQorCQkJcmV0ID0gc211LT5mdW5j
cy0+ZGlzcGxheV9jbG9ja192b2x0YWdlX3JlcXVlc3Qoc211LCAmY2xvY2tfcmVxKTsKKwkJaWYg
KCFyZXQpIHsKIAkJCWlmIChzbXVfZmVhdHVyZV9pc19zdXBwb3J0ZWQoc211LCBTTVVfRkVBVFVS
RV9EU19EQ0VGQ0xLX0JJVCkpIHsKIAkJCQlyZXQgPSBzbXVfc2VuZF9zbWNfbXNnX3dpdGhfcGFy
YW0oc211LAogCQkJCQkJCQkgIFNNVV9NU0dfU2V0TWluRGVlcFNsZWVwRGNlZmNsaywKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3Jlbm9pcl9wcHQuYyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3Jlbm9pcl9wcHQuYwppbmRleCA2YWVkZmZkNzM5ZGIu
LjAyNmY2MTFkN2QzMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkv
cmVub2lyX3BwdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3Jlbm9pcl9w
cHQuYwpAQCAtMTk0LDcgKzE5NCw3IEBAIHN0YXRpYyBpbnQgcmVub2lyX3ByaW50X2Nsa19sZXZl
bHMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJY2FzZSBTTVVfU0NMSzoKIAkJLyogcmV0aXJ2
ZSB0YWJsZSByZXR1cm5lZCBwYXJhbXRlcnMgdW5pdCBpcyBNSHogKi8KIAkJY3VyX3ZhbHVlID0g
bWV0cmljcy5DbG9ja0ZyZXF1ZW5jeVtDTE9DS19HRlhDTEtdOwotCQlyZXQgPSBzbXVfZ2V0X2Rw
bV9mcmVxX3JhbmdlKHNtdSwgU01VX0dGWENMSywgJm1pbiwgJm1heCk7CisJCXJldCA9IHNtdV9n
ZXRfZHBtX2ZyZXFfcmFuZ2Uoc211LCBTTVVfR0ZYQ0xLLCAmbWluLCAmbWF4LCBmYWxzZSk7CiAJ
CWlmICghcmV0KSB7CiAJCQkvKiBkcml2ZXIgb25seSBrbm93IG1pbi9tYXggZ2Z4X2NsaywgQWRk
IGxldmVsIDEgZm9yIGFsbCBvdGhlciBnZnggY2xrcyAqLwogCQkJaWYgKGN1cl92YWx1ZSAgPT0g
bWF4KQpAQCAtMzE0LDcgKzMxNCw3IEBAIHN0YXRpYyBpbnQgcmVub2lyX2ZvcmNlX2RwbV9saW1p
dF92YWx1ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgYm9vbCBoaWdoZXN0KQogCiAJZm9yIChp
ID0gMDsgaSA8IEFSUkFZX1NJWkUoY2xrcyk7IGkrKykgewogCQljbGtfdHlwZSA9IGNsa3NbaV07
Ci0JCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211LCBjbGtfdHlwZSwgJm1pbl9mcmVx
LCAmbWF4X2ZyZXEpOworCQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNtdSwgY2xrX3R5
cGUsICZtaW5fZnJlcSwgJm1heF9mcmVxLCBmYWxzZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4g
cmV0OwogCkBAIC0zNDgsNyArMzQ4LDcgQEAgc3RhdGljIGludCByZW5vaXJfdW5mb3JjZV9kcG1f
bGV2ZWxzKHN0cnVjdCBzbXVfY29udGV4dCAqc211KSB7CiAKIAkJY2xrX3R5cGUgPSBjbGtfZmVh
dHVyZV9tYXBbaV0uY2xrX3R5cGU7CiAKLQkJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShz
bXUsIGNsa190eXBlLCAmbWluX2ZyZXEsICZtYXhfZnJlcSk7CisJCXJldCA9IHNtdV9nZXRfZHBt
X2ZyZXFfcmFuZ2Uoc211LCBjbGtfdHlwZSwgJm1pbl9mcmVxLCAmbWF4X2ZyZXEsIGZhbHNlKTsK
IAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAKQEAgLTQzNSw3ICs0MzUsNyBAQCBzdGF0aWMg
aW50IHJlbm9pcl9mb3JjZV9jbGtfbGV2ZWxzKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCQkJ
cmV0dXJuIC1FSU5WQUw7CiAJCX0KIAotCQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNt
dSwgU01VX0dGWENMSywgJm1pbl9mcmVxLCAmbWF4X2ZyZXEpOworCQlyZXQgPSBzbXVfZ2V0X2Rw
bV9mcmVxX3JhbmdlKHNtdSwgU01VX0dGWENMSywgJm1pbl9mcmVxLCAmbWF4X2ZyZXEsIGZhbHNl
KTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAJCXJldCA9IHNtdV9zZW5kX3NtY19tc2df
d2l0aF9wYXJhbShzbXUsIFNNVV9NU0dfU2V0U29mdE1heEdmeENsaywKQEAgLTUxMSw3ICs1MTEs
NyBAQCBzdGF0aWMgaW50IHJlbm9pcl9zZXRfcGVha19jbG9ja19ieV9kZXZpY2Uoc3RydWN0IHNt
dV9jb250ZXh0ICpzbXUpCiAJaW50IHJldCA9IDA7CiAJdWludDMyX3Qgc2Nsa19mcmVxID0gMCwg
dWNsa19mcmVxID0gMDsKIAotCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211LCBTTVVf
U0NMSywgTlVMTCwgJnNjbGtfZnJlcSk7CisJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShz
bXUsIFNNVV9TQ0xLLCBOVUxMLCAmc2Nsa19mcmVxLCBmYWxzZSk7CiAJaWYgKHJldCkKIAkJcmV0
dXJuIHJldDsKIApAQCAtNTE5LDcgKzUxOSw3IEBAIHN0YXRpYyBpbnQgcmVub2lyX3NldF9wZWFr
X2Nsb2NrX2J5X2RldmljZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKIAlpZiAocmV0KQogCQly
ZXR1cm4gcmV0OwogCi0JcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShzbXUsIFNNVV9VQ0xL
LCBOVUxMLCAmdWNsa19mcmVxKTsKKwlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNtdSwg
U01VX1VDTEssIE5VTEwsICZ1Y2xrX2ZyZXEsIGZhbHNlKTsKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjEx
XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTFfMC5jCmluZGV4IGI2
OGNiOGJhZGM3NS4uYTE1NzZhNDgyOGQxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L3Bvd2VycGxheS9zbXVfdjExXzAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxh
eS9zbXVfdjExXzAuYwpAQCAtODA5LDggKzgwOSwxMSBAQCBzdGF0aWMgaW50IHNtdV92MTFfMF9z
ZXRfbWluX2RjZWZfZGVlcF9zbGVlcChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKIAlpZiAoIXRh
YmxlX2NvbnRleHQpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JcmV0dXJuIHNtdV9zZXRfZGVlcF9z
bGVlcF9kY2VmY2xrKHNtdSwKLQkJCQkJICB0YWJsZV9jb250ZXh0LT5ib290X3ZhbHVlcy5kY2Vm
Y2xrIC8gMTAwKTsKKwlpZiAoc211LT5mdW5jcy0+c2V0X2RlZXBfc2xlZXBfZGNlZmNsaykKKwkJ
cmV0dXJuIHNtdS0+ZnVuY3MtPnNldF9kZWVwX3NsZWVwX2RjZWZjbGsoc211LAorCQkJCXRhYmxl
X2NvbnRleHQtPmJvb3RfdmFsdWVzLmRjZWZjbGsgLyAxMDApOworCisJcmV0dXJuIDA7CiB9CiAK
IHN0YXRpYyBpbnQgc211X3YxMV8wX3NldF90b29sX3RhYmxlX2xvY2F0aW9uKHN0cnVjdCBzbXVf
Y29udGV4dCAqc211KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkv
dmVnYTIwX3BwdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvdmVnYTIwX3BwdC5j
CmluZGV4IGE3NmZmZDU4NDA0ZS4uM2VmOTk2MzcxOGM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL3Bvd2VycGxheS92ZWdhMjBfcHB0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9wb3dlcnBsYXkvdmVnYTIwX3BwdC5jCkBAIC0yNTkzLDcgKzI1OTMsOCBAQCBzdGF0aWMgaW50
IHZlZ2EyMF9zZXRfb2RfcGVyY2VudGFnZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAl9CiAK
IAlyZXQgPSBzbXVfaGFuZGxlX3Rhc2soc211LCBzbXVfZHBtLT5kcG1fbGV2ZWwsCi0JCQkgICAg
ICBBTURfUFBfVEFTS19SRUFESlVTVF9QT1dFUl9TVEFURSk7CisJCQkgICAgICBBTURfUFBfVEFT
S19SRUFESlVTVF9QT1dFUl9TVEFURSwKKwkJCSAgICAgIGZhbHNlKTsKIAogc2V0X29kX2ZhaWxl
ZDoKIAltdXRleF91bmxvY2soJihzbXUtPm11dGV4KSk7CkBAIC0yODI0LDcgKzI4MjUsOCBAQCBz
dGF0aWMgaW50IHZlZ2EyMF9vZG5fZWRpdF9kcG1fdGFibGUoc3RydWN0IHNtdV9jb250ZXh0ICpz
bXUsCiAJaWYgKHR5cGUgPT0gUFBfT0RfQ09NTUlUX0RQTV9UQUJMRSkgewogCQltdXRleF9sb2Nr
KCYoc211LT5tdXRleCkpOwogCQlyZXQgPSBzbXVfaGFuZGxlX3Rhc2soc211LCBzbXVfZHBtLT5k
cG1fbGV2ZWwsCi0JCQkJICAgICAgQU1EX1BQX1RBU0tfUkVBREpVU1RfUE9XRVJfU1RBVEUpOwor
CQkJCSAgICAgIEFNRF9QUF9UQVNLX1JFQURKVVNUX1BPV0VSX1NUQVRFLAorCQkJCSAgICAgIGZh
bHNlKTsKIAkJbXV0ZXhfdW5sb2NrKCYoc211LT5tdXRleCkpOwogCX0KIAotLSAKMi4yMy4wCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1h
aWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
