Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5FB23A2BEE
	for <lists+amd-gfx@lfdr.de>; Fri, 30 Aug 2019 02:54:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F1AE46E226;
	Fri, 30 Aug 2019 00:54:00 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-BY2-obe.outbound.protection.outlook.com
 (mail-eopbgr810071.outbound.protection.outlook.com [40.107.81.71])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1B8B36E226
 for <amd-gfx@lists.freedesktop.org>; Fri, 30 Aug 2019 00:54:00 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=cGfgFNSUB3VBDxS0fKDvjpVXz/Bp3ePq1RDZX0zbTZESV+Mf7D9FZjqjxAcAEAOYcAi+Bp4bPuxYl+XxNZRBflpPedUHf4DWv+HfIGYWnJQfQv+2UaCKTGsekKOwzYX1qhco8abPUCFOLrrDNq1qsSzvCyjtd33NL15yEg1xQf0tzMUfhXkCRgcHZ68JnrdtszuOn228gXlBbiOPsXozDJCBvWJqlqcktoEboNqobpC7yZDCHSAGvzb20sQa2efKbSDLj7Nz5G/qn0NW/bi9n2CYcG4qp9H0guGb9QhqZTfZ/xV7zAAv0wCCzqlib2gGUCcTngH7Hm2ks2K18qxFxg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=8Jw7L6sJ5NT+B184nD2h9ABRipEuzajETL5+3qlwP0w=;
 b=Y4WNPMmcQIjfvTtWWt5+oYm2l7k5Ziqj6Rgbo+ztFhAkB1GSijvX803VbZ2Jj/lqcwo7vDvFipMqnjeGgMGSgY1fkpTicXYkSGvm+0Gy+yIG+o82pE7kmYyHYcsZ2vnk+VVk34Jkievhqud/VGWyp4X+NikI5W0bdKs5bEmS+WnauQg/w/oun0Rcz5DHiRNpvgUTNsEWUX+vQk2QmpJPWSyYLOb2dIfI9wFwcIdtpMUhNstd5aiT6VVCJvnxEwTvJw2O/4KQ42TyCzqkGb5oJoXOAy+5mJm31LgdAQ+iiTnd1SIHj0KWY1RQ+Pi2E3iQUJXcw+TpPugHRpvsDcJN0Q==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=gmail.com smtp.mailfrom=amd.com;
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from DM3PR12CA0050.namprd12.prod.outlook.com (2603:10b6:0:56::18) by
 BN8PR12MB3233.namprd12.prod.outlook.com (2603:10b6:408:9f::19) with
 Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2178.16; Fri, 30 Aug 2019 00:53:57 +0000
Received: from BY2NAM03FT029.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e4a::201) by DM3PR12CA0050.outlook.office365.com
 (2603:10b6:0:56::18) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2220.19 via Frontend
 Transport; Fri, 30 Aug 2019 00:53:57 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV02.amd.com (165.204.84.17) by
 BY2NAM03FT029.mail.protection.outlook.com (10.152.84.213) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2220.16 via Frontend Transport; Fri, 30 Aug 2019 00:53:56 +0000
Received: from agrodzovsky-All-Series.amd.com (10.34.1.3) by
 SATLEXCHOV02.amd.com (10.181.40.72) with Microsoft SMTP Server id 14.3.389.1; 
 Thu, 29 Aug 2019 19:53:53 -0500
From: Andrey Grodzovsky <andrey.grodzovsky@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH v2 1/2] dmr/amdgpu: Avoid HW GPU reset for RAS.
Date: Thu, 29 Aug 2019 20:53:46 -0400
Message-ID: <1567126427-13912-1-git-send-email-andrey.grodzovsky@amd.com>
X-Mailer: git-send-email 2.7.4
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(376002)(396003)(39860400002)(346002)(136003)(2980300002)(428003)(189003)(199004)(70206006)(70586007)(8676002)(50466002)(48376002)(478600001)(5660300002)(2351001)(30864003)(81166006)(51416003)(7696005)(50226002)(81156014)(2906002)(8936002)(53416004)(6916009)(16586007)(4326008)(14444005)(316002)(47776003)(305945005)(86362001)(356004)(26005)(6666004)(44832011)(426003)(486006)(336012)(186003)(2616005)(476003)(126002)(54906003)(53936002)(36756003)(309714004);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN8PR12MB3233; H:SATLEXCHOV02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: c1b1c3fa-b374-4453-ecab-08d72ce489ad
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600166)(711020)(4605104)(1401327)(4618075)(2017052603328);
 SRVR:BN8PR12MB3233; 
X-MS-TrafficTypeDiagnostic: BN8PR12MB3233:
X-Microsoft-Antispam-PRVS: <BN8PR12MB3233AD68924B55D5291ED4C4EABD0@BN8PR12MB3233.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:785;
X-Forefront-PRVS: 0145758B1D
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: XwGi3srMhjzE2siJnV2ZjR4x5uqOx/1KpGZ6srpAMezh7K8OMVRg6eFbOeWzTHvcZgAWkVf+4vpWa8KtC7ZWdDMRdeXchohy/d9DBh4x2tJ5LEk/H6+kiQb7AWmDC1g5jeXuXfa6K7H2YRTj/zS04GMeGiZR8GRK9p7/4pQdZ6Huv/H0FEdA2CGwGHaa3vqr+DtuTeA00PVnVDa1p9lxKjAfEq6UWui+lpLq0pzlY4eJBKPjSh1ky+dryiF5Fd5kZJ6cLdOcL/AP7YG4MeBjMqAMoyDEWghFhQ6zkiPFK+qbIp5TfYE+USKzfyyP3VL9DlTFZjt/IcZExjxL63gMmvGD7QfeEENTH71QhHmx8ElehvUtmgRtP1uzPdTM3SicEsZ1SS79MFF7DkW3kcG/35z2lyNVfDumnU936L/XxcM=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 30 Aug 2019 00:53:56.8099 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: c1b1c3fa-b374-4453-ecab-08d72ce489ad
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN8PR12MB3233
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=8Jw7L6sJ5NT+B184nD2h9ABRipEuzajETL5+3qlwP0w=;
 b=hsZXIbORu6cZWIsG2Sgn6kWvhjhTBBV5qP64w5j6C2h1wPpoxzFTcrJpKK4ONnrqScM6hn4V9Psr0eVQugryt0bBc0EkrnE4LK8oeCGRCaRMrIaIpfWwgse464DxfEVZ0yUTTeYdj4c5/i0DkOYpBnfYXXgOEkEL+NFFXcrw2Hs=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; gmail.com; dkim=none (message not signed)
 header.d=none;gmail.com; dmarc=permerror action=none header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: alexdeucher@gmail.com, ckoenig.leichtzumerken@gmail.com, Tao.Zhou1@amd.com,
 Andrey Grodzovsky <andrey.grodzovsky@amd.com>, Hawking.Zhang@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

UHJvYmxlbToKVW5kZXIgY2VydGFpbiBjb25kaXRpb25zLCB3aGVuIHNvbWUgSVAgYm9ja3MgdGFr
ZSBhIFJBUyBlcnJvciwKd2UgY2FuIGdldCBpbnRvIGEgc2l0dWF0aW9uIHdoZXJlIGEgR1BVIHJl
c2V0IGlzIG5vdCBwb3NzaWJsZQpkdWUgdG8gaXNzdWVzIGluIFJBUyBpbiBTTVUvUFNQLgoKVGVt
cG9yYXJ5IGZpeCB1bnRpbCBwcm9wZXIgc29sdXRpb24gaW4gUFNQL1NNVSBpcyByZWFkeToKV2hl
biB1bmNvcnJlY3RhYmxlIGVycm9yIGhhcHBlbnMgdGhlIERGIHdpbGwgdW5jb25kaXRpb25hbGx5
CmJyb2FkY2FzdCBlcnJvciBldmVudCBwYWNrZXRzIHRvIGFsbCBpdHMgY2xpZW50cy9zbGF2ZSB1
cG9uCnJlY2VpdmluZyBmYXRhbCBlcnJvciBldmVudCBhbmQgZnJlZXplIGFsbCBpdHMgb3V0Ym91
bmQgcXVldWVzLAplcnJfZXZlbnRfYXRodWIgaW50ZXJydXB0ICB3aWxsIGJlIHRyaWdnZXJlZC4K
SW4gc3VjaCBjYXNlIGFuZCB3ZSB1c2UgdGhpcyBpbnRlcnJ1cHQKdG8gaXNzdWUgR1BVIHJlc2V0
LiBUSGUgR1BVIHJlc2V0IGNvZGUgaXMgbW9kaWZpZWQgZm9yIHN1Y2ggY2FzZSB0byBhdm9pZCBI
VwpyZXNldCwgb25seSBzdG9wcyBzY2hlZHVsZXJzLCBkZWF0Y2hlcyBhbGwgaW4gcHJvZ3Jlc3Mg
YW5kIG5vdCB5ZXQgc2NoZWR1bGVkCmpvYidzIGZlbmNlcywgc2V0IGVycm9yIGNvZGUgb24gdGhl
bSBhbmQgc2lnbmFscy4KQWxzbyByZWplY3QgYW55IG5ldyBpbmNvbWluZyBqb2Igc3VibWlzc2lv
bnMgZnJvbSB1c2VyIHNwYWNlLgpBbGwgdGhpcyBpcyBkb25lIHRvIG5vdGlmeSB0aGUgYXBwbGlj
YXRpb25zIG9mIHRoZSBwcm9ibGVtLgoKdjI6CkV4dHJhY3QgYW1kZ3B1X2FtZGtmZF9wcmUvcG9z
dF9yZXNldCBmcm9tIGFtZGdwdV9kZXZpY2VfbG9jay91bmxvY2tfYWRldgpNb3ZlIGFtZGdwdV9q
b2Jfc3RvcF9hbGxfam9ic19vbl9zY2hlZCB0byBhbWRncHVfam9iLmMKUmVtb3ZlIHByaW50IHBh
cmFtIGZyb20gYW1kZ3B1X3Jhc19xdWVyeV9lcnJvcl9jb3VudAoKU2lnbmVkLW9mZi1ieTogQW5k
cmV5IEdyb2R6b3Zza3kgPGFuZHJleS5ncm9kem92c2t5QGFtZC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgICAgIHwgIDQgKysrCiBkcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMgfCA0NiArKysrKysrKysrKysrKysrKysrKysr
Ky0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYyAgICB8ICA1
ICsrKysKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9qb2IuYyAgICB8IDM4ICsr
KysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2pvYi5oICAgIHwgIDMgKysKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMu
YyAgICB8ICA2ICsrKysKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMuYyAg
ICB8IDIyICsrKysrKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
cmFzLmggICAgfCAxMCArKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjlf
MC5jICAgICAgfCAxMCArKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjlf
MC5jICAgICAgfCAyNCArKysrKysrKystLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9uYmlvX3Y3XzQuYyAgICAgfCAgNSArKysrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9z
ZG1hX3Y0XzAuYyAgICAgfCAzMiArKysrKysrKysrKy0tLS0tLS0tLS0KIDEyIGZpbGVzIGNoYW5n
ZWQsIDE2MyBpbnNlcnRpb25zKCspLCA0MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9jcy5jCmluZGV4IDlkYTY4MWUuLjMwMGFkYjggMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCkBAIC0zOCw2ICszOCw3IEBACiAjaW5jbHVkZSAiYW1k
Z3B1X2dtYy5oIgogI2luY2x1ZGUgImFtZGdwdV9nZW0uaCIKICNpbmNsdWRlICJhbWRncHVfZGlz
cGxheS5oIgorI2luY2x1ZGUgImFtZGdwdV9yYXMuaCIKIAogI2lmIGRlZmluZWQoSEFWRV9EUk1f
RlJFRV9MQVJHRSkKICNkZWZpbmUga3ZmcmVlIGRybV9mcmVlX2xhcmdlCkBAIC0xNDYxLDYgKzE0
NjIsOSBAQCBpbnQgYW1kZ3B1X2NzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQg
KmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlscCkKIAlib29sIHJlc2VydmVkX2J1ZmZlcnMgPSBm
YWxzZTsKIAlpbnQgaSwgcjsKIAorCWlmIChhbWRncHVfcmFzX2ludHJfdHJpZ2dlcmVkKCkpCisJ
CXJldHVybiAtRUhXUE9JU09OOworCiAJaWYgKCFhZGV2LT5hY2NlbF93b3JraW5nKQogCQlyZXR1
cm4gLUVCVVNZOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMK
aW5kZXggYTVkYWNjYy4uZDNhMDc4YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9kZXZpY2UuYwpAQCAtMzcyNywyNSArMzcyNywxOCBAQCBzdGF0aWMgYm9vbCBhbWRncHVf
ZGV2aWNlX2xvY2tfYWRldihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgYm9vbCB0cnlsb2Nr
KQogCQlhZGV2LT5tcDFfc3RhdGUgPSBQUF9NUDFfU1RBVEVfTk9ORTsKIAkJYnJlYWs7CiAJfQot
CS8qIEJsb2NrIGtmZDogU1JJT1Ygd291bGQgZG8gaXQgc2VwYXJhdGVseSAqLwotCWlmICghYW1k
Z3B1X3NyaW92X3ZmKGFkZXYpKQotICAgICAgICAgICAgICAgIGFtZGdwdV9hbWRrZmRfcHJlX3Jl
c2V0KGFkZXYpOwogCiAJcmV0dXJuIHRydWU7CiB9CiAKIHN0YXRpYyB2b2lkIGFtZGdwdV9kZXZp
Y2VfdW5sb2NrX2FkZXYoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7Ci0JLyp1bmxvY2sg
a2ZkOiBTUklPViB3b3VsZCBkbyBpdCBzZXBhcmF0ZWx5ICovCi0JaWYgKCFhbWRncHVfc3Jpb3Zf
dmYoYWRldikpCi0gICAgICAgICAgICAgICAgYW1kZ3B1X2FtZGtmZF9wb3N0X3Jlc2V0KGFkZXYp
OwogCWFtZGdwdV92Zl9lcnJvcl90cmFuc19hbGwoYWRldik7CiAJYWRldi0+bXAxX3N0YXRlID0g
UFBfTVAxX1NUQVRFX05PTkU7CiAJYWRldi0+aW5fZ3B1X3Jlc2V0ID0gMDsKIAltdXRleF91bmxv
Y2soJmFkZXYtPmxvY2tfcmVzZXQpOwogfQogCi0KIC8qKgogICogYW1kZ3B1X2RldmljZV9ncHVf
cmVjb3ZlciAtIHJlc2V0IHRoZSBhc2ljIGFuZCByZWNvdmVyIHNjaGVkdWxlcgogICoKQEAgLTM3
NjUsMTEgKzM3NTgsMTIgQEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1X3JlY292ZXIoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsCiAJc3RydWN0IGFtZGdwdV9oaXZlX2luZm8gKmhpdmUgPSBOVUxM
OwogCXN0cnVjdCBhbWRncHVfZGV2aWNlICp0bXBfYWRldiA9IE5VTEw7CiAJaW50IGksIHIgPSAw
OworCWJvb2wgaW5fcmFzX2ludHIgPSBhbWRncHVfcmFzX2ludHJfdHJpZ2dlcmVkKCk7CiAKIAlu
ZWVkX2Z1bGxfcmVzZXQgPSBqb2Jfc2lnbmFsZWQgPSBmYWxzZTsKIAlJTklUX0xJU1RfSEVBRCgm
ZGV2aWNlX2xpc3QpOwogCi0JZGV2X2luZm8oYWRldi0+ZGV2LCAiR1BVIHJlc2V0IGJlZ2luIVxu
Iik7CisJZGV2X2luZm8oYWRldi0+ZGV2LCAiR1BVICVzIGJlZ2luIVxuIiwgaW5fcmFzX2ludHIg
PyAiam9icyBzdG9wIjoicmVzZXQiKTsKIAogCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmYWRl
di0+ZGVsYXllZF9pbml0X3dvcmspOwogCkBAIC0zNzk2LDkgKzM3OTAsMTYgQEAgaW50IGFtZGdw
dV9kZXZpY2VfZ3B1X3JlY292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCXJldHVy
biAwOwogCX0KIAorCS8qIEJsb2NrIGtmZDogU1JJT1Ygd291bGQgZG8gaXQgc2VwYXJhdGVseSAq
LworCWlmICghYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKQorICAgICAgICAgICAgICAgIGFtZGdwdV9h
bWRrZmRfcHJlX3Jlc2V0KGFkZXYpOworCiAJLyogQnVpbGQgbGlzdCBvZiBkZXZpY2VzIHRvIHJl
c2V0ICovCiAJaWYgIChhZGV2LT5nbWMueGdtaS5udW1fcGh5c2ljYWxfbm9kZXMgPiAxKSB7CiAJ
CWlmICghaGl2ZSkgeworCQkJLyp1bmxvY2sga2ZkOiBTUklPViB3b3VsZCBkbyBpdCBzZXBhcmF0
ZWx5ICovCisJCQlpZiAoIWFtZGdwdV9zcmlvdl92ZihhZGV2KSkKKwkJICAgICAgICAgICAgICAg
IGFtZGdwdV9hbWRrZmRfcG9zdF9yZXNldChhZGV2KTsKIAkJCWFtZGdwdV9kZXZpY2VfdW5sb2Nr
X2FkZXYoYWRldik7CiAJCQlyZXR1cm4gLUVOT0RFVjsKIAkJfQpAQCAtMzgyNCw3ICszODI1LDcg
QEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1X3JlY292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsCiAJLyogYmxvY2sgYWxsIHNjaGVkdWxlcnMgYW5kIHJlc2V0IGdpdmVuIGpvYidzIHJpbmcg
Ki8KIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHRtcF9hZGV2LCBkZXZpY2VfbGlzdF9oYW5kbGUsIGdt
Yy54Z21pLmhlYWQpIHsKIAkJLyogZGlzYWJsZSByYXMgb24gQUxMIElQcyAqLwotCQlpZiAoYW1k
Z3B1X2RldmljZV9pcF9uZWVkX2Z1bGxfcmVzZXQodG1wX2FkZXYpKQorCQlpZiAoIWluX3Jhc19p
bnRyICYmIGFtZGdwdV9kZXZpY2VfaXBfbmVlZF9mdWxsX3Jlc2V0KHRtcF9hZGV2KSkKIAkJCWFt
ZGdwdV9yYXNfc3VzcGVuZCh0bXBfYWRldik7CiAKIAkJZm9yIChpID0gMDsgaSA8IEFNREdQVV9N
QVhfUklOR1M7ICsraSkgewpAQCAtMzgzNCwxMCArMzgzNSwyNiBAQCBpbnQgYW1kZ3B1X2Rldmlj
ZV9ncHVfcmVjb3ZlcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCQljb250aW51ZTsK
IAogCQkJZHJtX3NjaGVkX3N0b3AoJnJpbmctPnNjaGVkLCBqb2IgPyAmam9iLT5iYXNlIDogTlVM
TCk7CisKKwkJCWlmIChpbl9yYXNfaW50cikKKwkJCQlhbWRncHVfam9iX3N0b3BfYWxsX2pvYnNf
b25fc2NoZWQoJnJpbmctPnNjaGVkKTsKIAkJfQogCX0KIAogCisJaWYgKGluX3Jhc19pbnRyKSB7
CisJCWxpc3RfZm9yX2VhY2hfZW50cnkodG1wX2FkZXYsIGRldmljZV9saXN0X2hhbmRsZSwgZ21j
LnhnbWkuaGVhZCkgeworCQkJaWYgKHRtcF9hZGV2ID09IGFkZXYpCisJCQkJY29udGludWU7CisK
KwkJCWlmIChhbWRncHVfZGV2aWNlX2xvY2tfYWRldih0bXBfYWRldiwgZmFsc2UpICYmICFhbWRn
cHVfc3Jpb3ZfdmYodG1wX2FkZXYpKQorCQkJCWFtZGdwdV9hbWRrZmRfcHJlX3Jlc2V0KHRtcF9h
ZGV2KTsKKworCQl9CisKKwkJZ290byBza2lwX3NjaGVkX3Jlc3VtZTsKKwl9CisKIAkvKgogCSAq
IE11c3QgY2hlY2sgZ3VpbHR5IHNpZ25hbCBoZXJlIHNpbmNlIGFmdGVyIHRoaXMgcG9pbnQgYWxs
IG9sZAogCSAqIEhXIGZlbmNlcyBhcmUgZm9yY2Ugc2lnbmFsZWQuCkBAIC0zODcyLDcgKzM4ODks
OSBAQCBpbnQgYW1kZ3B1X2RldmljZV9ncHVfcmVjb3ZlcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiwKIAkJaWYgKHRtcF9hZGV2ID09IGFkZXYpCiAJCQljb250aW51ZTsKIAotCQlhbWRncHVf
ZGV2aWNlX2xvY2tfYWRldih0bXBfYWRldiwgZmFsc2UpOworCQlpZiAoYW1kZ3B1X2RldmljZV9s
b2NrX2FkZXYodG1wX2FkZXYsIGZhbHNlKSAmJiAhYW1kZ3B1X3NyaW92X3ZmKHRtcF9hZGV2KSkK
KwkJCWFtZGdwdV9hbWRrZmRfcHJlX3Jlc2V0KHRtcF9hZGV2KTsKKwogCQlyID0gYW1kZ3B1X2Rl
dmljZV9wcmVfYXNpY19yZXNldCh0bXBfYWRldiwKIAkJCQkJCSBOVUxMLAogCQkJCQkJICZuZWVk
X2Z1bGxfcmVzZXQpOwpAQCAtMzkwMCw2ICszOTE5LDcgQEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1
X3JlY292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAKIAkvKiBQb3N0IEFTSUMgcmVz
ZXQgZm9yIGFsbCBkZXZzIC4qLwogCWxpc3RfZm9yX2VhY2hfZW50cnkodG1wX2FkZXYsIGRldmlj
ZV9saXN0X2hhbmRsZSwgZ21jLnhnbWkuaGVhZCkgeworCiAJCWZvciAoaSA9IDA7IGkgPCBBTURH
UFVfTUFYX1JJTkdTOyArK2kpIHsKIAkJCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9IHRtcF9h
ZGV2LT5yaW5nc1tpXTsKIApAQCAtMzkyNiw3ICszOTQ2LDEzIEBAIGludCBhbWRncHVfZGV2aWNl
X2dwdV9yZWNvdmVyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQl9IGVsc2UgewogCQkJ
ZGV2X2luZm8odG1wX2FkZXYtPmRldiwgIkdQVSByZXNldCglZCkgc3VjY2VlZGVkIVxuIiwgYXRv
bWljX3JlYWQoJmFkZXYtPmdwdV9yZXNldF9jb3VudGVyKSk7CiAJCX0KKwl9CiAKK3NraXBfc2No
ZWRfcmVzdW1lOgorCWxpc3RfZm9yX2VhY2hfZW50cnkodG1wX2FkZXYsIGRldmljZV9saXN0X2hh
bmRsZSwgZ21jLnhnbWkuaGVhZCkgeworCQkvKnVubG9jayBrZmQ6IFNSSU9WIHdvdWxkIGRvIGl0
IHNlcGFyYXRlbHkgKi8KKwkJaWYgKCFpbl9yYXNfaW50ciAmJiAhYW1kZ3B1X3NyaW92X3ZmKHRt
cF9hZGV2KSkKKwkgICAgICAgICAgICAgICAgYW1kZ3B1X2FtZGtmZF9wb3N0X3Jlc2V0KHRtcF9h
ZGV2KTsKIAkJYW1kZ3B1X2RldmljZV91bmxvY2tfYWRldih0bXBfYWRldik7CiAJfQogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKaW5kZXggMTUxZDdmMi4uNzU3ZmQ2ZCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYwpAQCAtNDAsNiArNDAsOCBA
QAogCiAjaW5jbHVkZSAiYW1kZ3B1X2FtZGtmZC5oIgogCisjaW5jbHVkZSAiYW1kZ3B1X3Jhcy5o
IgorCiAvKgogICogS01TIHdyYXBwZXIuCiAgKiAtIDMuMC4wIC0gaW5pdGlhbCBkcml2ZXIKQEAg
LTExNzksNiArMTE4MSw5IEBAIGFtZGdwdV9wY2lfc2h1dGRvd24oc3RydWN0IHBjaV9kZXYgKnBk
ZXYpCiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHBjaV9nZXRfZHJ2ZGF0YShwZGV2KTsKIAlz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRldi0+ZGV2X3ByaXZhdGU7CiAKKwlpZiAoYW1k
Z3B1X3Jhc19pbnRyX3RyaWdnZXJlZCgpKQorCQlyZXR1cm47CisKIAkvKiBpZiB3ZSBhcmUgcnVu
bmluZyBpbiBhIFZNLCBtYWtlIHN1cmUgdGhlIGRldmljZQogCSAqIHRvcm4gZG93biBwcm9wZXJs
eSBvbiByZWJvb3Qvc2h1dGRvd24uCiAJICogdW5mb3J0dW5hdGVseSB3ZSBjYW4ndCBkZXRlY3Qg
Y2VydGFpbgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pv
Yi5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5jCmluZGV4IDRkNjdi
NzcuLmIxMjk4MWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9qb2IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMKQEAg
LTI1MCw2ICsyNTAsNDQgQEAgc3RhdGljIHN0cnVjdCBkbWFfZmVuY2UgKmFtZGdwdV9qb2JfcnVu
KHN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2IpCiAJcmV0dXJuIGZlbmNlOwogfQogCisj
ZGVmaW5lIHRvX2RybV9zY2hlZF9qb2Ioc2NoZWRfam9iKQkJXAorCQljb250YWluZXJfb2YoKHNj
aGVkX2pvYiksIHN0cnVjdCBkcm1fc2NoZWRfam9iLCBxdWV1ZV9ub2RlKQorCit2b2lkIGFtZGdw
dV9qb2Jfc3RvcF9hbGxfam9ic19vbl9zY2hlZChzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNj
aGVkKQoreworCXN0cnVjdCBkcm1fc2NoZWRfam9iICpzX2pvYjsKKwlzdHJ1Y3QgZHJtX3NjaGVk
X2VudGl0eSAqc19lbnRpdHkgPSBOVUxMOworCWludCBpOworCisJLyogU2lnbmFsIGFsbCBqb2Jz
IG5vdCB5ZXQgc2NoZWR1bGVkICovCisJZm9yIChpID0gRFJNX1NDSEVEX1BSSU9SSVRZX01BWCAt
IDE7IGkgPj0gRFJNX1NDSEVEX1BSSU9SSVRZX01JTjsgaS0tKSB7CisJCXN0cnVjdCBkcm1fc2No
ZWRfcnEgKnJxID0gJnNjaGVkLT5zY2hlZF9ycVtpXTsKKworCQlpZiAoIXJxKQorCQkJY29udGlu
dWU7CisKKwkJc3Bpbl9sb2NrKCZycS0+bG9jayk7CisJCWxpc3RfZm9yX2VhY2hfZW50cnkoc19l
bnRpdHksICZycS0+ZW50aXRpZXMsIGxpc3QpIHsKKwkJCXdoaWxlICgoc19qb2IgPSB0b19kcm1f
c2NoZWRfam9iKHNwc2NfcXVldWVfcG9wKCZzX2VudGl0eS0+am9iX3F1ZXVlKSkpKSB7CisJCQkJ
c3RydWN0IGRybV9zY2hlZF9mZW5jZSAqc19mZW5jZSA9IHNfam9iLT5zX2ZlbmNlOworCisJCQkJ
ZG1hX2ZlbmNlX3NpZ25hbCgmc19mZW5jZS0+c2NoZWR1bGVkKTsKKwkJCQlkbWFfZmVuY2Vfc2V0
X2Vycm9yKCZzX2ZlbmNlLT5maW5pc2hlZCwgLUVIV1BPSVNPTik7CisJCQkJZG1hX2ZlbmNlX3Np
Z25hbCgmc19mZW5jZS0+ZmluaXNoZWQpOworCQkJfQorCQl9CisJCXNwaW5fdW5sb2NrKCZycS0+
bG9jayk7CisJfQorCisJLyogU2lnbmFsIGFsbCBqb2JzIGFscmVhZHkgc2NoZWR1bGVkIHRvIEhX
ICovCisJbGlzdF9mb3JfZWFjaF9lbnRyeShzX2pvYiwgJnNjaGVkLT5yaW5nX21pcnJvcl9saXN0
LCBub2RlKSB7CisJCXN0cnVjdCBkcm1fc2NoZWRfZmVuY2UgKnNfZmVuY2UgPSBzX2pvYi0+c19m
ZW5jZTsKKworCQlkbWFfZmVuY2Vfc2V0X2Vycm9yKCZzX2ZlbmNlLT5maW5pc2hlZCwgLUVIV1BP
SVNPTik7CisJCWRtYV9mZW5jZV9zaWduYWwoJnNfZmVuY2UtPmZpbmlzaGVkKTsKKwl9Cit9CisK
IGNvbnN0IHN0cnVjdCBkcm1fc2NoZWRfYmFja2VuZF9vcHMgYW1kZ3B1X3NjaGVkX29wcyA9IHsK
IAkuZGVwZW5kZW5jeSA9IGFtZGdwdV9qb2JfZGVwZW5kZW5jeSwKIAkucnVuX2pvYiA9IGFtZGdw
dV9qb2JfcnVuLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2pvYi5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5oCmluZGV4IDUx
ZTYyNTAuLmRjN2VlOTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9qb2IuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmgK
QEAgLTc2LDQgKzc2LDcgQEAgaW50IGFtZGdwdV9qb2Jfc3VibWl0KHN0cnVjdCBhbWRncHVfam9i
ICpqb2IsIHN0cnVjdCBkcm1fc2NoZWRfZW50aXR5ICplbnRpdHksCiAJCSAgICAgIHZvaWQgKm93
bmVyLCBzdHJ1Y3QgZG1hX2ZlbmNlICoqZik7CiBpbnQgYW1kZ3B1X2pvYl9zdWJtaXRfZGlyZWN0
KHN0cnVjdCBhbWRncHVfam9iICpqb2IsIHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywKIAkJCSAg
ICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKTsKKwordm9pZCBhbWRncHVfam9iX3N0b3BfYWxs
X2pvYnNfb25fc2NoZWQoc3RydWN0IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCk7CisKICNlbmRp
ZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jCmluZGV4IGRhMjE0M2QuLmNl
ZDc2NmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMKQEAgLTEwNDYs
NiArMTA0NiwxMiBAQCBpbnQgYW1kZ3B1X2RyaXZlcl9vcGVuX2ttcyhzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKIAkvKiBFbnN1cmUgSUIgdGVzdHMg
YXJlIHJ1biBvbiByaW5nICovCiAJZmx1c2hfZGVsYXllZF93b3JrKCZhZGV2LT5kZWxheWVkX2lu
aXRfd29yayk7CiAKKworCWlmIChhbWRncHVfcmFzX2ludHJfdHJpZ2dlcmVkKCkpIHsKKwkJRFJN
X0VSUk9SKCJSQVMgSW50ciB0cmlnZ2VyZWQsIGRldmljZSBkaXNhYmxlZCEhIik7CisJCXJldHVy
biAtRUhXUE9JU09OOworCX0KKwogCWZpbGVfcHJpdi0+ZHJpdmVyX3ByaXYgPSBOVUxMOwogCiAJ
ciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGV2LT5kZXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Jhcy5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X3Jhcy5jCmluZGV4IDJkNTg5N2EuLjdiMDBhYzYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfcmFzLmMKQEAgLTI0LDYgKzI0LDggQEAKICNpbmNsdWRlIDxsaW51
eC9kZWJ1Z2ZzLmg+CiAjaW5jbHVkZSA8bGludXgvbGlzdC5oPgogI2luY2x1ZGUgPGxpbnV4L21v
ZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4L3JlYm9vdC5oPgorI2luY2x1ZGUgPGxpbnV4L3N5c2Nh
bGxzLmg+CiAjaW5jbHVkZSAiYW1kZ3B1LmgiCiAjaW5jbHVkZSAiYW1kZ3B1X3Jhcy5oIgogI2lu
Y2x1ZGUgImFtZGdwdV9hdG9tZmlybXdhcmUuaCIKQEAgLTY0LDYgKzY2LDkgQEAgY29uc3QgY2hh
ciAqcmFzX2Jsb2NrX3N0cmluZ1tdID0gewogLyogaW5qZWN0IGFkZHJlc3MgaXMgNTIgYml0cyAq
LwogI2RlZmluZQlSQVNfVU1DX0lOSkVDVF9BRERSX0xJTUlUCSgweDFVTEwgPDwgNTIpCiAKKwor
YXRvbWljX3QgYW1kZ3B1X3Jhc19pbl9pbnRyID0gQVRPTUlDX0lOSVQoMCk7CisKIHN0YXRpYyBp
bnQgYW1kZ3B1X3Jhc19yZXNlcnZlX3ZyYW0oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJ
CXVpbnQ2NF90IG9mZnNldCwgdWludDY0X3Qgc2l6ZSwKIAkJc3RydWN0IGFtZGdwdV9ibyAqKmJv
X3B0cik7CkBAIC0xODgsNiArMTkzLDEwIEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Jhc19kZWJ1Z2Zz
X2N0cmxfcGFyc2VfZGF0YShzdHJ1Y3QgZmlsZSAqZiwKIAogCXJldHVybiAwOwogfQorCitzdGF0
aWMgc3RydWN0IHJhc19tYW5hZ2VyICphbWRncHVfcmFzX2ZpbmRfb2JqKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LAorCQlzdHJ1Y3QgcmFzX2NvbW1vbl9pZiAqaGVhZCk7CisKIC8qKgogICog
RE9DOiBBTURHUFUgUkFTIGRlYnVnZnMgY29udHJvbCBpbnRlcmZhY2UKICAqCkBAIC02MjcsMTIg
KzYzNiwxNCBAQCBpbnQgYW1kZ3B1X3Jhc19lcnJvcl9xdWVyeShzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwKIAlpbmZvLT51ZV9jb3VudCA9IG9iai0+ZXJyX2RhdGEudWVfY291bnQ7CiAJaW5m
by0+Y2VfY291bnQgPSBvYmotPmVycl9kYXRhLmNlX2NvdW50OwogCi0JaWYgKGVycl9kYXRhLmNl
X2NvdW50KQorCWlmIChlcnJfZGF0YS5jZV9jb3VudCkgewogCQlkZXZfaW5mbyhhZGV2LT5kZXYs
ICIlbGQgY29ycmVjdGFibGUgZXJyb3JzIGRldGVjdGVkIGluICVzIGJsb2NrXG4iLAogCQkJIG9i
ai0+ZXJyX2RhdGEuY2VfY291bnQsIHJhc19ibG9ja19zdHIoaW5mby0+aGVhZC5ibG9jaykpOwot
CWlmIChlcnJfZGF0YS51ZV9jb3VudCkKKwl9CisJaWYgKGVycl9kYXRhLnVlX2NvdW50KSB7CiAJ
CWRldl9pbmZvKGFkZXYtPmRldiwgIiVsZCB1bmNvcnJlY3RhYmxlIGVycm9ycyBkZXRlY3RlZCBp
biAlcyBibG9ja1xuIiwKIAkJCSBvYmotPmVycl9kYXRhLnVlX2NvdW50LCByYXNfYmxvY2tfc3Ry
KGluZm8tPmhlYWQuYmxvY2spKTsKKwl9CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE3MTgsMyArMTcy
OSwxMCBAQCBpbnQgYW1kZ3B1X3Jhc19maW5pKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQog
CiAJcmV0dXJuIDA7CiB9CisKK3ZvaWQgYW1kZ3B1X3Jhc19nbG9iYWxfcmFzX2lzcihzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldikKK3sKKwlpZiAoYXRvbWljX2NtcHhjaGcoJmFtZGdwdV9yYXNf
aW5faW50ciwgMCwgMSkgPT0gMCkgeworCQlEUk1fV0FSTigiUkFTIGV2ZW50IG9mIHR5cGUgRVJS
RVZFTlRfQVRIVUJfSU5URVJSVVBUIGRldGVjdGVkISBTdG9wcGluZyBhbGwgR1BVIGpvYnMuXG4i
KTsKKwl9Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
cmFzLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmgKaW5kZXggNWEw
ZGY3My4uY2Y1ZmZiNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3Jhcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMuaApA
QCAtNjAwLDQgKzYwMCwxNCBAQCBpbnQgYW1kZ3B1X3Jhc19pbnRlcnJ1cHRfcmVtb3ZlX2hhbmRs
ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAKIGludCBhbWRncHVfcmFzX2ludGVycnVw
dF9kaXNwYXRjaChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJc3RydWN0IHJhc19kaXNw
YXRjaF9pZiAqaW5mbyk7CisKK2V4dGVybiBhdG9taWNfdCBhbWRncHVfcmFzX2luX2ludHI7CisK
K3N0YXRpYyBpbmxpbmUgYm9vbCBhbWRncHVfcmFzX2ludHJfdHJpZ2dlcmVkKHZvaWQpCit7CisJ
cmV0dXJuICEhYXRvbWljX3JlYWQoJmFtZGdwdV9yYXNfaW5faW50cik7Cit9CisKK3ZvaWQgYW1k
Z3B1X3Jhc19nbG9iYWxfcmFzX2lzcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7CisKICNl
bmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKaW5kZXggYjJjODZhMC4uZTdh
ODNmNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjlfMC5jCkBAIC01NjY5LDEwICs1
NjY5LDEyIEBAIHN0YXRpYyBpbnQgZ2Z4X3Y5XzBfcHJvY2Vzc19yYXNfZGF0YV9jYihzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldiwKIAkJc3RydWN0IGFtZGdwdV9pdl9lbnRyeSAqZW50cnkpCiB7
CiAJLyogVE9ETyB1ZSB3aWxsIHRyaWdnZXIgYW4gaW50ZXJydXB0LiAqLwotCWtnZDJrZmRfc2V0
X3NyYW1fZWNjX2ZsYWcoYWRldi0+a2ZkLmRldik7Ci0JaWYgKGFkZXYtPmdmeC5mdW5jcy0+cXVl
cnlfcmFzX2Vycm9yX2NvdW50KQotCQlhZGV2LT5nZnguZnVuY3MtPnF1ZXJ5X3Jhc19lcnJvcl9j
b3VudChhZGV2LCBlcnJfZGF0YSk7Ci0JYW1kZ3B1X3Jhc19yZXNldF9ncHUoYWRldiwgMCk7CisJ
aWYgKCFhbWRncHVfcmFzX2lzX3N1cHBvcnRlZChhZGV2LCBBTURHUFVfUkFTX0JMT0NLX19HRlgp
KSB7CisJCWtnZDJrZmRfc2V0X3NyYW1fZWNjX2ZsYWcoYWRldi0+a2ZkLmRldik7CisJCWlmIChh
ZGV2LT5nZnguZnVuY3MtPnF1ZXJ5X3Jhc19lcnJvcl9jb3VudCkKKwkJCWFkZXYtPmdmeC5mdW5j
cy0+cXVlcnlfcmFzX2Vycm9yX2NvdW50KGFkZXYsIGVycl9kYXRhKTsKKwkJYW1kZ3B1X3Jhc19y
ZXNldF9ncHUoYWRldiwgMCk7CisJfQogCXJldHVybiBBTURHUFVfUkFTX1NVQ0NFU1M7CiB9CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8wLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjlfMC5jCmluZGV4IDQzYjRmYmMuLjg3YTY2YzIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8wLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYwpAQCAtMjQzLDE4ICsyNDMsMjAg
QEAgc3RhdGljIGludCBnbWNfdjlfMF9wcm9jZXNzX3Jhc19kYXRhX2NiKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LAogCQlzdHJ1Y3QgcmFzX2Vycl9kYXRhICplcnJfZGF0YSwKIAkJc3RydWN0
IGFtZGdwdV9pdl9lbnRyeSAqZW50cnkpCiB7Ci0Ja2dkMmtmZF9zZXRfc3JhbV9lY2NfZmxhZyhh
ZGV2LT5rZmQuZGV2KTsKLQlpZiAoYWRldi0+dW1jLmZ1bmNzLT5xdWVyeV9yYXNfZXJyb3JfY291
bnQpCi0JCWFkZXYtPnVtYy5mdW5jcy0+cXVlcnlfcmFzX2Vycm9yX2NvdW50KGFkZXYsIGVycl9k
YXRhKTsKLQkvKiB1bWMgcXVlcnlfcmFzX2Vycm9yX2FkZHJlc3MgaXMgYWxzbyByZXNwb25zaWJs
ZSBmb3IgY2xlYXJpbmcKLQkgKiBlcnJvciBzdGF0dXMKLQkgKi8KLQlpZiAoYWRldi0+dW1jLmZ1
bmNzLT5xdWVyeV9yYXNfZXJyb3JfYWRkcmVzcykKLQkJYWRldi0+dW1jLmZ1bmNzLT5xdWVyeV9y
YXNfZXJyb3JfYWRkcmVzcyhhZGV2LCBlcnJfZGF0YSk7CisJaWYgKCFhbWRncHVfcmFzX2lzX3N1
cHBvcnRlZChhZGV2LCBBTURHUFVfUkFTX0JMT0NLX19HRlgpKSB7CisJCWtnZDJrZmRfc2V0X3Ny
YW1fZWNjX2ZsYWcoYWRldi0+a2ZkLmRldik7CisJCWlmIChhZGV2LT51bWMuZnVuY3MtPnF1ZXJ5
X3Jhc19lcnJvcl9jb3VudCkKKwkJCWFkZXYtPnVtYy5mdW5jcy0+cXVlcnlfcmFzX2Vycm9yX2Nv
dW50KGFkZXYsIGVycl9kYXRhKTsKKwkJLyogdW1jIHF1ZXJ5X3Jhc19lcnJvcl9hZGRyZXNzIGlz
IGFsc28gcmVzcG9uc2libGUgZm9yIGNsZWFyaW5nCisJCSAqIGVycm9yIHN0YXR1cworCQkgKi8K
KwkJaWYgKGFkZXYtPnVtYy5mdW5jcy0+cXVlcnlfcmFzX2Vycm9yX2FkZHJlc3MpCisJCQlhZGV2
LT51bWMuZnVuY3MtPnF1ZXJ5X3Jhc19lcnJvcl9hZGRyZXNzKGFkZXYsIGVycl9kYXRhKTsKIAot
CS8qIG9ubHkgdW5jb3JyZWN0YWJsZSBlcnJvciBuZWVkcyBncHUgcmVzZXQgKi8KLQlpZiAoZXJy
X2RhdGEtPnVlX2NvdW50KQotCQlhbWRncHVfcmFzX3Jlc2V0X2dwdShhZGV2LCAwKTsKKwkJLyog
b25seSB1bmNvcnJlY3RhYmxlIGVycm9yIG5lZWRzIGdwdSByZXNldCAqLworCQlpZiAoZXJyX2Rh
dGEtPnVlX2NvdW50KQorCQkJYW1kZ3B1X3Jhc19yZXNldF9ncHUoYWRldiwgMCk7CisJfQogCiAJ
cmV0dXJuIEFNREdQVV9SQVNfU1VDQ0VTUzsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L25iaW9fdjdfNC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvbmJp
b192N180LmMKaW5kZXggMzY3ZjlkNi4uNTQ1OTkwYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvbmJpb192N180LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvbmJpb192N180LmMKQEAgLTMwLDYgKzMwLDcgQEAKICNpbmNsdWRlICJuYmlvL25iaW9fN180
XzBfc21uLmgiCiAjaW5jbHVkZSAiaXZzcmNpZC9uYmlvL2lycXNyY3NfbmJpZl83XzQuaCIKICNp
bmNsdWRlIDx1YXBpL2xpbnV4L2tmZF9pb2N0bC5oPgorI2luY2x1ZGUgImFtZGdwdV9yYXMuaCIK
IAogI2RlZmluZSBzbW5OQklGX01HQ0dfQ1RSTF9MQ0xLCTB4MTAxM2EyMWMKIApAQCAtMzI5LDYg
KzMzMCw4IEBAIHN0YXRpYyB2b2lkIG5iaW9fdjdfNF9oYW5kbGVfcmFzX2NvbnRyb2xsZXJfaW50
cl9ub19iaWZyaW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlCiAJCQkJCQlCSUZfRE9PUkJFTExfSU5U
X0NOVEwsCiAJCQkJCQlSQVNfQ05UTFJfSU5URVJSVVBUX0NMRUFSLCAxKTsKIAkJV1JFRzMyX1NP
QzE1KE5CSU8sIDAsIG1tQklGX0RPT1JCRUxMX0lOVF9DTlRMLCBiaWZfZG9vcmJlbGxfaW50cl9j
bnRsKTsKKworCQlhbWRncHVfcmFzX2dsb2JhbF9yYXNfaXNyKGFkZXYpOwogCX0KIH0KIApAQCAt
MzQ0LDYgKzM0Nyw4IEBAIHN0YXRpYyB2b2lkIG5iaW9fdjdfNF9oYW5kbGVfcmFzX2Vycl9ldmVu
dF9hdGh1Yl9pbnRyX25vX2JpZnJpbmcoc3RydWN0IGFtZGdwdV9kCiAJCQkJCQlCSUZfRE9PUkJF
TExfSU5UX0NOVEwsCiAJCQkJCQlSQVNfQVRIVUJfRVJSX0VWRU5UX0lOVEVSUlVQVF9DTEVBUiwg
MSk7CiAJCVdSRUczMl9TT0MxNShOQklPLCAwLCBtbUJJRl9ET09SQkVMTF9JTlRfQ05UTCwgYmlm
X2Rvb3JiZWxsX2ludHJfY250bCk7CisKKwkJYW1kZ3B1X3Jhc19nbG9iYWxfcmFzX2lzcihhZGV2
KTsKIAl9CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NkbWFf
djRfMC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2RtYV92NF8wLmMKaW5kZXggOTU2
NDMyZi4uNDM4ZTUwNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2Rt
YV92NF8wLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2RtYV92NF8wLmMKQEAg
LTE5NzIsMjQgKzE5NzIsMjYgQEAgc3RhdGljIGludCBzZG1hX3Y0XzBfcHJvY2Vzc19yYXNfZGF0
YV9jYihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAl1aW50MzJfdCBlcnJfc291cmNlOwog
CWludCBpbnN0YW5jZTsKIAotCWluc3RhbmNlID0gc2RtYV92NF8wX2lycV9pZF90b19zZXEoZW50
cnktPmNsaWVudF9pZCk7Ci0JaWYgKGluc3RhbmNlIDwgMCkKLQkJcmV0dXJuIDA7CisJaWYgKCFh
bWRncHVfcmFzX2lzX3N1cHBvcnRlZChhZGV2LCBBTURHUFVfUkFTX0JMT0NLX19HRlgpKSB7CisJ
CWluc3RhbmNlID0gc2RtYV92NF8wX2lycV9pZF90b19zZXEoZW50cnktPmNsaWVudF9pZCk7CisJ
CWlmIChpbnN0YW5jZSA8IDApCisJCQlyZXR1cm4gMDsKIAotCXN3aXRjaCAoZW50cnktPnNyY19p
ZCkgewotCWNhc2UgU0RNQTBfNF8wX19TUkNJRF9fU0RNQV9TUkFNX0VDQzoKLQkJZXJyX3NvdXJj
ZSA9IDA7Ci0JCWJyZWFrOwotCWNhc2UgU0RNQTBfNF8wX19TUkNJRF9fU0RNQV9FQ0M6Ci0JCWVy
cl9zb3VyY2UgPSAxOwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlyZXR1cm4gMDsKLQl9CisJCXN3
aXRjaCAoZW50cnktPnNyY19pZCkgeworCQljYXNlIFNETUEwXzRfMF9fU1JDSURfX1NETUFfU1JB
TV9FQ0M6CisJCQllcnJfc291cmNlID0gMDsKKwkJCWJyZWFrOworCQljYXNlIFNETUEwXzRfMF9f
U1JDSURfX1NETUFfRUNDOgorCQkJZXJyX3NvdXJjZSA9IDE7CisJCQlicmVhazsKKwkJZGVmYXVs
dDoKKwkJCXJldHVybiAwOworCQl9CiAKLQlrZ2Qya2ZkX3NldF9zcmFtX2VjY19mbGFnKGFkZXYt
PmtmZC5kZXYpOworCQlrZ2Qya2ZkX3NldF9zcmFtX2VjY19mbGFnKGFkZXYtPmtmZC5kZXYpOwog
Ci0JYW1kZ3B1X3Jhc19yZXNldF9ncHUoYWRldiwgMCk7CisJCWFtZGdwdV9yYXNfcmVzZXRfZ3B1
KGFkZXYsIDApOworCX0KIAogCXJldHVybiBBTURHUFVfUkFTX1NVQ0NFU1M7CiB9Ci0tIAoyLjcu
NAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdm
eCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
