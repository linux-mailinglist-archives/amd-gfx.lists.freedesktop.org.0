Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CD82710EE5C
	for <lists+amd-gfx@lfdr.de>; Mon,  2 Dec 2019 18:35:19 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A9C576E2CC;
	Mon,  2 Dec 2019 17:35:17 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-SN1-obe.outbound.protection.outlook.com
 (mail-sn1nam01on0611.outbound.protection.outlook.com
 [IPv6:2a01:111:f400:fe40::611])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CE3F96E2CD
 for <amd-gfx@lists.freedesktop.org>; Mon,  2 Dec 2019 17:35:16 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=CF5bvIOTP9HlrIhMhXOaTHZqhayUpsey0Owh2x9iiDEm6bXiOydz3iWE2wF9Y7Z9qYO1i4JRNSJJHViEdNh+wmxGdfy+f7JxeUPMYbuxcwORVAKf+9Wh9W/fVLbYiqh6i4bhX/42/zi5qt1CylVLqTBpASYBJxM/A/pP5nCGPyJ78jcRnf+CkAUfiyuvzrBKZieMaIcRme5XVwDJNru1wN5d0OZS9WvNoOrf7QX5XTKdeydEsnP3+gVVXwrZAbOrvnJ4z/25zhydzahQ5CoM2Y4UjwgWROINWPGwChrCGeDvMTDv2OIibAPw+VLxv8kT4sRFNs+Qd+ZPjg7jsTlolw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=tCmHIVNG0GjAgxYGjRx7kQ5bPvP8RHENYs245Cjshqg=;
 b=WhxvV40ZOatkWmsYioAlSBov43Gzcyii9GxCImk4ldHwI1DqQBaAPeDdy3vFSNkIJdE9AfPHtqS+Nez02Sg1vLbdyLkV46Bj/xHqz9Mr/yQzu8pE/s9fmcnRazP4t9fgliJVv35vso2QPsfKJm2Q0vwn6G7gNw9tvIndSd+AuTxSYhe1yuVy0PsjHY5ccgudqqs+OT9h3ruIt8G7Ns6cKPJzZ/Ls0K751DJAfyheUxBrWCFaJKN3GFHa8F6zw8BJ3aOSzRUvRqChIR8tkXoJ/11itctbMnHp0bfl19hevJxWpUfjRRkbPaKgxaFuo98ZL0XAank+eCERI7AXLtSC9Q==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
Received: from BN7PR12MB2593.namprd12.prod.outlook.com (20.176.27.87) by
 BN7PR12MB2802.namprd12.prod.outlook.com (20.176.27.97) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2495.22; Mon, 2 Dec 2019 17:34:56 +0000
Received: from BN7PR12MB2593.namprd12.prod.outlook.com
 ([fe80::2070:7583:3718:d019]) by BN7PR12MB2593.namprd12.prod.outlook.com
 ([fe80::2070:7583:3718:d019%3]) with mapi id 15.20.2495.014; Mon, 2 Dec 2019
 17:34:56 +0000
From: sunpeng.li@amd.com
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 08/51] drm/amd/display: Reset PHY in link re-training
Date: Mon,  2 Dec 2019 12:33:22 -0500
Message-Id: <20191202173405.31582-9-sunpeng.li@amd.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191202173405.31582-1-sunpeng.li@amd.com>
References: <20191202173405.31582-1-sunpeng.li@amd.com>
X-ClientProxiedBy: YTBPR01CA0029.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b01:14::42) To BN7PR12MB2593.namprd12.prod.outlook.com
 (2603:10b6:408:25::23)
MIME-Version: 1.0
X-Mailer: git-send-email 2.24.0
X-Originating-IP: [165.204.55.250]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-HT: Tenant
X-MS-Office365-Filtering-Correlation-Id: da2c24c0-715b-49b7-4612-08d7774df15a
X-MS-TrafficTypeDiagnostic: BN7PR12MB2802:|BN7PR12MB2802:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <BN7PR12MB28020C7884B063BA4CD374BC82430@BN7PR12MB2802.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:5797;
X-Forefront-PRVS: 0239D46DB6
X-Forefront-Antispam-Report: SFV:NSPM;
 SFS:(10009020)(4636009)(346002)(136003)(366004)(376002)(396003)(39860400002)(189003)(199004)(81166006)(81156014)(86362001)(6486002)(9686003)(6506007)(2870700001)(478600001)(386003)(76176011)(5660300002)(51416003)(186003)(1076003)(52116002)(3846002)(6116002)(47776003)(2616005)(26005)(66946007)(66066001)(25786009)(316002)(446003)(11346002)(14454004)(66476007)(66556008)(48376002)(8676002)(50226002)(305945005)(6512007)(36756003)(2906002)(14444005)(99286004)(6666004)(7736002)(2351001)(54906003)(4326008)(2361001)(6916009)(6436002)(50466002)(8936002);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN7PR12MB2802;
 H:BN7PR12MB2593.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: 1+TBVN3X+GFFS3nBdDGJQ4y37cQYhqlnJapvOGZy0jiWXvkV/siok2A9A6+HJFxbdqtzJ+Wq5ZGti9CqqS+g5z/J28nFqjT1D+HBnbVKJ63ZrwzEAm6/OSnBGv46Aj2k9rwjIrtXTO6hRg+LSUPT1pakihYNjh3zhC0XpAKTxZ7OPeEjj9RhAP4W4pYlkOXK1zRg5gj07d++0/l2uBltMXiG9rRTYaMUFunksYgJUBjzerhqrgn7VyXGNsNea2JBY8TE5W/KOBv1GjEEI6wXKDK+aYG9RxM7pp7DPV3zEJMtTGKk3EmYvwAKGYP0lf74esuIn1vpshTQ5cMXBfhb5uO2g98HbKFd1j+UjXVSfmiEcr8pZ1/sFcZIMDTRLcVXEJ4AC2BGcssTUwmkrxoVescU5mYkRuC7KCcy6lc0jJa5kJKTpfrFE5qnO650KlL5
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: da2c24c0-715b-49b7-4612-08d7774df15a
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 02 Dec 2019 17:34:54.4435 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: Mb5rKgi2Kz6FbcRMEJtzo0oRCNI7Fk2G87jNkB9qhTbiUdg0t+1ird/j7TM8/YfK
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN7PR12MB2802
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=tCmHIVNG0GjAgxYGjRx7kQ5bPvP8RHENYs245Cjshqg=;
 b=Rgi3h/wLLZjDU17BVEV2mQIKof2UpqF3Q16OXvFHkCvoKgYa02KvrSRhuLppFZd+Mt6jOTGYmcFpBm5wcaEOPv37EYJ7QszIP/HBojdDbekDHBIYd19/zicJtisHG7l7lNEKu1Yr5unlATp55099MdjLtFeBIlJDMwuC1pi90Uo=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Sunpeng.Li@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Leo Li <sunpeng.li@amd.com>, harry.wentland@amd.com,
 rodrigo.siqueira@amd.com, Wenjing Liu <Wenjing.Liu@amd.com>,
 Paul Hsieh <paul.hsieh@amd.com>, bhawanpreet.lakha@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogUGF1bCBIc2llaCA8cGF1bC5oc2llaEBhbWQuY29tPgoKW1doeV0KTGluayB0cmFpbmlu
ZyBmYWlsZWQgcmFuZG9tbHkgd2hlbiBwbHVnZ2luZyBVU0ItQyBkaXNwbGF5IGluL291dC4KCltI
b3ddCklmIGxpbmsgdHJhaW5pbmcgZmFpbGVkLCByZXNldCBQSFkgaW4gbGluayByZS10cmFpbmlu
Zy4KClNpZ25lZC1vZmYtYnk6IFBhdWwgSHNpZWggPHBhdWwuaHNpZWhAYW1kLmNvbT4KUmV2aWV3
ZWQtYnk6IFdlbmppbmcgTGl1IDxXZW5qaW5nLkxpdUBhbWQuY29tPgpBY2tlZC1ieTogTGVvIExp
IDxzdW5wZW5nLmxpQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2Rj
L2NvcmUvZGNfbGluay5jIHwgMzIgKystLS0tLS0tCiAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9k
Yy9jb3JlL2RjX2xpbmtfZHAuYyAgfCA2OCArKysrKysrKysrKysrKystLS0tCiAuLi4vZHJtL2Ft
ZC9kaXNwbGF5L2RjL2NvcmUvZGNfbGlua19od3NzLmMgICAgfCAxNCArLS0tCiAuLi4vZ3B1L2Ry
bS9hbWQvZGlzcGxheS9kYy9pbmMvZGNfbGlua19kcC5oICAgfCAgNSArLQogNCBmaWxlcyBjaGFu
Z2VkLCA2NiBpbnNlcnRpb25zKCspLCA1MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19saW5rLmMgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19saW5rLmMKaW5kZXggMDkzZjZjODA4ODc2Li41YTM1
Mzk1ZTYwNjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9jb3Jl
L2RjX2xpbmsuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19s
aW5rLmMKQEAgLTE0OTUsNyArMTQ5NSw2IEBAIHN0YXRpYyBlbnVtIGRjX3N0YXR1cyBlbmFibGVf
bGlua19kcCgKIAlib29sIHNraXBfdmlkZW9fcGF0dGVybjsKIAlzdHJ1Y3QgZGNfbGluayAqbGlu
ayA9IHN0cmVhbS0+bGluazsKIAlzdHJ1Y3QgZGNfbGlua19zZXR0aW5ncyBsaW5rX3NldHRpbmdz
ID0gezB9OwotCWVudW0gZHBfcGFuZWxfbW9kZSBwYW5lbF9tb2RlOwogCWJvb2wgZmVjX2VuYWJs
ZTsKIAlpbnQgaTsKIAlib29sIGFwcGx5X3NlYW1sZXNzX2Jvb3Rfb3B0aW1pemF0aW9uID0gZmFs
c2U7CkBAIC0xNTMxLDQwICsxNTMwLDE3IEBAIHN0YXRpYyBlbnVtIGRjX3N0YXR1cyBlbmFibGVf
bGlua19kcCgKIAlpZiAoc3RhdGUtPmNsa19tZ3IgJiYgIWFwcGx5X3NlYW1sZXNzX2Jvb3Rfb3B0
aW1pemF0aW9uKQogCQlzdGF0ZS0+Y2xrX21nci0+ZnVuY3MtPnVwZGF0ZV9jbG9ja3Moc3RhdGUt
PmNsa19tZ3IsIHN0YXRlLCBmYWxzZSk7CiAKLQlkcF9lbmFibGVfbGlua19waHkoCi0JCWxpbmss
Ci0JCXBpcGVfY3R4LT5zdHJlYW0tPnNpZ25hbCwKLQkJcGlwZV9jdHgtPmNsb2NrX3NvdXJjZS0+
aWQsCi0JCSZsaW5rX3NldHRpbmdzKTsKLQotCWlmIChzdHJlYW0tPnNpbmtfcGF0Y2hlcy5kcHBv
d2VydXBfZGVsYXkgPiAwKSB7Ci0JCWludCBkZWxheV9kcF9wb3dlcl91cF9pbl9tcyA9IHN0cmVh
bS0+c2lua19wYXRjaGVzLmRwcG93ZXJ1cF9kZWxheTsKLQotCQltc2xlZXAoZGVsYXlfZHBfcG93
ZXJfdXBfaW5fbXMpOwotCX0KLQotCXBhbmVsX21vZGUgPSBkcF9nZXRfcGFuZWxfbW9kZShsaW5r
KTsKLQlkcF9zZXRfcGFuZWxfbW9kZShsaW5rLCBwYW5lbF9tb2RlKTsKLQotCS8qIFdlIG5lZWQg
dG8gZG8gdGhpcyBiZWZvcmUgdGhlIGxpbmsgdHJhaW5pbmcgdG8gZW5zdXJlIHRoZSBpZGxlIHBh
dHRlcm4gaW4gU1NUCi0JICogbW9kZSB3aWxsIGJlIHNlbnQgcmlnaHQgYWZ0ZXIgdGhlIGxpbmsg
dHJhaW5pbmcgKi8KLQlsaW5rLT5saW5rX2VuYy0+ZnVuY3MtPmNvbm5lY3RfZGlnX2JlX3RvX2Zl
KGxpbmstPmxpbmtfZW5jLAotCQkJCQkJICAgIHBpcGVfY3R4LT5zdHJlYW1fcmVzLnN0cmVhbV9l
bmMtPmlkLCB0cnVlKTsKIAlza2lwX3ZpZGVvX3BhdHRlcm4gPSB0cnVlOwogCiAJaWYgKGxpbmtf
c2V0dGluZ3MubGlua19yYXRlID09IExJTktfUkFURV9MT1cpCiAJCQlza2lwX3ZpZGVvX3BhdHRl
cm4gPSBmYWxzZTsKIAotCWlmIChsaW5rLT5hdXhfYWNjZXNzX2Rpc2FibGVkKSB7Ci0JCWRjX2xp
bmtfZHBfcGVyZm9ybV9saW5rX3RyYWluaW5nX3NraXBfYXV4KGxpbmssICZsaW5rX3NldHRpbmdz
KTsKLQotCQlsaW5rLT5jdXJfbGlua19zZXR0aW5ncyA9IGxpbmtfc2V0dGluZ3M7Ci0JCXN0YXR1
cyA9IERDX09LOwotCX0gZWxzZSBpZiAocGVyZm9ybV9saW5rX3RyYWluaW5nX3dpdGhfcmV0cmll
cygKLQkJCWxpbmssCisJaWYgKHBlcmZvcm1fbGlua190cmFpbmluZ193aXRoX3JldHJpZXMoCiAJ
CQkmbGlua19zZXR0aW5ncywKIAkJCXNraXBfdmlkZW9fcGF0dGVybiwKLQkJCUxJTktfVFJBSU5J
TkdfQVRURU1QVFMpKSB7CisJCQlMSU5LX1RSQUlOSU5HX0FUVEVNUFRTLAorCQkJcGlwZV9jdHgs
CisJCQlwaXBlX2N0eC0+c3RyZWFtLT5zaWduYWwpKSB7CiAJCWxpbmstPmN1cl9saW5rX3NldHRp
bmdzID0gbGlua19zZXR0aW5nczsKIAkJc3RhdHVzID0gRENfT0s7CiAJfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2NvcmUvZGNfbGlua19kcC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2NvcmUvZGNfbGlua19kcC5jCmluZGV4IDI3MjI2MTE5
MmU4Mi4uNTM3YjRkZWU4ZjIyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3Bs
YXkvZGMvY29yZS9kY19saW5rX2RwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5
L2RjL2NvcmUvZGNfbGlua19kcC5jCkBAIC0xNDMzLDIzICsxNDMzLDU4IEBAIGVudW0gbGlua190
cmFpbmluZ19yZXN1bHQgZGNfbGlua19kcF9wZXJmb3JtX2xpbmtfdHJhaW5pbmcoCiB9CiAKIGJv
b2wgcGVyZm9ybV9saW5rX3RyYWluaW5nX3dpdGhfcmV0cmllcygKLQlzdHJ1Y3QgZGNfbGluayAq
bGluaywKIAljb25zdCBzdHJ1Y3QgZGNfbGlua19zZXR0aW5ncyAqbGlua19zZXR0aW5nLAogCWJv
b2wgc2tpcF92aWRlb19wYXR0ZXJuLAotCWludCBhdHRlbXB0cykKKwlpbnQgYXR0ZW1wdHMsCisJ
c3RydWN0IHBpcGVfY3R4ICpwaXBlX2N0eCwKKwllbnVtIHNpZ25hbF90eXBlIHNpZ25hbCkKIHsK
IAl1aW50OF90IGo7CiAJdWludDhfdCBkZWxheV9iZXR3ZWVuX2F0dGVtcHRzID0gTElOS19UUkFJ
TklOR19SRVRSWV9ERUxBWTsKKwlzdHJ1Y3QgZGNfc3RyZWFtX3N0YXRlICpzdHJlYW0gPSBwaXBl
X2N0eC0+c3RyZWFtOworCXN0cnVjdCBkY19saW5rICpsaW5rID0gc3RyZWFtLT5saW5rOworCWVu
dW0gZHBfcGFuZWxfbW9kZSBwYW5lbF9tb2RlID0gZHBfZ2V0X3BhbmVsX21vZGUobGluayk7CiAK
IAlmb3IgKGogPSAwOyBqIDwgYXR0ZW1wdHM7ICsraikgewogCi0JCWlmIChkY19saW5rX2RwX3Bl
cmZvcm1fbGlua190cmFpbmluZygKKwkJZHBfZW5hYmxlX2xpbmtfcGh5KAorCQkJbGluaywKKwkJ
CXNpZ25hbCwKKwkJCXBpcGVfY3R4LT5jbG9ja19zb3VyY2UtPmlkLAorCQkJbGlua19zZXR0aW5n
KTsKKworCQlpZiAoc3RyZWFtLT5zaW5rX3BhdGNoZXMuZHBwb3dlcnVwX2RlbGF5ID4gMCkgewor
CQkJaW50IGRlbGF5X2RwX3Bvd2VyX3VwX2luX21zID0gc3RyZWFtLT5zaW5rX3BhdGNoZXMuZHBw
b3dlcnVwX2RlbGF5OworCisJCQltc2xlZXAoZGVsYXlfZHBfcG93ZXJfdXBfaW5fbXMpOworCQl9
CisKKwkJZHBfc2V0X3BhbmVsX21vZGUobGluaywgcGFuZWxfbW9kZSk7CisKKwkJLyogV2UgbmVl
ZCB0byBkbyB0aGlzIGJlZm9yZSB0aGUgbGluayB0cmFpbmluZyB0byBlbnN1cmUgdGhlIGlkbGUg
cGF0dGVybiBpbiBTU1QKKwkJICogbW9kZSB3aWxsIGJlIHNlbnQgcmlnaHQgYWZ0ZXIgdGhlIGxp
bmsgdHJhaW5pbmcKKwkJICovCisJCWxpbmstPmxpbmtfZW5jLT5mdW5jcy0+Y29ubmVjdF9kaWdf
YmVfdG9fZmUobGluay0+bGlua19lbmMsCisJCQkJCQkJCXBpcGVfY3R4LT5zdHJlYW1fcmVzLnN0
cmVhbV9lbmMtPmlkLCB0cnVlKTsKKworCQlpZiAobGluay0+YXV4X2FjY2Vzc19kaXNhYmxlZCkg
eworCQkJZGNfbGlua19kcF9wZXJmb3JtX2xpbmtfdHJhaW5pbmdfc2tpcF9hdXgobGluaywgbGlu
a19zZXR0aW5nKTsKKwkJCXJldHVybiB0cnVlOworCQl9IGVsc2UgaWYgKGRjX2xpbmtfZHBfcGVy
Zm9ybV9saW5rX3RyYWluaW5nKAogCQkJCWxpbmssCiAJCQkJbGlua19zZXR0aW5nLAogCQkJCXNr
aXBfdmlkZW9fcGF0dGVybikgPT0gTElOS19UUkFJTklOR19TVUNDRVNTKQogCQkJcmV0dXJuIHRy
dWU7CiAKKwkJLyogbGF0ZXN0IGxpbmsgdHJhaW5pbmcgc3RpbGwgZmFpbCwgc2tpcCBkZWxheSBh
bmQga2VlcCBQSFkgb24KKwkJICovCisJCWlmIChqID09IChhdHRlbXB0cyAtIDEpKQorCQkJYnJl
YWs7CisKKwkJZHBfZGlzYWJsZV9saW5rX3BoeShsaW5rLCBzaWduYWwpOworCiAJCW1zbGVlcChk
ZWxheV9iZXR3ZWVuX2F0dGVtcHRzKTsKKwogCQlkZWxheV9iZXR3ZWVuX2F0dGVtcHRzICs9IExJ
TktfVFJBSU5JTkdfUkVUUllfREVMQVk7CiAJfQogCkBAIC0yNzcwLDE3ICsyODA1LDI2IEBAIGJv
b2wgZGNfbGlua19oYW5kbGVfaHBkX3J4X2lycShzdHJ1Y3QgZGNfbGluayAqbGluaywgdW5pb24g
aHBkX2lycV9kYXRhICpvdXRfaHBkCiAJCQkJCXNpemVvZihocGRfaXJxX2RwY2RfZGF0YSksCiAJ
CQkJCSJTdGF0dXM6ICIpOwogCi0JCXBlcmZvcm1fbGlua190cmFpbmluZ193aXRoX3JldHJpZXMo
bGluaywKLQkJCSZsaW5rLT5jdXJfbGlua19zZXR0aW5ncywKLQkJCXRydWUsIExJTktfVFJBSU5J
TkdfQVRURU1QVFMpOwotCiAJCWZvciAoaSA9IDA7IGkgPCBNQVhfUElQRVM7IGkrKykgewogCQkJ
cGlwZV9jdHggPSAmbGluay0+ZGMtPmN1cnJlbnRfc3RhdGUtPnJlc19jdHgucGlwZV9jdHhbaV07
Ci0JCQlpZiAocGlwZV9jdHggJiYgcGlwZV9jdHgtPnN0cmVhbSAmJiBwaXBlX2N0eC0+c3RyZWFt
LT5saW5rID09IGxpbmsgJiYKLQkJCQkJcGlwZV9jdHgtPnN0cmVhbS0+ZHBtc19vZmYgPT0gZmFs
c2UgJiYKLQkJCQkJcGlwZV9jdHgtPnN0cmVhbS0+c2lnbmFsID09IFNJR05BTF9UWVBFX0RJU1BM
QVlfUE9SVF9NU1QpIHsKLQkJCQlkY19saW5rX2FsbG9jYXRlX21zdF9wYXlsb2FkKHBpcGVfY3R4
KTsKLQkJCX0KKwkJCWlmIChwaXBlX2N0eCAmJiBwaXBlX2N0eC0+c3RyZWFtICYmIHBpcGVfY3R4
LT5zdHJlYW0tPmxpbmsgPT0gbGluaykKKwkJCQlicmVhazsKKwkJfQorCisJCWlmIChwaXBlX2N0
eCA9PSBOVUxMIHx8IHBpcGVfY3R4LT5zdHJlYW0gPT0gTlVMTCkKKwkJCXJldHVybiBmYWxzZTsK
KworCQlkcF9kaXNhYmxlX2xpbmtfcGh5KGxpbmssIHBpcGVfY3R4LT5zdHJlYW0tPnNpZ25hbCk7
CisKKwkJcGVyZm9ybV9saW5rX3RyYWluaW5nX3dpdGhfcmV0cmllcygmbGluay0+Y3VyX2xpbmtf
c2V0dGluZ3MsCisJCQl0cnVlLCBMSU5LX1RSQUlOSU5HX0FUVEVNUFRTLAorCQkJcGlwZV9jdHgs
CisJCQlwaXBlX2N0eC0+c3RyZWFtLT5zaWduYWwpOworCisJCWlmIChwaXBlX2N0eCAmJiBwaXBl
X2N0eC0+c3RyZWFtICYmIHBpcGVfY3R4LT5zdHJlYW0tPmxpbmsgPT0gbGluayAmJgorCQkJCXBp
cGVfY3R4LT5zdHJlYW0tPmRwbXNfb2ZmID09IGZhbHNlICYmCisJCQkJcGlwZV9jdHgtPnN0cmVh
bS0+c2lnbmFsID09IFNJR05BTF9UWVBFX0RJU1BMQVlfUE9SVF9NU1QpIHsKKwkJCWRjX2xpbmtf
YWxsb2NhdGVfbXN0X3BheWxvYWQocGlwZV9jdHgpOwogCQl9CiAKIAkJc3RhdHVzID0gZmFsc2U7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19saW5r
X2h3c3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9jb3JlL2RjX2xpbmtfaHdz
cy5jCmluZGV4IDY3Y2UxMmRmMjNmMS4uNTQ4YWFjMDJjYTExIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19saW5rX2h3c3MuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19saW5rX2h3c3MuYwpAQCAtMzMzLDIwICsz
MzMsMTIgQEAgdm9pZCBkcF9yZXRyYWluX2xpbmtfZHBfdGVzdChzdHJ1Y3QgZGNfbGluayAqbGlu
aywKIAkJCW1lbXNldCgmbGluay0+Y3VyX2xpbmtfc2V0dGluZ3MsIDAsCiAJCQkJc2l6ZW9mKGxp
bmstPmN1cl9saW5rX3NldHRpbmdzKSk7CiAKLQkJCWxpbmstPmxpbmtfZW5jLT5mdW5jcy0+ZW5h
YmxlX2RwX291dHB1dCgKLQkJCQkJCWxpbmstPmxpbmtfZW5jLAotCQkJCQkJbGlua19zZXR0aW5n
LAotCQkJCQkJcGlwZXNbaV0uY2xvY2tfc291cmNlLT5pZCk7Ci0JCQlsaW5rLT5jdXJfbGlua19z
ZXR0aW5ncyA9ICpsaW5rX3NldHRpbmc7Ci0KLQkJCWRwX3JlY2VpdmVyX3Bvd2VyX2N0cmwobGlu
aywgdHJ1ZSk7Ci0KIAkJCXBlcmZvcm1fbGlua190cmFpbmluZ193aXRoX3JldHJpZXMoCi0JCQkJ
CWxpbmssCiAJCQkJCWxpbmtfc2V0dGluZywKIAkJCQkJc2tpcF92aWRlb19wYXR0ZXJuLAotCQkJ
CQlMSU5LX1RSQUlOSU5HX0FUVEVNUFRTKTsKLQorCQkJCQlMSU5LX1RSQUlOSU5HX0FUVEVNUFRT
LAorCQkJCQkmcGlwZXNbaV0sCisJCQkJCVNJR05BTF9UWVBFX0RJU1BMQVlfUE9SVCk7CiAKIAkJ
CWxpbmstPmRjLT5od3NzLmVuYWJsZV9zdHJlYW0oJnBpcGVzW2ldKTsKIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2luYy9kY19saW5rX2RwLmggYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvaW5jL2RjX2xpbmtfZHAuaAppbmRleCA0ODc5Y2Y1NGQ4
ZjEuLjYxOThiY2NkNjE5OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5
L2RjL2luYy9kY19saW5rX2RwLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2Rj
L2luYy9kY19saW5rX2RwLmgKQEAgLTU3LDEwICs1NywxMSBAQCB2b2lkIGRlY2lkZV9saW5rX3Nl
dHRpbmdzKAogCXN0cnVjdCBkY19saW5rX3NldHRpbmdzICpsaW5rX3NldHRpbmcpOwogCiBib29s
IHBlcmZvcm1fbGlua190cmFpbmluZ193aXRoX3JldHJpZXMoCi0Jc3RydWN0IGRjX2xpbmsgKmxp
bmssCiAJY29uc3Qgc3RydWN0IGRjX2xpbmtfc2V0dGluZ3MgKmxpbmtfc2V0dGluZywKIAlib29s
IHNraXBfdmlkZW9fcGF0dGVybiwKLQlpbnQgYXR0ZW1wdHMpOworCWludCBhdHRlbXB0cywKKwlz
dHJ1Y3QgcGlwZV9jdHggKnBpcGVfY3R4LAorCWVudW0gc2lnbmFsX3R5cGUgc2lnbmFsKTsKIAog
Ym9vbCBpc19tc3Rfc3VwcG9ydGVkKHN0cnVjdCBkY19saW5rICpsaW5rKTsKIAotLSAKMi4yNC4w
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4
IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
