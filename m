Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D158CAEC72
	for <lists+amd-gfx@lfdr.de>; Tue, 10 Sep 2019 15:55:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 69C6C6E8F7;
	Tue, 10 Sep 2019 13:55:11 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM05-CO1-obe.outbound.protection.outlook.com
 (mail-eopbgr720061.outbound.protection.outlook.com [40.107.72.61])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 872AC6E0DD
 for <amd-gfx@lists.freedesktop.org>; Tue, 10 Sep 2019 13:55:09 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=Wv360stBbi3EFGCU0p2ayjTCExeCxfQ592ELtLNJPPgMMfNUgFRJNuYHkbpCqREGY9Ngw1/64kv2U3hz3/yEbneq5Zrw4ZAgLdzdDTJpa8eVOlaE90fuZg58gw6FTefHlfUKYVbQ6GhMbbw+r8sVCOUSL39YAWDKCQSKi4ZEmYjvg7PZU4YoroRm4MJIARMDW7HYusaNjbwhm2d2Ka1bDpaMpWbWkRHzs15P4LKCwFtq9hBMNIkDdXoG8qWw0hMsvPVTkUKjtwpybypbDbQ4cDA3OfXEk20Xt873KRPOBQ2x0nFmumZ9P0DqG8qptB9TWuFfsezX8Yy/9gFXT/cdjw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=mtRzxGoEBn70t0l1DpsLz3N3tPia2OKCO6+aXH4cLVA=;
 b=ATuelVbJGfcG/cOIKDH3pjbaN+9R3uSZsGmVYG1ykw1DoR460Gwf9GPDglQk+bQwHjZP2Vf2mmPeM40HDwtcw3DtuQ3bj01PoSOALU38cUuCJ1Y5S6Tg5hZTmS4wrU+KnVDCnJiuv8wJ9//9HK+oBP58W81Gq6/HaR1DUKa5DVhzJqNMCn9xcMwVDfMJ5AuBtgrCVuM6ylM/iYKF0YH/rBCukuPO4owI2eTEwi4I47asOmwc7+bTtvjB2ydbJkhx8JU5unyBSaQ0UArmn7s5XJ0jDlVR4mQAd2acdJ7LiegLwyeif8kq7Qocbpn63o+2Z2eBJ9aYq+/dCQ00bKKmEA==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org smtp.mailfrom=amd.com; 
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from DM3PR12CA0136.namprd12.prod.outlook.com (2603:10b6:0:51::32) by
 MN2PR12MB3101.namprd12.prod.outlook.com (2603:10b6:208:c4::26) with
 Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2241.15; Tue, 10 Sep 2019 13:55:07 +0000
Received: from CO1NAM03FT047.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e48::200) by DM3PR12CA0136.outlook.office365.com
 (2603:10b6:0:51::32) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id 15.20.2241.14 via Frontend
 Transport; Tue, 10 Sep 2019 13:55:07 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV01.amd.com (165.204.84.17) by
 CO1NAM03FT047.mail.protection.outlook.com (10.152.81.48) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2241.14 via Frontend Transport; Tue, 10 Sep 2019 13:55:06 +0000
Received: from localhost.localdomain (10.180.168.240) by SATLEXCHOV01.amd.com
 (10.181.40.71) with Microsoft SMTP Server id 14.3.389.1;
 Tue, 10 Sep 2019 08:55:01 -0500
From: <sunpeng.li@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 19/25] drm/amd/display: enable single dp seamless boot
Date: Tue, 10 Sep 2019 09:54:39 -0400
Message-ID: <20190910135445.18300-20-sunpeng.li@amd.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190910135445.18300-1-sunpeng.li@amd.com>
References: <20190910135445.18300-1-sunpeng.li@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(376002)(39860400002)(346002)(136003)(396003)(2980300002)(428003)(199004)(189003)(76176011)(86362001)(47776003)(446003)(26005)(476003)(2616005)(36756003)(126002)(486006)(11346002)(336012)(8936002)(426003)(2870700001)(48376002)(51416003)(478600001)(4326008)(6916009)(53936002)(186003)(50466002)(316002)(81156014)(5660300002)(54906003)(8676002)(1076003)(50226002)(2906002)(70206006)(70586007)(2876002)(356004)(6666004)(2351001)(14444005)(49486002)(305945005)(81166006);
 DIR:OUT; SFP:1101; SCL:1; SRVR:MN2PR12MB3101; H:SATLEXCHOV01.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: ffe186b8-3597-40a1-bdc1-08d735f67cd2
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600166)(711020)(4605104)(1401327)(4618075)(2017052603328);
 SRVR:MN2PR12MB3101; 
X-MS-TrafficTypeDiagnostic: MN2PR12MB3101:
X-Microsoft-Antispam-PRVS: <MN2PR12MB3101B93D96C444B5E70DD7D282B60@MN2PR12MB3101.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:8273;
X-Forefront-PRVS: 01565FED4C
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: CbpC3zkk+tNaJMISrRwhcK1V8WUW1Di+DsnFLdIllMJ2hKQOmiIfAV6+alrrMDjpLFo8N/0U2W5sahsUbeqcHgnxXT7HDlNQiSOmOp0Sb//FfdJAPej8uXaze0EtBsp/N3DwgO+VX0D/7HdLyMHgA8RxBAN8bIiTVWHjpcBbL82kyDLG5RgB5pMrqLDs0Oq3WtZqLSxgg0qsC4Iv82s6Y9t65vHppjwDN8uGNh4BUnSYOocKEedzf+gVmGaQVlZ+PJwvKdpLK809ufp+7RNZcI+FgV97j8RzqYzem+lmAL23+daspXN3wAhjptp/SPH0qGGSZlJYdFWlVlfqGQMeLgkxZ94QXCAfTWfUhB+pUst4OF7fR9Mmw/dp+xmLR1lV2DItD83+4xCepk955/lv8SMB11lV8KVsWXDbpLPhiww=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 10 Sep 2019 13:55:06.6095 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: ffe186b8-3597-40a1-bdc1-08d735f67cd2
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV01.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MN2PR12MB3101
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=mtRzxGoEBn70t0l1DpsLz3N3tPia2OKCO6+aXH4cLVA=;
 b=ZZinaJxYCjnsVEhGuUEjBUuWSgII67u6KhW6xxMtJsQ2yoT3AQYMJjqNd/YfdQ3l88072I9keGc2g0mpyMaRTre7Wmg5v1PE8ZyaKGfGNVi0MRxJjHjWPRr7Ig6+gq9hzDULiwJfXdITXN/iHB0GkHzQIJp26TT+gBFoFulbMFA=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Leo Li <sunpeng.li@amd.com>, Jun Lei <Jun.Lei@amd.com>, Anthony
 Koo <Anthony.Koo@amd.com>, Martin Leung <martin.leung@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogTWFydGluIExldW5nIDxtYXJ0aW4ubGV1bmdAYW1kLmNvbT4KClt3aHldCnNlYW1sZXNz
IGJvb3QgZGlkbid0IHdvcmsgZm9yIG5vbiBlZHAncyBiZWZvcmUKCltob3ddCnJlbW92ZWQgZWRw
LXNwZWNpZmljIGNvZGUsIG1hZGUgZHAgcmVhZCB1ZWZpLXNldCBsaW5rIHNldHRpbmdzLiBBbHNv
IGZpeGVkCmEgaHViYnViIGNvZGUgbGluZSB0byBiZSBjb25zaXN0ZW50IHdpdGggdXNhZ2Ugb2Yg
ZnVuY3Rpb24uCgpTaWduZWQtb2ZmLWJ5OiBNYXJ0aW4gTGV1bmcgPG1hcnRpbi5sZXVuZ0BhbWQu
Y29tPgpSZXZpZXdlZC1ieTogSnVuIExlaSA8SnVuLkxlaUBhbWQuY29tPgpBY2tlZC1ieTogQW50
aG9ueSBLb28gPEFudGhvbnkuS29vQGFtZC5jb20+CkFja2VkLWJ5OiBMZW8gTGkgPHN1bnBlbmcu
bGlAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kYy5j
ICAgICAgfCAzMCArKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29y
ZS9kY19saW5rLmMgfCA1NyArKysrKysrKysrKystLS0tLS0tCiAuLi4vZ3B1L2RybS9hbWQvZGlz
cGxheS9kYy9jb3JlL2RjX3Jlc291cmNlLmMgfCAyNiArKysrLS0tLS0KIC4uLi9kcm0vYW1kL2Rp
c3BsYXkvZGMvZGNuMjAvZGNuMjBfaHViYnViLmMgICB8ICA1ICstCiA0IGZpbGVzIGNoYW5nZWQs
IDcxIGluc2VydGlvbnMoKyksIDQ3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvZGlzcGxheS9kYy9jb3JlL2RjLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rp
c3BsYXkvZGMvY29yZS9kYy5jCmluZGV4IDBkN2VmODliMTdhNC4uY2FkYjI1NTgyNmJlIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kYy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9jb3JlL2RjLmMKQEAgLTk3MSwyOSArOTcxLDMz
IEBAIGJvb2wgZGNfdmFsaWRhdGVfc2VhbWxlc3NfYm9vdF90aW1pbmcoY29uc3Qgc3RydWN0IGRj
ICpkYywKIHsKIAlzdHJ1Y3QgdGltaW5nX2dlbmVyYXRvciAqdGc7CiAJc3RydWN0IGRjX2xpbmsg
KmxpbmsgPSBzaW5rLT5saW5rOwotCXVuc2lnbmVkIGludCBlbmNfaW5zdCwgdGdfaW5zdDsKKwl1
bnNpZ25lZCBpbnQgZW5jX2luc3QsIHRnX2luc3QsIGk7CisKKwkvLyBTZWFtbGVzcyBwb3J0IG9u
bHkgc3VwcG9ydCBzaW5nbGUgRFAgYW5kIEVEUCBzbyBmYXIKKwlpZiAoc2luay0+c2lua19zaWdu
YWwgIT0gU0lHTkFMX1RZUEVfRElTUExBWV9QT1JUICYmCisJCXNpbmstPnNpbmtfc2lnbmFsICE9
IFNJR05BTF9UWVBFX0VEUCkKKwkJcmV0dXJuIGZhbHNlOwogCiAJLyogQ2hlY2sgZm9yIGVuYWJs
ZWQgRElHIHRvIGlkZW50aWZ5IGVuYWJsZWQgZGlzcGxheSAqLwogCWlmICghbGluay0+bGlua19l
bmMtPmZ1bmNzLT5pc19kaWdfZW5hYmxlZChsaW5rLT5saW5rX2VuYykpCiAJCXJldHVybiBmYWxz
ZTsKIAotCS8qIENoZWNrIGZvciB3aGljaCBmcm9udCBlbmQgaXMgdXNlZCBieSB0aGlzIGVuY29k
ZXIuCi0JICogTm90ZSB0aGUgaW5zdCBpcyAxIGluZGV4ZWQsIHdoZXJlIDAgaXMgdW5kZWZpbmVk
LgotCSAqIE5vdGUgdGhhdCBESUdfRkUgY2FuIHNvdXJjZSBmcm9tIGRpZmZlcmVudCBPVEcgYnV0
IG91cgotCSAqIGN1cnJlbnQgaW1wbGVtZW50YXRpb24gYWx3YXlzIG1hcCAxLXRvLTEsIHNvIHRo
aXMgY29kZSBtYWtlcwotCSAqIHRoZSBzYW1lIGFzc3VtcHRpb24gYW5kIGRvZXNuJ3QgY2hlY2sg
T1RHIHNvdXJjZS4KLQkgKi8KIAllbmNfaW5zdCA9IGxpbmstPmxpbmtfZW5jLT5mdW5jcy0+Z2V0
X2RpZ19mcm9udGVuZChsaW5rLT5saW5rX2VuYyk7CiAKLQkvKiBJbnN0YW5jZSBzaG91bGQgYmUg
d2l0aGluIHRoZSByYW5nZSBvZiB0aGUgcG9vbCAqLwotCWlmIChlbmNfaW5zdCA+PSBkYy0+cmVz
X3Bvb2wtPnBpcGVfY291bnQpCisJaWYgKGVuY19pbnN0ID09IEVOR0lORV9JRF9VTktOT1dOKQog
CQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAoZW5jX2luc3QgPj0gZGMtPnJlc19wb29sLT5zdHJlYW1f
ZW5jX2NvdW50KQotCQlyZXR1cm4gZmFsc2U7CisJZm9yIChpID0gMDsgaSA8IGRjLT5yZXNfcG9v
bC0+c3RyZWFtX2VuY19jb3VudDsgaSsrKSB7CisJCWlmIChkYy0+cmVzX3Bvb2wtPnN0cmVhbV9l
bmNbaV0tPmlkID09IGVuY19pbnN0KSB7CisJCQl0Z19pbnN0ID0gZGMtPnJlc19wb29sLT5zdHJl
YW1fZW5jW2ldLT5mdW5jcy0+ZGlnX3NvdXJjZV9vdGcoCisJCQkJZGMtPnJlc19wb29sLT5zdHJl
YW1fZW5jW2ldKTsKKwkJCWJyZWFrOworCQl9CisJfQogCi0JdGdfaW5zdCA9IGRjLT5yZXNfcG9v
bC0+c3RyZWFtX2VuY1tlbmNfaW5zdF0tPmZ1bmNzLT5kaWdfc291cmNlX290ZygKLQkJZGMtPnJl
c19wb29sLT5zdHJlYW1fZW5jW2VuY19pbnN0XSk7CisJLy8gdGdfaW5zdCBub3QgZm91bmQKKwlp
ZiAoaSA9PSBkYy0+cmVzX3Bvb2wtPnN0cmVhbV9lbmNfY291bnQpCisJCXJldHVybiBmYWxzZTsK
IAogCWlmICh0Z19pbnN0ID49IGRjLT5yZXNfcG9vbC0+dGltaW5nX2dlbmVyYXRvcl9jb3VudCkK
IAkJcmV0dXJuIGZhbHNlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5
L2RjL2NvcmUvZGNfbGluay5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2NvcmUv
ZGNfbGluay5jCmluZGV4IGRlMDc1NzcwODVjZS4uZDZkMWVjYTc3NjY1IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19saW5rLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2NvcmUvZGNfbGluay5jCkBAIC01MTcsNyArNTE3LDcg
QEAgc3RhdGljIHZvaWQgbGlua19kaXNjb25uZWN0X3JlbWFwKHN0cnVjdCBkY19zaW5rICpwcmV2
X3NpbmssIHN0cnVjdCBkY19saW5rICpsaW4KIH0KIAogCi1zdGF0aWMgdm9pZCByZWFkX2VkcF9j
dXJyZW50X2xpbmtfc2V0dGluZ3Nfb25fZGV0ZWN0KHN0cnVjdCBkY19saW5rICpsaW5rKQorc3Rh
dGljIHZvaWQgcmVhZF9jdXJyZW50X2xpbmtfc2V0dGluZ3Nfb25fZGV0ZWN0KHN0cnVjdCBkY19s
aW5rICpsaW5rKQogewogCXVuaW9uIGxhbmVfY291bnRfc2V0IGxhbmVfY291bnRfc2V0ID0geyB7
MH0gfTsKIAl1aW50OF90IGxpbmtfYndfc2V0OwpAQCAtNTUyLDE3ICs1NTIsMjMgQEAgc3RhdGlj
IHZvaWQgcmVhZF9lZHBfY3VycmVudF9saW5rX3NldHRpbmdzX29uX2RldGVjdChzdHJ1Y3QgZGNf
bGluayAqbGluaykKIAkJCSZsaW5rX2J3X3NldCwgc2l6ZW9mKGxpbmtfYndfc2V0KSk7CiAKIAlp
ZiAobGlua19id19zZXQgPT0gMCkgewotCQkvKiBJZiBzdGFuZGFyZCBsaW5rIHJhdGVzIGFyZSBu
b3QgYmVpbmcgdXNlZCwKLQkJICogUmVhZCBEUENEIDAwMTE1aCB0byBmaW5kIHRoZSBsaW5rIHJh
dGUgc2V0IHVzZWQKLQkJICovCi0JCWNvcmVfbGlua19yZWFkX2RwY2QobGluaywgRFBfTElOS19S
QVRFX1NFVCwKLQkJCQkmbGlua19yYXRlX3NldCwgc2l6ZW9mKGxpbmtfcmF0ZV9zZXQpKTsKLQot
CQlpZiAobGlua19yYXRlX3NldCA8IGxpbmstPmRwY2RfY2Fwcy5lZHBfc3VwcG9ydGVkX2xpbmtf
cmF0ZXNfY291bnQpIHsKLQkJCWxpbmstPmN1cl9saW5rX3NldHRpbmdzLmxpbmtfcmF0ZSA9Ci0J
CQkJbGluay0+ZHBjZF9jYXBzLmVkcF9zdXBwb3J0ZWRfbGlua19yYXRlc1tsaW5rX3JhdGVfc2V0
XTsKLQkJCWxpbmstPmN1cl9saW5rX3NldHRpbmdzLmxpbmtfcmF0ZV9zZXQgPSBsaW5rX3JhdGVf
c2V0OwotCQkJbGluay0+Y3VyX2xpbmtfc2V0dGluZ3MudXNlX2xpbmtfcmF0ZV9zZXQgPSB0cnVl
OworCQlpZiAobGluay0+Y29ubmVjdG9yX3NpZ25hbCA9PSBTSUdOQUxfVFlQRV9FRFApIHsKKwkJ
CS8qIElmIHN0YW5kYXJkIGxpbmsgcmF0ZXMgYXJlIG5vdCBiZWluZyB1c2VkLAorCQkJICogUmVh
ZCBEUENEIDAwMTE1aCB0byBmaW5kIHRoZSBlZHAgbGluayByYXRlIHNldCB1c2VkCisJCQkgKi8K
KwkJCWNvcmVfbGlua19yZWFkX2RwY2QobGluaywgRFBfTElOS19SQVRFX1NFVCwKKwkJCQkJJmxp
bmtfcmF0ZV9zZXQsIHNpemVvZihsaW5rX3JhdGVfc2V0KSk7CisKKwkJCS8vIGVkcF9zdXBwb3J0
ZWRfbGlua19yYXRlc19jb3VudCA9IDAgZm9yIERQCisJCQlpZiAobGlua19yYXRlX3NldCA8IGxp
bmstPmRwY2RfY2Fwcy5lZHBfc3VwcG9ydGVkX2xpbmtfcmF0ZXNfY291bnQpIHsKKwkJCQlsaW5r
LT5jdXJfbGlua19zZXR0aW5ncy5saW5rX3JhdGUgPQorCQkJCQkJbGluay0+ZHBjZF9jYXBzLmVk
cF9zdXBwb3J0ZWRfbGlua19yYXRlc1tsaW5rX3JhdGVfc2V0XTsKKwkJCQlsaW5rLT5jdXJfbGlu
a19zZXR0aW5ncy5saW5rX3JhdGVfc2V0ID0gbGlua19yYXRlX3NldDsKKwkJCQlsaW5rLT5jdXJf
bGlua19zZXR0aW5ncy51c2VfbGlua19yYXRlX3NldCA9IHRydWU7CisJCQl9CisJCX0gZWxzZSB7
CisJCQkvLyBMaW5rIFJhdGUgbm90IGZvdW5kLiBTZWFtbGVzcyBib290IG1heSBub3Qgd29yay4K
KwkJCUFTU0VSVChmYWxzZSk7CiAJCX0KIAl9IGVsc2UgewogCQlsaW5rLT5jdXJfbGlua19zZXR0
aW5ncy5saW5rX3JhdGUgPSBsaW5rX2J3X3NldDsKQEAgLTc1MCw2ICs3NTYsNyBAQCBib29sIGRj
X2xpbmtfZGV0ZWN0KHN0cnVjdCBkY19saW5rICpsaW5rLCBlbnVtIGRjX2RldGVjdF9yZWFzb24g
cmVhc29uKQogCXN0cnVjdCBkcGNkX2NhcHMgcHJldl9kcGNkX2NhcHM7CiAJYm9vbCBzYW1lX2Rw
Y2QgPSB0cnVlOwogCWVudW0gZGNfY29ubmVjdGlvbl90eXBlIG5ld19jb25uZWN0aW9uX3R5cGUg
PSBkY19jb25uZWN0aW9uX25vbmU7CisJYm9vbCBwZXJmb3JtX2RwX3NlYW1sZXNzX2Jvb3QgPSBm
YWxzZTsKIAlEQ19MT0dHRVJfSU5JVChsaW5rLT5jdHgtPmxvZ2dlcik7CiAKIAlpZiAoZGNfaXNf
dmlydHVhbF9zaWduYWwobGluay0+Y29ubmVjdG9yX3NpZ25hbCkpCkBAIC04MDYsMTUgKzgxMywx
NSBAQCBib29sIGRjX2xpbmtfZGV0ZWN0KHN0cnVjdCBkY19saW5rICpsaW5rLCBlbnVtIGRjX2Rl
dGVjdF9yZWFzb24gcmVhc29uKQogCQl9CiAKIAkJY2FzZSBTSUdOQUxfVFlQRV9FRFA6IHsKLQkJ
CXJlYWRfZWRwX2N1cnJlbnRfbGlua19zZXR0aW5nc19vbl9kZXRlY3QobGluayk7CisJCQlyZWFk
X2N1cnJlbnRfbGlua19zZXR0aW5nc19vbl9kZXRlY3QobGluayk7CiAJCQlkZXRlY3RfZWRwX3Np
bmtfY2FwcyhsaW5rKTsKLQkJCXNpbmtfY2Fwcy50cmFuc2FjdGlvbl90eXBlID0KLQkJCQlERENf
VFJBTlNBQ1RJT05fVFlQRV9JMkNfT1ZFUl9BVVg7CisJCQlzaW5rX2NhcHMudHJhbnNhY3Rpb25f
dHlwZSA9IEREQ19UUkFOU0FDVElPTl9UWVBFX0kyQ19PVkVSX0FVWDsKIAkJCXNpbmtfY2Fwcy5z
aWduYWwgPSBTSUdOQUxfVFlQRV9FRFA7CiAJCQlicmVhazsKIAkJfQogCiAJCWNhc2UgU0lHTkFM
X1RZUEVfRElTUExBWV9QT1JUOiB7CisKIAkJCS8qIHdhIEhQRCBoaWdoIGNvbWluZyB0b28gZWFy
bHkqLwogCQkJaWYgKGxpbmstPmxpbmtfZW5jLT5mZWF0dXJlcy5mbGFncy5iaXRzLkRQX0lTX1VT
Ql9DID09IDEpIHsKIApAQCAtODY4LDYgKzg3NSwxNyBAQCBib29sIGRjX2xpbmtfZGV0ZWN0KHN0
cnVjdCBkY19saW5rICpsaW5rLCBlbnVtIGRjX2RldGVjdF9yZWFzb24gcmVhc29uKQogCQkJCXJl
dHVybiBmYWxzZTsKIAkJCX0KIAorCQkJLy8gRm9yIHNlYW1sZXNzIGJvb3QsIHRvIHNraXAgdmVy
aWZ5IGxpbmsgY2FwLCB3ZSByZWFkIFVFRkkgc2V0dGluZ3MgYW5kIHNldCB0aGVtIGFzIHZlcmlm
aWVkLgorCQkJaWYgKHJlYXNvbiA9PSBERVRFQ1RfUkVBU09OX0JPT1QgJiYKKwkJCQkJZGNfY3R4
LT5kYy0+Y29uZmlnLnBvd2VyX2Rvd25fZGlzcGxheV9vbl9ib290ID09IGZhbHNlICYmCisJCQkJ
CWxpbmstPmxpbmtfc3RhdHVzLmxpbmtfYWN0aXZlID09IHRydWUpCisJCQkJcGVyZm9ybV9kcF9z
ZWFtbGVzc19ib290ID0gdHJ1ZTsKKworCQkJaWYgKHBlcmZvcm1fZHBfc2VhbWxlc3NfYm9vdCkg
eworCQkJCXJlYWRfY3VycmVudF9saW5rX3NldHRpbmdzX29uX2RldGVjdChsaW5rKTsKKwkJCQls
aW5rLT52ZXJpZmllZF9saW5rX2NhcCA9IGxpbmstPnJlcG9ydGVkX2xpbmtfY2FwOworCQkJfQor
CiAJCQlicmVhazsKIAkJfQogCkBAIC05NTIsMTAgKzk3MCwxMSBAQCBib29sIGRjX2xpbmtfZGV0
ZWN0KHN0cnVjdCBkY19saW5rICpsaW5rLCBlbnVtIGRjX2RldGVjdF9yZWFzb24gcmVhc29uKQog
CQkJICogIHR3byBsaW5rIHRyYWluaW5ncwogCQkJICovCiAKLQkJCS8qIGRlYWwgd2l0aCBub24t
bXN0IGNhc2VzICovCi0JCQlkcF92ZXJpZnlfbGlua19jYXBfd2l0aF9yZXRyaWVzKGxpbmssCi0J
CQkJCSZsaW5rLT5yZXBvcnRlZF9saW5rX2NhcCwKLQkJCQkJTElOS19UUkFJTklOR19NQVhfVkVS
SUZZX1JFVFJZKTsKKwkJCS8vIHZlcmlmeSBsaW5rIGNhcCBmb3IgU1NUIG5vbi1zZWFtbGVzcyBi
b290CisJCQlpZiAoIXBlcmZvcm1fZHBfc2VhbWxlc3NfYm9vdCkKKwkJCQlkcF92ZXJpZnlfbGlu
a19jYXBfd2l0aF9yZXRyaWVzKGxpbmssCisJCQkJCQkmbGluay0+cmVwb3J0ZWRfbGlua19jYXAs
CisJCQkJCQlMSU5LX1RSQUlOSU5HX01BWF9WRVJJRllfUkVUUlkpOwogCQl9IGVsc2UgewogCQkJ
Ly8gSWYgZWRpZCBpcyB0aGUgc2FtZSwgdGhlbiBkaXNjYXJkIG5ldyBzaW5rIGFuZCByZXZlcnQg
YmFjayB0byBvcmlnaW5hbCBzaW5rCiAJCQlpZiAoc2FtZV9lZGlkKSB7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19yZXNvdXJjZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2NvcmUvZGNfcmVzb3VyY2UuYwppbmRleCAyYWU4ODNh
MjQ4ZGEuLmFmODVkNmNmNDQyNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNw
bGF5L2RjL2NvcmUvZGNfcmVzb3VyY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3Bs
YXkvZGMvY29yZS9kY19yZXNvdXJjZS5jCkBAIC0xODQ1LDI4ICsxODQ1LDI4IEBAIHN0YXRpYyBp
bnQgYWNxdWlyZV9yZXNvdXJjZV9mcm9tX2h3X2VuYWJsZWRfc3RhdGUoCiAJCXN0cnVjdCBkY19z
dHJlYW1fc3RhdGUgKnN0cmVhbSkKIHsKIAlzdHJ1Y3QgZGNfbGluayAqbGluayA9IHN0cmVhbS0+
bGluazsKLQl1bnNpZ25lZCBpbnQgaW5zdCwgdGdfaW5zdDsKKwl1bnNpZ25lZCBpbnQgaW5zdCwg
dGdfaW5zdCwgaTsKIAogCS8qIENoZWNrIGZvciBlbmFibGVkIERJRyB0byBpZGVudGlmeSBlbmFi
bGVkIGRpc3BsYXkgKi8KIAlpZiAoIWxpbmstPmxpbmtfZW5jLT5mdW5jcy0+aXNfZGlnX2VuYWJs
ZWQobGluay0+bGlua19lbmMpKQogCQlyZXR1cm4gLTE7CiAKLQkvKiBDaGVjayBmb3Igd2hpY2gg
ZnJvbnQgZW5kIGlzIHVzZWQgYnkgdGhpcyBlbmNvZGVyLgotCSAqIE5vdGUgdGhlIGluc3QgaXMg
MSBpbmRleGVkLCB3aGVyZSAwIGlzIHVuZGVmaW5lZC4KLQkgKiBOb3RlIHRoYXQgRElHX0ZFIGNh
biBzb3VyY2UgZnJvbSBkaWZmZXJlbnQgT1RHIGJ1dCBvdXIKLQkgKiBjdXJyZW50IGltcGxlbWVu
dGF0aW9uIGFsd2F5cyBtYXAgMS10by0xLCBzbyB0aGlzIGNvZGUgbWFrZXMKLQkgKiB0aGUgc2Ft
ZSBhc3N1bXB0aW9uIGFuZCBkb2Vzbid0IGNoZWNrIE9URyBzb3VyY2UuCi0JICovCiAJaW5zdCA9
IGxpbmstPmxpbmtfZW5jLT5mdW5jcy0+Z2V0X2RpZ19mcm9udGVuZChsaW5rLT5saW5rX2VuYyk7
CiAKLQkvKiBJbnN0YW5jZSBzaG91bGQgYmUgd2l0aGluIHRoZSByYW5nZSBvZiB0aGUgcG9vbCAq
LwotCWlmIChpbnN0ID49IHBvb2wtPnBpcGVfY291bnQpCi0JCXJldHVybiAtMTsKKwlpZiAoaW5z
dCA9PSBFTkdJTkVfSURfVU5LTk9XTikKKwkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKGluc3QgPj0g
cG9vbC0+c3RyZWFtX2VuY19jb3VudCkKLQkJcmV0dXJuIC0xOworCWZvciAoaSA9IDA7IGkgPCBw
b29sLT5zdHJlYW1fZW5jX2NvdW50OyBpKyspIHsKKwkJaWYgKHBvb2wtPnN0cmVhbV9lbmNbaV0t
PmlkID09IGluc3QpIHsKKwkJCXRnX2luc3QgPSBwb29sLT5zdHJlYW1fZW5jW2ldLT5mdW5jcy0+
ZGlnX3NvdXJjZV9vdGcoCisJCQkJcG9vbC0+c3RyZWFtX2VuY1tpXSk7CisJCQlicmVhazsKKwkJ
fQorCX0KIAotCXRnX2luc3QgPSBwb29sLT5zdHJlYW1fZW5jW2luc3RdLT5mdW5jcy0+ZGlnX3Nv
dXJjZV9vdGcocG9vbC0+c3RyZWFtX2VuY1tpbnN0XSk7CisJLy8gdGdfaW5zdCBub3QgZm91bmQK
KwlpZiAoaSA9PSBwb29sLT5zdHJlYW1fZW5jX2NvdW50KQorCQlyZXR1cm4gZmFsc2U7CiAKIAlp
ZiAodGdfaW5zdCA+PSBwb29sLT50aW1pbmdfZ2VuZXJhdG9yX2NvdW50KQogCQlyZXR1cm4gZmFs
c2U7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNu
MjBfaHViYnViLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBf
aHViYnViLmMKaW5kZXggYjgzYzAyMmUyYzZmLi5lMGE2ZTMwYWMzZTEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24yMF9odWJidWIuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfaHViYnViLmMKQEAgLTU4
OCw3ICs1ODgsNyBAQCBzdGF0aWMgdm9pZCBodWJidWIyX3Byb2dyYW1fd2F0ZXJtYXJrcygKIAkJ
CURDSFVCQlVCX0FSQl9TQVRfTEVWRUwsIDYwICogcmVmY2xrX21oeik7CiAJUkVHX1VQREFURShE
Q0hVQkJVQl9BUkJfREZfUkVRX09VVFNUQU5ELCBEQ0hVQkJVQl9BUkJfTUlOX1JFUV9PVVRTVEFO
RCwgMTgwKTsKIAotCWh1YmJ1YjFfYWxsb3dfc2VsZl9yZWZyZXNoX2NvbnRyb2woaHViYnViLCAh
aHViYnViLT5jdHgtPmRjLT5kZWJ1Zy5kaXNhYmxlX3N0dXR0ZXIpOworCWh1YmJ1Yi0+ZnVuY3Mt
PmFsbG93X3NlbGZfcmVmcmVzaF9jb250cm9sKGh1YmJ1YiwgIWh1YmJ1Yi0+Y3R4LT5kYy0+ZGVi
dWcuZGlzYWJsZV9zdHV0dGVyKTsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBodWJidWJfZnVu
Y3MgaHViYnViMl9mdW5jcyA9IHsKQEAgLTYwMCw3ICs2MDAsOCBAQCBzdGF0aWMgY29uc3Qgc3Ry
dWN0IGh1YmJ1Yl9mdW5jcyBodWJidWIyX2Z1bmNzID0gewogCS5nZXRfZGNjX2NvbXByZXNzaW9u
X2NhcCA9IGh1YmJ1YjJfZ2V0X2RjY19jb21wcmVzc2lvbl9jYXAsCiAJLndtX3JlYWRfc3RhdGUg
PSBodWJidWIyX3dtX3JlYWRfc3RhdGUsCiAJLmdldF9kY2h1Yl9yZWZfZnJlcSA9IGh1YmJ1YjJf
Z2V0X2RjaHViX3JlZl9mcmVxLAotCS5wcm9ncmFtX3dhdGVybWFya3MgPSBodWJidWIyX3Byb2dy
YW1fd2F0ZXJtYXJrcworCS5wcm9ncmFtX3dhdGVybWFya3MgPSBodWJidWIyX3Byb2dyYW1fd2F0
ZXJtYXJrcywKKwkuYWxsb3dfc2VsZl9yZWZyZXNoX2NvbnRyb2wgPSBodWJidWIxX2FsbG93X3Nl
bGZfcmVmcmVzaF9jb250cm9sCiB9OwogCiB2b2lkIGh1YmJ1YjJfY29uc3RydWN0KHN0cnVjdCBk
Y24yMF9odWJidWIgKmh1YmJ1YiwKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9hbWQtZ2Z4
