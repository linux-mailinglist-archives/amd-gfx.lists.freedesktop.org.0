Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id F31E36AD76
	for <lists+amd-gfx@lfdr.de>; Tue, 16 Jul 2019 19:12:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4D3A66E15A;
	Tue, 16 Jul 2019 17:12:00 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-BL2-obe.outbound.protection.outlook.com
 (mail-eopbgr750073.outbound.protection.outlook.com [40.107.75.73])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C00506E15A
 for <amd-gfx@lists.freedesktop.org>; Tue, 16 Jul 2019 17:11:58 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=Ml4k5JvWQPwNjM4GJj7QOkUjhcCtSXnvJzp2qUJQXkk2efRbgrK1RjjonXWG7IKTJbbnU8ByhQ1kceE1QIoj4FTbNquN+ojnK0Pm1ee2LWC6jkStQadWRLpVxn/aPuiHELazitBX/lEs0VSLmgUOdVL2/7WCZnqyjp6rpjBgZ1Wtp/wKqH4O0Bt32jLZTt3RRIQq9PWQ+DjNt4ujsF8c3dwAf3wpvUtEGYP13Q4sKncuZkEvMLiMNVDsXDIoc7tBs6YHftkictz8ljenaUrfaaIaYz9bpGciuryT57IQFGGJSJXuiLFd6HQTrBm9JJ0q4H2O0RPvNzy0sJ559oTssQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=REl81VkHb30pbj05MY59RxZB4pizX8SQnNpbAWYGfYM=;
 b=VzCDvthuqnNUbPaN0w73iz4YZlVJYL8J5bBHxM3pUpxfD9iZun7DHvm3ggkynrnfGjsuJoHGGyBT8AXpKc2ODjKE4bGOODwdD8r1eotljWRhMtSqF7qX/W597cNK2He+AVX94mAU0r7pi1a84Mz91O6zbN6mXuqKV/Tuno/3t5Cj33D3LNZHDYwKJ4hSxVUg37S26xRQx8Mv+woOGinREgbkiIsQgmpCN31ClYu8mIGZ14hAk44f0WtMuUJ0EoRj9xoyavulfTz2iFlhNw/E8qzZ43Ztk2mWYhQvEFmAYbxytLhvVxcnWV8UiJntccB8ULB1+w9ItcTAA2svt2w/2w==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=pass
 smtp.mailfrom=amd.com;dmarc=pass action=none header.from=amd.com;dkim=pass
 header.d=amd.com;arc=none
Received: from CH2PR12MB3831.namprd12.prod.outlook.com (52.132.245.141) by
 CH2PR12MB3782.namprd12.prod.outlook.com (52.132.245.12) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2073.14; Tue, 16 Jul 2019 17:11:57 +0000
Received: from CH2PR12MB3831.namprd12.prod.outlook.com
 ([fe80::6c10:a243:58ee:29e2]) by CH2PR12MB3831.namprd12.prod.outlook.com
 ([fe80::6c10:a243:58ee:29e2%4]) with mapi id 15.20.2073.012; Tue, 16 Jul 2019
 17:11:57 +0000
From: "Kim, Jonathan" <Jonathan.Kim@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: RE: [PATCH 2/3] drm/amdgpu: add perfmon and fica atomics for df
Thread-Topic: [PATCH 2/3] drm/amdgpu: add perfmon and fica atomics for df
Thread-Index: AQHVO/kciHXsTpwjmkCzl7i5kFXriabNexgg
Date: Tue, 16 Jul 2019 17:11:56 +0000
Message-ID: <CH2PR12MB3831FEB486B7716B39E7A47185CE0@CH2PR12MB3831.namprd12.prod.outlook.com>
References: <20190716170825.97385-1-jonathan.kim@amd.com>
In-Reply-To: <20190716170825.97385-1-jonathan.kim@amd.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [165.204.55.251]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: f889acf9-75bc-4327-b7ae-08d70a10b51b
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(4618075)(2017052603328)(7193020);
 SRVR:CH2PR12MB3782; 
x-ms-traffictypediagnostic: CH2PR12MB3782:
x-microsoft-antispam-prvs: <CH2PR12MB3782216C3DB1810F4D7F986C85CE0@CH2PR12MB3782.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:2958;
x-forefront-prvs: 0100732B76
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(4636009)(39860400002)(346002)(376002)(136003)(396003)(366004)(199004)(13464003)(189003)(316002)(66446008)(30864003)(99286004)(71200400001)(71190400001)(86362001)(8936002)(81166006)(81156014)(55016002)(5660300002)(478600001)(52536014)(53936002)(25786009)(305945005)(64756008)(68736007)(9686003)(7736002)(6246003)(66066001)(446003)(229853002)(2906002)(14454004)(486006)(5640700003)(2351001)(2501003)(476003)(6916009)(11346002)(33656002)(8676002)(66556008)(66476007)(76116006)(26005)(186003)(66946007)(3846002)(6116002)(74316002)(6436002)(102836004)(53546011)(6506007)(14444005)(76176011)(256004)(7696005);
 DIR:OUT; SFP:1101; SCL:1; SRVR:CH2PR12MB3782;
 H:CH2PR12MB3831.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: DKW8xNOwpiEGasE+vdM4BVRjDvEqsRcPsQeyKiEJjG/xLL/D9HDyxDaXx8M4mgOx368/4NOXHV3Ma1zW7g4Rh12qbT70/KrIuCCCWSG5NtTkTHKYBdqQBzft+e7qfHvWFmV8XdjhQkKYbVxk0DrB6fz0fvOWtY10HDAt+tv/aT9W7OjZdLttnFEzMyIKcg27Cxq3rNkLijIzUV3ib21J2RNsbRm4ciNYMHruHNDfs5fJiNR4keKu6Q1jJL+X9LdUD6dlR/XE2HMtgJt1KLka5c0zow9XS2NQe207yeBiRlvQg/FgKpl2ruiJCGbklKo7AU5qQQdjAWepv8V34sL8IPOd+HaMQFWrAKd7jnXuuVjxZJhMNKgiZzgG/Z4CLhekTOjQS/OutYlCxFghqD8UJNvNvNZocsuRvDQnVyLb7a8=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: f889acf9-75bc-4327-b7ae-08d70a10b51b
X-MS-Exchange-CrossTenant-originalarrivaltime: 16 Jul 2019 17:11:56.9032 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: jokim@amd.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: CH2PR12MB3782
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=REl81VkHb30pbj05MY59RxZB4pizX8SQnNpbAWYGfYM=;
 b=EIJkpcreDR0SMEmfZ+i0ZJfMskScWRpinM3e2zK0jVP7215gmW1lmRMmEQ3D0ruuZt3Gaaj1K2njvD/QtL3PaWSNKLHlFhJybbuj7pogiUaV0VjrfpvnNjRtaca9eOiH26og0Fea6k73kuj4dsRsPQe4Es6mWh7aYnHsllZdWB4=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Jonathan.Kim@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

Tm90ZSBwYXRjaCAxIHNlbnQgdG8gaW50ZXJuYWwgYW1kIG1haWxpbmcgbGlzdCBmb3IgcmV2aWV3
LgoKLS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0KRnJvbTogS2ltLCBKb25hdGhhbiA8Sm9uYXRo
YW4uS2ltQGFtZC5jb20+IApTZW50OiBUdWVzZGF5LCBKdWx5IDE2LCAyMDE5IDE6MDkgUE0KVG86
IGFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCkNjOiBLaW0sIEpvbmF0aGFuIDxKb25hdGhh
bi5LaW1AYW1kLmNvbT47IEtpbSwgSm9uYXRoYW4gPEpvbmF0aGFuLktpbUBhbWQuY29tPgpTdWJq
ZWN0OiBbUEFUQ0ggMi8zXSBkcm0vYW1kZ3B1OiBhZGQgcGVyZm1vbiBhbmQgZmljYSBhdG9taWNz
IGZvciBkZgoKYWRkaW5nIHBlcmZtb24gYW5kIGZpY2EgYXRvbWljIG9wZXJhdGlvbnMgdG8gYWRo
ZXJlIHRvIGRhdGEgZmFicmljcyBmaW5pdGUgc3RhdGUgbWFjaGluZSByZXF1aXJlbWVudHMgZm9y
IGluZGlyZWN0IHJlZ2lzdGVyIGFjY2Vzcy4KCkNoYW5nZS1JZDogSTJhYjE3ZmQ1OWQ1NjZiNDI1
MWM5YTlkMGU2N2I4OTdiOGMyMjEyNDkKU2lnbmVkLW9mZi1ieTogSm9uYXRoYW4gS2ltIDxKb25h
dGhhbi5LaW1AYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUu
aCAgfCAgIDMgKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jIHwgMjAyICsr
KysrKysrKysrKysrKysrLS0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAxMjggaW5zZXJ0aW9u
cygrKSwgNzcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1LmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaAppbmRl
eCAyY2RmNDZiYmVkZGYuLjc3Y2ExOTRiMTNkMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1LmgKQEAgLTcwOCw2ICs3MDgsOSBAQCBzdHJ1Y3QgYW1kZ3B1X2RmX2Z1bmNzIHsKIAkJCQkJ
IGludCBpc19kaXNhYmxlKTsKIAl2b2lkICgqcG1jX2dldF9jb3VudCkoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsIHVpbnQ2NF90IGNvbmZpZywKIAkJCQkJIHVpbnQ2NF90ICpjb3VudCk7CisJ
dWludDY0X3QgKCpnZXRfZmljYSkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90
IGZpY2FhX3ZhbCk7CisJdm9pZCAoKnNldF9maWNhKShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
diwgdWludDMyX3QgZmljYWFfdmFsLAorCQkJIHVpbnQzMl90IGZpY2FkbF92YWwsIHVpbnQzMl90
IGZpY2FkaF92YWwpOwogfTsKIC8qIERlZmluZSB0aGUgSFcgSVAgYmxvY2tzIHdpbGwgYmUgdXNl
ZCBpbiBkcml2ZXIgLCBhZGQgbW9yZSBpZiBuZWNlc3NhcnkgKi8gIGVudW0gYW1kX2h3X2lwX2Js
b2NrX3R5cGUgeyBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNf
Ni5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jCmluZGV4IGVmNmU5MWY5
ZjUxYy4uNTg1MGM4ZTM0Y2FhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9kZl92M182LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jCkBA
IC05Myw2ICs5Myw5NiBAQCBjb25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwICpkZl92M182X2F0
dHJfZ3JvdXBzW10gPSB7CiAJCU5VTEwKIH07CiAKK3N0YXRpYyB1aW50NjRfdCBkZl92M182X2dl
dF9maWNhKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJCSB1aW50MzJfdCBmaWNhYV92
YWwpCit7CisJdW5zaWduZWQgbG9uZyBmbGFncywgYWRkcmVzcywgZGF0YTsKKwl1aW50MzJfdCBm
aWNhZGxfdmFsLCBmaWNhZGhfdmFsOworCisJYWRkcmVzcyA9IGFkZXYtPm5iaW9fZnVuY3MtPmdl
dF9wY2llX2luZGV4X29mZnNldChhZGV2KTsKKwlkYXRhID0gYWRldi0+bmJpb19mdW5jcy0+Z2V0
X3BjaWVfZGF0YV9vZmZzZXQoYWRldik7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmYWRldi0+cGNp
ZV9pZHhfbG9jaywgZmxhZ3MpOworCVdSRUczMihhZGRyZXNzLCBzbW5ERl9QSUVfQU9OX0ZhYnJp
Y0luZGlyZWN0Q29uZmlnQWNjZXNzQWRkcmVzczMpOworCVdSRUczMihkYXRhLCBmaWNhYV92YWwp
OworCisJV1JFRzMyKGFkZHJlc3MsIHNtbkRGX1BJRV9BT05fRmFicmljSW5kaXJlY3RDb25maWdB
Y2Nlc3NEYXRhTG8zKTsKKwlmaWNhZGxfdmFsID0gUlJFRzMyKGRhdGEpOworCisJV1JFRzMyKGFk
ZHJlc3MsIHNtbkRGX1BJRV9BT05fRmFicmljSW5kaXJlY3RDb25maWdBY2Nlc3NEYXRhSGkzKTsK
KwlmaWNhZGhfdmFsID0gUlJFRzMyKGRhdGEpOworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
YWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOworCisJcmV0dXJuICgoKGZpY2FkaF92YWwgJiAw
eEZGRkZGRkZGRkZGRkZGRkYpIDw8IDMyKSB8IGZpY2FkbF92YWwpOyB9CisKK3N0YXRpYyB2b2lk
IGRmX3YzXzZfc2V0X2ZpY2Eoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IGZp
Y2FhX3ZhbCwKKwkJCSAgICAgdWludDMyX3QgZmljYWRsX3ZhbCwgdWludDMyX3QgZmljYWRoX3Zh
bCkgeworCXVuc2lnbmVkIGxvbmcgZmxhZ3MsIGFkZHJlc3MsIGRhdGE7CisKKwlhZGRyZXNzID0g
YWRldi0+bmJpb19mdW5jcy0+Z2V0X3BjaWVfaW5kZXhfb2Zmc2V0KGFkZXYpOworCWRhdGEgPSBh
ZGV2LT5uYmlvX2Z1bmNzLT5nZXRfcGNpZV9kYXRhX29mZnNldChhZGV2KTsKKworCXNwaW5fbG9j
a19pcnFzYXZlKCZhZGV2LT5wY2llX2lkeF9sb2NrLCBmbGFncyk7CisJV1JFRzMyKGFkZHJlc3Ms
IHNtbkRGX1BJRV9BT05fRmFicmljSW5kaXJlY3RDb25maWdBY2Nlc3NBZGRyZXNzMyk7CisJV1JF
RzMyKGRhdGEsIGZpY2FhX3ZhbCk7CisKKwlXUkVHMzIoYWRkcmVzcywgc21uREZfUElFX0FPTl9G
YWJyaWNJbmRpcmVjdENvbmZpZ0FjY2Vzc0RhdGFMbzMpOworCVdSRUczMihkYXRhLCBmaWNhZGxf
dmFsKTsKKworCVdSRUczMihhZGRyZXNzLCBzbW5ERl9QSUVfQU9OX0ZhYnJpY0luZGlyZWN0Q29u
ZmlnQWNjZXNzRGF0YUhpMyk7CisJV1JFRzMyKGRhdGEsIGZpY2FkaF92YWwpOworCisJc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmYWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOyB9CisKKy8qCisg
KiBkZl92M182X3BlcmZtb25fcnJlZyAtIHJlYWQgcGVyZm1vbiBsbyBhbmQgaGkKKyAqCisgKiBy
ZXF1aXJlZCB0byBiZSBhdG9taWMuICBubyBtbWlvIG1ldGhvZCBwcm92aWRlZCBzbyBzdWJzZXF1
ZW50IHJlYWRzIAorZm9yIGxvCisgKiBhbmQgaGkgcmVxdWlyZSB0byBwcmVzZXJ2ZSBkZiBmaW5p
dGUgc3RhdGUgbWFjaGluZSAgKi8gc3RhdGljIHZvaWQgCitkZl92M182X3BlcmZtb25fcnJlZyhz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKKwkJCSAgICB1aW50MzJfdCBsb19hZGRyLCB1aW50
MzJfdCAqbG9fdmFsLAorCQkJICAgIHVpbnQzMl90IGhpX2FkZHIsIHVpbnQzMl90ICpoaV92YWwp
IHsKKwl1bnNpZ25lZCBsb25nIGZsYWdzLCBhZGRyZXNzLCBkYXRhOworCisJYWRkcmVzcyA9IGFk
ZXYtPm5iaW9fZnVuY3MtPmdldF9wY2llX2luZGV4X29mZnNldChhZGV2KTsKKwlkYXRhID0gYWRl
di0+bmJpb19mdW5jcy0+Z2V0X3BjaWVfZGF0YV9vZmZzZXQoYWRldik7CisKKwlzcGluX2xvY2tf
aXJxc2F2ZSgmYWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOworCVdSRUczMihhZGRyZXNzLCBs
b19hZGRyKTsKKwkqbG9fdmFsID0gUlJFRzMyKGRhdGEpOworCVdSRUczMihhZGRyZXNzLCBoaV9h
ZGRyKTsKKwkqaGlfdmFsID0gUlJFRzMyKGRhdGEpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
JmFkZXYtPnBjaWVfaWR4X2xvY2ssIGZsYWdzKTsgfQorCisvKgorICogZGZfdjNfNl9wZXJmbW9u
X3dyZWcgLSB3cml0ZSB0byBwZXJmbW9uIGxvIGFuZCBoaQorICoKKyAqIHJlcXVpcmVkIHRvIGJl
IGF0b21pYy4gIG5vIG1taW8gbWV0aG9kIHByb3ZpZGVkIHNvIHN1YnNlcXVlbnQgcmVhZHMgCith
ZnRlcgorICogZGF0YSB3cml0ZXMgY2Fubm90IG9jY3VyIHRvIHByZXNlcnZlIGRhdGEgZmFicmlj
cyBmaW5pdGUgc3RhdGUgbWFjaGluZS4KKyAqLworc3RhdGljIHZvaWQgZGZfdjNfNl9wZXJmbW9u
X3dyZWcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IGxvX2FkZHIsCisJCQkg
ICAgdWludDMyX3QgbG9fdmFsLCB1aW50MzJfdCBoaV9hZGRyLCB1aW50MzJfdCBoaV92YWwpIHsK
Kwl1bnNpZ25lZCBsb25nIGZsYWdzLCBhZGRyZXNzLCBkYXRhOworCisJYWRkcmVzcyA9IGFkZXYt
Pm5iaW9fZnVuY3MtPmdldF9wY2llX2luZGV4X29mZnNldChhZGV2KTsKKwlkYXRhID0gYWRldi0+
bmJpb19mdW5jcy0+Z2V0X3BjaWVfZGF0YV9vZmZzZXQoYWRldik7CisKKwlzcGluX2xvY2tfaXJx
c2F2ZSgmYWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOworCVdSRUczMihhZGRyZXNzLCBsb19h
ZGRyKTsKKwlXUkVHMzIoZGF0YSwgbG9fdmFsKTsKKwlXUkVHMzIoYWRkcmVzcywgaGlfYWRkcik7
CisJV1JFRzMyKGRhdGEsIGhpX3ZhbCk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYWRldi0+
cGNpZV9pZHhfbG9jaywgZmxhZ3MpOyB9CisKIC8qIGdldCB0aGUgbnVtYmVyIG9mIGRmIGNvdW50
ZXJzIGF2YWlsYWJsZSAqLyAgc3RhdGljIHNzaXplX3QgZGZfdjNfNl9nZXRfZGZfY250cl9hdmFp
bChzdHJ1Y3QgZGV2aWNlICpkZXYsCiAJCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLApA
QCAtMjY4LDYgKzM1OCwxMCBAQCBzdGF0aWMgaW50IGRmX3YzXzZfcG1jX2dldF9jdHJsX3NldHRp
bmdzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkJCQkgIHVpbnQzMl90ICpsb192YWws
CiAJCQkJCSAgdWludDMyX3QgKmhpX3ZhbCkKIHsKKworCXVpbnQzMl90IGV2ZW50c2VsLCBpbnN0
YW5jZSwgdW5pdG1hc2s7CisJdWludDMyX3QgaW5zdGFuY2VfMTAsIGluc3RhbmNlXzU0MzIsIGlu
c3RhbmNlXzc2OworCiAJZGZfdjNfNl9wbWNfZ2V0X2FkZHIoYWRldiwgY29uZmlnLCAxLCBsb19i
YXNlX2FkZHIsIGhpX2Jhc2VfYWRkcik7CiAKIAlpZiAoKCpsb19iYXNlX2FkZHIgPT0gMCkgfHwg
KCpoaV9iYXNlX2FkZHIgPT0gMCkpIHsgQEAgLTI3Niw0MCArMzcwLDMzIEBAIHN0YXRpYyBpbnQg
ZGZfdjNfNl9wbWNfZ2V0X2N0cmxfc2V0dGluZ3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYs
CiAJCXJldHVybiAtRU5YSU87CiAJfQogCi0JaWYgKGxvX3ZhbCAmJiBoaV92YWwpIHsKLQkJdWlu
dDMyX3QgZXZlbnRzZWwsIGluc3RhbmNlLCB1bml0bWFzazsKLQkJdWludDMyX3QgaW5zdGFuY2Vf
MTAsIGluc3RhbmNlXzU0MzIsIGluc3RhbmNlXzc2OworCWV2ZW50c2VsID0gREZfVjNfNl9HRVRf
RVZFTlQoY29uZmlnKSAmIDB4M2Y7CisJdW5pdG1hc2sgPSBERl9WM182X0dFVF9VTklUTUFTSyhj
b25maWcpICYgMHhmOworCWluc3RhbmNlID0gREZfVjNfNl9HRVRfSU5TVEFOQ0UoY29uZmlnKTsK
IAotCQlldmVudHNlbCA9IERGX1YzXzZfR0VUX0VWRU5UKGNvbmZpZykgJiAweDNmOwotCQl1bml0
bWFzayA9IERGX1YzXzZfR0VUX1VOSVRNQVNLKGNvbmZpZykgJiAweGY7Ci0JCWluc3RhbmNlID0g
REZfVjNfNl9HRVRfSU5TVEFOQ0UoY29uZmlnKTsKKwlpbnN0YW5jZV8xMCA9IGluc3RhbmNlICYg
MHgzOworCWluc3RhbmNlXzU0MzIgPSAoaW5zdGFuY2UgPj4gMikgJiAweGY7CisJaW5zdGFuY2Vf
NzYgPSAoaW5zdGFuY2UgPj4gNikgJiAweDM7CiAKLQkJaW5zdGFuY2VfMTAgPSBpbnN0YW5jZSAm
IDB4MzsKLQkJaW5zdGFuY2VfNTQzMiA9IChpbnN0YW5jZSA+PiAyKSAmIDB4ZjsKLQkJaW5zdGFu
Y2VfNzYgPSAoaW5zdGFuY2UgPj4gNikgJiAweDM7CisJKmxvX3ZhbCA9ICh1bml0bWFzayA8PCA4
KSB8IChpbnN0YW5jZV8xMCA8PCA2KSB8IGV2ZW50c2VsIHwgKDEgPDwgMjIpOworCSpoaV92YWwg
PSAoaW5zdGFuY2VfNzYgPDwgMjkpIHwgaW5zdGFuY2VfNTQzMjsKIAotCQkqbG9fdmFsID0gKHVu
aXRtYXNrIDw8IDgpIHwgKGluc3RhbmNlXzEwIDw8IDYpIHwgZXZlbnRzZWw7Ci0JCSpoaV92YWwg
PSAoaW5zdGFuY2VfNzYgPDwgMjkpIHwgaW5zdGFuY2VfNTQzMjsKLQl9CisJRFJNX0RFQlVHX0RS
SVZFUigiY29uZmlnPSVsbHggYWRkcj0lMDh4OiUwOHggdmFsPSUwOHg6JTA4eCIsCisJCWNvbmZp
ZywgKmxvX2Jhc2VfYWRkciwgKmhpX2Jhc2VfYWRkciwgKmxvX3ZhbCwgKmhpX3ZhbCk7CiAKIAly
ZXR1cm4gMDsKIH0KIAotLyogYXNzaWduIGRmIHBlcmZvcm1hbmNlIGNvdW50ZXJzIGZvciByZWFk
ICovIC1zdGF0aWMgaW50IGRmX3YzXzZfcG1jX2Fzc2lnbl9jbnRyKHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LAotCQkJCSAgIHVpbnQ2NF90IGNvbmZpZywKLQkJCQkgICBpbnQgKmlzX2Fzc2ln
bmVkKQorLyogYWRkIGRmIHBlcmZvcm1hbmNlIGNvdW50ZXJzIGZvciByZWFkICovIHN0YXRpYyBp
bnQgCitkZl92M182X3BtY19hZGRfY250cihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKKwkJ
CQkgICB1aW50NjRfdCBjb25maWcpCiB7CiAJaW50IGksIHRhcmdldF9jbnRyOwogCi0JKmlzX2Fz
c2lnbmVkID0gMDsKLQogCXRhcmdldF9jbnRyID0gZGZfdjNfNl9wbWNfY29uZmlnXzJfY250cihh
ZGV2LCBjb25maWcpOwogCi0JaWYgKHRhcmdldF9jbnRyID49IDApIHsKLQkJKmlzX2Fzc2lnbmVk
ID0gMTsKKwlpZiAodGFyZ2V0X2NudHIgPj0gMCkKIAkJcmV0dXJuIDA7Ci0JfQogCiAJZm9yIChp
ID0gMDsgaSA8IERGX1YzXzZfTUFYX0NPVU5URVJTOyBpKyspIHsKIAkJaWYgKGFkZXYtPmRmX3Bl
cmZtb25fY29uZmlnX2Fzc2lnbl9tYXNrW2ldID09IDBVKSB7IEBAIC0zNDQsNDUgKzQzMSwxMyBA
QCBzdGF0aWMgdm9pZCBkZl92M182X3Jlc2V0X3BlcmZtb25fY250cihzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwKIAlpZiAoKGxvX2Jhc2VfYWRkciA9PSAwKSB8fCAoaGlfYmFzZV9hZGRyID09
IDApKQogCQlyZXR1cm47CiAKLQlXUkVHMzJfUENJRShsb19iYXNlX2FkZHIsIDBVTCk7Ci0JV1JF
RzMyX1BDSUUoaGlfYmFzZV9hZGRyLCAwVUwpOwotfQotCi0KLXN0YXRpYyBpbnQgZGZfdjNfNl9h
ZGRfcGVyZm1vbl9jbnRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAotCQkJCSAgICAgIHVp
bnQ2NF90IGNvbmZpZykKLXsKLQl1aW50MzJfdCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwg
bG9fdmFsLCBoaV92YWw7Ci0JaW50IHJldCwgaXNfYXNzaWduZWQ7Ci0KLQlyZXQgPSBkZl92M182
X3BtY19hc3NpZ25fY250cihhZGV2LCBjb25maWcsICZpc19hc3NpZ25lZCk7Ci0KLQlpZiAocmV0
IHx8IGlzX2Fzc2lnbmVkKQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gZGZfdjNfNl9wbWNfZ2V0
X2N0cmxfc2V0dGluZ3MoYWRldiwKLQkJCWNvbmZpZywKLQkJCSZsb19iYXNlX2FkZHIsCi0JCQkm
aGlfYmFzZV9hZGRyLAotCQkJJmxvX3ZhbCwKLQkJCSZoaV92YWwpOwotCi0JaWYgKHJldCkKLQkJ
cmV0dXJuIHJldDsKLQotCURSTV9ERUJVR19EUklWRVIoImNvbmZpZz0lbGx4IGFkZHI9JTA4eDol
MDh4IHZhbD0lMDh4OiUwOHgiLAotCQkJY29uZmlnLCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRk
ciwgbG9fdmFsLCBoaV92YWwpOwotCi0JV1JFRzMyX1BDSUUobG9fYmFzZV9hZGRyLCBsb192YWwp
OwotCVdSRUczMl9QQ0lFKGhpX2Jhc2VfYWRkciwgaGlfdmFsKTsKLQotCXJldHVybiByZXQ7CisJ
ZGZfdjNfNl9wZXJmbW9uX3dyZWcoYWRldiwgbG9fYmFzZV9hZGRyLCAwLCBoaV9iYXNlX2FkZHIs
IDApOwogfQogCiBzdGF0aWMgaW50IGRmX3YzXzZfcG1jX3N0YXJ0KHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LCB1aW50NjRfdCBjb25maWcsCiAJCQkgICAgIGludCBpc19lbmFibGUpCiB7Ci0J
dWludDMyX3QgbG9fYmFzZV9hZGRyLCBoaV9iYXNlX2FkZHIsIGxvX3ZhbDsKKwl1aW50MzJfdCBs
b19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwgbG9fdmFsLCBoaV92YWw7CiAJaW50IHJldCA9IDA7
CiAKIAlzd2l0Y2ggKGFkZXYtPmFzaWNfdHlwZSkgewpAQCAtMzkxLDI0ICs0NDYsMjAgQEAgc3Rh
dGljIGludCBkZl92M182X3BtY19zdGFydChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdWlu
dDY0X3QgY29uZmlnLAogCQlkZl92M182X3Jlc2V0X3BlcmZtb25fY250cihhZGV2LCBjb25maWcp
OwogCiAJCWlmIChpc19lbmFibGUpIHsKLQkJCXJldCA9IGRmX3YzXzZfYWRkX3BlcmZtb25fY250
cihhZGV2LCBjb25maWcpOworCQkJcmV0ID0gZGZfdjNfNl9wbWNfYWRkX2NudHIoYWRldiwgY29u
ZmlnKTsKIAkJfSBlbHNlIHsKIAkJCXJldCA9IGRmX3YzXzZfcG1jX2dldF9jdHJsX3NldHRpbmdz
KGFkZXYsCiAJCQkJCWNvbmZpZywKIAkJCQkJJmxvX2Jhc2VfYWRkciwKIAkJCQkJJmhpX2Jhc2Vf
YWRkciwKLQkJCQkJTlVMTCwKLQkJCQkJTlVMTCk7CisJCQkJCSZsb192YWwsCisJCQkJCSZoaV92
YWwpOwogCiAJCQlpZiAocmV0KQogCQkJCXJldHVybiByZXQ7CiAKLQkJCWxvX3ZhbCA9IFJSRUcz
Ml9QQ0lFKGxvX2Jhc2VfYWRkcik7Ci0KLQkJCURSTV9ERUJVR19EUklWRVIoImNvbmZpZz0lbGx4
IGFkZHI9JTA4eDolMDh4IHZhbD0lMDh4IiwKLQkJCQljb25maWcsIGxvX2Jhc2VfYWRkciwgaGlf
YmFzZV9hZGRyLCBsb192YWwpOwotCi0JCQlXUkVHMzJfUENJRShsb19iYXNlX2FkZHIsIGxvX3Zh
bCB8ICgxVUxMIDw8IDIyKSk7CisJCQlkZl92M182X3BlcmZtb25fd3JlZyhhZGV2LCBsb19iYXNl
X2FkZHIsIGxvX3ZhbCwKKwkJCQkJaGlfYmFzZV9hZGRyLCBoaV92YWwpOwogCQl9CiAKIAkJYnJl
YWs7CkBAIC00MjIsNyArNDczLDcgQEAgc3RhdGljIGludCBkZl92M182X3BtY19zdGFydChzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdWludDY0X3QgY29uZmlnLCAgc3RhdGljIGludCBkZl92
M182X3BtY19zdG9wKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50NjRfdCBjb25maWcs
CiAJCQkgICAgaW50IGlzX2Rpc2FibGUpCiB7Ci0JdWludDMyX3QgbG9fYmFzZV9hZGRyLCBoaV9i
YXNlX2FkZHIsIGxvX3ZhbDsKKwl1aW50MzJfdCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwg
bG9fdmFsLCBoaV92YWw7CiAJaW50IHJldCA9IDA7CiAKIAlzd2l0Y2ggKGFkZXYtPmFzaWNfdHlw
ZSkgewpAQCAtNDMxLDE4ICs0ODIsMTMgQEAgc3RhdGljIGludCBkZl92M182X3BtY19zdG9wKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50NjRfdCBjb25maWcsCiAJCQljb25maWcsCiAJ
CQkmbG9fYmFzZV9hZGRyLAogCQkJJmhpX2Jhc2VfYWRkciwKLQkJCU5VTEwsCi0JCQlOVUxMKTsK
KwkJCSZsb192YWwsCisJCQkmaGlfdmFsKTsKIAogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsK
IAotCQlsb192YWwgPSBSUkVHMzJfUENJRShsb19iYXNlX2FkZHIpOwotCi0JCURSTV9ERUJVR19E
UklWRVIoImNvbmZpZz0lbGx4IGFkZHI9JTA4eDolMDh4IHZhbD0lMDh4IiwKLQkJCQljb25maWcs
IGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWwpOwotCi0JCVdSRUczMl9QQ0lFKGxv
X2Jhc2VfYWRkciwgbG9fdmFsICYgfigxVUxMIDw8IDIyKSk7CisJCWRmX3YzXzZfcGVyZm1vbl93
cmVnKGFkZXYsIGxvX2Jhc2VfYWRkciwgMCwgaGlfYmFzZV9hZGRyLCAwKTsKIAogCQlpZiAoaXNf
ZGlzYWJsZSkKIAkJCWRmX3YzXzZfcG1jX3JlbGVhc2VfY250cihhZGV2LCBjb25maWcpOyBAQCAt
NDcxLDggKzUxNyw4IEBAIHN0YXRpYyB2b2lkIGRmX3YzXzZfcG1jX2dldF9jb3VudChzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldiwKIAkJaWYgKChsb19iYXNlX2FkZHIgPT0gMCkgfHwgKGhpX2Jh
c2VfYWRkciA9PSAwKSkKIAkJCXJldHVybjsKIAotCQlsb192YWwgPSBSUkVHMzJfUENJRShsb19i
YXNlX2FkZHIpOwotCQloaV92YWwgPSBSUkVHMzJfUENJRShoaV9iYXNlX2FkZHIpOworCQlkZl92
M182X3BlcmZtb25fcnJlZyhhZGV2LCBsb19iYXNlX2FkZHIsICZsb192YWwsCisJCQkJaGlfYmFz
ZV9hZGRyLCAmaGlfdmFsKTsKIAogCQkqY291bnQgID0gKChoaV92YWwgfCAwVUxMKSA8PCAzMikg
fCAobG9fdmFsIHwgMFVMTCk7CiAKQEAgLTQ4MCw3ICs1MjYsNyBAQCBzdGF0aWMgdm9pZCBkZl92
M182X3BtY19nZXRfY291bnQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkqY291bnQg
PSAwOwogCiAJCURSTV9ERUJVR19EUklWRVIoImNvbmZpZz0lbGx4IGFkZHI9JTA4eDolMDh4IHZh
bD0lMDh4OiUwOHgiLAotCQkJY29uZmlnLCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwgbG9f
dmFsLCBoaV92YWwpOworCQkJIGNvbmZpZywgbG9fYmFzZV9hZGRyLCBoaV9iYXNlX2FkZHIsIGxv
X3ZhbCwgaGlfdmFsKTsKIAogCQlicmVhazsKIApAQCAtNDk5LDUgKzU0NSw3IEBAIGNvbnN0IHN0
cnVjdCBhbWRncHVfZGZfZnVuY3MgZGZfdjNfNl9mdW5jcyA9IHsKIAkuZ2V0X2Nsb2NrZ2F0aW5n
X3N0YXRlID0gZGZfdjNfNl9nZXRfY2xvY2tnYXRpbmdfc3RhdGUsCiAJLnBtY19zdGFydCA9IGRm
X3YzXzZfcG1jX3N0YXJ0LAogCS5wbWNfc3RvcCA9IGRmX3YzXzZfcG1jX3N0b3AsCi0JLnBtY19n
ZXRfY291bnQgPSBkZl92M182X3BtY19nZXRfY291bnQKKwkucG1jX2dldF9jb3VudCA9IGRmX3Yz
XzZfcG1jX2dldF9jb3VudCwKKwkuZ2V0X2ZpY2EgPSBkZl92M182X2dldF9maWNhLAorCS5zZXRf
ZmljYSA9IGRmX3YzXzZfc2V0X2ZpY2EKIH07Ci0tCjIuMTcuMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9hbWQtZ2Z4
