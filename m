Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 76A8110579E
	for <lists+amd-gfx@lfdr.de>; Thu, 21 Nov 2019 17:55:43 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0691D6F4AE;
	Thu, 21 Nov 2019 16:55:42 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qk1-x742.google.com (mail-qk1-x742.google.com
 [IPv6:2607:f8b0:4864:20::742])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1452E6F4AE
 for <amd-gfx@lists.freedesktop.org>; Thu, 21 Nov 2019 16:55:41 +0000 (UTC)
Received: by mail-qk1-x742.google.com with SMTP id m16so3614768qki.11
 for <amd-gfx@lists.freedesktop.org>; Thu, 21 Nov 2019 08:55:41 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=um+eRMu9DDjEZEMuS0r3JcJz7MLntdCmOOLNDnjWv14=;
 b=Ztg7PU4K23SswbMy/jXmaxedRKixI4k34l6SogAlKu4P2UzpNr8Vr/8PAtytXmAsJR
 KxpyhGQ1Lw/DJvibcDaV4+ZpXx22Wk7tXWs3oLntlUSfkf4UtQ/wEl0tpMY2ANvNKKIm
 2Zitu2Aq1Bbshsnj/NGdnFy8nnk74xdUnPWd2wbX7JBcer49HRAGXl3KMc6OWQcPz0ry
 dg3DENXlvzDgnZ5ptjO8vRTqaJBTd6nKmY10QS20Ittfz7jY8EPVBwVFAh3Bx3wFN0Ol
 B23UXHrFcNvFPjeKrzb2V5m2a+J19vUCiUWKAAdt80N6P9nYZ5gEYNueRRd6K1K/dUDk
 PBzQ==
X-Gm-Message-State: APjAAAWs3U43R67Q/IxMhOnlR1USN1cmNaLnElhP+jS5Jg2lJAxO7ChX
 vq24dz9xwQjheuP8rZ25AlwRJeWk
X-Google-Smtp-Source: APXvYqxIunRxhus3kLT18ST+1CG3B8MrefF6nveZLRo3D7AGMu8O15gWnENPGPO9Y/oy9JfJFofJIw==
X-Received: by 2002:a37:b607:: with SMTP id g7mr4299291qkf.68.1574355338592;
 Thu, 21 Nov 2019 08:55:38 -0800 (PST)
Received: from localhost.localdomain ([71.219.59.120])
 by smtp.gmail.com with ESMTPSA id m22sm1646905qka.28.2019.11.21.08.55.37
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 21 Nov 2019 08:55:38 -0800 (PST)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH] drm/amdgpu: move pci handling out of pm ops
Date: Thu, 21 Nov 2019 11:55:29 -0500
Message-Id: <20191121165529.3941-1-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=um+eRMu9DDjEZEMuS0r3JcJz7MLntdCmOOLNDnjWv14=;
 b=pEevmYsIC83UN4dlUD5g/DawXFSh1bozs7RQAmoVTNMYmrI3VqZ1NCizuAUwT4zyCX
 fzq58YS+LhiZWRuhvLQOy3HkwbzycZ9KeTL95KtbiewlKvoF0SmT9aSL6WGVfzZN/Na2
 Ee0FBx6s2+zbpVQ2movdJ/IB2psgDiwqIilwXR44U5I5PIIZ2zBFnywYswj8tc+58ZRr
 gv8ET7xmG5t1DIUr3LiZ5StySp6EGXkJEEVRVRxndRZB04aU3g3/4ViObKxtF5hcoRlU
 F7OOt+xsnplcjQCCTBf8wAPl3fCUmIhnS1ALblBbBVW7xNipQqI6J2DChyzDVZh+FCv5
 eOwg==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhlIGRvY3VtZW50YXRpb24gc2F5cyB0aGUgdGhhdCBQQ0kgY29yZSBoYW5kbGVzIHRoaXMKZm9y
IHlvdSB1bmxlc3MgeW91IGNob29zZSB0byBpbXBsZW1lbnQgaXQuICBKdXN0IHJlbHkKb24gdGhl
IFBDSSBjb3JlIHRvIGhhbmRsZSB0aGUgcGNpIHNwZWNpZmljIGJpdHMuCgpTaWduZWQtb2ZmLWJ5
OiBBbGV4IERldWNoZXIgPGFsZXhhbmRlci5kZXVjaGVyQGFtZC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmggICAgICAgIHwgIDQgKy0tCiBkcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMgfCAzMyArKysrKysrKystLS0tLS0tLS0tLS0t
CiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMgICAgfCAxNiArKysrKy0t
LS0tLQogMyBmaWxlcyBjaGFuZ2VkLCAyNCBpbnNlcnRpb25zKCspLCAyOSBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaCBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdS5oCmluZGV4IDk3ODQzNDYyYzJmYi4uMmU5ZDBi
ZTA1ZjJmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaApAQCAtMTE5MSw4ICsxMTkx
LDggQEAgaW50IGFtZGdwdV9kcml2ZXJfb3Blbl9rbXMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
c3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpOwogdm9pZCBhbWRncHVfZHJpdmVyX3Bvc3RjbG9z
ZV9rbXMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkgc3RydWN0IGRybV9maWxlICpmaWxl
X3ByaXYpOwogaW50IGFtZGdwdV9kZXZpY2VfaXBfc3VzcGVuZChzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldik7Ci1pbnQgYW1kZ3B1X2RldmljZV9zdXNwZW5kKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIGJvb2wgc3VzcGVuZCwgYm9vbCBmYmNvbik7Ci1pbnQgYW1kZ3B1X2RldmljZV9yZXN1bWUo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgYm9vbCByZXN1bWUsIGJvb2wgZmJjb24pOworaW50IGFt
ZGdwdV9kZXZpY2Vfc3VzcGVuZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBib29sIGZiY29uKTsK
K2ludCBhbWRncHVfZGV2aWNlX3Jlc3VtZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBib29sIGZi
Y29uKTsKIHUzMiBhbWRncHVfZ2V0X3ZibGFua19jb3VudGVyX2ttcyhzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSk7CiBpbnQgYW1kZ3B1X2VuYWJsZV92Ymxhbmtfa21z
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGludCBwaXBlKTsKIHZvaWQgYW1kZ3B1
X2Rpc2FibGVfdmJsYW5rX2ttcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQg
cGlwZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2
aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKaW5kZXgg
YjE0MDhjNWU0NjQwLi5kODMyYmQyMmJhOWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfZGV2aWNlLmMKQEAgLTEwOTAsNiArMTA5MCw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1
X2RldmljZV9jaGVja19hcmd1bWVudHMoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiBzdGF0
aWMgdm9pZCBhbWRncHVfc3dpdGNoZXJvb19zZXRfc3RhdGUoc3RydWN0IHBjaV9kZXYgKnBkZXYs
IGVudW0gdmdhX3N3aXRjaGVyb29fc3RhdGUgc3RhdGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IHBjaV9nZXRfZHJ2ZGF0YShwZGV2KTsKKwlpbnQgcjsKIAogCWlmIChhbWRncHVfZGV2
aWNlX3N1cHBvcnRzX2JvY28oZGV2KSAmJiBzdGF0ZSA9PSBWR0FfU1dJVENIRVJPT19PRkYpCiAJ
CXJldHVybjsKQEAgLTEwOTksNyArMTEwMCwxMiBAQCBzdGF0aWMgdm9pZCBhbWRncHVfc3dpdGNo
ZXJvb19zZXRfc3RhdGUoc3RydWN0IHBjaV9kZXYgKnBkZXYsIGVudW0gdmdhX3N3aXRjaGVybwog
CQkvKiBkb24ndCBzdXNwZW5kIG9yIHJlc3VtZSBjYXJkIG5vcm1hbGx5ICovCiAJCWRldi0+c3dp
dGNoX3Bvd2VyX3N0YXRlID0gRFJNX1NXSVRDSF9QT1dFUl9DSEFOR0lORzsKIAotCQlhbWRncHVf
ZGV2aWNlX3Jlc3VtZShkZXYsIHRydWUsIHRydWUpOworCQlwY2lfc2V0X3Bvd2VyX3N0YXRlKGRl
di0+cGRldiwgUENJX0QwKTsKKwkJcGNpX3Jlc3RvcmVfc3RhdGUoZGV2LT5wZGV2KTsKKwkJciA9
IHBjaV9lbmFibGVfZGV2aWNlKGRldi0+cGRldik7CisJCWlmIChyKQorCQkJRFJNX1dBUk4oInBj
aV9lbmFibGVfZGV2aWNlIGZhaWxlZCAoJWQpXG4iLCByKTsKKwkJYW1kZ3B1X2RldmljZV9yZXN1
bWUoZGV2LCB0cnVlKTsKIAogCQlkZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSA9IERSTV9TV0lUQ0hf
UE9XRVJfT047CiAJCWRybV9rbXNfaGVscGVyX3BvbGxfZW5hYmxlKGRldik7CkBAIC0xMTA3LDcg
KzExMTMsMTEgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X3N3aXRjaGVyb29fc2V0X3N0YXRlKHN0cnVj
dCBwY2lfZGV2ICpwZGV2LCBlbnVtIHZnYV9zd2l0Y2hlcm8KIAkJcHJfaW5mbygiYW1kZ3B1OiBz
d2l0Y2hlZCBvZmZcbiIpOwogCQlkcm1fa21zX2hlbHBlcl9wb2xsX2Rpc2FibGUoZGV2KTsKIAkJ
ZGV2LT5zd2l0Y2hfcG93ZXJfc3RhdGUgPSBEUk1fU1dJVENIX1BPV0VSX0NIQU5HSU5HOwotCQlh
bWRncHVfZGV2aWNlX3N1c3BlbmQoZGV2LCB0cnVlLCB0cnVlKTsKKwkJYW1kZ3B1X2RldmljZV9z
dXNwZW5kKGRldiwgdHJ1ZSk7CisJCXBjaV9zYXZlX3N0YXRlKGRldi0+cGRldik7CisJCS8qIFNo
dXQgZG93biB0aGUgZGV2aWNlICovCisJCXBjaV9kaXNhYmxlX2RldmljZShkZXYtPnBkZXYpOwor
CQlwY2lfc2V0X3Bvd2VyX3N0YXRlKGRldi0+cGRldiwgUENJX0QzY29sZCk7CiAJCWRldi0+c3dp
dGNoX3Bvd2VyX3N0YXRlID0gRFJNX1NXSVRDSF9QT1dFUl9PRkY7CiAJfQogfQpAQCAtMzE5OCw3
ICszMjA4LDcgQEAgdm9pZCBhbWRncHVfZGV2aWNlX2Zpbmkoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYpCiAgKiBSZXR1cm5zIDAgZm9yIHN1Y2Nlc3Mgb3IgYW4gZXJyb3Igb24gZmFpbHVyZS4K
ICAqIENhbGxlZCBhdCBkcml2ZXIgc3VzcGVuZC4KICAqLwotaW50IGFtZGdwdV9kZXZpY2Vfc3Vz
cGVuZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBib29sIHN1c3BlbmQsIGJvb2wgZmJjb24pCitp
bnQgYW1kZ3B1X2RldmljZV9zdXNwZW5kKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGJvb2wgZmJj
b24pCiB7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXY7CiAJc3RydWN0IGRybV9jcnRjICpj
cnRjOwpAQCAtMzI4MSwxMyArMzI5MSw2IEBAIGludCBhbWRncHVfZGV2aWNlX3N1c3BlbmQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgYm9vbCBzdXNwZW5kLCBib29sIGZiY29uKQogCSAqLwogCWFt
ZGdwdV9ib19ldmljdF92cmFtKGFkZXYpOwogCi0JaWYgKHN1c3BlbmQpIHsKLQkJcGNpX3NhdmVf
c3RhdGUoZGV2LT5wZGV2KTsKLQkJLyogU2h1dCBkb3duIHRoZSBkZXZpY2UgKi8KLQkJcGNpX2Rp
c2FibGVfZGV2aWNlKGRldi0+cGRldik7Ci0JCXBjaV9zZXRfcG93ZXJfc3RhdGUoZGV2LT5wZGV2
LCBQQ0lfRDNob3QpOwotCX0KLQogCXJldHVybiAwOwogfQogCkBAIC0zMzAyLDcgKzMzMDUsNyBA
QCBpbnQgYW1kZ3B1X2RldmljZV9zdXNwZW5kKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGJvb2wg
c3VzcGVuZCwgYm9vbCBmYmNvbikKICAqIFJldHVybnMgMCBmb3Igc3VjY2VzcyBvciBhbiBlcnJv
ciBvbiBmYWlsdXJlLgogICogQ2FsbGVkIGF0IGRyaXZlciByZXN1bWUuCiAgKi8KLWludCBhbWRn
cHVfZGV2aWNlX3Jlc3VtZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBib29sIHJlc3VtZSwgYm9v
bCBmYmNvbikKK2ludCBhbWRncHVfZGV2aWNlX3Jlc3VtZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCBib29sIGZiY29uKQogewogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CiAJc3Ry
dWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGl0ZXI7CkBAIC0zMzEzLDE0ICszMzE2LDYgQEAg
aW50IGFtZGdwdV9kZXZpY2VfcmVzdW1lKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGJvb2wgcmVz
dW1lLCBib29sIGZiY29uKQogCWlmIChkZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSA9PSBEUk1fU1dJ
VENIX1BPV0VSX09GRikKIAkJcmV0dXJuIDA7CiAKLQlpZiAocmVzdW1lKSB7Ci0JCXBjaV9zZXRf
cG93ZXJfc3RhdGUoZGV2LT5wZGV2LCBQQ0lfRDApOwotCQlwY2lfcmVzdG9yZV9zdGF0ZShkZXYt
PnBkZXYpOwotCQlyID0gcGNpX2VuYWJsZV9kZXZpY2UoZGV2LT5wZGV2KTsKLQkJaWYgKHIpCi0J
CQlyZXR1cm4gcjsKLQl9Ci0KIAkvKiBwb3N0IGNhcmQgKi8KIAlpZiAoYW1kZ3B1X2RldmljZV9u
ZWVkX3Bvc3QoYWRldikpIHsKIAkJciA9IGFtZGdwdV9hdG9tX2FzaWNfaW5pdChhZGV2LT5tb2Rl
X2luZm8uYXRvbV9jb250ZXh0KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYu
YwppbmRleCBkZjJmNDcyMGEyZjAuLjJmMzY3MTQ2YzcyYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9kcnYuYwpAQCAtMTE1OCw3ICsxMTU4LDcgQEAgc3RhdGljIGludCBhbWRn
cHVfcG1vcHNfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IGRybV9kZXZp
Y2UgKmRybV9kZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKIAotCXJldHVybiBhbWRncHVfZGV2
aWNlX3N1c3BlbmQoZHJtX2RldiwgdHJ1ZSwgdHJ1ZSk7CisJcmV0dXJuIGFtZGdwdV9kZXZpY2Vf
c3VzcGVuZChkcm1fZGV2LCB0cnVlKTsKIH0KIAogc3RhdGljIGludCBhbWRncHVfcG1vcHNfcmVz
dW1lKHN0cnVjdCBkZXZpY2UgKmRldikKQEAgLTExNzMsNyArMTE3Myw3IEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X3Btb3BzX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiAJCXBtX3J1bnRpbWVfZW5h
YmxlKGRldik7CiAJfQogCi0JcmV0dXJuIGFtZGdwdV9kZXZpY2VfcmVzdW1lKGRybV9kZXYsIHRy
dWUsIHRydWUpOworCXJldHVybiBhbWRncHVfZGV2aWNlX3Jlc3VtZShkcm1fZGV2LCB0cnVlKTsK
IH0KIAogc3RhdGljIGludCBhbWRncHVfcG1vcHNfZnJlZXplKHN0cnVjdCBkZXZpY2UgKmRldikK
QEAgLTExODIsNyArMTE4Miw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Btb3BzX2ZyZWV6ZShzdHJ1
Y3QgZGV2aWNlICpkZXYpCiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBkcm1fZGV2LT5k
ZXZfcHJpdmF0ZTsKIAlpbnQgcjsKIAotCXIgPSBhbWRncHVfZGV2aWNlX3N1c3BlbmQoZHJtX2Rl
diwgZmFsc2UsIHRydWUpOworCXIgPSBhbWRncHVfZGV2aWNlX3N1c3BlbmQoZHJtX2RldiwgdHJ1
ZSk7CiAJaWYgKHIpCiAJCXJldHVybiByOwogCXJldHVybiBhbWRncHVfYXNpY19yZXNldChhZGV2
KTsKQEAgLTExOTIsMjEgKzExOTIsMjEgQEAgc3RhdGljIGludCBhbWRncHVfcG1vcHNfdGhhdyhz
dHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXYgPSBkZXZf
Z2V0X2RydmRhdGEoZGV2KTsKIAotCXJldHVybiBhbWRncHVfZGV2aWNlX3Jlc3VtZShkcm1fZGV2
LCBmYWxzZSwgdHJ1ZSk7CisJcmV0dXJuIGFtZGdwdV9kZXZpY2VfcmVzdW1lKGRybV9kZXYsIHRy
dWUpOwogfQogCiBzdGF0aWMgaW50IGFtZGdwdV9wbW9wc19wb3dlcm9mZihzdHJ1Y3QgZGV2aWNl
ICpkZXYpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXYgPSBkZXZfZ2V0X2RydmRhdGEo
ZGV2KTsKIAotCXJldHVybiBhbWRncHVfZGV2aWNlX3N1c3BlbmQoZHJtX2RldiwgdHJ1ZSwgdHJ1
ZSk7CisJcmV0dXJuIGFtZGdwdV9kZXZpY2Vfc3VzcGVuZChkcm1fZGV2LCB0cnVlKTsKIH0KIAog
c3RhdGljIGludCBhbWRncHVfcG1vcHNfcmVzdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKIAotCXJl
dHVybiBhbWRncHVfZGV2aWNlX3Jlc3VtZShkcm1fZGV2LCBmYWxzZSwgdHJ1ZSk7CisJcmV0dXJu
IGFtZGdwdV9kZXZpY2VfcmVzdW1lKGRybV9kZXYsIHRydWUpOwogfQogCiBzdGF0aWMgaW50IGFt
ZGdwdV9wbW9wc19ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2KQpAQCAtMTIyNSw3
ICsxMjI1LDcgQEAgc3RhdGljIGludCBhbWRncHVfcG1vcHNfcnVudGltZV9zdXNwZW5kKHN0cnVj
dCBkZXZpY2UgKmRldikKIAkJZHJtX2Rldi0+c3dpdGNoX3Bvd2VyX3N0YXRlID0gRFJNX1NXSVRD
SF9QT1dFUl9DSEFOR0lORzsKIAlkcm1fa21zX2hlbHBlcl9wb2xsX2Rpc2FibGUoZHJtX2Rldik7
CiAKLQlyZXQgPSBhbWRncHVfZGV2aWNlX3N1c3BlbmQoZHJtX2RldiwgZmFsc2UsIGZhbHNlKTsK
KwlyZXQgPSBhbWRncHVfZGV2aWNlX3N1c3BlbmQoZHJtX2RldiwgZmFsc2UpOwogCWlmIChhbWRn
cHVfZGV2aWNlX3N1cHBvcnRzX2JvY28oZHJtX2RldikpIHsKIAkJLyogT25seSBuZWVkIHRvIGhh
bmRsZSBQQ0kgc3RhdGUgaW4gdGhlIGRyaXZlciBmb3IgQVRQWAogCQkgKiBQQ0kgY29yZSBoYW5k
bGVzIGl0IGZvciBfUFIzLgpAQCAtMTI3NSw3ICsxMjc1LDcgQEAgc3RhdGljIGludCBhbWRncHVf
cG1vcHNfcnVudGltZV9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KQogCX0gZWxzZSBpZiAoYW1k
Z3B1X2RldmljZV9zdXBwb3J0c19iYWNvKGRybV9kZXYpKSB7CiAJCWFtZGdwdV9kZXZpY2VfYmFj
b19leGl0KGRybV9kZXYpOwogCX0KLQlyZXQgPSBhbWRncHVfZGV2aWNlX3Jlc3VtZShkcm1fZGV2
LCBmYWxzZSwgZmFsc2UpOworCXJldCA9IGFtZGdwdV9kZXZpY2VfcmVzdW1lKGRybV9kZXYsIGZh
bHNlKTsKIAlkcm1fa21zX2hlbHBlcl9wb2xsX2VuYWJsZShkcm1fZGV2KTsKIAlpZiAoYW1kZ3B1
X2RldmljZV9zdXBwb3J0c19ib2NvKGRybV9kZXYpKQogCQlkcm1fZGV2LT5zd2l0Y2hfcG93ZXJf
c3RhdGUgPSBEUk1fU1dJVENIX1BPV0VSX09OOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
