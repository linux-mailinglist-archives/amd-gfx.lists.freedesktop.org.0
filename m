Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C17423DEA00
	for <lists+amd-gfx@lfdr.de>; Tue,  3 Aug 2021 11:50:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 50C056E5B6;
	Tue,  3 Aug 2021 09:50:15 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM10-BN7-obe.outbound.protection.outlook.com
 (mail-bn7nam10on2076.outbound.protection.outlook.com [40.107.92.76])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3C7346E593
 for <amd-gfx@lists.freedesktop.org>; Tue,  3 Aug 2021 09:50:13 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=OgtCbgBhjao9BuA/mLuN0pZ4RlYShoES6sEUr90EEYVKWbOF8AB/u6pk7SauywKvOZ0vwqo9F3fSd1YV0d9vDfZicW7E4yKnTqEjJADYecb61bzqh7TQNp769NJVp0JEFmUOosqv0AFalTbc0g0lQM8JuD00h6Z/U5gXSWK87T1hE08N25V/OaLkich2EbNATiZeppnJfQGRTtsk/fMdsl4I2nq7ZjZOrNexzQxefL+j0jZQQDsnvrz5cyZ9u5aT9FrmksPbos/bz18NKM1ZdJZbSB2ORBUwaUijaXIOyivsHi+KElepbKw/ce7oJVssUmFa5C/aS4ez2d4g0N6jlw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=yAJsyYVVkRGedMWYhfVTDKGdWq0lB4DaNWwFmbk4KlU=;
 b=cmRFL8QkXkAIOoVyDAVicKPi8nNTqsvILGo2aEwRtRh/ZQltTyE0Xg447L7ka/nFNW+DjBseKNGjEfepDZEU2SXlgY66YZmpYDWsBIZyDGcF67KZ1vPLPB9hdRDawvA8T78Y7Y9ftTonzwHu9X22SuPr+KNtWRiOkUYpK/regyQGS3CK9zumUKGlIzD31YwUiC24Wyx0sfB1jj8KUvY6GHPq0GQ87syrJF2gGcNltca2O97ao7EV5jzROfHBx2Xbl3/VNNyglmDrfEwOZKMOGa4i58Euwu+JFw+QUlqvsw92nBvtmMUdGoYu4nc6oRvvOL8jnahr7xIjUj63c5C2Lg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=amd.com; s=selector1; 
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=yAJsyYVVkRGedMWYhfVTDKGdWq0lB4DaNWwFmbk4KlU=;
 b=uyTjTjhHdDqY10+YV4MGRZ88a2m8rz/SeA/MKiK99aomtIqRDIUb5l0b8ot8DivW/czMazBaYqVz/gNcn0GLwRU/6jtF79IzJxiFk0nrFJY5HqJFdBFVs9mlxLH7iM0jAibaynhCI+KsiwD2+nz8zZ6nh6RQp0mJhoFIgmmqbUA=
Received: from BN9PR12MB5226.namprd12.prod.outlook.com (2603:10b6:408:11f::11)
 by BN9PR12MB5338.namprd12.prod.outlook.com (2603:10b6:408:103::23)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4373.19; Tue, 3 Aug
 2021 09:50:11 +0000
Received: from BN9PR12MB5226.namprd12.prod.outlook.com
 ([fe80::d863:def1:2b7e:fc89]) by BN9PR12MB5226.namprd12.prod.outlook.com
 ([fe80::d863:def1:2b7e:fc89%8]) with mapi id 15.20.4394.015; Tue, 3 Aug 2021
 09:50:11 +0000
From: "Clements, John" <John.Clements@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
CC: "Zhang, Hawking" <Hawking.Zhang@amd.com>, "Li, Candice"
 <Candice.Li@amd.com>, "Lazar, Lijo" <Lijo.Lazar@amd.com>, "Chen, Guchun"
 <Guchun.Chen@amd.com>
Subject: [PATCH] drm/amdgpu: added synchronization for psp cmd buf access
Thread-Topic: [PATCH] drm/amdgpu: added synchronization for psp cmd buf access
Thread-Index: AdeITLg7attLKh5xSlmEVfidPAvHsw==
Date: Tue, 3 Aug 2021 09:50:11 +0000
Message-ID: <BN9PR12MB52265FFACD0557EC17C4FAE6FBF09@BN9PR12MB5226.namprd12.prod.outlook.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: yes
X-MS-TNEF-Correlator: 
msip_labels: MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_Enabled=true;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_SetDate=2021-08-03T09:50:08Z; 
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_Method=Standard;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_Name=AMD Official Use
 Only-AIP 2.0;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_SiteId=3dd8961f-e488-4e60-8e11-a82d994e183d;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_ActionId=69bd21d9-f349-4d7b-aee7-d32eba7de61d;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_ContentBits=1
authentication-results: lists.freedesktop.org; dkim=none (message not signed)
 header.d=none; lists.freedesktop.org;
 dmarc=none action=none header.from=amd.com;
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: ccaddea8-5b7c-4f99-bb88-08d9566415de
x-ms-traffictypediagnostic: BN9PR12MB5338:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <BN9PR12MB5338D6C6D1628A8D5779171CFBF09@BN9PR12MB5338.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:8882;
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: EBud4gHa2LOF3O4AGRZuPeS3mJOA9/EImDHuyHhiRuFRXvfCWjkk2riNTOsDBqrDYJOnz4QusysMHdwZ1J1KkYs4Io9KoAriLznR1GAhjIgl/h3ixnOCzzzZqqyrY/d6zWFtDVy9q49yCQbSwV4WPYRCcSqdd8vOSsp6gzNZxWFY/jkTgtHa+s7SVb9yRFk+jOrnXvZXk0gwxbVzc4XrsfW0+o+d8ZrsJuNRRtYYIiVlkkhsiT05FyXGaXN3KZnqDmMofbG3pKotMcsCfQ/wizBiqnrbDca0JBdY1uk6gFsdoRXRp1QvJoxV3NPnwW6C6aJgAjv9TMsV3+Jr/dZwDG0+wwYTK04Th8IlB7wyviBQfedpeR1nV6ysKZ58F3fKKST769Hta2YWj6fkpAyclDQ/b7su456lkZ2EX41w3HyBKuoQH1lw3Kes5tl7GafXHXBnfBqor3xPLXVywWyBFVBM8LXKlqDvRb/UITq+QataypIMviYVEACIvWVxIbCD9Es2s09jhA9pMK92auzH68E8xq3f77/uG6td5YKc6j4IfCaLaR88MY9bUEmF0ok85fNxj7/I0Smf6IRPqYFaqXJjCyprJs/H0jMWe9XAvEHuUo259GCslh1Nu3bEfIrcbUUGQJHWdxxMOcJglknPL+hseEvPV6QtvIt57+PYrSb41YYNGo+ionPHmEV/g/YYGb8Q/x6WHpHarWMLS/UlQg==
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:BN9PR12MB5226.namprd12.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(4636009)(366004)(8676002)(33656002)(9686003)(6916009)(99936003)(71200400001)(8936002)(4326008)(66616009)(66446008)(7696005)(66476007)(38070700005)(66556008)(64756008)(86362001)(76116006)(5660300002)(52536014)(83380400001)(55016002)(186003)(316002)(38100700002)(558084003)(26005)(66946007)(6506007)(122000001)(508600001)(54906003)(2906002);
 DIR:OUT; SFP:1101; 
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?us-ascii?Q?2edI1NmKJHa1vZmldajEwBz6YdD0CHeSsSMrdtpl35a4yYuCmCjHx2vKIJme?=
 =?us-ascii?Q?4qSm3Pk11z+g+MtMdMlwRdxoCDQGbrVDa1Q0D5aGmQu0MPBljLVfxoFvNbHv?=
 =?us-ascii?Q?pE9pLYH98XiX/Xp41F1hMnUewi2eHRrSqCujapmbrMjjSLzxvEMj0CaUNJWU?=
 =?us-ascii?Q?TjvIfACzv/a4RVCri5QaIPGxYd8NRTHofv5UcKr1NB+AdME3C9ajQeMzkD18?=
 =?us-ascii?Q?k+tGcrko9c7p2FkISlBeskI7Mn6N9j76MwpJfsFMdZipIvtb4Vd5QRzXH8W7?=
 =?us-ascii?Q?wAaFBdLB3eO7jx8SexqA+LNUEMrB/vsq/J1tO36hGsezec0US2MDNJ/q+FFW?=
 =?us-ascii?Q?obVHDasM2qsQ1Fmg5Y4oK8D3yqC3AaYHVP6PWmRWfJ8uKE6xKy3+zh1PGnYt?=
 =?us-ascii?Q?8jBmqe0N9sLh6gSw9GOZZJ0oaTaaS53wciNdQ1FO0Kzgt1+cdzTARdLOD1h5?=
 =?us-ascii?Q?JV1g62RN1aanuBEmavALt6QY/LRuiKifV3nSePhUFC9hJMyiTSaIZcSOI9oA?=
 =?us-ascii?Q?/OfVnlg7FDH4RsNRS15Mugs/LZzn2N+CokcX4krr37FAc2uS3Z0rO2tc2jpA?=
 =?us-ascii?Q?hYQXuS0c92Fx2XDnxXWOvzWELEiTomsEVC71uMtANdRsCt6ya0L+OWfYaStz?=
 =?us-ascii?Q?2r36YiYu4g/D6cYP13sFQhdI5MWc+BYOUIROSCafBVZSiLMcmxufYuy33l6c?=
 =?us-ascii?Q?Xq1G0UuYFwJEykk1dwx8koBl7b1Ep+1Oj+5sJqWewI7x+w8TbNZ3ZghdW1kS?=
 =?us-ascii?Q?/Kj5o12JSq3xa27lIHOor8wD299fgjCwhsJhAoxuq/S0uYmjZoz8xIuGdXl+?=
 =?us-ascii?Q?cOeu71JpMIIHYnNN5r+lTKsWaNrVgbNamAmDeT0o612Yt0OzMENPcd96D45/?=
 =?us-ascii?Q?mU7O2pGEzRbO1HE09t7fPBctJAVorrvgqWNkg4Q5BOZSWT6HDQdwrX5wnR/S?=
 =?us-ascii?Q?AcjcdphzOVSONWqeogHIbFnGyOuksr1P1b+WoMNK9Jm2T2gf8601e5ZarD2y?=
 =?us-ascii?Q?9b/csr4miQlRqXR8yTPGLC/q2kN8KhaX7KIt45eK5AlISNBv0F6c4pr1p3bq?=
 =?us-ascii?Q?ZRI0U0TdRdcg92N3IfZvN3aojz6cHyS8eiryJbi5gYoQWRX2z/8eZlNRuV8Q?=
 =?us-ascii?Q?YMPS2K2L5agj34lIhaMWoF/OvfO5v7geLOFxmrBuw1luo7sS7hC4LV8XmvdL?=
 =?us-ascii?Q?BhlPZQx3E1buUvkogSVvO05uiKkOD5rblLkOpPFBO1YePbojitR9ptcdZby7?=
 =?us-ascii?Q?eSfg3K/+Z9bwZspcOxRU0y+aOI47uSA/UBdVvXHyoi4foZbuyEQSxWJI9e++?=
 =?us-ascii?Q?UwYcCRznem4SItHfh9drAaBn?=
Content-Type: multipart/mixed;
 boundary="_004_BN9PR12MB52265FFACD0557EC17C4FAE6FBF09BN9PR12MB5226namp_"
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: BN9PR12MB5226.namprd12.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: ccaddea8-5b7c-4f99-bb88-08d9566415de
X-MS-Exchange-CrossTenant-originalarrivaltime: 03 Aug 2021 09:50:11.1868 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: rI5LayG/R4itf7iz439aOby9hOIRfwmMjF6HqiouveCC7TpmrHhznwzLyQFrIhouK8y+ZeS73V0xfMKjoHhquQ==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN9PR12MB5338
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

--_004_BN9PR12MB52265FFACD0557EC17C4FAE6FBF09BN9PR12MB5226namp_
Content-Type: multipart/alternative;
	boundary="_000_BN9PR12MB52265FFACD0557EC17C4FAE6FBF09BN9PR12MB5226namp_"

--_000_BN9PR12MB52265FFACD0557EC17C4FAE6FBF09BN9PR12MB5226namp_
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

[AMD Official Use Only]

Submitting patch to synchronize access to psp cmd submission memory to reso=
lve potential race conditions.

--_000_BN9PR12MB52265FFACD0557EC17C4FAE6FBF09BN9PR12MB5226namp_
Content-Type: text/html; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

<html xmlns:v=3D"urn:schemas-microsoft-com:vml" xmlns:o=3D"urn:schemas-micr=
osoft-com:office:office" xmlns:w=3D"urn:schemas-microsoft-com:office:word" =
xmlns:m=3D"http://schemas.microsoft.com/office/2004/12/omml" xmlns=3D"http:=
//www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dus-ascii"=
>
<meta name=3D"Generator" content=3D"Microsoft Word 15 (filtered medium)">
<style><!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri",sans-serif;
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri",sans-serif;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext=3D"edit" spidmax=3D"1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext=3D"edit">
<o:idmap v:ext=3D"edit" data=3D"1" />
</o:shapelayout></xml><![endif]-->
</head>
<body lang=3D"EN-US" link=3D"#0563C1" vlink=3D"#954F72" style=3D"word-wrap:=
break-word">
<p class=3D"msipheadera4477989" align=3D"Left" style=3D"margin:0"><span sty=
le=3D"font-size:10.0pt;font-family:Arial;color:#0000FF">[AMD Official Use O=
nly]</span></p>
<br>
<div class=3D"WordSection1">
<p class=3D"MsoNormal">Submitting patch to synchronize access to psp cmd su=
bmission memory to resolve potential race conditions.<o:p></o:p></p>
</div>
</body>
</html>

--_000_BN9PR12MB52265FFACD0557EC17C4FAE6FBF09BN9PR12MB5226namp_--

--_004_BN9PR12MB52265FFACD0557EC17C4FAE6FBF09BN9PR12MB5226namp_
Content-Type: application/octet-stream;
	name="0001-drm-amdgpu-added-synchronization-for-psp-cmd-buf-acc.patch"
Content-Description:  0001-drm-amdgpu-added-synchronization-for-psp-cmd-buf-acc.patch
Content-Disposition: attachment;
	filename="0001-drm-amdgpu-added-synchronization-for-psp-cmd-buf-acc.patch";
	size=21451; creation-date="Tue, 03 Aug 2021 09:48:00 GMT";
	modification-date="Tue, 03 Aug 2021 09:48:00 GMT"
Content-Transfer-Encoding: base64

RnJvbSAwZDhlYWZjY2NmNWEwZWJkOTVjOWQ1MWQ1OWM5NjEwZWE3OTk1Y2I1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBKb2huIENsZW1lbnRzIDxqb2huLmNsZW1lbnRzQGFtZC5jb20+
CkRhdGU6IFR1ZSwgMyBBdWcgMjAyMSAxNzo0NzowNyArMDgwMApTdWJqZWN0OiBbUEFUQ0ggMS8x
XSBkcm0vYW1kZ3B1OiBhZGRlZCBzeW5jaHJvbml6YXRpb24gZm9yIHBzcCBjbWQgYnVmIGFjY2Vz
cwoKcmVzb2x2ZWQgcmFjZSBjb25kaXRpb24gYWNjZXNzaW5nIHBzcCBjbWQgc3VibWlzc2lvbiBt
ZW1vcnkKClNpZ25lZC1vZmYtYnk6IEpvaG4gQ2xlbWVudHMgPGpvaG4uY2xlbWVudHNAYW1kLmNv
bT4KQ2hhbmdlLUlkOiBJN2EyNzMxNDBmODMxNGM2YWJjZGNlNmQyY2ZjNzZjM2E0NTRjMmJmMQot
LS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyB8ICAgMSArCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcHNwLmMgICAgfCAyMDIgKysrKysrKysr
KysrKystLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcHNwLmggICAg
fCAgIDEgKwogMyBmaWxlcyBjaGFuZ2VkLCAxNDEgaW5zZXJ0aW9ucygrKSwgNjMgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rldmlj
ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCmluZGV4IDll
NTNmZjg1MTQ5Ni4uMjE3YTc5MTBkYjA3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2RldmljZS5jCkBAIC0zNDY3LDYgKzM0NjcsNyBAQCBpbnQgYW1kZ3B1X2RldmljZV9p
bml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCWF0b21pY19zZXQoJmFkZXYtPmluX2dw
dV9yZXNldCwgMCk7CiAJaW5pdF9yd3NlbSgmYWRldi0+cmVzZXRfc2VtKTsKIAltdXRleF9pbml0
KCZhZGV2LT5wc3AubXV0ZXgpOworCW11dGV4X2luaXQoJmFkZXYtPnBzcC5jbWRfYnVmX211dGV4
KTsKIAltdXRleF9pbml0KCZhZGV2LT5ub3RpZmllcl9sb2NrKTsKIAogCXIgPSBhbWRncHVfZGV2
aWNlX2luaXRfYXB1X2ZsYWdzKGFkZXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3BzcC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3BzcC5jCmluZGV4IGYzNDFkNTFmYmFhMi4uZGRiOTEzMjRkZTU1IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcHNwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3BzcC5jCkBAIC00OTIsNiArNDkyLDIyIEBAIHBzcF9jbWRfc3Vi
bWl0X2J1ZihzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCwKIAlyZXR1cm4gcmV0OwogfQogCitzdGF0
aWMgc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmFjcXVpcmVfcHNwX2NtZF9idWYoc3RydWN0IHBz
cF9jb250ZXh0ICpwc3ApCit7CisJc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZCA9IHBzcC0+
Y21kOworCisJbXV0ZXhfbG9jaygmcHNwLT5jbWRfYnVmX211dGV4KTsKKworCW1lbXNldChjbWQs
IDAsIHNpemVvZihzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCkpOworCisJcmV0dXJuIGNtZDsKK30K
Kwordm9pZCByZWxlYXNlX3BzcF9jbWRfYnVmKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQorewor
CW11dGV4X3VubG9jaygmcHNwLT5jbWRfYnVmX211dGV4KTsKK30KKwogc3RhdGljIHZvaWQgcHNw
X3ByZXBfdG1yX2NtZF9idWYoc3RydWN0IHBzcF9jb250ZXh0ICpwc3AsCiAJCQkJIHN0cnVjdCBw
c3BfZ2Z4X2NtZF9yZXNwICpjbWQsCiAJCQkJIHVpbnQ2NF90IHRtcl9tYywgc3RydWN0IGFtZGdw
dV9ibyAqdG1yX2JvKQpAQCAtNTAwLDggKzUxNiw2IEBAIHN0YXRpYyB2b2lkIHBzcF9wcmVwX3Rt
cl9jbWRfYnVmKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwLAogCXVpbnQzMl90IHNpemUgPSBhbWRn
cHVfYm9fc2l6ZSh0bXJfYm8pOwogCXVpbnQ2NF90IHRtcl9wYSA9IGFtZGdwdV9nbWNfdnJhbV9w
YShhZGV2LCB0bXJfYm8pOwogCi0JbWVtc2V0KGNtZCwgMCwgc2l6ZW9mKHN0cnVjdCBwc3BfZ2Z4
X2NtZF9yZXNwKSk7Ci0KIAlpZiAoYW1kZ3B1X3NyaW92X3ZmKHBzcC0+YWRldikpCiAJCWNtZC0+
Y21kX2lkID0gR0ZYX0NNRF9JRF9TRVRVUF9WTVI7CiAJZWxzZQpAQCAtNTE3LDggKzUzMSw2IEBA
IHN0YXRpYyB2b2lkIHBzcF9wcmVwX3Rtcl9jbWRfYnVmKHN0cnVjdCBwc3BfY29udGV4dCAqcHNw
LAogc3RhdGljIHZvaWQgcHNwX3ByZXBfbG9hZF90b2NfY21kX2J1ZihzdHJ1Y3QgcHNwX2dmeF9j
bWRfcmVzcCAqY21kLAogCQkJCSAgICAgIHVpbnQ2NF90IHByaV9idWZfbWMsIHVpbnQzMl90IHNp
emUpCiB7Ci0JbWVtc2V0KGNtZCwgMCwgc2l6ZW9mKHN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwKSk7
Ci0KIAljbWQtPmNtZF9pZCA9IEdGWF9DTURfSURfTE9BRF9UT0M7CiAJY21kLT5jbWQuY21kX2xv
YWRfdG9jLnRvY19waHlfYWRkcl9sbyA9IGxvd2VyXzMyX2JpdHMocHJpX2J1Zl9tYyk7CiAJY21k
LT5jbWQuY21kX2xvYWRfdG9jLnRvY19waHlfYWRkcl9oaSA9IHVwcGVyXzMyX2JpdHMocHJpX2J1
Zl9tYyk7CkBAIC01MzAsNyArNTQyLDcgQEAgc3RhdGljIGludCBwc3BfbG9hZF90b2Moc3RydWN0
IHBzcF9jb250ZXh0ICpwc3AsCiAJCQl1aW50MzJfdCAqdG1yX3NpemUpCiB7CiAJaW50IHJldDsK
LQlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21kID0gcHNwLT5jbWQ7CisJc3RydWN0IHBzcF9n
ZnhfY21kX3Jlc3AgKmNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKIAogCS8qIENvcHkg
dG9jIHRvIHBzcCBmaXJtd2FyZSBwcml2YXRlIGJ1ZmZlciAqLwogCXBzcF9jb3B5X2Z3KHBzcCwg
cHNwLT50b2Muc3RhcnRfYWRkciwgcHNwLT50b2Muc2l6ZV9ieXRlcyk7CkBAIC01NDIsNiArNTU0
LDggQEAgc3RhdGljIGludCBwc3BfbG9hZF90b2Moc3RydWN0IHBzcF9jb250ZXh0ICpwc3AsCiAJ
aWYgKCFyZXQpCiAJCSp0bXJfc2l6ZSA9IHBzcC0+Y21kX2J1Zl9tZW0tPnJlc3AudG1yX3NpemU7
CiAKKwlyZWxlYXNlX3BzcF9jbWRfYnVmKHBzcCk7CisKIAlyZXR1cm4gcmV0OwogfQogCkBAIC01
OTgsNyArNjEyLDcgQEAgc3RhdGljIGJvb2wgcHNwX3NraXBfdG1yKHN0cnVjdCBwc3BfY29udGV4
dCAqcHNwKQogc3RhdGljIGludCBwc3BfdG1yX2xvYWQoc3RydWN0IHBzcF9jb250ZXh0ICpwc3Ap
CiB7CiAJaW50IHJldDsKLQlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21kID0gcHNwLT5jbWQ7
CisJc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZDsKIAogCS8qIEZvciBOYXZpMTIgYW5kIENI
SVBfU0lFTk5BX0NJQ0hMSUQgU1JJT1YsIGRvIG5vdCBzZXQgdXAgVE1SLgogCSAqIEFscmVhZHkg
c2V0IHVwIGJ5IGhvc3QgZHJpdmVyLgpAQCAtNjA2LDYgKzYyMCw4IEBAIHN0YXRpYyBpbnQgcHNw
X3Rtcl9sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogCWlmIChhbWRncHVfc3Jpb3ZfdmYo
cHNwLT5hZGV2KSAmJiBwc3Bfc2tpcF90bXIocHNwKSkKIAkJcmV0dXJuIDA7CiAKKwljbWQgPSBh
Y3F1aXJlX3BzcF9jbWRfYnVmKHBzcCk7CisKIAlwc3BfcHJlcF90bXJfY21kX2J1Zihwc3AsIGNt
ZCwgcHNwLT50bXJfbWNfYWRkciwgcHNwLT50bXJfYm8pOwogCURSTV9JTkZPKCJyZXNlcnZlIDB4
JWx4IGZyb20gMHglbGx4IGZvciBQU1AgVE1SXG4iLAogCQkgYW1kZ3B1X2JvX3NpemUocHNwLT50
bXJfYm8pLCBwc3AtPnRtcl9tY19hZGRyKTsKQEAgLTYxMywxNCArNjI5LDE0IEBAIHN0YXRpYyBp
bnQgcHNwX3Rtcl9sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogCXJldCA9IHBzcF9jbWRf
c3VibWl0X2J1Zihwc3AsIE5VTEwsIGNtZCwKIAkJCQkgcHNwLT5mZW5jZV9idWZfbWNfYWRkcik7
CiAKKwlyZWxlYXNlX3BzcF9jbWRfYnVmKHBzcCk7CisKIAlyZXR1cm4gcmV0OwogfQogCiBzdGF0
aWMgdm9pZCBwc3BfcHJlcF90bXJfdW5sb2FkX2NtZF9idWYoc3RydWN0IHBzcF9jb250ZXh0ICpw
c3AsCiAJCQkJICAgICAgICBzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21kKQogewotCW1lbXNl
dChjbWQsIDAsIHNpemVvZihzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCkpOwotCiAJaWYgKGFtZGdw
dV9zcmlvdl92Zihwc3AtPmFkZXYpKQogCQljbWQtPmNtZF9pZCA9IEdGWF9DTURfSURfREVTVFJP
WV9WTVI7CiAJZWxzZQpAQCAtNjMwLDcgKzY0Niw3IEBAIHN0YXRpYyB2b2lkIHBzcF9wcmVwX3Rt
cl91bmxvYWRfY21kX2J1ZihzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCwKIHN0YXRpYyBpbnQgcHNw
X3Rtcl91bmxvYWQoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiB7CiAJaW50IHJldDsKLQlzdHJ1
Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21kID0gcHNwLT5jbWQ7CisJc3RydWN0IHBzcF9nZnhfY21k
X3Jlc3AgKmNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKIAogCXBzcF9wcmVwX3Rtcl91
bmxvYWRfY21kX2J1Zihwc3AsIGNtZCk7CiAJRFJNX0lORk8oImZyZWUgUFNQIFRNUiBidWZmZXJc
biIpOwpAQCAtNjM4LDYgKzY1NCw4IEBAIHN0YXRpYyBpbnQgcHNwX3Rtcl91bmxvYWQoc3RydWN0
IHBzcF9jb250ZXh0ICpwc3ApCiAJcmV0ID0gcHNwX2NtZF9zdWJtaXRfYnVmKHBzcCwgTlVMTCwg
Y21kLAogCQkJCSBwc3AtPmZlbmNlX2J1Zl9tY19hZGRyKTsKIAorCXJlbGVhc2VfcHNwX2NtZF9i
dWYocHNwKTsKKwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTY2Miw5ICs2ODAsNyBAQCBpbnQgcHNw
X2dldF9md19hdHRlc3RhdGlvbl9yZWNvcmRzX2FkZHIoc3RydWN0IHBzcF9jb250ZXh0ICpwc3As
CiAJCQkJCXVpbnQ2NF90ICpvdXRwdXRfcHRyKQogewogCWludCByZXQ7Ci0Jc3RydWN0IHBzcF9n
ZnhfY21kX3Jlc3AgKmNtZCA9IHBzcC0+Y21kOwotCi0JbWVtc2V0KGNtZCwgMCwgc2l6ZW9mKHN0
cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwKSk7CisJc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZDsK
IAogCWlmICghb3V0cHV0X3B0cikKIAkJcmV0dXJuIC1FSU5WQUw7CkBAIC02NzIsNiArNjg4LDgg
QEAgaW50IHBzcF9nZXRfZndfYXR0ZXN0YXRpb25fcmVjb3Jkc19hZGRyKHN0cnVjdCBwc3BfY29u
dGV4dCAqcHNwLAogCWlmIChhbWRncHVfc3Jpb3ZfdmYocHNwLT5hZGV2KSkKIAkJcmV0dXJuIDA7
CiAKKwljbWQgPSBhY3F1aXJlX3BzcF9jbWRfYnVmKHBzcCk7CisKIAljbWQtPmNtZF9pZCA9IEdG
WF9DTURfSURfR0VUX0ZXX0FUVEVTVEFUSU9OOwogCiAJcmV0ID0gcHNwX2NtZF9zdWJtaXRfYnVm
KHBzcCwgTlVMTCwgY21kLApAQCAtNjgyLDE5ICs3MDAsMjEgQEAgaW50IHBzcF9nZXRfZndfYXR0
ZXN0YXRpb25fcmVjb3Jkc19hZGRyKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwLAogCQkJICAgICAg
KCh1aW50NjRfdCljbWQtPnJlc3AudXJlc3AuZndhcl9kYl9pbmZvLmZ3YXJfZGJfYWRkcl9oaSA8
PCAzMik7CiAJfQogCisJcmVsZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCiAJcmV0dXJuIHJldDsK
IH0KIAogc3RhdGljIGludCBwc3BfYm9vdF9jb25maWdfZ2V0KHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LCB1aW50MzJfdCAqYm9vdF9jZmcpCiB7CiAJc3RydWN0IHBzcF9jb250ZXh0ICpwc3Ag
PSAmYWRldi0+cHNwOwotCXN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQgPSBwc3AtPmNtZDsK
KwlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21kOwogCWludCByZXQ7CiAKIAlpZiAoYW1kZ3B1
X3NyaW92X3ZmKGFkZXYpKQogCQlyZXR1cm4gMDsKIAotCW1lbXNldChjbWQsIDAsIHNpemVvZihz
dHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCkpOworCWNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNw
KTsKIAogCWNtZC0+Y21kX2lkID0gR0ZYX0NNRF9JRF9CT09UX0NGRzsKIAljbWQtPmNtZC5ib290
X2NmZy5zdWJfY21kID0gQk9PVENGR19DTURfR0VUOwpAQCAtNzA1LDM3ICs3MjUsNDUgQEAgc3Rh
dGljIGludCBwc3BfYm9vdF9jb25maWdfZ2V0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1
aW50MzJfdCAqYm9vdF9jZmcpCiAJCQkoY21kLT5yZXNwLnVyZXNwLmJvb3RfY2ZnLmJvb3RfY2Zn
ICYgQk9PVF9DT05GSUdfR0VDQykgPyAxIDogMDsKIAl9CiAKKwlyZWxlYXNlX3BzcF9jbWRfYnVm
KHBzcCk7CisKIAlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHBzcF9ib290X2NvbmZpZ19z
ZXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IGJvb3RfY2ZnKQogeworCWlu
dCByZXQ7CiAJc3RydWN0IHBzcF9jb250ZXh0ICpwc3AgPSAmYWRldi0+cHNwOwotCXN0cnVjdCBw
c3BfZ2Z4X2NtZF9yZXNwICpjbWQgPSBwc3AtPmNtZDsKKwlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVz
cCAqY21kOwogCiAJaWYgKGFtZGdwdV9zcmlvdl92ZihhZGV2KSkKIAkJcmV0dXJuIDA7CiAKLQlt
ZW1zZXQoY21kLCAwLCBzaXplb2Yoc3RydWN0IHBzcF9nZnhfY21kX3Jlc3ApKTsKKwljbWQgPSBh
Y3F1aXJlX3BzcF9jbWRfYnVmKHBzcCk7CiAKIAljbWQtPmNtZF9pZCA9IEdGWF9DTURfSURfQk9P
VF9DRkc7CiAJY21kLT5jbWQuYm9vdF9jZmcuc3ViX2NtZCA9IEJPT1RDRkdfQ01EX1NFVDsKIAlj
bWQtPmNtZC5ib290X2NmZy5ib290X2NvbmZpZyA9IGJvb3RfY2ZnOwogCWNtZC0+Y21kLmJvb3Rf
Y2ZnLmJvb3RfY29uZmlnX3ZhbGlkID0gYm9vdF9jZmc7CiAKLQlyZXR1cm4gcHNwX2NtZF9zdWJt
aXRfYnVmKHBzcCwgTlVMTCwgY21kLCBwc3AtPmZlbmNlX2J1Zl9tY19hZGRyKTsKKwlyZXQgPSBw
c3BfY21kX3N1Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsIHBzcC0+ZmVuY2VfYnVmX21jX2FkZHIp
OworCisJcmVsZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCisJcmV0dXJuIHJldDsKIH0KIAogc3Rh
dGljIGludCBwc3BfcmxfbG9hZChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKKwlpbnQg
cmV0OwogCXN0cnVjdCBwc3BfY29udGV4dCAqcHNwID0gJmFkZXYtPnBzcDsKLQlzdHJ1Y3QgcHNw
X2dmeF9jbWRfcmVzcCAqY21kID0gcHNwLT5jbWQ7Ci0KLQltZW1zZXQoY21kLCAwLCBzaXplb2Yo
c3RydWN0IHBzcF9nZnhfY21kX3Jlc3ApKTsKKwlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21k
OwogCiAJaWYgKCFpc19wc3BfZndfdmFsaWQocHNwLT5ybCkpCiAJCXJldHVybiAwOwogCisJY21k
ID0gYWNxdWlyZV9wc3BfY21kX2J1Zihwc3ApOworCiAJbWVtc2V0KHBzcC0+ZndfcHJpX2J1Ziwg
MCwgUFNQXzFfTUVHKTsKIAltZW1jcHkocHNwLT5md19wcmlfYnVmLCBwc3AtPnJsLnN0YXJ0X2Fk
ZHIsIHBzcC0+cmwuc2l6ZV9ieXRlcyk7CiAKQEAgLTc0NSwxNCArNzczLDE2IEBAIHN0YXRpYyBp
bnQgcHNwX3JsX2xvYWQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJY21kLT5jbWQuY21k
X2xvYWRfaXBfZncuZndfc2l6ZSA9IHBzcC0+cmwuc2l6ZV9ieXRlczsKIAljbWQtPmNtZC5jbWRf
bG9hZF9pcF9mdy5md190eXBlID0gR0ZYX0ZXX1RZUEVfUkVHX0xJU1Q7CiAKLQlyZXR1cm4gcHNw
X2NtZF9zdWJtaXRfYnVmKHBzcCwgTlVMTCwgY21kLCBwc3AtPmZlbmNlX2J1Zl9tY19hZGRyKTsK
KwlyZXQgPSBwc3BfY21kX3N1Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsIHBzcC0+ZmVuY2VfYnVm
X21jX2FkZHIpOworCisJcmVsZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCisJcmV0dXJuIHJldDsK
IH0KIAogc3RhdGljIHZvaWQgcHNwX3ByZXBfYXNkX2xvYWRfY21kX2J1ZihzdHJ1Y3QgcHNwX2dm
eF9jbWRfcmVzcCAqY21kLAogCQkJCXVpbnQ2NF90IGFzZF9tYywgdWludDMyX3Qgc2l6ZSkKIHsK
LQltZW1zZXQoY21kLCAwLCBzaXplb2Yoc3RydWN0IHBzcF9nZnhfY21kX3Jlc3ApKTsKLQogCWNt
ZC0+Y21kX2lkID0gR0ZYX0NNRF9JRF9MT0FEX0FTRDsKIAljbWQtPmNtZC5jbWRfbG9hZF90YS5h
cHBfcGh5X2FkZHJfbG8gPSBsb3dlcl8zMl9iaXRzKGFzZF9tYyk7CiAJY21kLT5jbWQuY21kX2xv
YWRfdGEuYXBwX3BoeV9hZGRyX2hpID0gdXBwZXJfMzJfYml0cyhhc2RfbWMpOwpAQCAtNzY2LDcg
Kzc5Niw3IEBAIHN0YXRpYyB2b2lkIHBzcF9wcmVwX2FzZF9sb2FkX2NtZF9idWYoc3RydWN0IHBz
cF9nZnhfY21kX3Jlc3AgKmNtZCwKIHN0YXRpYyBpbnQgcHNwX2FzZF9sb2FkKHN0cnVjdCBwc3Bf
Y29udGV4dCAqcHNwKQogewogCWludCByZXQ7Ci0Jc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNt
ZCA9IHBzcC0+Y21kOworCXN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQ7CiAKIAkvKiBJZiBQ
U1AgdmVyc2lvbiBkb2Vzbid0IG1hdGNoIEFTRCB2ZXJzaW9uLCBhc2QgbG9hZGluZyB3aWxsIGJl
IGZhaWxlZC4KIAkgKiBhZGQgd29ya2Fyb3VuZCB0byBieXBhc3MgaXQgZm9yIHNyaW92IG5vdy4K
QEAgLTc3NSw2ICs4MDUsOCBAQCBzdGF0aWMgaW50IHBzcF9hc2RfbG9hZChzdHJ1Y3QgcHNwX2Nv
bnRleHQgKnBzcCkKIAlpZiAoYW1kZ3B1X3NyaW92X3ZmKHBzcC0+YWRldikgfHwgIXBzcC0+YXNk
X3Vjb2RlX3NpemUpCiAJCXJldHVybiAwOwogCisJY21kID0gYWNxdWlyZV9wc3BfY21kX2J1Zihw
c3ApOworCiAJcHNwX2NvcHlfZncocHNwLCBwc3AtPmFzZF9zdGFydF9hZGRyLCBwc3AtPmFzZF91
Y29kZV9zaXplKTsKIAogCXBzcF9wcmVwX2FzZF9sb2FkX2NtZF9idWYoY21kLCBwc3AtPmZ3X3By
aV9tY19hZGRyLApAQCAtNzg3LDE0ICs4MTksMTQgQEAgc3RhdGljIGludCBwc3BfYXNkX2xvYWQo
c3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiAJCXBzcC0+YXNkX2NvbnRleHQuc2Vzc2lvbl9pZCA9
IGNtZC0+cmVzcC5zZXNzaW9uX2lkOwogCX0KIAorCXJlbGVhc2VfcHNwX2NtZF9idWYocHNwKTsK
KwogCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyB2b2lkIHBzcF9wcmVwX3RhX3VubG9hZF9jbWRf
YnVmKHN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQsCiAJCQkJICAgICAgIHVpbnQzMl90IHNl
c3Npb25faWQpCiB7Ci0JbWVtc2V0KGNtZCwgMCwgc2l6ZW9mKHN0cnVjdCBwc3BfZ2Z4X2NtZF9y
ZXNwKSk7Ci0KIAljbWQtPmNtZF9pZCA9IEdGWF9DTURfSURfVU5MT0FEX1RBOwogCWNtZC0+Y21k
LmNtZF91bmxvYWRfdGEuc2Vzc2lvbl9pZCA9IHNlc3Npb25faWQ7CiB9CkBAIC04MDIsNyArODM0
LDcgQEAgc3RhdGljIHZvaWQgcHNwX3ByZXBfdGFfdW5sb2FkX2NtZF9idWYoc3RydWN0IHBzcF9n
ZnhfY21kX3Jlc3AgKmNtZCwKIHN0YXRpYyBpbnQgcHNwX2FzZF91bmxvYWQoc3RydWN0IHBzcF9j
b250ZXh0ICpwc3ApCiB7CiAJaW50IHJldDsKLQlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21k
ID0gcHNwLT5jbWQ7CisJc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZDsKIAogCWlmIChhbWRn
cHVfc3Jpb3ZfdmYocHNwLT5hZGV2KSkKIAkJcmV0dXJuIDA7CkBAIC04MTAsNiArODQyLDggQEAg
c3RhdGljIGludCBwc3BfYXNkX3VubG9hZChzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKIAlpZiAo
IXBzcC0+YXNkX2NvbnRleHQuYXNkX2luaXRpYWxpemVkKQogCQlyZXR1cm4gMDsKIAorCWNtZCA9
IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKKwogCXBzcF9wcmVwX3RhX3VubG9hZF9jbWRfYnVm
KGNtZCwgcHNwLT5hc2RfY29udGV4dC5zZXNzaW9uX2lkKTsKIAogCXJldCA9IHBzcF9jbWRfc3Vi
bWl0X2J1Zihwc3AsIE5VTEwsIGNtZCwKQEAgLTgxNywxNCArODUxLDE0IEBAIHN0YXRpYyBpbnQg
cHNwX2FzZF91bmxvYWQoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiAJaWYgKCFyZXQpCiAJCXBz
cC0+YXNkX2NvbnRleHQuYXNkX2luaXRpYWxpemVkID0gZmFsc2U7CiAKKwlyZWxlYXNlX3BzcF9j
bWRfYnVmKHBzcCk7CisKIAlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZCBwc3BfcHJlcF9y
ZWdfcHJvZ19jbWRfYnVmKHN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQsCiAJCXVpbnQzMl90
IGlkLCB1aW50MzJfdCB2YWx1ZSkKIHsKLQltZW1zZXQoY21kLCAwLCBzaXplb2Yoc3RydWN0IHBz
cF9nZnhfY21kX3Jlc3ApKTsKLQogCWNtZC0+Y21kX2lkID0gR0ZYX0NNRF9JRF9QUk9HX1JFRzsK
IAljbWQtPmNtZC5jbWRfc2V0dXBfcmVnX3Byb2cucmVnX3ZhbHVlID0gdmFsdWU7CiAJY21kLT5j
bWQuY21kX3NldHVwX3JlZ19wcm9nLnJlZ19pZCA9IGlkOwpAQCAtODMzLDE3ICs4NjcsMjEgQEAg
c3RhdGljIHZvaWQgcHNwX3ByZXBfcmVnX3Byb2dfY21kX2J1ZihzdHJ1Y3QgcHNwX2dmeF9jbWRf
cmVzcCAqY21kLAogaW50IHBzcF9yZWdfcHJvZ3JhbShzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCwg
ZW51bSBwc3BfcmVnX3Byb2dfaWQgcmVnLAogCQl1aW50MzJfdCB2YWx1ZSkKIHsKLQlzdHJ1Y3Qg
cHNwX2dmeF9jbWRfcmVzcCAqY21kID0gcHNwLT5jbWQ7CisJc3RydWN0IHBzcF9nZnhfY21kX3Jl
c3AgKmNtZDsKIAlpbnQgcmV0ID0gMDsKIAogCWlmIChyZWcgPj0gUFNQX1JFR19MQVNUKQogCQly
ZXR1cm4gLUVJTlZBTDsKIAorCWNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKKwogCXBz
cF9wcmVwX3JlZ19wcm9nX2NtZF9idWYoY21kLCByZWcsIHZhbHVlKTsKIAlyZXQgPSBwc3BfY21k
X3N1Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsIHBzcC0+ZmVuY2VfYnVmX21jX2FkZHIpOwogCWlm
IChyZXQpCiAJCURSTV9FUlJPUigiUFNQIGZhaWxlZCB0byBwcm9ncmFtIHJlZyBpZCAlZCIsIHJl
Zyk7CiAKKwlyZWxlYXNlX3BzcF9jbWRfYnVmKHBzcCk7CisKIAlyZXR1cm4gcmV0OwogfQogCkBA
IC04NTMsOCArODkxLDYgQEAgc3RhdGljIHZvaWQgcHNwX3ByZXBfdGFfbG9hZF9jbWRfYnVmKHN0
cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQsCiAJCQkJICAgICB1aW50NjRfdCB0YV9zaGFyZWRf
bWMsCiAJCQkJICAgICB1aW50MzJfdCB0YV9zaGFyZWRfc2l6ZSkKIHsKLQltZW1zZXQoY21kLCAw
LCBzaXplb2Yoc3RydWN0IHBzcF9nZnhfY21kX3Jlc3ApKTsKLQogCWNtZC0+Y21kX2lkCQkJCT0g
R0ZYX0NNRF9JRF9MT0FEX1RBOwogCWNtZC0+Y21kLmNtZF9sb2FkX3RhLmFwcF9waHlfYWRkcl9s
byAJPSBsb3dlcl8zMl9iaXRzKHRhX2Jpbl9tYyk7CiAJY21kLT5jbWQuY21kX2xvYWRfdGEuYXBw
X3BoeV9hZGRyX2hpCT0gdXBwZXJfMzJfYml0cyh0YV9iaW5fbWMpOwpAQCAtODg2LDggKzkyMiw2
IEBAIHN0YXRpYyB2b2lkIHBzcF9wcmVwX3RhX2ludm9rZV9jbWRfYnVmKHN0cnVjdCBwc3BfZ2Z4
X2NtZF9yZXNwICpjbWQsCiAJCQkJICAgICAgIHVpbnQzMl90IHRhX2NtZF9pZCwKIAkJCQkgICAg
ICAgdWludDMyX3Qgc2Vzc2lvbl9pZCkKIHsKLQltZW1zZXQoY21kLCAwLCBzaXplb2Yoc3RydWN0
IHBzcF9nZnhfY21kX3Jlc3ApKTsKLQogCWNtZC0+Y21kX2lkCQkJCT0gR0ZYX0NNRF9JRF9JTlZP
S0VfQ01EOwogCWNtZC0+Y21kLmNtZF9pbnZva2VfY21kLnNlc3Npb25faWQJPSBzZXNzaW9uX2lk
OwogCWNtZC0+Y21kLmNtZF9pbnZva2VfY21kLnRhX2NtZF9pZAk9IHRhX2NtZF9pZDsKQEAgLTg5
OCwyNSArOTMyLDI5IEBAIHN0YXRpYyBpbnQgcHNwX3RhX2ludm9rZShzdHJ1Y3QgcHNwX2NvbnRl
eHQgKnBzcCwKIAkJICB1aW50MzJfdCBzZXNzaW9uX2lkKQogewogCWludCByZXQ7Ci0Jc3RydWN0
IHBzcF9nZnhfY21kX3Jlc3AgKmNtZCA9IHBzcC0+Y21kOworCXN0cnVjdCBwc3BfZ2Z4X2NtZF9y
ZXNwICpjbWQgPSBhY3F1aXJlX3BzcF9jbWRfYnVmKHBzcCk7CiAKIAlwc3BfcHJlcF90YV9pbnZv
a2VfY21kX2J1ZihjbWQsIHRhX2NtZF9pZCwgc2Vzc2lvbl9pZCk7CiAKIAlyZXQgPSBwc3BfY21k
X3N1Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsCiAJCQkJIHBzcC0+ZmVuY2VfYnVmX21jX2FkZHIp
OwogCisJcmVsZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCiAJcmV0dXJuIHJldDsKIH0KIAogc3Rh
dGljIGludCBwc3BfeGdtaV9sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogewogCWludCBy
ZXQ7Ci0Jc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZCA9IHBzcC0+Y21kOworCXN0cnVjdCBw
c3BfZ2Z4X2NtZF9yZXNwICpjbWQ7CiAKIAkvKgogCSAqIFRPRE86IGJ5cGFzcyB0aGUgbG9hZGlu
ZyBpbiBzcmlvdiBmb3Igbm93CiAJICovCiAKKwljbWQgPSBhY3F1aXJlX3BzcF9jbWRfYnVmKHBz
cCk7CisKIAlwc3BfY29weV9mdyhwc3AsIHBzcC0+dGFfeGdtaV9zdGFydF9hZGRyLCBwc3AtPnRh
X3hnbWlfdWNvZGVfc2l6ZSk7CiAKIAlwc3BfcHJlcF90YV9sb2FkX2NtZF9idWYoY21kLApAQCAt
OTMzLDEzICs5NzEsMTUgQEAgc3RhdGljIGludCBwc3BfeGdtaV9sb2FkKHN0cnVjdCBwc3BfY29u
dGV4dCAqcHNwKQogCQlwc3AtPnhnbWlfY29udGV4dC5zZXNzaW9uX2lkID0gY21kLT5yZXNwLnNl
c3Npb25faWQ7CiAJfQogCisJcmVsZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCiAJcmV0dXJuIHJl
dDsKIH0KIAogc3RhdGljIGludCBwc3BfeGdtaV91bmxvYWQoc3RydWN0IHBzcF9jb250ZXh0ICpw
c3ApCiB7CiAJaW50IHJldDsKLQlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21kID0gcHNwLT5j
bWQ7CisJc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZDsKIAlzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiA9IHBzcC0+YWRldjsKIAogCS8qIFhHTUkgVEEgdW5sb2FkIGN1cnJlbnRseSBpcyBu
b3Qgc3VwcG9ydGVkIG9uIEFyY3R1cnVzL0FsZGViYXJhbiBBK0EgKi8KQEAgLTk1MSwxMSArOTkx
LDE1IEBAIHN0YXRpYyBpbnQgcHNwX3hnbWlfdW5sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNw
KQogCSAqIFRPRE86IGJ5cGFzcyB0aGUgdW5sb2FkaW5nIGluIHNyaW92IGZvciBub3cKIAkgKi8K
IAorCWNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKKwogCXBzcF9wcmVwX3RhX3VubG9h
ZF9jbWRfYnVmKGNtZCwgcHNwLT54Z21pX2NvbnRleHQuc2Vzc2lvbl9pZCk7CiAKIAlyZXQgPSBw
c3BfY21kX3N1Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsCiAJCQkJIHBzcC0+ZmVuY2VfYnVmX21j
X2FkZHIpOwogCisJcmVsZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCiAJcmV0dXJuIHJldDsKIH0K
IApAQCAtMTE3NSw3ICsxMjE5LDcgQEAgc3RhdGljIGludCBwc3BfcmFzX2luaXRfc2hhcmVkX2J1
ZihzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKIHN0YXRpYyBpbnQgcHNwX3Jhc19sb2FkKHN0cnVj
dCBwc3BfY29udGV4dCAqcHNwKQogewogCWludCByZXQ7Ci0Jc3RydWN0IHBzcF9nZnhfY21kX3Jl
c3AgKmNtZCA9IHBzcC0+Y21kOworCXN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQ7CiAJc3Ry
dWN0IHRhX3Jhc19zaGFyZWRfbWVtb3J5ICpyYXNfY21kOwogCiAJLyoKQEAgLTExOTMsNiArMTIz
Nyw4IEBAIHN0YXRpYyBpbnQgcHNwX3Jhc19sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQog
CWVsc2UKIAkJcmFzX2NtZC0+cmFzX2luX21lc3NhZ2UuaW5pdF9mbGFncy5kZ3B1X21vZGUgPSAx
OwogCisJY21kID0gYWNxdWlyZV9wc3BfY21kX2J1Zihwc3ApOworCiAJcHNwX3ByZXBfdGFfbG9h
ZF9jbWRfYnVmKGNtZCwKIAkJCQkgcHNwLT5md19wcmlfbWNfYWRkciwKIAkJCQkgcHNwLT50YV9y
YXNfdWNvZGVfc2l6ZSwKQEAgLTEyMTEsNiArMTI1Nyw4IEBAIHN0YXRpYyBpbnQgcHNwX3Jhc19s
b2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogCQkJZGV2X3dhcm4ocHNwLT5hZGV2LT5kZXYs
ICJSQVMgSW5pdCBTdGF0dXM6IDB4JVhcbiIsIHJhc19jbWQtPnJhc19zdGF0dXMpOwogCX0KIAor
CXJlbGVhc2VfcHNwX2NtZF9idWYocHNwKTsKKwogCWlmIChyZXQgfHwgcmFzX2NtZC0+cmFzX3N0
YXR1cykKIAkJYW1kZ3B1X3Jhc19maW5pKHBzcC0+YWRldik7CiAKQEAgLTEyMjAsNyArMTI2OCw3
IEBAIHN0YXRpYyBpbnQgcHNwX3Jhc19sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogc3Rh
dGljIGludCBwc3BfcmFzX3VubG9hZChzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKIHsKIAlpbnQg
cmV0OwotCXN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQgPSBwc3AtPmNtZDsKKwlzdHJ1Y3Qg
cHNwX2dmeF9jbWRfcmVzcCAqY21kOwogCiAJLyoKIAkgKiBUT0RPOiBieXBhc3MgdGhlIHVubG9h
ZGluZyBpbiBzcmlvdiBmb3Igbm93CkBAIC0xMjI4LDExICsxMjc2LDE1IEBAIHN0YXRpYyBpbnQg
cHNwX3Jhc191bmxvYWQoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiAJaWYgKGFtZGdwdV9zcmlv
dl92Zihwc3AtPmFkZXYpKQogCQlyZXR1cm4gMDsKIAorCWNtZCA9IGFjcXVpcmVfcHNwX2NtZF9i
dWYocHNwKTsKKwogCXBzcF9wcmVwX3RhX3VubG9hZF9jbWRfYnVmKGNtZCwgcHNwLT5yYXMuc2Vz
c2lvbl9pZCk7CiAKIAlyZXQgPSBwc3BfY21kX3N1Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsCiAJ
CQlwc3AtPmZlbmNlX2J1Zl9tY19hZGRyKTsKIAorCXJlbGVhc2VfcHNwX2NtZF9idWYocHNwKTsK
KwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTE0NzMsNyArMTUyNSw3IEBAIHN0YXRpYyBpbnQgcHNw
X2hkY3BfaW5pdF9zaGFyZWRfYnVmKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogc3RhdGljIGlu
dCBwc3BfaGRjcF9sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogewogCWludCByZXQ7Ci0J
c3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZCA9IHBzcC0+Y21kOworCXN0cnVjdCBwc3BfZ2Z4
X2NtZF9yZXNwICpjbWQ7CiAKIAkvKgogCSAqIFRPRE86IGJ5cGFzcyB0aGUgbG9hZGluZyBpbiBz
cmlvdiBmb3Igbm93CkBAIC0xNDg0LDYgKzE1MzYsOCBAQCBzdGF0aWMgaW50IHBzcF9oZGNwX2xv
YWQoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiAJcHNwX2NvcHlfZncocHNwLCBwc3AtPnRhX2hk
Y3Bfc3RhcnRfYWRkciwKIAkJICAgIHBzcC0+dGFfaGRjcF91Y29kZV9zaXplKTsKIAorCWNtZCA9
IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKKwogCXBzcF9wcmVwX3RhX2xvYWRfY21kX2J1Zihj
bWQsCiAJCQkJIHBzcC0+ZndfcHJpX21jX2FkZHIsCiAJCQkJIHBzcC0+dGFfaGRjcF91Y29kZV9z
aXplLApAQCAtMTQ5OCw2ICsxNTUyLDggQEAgc3RhdGljIGludCBwc3BfaGRjcF9sb2FkKHN0cnVj
dCBwc3BfY29udGV4dCAqcHNwKQogCQltdXRleF9pbml0KCZwc3AtPmhkY3BfY29udGV4dC5tdXRl
eCk7CiAJfQogCisJcmVsZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCiAJcmV0dXJuIHJldDsKIH0K
IHN0YXRpYyBpbnQgcHNwX2hkY3BfaW5pdGlhbGl6ZShzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkK
QEAgLTE1MzIsNyArMTU4OCw3IEBAIHN0YXRpYyBpbnQgcHNwX2hkY3BfaW5pdGlhbGl6ZShzdHJ1
Y3QgcHNwX2NvbnRleHQgKnBzcCkKIHN0YXRpYyBpbnQgcHNwX2hkY3BfdW5sb2FkKHN0cnVjdCBw
c3BfY29udGV4dCAqcHNwKQogewogCWludCByZXQ7Ci0Jc3RydWN0IHBzcF9nZnhfY21kX3Jlc3Ag
KmNtZCA9IHBzcC0+Y21kOworCXN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQ7CiAKIAkvKgog
CSAqIFRPRE86IGJ5cGFzcyB0aGUgdW5sb2FkaW5nIGluIHNyaW92IGZvciBub3cKQEAgLTE1NDAs
MTAgKzE1OTYsMTQgQEAgc3RhdGljIGludCBwc3BfaGRjcF91bmxvYWQoc3RydWN0IHBzcF9jb250
ZXh0ICpwc3ApCiAJaWYgKGFtZGdwdV9zcmlvdl92Zihwc3AtPmFkZXYpKQogCQlyZXR1cm4gMDsK
IAorCWNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKKwogCXBzcF9wcmVwX3RhX3VubG9h
ZF9jbWRfYnVmKGNtZCwgcHNwLT5oZGNwX2NvbnRleHQuc2Vzc2lvbl9pZCk7CiAKIAlyZXQgPSBw
c3BfY21kX3N1Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsIHBzcC0+ZmVuY2VfYnVmX21jX2FkZHIp
OwogCisJcmVsZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAt
MTYxMiw3ICsxNjcyLDcgQEAgc3RhdGljIGludCBwc3BfZHRtX2luaXRfc2hhcmVkX2J1ZihzdHJ1
Y3QgcHNwX2NvbnRleHQgKnBzcCkKIHN0YXRpYyBpbnQgcHNwX2R0bV9sb2FkKHN0cnVjdCBwc3Bf
Y29udGV4dCAqcHNwKQogewogCWludCByZXQ7Ci0Jc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNt
ZCA9IHBzcC0+Y21kOworCXN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQ7CiAKIAkvKgogCSAq
IFRPRE86IGJ5cGFzcyB0aGUgbG9hZGluZyBpbiBzcmlvdiBmb3Igbm93CkBAIC0xNjIyLDYgKzE2
ODIsOCBAQCBzdGF0aWMgaW50IHBzcF9kdG1fbG9hZChzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkK
IAogCXBzcF9jb3B5X2Z3KHBzcCwgcHNwLT50YV9kdG1fc3RhcnRfYWRkciwgcHNwLT50YV9kdG1f
dWNvZGVfc2l6ZSk7CiAKKwljbWQgPSBhY3F1aXJlX3BzcF9jbWRfYnVmKHBzcCk7CisKIAlwc3Bf
cHJlcF90YV9sb2FkX2NtZF9idWYoY21kLAogCQkJCSBwc3AtPmZ3X3ByaV9tY19hZGRyLAogCQkJ
CSBwc3AtPnRhX2R0bV91Y29kZV9zaXplLApAQCAtMTYzNiw2ICsxNjk4LDggQEAgc3RhdGljIGlu
dCBwc3BfZHRtX2xvYWQoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiAJCW11dGV4X2luaXQoJnBz
cC0+ZHRtX2NvbnRleHQubXV0ZXgpOwogCX0KIAorCXJlbGVhc2VfcHNwX2NtZF9idWYocHNwKTsK
KwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTE2NzEsNyArMTczNSw3IEBAIHN0YXRpYyBpbnQgcHNw
X2R0bV9pbml0aWFsaXplKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogc3RhdGljIGludCBwc3Bf
ZHRtX3VubG9hZChzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKIHsKIAlpbnQgcmV0OwotCXN0cnVj
dCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQgPSBwc3AtPmNtZDsKKwlzdHJ1Y3QgcHNwX2dmeF9jbWRf
cmVzcCAqY21kOwogCiAJLyoKIAkgKiBUT0RPOiBieXBhc3MgdGhlIHVubG9hZGluZyBpbiBzcmlv
diBmb3Igbm93CkBAIC0xNjc5LDEwICsxNzQzLDE0IEBAIHN0YXRpYyBpbnQgcHNwX2R0bV91bmxv
YWQoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiAJaWYgKGFtZGdwdV9zcmlvdl92Zihwc3AtPmFk
ZXYpKQogCQlyZXR1cm4gMDsKIAorCWNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKKwog
CXBzcF9wcmVwX3RhX3VubG9hZF9jbWRfYnVmKGNtZCwgcHNwLT5kdG1fY29udGV4dC5zZXNzaW9u
X2lkKTsKIAogCXJldCA9IHBzcF9jbWRfc3VibWl0X2J1Zihwc3AsIE5VTEwsIGNtZCwgcHNwLT5m
ZW5jZV9idWZfbWNfYWRkcik7CiAKKwlyZWxlYXNlX3BzcF9jbWRfYnVmKHBzcCk7CisKIAlyZXR1
cm4gcmV0OwogfQogCkBAIC0xNzUxLDEwICsxODE5LDEyIEBAIHN0YXRpYyBpbnQgcHNwX3JhcF9p
bml0X3NoYXJlZF9idWYoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiBzdGF0aWMgaW50IHBzcF9y
YXBfbG9hZChzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKIHsKIAlpbnQgcmV0OwotCXN0cnVjdCBw
c3BfZ2Z4X2NtZF9yZXNwICpjbWQgPSBwc3AtPmNtZDsKKwlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVz
cCAqY21kOwogCiAJcHNwX2NvcHlfZncocHNwLCBwc3AtPnRhX3JhcF9zdGFydF9hZGRyLCBwc3At
PnRhX3JhcF91Y29kZV9zaXplKTsKIAorCWNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsK
KwogCXBzcF9wcmVwX3RhX2xvYWRfY21kX2J1ZihjbWQsCiAJCQkJIHBzcC0+ZndfcHJpX21jX2Fk
ZHIsCiAJCQkJIHBzcC0+dGFfcmFwX3Vjb2RlX3NpemUsCkBAIC0xNzY5LDE4ICsxODM5LDIyIEBA
IHN0YXRpYyBpbnQgcHNwX3JhcF9sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogCQltdXRl
eF9pbml0KCZwc3AtPnJhcF9jb250ZXh0Lm11dGV4KTsKIAl9CiAKKwlyZWxlYXNlX3BzcF9jbWRf
YnVmKHBzcCk7CisKIAlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHBzcF9yYXBfdW5sb2Fk
KHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogewogCWludCByZXQ7Ci0Jc3RydWN0IHBzcF9nZnhf
Y21kX3Jlc3AgKmNtZCA9IHBzcC0+Y21kOworCXN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQg
PSBhY3F1aXJlX3BzcF9jbWRfYnVmKHBzcCk7CiAKIAlwc3BfcHJlcF90YV91bmxvYWRfY21kX2J1
ZihjbWQsIHBzcC0+cmFwX2NvbnRleHQuc2Vzc2lvbl9pZCk7CiAKIAlyZXQgPSBwc3BfY21kX3N1
Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsIHBzcC0+ZmVuY2VfYnVmX21jX2FkZHIpOwogCisJcmVs
ZWFzZV9wc3BfY21kX2J1Zihwc3ApOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTkwNSw3ICsx
OTc5LDcgQEAgc3RhdGljIGludCBwc3Bfc2VjdXJlZGlzcGxheV9pbml0X3NoYXJlZF9idWYoc3Ry
dWN0IHBzcF9jb250ZXh0ICpwc3ApCiBzdGF0aWMgaW50IHBzcF9zZWN1cmVkaXNwbGF5X2xvYWQo
c3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiB7CiAJaW50IHJldDsKLQlzdHJ1Y3QgcHNwX2dmeF9j
bWRfcmVzcCAqY21kID0gcHNwLT5jbWQ7CisJc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZCA9
IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKIAogCW1lbXNldChwc3AtPmZ3X3ByaV9idWYsIDAs
IFBTUF8xX01FRyk7CiAJbWVtY3B5KHBzcC0+ZndfcHJpX2J1ZiwgcHNwLT50YV9zZWN1cmVkaXNw
bGF5X3N0YXJ0X2FkZHIsIHBzcC0+dGFfc2VjdXJlZGlzcGxheV91Y29kZV9zaXplKTsKQEAgLTE5
MTgsMjYgKzE5OTIsMjggQEAgc3RhdGljIGludCBwc3Bfc2VjdXJlZGlzcGxheV9sb2FkKHN0cnVj
dCBwc3BfY29udGV4dCAqcHNwKQogCiAJcmV0ID0gcHNwX2NtZF9zdWJtaXRfYnVmKHBzcCwgTlVM
TCwgY21kLCBwc3AtPmZlbmNlX2J1Zl9tY19hZGRyKTsKIAotCWlmIChyZXQpCi0JCWdvdG8gZmFp
bGVkOworCWlmICghcmV0KSB7CisJCXBzcC0+c2VjdXJlZGlzcGxheV9jb250ZXh0LnNlY3VyZWRp
c3BsYXlfaW5pdGlhbGl6ZWQgPSB0cnVlOworCQlwc3AtPnNlY3VyZWRpc3BsYXlfY29udGV4dC5z
ZXNzaW9uX2lkID0gY21kLT5yZXNwLnNlc3Npb25faWQ7CisJCW11dGV4X2luaXQoJnBzcC0+c2Vj
dXJlZGlzcGxheV9jb250ZXh0Lm11dGV4KTsKKwl9CiAKLQlwc3AtPnNlY3VyZWRpc3BsYXlfY29u
dGV4dC5zZWN1cmVkaXNwbGF5X2luaXRpYWxpemVkID0gdHJ1ZTsKLQlwc3AtPnNlY3VyZWRpc3Bs
YXlfY29udGV4dC5zZXNzaW9uX2lkID0gY21kLT5yZXNwLnNlc3Npb25faWQ7Ci0JbXV0ZXhfaW5p
dCgmcHNwLT5zZWN1cmVkaXNwbGF5X2NvbnRleHQubXV0ZXgpOworCXJlbGVhc2VfcHNwX2NtZF9i
dWYocHNwKTsKIAotZmFpbGVkOgogCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgcHNwX3Nl
Y3VyZWRpc3BsYXlfdW5sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogewogCWludCByZXQ7
Ci0Jc3RydWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZCA9IHBzcC0+Y21kOworCXN0cnVjdCBwc3Bf
Z2Z4X2NtZF9yZXNwICpjbWQgPSBhY3F1aXJlX3BzcF9jbWRfYnVmKHBzcCk7CiAKIAlwc3BfcHJl
cF90YV91bmxvYWRfY21kX2J1ZihjbWQsIHBzcC0+c2VjdXJlZGlzcGxheV9jb250ZXh0LnNlc3Np
b25faWQpOwogCiAJcmV0ID0gcHNwX2NtZF9zdWJtaXRfYnVmKHBzcCwgTlVMTCwgY21kLCBwc3At
PmZlbmNlX2J1Zl9tY19hZGRyKTsKIAorCXJlbGVhc2VfcHNwX2NtZF9idWYocHNwKTsKKwogCXJl
dHVybiByZXQ7CiB9CiAKQEAgLTIzMTIsOCArMjM4OCw2IEBAIHN0YXRpYyBpbnQgcHNwX3ByZXBf
bG9hZF9pcF9md19jbWRfYnVmKHN0cnVjdCBhbWRncHVfZmlybXdhcmVfaW5mbyAqdWNvZGUsCiAJ
aW50IHJldDsKIAl1aW50NjRfdCBmd19tZW1fbWNfYWRkciA9IHVjb2RlLT5tY19hZGRyOwogCi0J
bWVtc2V0KGNtZCwgMCwgc2l6ZW9mKHN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwKSk7Ci0KIAljbWQt
PmNtZF9pZCA9IEdGWF9DTURfSURfTE9BRF9JUF9GVzsKIAljbWQtPmNtZC5jbWRfbG9hZF9pcF9m
dy5md19waHlfYWRkcl9sbyA9IGxvd2VyXzMyX2JpdHMoZndfbWVtX21jX2FkZHIpOwogCWNtZC0+
Y21kLmNtZF9sb2FkX2lwX2Z3LmZ3X3BoeV9hZGRyX2hpID0gdXBwZXJfMzJfYml0cyhmd19tZW1f
bWNfYWRkcik7CkBAIC0yMzMwLDEzICsyNDA0LDE1IEBAIHN0YXRpYyBpbnQgcHNwX2V4ZWN1dGVf
bm9uX3BzcF9md19sb2FkKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwLAogCQkJICAgICAgICAgIHN0
cnVjdCBhbWRncHVfZmlybXdhcmVfaW5mbyAqdWNvZGUpCiB7CiAJaW50IHJldCA9IDA7CisJc3Ry
dWN0IHBzcF9nZnhfY21kX3Jlc3AgKmNtZCA9IGFjcXVpcmVfcHNwX2NtZF9idWYocHNwKTsKIAot
CXJldCA9IHBzcF9wcmVwX2xvYWRfaXBfZndfY21kX2J1Zih1Y29kZSwgcHNwLT5jbWQpOwotCWlm
IChyZXQpCi0JCXJldHVybiByZXQ7CisJcmV0ID0gcHNwX3ByZXBfbG9hZF9pcF9md19jbWRfYnVm
KHVjb2RlLCBjbWQpOworCWlmICghcmV0KSB7CisJCXJldCA9IHBzcF9jbWRfc3VibWl0X2J1Zihw
c3AsIHVjb2RlLCBjbWQsCisJCQkJCSBwc3AtPmZlbmNlX2J1Zl9tY19hZGRyKTsKKwl9CiAKLQly
ZXQgPSBwc3BfY21kX3N1Ym1pdF9idWYocHNwLCB1Y29kZSwgcHNwLT5jbWQsCi0JCQkJIHBzcC0+
ZmVuY2VfYnVmX21jX2FkZHIpOworCXJlbGVhc2VfcHNwX2NtZF9idWYocHNwKTsKIAogCXJldHVy
biByZXQ7CiB9CkBAIC0yODA3LDE1ICsyODgzLDE1IEBAIGludCBwc3BfZ3B1X3Jlc2V0KHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2KQogaW50IHBzcF9ybGNfYXV0b2xvYWRfc3RhcnQoc3RydWN0
IHBzcF9jb250ZXh0ICpwc3ApCiB7CiAJaW50IHJldDsKLQlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVz
cCAqY21kID0gcHNwLT5jbWQ7Ci0KLQltZW1zZXQoY21kLCAwLCBzaXplb2Yoc3RydWN0IHBzcF9n
ZnhfY21kX3Jlc3ApKTsKKwlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21kID0gYWNxdWlyZV9w
c3BfY21kX2J1Zihwc3ApOwogCiAJY21kLT5jbWRfaWQgPSBHRlhfQ01EX0lEX0FVVE9MT0FEX1JM
QzsKIAogCXJldCA9IHBzcF9jbWRfc3VibWl0X2J1Zihwc3AsIE5VTEwsIGNtZCwKIAkJCQkgcHNw
LT5mZW5jZV9idWZfbWNfYWRkcik7CiAKKwlyZWxlYXNlX3BzcF9jbWRfYnVmKHBzcCk7CisKIAly
ZXR1cm4gcmV0OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfcHNwLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcHNwLmgKaW5k
ZXggNmIxNjQ1NTk4ZmEzLi5hYTEyMzVhNzhjZWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfcHNwLmgKQEAgLTM4Nyw2ICszODcsNyBAQCBzdHJ1Y3QgcHNwX2NvbnRleHQKIAlz
dHJ1Y3QgcHNwX3JhcF9jb250ZXh0CQlyYXBfY29udGV4dDsKIAlzdHJ1Y3QgcHNwX3NlY3VyZWRp
c3BsYXlfY29udGV4dAlzZWN1cmVkaXNwbGF5X2NvbnRleHQ7CiAJc3RydWN0IG11dGV4CQkJbXV0
ZXg7CisJc3RydWN0IG11dGV4CQkJY21kX2J1Zl9tdXRleDsKIAlzdHJ1Y3QgcHNwX21lbW9yeV90
cmFpbmluZ19jb250ZXh0IG1lbV90cmFpbl9jdHg7CiAKIAl1aW50MzJfdAkJCWJvb3RfY2ZnX2Jp
dG1hc2s7Ci0tIAoyLjE3LjEKCg==

--_004_BN9PR12MB52265FFACD0557EC17C4FAE6FBF09BN9PR12MB5226namp_--
