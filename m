Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2FBAFFBB09
	for <lists+amd-gfx@lfdr.de>; Wed, 13 Nov 2019 22:45:47 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E6D656E09C;
	Wed, 13 Nov 2019 21:45:44 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM05-CO1-obe.outbound.protection.outlook.com
 (mail-eopbgr720084.outbound.protection.outlook.com [40.107.72.84])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 83A716E09C
 for <amd-gfx@lists.freedesktop.org>; Wed, 13 Nov 2019 21:45:43 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=I9DI+doKu5sPa+gr99gEiNlFcHQwwetfNJBxM9nypKJIa8fUZcLs4MZrrQp7tJtRUf+rvVl0Ky03Gs+s0DTRmK6cTVk90NxuPP1xkY75uMMDPzn3a44z9pvS8vG2jZZeGbLL20aDoPj5BzJtuTHkpYUCSpbTShDd4tdykq4K+GZxl2ImPGsWdm264T0Xt6M9u1jqKXz4fNSQ719ivS/XiqsMvqDOcSmoVkroBgdnVMG5PX/LOuOhmODVM8DOsV0FavzBqR7jzp1r9K7Fbwtw26e7cgW27/I2EWm83Uha7DJcIIQm48E+QHCekTxXAGSG8mWGJcLYo62ypwq53FvDLw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=bSf/nQyyUMMEvOS9wu4UmSTnGHHiu94KxfAob+uxwHU=;
 b=RqAyK+xL3+nvxofL97l/6sFhbRwmnPS+e0XeeAr5L0ANFIffcaw8dP2gDAamnn5uOHsPOCRsJEbx703l+L4hMVIhLEynbAQbr9f3TZvj2M9BKThP5s2hMP2hpSZqbzWwqEtcYB2h8oVVgcSsr3nMpnahiXAYizds60t1OgSIpcIO2d9Xk7k1IJgswKb88NnDYjFZyy90tAQlpiVNNStWK2kPF5glBq0tbO2r1pO7Ryr3UI7siAa+kFXJsykH8byjlG6wWPDz28WpW2pQmFPpdq0UCdIflSRgkU1ZFdskx6gxIJmUVSFagqc1XrpX9of+tPUAP4IL+7zBRI0uK2nesA==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
Received: from DM6PR12MB2778.namprd12.prod.outlook.com (20.176.114.145) by
 DM6PR12MB3883.namprd12.prod.outlook.com (10.255.174.12) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2430.24; Wed, 13 Nov 2019 21:45:42 +0000
Received: from DM6PR12MB2778.namprd12.prod.outlook.com
 ([fe80::304d:db58:2aa:d69e]) by DM6PR12MB2778.namprd12.prod.outlook.com
 ([fe80::304d:db58:2aa:d69e%6]) with mapi id 15.20.2430.027; Wed, 13 Nov 2019
 21:45:42 +0000
From: Yong Zhao <Yong.Zhao@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH] drm/amdkfd: Eliminate unnecessary kernel queue function
 pointers
Date: Wed, 13 Nov 2019 16:45:30 -0500
Message-Id: <20191113214530.10934-1-Yong.Zhao@amd.com>
X-Mailer: git-send-email 2.17.1
X-ClientProxiedBy: YTBPR01CA0012.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b01:14::25) To DM6PR12MB2778.namprd12.prod.outlook.com
 (2603:10b6:5:50::17)
MIME-Version: 1.0
X-Mailer: git-send-email 2.17.1
X-Originating-IP: [165.204.55.251]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-HT: Tenant
X-MS-Office365-Filtering-Correlation-Id: 561a9df7-18a3-4719-51e3-08d76882d493
X-MS-TrafficTypeDiagnostic: DM6PR12MB3883:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <DM6PR12MB38835BD312D9A22AE088D511F0760@DM6PR12MB3883.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:8882;
X-Forefront-PRVS: 0220D4B98D
X-Forefront-Antispam-Report: SFV:NSPM;
 SFS:(10009020)(4636009)(39860400002)(366004)(376002)(346002)(396003)(136003)(199004)(189003)(30864003)(5660300002)(81166006)(16586007)(81156014)(6436002)(8676002)(316002)(6512007)(2361001)(47776003)(186003)(50226002)(2351001)(14444005)(8936002)(1076003)(14454004)(25786009)(4326008)(478600001)(99286004)(66066001)(6486002)(66476007)(66556008)(2616005)(6916009)(66946007)(486006)(86362001)(476003)(2906002)(50466002)(3846002)(6116002)(305945005)(6666004)(26005)(48376002)(52116002)(7736002)(51416003)(386003)(36756003)(6506007);
 DIR:OUT; SFP:1101; SCL:1; SRVR:DM6PR12MB3883;
 H:DM6PR12MB2778.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: YI0sXIOl/2Drf/GiSC76fPy6sL2Ez3nu9fOtAqJnDqH1mYmERwl8DvkEPY2V4s6LHjf3G/1KC/gnRZtbGWRHj8AyhQnS7lCm7VnQTcheBQTs6zb8PE1SgreoUhZeKFUqTkrvDmjWEXSlgfEOHiemP/+eG5Hl7FPmOXChASNo1TI7VjnqAVS70WgsiHHwhf9W7IhXioGQFV5EPdqTuo73l7lWAO7AKf68Mv9Wjtw3NJPwp29SMB5t/s8ODcsCHHI/0gZ0w18fWlaIH+ifvwyeLJbl91ZzEWTppp4Dt3c9UaQGBNbprgRHIatKDnBjm7+07bM1UaZiSPSp6fg3jV/HfUB0jM3oUehEoMaS0iwrId1LeNmHfhEEVO0i6MNrxfDJ2zaX40n1eFBDvp2fBN+vHKUhEzyD6qb3TNK9pNy4q2tYhYJ3yd1WG/SYdBq0q6fz
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 561a9df7-18a3-4719-51e3-08d76882d493
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 13 Nov 2019 21:45:42.1014 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: udF7x1wC4eGoYN84DxQEtaS5uGsvzWZ2qzmLwpY+oWUONIZoxxOHllKcR1xx6cMW
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM6PR12MB3883
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=bSf/nQyyUMMEvOS9wu4UmSTnGHHiu94KxfAob+uxwHU=;
 b=AoQODFYUGor7B+Pc/zLxui4NaZdWBnYE77jo8BOVVDIdvy1vnD4+B//2YxVElxc5FbS1SBrdcHZmiRVAH6oeRurcfgiyKoRg8Ni+o0Htk/sCct1rL90MbuUm6E/fiTeK6bWCAWE6+zrWz6Z/GWU+SkzXL7OWmE8jUoYBIRd64Ak=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Yong.Zhao@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Yong Zhao <Yong.Zhao@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VXAgdG8gdGhpcyBwb2ludCwgdGhvc2UgZnVuY3Rpb25zIGFyZSBhbGwgdGhlIHNhbWUgZm9yIGFs
bCBBU0lDcywgc28Kbm8gbmVlZCB0byBjYWxsIHRoZW0gYnkgZnVuY3Rpb25zIHBvaW50ZXJzLiBS
ZW1vdmluZyB0aGUgZnVuY3Rpb24KcG9pbnRlcnMgd2lsbCBncmVhdGx5IGluY3JlYXNlIHRoZSBj
b2RlIHJlYWRhYmxpdHkuIElmIHRoZXJlIGlzIGV2ZXIKbmVlZCBmb3IgdGhvc2UgZnVuY3Rpb24g
cG9pbnRlcnMsIHdlIGNhbiBhZGQgaXQgYmFjayB0aGVuLgoKQ2hhbmdlLUlkOiBJOTUxNWZkZWNl
NzAxMTAwNjdjZGE2NmUyZDI0ZDY3NjhiNDg0NmMyZgpTaWduZWQtb2ZmLWJ5OiBZb25nIFpoYW8g
PFlvbmcuWmhhb0BhbWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9k
YmdkZXYuYyAgICAgICB8ICA4ICsrLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRf
a2VybmVsX3F1ZXVlLmMgfCAzMCArKysrKysrKy0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGtmZC9rZmRfa2VybmVsX3F1ZXVlLmggfCAzNCArKysrKy0tLS0tLS0tLS0tLS0tCiAuLi4v
Z3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wYWNrZXRfbWFuYWdlci5jICAgfCAyOCArKysrKysrLS0t
LS0tLS0KIDQgZmlsZXMgY2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygrKSwgNTkgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RiZ2Rldi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RiZ2Rldi5jCmluZGV4IDFkMzNjNGYyNTI2
My4uMjdiY2M1YjQ3MmY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9r
ZmRfZGJnZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RiZ2Rldi5j
CkBAIC03MiwxMSArNzIsMTEgQEAgc3RhdGljIGludCBkYmdkZXZfZGlxX3N1Ym1pdF9pYihzdHJ1
Y3Qga2ZkX2RiZ2RldiAqZGJnZGV2LAogCSAqIFRoZSByZWNlaXZlIHBhY2tldCBidWZmIHdpbGwg
YmUgc2l0dGluZyBvbiB0aGUgSW5kaXJlY3QgQnVmZmVyCiAJICogYW5kIGluIHRoZSBQUSB3ZSBw
dXQgdGhlIElCIHBhY2tldCArIHN5bmMgcGFja2V0KHMpLgogCSAqLwotCXN0YXR1cyA9IGtxLT5v
cHMuYWNxdWlyZV9wYWNrZXRfYnVmZmVyKGtxLAorCXN0YXR1cyA9IGtxX2FjcXVpcmVfcGFja2V0
X2J1ZmZlcihrcSwKIAkJCQlwcV9wYWNrZXRzX3NpemVfaW5fYnl0ZXMgLyBzaXplb2YodWludDMy
X3QpLAogCQkJCSZpYl9wYWNrZXRfYnVmZik7CiAJaWYgKHN0YXR1cykgewotCQlwcl9lcnIoImFj
cXVpcmVfcGFja2V0X2J1ZmZlciBmYWlsZWRcbiIpOworCQlwcl9lcnIoImtxX2FjcXVpcmVfcGFj
a2V0X2J1ZmZlciBmYWlsZWRcbiIpOwogCQlyZXR1cm4gc3RhdHVzOwogCX0KIApAQCAtMTE1LDcg
KzExNSw3IEBAIHN0YXRpYyBpbnQgZGJnZGV2X2RpcV9zdWJtaXRfaWIoc3RydWN0IGtmZF9kYmdk
ZXYgKmRiZ2RldiwKIAogCWlmIChzdGF0dXMpIHsKIAkJcHJfZXJyKCJGYWlsZWQgdG8gYWxsb2Nh
dGUgR0FSVCBtZW1vcnlcbiIpOwotCQlrcS0+b3BzLnJvbGxiYWNrX3BhY2tldChrcSk7CisJCWtx
X3JvbGxiYWNrX3BhY2tldChrcSk7CiAJCXJldHVybiBzdGF0dXM7CiAJfQogCkBAIC0xNTEsNyAr
MTUxLDcgQEAgc3RhdGljIGludCBkYmdkZXZfZGlxX3N1Ym1pdF9pYihzdHJ1Y3Qga2ZkX2RiZ2Rl
diAqZGJnZGV2LAogCiAJcm1fcGFja2V0LT5kYXRhX2xvID0gUVVFVUVTVEFURV9fQUNUSVZFOwog
Ci0Ja3EtPm9wcy5zdWJtaXRfcGFja2V0KGtxKTsKKwlrcV9zdWJtaXRfcGFja2V0KGtxKTsKIAog
CS8qIFdhaXQgdGlsbCBDUCB3cml0ZXMgc3luYyBjb2RlOiAqLwogCXN0YXR1cyA9IGFtZGtmZF9m
ZW5jZV93YWl0X3RpbWVvdXQoCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtm
ZC9rZmRfa2VybmVsX3F1ZXVlLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfa2Vy
bmVsX3F1ZXVlLmMKaW5kZXggNTllZTkwNTM0OThjLi4yZDU2ZGM1MzQ0NTkgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9rZXJuZWxfcXVldWUuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfa2VybmVsX3F1ZXVlLmMKQEAgLTM0LDcgKzM0LDEw
IEBACiAKICNkZWZpbmUgUE00X0NPVU5UX1pFUk8gKCgoMSA8PCAxNSkgLSAxKSA8PCAxNikKIAot
c3RhdGljIGJvb2wgaW5pdGlhbGl6ZShzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSwgc3RydWN0IGtm
ZF9kZXYgKmRldiwKKy8qIEluaXRpYWxpemUgYSBrZXJuZWwgcXVldWUsIGluY2x1ZGluZyBhbGxv
Y2F0aW9ucyBvZiBHQVJUIG1lbW9yeQorICogbmVlZGVkIGZvciB0aGUgcXVldWUuCisgKi8KK3N0
YXRpYyBib29sIGtxX2luaXRpYWxpemUoc3RydWN0IGtlcm5lbF9xdWV1ZSAqa3EsIHN0cnVjdCBr
ZmRfZGV2ICpkZXYsCiAJCWVudW0ga2ZkX3F1ZXVlX3R5cGUgdHlwZSwgdW5zaWduZWQgaW50IHF1
ZXVlX3NpemUpCiB7CiAJc3RydWN0IHF1ZXVlX3Byb3BlcnRpZXMgcHJvcDsKQEAgLTg4LDcgKzkx
LDcgQEAgc3RhdGljIGJvb2wgaW5pdGlhbGl6ZShzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSwgc3Ry
dWN0IGtmZF9kZXYgKmRldiwKIAlrcS0+cHFfZ3B1X2FkZHIgPSBrcS0+cHEtPmdwdV9hZGRyOwog
CiAJLyogRm9yIENJSyBmYW1pbHkgYXNpY3MsIGtxLT5lb3BfbWVtIGlzIG5vdCBuZWVkZWQgKi8K
LQlpZiAoZGV2LT5kZXZpY2VfaW5mby0+YXNpY19mYW1pbHkgPiBDSElQX0hBV0FJSSkgeworCWlm
IChkZXYtPmRldmljZV9pbmZvLT5hc2ljX2ZhbWlseSA+IENISVBfTVVMTElOUykgewogCQlyZXR2
YWwgPSBrZmRfZ3R0X3NhX2FsbG9jYXRlKGRldiwgUEFHRV9TSVpFLCAma3EtPmVvcF9tZW0pOwog
CQlpZiAocmV0dmFsICE9IDApCiAJCQlnb3RvIGVycl9lb3BfYWxsb2NhdGVfdmlkbWVtOwpAQCAt
MTkxLDcgKzE5NCw4IEBAIHN0YXRpYyBib29sIGluaXRpYWxpemUoc3RydWN0IGtlcm5lbF9xdWV1
ZSAqa3EsIHN0cnVjdCBrZmRfZGV2ICpkZXYsCiAKIH0KIAotc3RhdGljIHZvaWQgdW5pbml0aWFs
aXplKHN0cnVjdCBrZXJuZWxfcXVldWUgKmtxKQorLyogVW5pbml0aWFsaXplIGEga2VybmVsIHF1
ZXVlIGFuZCBmcmVlIGFsbCBpdHMgbWVtb3J5IHVzYWdlcy4gKi8KK3N0YXRpYyB2b2lkIGtxX3Vu
aW5pdGlhbGl6ZShzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSkKIHsKIAlpZiAoa3EtPnF1ZXVlLT5w
cm9wZXJ0aWVzLnR5cGUgPT0gS0ZEX1FVRVVFX1RZUEVfSElRKQogCQlrcS0+bXFkX21nci0+ZGVz
dHJveV9tcWQoa3EtPm1xZF9tZ3IsCkBAIC0yMjAsNyArMjI0LDcgQEAgc3RhdGljIHZvaWQgdW5p
bml0aWFsaXplKHN0cnVjdCBrZXJuZWxfcXVldWUgKmtxKQogCXVuaW5pdF9xdWV1ZShrcS0+cXVl
dWUpOwogfQogCi1zdGF0aWMgaW50IGFjcXVpcmVfcGFja2V0X2J1ZmZlcihzdHJ1Y3Qga2VybmVs
X3F1ZXVlICprcSwKK2ludCBrcV9hY3F1aXJlX3BhY2tldF9idWZmZXIoc3RydWN0IGtlcm5lbF9x
dWV1ZSAqa3EsCiAJCXNpemVfdCBwYWNrZXRfc2l6ZV9pbl9kd29yZHMsIHVuc2lnbmVkIGludCAq
KmJ1ZmZlcl9wdHIpCiB7CiAJc2l6ZV90IGF2YWlsYWJsZV9zaXplOwpAQCAtMjgxLDcgKzI4NSw3
IEBAIHN0YXRpYyBpbnQgYWNxdWlyZV9wYWNrZXRfYnVmZmVyKHN0cnVjdCBrZXJuZWxfcXVldWUg
KmtxLAogCXJldHVybiAtRU5PTUVNOwogfQogCi1zdGF0aWMgdm9pZCBzdWJtaXRfcGFja2V0KHN0
cnVjdCBrZXJuZWxfcXVldWUgKmtxKQordm9pZCBrcV9zdWJtaXRfcGFja2V0KHN0cnVjdCBrZXJu
ZWxfcXVldWUgKmtxKQogewogI2lmZGVmIERFQlVHCiAJaW50IGk7CkBAIC0zMDQsNyArMzA4LDcg
QEAgc3RhdGljIHZvaWQgc3VibWl0X3BhY2tldChzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSkKIAl9
CiB9CiAKLXN0YXRpYyB2b2lkIHJvbGxiYWNrX3BhY2tldChzdHJ1Y3Qga2VybmVsX3F1ZXVlICpr
cSkKK3ZvaWQga3Ffcm9sbGJhY2tfcGFja2V0KHN0cnVjdCBrZXJuZWxfcXVldWUgKmtxKQogewog
CWlmIChrcS0+ZGV2LT5kZXZpY2VfaW5mby0+ZG9vcmJlbGxfc2l6ZSA9PSA4KSB7CiAJCWtxLT5w
ZW5kaW5nX3dwdHI2NCA9ICprcS0+d3B0cjY0X2tlcm5lbDsKQEAgLTMyNCwxMyArMzI4LDcgQEAg
c3RydWN0IGtlcm5lbF9xdWV1ZSAqa2VybmVsX3F1ZXVlX2luaXQoc3RydWN0IGtmZF9kZXYgKmRl
diwKIAlpZiAoIWtxKQogCQlyZXR1cm4gTlVMTDsKIAotCWtxLT5vcHMuaW5pdGlhbGl6ZSA9IGlu
aXRpYWxpemU7Ci0Ja3EtPm9wcy51bmluaXRpYWxpemUgPSB1bmluaXRpYWxpemU7Ci0Ja3EtPm9w
cy5hY3F1aXJlX3BhY2tldF9idWZmZXIgPSBhY3F1aXJlX3BhY2tldF9idWZmZXI7Ci0Ja3EtPm9w
cy5zdWJtaXRfcGFja2V0ID0gc3VibWl0X3BhY2tldDsKLQlrcS0+b3BzLnJvbGxiYWNrX3BhY2tl
dCA9IHJvbGxiYWNrX3BhY2tldDsKLQotCWlmIChrcS0+b3BzLmluaXRpYWxpemUoa3EsIGRldiwg
dHlwZSwgS0ZEX0tFUk5FTF9RVUVVRV9TSVpFKSkKKwlpZiAoa3FfaW5pdGlhbGl6ZShrcSwgZGV2
LCB0eXBlLCBLRkRfS0VSTkVMX1FVRVVFX1NJWkUpKQogCQlyZXR1cm4ga3E7CiAKIAlwcl9lcnIo
IkZhaWxlZCB0byBpbml0IGtlcm5lbCBxdWV1ZVxuIik7CkBAIC0zNDEsNyArMzM5LDcgQEAgc3Ry
dWN0IGtlcm5lbF9xdWV1ZSAqa2VybmVsX3F1ZXVlX2luaXQoc3RydWN0IGtmZF9kZXYgKmRldiwK
IAogdm9pZCBrZXJuZWxfcXVldWVfdW5pbml0KHN0cnVjdCBrZXJuZWxfcXVldWUgKmtxKQogewot
CWtxLT5vcHMudW5pbml0aWFsaXplKGtxKTsKKwlrcV91bmluaXRpYWxpemUoa3EpOwogCWtmcmVl
KGtxKTsKIH0KIApAQCAtMzYxLDcgKzM1OSw3IEBAIHN0YXRpYyBfX2F0dHJpYnV0ZV9fKCh1bnVz
ZWQpKSB2b2lkIHRlc3Rfa3Eoc3RydWN0IGtmZF9kZXYgKmRldikKIAkJcmV0dXJuOwogCX0KIAot
CXJldHZhbCA9IGtxLT5vcHMuYWNxdWlyZV9wYWNrZXRfYnVmZmVyKGtxLCA1LCAmYnVmZmVyKTsK
KwlyZXR2YWwgPSBrcV9hY3F1aXJlX3BhY2tldF9idWZmZXIoa3EsIDUsICZidWZmZXIpOwogCWlm
ICh1bmxpa2VseShyZXR2YWwgIT0gMCkpIHsKIAkJcHJfZXJyKCIgIEZhaWxlZCB0byBhY3F1aXJl
IHBhY2tldCBidWZmZXJcbiIpOwogCQlwcl9lcnIoIktlcm5lbCBxdWV1ZSB0ZXN0IGZhaWxlZFxu
Iik7CkBAIC0zNjksNyArMzY3LDcgQEAgc3RhdGljIF9fYXR0cmlidXRlX18oKHVudXNlZCkpIHZv
aWQgdGVzdF9rcShzdHJ1Y3Qga2ZkX2RldiAqZGV2KQogCX0KIAlmb3IgKGkgPSAwOyBpIDwgNTsg
aSsrKQogCQlidWZmZXJbaV0gPSBrcS0+bm9wX3BhY2tldDsKLQlrcS0+b3BzLnN1Ym1pdF9wYWNr
ZXQoa3EpOworCWtxX3N1Ym1pdF9wYWNrZXQoa3EpOwogCiAJcHJfZXJyKCJFbmRpbmcga2VybmVs
IHF1ZXVlIHRlc3RcbiIpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRr
ZmQva2ZkX2tlcm5lbF9xdWV1ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2tl
cm5lbF9xdWV1ZS5oCmluZGV4IDQ3NWU5NDk5YzBhZi4uZjRjZmU5ZjE4NzFjIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfa2VybmVsX3F1ZXVlLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2tlcm5lbF9xdWV1ZS5oCkBAIC0yOSw0NCArMjks
MjggQEAKICNpbmNsdWRlICJrZmRfcHJpdi5oIgogCiAvKioKLSAqIHN0cnVjdCBrZXJuZWxfcXVl
dWVfb3BzCi0gKgotICogQGluaXRpYWxpemU6IEluaXRpYWxpemUgYSBrZXJuZWwgcXVldWUsIGlu
Y2x1ZGluZyBhbGxvY2F0aW9ucyBvZiBHQVJUIG1lbW9yeQotICogbmVlZGVkIGZvciB0aGUgcXVl
dWUuCi0gKgotICogQHVuaW5pdGlhbGl6ZTogVW5pbml0aWFsaXplIGEga2VybmVsIHF1ZXVlIGFu
ZCBmcmVlIGFsbCBpdHMgbWVtb3J5IHVzYWdlcy4KLSAqCi0gKiBAYWNxdWlyZV9wYWNrZXRfYnVm
ZmVyOiBSZXR1cm5zIGEgcG9pbnRlciB0byB0aGUgbG9jYXRpb24gaW4gdGhlIGtlcm5lbAorICog
a3FfYWNxdWlyZV9wYWNrZXRfYnVmZmVyOiBSZXR1cm5zIGEgcG9pbnRlciB0byB0aGUgbG9jYXRp
b24gaW4gdGhlIGtlcm5lbAogICogcXVldWUgcmluZyBidWZmZXIgd2hlcmUgdGhlIGNhbGxpbmcg
ZnVuY3Rpb24gY2FuIHdyaXRlIGl0cyBwYWNrZXQuIEl0IGlzCiAgKiBHdWFyYW50ZWVkIHRoYXQg
dGhlcmUgaXMgZW5vdWdoIHNwYWNlIGZvciB0aGF0IHBhY2tldC4gSXQgYWxzbyB1cGRhdGVzIHRo
ZQogICogcGVuZGluZyB3cml0ZSBwb2ludGVyIHRvIHRoYXQgbG9jYXRpb24gc28gc3Vic2VxdWVu
dCBjYWxscyB0bwogICogYWNxdWlyZV9wYWNrZXRfYnVmZmVyIHdpbGwgZ2V0IGEgY29ycmVjdCB3
cml0ZSBwb2ludGVyCiAgKgotICogQHN1Ym1pdF9wYWNrZXQ6IFVwZGF0ZSB0aGUgd3JpdGUgcG9p
bnRlciBhbmQgZG9vcmJlbGwgb2YgYSBrZXJuZWwgcXVldWUuCi0gKgotICogQHN5bmNfd2l0aF9o
dzogV2FpdCB1bnRpbCB0aGUgd3JpdGUgcG9pbnRlciBhbmQgdGhlIHJlYWQgcG9pbnRlciBvZiBh
IGtlcm5lbAotICogcXVldWUgYXJlIGVxdWFsLCB3aGljaCBtZWFucyB0aGUgQ1AgaGFzIHJlYWQg
YWxsIHRoZSBzdWJtaXR0ZWQgcGFja2V0cy4KKyAqIGtxX3N1Ym1pdF9wYWNrZXQ6IFVwZGF0ZSB0
aGUgd3JpdGUgcG9pbnRlciBhbmQgZG9vcmJlbGwgb2YgYSBrZXJuZWwgcXVldWUuCiAgKgotICog
QHJvbGxiYWNrX3BhY2tldDogVGhpcyByb3V0aW5lIGlzIGNhbGxlZCBpZiB3ZSBmYWlsZWQgdG8g
YnVpbGQgYW4gYWNxdWlyZWQKKyAqIGtxX3JvbGxiYWNrX3BhY2tldDogVGhpcyByb3V0aW5lIGlz
IGNhbGxlZCBpZiB3ZSBmYWlsZWQgdG8gYnVpbGQgYW4gYWNxdWlyZWQKICAqIHBhY2tldCBmb3Ig
c29tZSByZWFzb24uIEl0IGp1c3Qgb3ZlcndyaXRlcyB0aGUgcGVuZGluZyB3cHRyIHdpdGggdGhl
IGN1cnJlbnQKICAqIG9uZQogICoKICAqLwotc3RydWN0IGtlcm5lbF9xdWV1ZV9vcHMgewotCWJv
b2wJKCppbml0aWFsaXplKShzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSwgc3RydWN0IGtmZF9kZXYg
KmRldiwKLQkJCWVudW0ga2ZkX3F1ZXVlX3R5cGUgdHlwZSwgdW5zaWduZWQgaW50IHF1ZXVlX3Np
emUpOwotCXZvaWQJKCp1bmluaXRpYWxpemUpKHN0cnVjdCBrZXJuZWxfcXVldWUgKmtxKTsKLQlp
bnQJKCphY3F1aXJlX3BhY2tldF9idWZmZXIpKHN0cnVjdCBrZXJuZWxfcXVldWUgKmtxLAotCQkJ
CQlzaXplX3QgcGFja2V0X3NpemVfaW5fZHdvcmRzLAotCQkJCQl1bnNpZ25lZCBpbnQgKipidWZm
ZXJfcHRyKTsKIAotCXZvaWQJKCpzdWJtaXRfcGFja2V0KShzdHJ1Y3Qga2VybmVsX3F1ZXVlICpr
cSk7Ci0Jdm9pZAkoKnJvbGxiYWNrX3BhY2tldCkoc3RydWN0IGtlcm5lbF9xdWV1ZSAqa3EpOwot
fTsKK2ludCBrcV9hY3F1aXJlX3BhY2tldF9idWZmZXIoc3RydWN0IGtlcm5lbF9xdWV1ZSAqa3Es
CisJCQkJc2l6ZV90IHBhY2tldF9zaXplX2luX2R3b3JkcywKKwkJCQl1bnNpZ25lZCBpbnQgKipi
dWZmZXJfcHRyKTsKK3ZvaWQga3Ffc3VibWl0X3BhY2tldChzdHJ1Y3Qga2VybmVsX3F1ZXVlICpr
cSk7Cit2b2lkIGtxX3JvbGxiYWNrX3BhY2tldChzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSk7CiAK
LXN0cnVjdCBrZXJuZWxfcXVldWUgewotCXN0cnVjdCBrZXJuZWxfcXVldWVfb3BzIG9wczsKIAor
c3RydWN0IGtlcm5lbF9xdWV1ZSB7CiAJLyogZGF0YSAqLwogCXN0cnVjdCBrZmRfZGV2CQkqZGV2
OwogCXN0cnVjdCBtcWRfbWFuYWdlcgkqbXFkX21ncjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1ka2ZkL2tmZF9wYWNrZXRfbWFuYWdlci5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRrZmQva2ZkX3BhY2tldF9tYW5hZ2VyLmMKaW5kZXggNzAwYmU0ZjgwODY3Li42Y2FiZWQw
NmVmNWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wYWNrZXRf
bWFuYWdlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wYWNrZXRfbWFu
YWdlci5jCkBAIC0yNzgsNyArMjc4LDcgQEAgaW50IHBtX3NlbmRfc2V0X3Jlc291cmNlcyhzdHJ1
Y3QgcGFja2V0X21hbmFnZXIgKnBtLAogCiAJc2l6ZSA9IHBtLT5wbWYtPnNldF9yZXNvdXJjZXNf
c2l6ZTsKIAltdXRleF9sb2NrKCZwbS0+bG9jayk7Ci0JcG0tPnByaXZfcXVldWUtPm9wcy5hY3F1
aXJlX3BhY2tldF9idWZmZXIocG0tPnByaXZfcXVldWUsCisJa3FfYWNxdWlyZV9wYWNrZXRfYnVm
ZmVyKHBtLT5wcml2X3F1ZXVlLAogCQkJCQlzaXplIC8gc2l6ZW9mKHVpbnQzMl90KSwKIAkJCQkJ
KHVuc2lnbmVkIGludCAqKikmYnVmZmVyKTsKIAlpZiAoIWJ1ZmZlcikgewpAQCAtMjg5LDkgKzI4
OSw5IEBAIGludCBwbV9zZW5kX3NldF9yZXNvdXJjZXMoc3RydWN0IHBhY2tldF9tYW5hZ2VyICpw
bSwKIAogCXJldHZhbCA9IHBtLT5wbWYtPnNldF9yZXNvdXJjZXMocG0sIGJ1ZmZlciwgcmVzKTsK
IAlpZiAoIXJldHZhbCkKLQkJcG0tPnByaXZfcXVldWUtPm9wcy5zdWJtaXRfcGFja2V0KHBtLT5w
cml2X3F1ZXVlKTsKKwkJa3Ffc3VibWl0X3BhY2tldChwbS0+cHJpdl9xdWV1ZSk7CiAJZWxzZQot
CQlwbS0+cHJpdl9xdWV1ZS0+b3BzLnJvbGxiYWNrX3BhY2tldChwbS0+cHJpdl9xdWV1ZSk7CisJ
CWtxX3JvbGxiYWNrX3BhY2tldChwbS0+cHJpdl9xdWV1ZSk7CiAKIG91dDoKIAltdXRleF91bmxv
Y2soJnBtLT5sb2NrKTsKQEAgLTMxNiw3ICszMTYsNyBAQCBpbnQgcG1fc2VuZF9ydW5saXN0KHN0
cnVjdCBwYWNrZXRfbWFuYWdlciAqcG0sIHN0cnVjdCBsaXN0X2hlYWQgKmRxbV9xdWV1ZXMpCiAJ
cGFja2V0X3NpemVfZHdvcmRzID0gcG0tPnBtZi0+cnVubGlzdF9zaXplIC8gc2l6ZW9mKHVpbnQz
Ml90KTsKIAltdXRleF9sb2NrKCZwbS0+bG9jayk7CiAKLQlyZXR2YWwgPSBwbS0+cHJpdl9xdWV1
ZS0+b3BzLmFjcXVpcmVfcGFja2V0X2J1ZmZlcihwbS0+cHJpdl9xdWV1ZSwKKwlyZXR2YWwgPSBr
cV9hY3F1aXJlX3BhY2tldF9idWZmZXIocG0tPnByaXZfcXVldWUsCiAJCQkJCXBhY2tldF9zaXpl
X2R3b3JkcywgJnJsX2J1ZmZlcik7CiAJaWYgKHJldHZhbCkKIAkJZ290byBmYWlsX2FjcXVpcmVf
cGFja2V0X2J1ZmZlcjsKQEAgLTMyNiwxNCArMzI2LDE0IEBAIGludCBwbV9zZW5kX3J1bmxpc3Qo
c3RydWN0IHBhY2tldF9tYW5hZ2VyICpwbSwgc3RydWN0IGxpc3RfaGVhZCAqZHFtX3F1ZXVlcykK
IAlpZiAocmV0dmFsKQogCQlnb3RvIGZhaWxfY3JlYXRlX3J1bmxpc3Q7CiAKLQlwbS0+cHJpdl9x
dWV1ZS0+b3BzLnN1Ym1pdF9wYWNrZXQocG0tPnByaXZfcXVldWUpOworCWtxX3N1Ym1pdF9wYWNr
ZXQocG0tPnByaXZfcXVldWUpOwogCiAJbXV0ZXhfdW5sb2NrKCZwbS0+bG9jayk7CiAKIAlyZXR1
cm4gcmV0dmFsOwogCiBmYWlsX2NyZWF0ZV9ydW5saXN0OgotCXBtLT5wcml2X3F1ZXVlLT5vcHMu
cm9sbGJhY2tfcGFja2V0KHBtLT5wcml2X3F1ZXVlKTsKKwlrcV9yb2xsYmFja19wYWNrZXQocG0t
PnByaXZfcXVldWUpOwogZmFpbF9hY3F1aXJlX3BhY2tldF9idWZmZXI6CiAJbXV0ZXhfdW5sb2Nr
KCZwbS0+bG9jayk7CiBmYWlsX2NyZWF0ZV9ydW5saXN0X2liOgpAQCAtMzUyLDcgKzM1Miw3IEBA
IGludCBwbV9zZW5kX3F1ZXJ5X3N0YXR1cyhzdHJ1Y3QgcGFja2V0X21hbmFnZXIgKnBtLCB1aW50
NjRfdCBmZW5jZV9hZGRyZXNzLAogCiAJc2l6ZSA9IHBtLT5wbWYtPnF1ZXJ5X3N0YXR1c19zaXpl
OwogCW11dGV4X2xvY2soJnBtLT5sb2NrKTsKLQlwbS0+cHJpdl9xdWV1ZS0+b3BzLmFjcXVpcmVf
cGFja2V0X2J1ZmZlcihwbS0+cHJpdl9xdWV1ZSwKKwlrcV9hY3F1aXJlX3BhY2tldF9idWZmZXIo
cG0tPnByaXZfcXVldWUsCiAJCQlzaXplIC8gc2l6ZW9mKHVpbnQzMl90KSwgKHVuc2lnbmVkIGlu
dCAqKikmYnVmZmVyKTsKIAlpZiAoIWJ1ZmZlcikgewogCQlwcl9lcnIoIkZhaWxlZCB0byBhbGxv
Y2F0ZSBidWZmZXIgb24ga2VybmVsIHF1ZXVlXG4iKTsKQEAgLTM2Miw5ICszNjIsOSBAQCBpbnQg
cG1fc2VuZF9xdWVyeV9zdGF0dXMoc3RydWN0IHBhY2tldF9tYW5hZ2VyICpwbSwgdWludDY0X3Qg
ZmVuY2VfYWRkcmVzcywKIAogCXJldHZhbCA9IHBtLT5wbWYtPnF1ZXJ5X3N0YXR1cyhwbSwgYnVm
ZmVyLCBmZW5jZV9hZGRyZXNzLCBmZW5jZV92YWx1ZSk7CiAJaWYgKCFyZXR2YWwpCi0JCXBtLT5w
cml2X3F1ZXVlLT5vcHMuc3VibWl0X3BhY2tldChwbS0+cHJpdl9xdWV1ZSk7CisJCWtxX3N1Ym1p
dF9wYWNrZXQocG0tPnByaXZfcXVldWUpOwogCWVsc2UKLQkJcG0tPnByaXZfcXVldWUtPm9wcy5y
b2xsYmFja19wYWNrZXQocG0tPnByaXZfcXVldWUpOworCQlrcV9yb2xsYmFja19wYWNrZXQocG0t
PnByaXZfcXVldWUpOwogCiBvdXQ6CiAJbXV0ZXhfdW5sb2NrKCZwbS0+bG9jayk7CkBAIC0zODEs
NyArMzgxLDcgQEAgaW50IHBtX3NlbmRfdW5tYXBfcXVldWUoc3RydWN0IHBhY2tldF9tYW5hZ2Vy
ICpwbSwgZW51bSBrZmRfcXVldWVfdHlwZSB0eXBlLAogCiAJc2l6ZSA9IHBtLT5wbWYtPnVubWFw
X3F1ZXVlc19zaXplOwogCW11dGV4X2xvY2soJnBtLT5sb2NrKTsKLQlwbS0+cHJpdl9xdWV1ZS0+
b3BzLmFjcXVpcmVfcGFja2V0X2J1ZmZlcihwbS0+cHJpdl9xdWV1ZSwKKwlrcV9hY3F1aXJlX3Bh
Y2tldF9idWZmZXIocG0tPnByaXZfcXVldWUsCiAJCQlzaXplIC8gc2l6ZW9mKHVpbnQzMl90KSwg
KHVuc2lnbmVkIGludCAqKikmYnVmZmVyKTsKIAlpZiAoIWJ1ZmZlcikgewogCQlwcl9lcnIoIkZh
aWxlZCB0byBhbGxvY2F0ZSBidWZmZXIgb24ga2VybmVsIHF1ZXVlXG4iKTsKQEAgLTM5Miw5ICsz
OTIsOSBAQCBpbnQgcG1fc2VuZF91bm1hcF9xdWV1ZShzdHJ1Y3QgcGFja2V0X21hbmFnZXIgKnBt
LCBlbnVtIGtmZF9xdWV1ZV90eXBlIHR5cGUsCiAJcmV0dmFsID0gcG0tPnBtZi0+dW5tYXBfcXVl
dWVzKHBtLCBidWZmZXIsIHR5cGUsIGZpbHRlciwgZmlsdGVyX3BhcmFtLAogCQkJCSAgICAgICBy
ZXNldCwgc2RtYV9lbmdpbmUpOwogCWlmICghcmV0dmFsKQotCQlwbS0+cHJpdl9xdWV1ZS0+b3Bz
LnN1Ym1pdF9wYWNrZXQocG0tPnByaXZfcXVldWUpOworCQlrcV9zdWJtaXRfcGFja2V0KHBtLT5w
cml2X3F1ZXVlKTsKIAllbHNlCi0JCXBtLT5wcml2X3F1ZXVlLT5vcHMucm9sbGJhY2tfcGFja2V0
KHBtLT5wcml2X3F1ZXVlKTsKKwkJa3Ffcm9sbGJhY2tfcGFja2V0KHBtLT5wcml2X3F1ZXVlKTsK
IAogb3V0OgogCW11dGV4X3VubG9jaygmcG0tPmxvY2spOwpAQCAtNDM5LDcgKzQzOSw3IEBAIGlu
dCBwbV9kZWJ1Z2ZzX2hhbmdfaHdzKHN0cnVjdCBwYWNrZXRfbWFuYWdlciAqcG0pCiAKIAlzaXpl
ID0gcG0tPnBtZi0+cXVlcnlfc3RhdHVzX3NpemU7CiAJbXV0ZXhfbG9jaygmcG0tPmxvY2spOwot
CXBtLT5wcml2X3F1ZXVlLT5vcHMuYWNxdWlyZV9wYWNrZXRfYnVmZmVyKHBtLT5wcml2X3F1ZXVl
LAorCWtxX2FjcXVpcmVfcGFja2V0X2J1ZmZlcihwbS0+cHJpdl9xdWV1ZSwKIAkJCXNpemUgLyBz
aXplb2YodWludDMyX3QpLCAodW5zaWduZWQgaW50ICoqKSZidWZmZXIpOwogCWlmICghYnVmZmVy
KSB7CiAJCXByX2VycigiRmFpbGVkIHRvIGFsbG9jYXRlIGJ1ZmZlciBvbiBrZXJuZWwgcXVldWVc
biIpOwpAQCAtNDQ3LDcgKzQ0Nyw3IEBAIGludCBwbV9kZWJ1Z2ZzX2hhbmdfaHdzKHN0cnVjdCBw
YWNrZXRfbWFuYWdlciAqcG0pCiAJCWdvdG8gb3V0OwogCX0KIAltZW1zZXQoYnVmZmVyLCAweDU1
LCBzaXplKTsKLQlwbS0+cHJpdl9xdWV1ZS0+b3BzLnN1Ym1pdF9wYWNrZXQocG0tPnByaXZfcXVl
dWUpOworCWtxX3N1Ym1pdF9wYWNrZXQocG0tPnByaXZfcXVldWUpOwogCiAJcHJfaW5mbygiU3Vi
bWl0dGluZyAleCAleCAleCAleCAleCAleCAleCB0byBISVEgdG8gaGFuZyB0aGUgSFdTLiIsCiAJ
CWJ1ZmZlclswXSwgYnVmZmVyWzFdLCBidWZmZXJbMl0sIGJ1ZmZlclszXSwKLS0gCjIuMTcuMQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBt
YWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
