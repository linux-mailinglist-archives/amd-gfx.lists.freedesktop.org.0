Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 89E5F13144F
	for <lists+amd-gfx@lfdr.de>; Mon,  6 Jan 2020 16:03:44 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A4C946E479;
	Mon,  6 Jan 2020 15:03:42 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wm1-x344.google.com (mail-wm1-x344.google.com
 [IPv6:2a00:1450:4864:20::344])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 799D36E479
 for <amd-gfx@lists.freedesktop.org>; Mon,  6 Jan 2020 15:03:41 +0000 (UTC)
Received: by mail-wm1-x344.google.com with SMTP id b19so15236102wmj.4
 for <amd-gfx@lists.freedesktop.org>; Mon, 06 Jan 2020 07:03:41 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=KXYgZa9C/cVPmzpEWGdOG74LlOHyPa1tZg44BKw5Yn4=;
 b=psAEpPiYsARqb8WqfkUGd6xhXXkFcqXhAcBYLzhHq/JYnwceaxeeARMOLY1baSw7QX
 fjKoH0vFtDY4NGOJDzUFXPLYi3MekHPCeIecd1V1SCPRTcYrvsO3Ge32E7ab478xHmmX
 kFUKPKhcK/aPfBK5JVLEUpj38MEGpjT1FRAF0rb9MhNSCIHiZkBYra+engBWv1iNdHzI
 uXhEYv9nKi+WciNi5XkbtKyRU+kLscXHd1fc2PZ+WNBD2vSm8EMMSP+LSSqtYvAuG5Zv
 557Ie8QqHZ3V+74H/w8OuyqlAOrJou80gP09AtOUN1jB991TMNM6CdWHHdyB/AwRvoTS
 bkjw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=KXYgZa9C/cVPmzpEWGdOG74LlOHyPa1tZg44BKw5Yn4=;
 b=RBYqXYka29r0/T1wkr+UWZO4VBHq/l9P3t3YIdkjblf0Fsh3vLNj08mOYA5FV8haJI
 P/7H5u++kDKfypx93G/7AY4GBilzH6kpZy0dpSi++UHWyeQLJ1BB2mAjB6eoPSjhC45G
 hT4yETRsqOQPAoXMeO/RBFQ2t6C2QiPM3TTw1sZd7/HorpydIEl8odrZ6zcS5DhVfKwK
 aJ8Q3B+hpmhqGjhpNCHxqCXTH/he8GPDDNA5NiTFy64/H/vOgArxoyW2Zf8P/ClGzKte
 wWgPAUFPWS/W3Agy0BxidcGnOjlBRSW87qg7gblTZB0wuF3J6GD+N975SxUYPvCXuC81
 mSyA==
X-Gm-Message-State: APjAAAVuDGhxjQa2wAaR6tU1vRSppN6/0OzXh8GjvZVrN4tErtYBNqkU
 Vylyz2Qh7NhXXmqnP3b3HZA=
X-Google-Smtp-Source: APXvYqyHkZwXGGcgnQYHF651VjCTrzZT5fM5aG1DYdwRA0oh9tZWIWLP321CJJFzlU8Fe6gaA02f1Q==
X-Received: by 2002:a05:600c:28d:: with SMTP id
 13mr33447657wmk.52.1578323019803; 
 Mon, 06 Jan 2020 07:03:39 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:ece2:ff95:11ee:3e72])
 by smtp.gmail.com with ESMTPSA id b17sm70307444wrp.49.2020.01.06.07.03.38
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 06 Jan 2020 07:03:38 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: Alex.Sierra@amd.com, Philip.Yang@amd.com, Felix.Kuehling@amd.com,
 amd-gfx@lists.freedesktop.org
Subject: [PATCH 01/12] drm/amdgpu: explicitely sync to VM updates v2
Date: Mon,  6 Jan 2020 16:03:24 +0100
Message-Id: <20200106150335.1738-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200106150335.1738-1-christian.koenig@amd.com>
References: <20200106150335.1738-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

QWxsb3dzIHVzIHRvIHJlZHVjZSB0aGUgb3ZlcmhlYWQgd2hpbGUgc3luY2luZyB0byBmZW5jZXMg
YSBiaXQuCgp2MjogYWxzbyBkcm9wIGFkZXYgcGFyYW1ldGVyIGZyb20gdGhlIGZ1bmN0aW9ucwoK
U2lnbmVkLW9mZi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29t
PgpSZXZpZXdlZC1ieTogRmVsaXggS3VlaGxpbmcgPEZlbGl4Lkt1ZWhsaW5nQGFtZC5jb20+Ci0t
LQogLi4uL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMgIHwgIDggKyst
LQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgICAgICAgIHwgMTkgKysr
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2lkcy5jICAgICAgIHwg
MTMgKysrLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5jICAgICAg
IHwgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMgICAgICB8
IDM4ICsrKysrKysrKysrKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9zeW5jLmggICAgICB8ICA4ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV92bV9zZG1hLmMgICB8ICAyICstCiA3IGZpbGVzIGNoYW5nZWQsIDUxIGluc2VydGlvbnMoKyks
IDQwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9hbWRrZmRfZ3B1dm0uYwppbmRleCBiNmQxOTU4ZDUxNGYuLmQ4ZGI1ZWNkZjljMSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwpAQCAt
MzU4LDcgKzM1OCw3IEBAIHN0YXRpYyBpbnQgdm1fdXBkYXRlX3BkcyhzdHJ1Y3QgYW1kZ3B1X3Zt
ICp2bSwgc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CiAKLQlyZXR1cm4gYW1kZ3B1X3N5bmNfZmVuY2UoTlVMTCwgc3luYywgdm0tPmxhc3RfdXBkYXRl
LCBmYWxzZSk7CisJcmV0dXJuIGFtZGdwdV9zeW5jX2ZlbmNlKHN5bmMsIHZtLT5sYXN0X3VwZGF0
ZSwgZmFsc2UpOwogfQogCiBzdGF0aWMgdWludDY0X3QgZ2V0X3B0ZV9mbGFncyhzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwgc3RydWN0IGtnZF9tZW0gKm1lbSkKQEAgLTc1MSw3ICs3NTEsNyBA
QCBzdGF0aWMgaW50IHVubWFwX2JvX2Zyb21fZ3B1dm0oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsCiAKIAlhbWRncHVfdm1fY2xlYXJfZnJlZWQoYWRldiwgdm0sICZib192YS0+bGFzdF9wdF91
cGRhdGUpOwogCi0JYW1kZ3B1X3N5bmNfZmVuY2UoTlVMTCwgc3luYywgYm9fdmEtPmxhc3RfcHRf
dXBkYXRlLCBmYWxzZSk7CisJYW1kZ3B1X3N5bmNfZmVuY2Uoc3luYywgYm9fdmEtPmxhc3RfcHRf
dXBkYXRlLCBmYWxzZSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTc3MCw3ICs3NzAsNyBAQCBzdGF0
aWMgaW50IHVwZGF0ZV9ncHV2bV9wdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCXJl
dHVybiByZXQ7CiAJfQogCi0JcmV0dXJuIGFtZGdwdV9zeW5jX2ZlbmNlKE5VTEwsIHN5bmMsIGJv
X3ZhLT5sYXN0X3B0X3VwZGF0ZSwgZmFsc2UpOworCXJldHVybiBhbWRncHVfc3luY19mZW5jZShz
eW5jLCBib192YS0+bGFzdF9wdF91cGRhdGUsIGZhbHNlKTsKIH0KIAogc3RhdGljIGludCBtYXBf
Ym9fdG9fZ3B1dm0oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCkBAIC0yMDQ1LDcgKzIwNDUs
NyBAQCBpbnQgYW1kZ3B1X2FtZGtmZF9ncHV2bV9yZXN0b3JlX3Byb2Nlc3NfYm9zKHZvaWQgKmlu
Zm8sIHN0cnVjdCBkbWFfZmVuY2UgKiplZikKIAkJCXByX2RlYnVnKCJNZW1vcnkgZXZpY3Rpb246
IFZhbGlkYXRlIEJPcyBmYWlsZWQuIFRyeSBhZ2FpblxuIik7CiAJCQlnb3RvIHZhbGlkYXRlX21h
cF9mYWlsOwogCQl9Ci0JCXJldCA9IGFtZGdwdV9zeW5jX2ZlbmNlKE5VTEwsICZzeW5jX29iaiwg
Ym8tPnRiby5tb3ZpbmcsIGZhbHNlKTsKKwkJcmV0ID0gYW1kZ3B1X3N5bmNfZmVuY2UoJnN5bmNf
b2JqLCBiby0+dGJvLm1vdmluZywgZmFsc2UpOwogCQlpZiAocmV0KSB7CiAJCQlwcl9kZWJ1Zygi
TWVtb3J5IGV2aWN0aW9uOiBTeW5jIEJPIGZlbmNlIGZhaWxlZC4gVHJ5IGFnYWluXG4iKTsKIAkJ
CWdvdG8gdmFsaWRhdGVfbWFwX2ZhaWw7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9j
cy5jCmluZGV4IDllMGM5OTc2MDM2Ny4uNjE0OTE5ZjI2NWI5IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfY3MuYwpAQCAtNzk5LDI5ICs3OTksMjMgQEAgc3RhdGljIGludCBhbWRn
cHVfY3Nfdm1faGFuZGxpbmcoc3RydWN0IGFtZGdwdV9jc19wYXJzZXIgKnApCiAJaWYgKHIpCiAJ
CXJldHVybiByOwogCi0JciA9IGFtZGdwdV9zeW5jX2ZlbmNlKGFkZXYsICZwLT5qb2ItPnN5bmMs
Ci0JCQkgICAgICBmcHJpdi0+cHJ0X3ZhLT5sYXN0X3B0X3VwZGF0ZSwgZmFsc2UpOworCXIgPSBh
bWRncHVfc3luY192bV9mZW5jZSgmcC0+am9iLT5zeW5jLCBmcHJpdi0+cHJ0X3ZhLT5sYXN0X3B0
X3VwZGF0ZSk7CiAJaWYgKHIpCiAJCXJldHVybiByOwogCiAJaWYgKGFtZGdwdV9tY2JwIHx8IGFt
ZGdwdV9zcmlvdl92ZihhZGV2KSkgewotCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmOwotCiAJCWJvX3Zh
ID0gZnByaXYtPmNzYV92YTsKIAkJQlVHX09OKCFib192YSk7CiAJCXIgPSBhbWRncHVfdm1fYm9f
dXBkYXRlKGFkZXYsIGJvX3ZhLCBmYWxzZSk7CiAJCWlmIChyKQogCQkJcmV0dXJuIHI7CiAKLQkJ
ZiA9IGJvX3ZhLT5sYXN0X3B0X3VwZGF0ZTsKLQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKGFkZXYs
ICZwLT5qb2ItPnN5bmMsIGYsIGZhbHNlKTsKKwkJciA9IGFtZGdwdV9zeW5jX3ZtX2ZlbmNlKCZw
LT5qb2ItPnN5bmMsIGJvX3ZhLT5sYXN0X3B0X3VwZGF0ZSk7CiAJCWlmIChyKQogCQkJcmV0dXJu
IHI7CiAJfQogCiAJYW1kZ3B1X2JvX2xpc3RfZm9yX2VhY2hfZW50cnkoZSwgcC0+Ym9fbGlzdCkg
ewotCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmOwotCiAJCS8qIGlnbm9yZSBkdXBsaWNhdGVzICovCiAJ
CWJvID0gdHRtX3RvX2FtZGdwdV9ibyhlLT50di5ibyk7CiAJCWlmICghYm8pCkBAIC04MzUsOCAr
ODI5LDcgQEAgc3RhdGljIGludCBhbWRncHVfY3Nfdm1faGFuZGxpbmcoc3RydWN0IGFtZGdwdV9j
c19wYXJzZXIgKnApCiAJCWlmIChyKQogCQkJcmV0dXJuIHI7CiAKLQkJZiA9IGJvX3ZhLT5sYXN0
X3B0X3VwZGF0ZTsKLQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKGFkZXYsICZwLT5qb2ItPnN5bmMs
IGYsIGZhbHNlKTsKKwkJciA9IGFtZGdwdV9zeW5jX3ZtX2ZlbmNlKCZwLT5qb2ItPnN5bmMsIGJv
X3ZhLT5sYXN0X3B0X3VwZGF0ZSk7CiAJCWlmIChyKQogCQkJcmV0dXJuIHI7CiAJfQpAQCAtODQ5
LDcgKzg0Miw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2NzX3ZtX2hhbmRsaW5nKHN0cnVjdCBhbWRn
cHVfY3NfcGFyc2VyICpwKQogCWlmIChyKQogCQlyZXR1cm4gcjsKIAotCXIgPSBhbWRncHVfc3lu
Y19mZW5jZShhZGV2LCAmcC0+am9iLT5zeW5jLCB2bS0+bGFzdF91cGRhdGUsIGZhbHNlKTsKKwly
ID0gYW1kZ3B1X3N5bmNfdm1fZmVuY2UoJnAtPmpvYi0+c3luYywgdm0tPmxhc3RfdXBkYXRlKTsK
IAlpZiAocikKIAkJcmV0dXJuIHI7CiAKQEAgLTk5MSw3ICs5ODQsNyBAQCBzdGF0aWMgaW50IGFt
ZGdwdV9jc19wcm9jZXNzX2ZlbmNlX2RlcChzdHJ1Y3QgYW1kZ3B1X2NzX3BhcnNlciAqcCwKIAkJ
CWRtYV9mZW5jZV9wdXQob2xkKTsKIAkJfQogCi0JCXIgPSBhbWRncHVfc3luY19mZW5jZShwLT5h
ZGV2LCAmcC0+am9iLT5zeW5jLCBmZW5jZSwgdHJ1ZSk7CisJCXIgPSBhbWRncHVfc3luY19mZW5j
ZSgmcC0+am9iLT5zeW5jLCBmZW5jZSwgdHJ1ZSk7CiAJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwog
CQlpZiAocikKIAkJCXJldHVybiByOwpAQCAtMTAxMyw3ICsxMDA2LDcgQEAgc3RhdGljIGludCBh
bWRncHVfc3luY29ial9sb29rdXBfYW5kX2FkZF90b19zeW5jKHN0cnVjdCBhbWRncHVfY3NfcGFy
c2VyICpwLAogCQlyZXR1cm4gcjsKIAl9CiAKLQlyID0gYW1kZ3B1X3N5bmNfZmVuY2UocC0+YWRl
diwgJnAtPmpvYi0+c3luYywgZmVuY2UsIHRydWUpOworCXIgPSBhbWRncHVfc3luY19mZW5jZSgm
cC0+am9iLT5zeW5jLCBmZW5jZSwgdHJ1ZSk7CiAJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAKIAly
ZXR1cm4gcjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9p
ZHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pZHMuYwppbmRleCA2Zjky
ODk3MzVlMzEuLjNhNjdmNmMwNDZkNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2lkcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9pZHMuYwpAQCAtMjA2LDcgKzIwNiw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtaWRfZ3JhYl9p
ZGxlKHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCWludCByOwogCiAJaWYgKHJpbmctPnZtaWRfd2Fp
dCAmJiAhZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKHJpbmctPnZtaWRfd2FpdCkpCi0JCXJldHVybiBh
bWRncHVfc3luY19mZW5jZShhZGV2LCBzeW5jLCByaW5nLT52bWlkX3dhaXQsIGZhbHNlKTsKKwkJ
cmV0dXJuIGFtZGdwdV9zeW5jX2ZlbmNlKHN5bmMsIHJpbmctPnZtaWRfd2FpdCwgZmFsc2UpOwog
CiAJZmVuY2VzID0ga21hbGxvY19hcnJheShzaXplb2Yodm9pZCAqKSwgaWRfbWdyLT5udW1faWRz
LCBHRlBfS0VSTkVMKTsKIAlpZiAoIWZlbmNlcykKQEAgLTI0MSw3ICsyNDEsNyBAQCBzdGF0aWMg
aW50IGFtZGdwdV92bWlkX2dyYWJfaWRsZShzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKIAkJCXJldHVy
biAtRU5PTUVNOwogCQl9CiAKLQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKGFkZXYsIHN5bmMsICZh
cnJheS0+YmFzZSwgZmFsc2UpOworCQlyID0gYW1kZ3B1X3N5bmNfZmVuY2Uoc3luYywgJmFycmF5
LT5iYXNlLCBmYWxzZSk7CiAJCWRtYV9mZW5jZV9wdXQocmluZy0+dm1pZF93YWl0KTsKIAkJcmlu
Zy0+dm1pZF93YWl0ID0gJmFycmF5LT5iYXNlOwogCQlyZXR1cm4gcjsKQEAgLTI5NCw3ICsyOTQs
NyBAQCBzdGF0aWMgaW50IGFtZGdwdV92bWlkX2dyYWJfcmVzZXJ2ZWQoc3RydWN0IGFtZGdwdV92
bSAqdm0sCiAJCXRtcCA9IGFtZGdwdV9zeW5jX3BlZWtfZmVuY2UoJigqaWQpLT5hY3RpdmUsIHJp
bmcpOwogCQlpZiAodG1wKSB7CiAJCQkqaWQgPSBOVUxMOwotCQkJciA9IGFtZGdwdV9zeW5jX2Zl
bmNlKGFkZXYsIHN5bmMsIHRtcCwgZmFsc2UpOworCQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKHN5
bmMsIHRtcCwgZmFsc2UpOwogCQkJcmV0dXJuIHI7CiAJCX0KIAkJbmVlZHNfZmx1c2ggPSB0cnVl
OwpAQCAtMzAzLDcgKzMwMyw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtaWRfZ3JhYl9yZXNlcnZl
ZChzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKIAkvKiBHb29kIHdlIGNhbiB1c2UgdGhpcyBWTUlELiBS
ZW1lbWJlciB0aGlzIHN1Ym1pc3Npb24gYXMKIAkqIHVzZXIgb2YgdGhlIFZNSUQuCiAJKi8KLQly
ID0gYW1kZ3B1X3N5bmNfZmVuY2UocmluZy0+YWRldiwgJigqaWQpLT5hY3RpdmUsIGZlbmNlLCBm
YWxzZSk7CisJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKCYoKmlkKS0+YWN0aXZlLCBmZW5jZSwgZmFs
c2UpOwogCWlmIChyKQogCQlyZXR1cm4gcjsKIApAQCAtMzc1LDcgKzM3NSw3IEBAIHN0YXRpYyBp
bnQgYW1kZ3B1X3ZtaWRfZ3JhYl91c2VkKHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCQkvKiBHb29k
LCB3ZSBjYW4gdXNlIHRoaXMgVk1JRC4gUmVtZW1iZXIgdGhpcyBzdWJtaXNzaW9uIGFzCiAJCSAq
IHVzZXIgb2YgdGhlIFZNSUQuCiAJCSAqLwotCQlyID0gYW1kZ3B1X3N5bmNfZmVuY2UocmluZy0+
YWRldiwgJigqaWQpLT5hY3RpdmUsIGZlbmNlLCBmYWxzZSk7CisJCXIgPSBhbWRncHVfc3luY19m
ZW5jZSgmKCppZCktPmFjdGl2ZSwgZmVuY2UsIGZhbHNlKTsKIAkJaWYgKHIpCiAJCQlyZXR1cm4g
cjsKIApAQCAtNDM1LDggKzQzNSw3IEBAIGludCBhbWRncHVfdm1pZF9ncmFiKHN0cnVjdCBhbWRn
cHVfdm0gKnZtLCBzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsCiAJCQlpZCA9IGlkbGU7CiAKIAkJ
CS8qIFJlbWVtYmVyIHRoaXMgc3VibWlzc2lvbiBhcyB1c2VyIG9mIHRoZSBWTUlEICovCi0JCQly
ID0gYW1kZ3B1X3N5bmNfZmVuY2UocmluZy0+YWRldiwgJmlkLT5hY3RpdmUsCi0JCQkJCSAgICAg
IGZlbmNlLCBmYWxzZSk7CisJCQlyID0gYW1kZ3B1X3N5bmNfZmVuY2UoJmlkLT5hY3RpdmUsIGZl
bmNlLCBmYWxzZSk7CiAJCQlpZiAocikKIAkJCQlnb3RvIGVycm9yOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfam9iLmMKaW5kZXggNGZiMjBlODcwZTYzLi43MzMyOGQwYzc0MWQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9qb2IuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMKQEAgLTE5Myw4ICsxOTMs
NyBAQCBzdGF0aWMgc3RydWN0IGRtYV9mZW5jZSAqYW1kZ3B1X2pvYl9kZXBlbmRlbmN5KHN0cnVj
dCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2IsCiAJZmVuY2UgPSBhbWRncHVfc3luY19nZXRfZmVu
Y2UoJmpvYi0+c3luYywgJmV4cGxpY2l0KTsKIAlpZiAoZmVuY2UgJiYgZXhwbGljaXQpIHsKIAkJ
aWYgKGRybV9zY2hlZF9kZXBlbmRlbmN5X29wdGltaXplZChmZW5jZSwgc19lbnRpdHkpKSB7Ci0J
CQlyID0gYW1kZ3B1X3N5bmNfZmVuY2UocmluZy0+YWRldiwgJmpvYi0+c2NoZWRfc3luYywKLQkJ
CQkJICAgICAgZmVuY2UsIGZhbHNlKTsKKwkJCXIgPSBhbWRncHVfc3luY19mZW5jZSgmam9iLT5z
Y2hlZF9zeW5jLCBmZW5jZSwgZmFsc2UpOwogCQkJaWYgKHIpCiAJCQkJRFJNX0VSUk9SKCJFcnJv
ciBhZGRpbmcgZmVuY2UgKCVkKVxuIiwgcik7CiAJCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfc3luYy5jCmluZGV4IDk1ZTVlOTNlZGQxOC4uZjFlNWZiZWY1NGQ4IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMKQEAgLTEyOSw3ICsxMjksOCBAQCBz
dGF0aWMgdm9pZCBhbWRncHVfc3luY19rZWVwX2xhdGVyKHN0cnVjdCBkbWFfZmVuY2UgKiprZWVw
LAogICogVHJpZXMgdG8gYWRkIHRoZSBmZW5jZSB0byBhbiBleGlzdGluZyBoYXNoIGVudHJ5LiBS
ZXR1cm5zIHRydWUgd2hlbiBhbiBlbnRyeQogICogd2FzIGZvdW5kLCBmYWxzZSBvdGhlcndpc2Uu
CiAgKi8KLXN0YXRpYyBib29sIGFtZGdwdV9zeW5jX2FkZF9sYXRlcihzdHJ1Y3QgYW1kZ3B1X3N5
bmMgKnN5bmMsIHN0cnVjdCBkbWFfZmVuY2UgKmYsIGJvb2wgZXhwbGljaXQpCitzdGF0aWMgYm9v
bCBhbWRncHVfc3luY19hZGRfbGF0ZXIoc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLCBzdHJ1Y3Qg
ZG1hX2ZlbmNlICpmLAorCQkJCSAgYm9vbCBleHBsaWNpdCkKIHsKIAlzdHJ1Y3QgYW1kZ3B1X3N5
bmNfZW50cnkgKmU7CiAKQEAgLTE1MSwxOSArMTUyLDE4IEBAIHN0YXRpYyBib29sIGFtZGdwdV9z
eW5jX2FkZF9sYXRlcihzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsIHN0cnVjdCBkbWFfZmVuY2Ug
KmYsCiAgKiBhbWRncHVfc3luY19mZW5jZSAtIHJlbWVtYmVyIHRvIHN5bmMgdG8gdGhpcyBmZW5j
ZQogICoKICAqIEBzeW5jOiBzeW5jIG9iamVjdCB0byBhZGQgZmVuY2UgdG8KLSAqIEBmZW5jZTog
ZmVuY2UgdG8gc3luYyB0bworICogQGY6IGZlbmNlIHRvIHN5bmMgdG8KKyAqIEBleHBsaWNpdDog
aWYgdGhpcyBpcyBhbiBleHBsaWNpdCBkZXBlbmRlbmN5CiAgKgorICogQWRkIHRoZSBmZW5jZSB0
byB0aGUgc3luYyBvYmplY3QuCiAgKi8KLWludCBhbWRncHVfc3luY19mZW5jZShzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLAotCQkgICAgICBzdHJ1
Y3QgZG1hX2ZlbmNlICpmLCBib29sIGV4cGxpY2l0KQoraW50IGFtZGdwdV9zeW5jX2ZlbmNlKHN0
cnVjdCBhbWRncHVfc3luYyAqc3luYywgc3RydWN0IGRtYV9mZW5jZSAqZiwKKwkJICAgICAgYm9v
bCBleHBsaWNpdCkKIHsKIAlzdHJ1Y3QgYW1kZ3B1X3N5bmNfZW50cnkgKmU7CiAKIAlpZiAoIWYp
CiAJCXJldHVybiAwOwotCWlmIChhbWRncHVfc3luY19zYW1lX2RldihhZGV2LCBmKSAmJgotCSAg
ICBhbWRncHVfc3luY19nZXRfb3duZXIoZikgPT0gQU1ER1BVX0ZFTkNFX09XTkVSX1ZNKQotCQlh
bWRncHVfc3luY19rZWVwX2xhdGVyKCZzeW5jLT5sYXN0X3ZtX3VwZGF0ZSwgZik7CiAKIAlpZiAo
YW1kZ3B1X3N5bmNfYWRkX2xhdGVyKHN5bmMsIGYsIGV4cGxpY2l0KSkKIAkJcmV0dXJuIDA7CkBA
IC0xNzksNiArMTc5LDI0IEBAIGludCBhbWRncHVfc3luY19mZW5jZShzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLAogCXJldHVybiAwOwogfQogCisv
KioKKyAqIGFtZGdwdV9zeW5jX3ZtX2ZlbmNlIC0gcmVtZW1iZXIgdG8gc3luYyB0byB0aGlzIFZN
IGZlbmNlCisgKgorICogQGFkZXY6IGFtZGdwdSBkZXZpY2UKKyAqIEBzeW5jOiBzeW5jIG9iamVj
dCB0byBhZGQgZmVuY2UgdG8KKyAqIEBmZW5jZTogdGhlIFZNIGZlbmNlIHRvIGFkZAorICoKKyAq
IEFkZCB0aGUgZmVuY2UgdG8gdGhlIHN5bmMgb2JqZWN0IGFuZCByZW1lbWJlciBpdCBhcyBWTSB1
cGRhdGUuCisgKi8KK2ludCBhbWRncHVfc3luY192bV9mZW5jZShzdHJ1Y3QgYW1kZ3B1X3N5bmMg
KnN5bmMsIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQoreworCWlmICghZmVuY2UpCisJCXJldHVy
biAwOworCisJYW1kZ3B1X3N5bmNfa2VlcF9sYXRlcigmc3luYy0+bGFzdF92bV91cGRhdGUsIGZl
bmNlKTsKKwlyZXR1cm4gYW1kZ3B1X3N5bmNfZmVuY2Uoc3luYywgZmVuY2UsIGZhbHNlKTsKK30K
KwogLyoqCiAgKiBhbWRncHVfc3luY19yZXN2IC0gc3luYyB0byBhIHJlc2VydmF0aW9uIG9iamVj
dAogICoKQEAgLTIwNCw3ICsyMjIsNyBAQCBpbnQgYW1kZ3B1X3N5bmNfcmVzdihzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKIAogCS8qIGFsd2F5cyBzeW5jIHRvIHRoZSBleGNsdXNpdmUgZmVu
Y2UgKi8KIAlmID0gZG1hX3Jlc3ZfZ2V0X2V4Y2wocmVzdik7Ci0JciA9IGFtZGdwdV9zeW5jX2Zl
bmNlKGFkZXYsIHN5bmMsIGYsIGZhbHNlKTsKKwlyID0gYW1kZ3B1X3N5bmNfZmVuY2Uoc3luYywg
ZiwgZmFsc2UpOwogCiAJZmxpc3QgPSBkbWFfcmVzdl9nZXRfbGlzdChyZXN2KTsKIAlpZiAoIWZs
aXN0IHx8IHIpCkBAIC0yMzksNyArMjU3LDcgQEAgaW50IGFtZGdwdV9zeW5jX3Jlc3Yoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkJY29udGludWU7CiAJCX0KIAotCQlyID0gYW1kZ3B1
X3N5bmNfZmVuY2UoYWRldiwgc3luYywgZiwgZmFsc2UpOworCQlyID0gYW1kZ3B1X3N5bmNfZmVu
Y2Uoc3luYywgZiwgZmFsc2UpOwogCQlpZiAocikKIAkJCWJyZWFrOwogCX0KQEAgLTM0MCw3ICsz
NTgsNyBAQCBpbnQgYW1kZ3B1X3N5bmNfY2xvbmUoc3RydWN0IGFtZGdwdV9zeW5jICpzb3VyY2Us
IHN0cnVjdCBhbWRncHVfc3luYyAqY2xvbmUpCiAJaGFzaF9mb3JfZWFjaF9zYWZlKHNvdXJjZS0+
ZmVuY2VzLCBpLCB0bXAsIGUsIG5vZGUpIHsKIAkJZiA9IGUtPmZlbmNlOwogCQlpZiAoIWRtYV9m
ZW5jZV9pc19zaWduYWxlZChmKSkgewotCQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKE5VTEwsIGNs
b25lLCBmLCBlLT5leHBsaWNpdCk7CisJCQlyID0gYW1kZ3B1X3N5bmNfZmVuY2UoY2xvbmUsIGYs
IGUtPmV4cGxpY2l0KTsKIAkJCWlmIChyKQogCQkJCXJldHVybiByOwogCQl9IGVsc2UgewpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3N5bmMuaCBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmgKaW5kZXggYjVmMTc3OGEyMzE5Li5k
NjJjMmI4MWQ5MmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9zeW5jLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3N5bmMuaApA
QCAtNDAsOCArNDAsOSBAQCBzdHJ1Y3QgYW1kZ3B1X3N5bmMgewogfTsKIAogdm9pZCBhbWRncHVf
c3luY19jcmVhdGUoc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jKTsKLWludCBhbWRncHVfc3luY19m
ZW5jZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV9zeW5jICpzeW5j
LAotCQkgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmLCBib29sIGV4cGxpY2l0KTsKK2ludCBhbWRn
cHVfc3luY19mZW5jZShzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsIHN0cnVjdCBkbWFfZmVuY2Ug
KmYsCisJCSAgICAgIGJvb2wgZXhwbGljaXQpOworaW50IGFtZGdwdV9zeW5jX3ZtX2ZlbmNlKHN0
cnVjdCBhbWRncHVfc3luYyAqc3luYywgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwogaW50IGFt
ZGdwdV9zeW5jX3Jlc3Yoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCSAgICAgc3RydWN0
IGFtZGdwdV9zeW5jICpzeW5jLAogCQkgICAgIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwKQEAgLTQ5
LDcgKzUwLDggQEAgaW50IGFtZGdwdV9zeW5jX3Jlc3Yoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsCiAJCSAgICAgYm9vbCBleHBsaWNpdF9zeW5jKTsKIHN0cnVjdCBkbWFfZmVuY2UgKmFtZGdw
dV9zeW5jX3BlZWtfZmVuY2Uoc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLAogCQkJCSAgICAgc3Ry
dWN0IGFtZGdwdV9yaW5nICpyaW5nKTsKLXN0cnVjdCBkbWFfZmVuY2UgKmFtZGdwdV9zeW5jX2dl
dF9mZW5jZShzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsIGJvb2wgKmV4cGxpY2l0KTsKK3N0cnVj
dCBkbWFfZmVuY2UgKmFtZGdwdV9zeW5jX2dldF9mZW5jZShzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5
bmMsCisJCQkJCWJvb2wgKmV4cGxpY2l0KTsKIGludCBhbWRncHVfc3luY19jbG9uZShzdHJ1Y3Qg
YW1kZ3B1X3N5bmMgKnNvdXJjZSwgc3RydWN0IGFtZGdwdV9zeW5jICpjbG9uZSk7CiBpbnQgYW1k
Z3B1X3N5bmNfd2FpdChzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsIGJvb2wgaW50cik7CiB2b2lk
IGFtZGdwdV9zeW5jX2ZyZWUoc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1hLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCmluZGV4IDgzMmRiNTlmNDQxZS4uNTBm
NDg3NjY2OTc3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dm1fc2RtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1h
LmMKQEAgLTcxLDcgKzcxLDcgQEAgc3RhdGljIGludCBhbWRncHVfdm1fc2RtYV9wcmVwYXJlKHN0
cnVjdCBhbWRncHVfdm1fdXBkYXRlX3BhcmFtcyAqcCwKIAlwLT5udW1fZHdfbGVmdCA9IG5kdzsK
IAogCS8qIFdhaXQgZm9yIG1vdmVzIHRvIGJlIGNvbXBsZXRlZCAqLwotCXIgPSBhbWRncHVfc3lu
Y19mZW5jZShwLT5hZGV2LCAmcC0+am9iLT5zeW5jLCBleGNsdXNpdmUsIGZhbHNlKTsKKwlyID0g
YW1kZ3B1X3N5bmNfZmVuY2UoJnAtPmpvYi0+c3luYywgZXhjbHVzaXZlLCBmYWxzZSk7CiAJaWYg
KHIpCiAJCXJldHVybiByOwogCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vYW1kLWdmeAo=
