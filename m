Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E0711E0B68
	for <lists+amd-gfx@lfdr.de>; Tue, 22 Oct 2019 20:28:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EB1FE89561;
	Tue, 22 Oct 2019 18:28:19 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM04-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr700051.outbound.protection.outlook.com [40.107.70.51])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B169589561
 for <amd-gfx@lists.freedesktop.org>; Tue, 22 Oct 2019 18:28:18 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=kKoMqYeH/Bi8KzhZGq+MrM5Zz3E+a7e9A3yelB9ETkvXvezagnE3RlMhWDYXX3KPsXF8fik55iT+V7dN0ULo63ENG+Rhucjn+N5vctC7Z63qTNhJ0VBKe8ju4LRpdPCxT/fMlP+lrGZDuoMHL+4S3JimB65h3Ab2I81D6NYZ9DdO4A+ClxFszB+DYJCJ//ZLf7waWloZ8WYJ8cuS5QjEOGFHpxkOUQkys4IpOl+Mq8IoyLFfGP1u7ezcJAjR+OkTFeokTNABFm8rSY2g76PB8jEfexnlh+/AgPOoPDSv5RlKm/J7HfGuseZPfaA7PaixSwiLxmMJOo+PUP4t659ZPQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=V63iY5uaSt80krxblOMqtfEiq/r6VFbvM0Mc77/m4MQ=;
 b=JssorJZ8fIaqN5oQ6kzV61/+yd6vZfzW/eVLcSfmWQezsMVfIyEpP7a24bXYZE2CvAsaGQBk3Xb+vnRWYiefXcCBhW6enA16fhhAwmAjoLvcMhBJ/AvJX9ls2twjxngafd55XKb4A0Ptozk/qZIVIJoXZQalNnjg0Q+QqfBTGkCkJsLJk8TuUNDf7z7pCvjAOSNxX59tVoDcMHu27hlmLNHQgmY9HplyhJO6Yrj/9wHxrzmF802qtIpGJhPcEw9NHkPZdk5yAOyPw41I+OmW156IFMd9xuxaBL3BkqjBCVm4dukYt2v0wdMyTVlhZw3vBw7K6M1aT+f4tJHwBNq8Ag==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
Received: from MN2PR12MB4030.namprd12.prod.outlook.com (10.255.86.25) by
 MN2PR12MB3950.namprd12.prod.outlook.com (10.255.239.10) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2367.24; Tue, 22 Oct 2019 18:28:17 +0000
Received: from MN2PR12MB4030.namprd12.prod.outlook.com
 ([fe80::1ee:c734:15e5:d8b9]) by MN2PR12MB4030.namprd12.prod.outlook.com
 ([fe80::1ee:c734:15e5:d8b9%5]) with mapi id 15.20.2367.022; Tue, 22 Oct 2019
 18:28:16 +0000
From: "Yang, Philip" <Philip.Yang@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: [PATCH v2] drm/amdkfd: don't use dqm lock during device
 reset/suspend/resume
Thread-Topic: [PATCH v2] drm/amdkfd: don't use dqm lock during device
 reset/suspend/resume
Thread-Index: AQHViQZ4XzhiW2lzAk+tGGEmnkv7NA==
Date: Tue, 22 Oct 2019 18:28:16 +0000
Message-ID: <20191022182804.23845-1-Philip.Yang@amd.com>
Accept-Language: en-ZA, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: YTXPR0101CA0006.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b00::19) To MN2PR12MB4030.namprd12.prod.outlook.com
 (2603:10b6:208:159::25)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.17.1
x-originating-ip: [165.204.55.251]
x-ms-publictraffictype: Email
x-ms-office365-filtering-ht: Tenant
x-ms-office365-filtering-correlation-id: 53aefb8a-1743-46a2-03ce-08d7571d9b0e
x-ms-traffictypediagnostic: MN2PR12MB3950:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <MN2PR12MB3950E91E0691F5DD5225DAFBE6680@MN2PR12MB3950.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:5516;
x-forefront-prvs: 01986AE76B
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(4636009)(366004)(396003)(376002)(136003)(39860400002)(346002)(199004)(189003)(7736002)(8676002)(4326008)(50226002)(86362001)(6486002)(305945005)(8936002)(81166006)(81156014)(2501003)(66556008)(66476007)(66946007)(6916009)(6116002)(6436002)(6512007)(66446008)(64756008)(3846002)(36756003)(99286004)(2906002)(5640700003)(15650500001)(486006)(476003)(6506007)(102836004)(66066001)(52116002)(2616005)(1076003)(14444005)(256004)(26005)(186003)(478600001)(14454004)(71190400001)(71200400001)(25786009)(386003)(2351001)(316002)(5660300002);
 DIR:OUT; SFP:1101; SCL:1; SRVR:MN2PR12MB3950;
 H:MN2PR12MB4030.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: L6flrDzrfNDGQ0GW0UpFgLuDq0oiCH/P1wA1QcU/7NftSWh1R6reXu9Vtf9F728HwE/wMvl2433wjxMeXuWYtFWUjRZFJjW4ZZGhvMiuOlctyCE/zkxCpPmkN5q7eknhCDVs0RFmiLUoaNCkGApoFQtUiILK1JaH4omlE8jufOeMnlQh9kajxBEvU0RKtvOQoEa0ZeA89Xwaa5X0X4xhC8gx8heXezbDIZoG+T/V5X4zyjMmPkgtqFkpXHmY4osxk1n5eZchaAb7lONVAAQyxo3uruRqwLuiqKPhlvvdHks96HSnpI8tNKHPBngD+Ao7uhH4n+5ta+7jbtf3Lch4iaXOeoQyAPqIFr5gG8QXJRtgU0+2FUYZMN0Izgu+07N5IswtpldTRMwBFSINbYS2Ig9qI2ZdgyaCI7hyOtSHaGa7KiD2IvnfEMdu5zgPCHc0
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 53aefb8a-1743-46a2-03ce-08d7571d9b0e
X-MS-Exchange-CrossTenant-originalarrivaltime: 22 Oct 2019 18:28:16.6577 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: AR3WXe9iP7FdbLdcZustO+BipFhGTACuQJEG33uMyMtFu/ZMUg1i0FzcvDHdT7iw
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MN2PR12MB3950
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=V63iY5uaSt80krxblOMqtfEiq/r6VFbvM0Mc77/m4MQ=;
 b=u9Na0Umfzx+WEt/2v/jeI8edIcdlBZmNqJATupSyTa7lG1yZt/y4YnOn594jfRFpxHIFO1Ni7Nx8i1U7Uml/0Jxbany4rIG2dQJrYXrtR0RNpH+7jrgrDhN4vCvCis6NqFvtyD1RjP9B9yWCjGBFYGgO5MTYx46jnvkCnP752FA=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Philip.Yang@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Yang, Philip" <Philip.Yang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

SWYgZGV2aWNlIHJlc2V0L3N1c3BlbmQvcmVzdW1lIGZhaWxlZCBmb3Igc29tZSByZWFzb24sIGRx
bSBsb2NrIGlzCmhvbGQgZm9yZXZlciBhbmQgdGhpcyBjYXVzZXMgZGVhZGxvY2suIEJlbG93IGlz
IGEga2VybmVsIGJhY2t0cmFjZSB3aGVuCmFwcGxpY2F0aW9uIG9wZW4ga2ZkIGFmdGVyIHN1c3Bl
bmQvcmVzdW1lIGZhaWxlZC4KCkluc3RlYWQgb2YgaG9sZGluZyBkcW0gbG9jayBpbiBwcmVfcmVz
ZXQgYW5kIHJlbGVhc2luZyBkcW0gbG9jayBpbgpwb3N0X3Jlc2V0LCBhZGQgZHFtLT5kZXZpY2Vf
c3RvcHBlZCBmbGFnIHdoaWNoIGlzIG1vZGlmaWVkIGluCmRxbS0+b3BzLnN0YXJ0IGFuZCBkcW0t
Pm9wcy5zdG9wLiBUaGUgZmxhZyBkb2Vzbid0IG5lZWQgbG9jayBwcm90ZWN0aW9uCmJlY2F1c2Ug
d3JpdGUvcmVhZCBhcmUgYWxsIGluc2lkZSBkcW0gbG9jay4KCkZvciBIV1MgY2FzZSwgbWFwX3F1
ZXVlc19jcHNjaCBhbmQgdW5tYXBfcXVldWVzX2Nwc2NoIGNoZWNrcwpkZXZpY2Vfc3RvcHBlZCBm
bGFnIGJlZm9yZSBzZW5kaW5nIHRoZSB1cGRhdGVkIHJ1bmxpc3QuCgp2MjogRm9yIG5vLUhXUyBj
YXNlLCB3aGVuIGRldmljZSBpcyBzdG9wcGVkLCBkb24ndCBjYWxsCmxvYWQvZGVzdHJveV9tcWQg
Zm9yIGV2aWN0aW9uLCByZXN0b3JlIGFuZCBjcmVhdGUgcXVldWUsIGFuZCBhdm9pZApkZWJ1Z2Zz
IGR1bXAgaGRxcy4KCkJhY2t0cmFjZSBvZiBkcW0gbG9jayBkZWFkbG9jazoKCltUaHUgT2N0IDE3
IDE2OjQzOjM3IDIwMTldIElORk86IHRhc2sgcm9jbWluZm86MzAyNCBibG9ja2VkIGZvciBtb3Jl
CnRoYW4gMTIwIHNlY29uZHMuCltUaHUgT2N0IDE3IDE2OjQzOjM3IDIwMTldICAgICAgIE5vdCB0
YWludGVkCjUuMC4wLXJjMS1rZmQtY29tcHV0ZS1yb2NtLWRrbXMtbm8tbnBpLTExMzEgIzEKW1Ro
dSBPY3QgMTcgMTY6NDM6MzcgMjAxOV0gImVjaG8gMCA+Ci9wcm9jL3N5cy9rZXJuZWwvaHVuZ190
YXNrX3RpbWVvdXRfc2VjcyIgZGlzYWJsZXMgdGhpcyBtZXNzYWdlLgpbVGh1IE9jdCAxNyAxNjo0
MzozNyAyMDE5XSByb2NtaW5mbyAgICAgICAgRCAgICAwICAzMDI0ICAgMjk0NwoweDgwMDAwMDAw
CltUaHUgT2N0IDE3IDE2OjQzOjM3IDIwMTldIENhbGwgVHJhY2U6CltUaHUgT2N0IDE3IDE2OjQz
OjM3IDIwMTldICA/IF9fc2NoZWR1bGUrMHgzZDkvMHg4YTAKW1RodSBPY3QgMTcgMTY6NDM6Mzcg
MjAxOV0gIHNjaGVkdWxlKzB4MzIvMHg3MApbVGh1IE9jdCAxNyAxNjo0MzozNyAyMDE5XSAgc2No
ZWR1bGVfcHJlZW1wdF9kaXNhYmxlZCsweGEvMHgxMApbVGh1IE9jdCAxNyAxNjo0MzozNyAyMDE5
XSAgX19tdXRleF9sb2NrLmlzcmEuOSsweDFlMy8weDRlMApbVGh1IE9jdCAxNyAxNjo0MzozNyAy
MDE5XSAgPyBfX2NhbGxfc3JjdSsweDI2NC8weDNiMApbVGh1IE9jdCAxNyAxNjo0MzozNyAyMDE5
XSAgPyBwcm9jZXNzX3Rlcm1pbmF0aW9uX2Nwc2NoKzB4MjQvMHgyZjAKW2FtZGdwdV0KW1RodSBP
Y3QgMTcgMTY6NDM6MzcgMjAxOV0gIHByb2Nlc3NfdGVybWluYXRpb25fY3BzY2grMHgyNC8weDJm
MApbYW1kZ3B1XQpbVGh1IE9jdCAxNyAxNjo0MzozNyAyMDE5XQprZmRfcHJvY2Vzc19kZXF1ZXVl
X2Zyb21fYWxsX2RldmljZXMrMHg0Mi8weDYwIFthbWRncHVdCltUaHUgT2N0IDE3IDE2OjQzOjM3
IDIwMTldICBrZmRfcHJvY2Vzc19ub3RpZmllcl9yZWxlYXNlKzB4MWJlLzB4MjIwClthbWRncHVd
CltUaHUgT2N0IDE3IDE2OjQzOjM3IDIwMTldICBfX21tdV9ub3RpZmllcl9yZWxlYXNlKzB4M2Uv
MHhjMApbVGh1IE9jdCAxNyAxNjo0MzozNyAyMDE5XSAgZXhpdF9tbWFwKzB4MTYwLzB4MWEwCltU
aHUgT2N0IDE3IDE2OjQzOjM3IDIwMTldICA/IF9faGFuZGxlX21tX2ZhdWx0KzB4YmEzLzB4MTIw
MApbVGh1IE9jdCAxNyAxNjo0MzozNyAyMDE5XSAgPyBleGl0X3JvYnVzdF9saXN0KzB4NWEvMHgx
MTAKW1RodSBPY3QgMTcgMTY6NDM6MzcgMjAxOV0gIG1tcHV0KzB4NGEvMHgxMjAKW1RodSBPY3Qg
MTcgMTY6NDM6MzcgMjAxOV0gIGRvX2V4aXQrMHgyODQvMHhiMjAKW1RodSBPY3QgMTcgMTY6NDM6
MzcgMjAxOV0gID8gaGFuZGxlX21tX2ZhdWx0KzB4ZmEvMHgyMDAKW1RodSBPY3QgMTcgMTY6NDM6
MzcgMjAxOV0gIGRvX2dyb3VwX2V4aXQrMHgzYS8weGEwCltUaHUgT2N0IDE3IDE2OjQzOjM3IDIw
MTldICBfX3g2NF9zeXNfZXhpdF9ncm91cCsweDE0LzB4MjAKW1RodSBPY3QgMTcgMTY6NDM6Mzcg
MjAxOV0gIGRvX3N5c2NhbGxfNjQrMHg0Zi8weDEwMApbVGh1IE9jdCAxNyAxNjo0MzozNyAyMDE5
XSAgZW50cnlfU1lTQ0FMTF82NF9hZnRlcl9od2ZyYW1lKzB4NDQvMHhhOQoKU3VnZ2VzdGVkLWJ5
OiBGZWxpeCBLdWVobGluZyA8RmVsaXguS3VlaGxpbmdAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTog
UGhpbGlwIFlhbmcgPFBoaWxpcC5ZYW5nQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRrZmQva2ZkX2NoYXJkZXYuYyAgICAgIHwgIDYgKy0tCiBkcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGtmZC9rZmRfZGV2aWNlLmMgICAgICAgfCAgNSAtLQogLi4uL2RybS9hbWQvYW1ka2ZkL2tm
ZF9kZXZpY2VfcXVldWVfbWFuYWdlci5jIHwgNDcgKysrKysrKysrKysrKysrKystLQogLi4uL2Ry
bS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5oIHwgIDEgKwogNCBmaWxlcyBj
aGFuZ2VkLCA0NiBpbnNlcnRpb25zKCspLCAxMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfY2hhcmRldi5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRrZmQva2ZkX2NoYXJkZXYuYwppbmRleCBkOWUzNmRiZjEzZDUuLjQwZDc1YzM5ZjA4
ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2NoYXJkZXYuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfY2hhcmRldi5jCkBAIC0xMjAsMTMg
KzEyMCwxMyBAQCBzdGF0aWMgaW50IGtmZF9vcGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVj
dCBmaWxlICpmaWxlcCkKIAkJcmV0dXJuIC1FUEVSTTsKIAl9CiAKKwlpZiAoa2ZkX2lzX2xvY2tl
ZCgpKQorCQlyZXR1cm4gLUVBR0FJTjsKKwogCXByb2Nlc3MgPSBrZmRfY3JlYXRlX3Byb2Nlc3Mo
ZmlsZXApOwogCWlmIChJU19FUlIocHJvY2VzcykpCiAJCXJldHVybiBQVFJfRVJSKHByb2Nlc3Mp
OwogCi0JaWYgKGtmZF9pc19sb2NrZWQoKSkKLQkJcmV0dXJuIC1FQUdBSU47Ci0KIAlkZXZfZGJn
KGtmZF9kZXZpY2UsICJwcm9jZXNzICVkIG9wZW5lZCwgY29tcGF0IG1vZGUgKDMyIGJpdCkgLSAl
ZFxuIiwKIAkJcHJvY2Vzcy0+cGFzaWQsIHByb2Nlc3MtPmlzXzMyYml0X3VzZXJfbW9kZSk7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2UuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2UuYwppbmRleCA4ZjRiMjRlODQ5NjQu
LjRmYTg4MzRjZTdjYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2Zk
X2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2UuYwpA
QCAtNzMwLDkgKzczMCw2IEBAIGludCBrZ2Qya2ZkX3ByZV9yZXNldChzdHJ1Y3Qga2ZkX2RldiAq
a2ZkKQogCQlyZXR1cm4gMDsKIAlrZ2Qya2ZkX3N1c3BlbmQoa2ZkKTsKIAotCS8qIGhvbGQgZHFt
LT5sb2NrIHRvIHByZXZlbnQgZnVydGhlciBleGVjdXRpb24qLwotCWRxbV9sb2NrKGtmZC0+ZHFt
KTsKLQogCWtmZF9zaWduYWxfcmVzZXRfZXZlbnQoa2ZkKTsKIAlyZXR1cm4gMDsKIH0KQEAgLTc1
MCw4ICs3NDcsNiBAQCBpbnQga2dkMmtmZF9wb3N0X3Jlc2V0KHN0cnVjdCBrZmRfZGV2ICprZmQp
CiAJaWYgKCFrZmQtPmluaXRfY29tcGxldGUpCiAJCXJldHVybiAwOwogCi0JZHFtX3VubG9jayhr
ZmQtPmRxbSk7Ci0KIAlyZXQgPSBrZmRfcmVzdW1lKGtmZCk7CiAJaWYgKHJldCkKIAkJcmV0dXJu
IHJldDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2Vf
cXVldWVfbWFuYWdlci5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9x
dWV1ZV9tYW5hZ2VyLmMKaW5kZXggODFmYjU0NWNmNDJjLi44MmUxYzYyODBkMTMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdl
ci5jCkBAIC0zNDAsNiArMzQwLDEwIEBAIHN0YXRpYyBpbnQgY3JlYXRlX3F1ZXVlX25vY3BzY2go
c3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sCiAJbXFkX21nci0+aW5pdF9tcWQobXFk
X21nciwgJnEtPm1xZCwgcS0+bXFkX21lbV9vYmosCiAJCQkJJnEtPmdhcnRfbXFkX2FkZHIsICZx
LT5wcm9wZXJ0aWVzKTsKIAlpZiAocS0+cHJvcGVydGllcy5pc19hY3RpdmUpIHsKKwkJaWYgKCFk
cW0tPnNjaGVkX3J1bm5pbmcpIHsKKwkJCVdBUk5fT05DRSgxLCAiTG9hZCBub24tSFdTIG1xZCB3
aGlsZSBzdG9wcGVkXG4iKTsKKwkJCWdvdG8gYWRkX3F1ZXVlX3RvX2xpc3Q7CisJCX0KIAogCQlp
ZiAoV0FSTihxLT5wcm9jZXNzLT5tbSAhPSBjdXJyZW50LT5tbSwKIAkJCQkJInNob3VsZCBvbmx5
IHJ1biBpbiB1c2VyIHRocmVhZCIpKQpAQCAtMzUxLDYgKzM1NSw3IEBAIHN0YXRpYyBpbnQgY3Jl
YXRlX3F1ZXVlX25vY3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sCiAJCQln
b3RvIG91dF9mcmVlX21xZDsKIAl9CiAKK2FkZF9xdWV1ZV90b19saXN0OgogCWxpc3RfYWRkKCZx
LT5saXN0LCAmcXBkLT5xdWV1ZXNfbGlzdCk7CiAJcXBkLT5xdWV1ZV9jb3VudCsrOwogCWlmIChx
LT5wcm9wZXJ0aWVzLmlzX2FjdGl2ZSkKQEAgLTQ1OCw2ICs0NjMsMTEgQEAgc3RhdGljIGludCBk
ZXN0cm95X3F1ZXVlX25vY3BzY2hfbG9ja2VkKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAq
ZHFtLAogCiAJZGVhbGxvY2F0ZV9kb29yYmVsbChxcGQsIHEpOwogCisJaWYgKCFkcW0tPnNjaGVk
X3J1bm5pbmcpIHsKKwkJV0FSTl9PTkNFKDEsICJEZXN0cm95IG5vbi1IV1MgcXVldWUgd2hpbGUg
c3RvcHBlZFxuIik7CisJCXJldHVybiAwOworCX0KKwogCXJldHZhbCA9IG1xZF9tZ3ItPmRlc3Ry
b3lfbXFkKG1xZF9tZ3IsIHEtPm1xZCwKIAkJCQlLRkRfUFJFRU1QVF9UWVBFX1dBVkVGUk9OVF9S
RVNFVCwKIAkJCQlLRkRfVU5NQVBfTEFURU5DWV9NUywKQEAgLTUzMyw2ICs1NDMsMTIgQEAgc3Rh
dGljIGludCB1cGRhdGVfcXVldWUoc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sIHN0
cnVjdCBxdWV1ZSAqcSkKIAkJICAgKHEtPnByb3BlcnRpZXMudHlwZSA9PSBLRkRfUVVFVUVfVFlQ
RV9DT01QVVRFIHx8CiAJCSAgICBxLT5wcm9wZXJ0aWVzLnR5cGUgPT0gS0ZEX1FVRVVFX1RZUEVf
U0RNQSB8fAogCQkgICAgcS0+cHJvcGVydGllcy50eXBlID09IEtGRF9RVUVVRV9UWVBFX1NETUFf
WEdNSSkpIHsKKworCQlpZiAoIWRxbS0+c2NoZWRfcnVubmluZykgeworCQkJV0FSTl9PTkNFKDEs
ICJVcGRhdGUgbm9uLUhXUyBxdWV1ZSB3aGlsZSBzdG9wcGVkXG4iKTsKKwkJCWdvdG8gb3V0X3Vu
bG9jazsKKwkJfQorCiAJCXJldHZhbCA9IG1xZF9tZ3ItPmRlc3Ryb3lfbXFkKG1xZF9tZ3IsIHEt
Pm1xZCwKIAkJCQlLRkRfUFJFRU1QVF9UWVBFX1dBVkVGUk9OVF9EUkFJTiwKIAkJCQlLRkRfVU5N
QVBfTEFURU5DWV9NUywgcS0+cGlwZSwgcS0+cXVldWUpOwpAQCAtNjAyLDYgKzYxOCwxMSBAQCBz
dGF0aWMgaW50IGV2aWN0X3Byb2Nlc3NfcXVldWVzX25vY3BzY2goc3RydWN0IGRldmljZV9xdWV1
ZV9tYW5hZ2VyICpkcW0sCiAJCW1xZF9tZ3IgPSBkcW0tPm1xZF9tZ3JzW2dldF9tcWRfdHlwZV9m
cm9tX3F1ZXVlX3R5cGUoCiAJCQkJcS0+cHJvcGVydGllcy50eXBlKV07CiAJCXEtPnByb3BlcnRp
ZXMuaXNfYWN0aXZlID0gZmFsc2U7CisJCWRxbS0+cXVldWVfY291bnQtLTsKKworCQlpZiAoIWRx
bS0+c2NoZWRfcnVubmluZykKKwkJCWNvbnRpbnVlOworCiAJCXJldHZhbCA9IG1xZF9tZ3ItPmRl
c3Ryb3lfbXFkKG1xZF9tZ3IsIHEtPm1xZCwKIAkJCQlLRkRfUFJFRU1QVF9UWVBFX1dBVkVGUk9O
VF9EUkFJTiwKIAkJCQlLRkRfVU5NQVBfTEFURU5DWV9NUywgcS0+cGlwZSwgcS0+cXVldWUpOwpA
QCAtNjEwLDcgKzYzMSw2IEBAIHN0YXRpYyBpbnQgZXZpY3RfcHJvY2Vzc19xdWV1ZXNfbm9jcHNj
aChzdHJ1Y3QgZGV2aWNlX3F1ZXVlX21hbmFnZXIgKmRxbSwKIAkJCSAqIG1haW50YWluIGEgY29u
c2lzdGVudCBldmljdGlvbiBzdGF0ZQogCQkJICovCiAJCQlyZXQgPSByZXR2YWw7Ci0JCWRxbS0+
cXVldWVfY291bnQtLTsKIAl9CiAKIG91dDoKQEAgLTcxMSw2ICs3MzEsMTEgQEAgc3RhdGljIGlu
dCByZXN0b3JlX3Byb2Nlc3NfcXVldWVzX25vY3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5h
Z2VyICpkcW0sCiAJCW1xZF9tZ3IgPSBkcW0tPm1xZF9tZ3JzW2dldF9tcWRfdHlwZV9mcm9tX3F1
ZXVlX3R5cGUoCiAJCQkJcS0+cHJvcGVydGllcy50eXBlKV07CiAJCXEtPnByb3BlcnRpZXMuaXNf
YWN0aXZlID0gdHJ1ZTsKKwkJZHFtLT5xdWV1ZV9jb3VudCsrOworCisJCWlmICghZHFtLT5zY2hl
ZF9ydW5uaW5nKQorCQkJY29udGludWU7CisKIAkJcmV0dmFsID0gbXFkX21nci0+bG9hZF9tcWQo
bXFkX21nciwgcS0+bXFkLCBxLT5waXBlLAogCQkJCSAgICAgICBxLT5xdWV1ZSwgJnEtPnByb3Bl
cnRpZXMsIG1tKTsKIAkJaWYgKHJldHZhbCAmJiAhcmV0KQpAQCAtNzE4LDcgKzc0Myw2IEBAIHN0
YXRpYyBpbnQgcmVzdG9yZV9wcm9jZXNzX3F1ZXVlc19ub2Nwc2NoKHN0cnVjdCBkZXZpY2VfcXVl
dWVfbWFuYWdlciAqZHFtLAogCQkJICogbWFpbnRhaW4gYSBjb25zaXN0ZW50IGV2aWN0aW9uIHN0
YXRlCiAJCQkgKi8KIAkJCXJldCA9IHJldHZhbDsKLQkJZHFtLT5xdWV1ZV9jb3VudCsrOwogCX0K
IAlxcGQtPmV2aWN0ZWQgPSAwOwogb3V0OgpAQCAtOTE1LDcgKzkzOSw4IEBAIHN0YXRpYyBpbnQg
c3RhcnRfbm9jcHNjaChzdHJ1Y3QgZGV2aWNlX3F1ZXVlX21hbmFnZXIgKmRxbSkKIAkKIAlpZiAo
ZHFtLT5kZXYtPmRldmljZV9pbmZvLT5hc2ljX2ZhbWlseSA9PSBDSElQX0hBV0FJSSkKIAkJcmV0
dXJuIHBtX2luaXQoJmRxbS0+cGFja2V0cywgZHFtKTsKLQkKKwlkcW0tPnNjaGVkX3J1bm5pbmcg
PSB0cnVlOworCiAJcmV0dXJuIDA7CiB9CiAKQEAgLTkyMyw3ICs5NDgsOCBAQCBzdGF0aWMgaW50
IHN0b3Bfbm9jcHNjaChzdHJ1Y3QgZGV2aWNlX3F1ZXVlX21hbmFnZXIgKmRxbSkKIHsKIAlpZiAo
ZHFtLT5kZXYtPmRldmljZV9pbmZvLT5hc2ljX2ZhbWlseSA9PSBDSElQX0hBV0FJSSkKIAkJcG1f
dW5pbml0KCZkcW0tPnBhY2tldHMpOwotCQorCWRxbS0+c2NoZWRfcnVubmluZyA9IGZhbHNlOwor
CiAJcmV0dXJuIDA7CiB9CiAKQEAgLTEwNzQsNiArMTEwMCw3IEBAIHN0YXRpYyBpbnQgc3RhcnRf
Y3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0pCiAJZHFtX2xvY2soZHFtKTsK
IAkvKiBjbGVhciBoYW5nIHN0YXR1cyB3aGVuIGRyaXZlciB0cnkgdG8gc3RhcnQgdGhlIGh3IHNj
aGVkdWxlciAqLwogCWRxbS0+aXNfaHdzX2hhbmcgPSBmYWxzZTsKKwlkcW0tPnNjaGVkX3J1bm5p
bmcgPSB0cnVlOwogCWV4ZWN1dGVfcXVldWVzX2Nwc2NoKGRxbSwgS0ZEX1VOTUFQX1FVRVVFU19G
SUxURVJfRFlOQU1JQ19RVUVVRVMsIDApOwogCWRxbV91bmxvY2soZHFtKTsKIApAQCAtMTA4OSw2
ICsxMTE2LDcgQEAgc3RhdGljIGludCBzdG9wX2Nwc2NoKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFu
YWdlciAqZHFtKQogewogCWRxbV9sb2NrKGRxbSk7CiAJdW5tYXBfcXVldWVzX2Nwc2NoKGRxbSwg
S0ZEX1VOTUFQX1FVRVVFU19GSUxURVJfQUxMX1FVRVVFUywgMCk7CisJZHFtLT5zY2hlZF9ydW5u
aW5nID0gZmFsc2U7CiAJZHFtX3VubG9jayhkcW0pOwogCiAJa2ZkX2d0dF9zYV9mcmVlKGRxbS0+
ZGV2LCBkcW0tPmZlbmNlX21lbSk7CkBAIC0xMjc1LDkgKzEzMDMsMTAgQEAgc3RhdGljIGludCBt
YXBfcXVldWVzX2Nwc2NoKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtKQogewogCWlu
dCByZXR2YWw7CiAKKwlpZiAoIWRxbS0+c2NoZWRfcnVubmluZykKKwkJcmV0dXJuIDA7CiAJaWYg
KGRxbS0+cXVldWVfY291bnQgPD0gMCB8fCBkcW0tPnByb2Nlc3Nlc19jb3VudCA8PSAwKQogCQly
ZXR1cm4gMDsKLQogCWlmIChkcW0tPmFjdGl2ZV9ydW5saXN0KQogCQlyZXR1cm4gMDsKIApAQCAt
MTI5OSw2ICsxMzI4LDggQEAgc3RhdGljIGludCB1bm1hcF9xdWV1ZXNfY3BzY2goc3RydWN0IGRl
dmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sCiB7CiAJaW50IHJldHZhbCA9IDA7CiAKKwlpZiAoIWRx
bS0+c2NoZWRfcnVubmluZykKKwkJcmV0dXJuIDA7CiAJaWYgKGRxbS0+aXNfaHdzX2hhbmcpCiAJ
CXJldHVybiAtRUlPOwogCWlmICghZHFtLT5hY3RpdmVfcnVubGlzdCkKQEAgLTE5MDMsNiArMTkz
NCwxMiBAQCBpbnQgZHFtX2RlYnVnZnNfaHFkcyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRh
dGEpCiAJaW50IHBpcGUsIHF1ZXVlOwogCWludCByID0gMDsKIAorCWlmICghZHFtLT5zY2hlZF9y
dW5uaW5nKSB7CisJCXNlcV9wcmludGYobSwgIiBEZXZpY2UgaXMgc3RvcHBlZFxuIik7CisKKwkJ
cmV0dXJuIDA7CisJfQorCiAJciA9IGRxbS0+ZGV2LT5rZmQya2dkLT5ocWRfZHVtcChkcW0tPmRl
di0+a2dkLAogCQkJCQlLRkRfQ0lLX0hJUV9QSVBFLCBLRkRfQ0lLX0hJUV9RVUVVRSwKIAkJCQkJ
JmR1bXAsICZuX3JlZ3MpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQv
a2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2VyLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9r
ZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuaAppbmRleCAyZWFlYTZiMDRjYmUuLmE4YzM3ZTZkYTAy
NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1
ZV9tYW5hZ2VyLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9x
dWV1ZV9tYW5hZ2VyLmgKQEAgLTIwMSw2ICsyMDEsNyBAQCBzdHJ1Y3QgZGV2aWNlX3F1ZXVlX21h
bmFnZXIgewogCWJvb2wJCQlpc19od3NfaGFuZzsKIAlzdHJ1Y3Qgd29ya19zdHJ1Y3QJaHdfZXhj
ZXB0aW9uX3dvcms7CiAJc3RydWN0IGtmZF9tZW1fb2JqCWhpcV9zZG1hX21xZDsKKwlib29sCQkJ
c2NoZWRfcnVubmluZzsKIH07CiAKIHZvaWQgZGV2aWNlX3F1ZXVlX21hbmFnZXJfaW5pdF9jaWso
Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
