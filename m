Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C3C6769E45
	for <lists+amd-gfx@lfdr.de>; Mon, 15 Jul 2019 23:26:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2DD1189FF9;
	Mon, 15 Jul 2019 21:26:02 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x841.google.com (mail-qt1-x841.google.com
 [IPv6:2607:f8b0:4864:20::841])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2461389FEA
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 21:26:00 +0000 (UTC)
Received: by mail-qt1-x841.google.com with SMTP id z4so17290689qtc.3
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 14:26:00 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=1YOpQb0RWZ3qQVSsBUCiLDFisQiH4Jy8LCc8GhVfTzg=;
 b=t+FBvGLlhho6KCwX3W/rPujes1HNlWvGJ+vQfJgPaqChsHjQ3dJrUrcMDaZeoi8foo
 fnit4OJZQ+0BSL2He0vE0JsTV219VE7c5b4KcFxEDAZ4wxRBW22najbGnxSMpRQn8A1B
 jv5+sdk84AxHO2heWJn/t8rhXLcVc3qKEzS9nAALTVfXwokrz7e2BkR4z9y69DryfsZM
 gvVuZLhoOWqI/P0b+VWetMTs0MIgDMDWGVrQKZAzWsYMS11uk/Fp0u6lbGDYvg5mtqko
 bnburpmEdXxBx9jTDlZpdNndm+hAETk59gSiIcs7IQHclhYZKZPjl4uCg94dPQ/9M9kg
 0lFA==
X-Gm-Message-State: APjAAAVH0at7Dy5pnwb+IQXCAX2spc9Grbwqbe9/k5A6ssXEMqtOkBzQ
 3Y1tkFaFOQngZcaSoi/+p1NLP9DF
X-Google-Smtp-Source: APXvYqwVZIuqNPMDPEn3o4nmkkOF+qc2sYpyulxs4gbuitMxn5N9Z7jYJjB42CI42INoJLltkG1vOg==
X-Received: by 2002:ac8:7104:: with SMTP id z4mr19800013qto.52.1563225958071; 
 Mon, 15 Jul 2019 14:25:58 -0700 (PDT)
Received: from localhost.localdomain ([71.219.21.119])
 by smtp.gmail.com with ESMTPSA id q56sm10274133qtq.64.2019.07.15.14.25.56
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 15 Jul 2019 14:25:57 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 080/102] drm/amdgpu: modify amdgpu_vcn to support multiple
 instances
Date: Mon, 15 Jul 2019 16:24:15 -0500
Message-Id: <20190715212437.31793-78-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190715212437.31793-1-alexander.deucher@amd.com>
References: <20190715212437.31793-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=1YOpQb0RWZ3qQVSsBUCiLDFisQiH4Jy8LCc8GhVfTzg=;
 b=WGRnvZOmBf9yQ60PX7NP8tIGZaPkPI7hWMz0D2gi6zK0z9OSnq1ba2uMrlD6yNWymv
 4i0oygZdujuIVZr95QdUJGKb8W0oYHDcJdX0RiIBDvrk5azd5aZnFuUIOt4lwCR7lJIM
 AZm6ySf6EGugfmFPdqxEaPiSCBJ6J93AySnY60PST3ZnGDwY9bL2YtriXi4tOPq7i2qQ
 CAowL4YQ+XPDCwbg6ENhZyVN2v0GYC8Mo8lDarxkqONSYpi6G3/qiILrg2S94jYdBsVg
 e1aS2Tkx4kTTR19XxCoU5T9vt4VYrOb2dvqkyWF2QG3NMGnYIru1gPnKcipyH8zGzo0u
 G79g==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, James Zhu <James.Zhu@amd.com>,
 Leo Liu <leo.liu@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogSmFtZXMgWmh1IDxKYW1lcy5aaHVAYW1kLmNvbT4KCkFyY3R1cnVzIGhhcyBkdWFsLVZD
Ti4gTmVlZCBSZXN0cnVjdCBhbWRncHVfZGV2aWNlOjp2Y24gdG8gc3VwcG9ydAptdWx0aXBsZSB2
Y25zLiBUaGVyZSBhcmUgbm8gYW55IGxvZ2ljYWwgY2hhbmdlcyBoZXJlCgpTaWduZWQtb2ZmLWJ5
OiBKYW1lcyBaaHUgPEphbWVzLlpodUBhbWQuY29tPgpSZXZpZXdlZC1ieTogTGVvIExpdSA8bGVv
LmxpdUBhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBBbGV4IERldWNoZXIgPGFsZXhhbmRlci5kZXVj
aGVyQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2N0eC5j
IHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMgfCAgIDYg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92Y24uYyB8ICA2OCArKysrKysr
LS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92Y24uaCB8ICAyNCAr
KysrLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3Zjbl92MV8wLmMgICB8IDExMCArKysr
KysrKysrKystLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3Zjbl92Ml8w
LmMgICB8IDEwNiArKysrKysrKysrKy0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvdmNuX3YyXzUuYyAgIHwgIDg3ICsrKysrKysrKystLS0tLS0tLS0KIDcgZmlsZXMgY2hh
bmdlZCwgMjEwIGluc2VydGlvbnMoKyksIDE5NyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3R4LmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfY3R4LmMKaW5kZXggYTI4YTNkNzIyYmEyLi44NmNjMzA5MmE1ZTEg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jdHguYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3R4LmMKQEAgLTE1NSwxNSArMTU1
LDE1IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2N0eF9pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LAogCQkJbnVtX3JpbmdzID0gMTsKIAkJCWJyZWFrOwogCQljYXNlIEFNREdQVV9IV19JUF9W
Q05fREVDOgotCQkJcmluZ3NbMF0gPSAmYWRldi0+dmNuLnJpbmdfZGVjOworCQkJcmluZ3NbMF0g
PSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19kZWM7CiAJCQludW1fcmluZ3MgPSAxOwogCQkJYnJl
YWs7CiAJCWNhc2UgQU1ER1BVX0hXX0lQX1ZDTl9FTkM6Ci0JCQlyaW5nc1swXSA9ICZhZGV2LT52
Y24ucmluZ19lbmNbMF07CisJCQlyaW5nc1swXSA9ICZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2Vu
Y1swXTsKIAkJCW51bV9yaW5ncyA9IDE7CiAJCQlicmVhazsKIAkJY2FzZSBBTURHUFVfSFdfSVBf
VkNOX0pQRUc6Ci0JCQlyaW5nc1swXSA9ICZhZGV2LT52Y24ucmluZ19qcGVnOworCQkJcmluZ3Nb
MF0gPSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19qcGVnOwogCQkJbnVtX3JpbmdzID0gMTsKIAkJ
CWJyZWFrOwogCQl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfa21zLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMKaW5kZXgg
ZTJjOWQ4ZDMxZWQ4Li5iNTZkMGYxNWU0NTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9rbXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfa21zLmMKQEAgLTQwNSw3ICs0MDUsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9od19pcF9p
bmZvKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQlicmVhazsKIAljYXNlIEFNREdQVV9I
V19JUF9WQ05fREVDOgogCQl0eXBlID0gQU1EX0lQX0JMT0NLX1RZUEVfVkNOOwotCQlpZiAoYWRl
di0+dmNuLnJpbmdfZGVjLnNjaGVkLnJlYWR5KQorCQlpZiAoYWRldi0+dmNuLmluc3RbMF0ucmlu
Z19kZWMuc2NoZWQucmVhZHkpCiAJCQkrK251bV9yaW5nczsKIAkJaWJfc3RhcnRfYWxpZ25tZW50
ID0gMTY7CiAJCWliX3NpemVfYWxpZ25tZW50ID0gMTY7CkBAIC00MTMsMTQgKzQxMywxNCBAQCBz
dGF0aWMgaW50IGFtZGdwdV9od19pcF9pbmZvKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAog
CWNhc2UgQU1ER1BVX0hXX0lQX1ZDTl9FTkM6CiAJCXR5cGUgPSBBTURfSVBfQkxPQ0tfVFlQRV9W
Q047CiAJCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX2VuY19yaW5nczsgaSsrKQotCQkJ
aWYgKGFkZXYtPnZjbi5yaW5nX2VuY1tpXS5zY2hlZC5yZWFkeSkKKwkJCWlmIChhZGV2LT52Y24u
aW5zdFswXS5yaW5nX2VuY1tpXS5zY2hlZC5yZWFkeSkKIAkJCQkrK251bV9yaW5nczsKIAkJaWJf
c3RhcnRfYWxpZ25tZW50ID0gNjQ7CiAJCWliX3NpemVfYWxpZ25tZW50ID0gMTsKIAkJYnJlYWs7
CiAJY2FzZSBBTURHUFVfSFdfSVBfVkNOX0pQRUc6CiAJCXR5cGUgPSBBTURfSVBfQkxPQ0tfVFlQ
RV9WQ047Ci0JCWlmIChhZGV2LT52Y24ucmluZ19qcGVnLnNjaGVkLnJlYWR5KQorCQlpZiAoYWRl
di0+dmNuLmluc3RbMF0ucmluZ19qcGVnLnNjaGVkLnJlYWR5KQogCQkJKytudW1fcmluZ3M7CiAJ
CWliX3N0YXJ0X2FsaWdubWVudCA9IDE2OwogCQlpYl9zaXplX2FsaWdubWVudCA9IDE2OwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Zjbi5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Zjbi5jCmluZGV4IGJiMGQxZWY1MGM5Yy4uMzMw
ZjM1NWI5M2E5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dmNuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Zjbi5jCkBAIC0x
NDYsOCArMTQ2LDggQEAgaW50IGFtZGdwdV92Y25fc3dfaW5pdChzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldikKIAlpZiAoYWRldi0+ZmlybXdhcmUubG9hZF90eXBlICE9IEFNREdQVV9GV19MT0FE
X1BTUCkKIAkJYm9fc2l6ZSArPSBBTURHUFVfR1BVX1BBR0VfQUxJR04obGUzMl90b19jcHUoaGRy
LT51Y29kZV9zaXplX2J5dGVzKSArIDgpOwogCXIgPSBhbWRncHVfYm9fY3JlYXRlX2tlcm5lbChh
ZGV2LCBib19zaXplLCBQQUdFX1NJWkUsCi0JCQkJICAgIEFNREdQVV9HRU1fRE9NQUlOX1ZSQU0s
ICZhZGV2LT52Y24udmNwdV9ibywKLQkJCQkgICAgJmFkZXYtPnZjbi5ncHVfYWRkciwgJmFkZXYt
PnZjbi5jcHVfYWRkcik7CisJCQkJICAgIEFNREdQVV9HRU1fRE9NQUlOX1ZSQU0sICZhZGV2LT52
Y24uaW5zdFswXS52Y3B1X2JvLAorCQkJCSAgICAmYWRldi0+dmNuLmluc3RbMF0uZ3B1X2FkZHIs
ICZhZGV2LT52Y24uaW5zdFswXS5jcHVfYWRkcik7CiAJaWYgKHIpIHsKIAkJZGV2X2VycihhZGV2
LT5kZXYsICIoJWQpIGZhaWxlZCB0byBhbGxvY2F0ZSB2Y24gYm9cbiIsIHIpOwogCQlyZXR1cm4g
cjsKQEAgLTE3MCw3ICsxNzAsNyBAQCBpbnQgYW1kZ3B1X3Zjbl9zd19maW5pKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2KQogewogCWludCBpOwogCi0Ja3ZmcmVlKGFkZXYtPnZjbi5zYXZlZF9i
byk7CisJa3ZmcmVlKGFkZXYtPnZjbi5pbnN0WzBdLnNhdmVkX2JvKTsKIAogCWlmIChhZGV2LT52
Y24uaW5kaXJlY3Rfc3JhbSkgewogCQlhbWRncHVfYm9fZnJlZV9rZXJuZWwoJmFkZXYtPnZjbi5k
cGdfc3JhbV9ibywKQEAgLTE3OCwxNiArMTc4LDE2IEBAIGludCBhbWRncHVfdmNuX3N3X2Zpbmko
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCQkgICAgICAodm9pZCAqKikmYWRldi0+dmNu
LmRwZ19zcmFtX2NwdV9hZGRyKTsKIAl9CiAKLQlhbWRncHVfYm9fZnJlZV9rZXJuZWwoJmFkZXYt
PnZjbi52Y3B1X2JvLAotCQkJICAgICAgJmFkZXYtPnZjbi5ncHVfYWRkciwKLQkJCSAgICAgICh2
b2lkICoqKSZhZGV2LT52Y24uY3B1X2FkZHIpOworCWFtZGdwdV9ib19mcmVlX2tlcm5lbCgmYWRl
di0+dmNuLmluc3RbMF0udmNwdV9ibywKKwkJCSAgICAgICZhZGV2LT52Y24uaW5zdFswXS5ncHVf
YWRkciwKKwkJCSAgICAgICh2b2lkICoqKSZhZGV2LT52Y24uaW5zdFswXS5jcHVfYWRkcik7CiAK
LQlhbWRncHVfcmluZ19maW5pKCZhZGV2LT52Y24ucmluZ19kZWMpOworCWFtZGdwdV9yaW5nX2Zp
bmkoJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfZGVjKTsKIAogCWZvciAoaSA9IDA7IGkgPCBhZGV2
LT52Y24ubnVtX2VuY19yaW5nczsgKytpKQotCQlhbWRncHVfcmluZ19maW5pKCZhZGV2LT52Y24u
cmluZ19lbmNbaV0pOworCQlhbWRncHVfcmluZ19maW5pKCZhZGV2LT52Y24uaW5zdFswXS5yaW5n
X2VuY1tpXSk7CiAKLQlhbWRncHVfcmluZ19maW5pKCZhZGV2LT52Y24ucmluZ19qcGVnKTsKKwlh
bWRncHVfcmluZ19maW5pKCZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2pwZWcpOwogCiAJcmVsZWFz
ZV9maXJtd2FyZShhZGV2LT52Y24uZncpOwogCkBAIC0yMDEsMTcgKzIwMSwxNyBAQCBpbnQgYW1k
Z3B1X3Zjbl9zdXNwZW5kKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCiAJY2FuY2VsX2Rl
bGF5ZWRfd29ya19zeW5jKCZhZGV2LT52Y24uaWRsZV93b3JrKTsKIAotCWlmIChhZGV2LT52Y24u
dmNwdV9ibyA9PSBOVUxMKQorCWlmIChhZGV2LT52Y24uaW5zdFswXS52Y3B1X2JvID09IE5VTEwp
CiAJCXJldHVybiAwOwogCi0Jc2l6ZSA9IGFtZGdwdV9ib19zaXplKGFkZXYtPnZjbi52Y3B1X2Jv
KTsKLQlwdHIgPSBhZGV2LT52Y24uY3B1X2FkZHI7CisJc2l6ZSA9IGFtZGdwdV9ib19zaXplKGFk
ZXYtPnZjbi5pbnN0WzBdLnZjcHVfYm8pOworCXB0ciA9IGFkZXYtPnZjbi5pbnN0WzBdLmNwdV9h
ZGRyOwogCi0JYWRldi0+dmNuLnNhdmVkX2JvID0ga3ZtYWxsb2Moc2l6ZSwgR0ZQX0tFUk5FTCk7
Ci0JaWYgKCFhZGV2LT52Y24uc2F2ZWRfYm8pCisJYWRldi0+dmNuLmluc3RbMF0uc2F2ZWRfYm8g
PSBrdm1hbGxvYyhzaXplLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWFkZXYtPnZjbi5pbnN0WzBdLnNh
dmVkX2JvKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCW1lbWNweV9mcm9taW8oYWRldi0+dmNuLnNh
dmVkX2JvLCBwdHIsIHNpemUpOworCW1lbWNweV9mcm9taW8oYWRldi0+dmNuLmluc3RbMF0uc2F2
ZWRfYm8sIHB0ciwgc2l6ZSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTIyMSwxNiArMjIxLDE2IEBA
IGludCBhbWRncHVfdmNuX3Jlc3VtZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAl1bnNp
Z25lZCBzaXplOwogCXZvaWQgKnB0cjsKIAotCWlmIChhZGV2LT52Y24udmNwdV9ibyA9PSBOVUxM
KQorCWlmIChhZGV2LT52Y24uaW5zdFswXS52Y3B1X2JvID09IE5VTEwpCiAJCXJldHVybiAtRUlO
VkFMOwogCi0Jc2l6ZSA9IGFtZGdwdV9ib19zaXplKGFkZXYtPnZjbi52Y3B1X2JvKTsKLQlwdHIg
PSBhZGV2LT52Y24uY3B1X2FkZHI7CisJc2l6ZSA9IGFtZGdwdV9ib19zaXplKGFkZXYtPnZjbi5p
bnN0WzBdLnZjcHVfYm8pOworCXB0ciA9IGFkZXYtPnZjbi5pbnN0WzBdLmNwdV9hZGRyOwogCi0J
aWYgKGFkZXYtPnZjbi5zYXZlZF9ibyAhPSBOVUxMKSB7Ci0JCW1lbWNweV90b2lvKHB0ciwgYWRl
di0+dmNuLnNhdmVkX2JvLCBzaXplKTsKLQkJa3ZmcmVlKGFkZXYtPnZjbi5zYXZlZF9ibyk7Ci0J
CWFkZXYtPnZjbi5zYXZlZF9ibyA9IE5VTEw7CisJaWYgKGFkZXYtPnZjbi5pbnN0WzBdLnNhdmVk
X2JvICE9IE5VTEwpIHsKKwkJbWVtY3B5X3RvaW8ocHRyLCBhZGV2LT52Y24uaW5zdFswXS5zYXZl
ZF9ibywgc2l6ZSk7CisJCWt2ZnJlZShhZGV2LT52Y24uaW5zdFswXS5zYXZlZF9ibyk7CisJCWFk
ZXYtPnZjbi5pbnN0WzBdLnNhdmVkX2JvID0gTlVMTDsKIAl9IGVsc2UgewogCQljb25zdCBzdHJ1
Y3QgY29tbW9uX2Zpcm13YXJlX2hlYWRlciAqaGRyOwogCQl1bnNpZ25lZCBvZmZzZXQ7CkBAIC0y
MzgsNyArMjM4LDcgQEAgaW50IGFtZGdwdV92Y25fcmVzdW1lKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2KQogCQloZHIgPSAoY29uc3Qgc3RydWN0IGNvbW1vbl9maXJtd2FyZV9oZWFkZXIgKilh
ZGV2LT52Y24uZnctPmRhdGE7CiAJCWlmIChhZGV2LT5maXJtd2FyZS5sb2FkX3R5cGUgIT0gQU1E
R1BVX0ZXX0xPQURfUFNQKSB7CiAJCQlvZmZzZXQgPSBsZTMyX3RvX2NwdShoZHItPnVjb2RlX2Fy
cmF5X29mZnNldF9ieXRlcyk7Ci0JCQltZW1jcHlfdG9pbyhhZGV2LT52Y24uY3B1X2FkZHIsIGFk
ZXYtPnZjbi5mdy0+ZGF0YSArIG9mZnNldCwKKwkJCW1lbWNweV90b2lvKGFkZXYtPnZjbi5pbnN0
WzBdLmNwdV9hZGRyLCBhZGV2LT52Y24uZnctPmRhdGEgKyBvZmZzZXQsCiAJCQkJICAgIGxlMzJf
dG9fY3B1KGhkci0+dWNvZGVfc2l6ZV9ieXRlcykpOwogCQkJc2l6ZSAtPSBsZTMyX3RvX2NwdSho
ZHItPnVjb2RlX3NpemVfYnl0ZXMpOwogCQkJcHRyICs9IGxlMzJfdG9fY3B1KGhkci0+dWNvZGVf
c2l6ZV9ieXRlcyk7CkBAIC0yNTcsNyArMjU3LDcgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X3Zjbl9p
ZGxlX3dvcmtfaGFuZGxlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJdW5zaWduZWQgaW50
IGk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7ICsraSkgewot
CQlmZW5jZXMgKz0gYW1kZ3B1X2ZlbmNlX2NvdW50X2VtaXR0ZWQoJmFkZXYtPnZjbi5yaW5nX2Vu
Y1tpXSk7CisJCWZlbmNlcyArPSBhbWRncHVfZmVuY2VfY291bnRfZW1pdHRlZCgmYWRldi0+dmNu
Lmluc3RbMF0ucmluZ19lbmNbaV0pOwogCX0KIAogCWlmIChhZGV2LT5wZ19mbGFncyAmIEFNRF9Q
R19TVVBQT1JUX1ZDTl9EUEcpCXsKQEAgLTI2OCw3ICsyNjgsNyBAQCBzdGF0aWMgdm9pZCBhbWRn
cHVfdmNuX2lkbGVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkJZWxz
ZQogCQkJbmV3X3N0YXRlLmZ3X2Jhc2VkID0gVkNOX0RQR19TVEFURV9fVU5QQVVTRTsKIAotCQlp
ZiAoYW1kZ3B1X2ZlbmNlX2NvdW50X2VtaXR0ZWQoJmFkZXYtPnZjbi5yaW5nX2pwZWcpKQorCQlp
ZiAoYW1kZ3B1X2ZlbmNlX2NvdW50X2VtaXR0ZWQoJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfanBl
ZykpCiAJCQluZXdfc3RhdGUuanBlZyA9IFZDTl9EUEdfU1RBVEVfX1BBVVNFOwogCQllbHNlCiAJ
CQluZXdfc3RhdGUuanBlZyA9IFZDTl9EUEdfU1RBVEVfX1VOUEFVU0U7CkBAIC0yNzYsOCArMjc2
LDggQEAgc3RhdGljIHZvaWQgYW1kZ3B1X3Zjbl9pZGxlX3dvcmtfaGFuZGxlcihzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCiAJCWFkZXYtPnZjbi5wYXVzZV9kcGdfbW9kZShhZGV2LCAmbmV3X3N0
YXRlKTsKIAl9CiAKLQlmZW5jZXMgKz0gYW1kZ3B1X2ZlbmNlX2NvdW50X2VtaXR0ZWQoJmFkZXYt
PnZjbi5yaW5nX2pwZWcpOwotCWZlbmNlcyArPSBhbWRncHVfZmVuY2VfY291bnRfZW1pdHRlZCgm
YWRldi0+dmNuLnJpbmdfZGVjKTsKKwlmZW5jZXMgKz0gYW1kZ3B1X2ZlbmNlX2NvdW50X2VtaXR0
ZWQoJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfanBlZyk7CisJZmVuY2VzICs9IGFtZGdwdV9mZW5j
ZV9jb3VudF9lbWl0dGVkKCZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2RlYyk7CiAKIAlpZiAoZmVu
Y2VzID09IDApIHsKIAkJYW1kZ3B1X2dmeF9vZmZfY3RybChhZGV2LCB0cnVlKTsKQEAgLTMxMSwx
NCArMzExLDE0IEBAIHZvaWQgYW1kZ3B1X3Zjbl9yaW5nX2JlZ2luX3VzZShzdHJ1Y3QgYW1kZ3B1
X3JpbmcgKnJpbmcpCiAJCXVuc2lnbmVkIGludCBpOwogCiAJCWZvciAoaSA9IDA7IGkgPCBhZGV2
LT52Y24ubnVtX2VuY19yaW5nczsgKytpKSB7Ci0JCQlmZW5jZXMgKz0gYW1kZ3B1X2ZlbmNlX2Nv
dW50X2VtaXR0ZWQoJmFkZXYtPnZjbi5yaW5nX2VuY1tpXSk7CisJCQlmZW5jZXMgKz0gYW1kZ3B1
X2ZlbmNlX2NvdW50X2VtaXR0ZWQoJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfZW5jW2ldKTsKIAkJ
fQogCQlpZiAoZmVuY2VzKQogCQkJbmV3X3N0YXRlLmZ3X2Jhc2VkID0gVkNOX0RQR19TVEFURV9f
UEFVU0U7CiAJCWVsc2UKIAkJCW5ld19zdGF0ZS5md19iYXNlZCA9IFZDTl9EUEdfU1RBVEVfX1VO
UEFVU0U7CiAKLQkJaWYgKGFtZGdwdV9mZW5jZV9jb3VudF9lbWl0dGVkKCZhZGV2LT52Y24ucmlu
Z19qcGVnKSkKKwkJaWYgKGFtZGdwdV9mZW5jZV9jb3VudF9lbWl0dGVkKCZhZGV2LT52Y24uaW5z
dFswXS5yaW5nX2pwZWcpKQogCQkJbmV3X3N0YXRlLmpwZWcgPSBWQ05fRFBHX1NUQVRFX19QQVVT
RTsKIAkJZWxzZQogCQkJbmV3X3N0YXRlLmpwZWcgPSBWQ05fRFBHX1NUQVRFX19VTlBBVVNFOwpA
QCAtMzQ0LDcgKzM0NCw3IEBAIGludCBhbWRncHVfdmNuX2RlY19yaW5nX3Rlc3RfcmluZyhzdHJ1
Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCiAJdW5zaWduZWQgaTsKIAlpbnQgcjsKIAotCVdSRUczMihh
ZGV2LT52Y24uZXh0ZXJuYWwuc2NyYXRjaDksIDB4Q0FGRURFQUQpOworCVdSRUczMihhZGV2LT52
Y24uaW5zdFswXS5leHRlcm5hbC5zY3JhdGNoOSwgMHhDQUZFREVBRCk7CiAJciA9IGFtZGdwdV9y
aW5nX2FsbG9jKHJpbmcsIDMpOwogCWlmIChyKQogCQlyZXR1cm4gcjsKQEAgLTM1Miw3ICszNTIs
NyBAQCBpbnQgYW1kZ3B1X3Zjbl9kZWNfcmluZ190ZXN0X3Jpbmcoc3RydWN0IGFtZGdwdV9yaW5n
ICpyaW5nKQogCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIDB4REVBREJFRUYpOwogCWFtZGdwdV9y
aW5nX2NvbW1pdChyaW5nKTsKIAlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dXNlY190aW1lb3V0OyBp
KyspIHsKLQkJdG1wID0gUlJFRzMyKGFkZXYtPnZjbi5leHRlcm5hbC5zY3JhdGNoOSk7CisJCXRt
cCA9IFJSRUczMihhZGV2LT52Y24uaW5zdFswXS5leHRlcm5hbC5zY3JhdGNoOSk7CiAJCWlmICh0
bXAgPT0gMHhERUFEQkVFRikKIAkJCWJyZWFrOwogCQlEUk1fVURFTEFZKDEpOwpAQCAtNjYzLDcg
KzY2Myw3IEBAIGludCBhbWRncHVfdmNuX2pwZWdfcmluZ190ZXN0X3Jpbmcoc3RydWN0IGFtZGdw
dV9yaW5nICpyaW5nKQogCXVuc2lnbmVkIGk7CiAJaW50IHI7CiAKLQlXUkVHMzIoYWRldi0+dmNu
LmV4dGVybmFsLmpwZWdfcGl0Y2gsIDB4Q0FGRURFQUQpOworCVdSRUczMihhZGV2LT52Y24uaW5z
dFswXS5leHRlcm5hbC5qcGVnX3BpdGNoLCAweENBRkVERUFEKTsKIAlyID0gYW1kZ3B1X3Jpbmdf
YWxsb2MocmluZywgMyk7CiAJaWYgKHIpCiAJCXJldHVybiByOwpAQCAtNjczLDcgKzY3Myw3IEBA
IGludCBhbWRncHVfdmNuX2pwZWdfcmluZ190ZXN0X3Jpbmcoc3RydWN0IGFtZGdwdV9yaW5nICpy
aW5nKQogCWFtZGdwdV9yaW5nX2NvbW1pdChyaW5nKTsKIAogCWZvciAoaSA9IDA7IGkgPCBhZGV2
LT51c2VjX3RpbWVvdXQ7IGkrKykgewotCQl0bXAgPSBSUkVHMzIoYWRldi0+dmNuLmV4dGVybmFs
LmpwZWdfcGl0Y2gpOworCQl0bXAgPSBSUkVHMzIoYWRldi0+dmNuLmluc3RbMF0uZXh0ZXJuYWwu
anBlZ19waXRjaCk7CiAJCWlmICh0bXAgPT0gMHhERUFEQkVFRikKIAkJCWJyZWFrOwogCQlEUk1f
VURFTEFZKDEpOwpAQCAtNzQ3LDcgKzc0Nyw3IEBAIGludCBhbWRncHVfdmNuX2pwZWdfcmluZ190
ZXN0X2liKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgbG9uZyB0aW1lb3V0KQogCX0KIAogCWZv
ciAoaSA9IDA7IGkgPCBhZGV2LT51c2VjX3RpbWVvdXQ7IGkrKykgewotCQl0bXAgPSBSUkVHMzIo
YWRldi0+dmNuLmV4dGVybmFsLmpwZWdfcGl0Y2gpOworCQl0bXAgPSBSUkVHMzIoYWRldi0+dmNu
Lmluc3RbMF0uZXh0ZXJuYWwuanBlZ19waXRjaCk7CiAJCWlmICh0bXAgPT0gMHhERUFEQkVFRikK
IAkJCWJyZWFrOwogCQlEUk1fVURFTEFZKDEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3Zjbi5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3Zjbi5oCmluZGV4IGJmZDhjM2NlYTEzYS4uZDJmYzQ3YTk1NGFiIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmNuLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Zjbi5oCkBAIC0zMCw2ICszMCw4IEBACiAjZGVmaW5lIEFN
REdQVV9WQ05fRklSTVdBUkVfT0ZGU0VUCTI1NgogI2RlZmluZSBBTURHUFVfVkNOX01BWF9FTkNf
UklOR1MJMwogCisjZGVmaW5lIEFNREdQVV9NQVhfVkNOX0lOU1RBTkNFUwkyCisKICNkZWZpbmUg
VkNOX0RFQ19DTURfRkVOQ0UJCTB4MDAwMDAwMDAKICNkZWZpbmUgVkNOX0RFQ19DTURfVFJBUAkJ
MHgwMDAwMDAwMQogI2RlZmluZSBWQ05fREVDX0NNRF9XUklURV9SRUcJCTB4MDAwMDAwMDQKQEAg
LTE1NSwzMCArMTU3LDM4IEBAIHN0cnVjdCBhbWRncHVfdmNuX3JlZ3sKIAl1bnNpZ25lZAlqcGVn
X3BpdGNoOwogfTsKIAotc3RydWN0IGFtZGdwdV92Y24geworc3RydWN0IGFtZGdwdV92Y25faW5z
dCB7CiAJc3RydWN0IGFtZGdwdV9ibwkqdmNwdV9ibzsKIAl2b2lkCQkJKmNwdV9hZGRyOwogCXVp
bnQ2NF90CQlncHVfYWRkcjsKLQl1bnNpZ25lZAkJZndfdmVyc2lvbjsKIAl2b2lkCQkJKnNhdmVk
X2JvOwotCXN0cnVjdCBkZWxheWVkX3dvcmsJaWRsZV93b3JrOwotCWNvbnN0IHN0cnVjdCBmaXJt
d2FyZQkqZnc7CS8qIFZDTiBmaXJtd2FyZSAqLwogCXN0cnVjdCBhbWRncHVfcmluZwlyaW5nX2Rl
YzsKIAlzdHJ1Y3QgYW1kZ3B1X3JpbmcJcmluZ19lbmNbQU1ER1BVX1ZDTl9NQVhfRU5DX1JJTkdT
XTsKIAlzdHJ1Y3QgYW1kZ3B1X3JpbmcJcmluZ19qcGVnOwogCXN0cnVjdCBhbWRncHVfaXJxX3Ny
YwlpcnE7CisJc3RydWN0IGFtZGdwdV92Y25fcmVnCWV4dGVybmFsOworfTsKKworc3RydWN0IGFt
ZGdwdV92Y24geworCXVuc2lnbmVkCQlmd192ZXJzaW9uOworCXN0cnVjdCBkZWxheWVkX3dvcmsJ
aWRsZV93b3JrOworCWNvbnN0IHN0cnVjdCBmaXJtd2FyZQkqZnc7CS8qIFZDTiBmaXJtd2FyZSAq
LwogCXVuc2lnbmVkCQludW1fZW5jX3JpbmdzOwogCWVudW0gYW1kX3Bvd2VyZ2F0aW5nX3N0YXRl
IGN1cl9zdGF0ZTsKIAlzdHJ1Y3QgZHBnX3BhdXNlX3N0YXRlIHBhdXNlX3N0YXRlOwotCXN0cnVj
dCBhbWRncHVfdmNuX3JlZwlpbnRlcm5hbCwgZXh0ZXJuYWw7Ci0JaW50ICgqcGF1c2VfZHBnX21v
ZGUpKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAotCQlzdHJ1Y3QgZHBnX3BhdXNlX3N0YXRl
ICpuZXdfc3RhdGUpOwogCiAJYm9vbAkJCWluZGlyZWN0X3NyYW07CiAJc3RydWN0IGFtZGdwdV9i
bwkqZHBnX3NyYW1fYm87CiAJdm9pZAkJCSpkcGdfc3JhbV9jcHVfYWRkcjsKIAl1aW50NjRfdAkJ
ZHBnX3NyYW1fZ3B1X2FkZHI7CiAJdWludDMyX3QJCSpkcGdfc3JhbV9jdXJyX2FkZHI7CisKKwl1
aW50OF90CW51bV92Y25faW5zdDsKKwlzdHJ1Y3QgYW1kZ3B1X3Zjbl9pbnN0CWluc3RbQU1ER1BV
X01BWF9WQ05fSU5TVEFOQ0VTXTsKKwlzdHJ1Y3QgYW1kZ3B1X3Zjbl9yZWcJaW50ZXJuYWw7CisK
KwlpbnQgKCpwYXVzZV9kcGdfbW9kZSkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJCXN0
cnVjdCBkcGdfcGF1c2Vfc3RhdGUgKm5ld19zdGF0ZSk7CiB9OwogCiBpbnQgYW1kZ3B1X3Zjbl9z
d19pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L3Zjbl92MV8wLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS92Y25fdjFfMC5jCmluZGV4IDA5ZGM5Yzg3ZWJkMS4uMDdhMmYzNmVhN2NlIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS92Y25fdjFfMC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L3Zjbl92MV8wLmMKQEAgLTYzLDYgKzYzLDcgQEAgc3RhdGljIGludCB2
Y25fdjFfMF9lYXJseV9pbml0KHZvaWQgKmhhbmRsZSkKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWhhbmRsZTsKIAorCWFkZXYtPnZjbi5u
dW1fdmNuX2luc3QgPSAxOwogCWFkZXYtPnZjbi5udW1fZW5jX3JpbmdzID0gMjsKIAogCXZjbl92
MV8wX3NldF9kZWNfcmluZ19mdW5jcyhhZGV2KTsKQEAgLTg3LDIwICs4OCwyMSBAQCBzdGF0aWMg
aW50IHZjbl92MV8wX3N3X2luaXQodm9pZCAqaGFuZGxlKQogCXN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopaGFuZGxlOwogCiAJLyogVkNOIERFQyBU
UkFQICovCi0JciA9IGFtZGdwdV9pcnFfYWRkX2lkKGFkZXYsIFNPQzE1X0lIX0NMSUVOVElEX1ZD
TiwgVkNOXzFfMF9fU1JDSURfX1VWRF9TWVNURU1fTUVTU0FHRV9JTlRFUlJVUFQsICZhZGV2LT52
Y24uaXJxKTsKKwlyID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRldiwgU09DMTVfSUhfQ0xJRU5USURf
VkNOLAorCQkJVkNOXzFfMF9fU1JDSURfX1VWRF9TWVNURU1fTUVTU0FHRV9JTlRFUlJVUFQsICZh
ZGV2LT52Y24uaW5zdC0+aXJxKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKIAkvKiBWQ04gRU5D
IFRSQVAgKi8KIAlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7ICsraSkg
ewogCQlyID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRldiwgU09DMTVfSUhfQ0xJRU5USURfVkNOLCBp
ICsgVkNOXzFfMF9fU1JDSURfX1VWRF9FTkNfR0VORVJBTF9QVVJQT1NFLAotCQkJCQkmYWRldi0+
dmNuLmlycSk7CisJCQkJCSZhZGV2LT52Y24uaW5zdC0+aXJxKTsKIAkJaWYgKHIpCiAJCQlyZXR1
cm4gcjsKIAl9CiAKIAkvKiBWQ04gSlBFRyBUUkFQICovCi0JciA9IGFtZGdwdV9pcnFfYWRkX2lk
KGFkZXYsIFNPQzE1X0lIX0NMSUVOVElEX1ZDTiwgMTI2LCAmYWRldi0+dmNuLmlycSk7CisJciA9
IGFtZGdwdV9pcnFfYWRkX2lkKGFkZXYsIFNPQzE1X0lIX0NMSUVOVElEX1ZDTiwgMTI2LCAmYWRl
di0+dmNuLmluc3QtPmlycSk7CiAJaWYgKHIpCiAJCXJldHVybiByOwogCkBAIC0xMjIsMzkgKzEy
NCwzOSBAQCBzdGF0aWMgaW50IHZjbl92MV8wX3N3X2luaXQodm9pZCAqaGFuZGxlKQogCWlmIChy
KQogCQlyZXR1cm4gcjsKIAotCXJpbmcgPSAmYWRldi0+dmNuLnJpbmdfZGVjOworCXJpbmcgPSAm
YWRldi0+dmNuLmluc3QtPnJpbmdfZGVjOwogCXNwcmludGYocmluZy0+bmFtZSwgInZjbl9kZWMi
KTsKLQlyID0gYW1kZ3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaXJx
LCAwKTsKKwlyID0gYW1kZ3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24u
aW5zdC0+aXJxLCAwKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKLQlhZGV2LT52Y24uaW50ZXJu
YWwuc2NyYXRjaDkgPSBhZGV2LT52Y24uZXh0ZXJuYWwuc2NyYXRjaDkgPQorCWFkZXYtPnZjbi5p
bnRlcm5hbC5zY3JhdGNoOSA9IGFkZXYtPnZjbi5pbnN0LT5leHRlcm5hbC5zY3JhdGNoOSA9CiAJ
CVNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBtbVVWRF9TQ1JBVENIOSk7Ci0JYWRldi0+dmNuLmlu
dGVybmFsLmRhdGEwID0gYWRldi0+dmNuLmV4dGVybmFsLmRhdGEwID0KKwlhZGV2LT52Y24uaW50
ZXJuYWwuZGF0YTAgPSBhZGV2LT52Y24uaW5zdC0+ZXh0ZXJuYWwuZGF0YTAgPQogCQlTT0MxNV9S
RUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfR1BDT01fVkNQVV9EQVRBMCk7Ci0JYWRldi0+dmNuLmlu
dGVybmFsLmRhdGExID0gYWRldi0+dmNuLmV4dGVybmFsLmRhdGExID0KKwlhZGV2LT52Y24uaW50
ZXJuYWwuZGF0YTEgPSBhZGV2LT52Y24uaW5zdC0+ZXh0ZXJuYWwuZGF0YTEgPQogCQlTT0MxNV9S
RUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfR1BDT01fVkNQVV9EQVRBMSk7Ci0JYWRldi0+dmNuLmlu
dGVybmFsLmNtZCA9IGFkZXYtPnZjbi5leHRlcm5hbC5jbWQgPQorCWFkZXYtPnZjbi5pbnRlcm5h
bC5jbWQgPSBhZGV2LT52Y24uaW5zdC0+ZXh0ZXJuYWwuY21kID0KIAkJU09DMTVfUkVHX09GRlNF
VChVVkQsIDAsIG1tVVZEX0dQQ09NX1ZDUFVfQ01EKTsKLQlhZGV2LT52Y24uaW50ZXJuYWwubm9w
ID0gYWRldi0+dmNuLmV4dGVybmFsLm5vcCA9CisJYWRldi0+dmNuLmludGVybmFsLm5vcCA9IGFk
ZXYtPnZjbi5pbnN0LT5leHRlcm5hbC5ub3AgPQogCQlTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwg
bW1VVkRfTk9fT1ApOwogCiAJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fZW5jX3Jpbmdz
OyArK2kpIHsKLQkJcmluZyA9ICZhZGV2LT52Y24ucmluZ19lbmNbaV07CisJCXJpbmcgPSAmYWRl
di0+dmNuLmluc3QtPnJpbmdfZW5jW2ldOwogCQlzcHJpbnRmKHJpbmctPm5hbWUsICJ2Y25fZW5j
JWQiLCBpKTsKLQkJciA9IGFtZGdwdV9yaW5nX2luaXQoYWRldiwgcmluZywgNTEyLCAmYWRldi0+
dmNuLmlycSwgMCk7CisJCXIgPSBhbWRncHVfcmluZ19pbml0KGFkZXYsIHJpbmcsIDUxMiwgJmFk
ZXYtPnZjbi5pbnN0LT5pcnEsIDApOwogCQlpZiAocikKIAkJCXJldHVybiByOwogCX0KIAotCXJp
bmcgPSAmYWRldi0+dmNuLnJpbmdfanBlZzsKKwlyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5n
X2pwZWc7CiAJc3ByaW50ZihyaW5nLT5uYW1lLCAidmNuX2pwZWciKTsKLQlyID0gYW1kZ3B1X3Jp
bmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaXJxLCAwKTsKKwlyID0gYW1kZ3B1
X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaW5zdC0+aXJxLCAwKTsKIAlp
ZiAocikKIAkJcmV0dXJuIHI7CiAKIAlhZGV2LT52Y24ucGF1c2VfZHBnX21vZGUgPSB2Y25fdjFf
MF9wYXVzZV9kcGdfbW9kZTsKLQlhZGV2LT52Y24uaW50ZXJuYWwuanBlZ19waXRjaCA9IGFkZXYt
PnZjbi5leHRlcm5hbC5qcGVnX3BpdGNoID0KKwlhZGV2LT52Y24uaW50ZXJuYWwuanBlZ19waXRj
aCA9IGFkZXYtPnZjbi5pbnN0LT5leHRlcm5hbC5qcGVnX3BpdGNoID0KIAkJU09DMTVfUkVHX09G
RlNFVChVVkQsIDAsIG1tVVZEX0pQRUdfUElUQ0gpOwogCiAJcmV0dXJuIDA7CkBAIC0xOTEsNyAr
MTkzLDcgQEAgc3RhdGljIGludCB2Y25fdjFfMF9zd19maW5pKHZvaWQgKmhhbmRsZSkKIHN0YXRp
YyBpbnQgdmNuX3YxXzBfaHdfaW5pdCh2b2lkICpoYW5kbGUpCiB7CiAJc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKiloYW5kbGU7Ci0Jc3RydWN0IGFt
ZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPnZjbi5yaW5nX2RlYzsKKwlzdHJ1Y3QgYW1kZ3B1X3Jp
bmcgKnJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJpbmdfZGVjOwogCWludCBpLCByOwogCiAJciA9
IGFtZGdwdV9yaW5nX3Rlc3RfaGVscGVyKHJpbmcpOwpAQCAtMTk5LDE0ICsyMDEsMTQgQEAgc3Rh
dGljIGludCB2Y25fdjFfMF9od19pbml0KHZvaWQgKmhhbmRsZSkKIAkJZ290byBkb25lOwogCiAJ
Zm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fZW5jX3JpbmdzOyArK2kpIHsKLQkJcmluZyA9
ICZhZGV2LT52Y24ucmluZ19lbmNbaV07CisJCXJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJpbmdf
ZW5jW2ldOwogCQlyaW5nLT5zY2hlZC5yZWFkeSA9IHRydWU7CiAJCXIgPSBhbWRncHVfcmluZ190
ZXN0X2hlbHBlcihyaW5nKTsKIAkJaWYgKHIpCiAJCQlnb3RvIGRvbmU7CiAJfQogCi0JcmluZyA9
ICZhZGV2LT52Y24ucmluZ19qcGVnOworCXJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJpbmdfanBl
ZzsKIAlyID0gYW1kZ3B1X3JpbmdfdGVzdF9oZWxwZXIocmluZyk7CiAJaWYgKHIpCiAJCWdvdG8g
ZG9uZTsKQEAgLTIyOSw3ICsyMzEsNyBAQCBzdGF0aWMgaW50IHZjbl92MV8wX2h3X2luaXQodm9p
ZCAqaGFuZGxlKQogc3RhdGljIGludCB2Y25fdjFfMF9od19maW5pKHZvaWQgKmhhbmRsZSkKIHsK
IAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWhh
bmRsZTsKLQlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcgPSAmYWRldi0+dmNuLnJpbmdfZGVjOwor
CXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24uaW5zdC0+cmluZ19kZWM7CiAK
IAlpZiAoKGFkZXYtPnBnX2ZsYWdzICYgQU1EX1BHX1NVUFBPUlRfVkNOX0RQRykgfHwKIAkJUlJF
RzMyX1NPQzE1KFZDTiwgMCwgbW1VVkRfU1RBVFVTKSkKQEAgLTMwNCw5ICszMDYsOSBAQCBzdGF0
aWMgdm9pZCB2Y25fdjFfMF9tY19yZXN1bWVfc3BnX21vZGUoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYpCiAJCW9mZnNldCA9IDA7CiAJfSBlbHNlIHsKIAkJV1JFRzMyX1NPQzE1KFVWRCwgMCwg
bW1VVkRfTE1JX1ZDUFVfQ0FDSEVfNjRCSVRfQkFSX0xPVywKLQkJCWxvd2VyXzMyX2JpdHMoYWRl
di0+dmNuLmdwdV9hZGRyKSk7CisJCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0LT5ncHVf
YWRkcikpOwogCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9MTUlfVkNQVV9DQUNIRV82NEJJ
VF9CQVJfSElHSCwKLQkJCXVwcGVyXzMyX2JpdHMoYWRldi0+dmNuLmdwdV9hZGRyKSk7CisJCQl1
cHBlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0LT5ncHVfYWRkcikpOwogCQlvZmZzZXQgPSBzaXpl
OwogCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX09GRlNFVDAsCiAJCQkg
ICAgIEFNREdQVV9VVkRfRklSTVdBUkVfT0ZGU0VUID4+IDMpOwpAQCAtMzE2LDE3ICszMTgsMTcg
QEAgc3RhdGljIHZvaWQgdmNuX3YxXzBfbWNfcmVzdW1lX3NwZ19tb2RlKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2KQogCiAJLyogY2FjaGUgd2luZG93IDE6IHN0YWNrICovCiAJV1JFRzMyX1NP
QzE1KFVWRCwgMCwgbW1VVkRfTE1JX1ZDUFVfQ0FDSEUxXzY0QklUX0JBUl9MT1csCi0JCSAgICAg
bG93ZXJfMzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIgKyBvZmZzZXQpKTsKKwkJICAgICBsb3dl
cl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0LT5ncHVfYWRkciArIG9mZnNldCkpOwogCVdSRUczMl9T
T0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMV82NEJJVF9CQVJfSElHSCwKLQkJICAg
ICB1cHBlcl8zMl9iaXRzKGFkZXYtPnZjbi5ncHVfYWRkciArIG9mZnNldCkpOworCQkgICAgIHVw
cGVyXzMyX2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRyICsgb2Zmc2V0KSk7CiAJV1JFRzMy
X1NPQzE1KFVWRCwgMCwgbW1VVkRfVkNQVV9DQUNIRV9PRkZTRVQxLCAwKTsKIAlXUkVHMzJfU09D
MTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX1NJWkUxLCBBTURHUFVfVkNOX1NUQUNLX1NJWkUp
OwogCiAJLyogY2FjaGUgd2luZG93IDI6IGNvbnRleHQgKi8KIAlXUkVHMzJfU09DMTUoVVZELCAw
LCBtbVVWRF9MTUlfVkNQVV9DQUNIRTJfNjRCSVRfQkFSX0xPVywKLQkJICAgICBsb3dlcl8zMl9i
aXRzKGFkZXYtPnZjbi5ncHVfYWRkciArIG9mZnNldCArIEFNREdQVV9WQ05fU1RBQ0tfU0laRSkp
OworCQkgICAgIGxvd2VyXzMyX2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRyICsgb2Zmc2V0
ICsgQU1ER1BVX1ZDTl9TVEFDS19TSVpFKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRf
TE1JX1ZDUFVfQ0FDSEUyXzY0QklUX0JBUl9ISUdILAotCQkgICAgIHVwcGVyXzMyX2JpdHMoYWRl
di0+dmNuLmdwdV9hZGRyICsgb2Zmc2V0ICsgQU1ER1BVX1ZDTl9TVEFDS19TSVpFKSk7CisJCSAg
ICAgdXBwZXJfMzJfYml0cyhhZGV2LT52Y24uaW5zdC0+Z3B1X2FkZHIgKyBvZmZzZXQgKyBBTURH
UFVfVkNOX1NUQUNLX1NJWkUpKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NB
Q0hFX09GRlNFVDIsIDApOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1ZDUFVfQ0FDSEVf
U0laRTIsIEFNREdQVV9WQ05fQ09OVEVYVF9TSVpFKTsKIApAQCAtMzc0LDkgKzM3Niw5IEBAIHN0
YXRpYyB2b2lkIHZjbl92MV8wX21jX3Jlc3VtZV9kcGdfbW9kZShzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldikKIAkJb2Zmc2V0ID0gMDsKIAl9IGVsc2UgewogCQlXUkVHMzJfU09DMTVfRFBHX01P
REUoVVZELCAwLCBtbVVWRF9MTUlfVkNQVV9DQUNIRV82NEJJVF9CQVJfTE9XLAotCQkJbG93ZXJf
MzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIpLCAweEZGRkZGRkZGLCAwKTsKKwkJCWxvd2VyXzMy
X2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRyKSwgMHhGRkZGRkZGRiwgMCk7CiAJCVdSRUcz
Ml9TT0MxNV9EUEdfTU9ERShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFXzY0QklUX0JBUl9I
SUdILAotCQkJdXBwZXJfMzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIpLCAweEZGRkZGRkZGLCAw
KTsKKwkJCXVwcGVyXzMyX2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRyKSwgMHhGRkZGRkZG
RiwgMCk7CiAJCW9mZnNldCA9IHNpemU7CiAJCVdSRUczMl9TT0MxNV9EUEdfTU9ERShVVkQsIDAs
IG1tVVZEX1ZDUFVfQ0FDSEVfT0ZGU0VUMCwKIAkJCSAgICAgQU1ER1BVX1VWRF9GSVJNV0FSRV9P
RkZTRVQgPj4gMywgMHhGRkZGRkZGRiwgMCk7CkBAIC0zODYsOSArMzg4LDkgQEAgc3RhdGljIHZv
aWQgdmNuX3YxXzBfbWNfcmVzdW1lX2RwZ19tb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KQogCiAJLyogY2FjaGUgd2luZG93IDE6IHN0YWNrICovCiAJV1JFRzMyX1NPQzE1X0RQR19NT0RF
KFVWRCwgMCwgbW1VVkRfTE1JX1ZDUFVfQ0FDSEUxXzY0QklUX0JBUl9MT1csCi0JCSAgICAgbG93
ZXJfMzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIgKyBvZmZzZXQpLCAweEZGRkZGRkZGLCAwKTsK
KwkJICAgICBsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0LT5ncHVfYWRkciArIG9mZnNldCks
IDB4RkZGRkZGRkYsIDApOwogCVdSRUczMl9TT0MxNV9EUEdfTU9ERShVVkQsIDAsIG1tVVZEX0xN
SV9WQ1BVX0NBQ0hFMV82NEJJVF9CQVJfSElHSCwKLQkJICAgICB1cHBlcl8zMl9iaXRzKGFkZXYt
PnZjbi5ncHVfYWRkciArIG9mZnNldCksIDB4RkZGRkZGRkYsIDApOworCQkgICAgIHVwcGVyXzMy
X2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRyICsgb2Zmc2V0KSwgMHhGRkZGRkZGRiwgMCk7
CiAJV1JFRzMyX1NPQzE1X0RQR19NT0RFKFVWRCwgMCwgbW1VVkRfVkNQVV9DQUNIRV9PRkZTRVQx
LCAwLAogCQkJICAgICAweEZGRkZGRkZGLCAwKTsKIAlXUkVHMzJfU09DMTVfRFBHX01PREUoVVZE
LCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX1NJWkUxLCBBTURHUFVfVkNOX1NUQUNLX1NJWkUsCkBAIC0z
OTYsMTAgKzM5OCwxMCBAQCBzdGF0aWMgdm9pZCB2Y25fdjFfMF9tY19yZXN1bWVfZHBnX21vZGUo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAKIAkvKiBjYWNoZSB3aW5kb3cgMjogY29udGV4
dCAqLwogCVdSRUczMl9TT0MxNV9EUEdfTU9ERShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hF
Ml82NEJJVF9CQVJfTE9XLAotCQkgICAgIGxvd2VyXzMyX2JpdHMoYWRldi0+dmNuLmdwdV9hZGRy
ICsgb2Zmc2V0ICsgQU1ER1BVX1ZDTl9TVEFDS19TSVpFKSwKKwkJICAgICBsb3dlcl8zMl9iaXRz
KGFkZXYtPnZjbi5pbnN0LT5ncHVfYWRkciArIG9mZnNldCArIEFNREdQVV9WQ05fU1RBQ0tfU0la
RSksCiAJCQkgICAgIDB4RkZGRkZGRkYsIDApOwogCVdSRUczMl9TT0MxNV9EUEdfTU9ERShVVkQs
IDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMl82NEJJVF9CQVJfSElHSCwKLQkJICAgICB1cHBlcl8z
Ml9iaXRzKGFkZXYtPnZjbi5ncHVfYWRkciArIG9mZnNldCArIEFNREdQVV9WQ05fU1RBQ0tfU0la
RSksCisJCSAgICAgdXBwZXJfMzJfYml0cyhhZGV2LT52Y24uaW5zdC0+Z3B1X2FkZHIgKyBvZmZz
ZXQgKyBBTURHUFVfVkNOX1NUQUNLX1NJWkUpLAogCQkJICAgICAweEZGRkZGRkZGLCAwKTsKIAlX
UkVHMzJfU09DMTVfRFBHX01PREUoVVZELCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX09GRlNFVDIsIDAs
IDB4RkZGRkZGRkYsIDApOwogCVdSRUczMl9TT0MxNV9EUEdfTU9ERShVVkQsIDAsIG1tVVZEX1ZD
UFVfQ0FDSEVfU0laRTIsIEFNREdQVV9WQ05fQ09OVEVYVF9TSVpFLApAQCAtNzc5LDcgKzc4MSw3
IEBAIHN0YXRpYyB2b2lkIHZjbl8xXzBfZW5hYmxlX3N0YXRpY19wb3dlcl9nYXRpbmcoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAgKi8KIHN0YXRpYyBpbnQgdmNuX3YxXzBfc3RhcnRfc3Bn
X21vZGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7Ci0Jc3RydWN0IGFtZGdwdV9yaW5n
ICpyaW5nID0gJmFkZXYtPnZjbi5yaW5nX2RlYzsKKwlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcg
PSAmYWRldi0+dmNuLmluc3QtPnJpbmdfZGVjOwogCXVpbnQzMl90IHJiX2J1ZnN6LCB0bXA7CiAJ
dWludDMyX3QgbG1pX3N3YXBfY250bDsKIAlpbnQgaSwgaiwgcjsKQEAgLTkzMiwyMSArOTM0LDIx
IEBAIHN0YXRpYyBpbnQgdmNuX3YxXzBfc3RhcnRfc3BnX21vZGUoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYpCiAJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQsIDAsIG1tVVZEX1JCQ19S
Ql9DTlRMKSwgMCwKIAkJCX5VVkRfUkJDX1JCX0NOVExfX1JCX05PX0ZFVENIX01BU0spOwogCi0J
cmluZyA9ICZhZGV2LT52Y24ucmluZ19lbmNbMF07CisJcmluZyA9ICZhZGV2LT52Y24uaW5zdC0+
cmluZ19lbmNbMF07CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfUlBUUiwgbG93ZXJf
MzJfYml0cyhyaW5nLT53cHRyKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfV1BU
UiwgbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1V
VkRfUkJfQkFTRV9MTywgcmluZy0+Z3B1X2FkZHIpOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1t
VVZEX1JCX0JBU0VfSEksIHVwcGVyXzMyX2JpdHMocmluZy0+Z3B1X2FkZHIpKTsKIAlXUkVHMzJf
U09DMTUoVVZELCAwLCBtbVVWRF9SQl9TSVpFLCByaW5nLT5yaW5nX3NpemUgLyA0KTsKIAotCXJp
bmcgPSAmYWRldi0+dmNuLnJpbmdfZW5jWzFdOworCXJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJp
bmdfZW5jWzFdOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX1JQVFIyLCBsb3dlcl8z
Ml9iaXRzKHJpbmctPndwdHIpKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9XUFRS
MiwgbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1V
VkRfUkJfQkFTRV9MTzIsIHJpbmctPmdwdV9hZGRyKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBt
bVVWRF9SQl9CQVNFX0hJMiwgdXBwZXJfMzJfYml0cyhyaW5nLT5ncHVfYWRkcikpOwogCVdSRUcz
Ml9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX1NJWkUyLCByaW5nLT5yaW5nX3NpemUgLyA0KTsKIAot
CXJpbmcgPSAmYWRldi0+dmNuLnJpbmdfanBlZzsKKwlyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5y
aW5nX2pwZWc7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfTE1JX0pSQkNfUkJfVk1JRCwg
MCk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfSlJCQ19SQl9DTlRMLCBVVkRfSlJCQ19S
Ql9DTlRMX19SQl9OT19GRVRDSF9NQVNLIHwKIAkJCVVWRF9KUkJDX1JCX0NOVExfX1JCX1JQVFJf
V1JfRU5fTUFTSyk7CkBAIC05NjgsNyArOTcwLDcgQEAgc3RhdGljIGludCB2Y25fdjFfMF9zdGFy
dF9zcGdfbW9kZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAogc3RhdGljIGludCB2Y25f
djFfMF9zdGFydF9kcGdfbW9kZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKLQlzdHJ1
Y3QgYW1kZ3B1X3JpbmcgKnJpbmcgPSAmYWRldi0+dmNuLnJpbmdfZGVjOworCXN0cnVjdCBhbWRn
cHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24uaW5zdC0+cmluZ19kZWM7CiAJdWludDMyX3QgcmJf
YnVmc3osIHRtcDsKIAl1aW50MzJfdCBsbWlfc3dhcF9jbnRsOwogCkBAIC0xMTA2LDcgKzExMDgs
NyBAQCBzdGF0aWMgaW50IHZjbl92MV8wX3N0YXJ0X2RwZ19tb2RlKHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2KQogCQkJflVWRF9SQkNfUkJfQ05UTF9fUkJfTk9fRkVUQ0hfTUFTSyk7CiAKIAkv
KiBpbml0aWFsaXplIEpQRUcgd3B0ciAqLwotCXJpbmcgPSAmYWRldi0+dmNuLnJpbmdfanBlZzsK
KwlyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5nX2pwZWc7CiAJcmluZy0+d3B0ciA9IFJSRUcz
Ml9TT0MxNShVVkQsIDAsIG1tVVZEX0pSQkNfUkJfV1BUUik7CiAKIAkvKiBjb3B5IHBhdGNoIGNv
bW1hbmRzIHRvIHRoZSBqcGVnIHJpbmcgKi8KQEAgLTEyNTUsMjEgKzEyNTcsMjEgQEAgc3RhdGlj
IGludCB2Y25fdjFfMF9wYXVzZV9kcGdfbW9kZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwK
IAkJCQkJCSAgIFVWRF9EUEdfUEFVU0VfX05KX1BBVVNFX0RQR19BQ0tfTUFTSywgcmV0X2NvZGUp
OwogCiAJCQkJLyogUmVzdG9yZSAqLwotCQkJCXJpbmcgPSAmYWRldi0+dmNuLnJpbmdfZW5jWzBd
OworCQkJCXJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJpbmdfZW5jWzBdOwogCQkJCVdSRUczMl9T
T0MxNShVVkQsIDAsIG1tVVZEX1JCX0JBU0VfTE8sIHJpbmctPmdwdV9hZGRyKTsKIAkJCQlXUkVH
MzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9CQVNFX0hJLCB1cHBlcl8zMl9iaXRzKHJpbmctPmdw
dV9hZGRyKSk7CiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfU0laRSwgcmluZy0+
cmluZ19zaXplIC8gNCk7CiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfUlBUUiwg
bG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1V
VkRfUkJfV1BUUiwgbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAKLQkJCQlyaW5nID0gJmFk
ZXYtPnZjbi5yaW5nX2VuY1sxXTsKKwkJCQlyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5nX2Vu
Y1sxXTsKIAkJCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9CQVNFX0xPMiwgcmluZy0+
Z3B1X2FkZHIpOwogCQkJCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX0JBU0VfSEkyLCB1
cHBlcl8zMl9iaXRzKHJpbmctPmdwdV9hZGRyKSk7CiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwg
bW1VVkRfUkJfU0laRTIsIHJpbmctPnJpbmdfc2l6ZSAvIDQpOwogCQkJCVdSRUczMl9TT0MxNShV
VkQsIDAsIG1tVVZEX1JCX1JQVFIyLCBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpKTsKIAkJCQlX
UkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9XUFRSMiwgbG93ZXJfMzJfYml0cyhyaW5nLT53
cHRyKSk7CiAKLQkJCQlyaW5nID0gJmFkZXYtPnZjbi5yaW5nX2RlYzsKKwkJCQlyaW5nID0gJmFk
ZXYtPnZjbi5pbnN0LT5yaW5nX2RlYzsKIAkJCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9S
QkNfUkJfV1BUUiwKIAkJCQkJCSAgIFJSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1NDUkFUQ0gy
KSAmIDB4N0ZGRkZGRkYpOwogCQkJCVNPQzE1X1dBSVRfT05fUlJFRyhVVkQsIDAsIG1tVVZEX1BP
V0VSX1NUQVRVUywKQEAgLTEzMTUsNyArMTMxNyw3IEBAIHN0YXRpYyBpbnQgdmNuX3YxXzBfcGF1
c2VfZHBnX21vZGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkJCQkJVVZEX0RQR19Q
QVVTRV9fSlBFR19QQVVTRV9EUEdfQUNLX01BU0ssIHJldF9jb2RlKTsKIAogCQkJCS8qIFJlc3Rv
cmUgKi8KLQkJCQlyaW5nID0gJmFkZXYtPnZjbi5yaW5nX2pwZWc7CisJCQkJcmluZyA9ICZhZGV2
LT52Y24uaW5zdC0+cmluZ19qcGVnOwogCQkJCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0xN
SV9KUkJDX1JCX1ZNSUQsIDApOwogCQkJCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0pSQkNf
UkJfQ05UTCwKIAkJCQkJCQlVVkRfSlJCQ19SQl9DTlRMX19SQl9OT19GRVRDSF9NQVNLIHwKQEAg
LTEzMjksNyArMTMzMSw3IEBAIHN0YXRpYyBpbnQgdmNuX3YxXzBfcGF1c2VfZHBnX21vZGUoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRf
SlJCQ19SQl9DTlRMLAogCQkJCQkJCVVWRF9KUkJDX1JCX0NOVExfX1JCX1JQVFJfV1JfRU5fTUFT
Syk7CiAKLQkJCQlyaW5nID0gJmFkZXYtPnZjbi5yaW5nX2RlYzsKKwkJCQlyaW5nID0gJmFkZXYt
PnZjbi5pbnN0LT5yaW5nX2RlYzsKIAkJCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQkNf
UkJfV1BUUiwKIAkJCQkJCSAgIFJSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1NDUkFUQ0gyKSAm
IDB4N0ZGRkZGRkYpOwogCQkJCVNPQzE1X1dBSVRfT05fUlJFRyhVVkQsIDAsIG1tVVZEX1BPV0VS
X1NUQVRVUywKQEAgLTE1OTYsNyArMTU5OCw3IEBAIHN0YXRpYyB1aW50NjRfdCB2Y25fdjFfMF9l
bmNfcmluZ19nZXRfcnB0cihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCiB7CiAJc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5nLT5hZGV2OwogCi0JaWYgKHJpbmcgPT0gJmFkZXYtPnZj
bi5yaW5nX2VuY1swXSkKKwlpZiAocmluZyA9PSAmYWRldi0+dmNuLmluc3QtPnJpbmdfZW5jWzBd
KQogCQlyZXR1cm4gUlJFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfUlBUUik7CiAJZWxzZQog
CQlyZXR1cm4gUlJFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfUlBUUjIpOwpAQCAtMTYxMyw3
ICsxNjE1LDcgQEAgc3RhdGljIHVpbnQ2NF90IHZjbl92MV8wX2VuY19yaW5nX2dldF93cHRyKHN0
cnVjdCBhbWRncHVfcmluZyAqcmluZykKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9
IHJpbmctPmFkZXY7CiAKLQlpZiAocmluZyA9PSAmYWRldi0+dmNuLnJpbmdfZW5jWzBdKQorCWlm
IChyaW5nID09ICZhZGV2LT52Y24uaW5zdC0+cmluZ19lbmNbMF0pCiAJCXJldHVybiBSUkVHMzJf
U09DMTUoVVZELCAwLCBtbVVWRF9SQl9XUFRSKTsKIAllbHNlCiAJCXJldHVybiBSUkVHMzJfU09D
MTUoVVZELCAwLCBtbVVWRF9SQl9XUFRSMik7CkBAIC0xNjMwLDcgKzE2MzIsNyBAQCBzdGF0aWMg
dm9pZCB2Y25fdjFfMF9lbmNfcmluZ19zZXRfd3B0cihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcp
CiB7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5nLT5hZGV2OwogCi0JaWYgKHJp
bmcgPT0gJmFkZXYtPnZjbi5yaW5nX2VuY1swXSkKKwlpZiAocmluZyA9PSAmYWRldi0+dmNuLmlu
c3QtPnJpbmdfZW5jWzBdKQogCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9XUFRSLAog
CQkJbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJZWxzZQpAQCAtMjExNCwxNiArMjExNiwx
NiBAQCBzdGF0aWMgaW50IHZjbl92MV8wX3Byb2Nlc3NfaW50ZXJydXB0KHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LAogCiAJc3dpdGNoIChlbnRyeS0+c3JjX2lkKSB7CiAJY2FzZSAxMjQ6Ci0J
CWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2LT52Y24ucmluZ19kZWMpOworCQlhbWRncHVfZmVu
Y2VfcHJvY2VzcygmYWRldi0+dmNuLmluc3QtPnJpbmdfZGVjKTsKIAkJYnJlYWs7CiAJY2FzZSAx
MTk6Ci0JCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2LT52Y24ucmluZ19lbmNbMF0pOworCQlh
bWRncHVfZmVuY2VfcHJvY2VzcygmYWRldi0+dmNuLmluc3QtPnJpbmdfZW5jWzBdKTsKIAkJYnJl
YWs7CiAJY2FzZSAxMjA6Ci0JCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2LT52Y24ucmluZ19l
bmNbMV0pOworCQlhbWRncHVfZmVuY2VfcHJvY2VzcygmYWRldi0+dmNuLmluc3QtPnJpbmdfZW5j
WzFdKTsKIAkJYnJlYWs7CiAJY2FzZSAxMjY6Ci0JCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2
LT52Y24ucmluZ19qcGVnKTsKKwkJYW1kZ3B1X2ZlbmNlX3Byb2Nlc3MoJmFkZXYtPnZjbi5pbnN0
LT5yaW5nX2pwZWcpOwogCQlicmVhazsKIAlkZWZhdWx0OgogCQlEUk1fRVJST1IoIlVuaGFuZGxl
ZCBpbnRlcnJ1cHQ6ICVkICVkXG4iLApAQCAtMjI5NSw3ICsyMjk3LDcgQEAgc3RhdGljIGNvbnN0
IHN0cnVjdCBhbWRncHVfcmluZ19mdW5jcyB2Y25fdjFfMF9qcGVnX3Jpbmdfdm1fZnVuY3MgPSB7
CiAKIHN0YXRpYyB2b2lkIHZjbl92MV8wX3NldF9kZWNfcmluZ19mdW5jcyhzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldikKIHsKLQlhZGV2LT52Y24ucmluZ19kZWMuZnVuY3MgPSAmdmNuX3YxXzBf
ZGVjX3Jpbmdfdm1fZnVuY3M7CisJYWRldi0+dmNuLmluc3QtPnJpbmdfZGVjLmZ1bmNzID0gJnZj
bl92MV8wX2RlY19yaW5nX3ZtX2Z1bmNzOwogCURSTV9JTkZPKCJWQ04gZGVjb2RlIGlzIGVuYWJs
ZWQgaW4gVk0gbW9kZVxuIik7CiB9CiAKQEAgLTIzMDQsMTQgKzIzMDYsMTQgQEAgc3RhdGljIHZv
aWQgdmNuX3YxXzBfc2V0X2VuY19yaW5nX2Z1bmNzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KQogCWludCBpOwogCiAJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fZW5jX3JpbmdzOyAr
K2kpCi0JCWFkZXYtPnZjbi5yaW5nX2VuY1tpXS5mdW5jcyA9ICZ2Y25fdjFfMF9lbmNfcmluZ192
bV9mdW5jczsKKwkJYWRldi0+dmNuLmluc3QtPnJpbmdfZW5jW2ldLmZ1bmNzID0gJnZjbl92MV8w
X2VuY19yaW5nX3ZtX2Z1bmNzOwogCiAJRFJNX0lORk8oIlZDTiBlbmNvZGUgaXMgZW5hYmxlZCBp
biBWTSBtb2RlXG4iKTsKIH0KIAogc3RhdGljIHZvaWQgdmNuX3YxXzBfc2V0X2pwZWdfcmluZ19m
dW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKLQlhZGV2LT52Y24ucmluZ19qcGVn
LmZ1bmNzID0gJnZjbl92MV8wX2pwZWdfcmluZ192bV9mdW5jczsKKwlhZGV2LT52Y24uaW5zdC0+
cmluZ19qcGVnLmZ1bmNzID0gJnZjbl92MV8wX2pwZWdfcmluZ192bV9mdW5jczsKIAlEUk1fSU5G
TygiVkNOIGpwZWcgZGVjb2RlIGlzIGVuYWJsZWQgaW4gVk0gbW9kZVxuIik7CiB9CiAKQEAgLTIz
MjIsOCArMjMyNCw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgYW1kZ3B1X2lycV9zcmNfZnVuY3Mg
dmNuX3YxXzBfaXJxX2Z1bmNzID0gewogCiBzdGF0aWMgdm9pZCB2Y25fdjFfMF9zZXRfaXJxX2Z1
bmNzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogewotCWFkZXYtPnZjbi5pcnEubnVtX3R5
cGVzID0gYWRldi0+dmNuLm51bV9lbmNfcmluZ3MgKyAyOwotCWFkZXYtPnZjbi5pcnEuZnVuY3Mg
PSAmdmNuX3YxXzBfaXJxX2Z1bmNzOworCWFkZXYtPnZjbi5pbnN0LT5pcnEubnVtX3R5cGVzID0g
YWRldi0+dmNuLm51bV9lbmNfcmluZ3MgKyAyOworCWFkZXYtPnZjbi5pbnN0LT5pcnEuZnVuY3Mg
PSAmdmNuX3YxXzBfaXJxX2Z1bmNzOwogfQogCiBjb25zdCBzdHJ1Y3QgYW1kZ3B1X2lwX2Jsb2Nr
X3ZlcnNpb24gdmNuX3YxXzBfaXBfYmxvY2sgPQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvdmNuX3YyXzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3Zjbl92
Ml8wLmMKaW5kZXggMmI3YmI2MzY0ZTVhLi4zY2I2MmU0NDhhMzcgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3Zjbl92Ml8wLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvdmNuX3YyXzAuYwpAQCAtOTIsNiArOTIsNyBAQCBzdGF0aWMgaW50IHZjbl92Ml8w
X2Vhcmx5X2luaXQodm9pZCAqaGFuZGxlKQogewogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopaGFuZGxlOwogCisJYWRldi0+dmNuLm51bV92Y25f
aW5zdCA9IDE7CiAJYWRldi0+dmNuLm51bV9lbmNfcmluZ3MgPSAyOwogCiAJdmNuX3YyXzBfc2V0
X2RlY19yaW5nX2Z1bmNzKGFkZXYpOwpAQCAtMTE4LDcgKzExOSw3IEBAIHN0YXRpYyBpbnQgdmNu
X3YyXzBfc3dfaW5pdCh2b2lkICpoYW5kbGUpCiAJLyogVkNOIERFQyBUUkFQICovCiAJciA9IGFt
ZGdwdV9pcnFfYWRkX2lkKGFkZXYsIFNPQzE1X0lIX0NMSUVOVElEX1ZDTiwKIAkJCSAgICAgIFZD
Tl8yXzBfX1NSQ0lEX19VVkRfU1lTVEVNX01FU1NBR0VfSU5URVJSVVBULAotCQkJICAgICAgJmFk
ZXYtPnZjbi5pcnEpOworCQkJICAgICAgJmFkZXYtPnZjbi5pbnN0LT5pcnEpOwogCWlmIChyKQog
CQlyZXR1cm4gcjsKIApAQCAtMTI2LDE1ICsxMjcsMTQgQEAgc3RhdGljIGludCB2Y25fdjJfMF9z
d19pbml0KHZvaWQgKmhhbmRsZSkKIAlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNf
cmluZ3M7ICsraSkgewogCQlyID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRldiwgU09DMTVfSUhfQ0xJ
RU5USURfVkNOLAogCQkJCSAgICAgIGkgKyBWQ05fMl8wX19TUkNJRF9fVVZEX0VOQ19HRU5FUkFM
X1BVUlBPU0UsCi0JCQkJICAgICAgJmFkZXYtPnZjbi5pcnEpOworCQkJCSAgICAgICZhZGV2LT52
Y24uaW5zdC0+aXJxKTsKIAkJaWYgKHIpCiAJCQlyZXR1cm4gcjsKIAl9CiAKIAkvKiBWQ04gSlBF
RyBUUkFQICovCiAJciA9IGFtZGdwdV9pcnFfYWRkX2lkKGFkZXYsIFNPQzE1X0lIX0NMSUVOVElE
X1ZDTiwKLQkJCSAgICAgIFZDTl8yXzBfX1NSQ0lEX19KUEVHX0RFQ09ERSwKLQkJCSAgICAgICZh
ZGV2LT52Y24uaXJxKTsKKwkJCSAgICAgIFZDTl8yXzBfX1NSQ0lEX19KUEVHX0RFQ09ERSwgJmFk
ZXYtPnZjbi5pbnN0LT5pcnEpOwogCWlmIChyKQogCQlyZXR1cm4gcjsKIApAQCAtMTU2LDEzICsx
NTYsMTMgQEAgc3RhdGljIGludCB2Y25fdjJfMF9zd19pbml0KHZvaWQgKmhhbmRsZSkKIAlpZiAo
cikKIAkJcmV0dXJuIHI7CiAKLQlyaW5nID0gJmFkZXYtPnZjbi5yaW5nX2RlYzsKKwlyaW5nID0g
JmFkZXYtPnZjbi5pbnN0LT5yaW5nX2RlYzsKIAogCXJpbmctPnVzZV9kb29yYmVsbCA9IHRydWU7
CiAJcmluZy0+ZG9vcmJlbGxfaW5kZXggPSBhZGV2LT5kb29yYmVsbF9pbmRleC52Y24udmNuX3Jp
bmcwXzEgPDwgMTsKIAogCXNwcmludGYocmluZy0+bmFtZSwgInZjbl9kZWMiKTsKLQlyID0gYW1k
Z3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaXJxLCAwKTsKKwlyID0g
YW1kZ3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaW5zdC0+aXJxLCAw
KTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKQEAgLTE3NCwzOCArMTc0LDM4IEBAIHN0YXRpYyBp
bnQgdmNuX3YyXzBfc3dfaW5pdCh2b2lkICpoYW5kbGUpCiAJYWRldi0+dmNuLmludGVybmFsLmdw
X3NjcmF0Y2g4ID0gbW1VVkRfR1BfU0NSQVRDSDhfSU5URVJOQUxfT0ZGU0VUOwogCiAJYWRldi0+
dmNuLmludGVybmFsLnNjcmF0Y2g5ID0gbW1VVkRfU0NSQVRDSDlfSU5URVJOQUxfT0ZGU0VUOwot
CWFkZXYtPnZjbi5leHRlcm5hbC5zY3JhdGNoOSA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBt
bVVWRF9TQ1JBVENIOSk7CisJYWRldi0+dmNuLmluc3QtPmV4dGVybmFsLnNjcmF0Y2g5ID0gU09D
MTVfUkVHX09GRlNFVChVVkQsIDAsIG1tVVZEX1NDUkFUQ0g5KTsKIAlhZGV2LT52Y24uaW50ZXJu
YWwuZGF0YTAgPSBtbVVWRF9HUENPTV9WQ1BVX0RBVEEwX0lOVEVSTkFMX09GRlNFVDsKLQlhZGV2
LT52Y24uZXh0ZXJuYWwuZGF0YTAgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfR1BD
T01fVkNQVV9EQVRBMCk7CisJYWRldi0+dmNuLmluc3QtPmV4dGVybmFsLmRhdGEwID0gU09DMTVf
UkVHX09GRlNFVChVVkQsIDAsIG1tVVZEX0dQQ09NX1ZDUFVfREFUQTApOwogCWFkZXYtPnZjbi5p
bnRlcm5hbC5kYXRhMSA9IG1tVVZEX0dQQ09NX1ZDUFVfREFUQTFfSU5URVJOQUxfT0ZGU0VUOwot
CWFkZXYtPnZjbi5leHRlcm5hbC5kYXRhMSA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBtbVVW
RF9HUENPTV9WQ1BVX0RBVEExKTsKKwlhZGV2LT52Y24uaW5zdC0+ZXh0ZXJuYWwuZGF0YTEgPSBT
T0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfR1BDT01fVkNQVV9EQVRBMSk7CiAJYWRldi0+
dmNuLmludGVybmFsLmNtZCA9IG1tVVZEX0dQQ09NX1ZDUFVfQ01EX0lOVEVSTkFMX09GRlNFVDsK
LQlhZGV2LT52Y24uZXh0ZXJuYWwuY21kID0gU09DMTVfUkVHX09GRlNFVChVVkQsIDAsIG1tVVZE
X0dQQ09NX1ZDUFVfQ01EKTsKKwlhZGV2LT52Y24uaW5zdC0+ZXh0ZXJuYWwuY21kID0gU09DMTVf
UkVHX09GRlNFVChVVkQsIDAsIG1tVVZEX0dQQ09NX1ZDUFVfQ01EKTsKIAlhZGV2LT52Y24uaW50
ZXJuYWwubm9wID0gbW1VVkRfTk9fT1BfSU5URVJOQUxfT0ZGU0VUOwotCWFkZXYtPnZjbi5leHRl
cm5hbC5ub3AgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfTk9fT1ApOworCWFkZXYt
PnZjbi5pbnN0LT5leHRlcm5hbC5ub3AgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRf
Tk9fT1ApOwogCiAJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fZW5jX3JpbmdzOyArK2kp
IHsKLQkJcmluZyA9ICZhZGV2LT52Y24ucmluZ19lbmNbaV07CisJCXJpbmcgPSAmYWRldi0+dmNu
Lmluc3QtPnJpbmdfZW5jW2ldOwogCQlyaW5nLT51c2VfZG9vcmJlbGwgPSB0cnVlOwogCQlyaW5n
LT5kb29yYmVsbF9pbmRleCA9IChhZGV2LT5kb29yYmVsbF9pbmRleC52Y24udmNuX3JpbmcwXzEg
PDwgMSkgKyAyICsgaTsKIAkJc3ByaW50ZihyaW5nLT5uYW1lLCAidmNuX2VuYyVkIiwgaSk7Ci0J
CXIgPSBhbWRncHVfcmluZ19pbml0KGFkZXYsIHJpbmcsIDUxMiwgJmFkZXYtPnZjbi5pcnEsIDAp
OworCQlyID0gYW1kZ3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaW5z
dC0+aXJxLCAwKTsKIAkJaWYgKHIpCiAJCQlyZXR1cm4gcjsKIAl9CiAKLQlyaW5nID0gJmFkZXYt
PnZjbi5yaW5nX2pwZWc7CisJcmluZyA9ICZhZGV2LT52Y24uaW5zdC0+cmluZ19qcGVnOwogCXJp
bmctPnVzZV9kb29yYmVsbCA9IHRydWU7CiAJcmluZy0+ZG9vcmJlbGxfaW5kZXggPSAoYWRldi0+
ZG9vcmJlbGxfaW5kZXgudmNuLnZjbl9yaW5nMF8xIDw8IDEpICsgMTsKIAlzcHJpbnRmKHJpbmct
Pm5hbWUsICJ2Y25fanBlZyIpOwotCXIgPSBhbWRncHVfcmluZ19pbml0KGFkZXYsIHJpbmcsIDUx
MiwgJmFkZXYtPnZjbi5pcnEsIDApOworCXIgPSBhbWRncHVfcmluZ19pbml0KGFkZXYsIHJpbmcs
IDUxMiwgJmFkZXYtPnZjbi5pbnN0LT5pcnEsIDApOwogCWlmIChyKQogCQlyZXR1cm4gcjsKIAog
CWFkZXYtPnZjbi5wYXVzZV9kcGdfbW9kZSA9IHZjbl92Ml8wX3BhdXNlX2RwZ19tb2RlOwogCiAJ
YWRldi0+dmNuLmludGVybmFsLmpwZWdfcGl0Y2ggPSBtbVVWRF9KUEVHX1BJVENIX0lOVEVSTkFM
X09GRlNFVDsKLQlhZGV2LT52Y24uZXh0ZXJuYWwuanBlZ19waXRjaCA9IFNPQzE1X1JFR19PRkZT
RVQoVVZELCAwLCBtbVVWRF9KUEVHX1BJVENIKTsKKwlhZGV2LT52Y24uaW5zdC0+ZXh0ZXJuYWwu
anBlZ19waXRjaCA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBtbVVWRF9KUEVHX1BJVENIKTsK
IAogCXJldHVybiAwOwogfQpAQCAtMjQxLDcgKzI0MSw3IEBAIHN0YXRpYyBpbnQgdmNuX3YyXzBf
c3dfZmluaSh2b2lkICpoYW5kbGUpCiBzdGF0aWMgaW50IHZjbl92Ml8wX2h3X2luaXQodm9pZCAq
aGFuZGxlKQogewogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICopaGFuZGxlOwotCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24u
cmluZ19kZWM7CisJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5y
aW5nX2RlYzsKIAlpbnQgaSwgcjsKIAogCWFkZXYtPm5iaW9fZnVuY3MtPnZjbl9kb29yYmVsbF9y
YW5nZShhZGV2LCByaW5nLT51c2VfZG9vcmJlbGwsCkBAIC0yNTUsNyArMjU1LDcgQEAgc3RhdGlj
IGludCB2Y25fdjJfMF9od19pbml0KHZvaWQgKmhhbmRsZSkKIAl9CiAKIAlmb3IgKGkgPSAwOyBp
IDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7ICsraSkgewotCQlyaW5nID0gJmFkZXYtPnZjbi5y
aW5nX2VuY1tpXTsKKwkJcmluZyA9ICZhZGV2LT52Y24uaW5zdC0+cmluZ19lbmNbaV07CiAJCXJp
bmctPnNjaGVkLnJlYWR5ID0gdHJ1ZTsKIAkJciA9IGFtZGdwdV9yaW5nX3Rlc3RfcmluZyhyaW5n
KTsKIAkJaWYgKHIpIHsKQEAgLTI2NCw3ICsyNjQsNyBAQCBzdGF0aWMgaW50IHZjbl92Ml8wX2h3
X2luaXQodm9pZCAqaGFuZGxlKQogCQl9CiAJfQogCi0JcmluZyA9ICZhZGV2LT52Y24ucmluZ19q
cGVnOworCXJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJpbmdfanBlZzsKIAlyaW5nLT5zY2hlZC5y
ZWFkeSA9IHRydWU7CiAJciA9IGFtZGdwdV9yaW5nX3Rlc3RfcmluZyhyaW5nKTsKIAlpZiAocikg
ewpAQCAtMjkwLDcgKzI5MCw3IEBAIHN0YXRpYyBpbnQgdmNuX3YyXzBfaHdfaW5pdCh2b2lkICpo
YW5kbGUpCiBzdGF0aWMgaW50IHZjbl92Ml8wX2h3X2Zpbmkodm9pZCAqaGFuZGxlKQogewogCXN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopaGFuZGxl
OwotCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24ucmluZ19kZWM7CisJc3Ry
dWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5nX2RlYzsKIAlpbnQg
aTsKIAogCWlmICgoYWRldi0+cGdfZmxhZ3MgJiBBTURfUEdfU1VQUE9SVF9WQ05fRFBHKSB8fApA
QCAtMzAxLDExICszMDEsMTEgQEAgc3RhdGljIGludCB2Y25fdjJfMF9od19maW5pKHZvaWQgKmhh
bmRsZSkKIAlyaW5nLT5zY2hlZC5yZWFkeSA9IGZhbHNlOwogCiAJZm9yIChpID0gMDsgaSA8IGFk
ZXYtPnZjbi5udW1fZW5jX3JpbmdzOyArK2kpIHsKLQkJcmluZyA9ICZhZGV2LT52Y24ucmluZ19l
bmNbaV07CisJCXJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJpbmdfZW5jW2ldOwogCQlyaW5nLT5z
Y2hlZC5yZWFkeSA9IGZhbHNlOwogCX0KIAotCXJpbmcgPSAmYWRldi0+dmNuLnJpbmdfanBlZzsK
KwlyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5nX2pwZWc7CiAJcmluZy0+c2NoZWQucmVhZHkg
PSBmYWxzZTsKIAogCXJldHVybiAwOwpAQCAtMzc1LDkgKzM3NSw5IEBAIHN0YXRpYyB2b2lkIHZj
bl92Ml8wX21jX3Jlc3VtZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAkJb2Zmc2V0ID0g
MDsKIAl9IGVsc2UgewogCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9MTUlfVkNQVV9DQUNI
RV82NEJJVF9CQVJfTE9XLAotCQkJbG93ZXJfMzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIpKTsK
KwkJCWxvd2VyXzMyX2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRyKSk7CiAJCVdSRUczMl9T
T0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFXzY0QklUX0JBUl9ISUdILAotCQkJdXBw
ZXJfMzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIpKTsKKwkJCXVwcGVyXzMyX2JpdHMoYWRldi0+
dmNuLmluc3QtPmdwdV9hZGRyKSk7CiAJCW9mZnNldCA9IHNpemU7CiAJCS8qIE5vIHNpZ25lZCBo
ZWFkZXIgZm9yIG5vdyBmcm9tIGZpcm13YXJlCiAJCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZE
X1ZDUFVfQ0FDSEVfT0ZGU0VUMCwKQEAgLTM5MCwxNyArMzkwLDE3IEBAIHN0YXRpYyB2b2lkIHZj
bl92Ml8wX21jX3Jlc3VtZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAogCS8qIGNhY2hl
IHdpbmRvdyAxOiBzdGFjayAqLwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BV
X0NBQ0hFMV82NEJJVF9CQVJfTE9XLAotCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5ncHVfYWRk
ciArIG9mZnNldCkpOworCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0LT5ncHVfYWRkciAr
IG9mZnNldCkpOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMV82
NEJJVF9CQVJfSElHSCwKLQkJdXBwZXJfMzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIgKyBvZmZz
ZXQpKTsKKwkJdXBwZXJfMzJfYml0cyhhZGV2LT52Y24uaW5zdC0+Z3B1X2FkZHIgKyBvZmZzZXQp
KTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX09GRlNFVDEsIDApOwog
CVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1ZDUFVfQ0FDSEVfU0laRTEsIEFNREdQVV9WQ05f
U1RBQ0tfU0laRSk7CiAKIAkvKiBjYWNoZSB3aW5kb3cgMjogY29udGV4dCAqLwogCVdSRUczMl9T
T0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMl82NEJJVF9CQVJfTE9XLAotCQlsb3dl
cl8zMl9iaXRzKGFkZXYtPnZjbi5ncHVfYWRkciArIG9mZnNldCArIEFNREdQVV9WQ05fU1RBQ0tf
U0laRSkpOworCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0LT5ncHVfYWRkciArIG9mZnNl
dCArIEFNREdQVV9WQ05fU1RBQ0tfU0laRSkpOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZE
X0xNSV9WQ1BVX0NBQ0hFMl82NEJJVF9CQVJfSElHSCwKLQkJdXBwZXJfMzJfYml0cyhhZGV2LT52
Y24uZ3B1X2FkZHIgKyBvZmZzZXQgKyBBTURHUFVfVkNOX1NUQUNLX1NJWkUpKTsKKwkJdXBwZXJf
MzJfYml0cyhhZGV2LT52Y24uaW5zdC0+Z3B1X2FkZHIgKyBvZmZzZXQgKyBBTURHUFVfVkNOX1NU
QUNLX1NJWkUpKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX09GRlNF
VDIsIDApOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1ZDUFVfQ0FDSEVfU0laRTIsIEFN
REdQVV9WQ05fQ09OVEVYVF9TSVpFKTsKIApAQCAtNDM2LDEwICs0MzYsMTAgQEAgc3RhdGljIHZv
aWQgdmNuX3YyXzBfbWNfcmVzdW1lX2RwZ19tb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
LCBib29sIGluZGlyZWMKIAl9IGVsc2UgewogCQlXUkVHMzJfU09DMTVfRFBHX01PREVfMl8wKFNP
QzE1X0RQR19NT0RFX09GRlNFVF8yXzAoCiAJCQlVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hF
XzY0QklUX0JBUl9MT1cpLAotCQkJbG93ZXJfMzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIpLCAw
LCBpbmRpcmVjdCk7CisJCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0LT5ncHVfYWRkciks
IDAsIGluZGlyZWN0KTsKIAkJV1JFRzMyX1NPQzE1X0RQR19NT0RFXzJfMChTT0MxNV9EUEdfTU9E
RV9PRkZTRVRfMl8wKAogCQkJVVZELCAwLCBtbVVWRF9MTUlfVkNQVV9DQUNIRV82NEJJVF9CQVJf
SElHSCksCi0JCQl1cHBlcl8zMl9iaXRzKGFkZXYtPnZjbi5ncHVfYWRkciksIDAsIGluZGlyZWN0
KTsKKwkJCXVwcGVyXzMyX2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRyKSwgMCwgaW5kaXJl
Y3QpOwogCQlvZmZzZXQgPSBzaXplOwogCQlXUkVHMzJfU09DMTVfRFBHX01PREVfMl8wKFNPQzE1
X0RQR19NT0RFX09GRlNFVF8yXzAoCiAJCQlVVkQsIDAsIG1tVVZEX1ZDUFVfQ0FDSEVfT0ZGU0VU
MCksCkBAIC00NTcsMTAgKzQ1NywxMCBAQCBzdGF0aWMgdm9pZCB2Y25fdjJfMF9tY19yZXN1bWVf
ZHBnX21vZGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGJvb2wgaW5kaXJlYwogCWlmICgh
aW5kaXJlY3QpIHsKIAkJV1JFRzMyX1NPQzE1X0RQR19NT0RFXzJfMChTT0MxNV9EUEdfTU9ERV9P
RkZTRVRfMl8wKAogCQkJVVZELCAwLCBtbVVWRF9MTUlfVkNQVV9DQUNIRTFfNjRCSVRfQkFSX0xP
VyksCi0JCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5ncHVfYWRkciArIG9mZnNldCksIDAsIGlu
ZGlyZWN0KTsKKwkJCWxvd2VyXzMyX2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRyICsgb2Zm
c2V0KSwgMCwgaW5kaXJlY3QpOwogCQlXUkVHMzJfU09DMTVfRFBHX01PREVfMl8wKFNPQzE1X0RQ
R19NT0RFX09GRlNFVF8yXzAoCiAJCQlVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMV82NEJJ
VF9CQVJfSElHSCksCi0JCQl1cHBlcl8zMl9iaXRzKGFkZXYtPnZjbi5ncHVfYWRkciArIG9mZnNl
dCksIDAsIGluZGlyZWN0KTsKKwkJCXVwcGVyXzMyX2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9h
ZGRyICsgb2Zmc2V0KSwgMCwgaW5kaXJlY3QpOwogCQlXUkVHMzJfU09DMTVfRFBHX01PREVfMl8w
KFNPQzE1X0RQR19NT0RFX09GRlNFVF8yXzAoCiAJCQlVVkQsIDAsIG1tVVZEX1ZDUFVfQ0FDSEVf
T0ZGU0VUMSksIDAsIDAsIGluZGlyZWN0KTsKIAl9IGVsc2UgewpAQCAtNDc3LDEwICs0NzcsMTAg
QEAgc3RhdGljIHZvaWQgdmNuX3YyXzBfbWNfcmVzdW1lX2RwZ19tb2RlKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LCBib29sIGluZGlyZWMKIAkvKiBjYWNoZSB3aW5kb3cgMjogY29udGV4dCAq
LwogCVdSRUczMl9TT0MxNV9EUEdfTU9ERV8yXzAoU09DMTVfRFBHX01PREVfT0ZGU0VUXzJfMCgK
IAkJVVZELCAwLCBtbVVWRF9MTUlfVkNQVV9DQUNIRTJfNjRCSVRfQkFSX0xPVyksCi0JCWxvd2Vy
XzMyX2JpdHMoYWRldi0+dmNuLmdwdV9hZGRyICsgb2Zmc2V0ICsgQU1ER1BVX1ZDTl9TVEFDS19T
SVpFKSwgMCwgaW5kaXJlY3QpOworCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0LT5ncHVf
YWRkciArIG9mZnNldCArIEFNREdQVV9WQ05fU1RBQ0tfU0laRSksIDAsIGluZGlyZWN0KTsKIAlX
UkVHMzJfU09DMTVfRFBHX01PREVfMl8wKFNPQzE1X0RQR19NT0RFX09GRlNFVF8yXzAoCiAJCVVW
RCwgMCwgbW1VVkRfTE1JX1ZDUFVfQ0FDSEUyXzY0QklUX0JBUl9ISUdIKSwKLQkJdXBwZXJfMzJf
Yml0cyhhZGV2LT52Y24uZ3B1X2FkZHIgKyBvZmZzZXQgKyBBTURHUFVfVkNOX1NUQUNLX1NJWkUp
LCAwLCBpbmRpcmVjdCk7CisJCXVwcGVyXzMyX2JpdHMoYWRldi0+dmNuLmluc3QtPmdwdV9hZGRy
ICsgb2Zmc2V0ICsgQU1ER1BVX1ZDTl9TVEFDS19TSVpFKSwgMCwgaW5kaXJlY3QpOwogCVdSRUcz
Ml9TT0MxNV9EUEdfTU9ERV8yXzAoU09DMTVfRFBHX01PREVfT0ZGU0VUXzJfMCgKIAkJVVZELCAw
LCBtbVVWRF9WQ1BVX0NBQ0hFX09GRlNFVDIpLCAwLCAwLCBpbmRpcmVjdCk7CiAJV1JFRzMyX1NP
QzE1X0RQR19NT0RFXzJfMChTT0MxNV9EUEdfTU9ERV9PRkZTRVRfMl8wKApAQCAtNjY4LDcgKzY2
OCw3IEBAIHN0YXRpYyB2b2lkIHZjbl92Ml8wX2Nsb2NrX2dhdGluZ19kcGdfbW9kZShzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldiwKICAqLwogc3RhdGljIGludCBqcGVnX3YyXzBfc3RhcnQoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7Ci0Jc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0g
JmFkZXYtPnZjbi5yaW5nX2pwZWc7CisJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYt
PnZjbi5pbnN0LT5yaW5nX2pwZWc7CiAJdWludDMyX3QgdG1wOwogCWludCByID0gMDsKIApAQCAt
OTMwLDcgKzkzMCw3IEBAIHN0YXRpYyB2b2lkIHZjbl92Ml8wX2VuYWJsZV9zdGF0aWNfcG93ZXJf
Z2F0aW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCiBzdGF0aWMgaW50IHZjbl92Ml8w
X3N0YXJ0X2RwZ19tb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBib29sIGluZGlyZWN0
KQogewotCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24ucmluZ19kZWM7CisJ
c3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5nX2RlYzsKIAl1
aW50MzJfdCByYl9idWZzeiwgdG1wOwogCiAJdmNuX3YyXzBfZW5hYmxlX3N0YXRpY19wb3dlcl9n
YXRpbmcoYWRldik7CkBAIC0xMDU2LDcgKzEwNTYsNyBAQCBzdGF0aWMgaW50IHZjbl92Ml8wX3N0
YXJ0X2RwZ19tb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBib29sIGluZGlyZWN0KQog
CiBzdGF0aWMgaW50IHZjbl92Ml8wX3N0YXJ0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQog
ewotCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24ucmluZ19kZWM7CisJc3Ry
dWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5nX2RlYzsKIAl1aW50
MzJfdCByYl9idWZzeiwgdG1wOwogCXVpbnQzMl90IGxtaV9zd2FwX2NudGw7CiAJaW50IGksIGos
IHI7CkBAIC0xMjA3LDE0ICsxMjA3LDE0IEBAIHN0YXRpYyBpbnQgdmNuX3YyXzBfc3RhcnQoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJD
X1JCX1dQVFIsCiAJCQlsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpKTsKIAotCXJpbmcgPSAmYWRl
di0+dmNuLnJpbmdfZW5jWzBdOworCXJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJpbmdfZW5jWzBd
OwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX1JQVFIsIGxvd2VyXzMyX2JpdHMocmlu
Zy0+d3B0cikpOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX1dQVFIsIGxvd2VyXzMy
X2JpdHMocmluZy0+d3B0cikpOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX0JBU0Vf
TE8sIHJpbmctPmdwdV9hZGRyKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9CQVNF
X0hJLCB1cHBlcl8zMl9iaXRzKHJpbmctPmdwdV9hZGRyKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwg
MCwgbW1VVkRfUkJfU0laRSwgcmluZy0+cmluZ19zaXplIC8gNCk7CiAKLQlyaW5nID0gJmFkZXYt
PnZjbi5yaW5nX2VuY1sxXTsKKwlyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5nX2VuY1sxXTsK
IAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9SUFRSMiwgbG93ZXJfMzJfYml0cyhyaW5n
LT53cHRyKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfV1BUUjIsIGxvd2VyXzMy
X2JpdHMocmluZy0+d3B0cikpOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX0JBU0Vf
TE8yLCByaW5nLT5ncHVfYWRkcik7CkBAIC0xMzYxLDE0ICsxMzYxLDE0IEBAIHN0YXRpYyBpbnQg
dmNuX3YyXzBfcGF1c2VfZHBnX21vZGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkJ
CSAgIFVWRF9EUEdfUEFVU0VfX05KX1BBVVNFX0RQR19BQ0tfTUFTSywgcmV0X2NvZGUpOwogCiAJ
CQkJLyogUmVzdG9yZSAqLwotCQkJCXJpbmcgPSAmYWRldi0+dmNuLnJpbmdfZW5jWzBdOworCQkJ
CXJpbmcgPSAmYWRldi0+dmNuLmluc3QtPnJpbmdfZW5jWzBdOwogCQkJCVdSRUczMl9TT0MxNShV
VkQsIDAsIG1tVVZEX1JCX0JBU0VfTE8sIHJpbmctPmdwdV9hZGRyKTsKIAkJCQlXUkVHMzJfU09D
MTUoVVZELCAwLCBtbVVWRF9SQl9CQVNFX0hJLCB1cHBlcl8zMl9iaXRzKHJpbmctPmdwdV9hZGRy
KSk7CiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfU0laRSwgcmluZy0+cmluZ19z
aXplIC8gNCk7CiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfUlBUUiwgbG93ZXJf
MzJfYml0cyhyaW5nLT53cHRyKSk7CiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJf
V1BUUiwgbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAKLQkJCQlyaW5nID0gJmFkZXYtPnZj
bi5yaW5nX2VuY1sxXTsKKwkJCQlyaW5nID0gJmFkZXYtPnZjbi5pbnN0LT5yaW5nX2VuY1sxXTsK
IAkJCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9CQVNFX0xPMiwgcmluZy0+Z3B1X2Fk
ZHIpOwogCQkJCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX0JBU0VfSEkyLCB1cHBlcl8z
Ml9iaXRzKHJpbmctPmdwdV9hZGRyKSk7CiAJCQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRf
UkJfU0laRTIsIHJpbmctPnJpbmdfc2l6ZSAvIDQpOwpAQCAtMTY2MCw3ICsxNjYwLDcgQEAgc3Rh
dGljIHVpbnQ2NF90IHZjbl92Ml8wX2VuY19yaW5nX2dldF9ycHRyKHN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZykKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IHJpbmctPmFkZXY7CiAK
LQlpZiAocmluZyA9PSAmYWRldi0+dmNuLnJpbmdfZW5jWzBdKQorCWlmIChyaW5nID09ICZhZGV2
LT52Y24uaW5zdC0+cmluZ19lbmNbMF0pCiAJCXJldHVybiBSUkVHMzJfU09DMTUoVVZELCAwLCBt
bVVWRF9SQl9SUFRSKTsKIAllbHNlCiAJCXJldHVybiBSUkVHMzJfU09DMTUoVVZELCAwLCBtbVVW
RF9SQl9SUFRSMik7CkBAIC0xNjc3LDcgKzE2NzcsNyBAQCBzdGF0aWMgdWludDY0X3QgdmNuX3Yy
XzBfZW5jX3JpbmdfZ2V0X3dwdHIoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nKQogewogCXN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2ID0gcmluZy0+YWRldjsKIAotCWlmIChyaW5nID09ICZhZGV2
LT52Y24ucmluZ19lbmNbMF0pIHsKKwlpZiAocmluZyA9PSAmYWRldi0+dmNuLmluc3QtPnJpbmdf
ZW5jWzBdKSB7CiAJCWlmIChyaW5nLT51c2VfZG9vcmJlbGwpCiAJCQlyZXR1cm4gYWRldi0+d2Iu
d2JbcmluZy0+d3B0cl9vZmZzXTsKIAkJZWxzZQpAQCAtMTcwMSw3ICsxNzAxLDcgQEAgc3RhdGlj
IHZvaWQgdmNuX3YyXzBfZW5jX3Jpbmdfc2V0X3dwdHIoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5n
KQogewogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gcmluZy0+YWRldjsKIAotCWlmIChy
aW5nID09ICZhZGV2LT52Y24ucmluZ19lbmNbMF0pIHsKKwlpZiAocmluZyA9PSAmYWRldi0+dmNu
Lmluc3QtPnJpbmdfZW5jWzBdKSB7CiAJCWlmIChyaW5nLT51c2VfZG9vcmJlbGwpIHsKIAkJCWFk
ZXYtPndiLndiW3JpbmctPndwdHJfb2Zmc10gPSBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpOwog
CQkJV0RPT1JCRUxMMzIocmluZy0+ZG9vcmJlbGxfaW5kZXgsIGxvd2VyXzMyX2JpdHMocmluZy0+
d3B0cikpOwpAQCAtMjA3NSwxNiArMjA3NSwxNiBAQCBzdGF0aWMgaW50IHZjbl92Ml8wX3Byb2Nl
c3NfaW50ZXJydXB0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCiAJc3dpdGNoIChlbnRy
eS0+c3JjX2lkKSB7CiAJY2FzZSBWQ05fMl8wX19TUkNJRF9fVVZEX1NZU1RFTV9NRVNTQUdFX0lO
VEVSUlVQVDoKLQkJYW1kZ3B1X2ZlbmNlX3Byb2Nlc3MoJmFkZXYtPnZjbi5yaW5nX2RlYyk7CisJ
CWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2LT52Y24uaW5zdC0+cmluZ19kZWMpOwogCQlicmVh
azsKIAljYXNlIFZDTl8yXzBfX1NSQ0lEX19VVkRfRU5DX0dFTkVSQUxfUFVSUE9TRToKLQkJYW1k
Z3B1X2ZlbmNlX3Byb2Nlc3MoJmFkZXYtPnZjbi5yaW5nX2VuY1swXSk7CisJCWFtZGdwdV9mZW5j
ZV9wcm9jZXNzKCZhZGV2LT52Y24uaW5zdC0+cmluZ19lbmNbMF0pOwogCQlicmVhazsKIAljYXNl
IFZDTl8yXzBfX1NSQ0lEX19VVkRfRU5DX0xPV19MQVRFTkNZOgotCQlhbWRncHVfZmVuY2VfcHJv
Y2VzcygmYWRldi0+dmNuLnJpbmdfZW5jWzFdKTsKKwkJYW1kZ3B1X2ZlbmNlX3Byb2Nlc3MoJmFk
ZXYtPnZjbi5pbnN0LT5yaW5nX2VuY1sxXSk7CiAJCWJyZWFrOwogCWNhc2UgVkNOXzJfMF9fU1JD
SURfX0pQRUdfREVDT0RFOgotCQlhbWRncHVfZmVuY2VfcHJvY2VzcygmYWRldi0+dmNuLnJpbmdf
anBlZyk7CisJCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2LT52Y24uaW5zdC0+cmluZ19qcGVn
KTsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJRFJNX0VSUk9SKCJVbmhhbmRsZWQgaW50ZXJydXB0
OiAlZCAlZFxuIiwKQEAgLTIyMzMsNyArMjIzMyw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgYW1k
Z3B1X3JpbmdfZnVuY3MgdmNuX3YyXzBfanBlZ19yaW5nX3ZtX2Z1bmNzID0gewogCiBzdGF0aWMg
dm9pZCB2Y25fdjJfMF9zZXRfZGVjX3JpbmdfZnVuY3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYpCiB7Ci0JYWRldi0+dmNuLnJpbmdfZGVjLmZ1bmNzID0gJnZjbl92Ml8wX2RlY19yaW5nX3Zt
X2Z1bmNzOworCWFkZXYtPnZjbi5pbnN0LT5yaW5nX2RlYy5mdW5jcyA9ICZ2Y25fdjJfMF9kZWNf
cmluZ192bV9mdW5jczsKIAlEUk1fSU5GTygiVkNOIGRlY29kZSBpcyBlbmFibGVkIGluIFZNIG1v
ZGVcbiIpOwogfQogCkBAIC0yMjQyLDE0ICsyMjQyLDE0IEBAIHN0YXRpYyB2b2lkIHZjbl92Ml8w
X3NldF9lbmNfcmluZ19mdW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAlpbnQgaTsK
IAogCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX2VuY19yaW5nczsgKytpKQotCQlhZGV2
LT52Y24ucmluZ19lbmNbaV0uZnVuY3MgPSAmdmNuX3YyXzBfZW5jX3Jpbmdfdm1fZnVuY3M7CisJ
CWFkZXYtPnZjbi5pbnN0LT5yaW5nX2VuY1tpXS5mdW5jcyA9ICZ2Y25fdjJfMF9lbmNfcmluZ192
bV9mdW5jczsKIAogCURSTV9JTkZPKCJWQ04gZW5jb2RlIGlzIGVuYWJsZWQgaW4gVk0gbW9kZVxu
Iik7CiB9CiAKIHN0YXRpYyB2b2lkIHZjbl92Ml8wX3NldF9qcGVnX3JpbmdfZnVuY3Moc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7Ci0JYWRldi0+dmNuLnJpbmdfanBlZy5mdW5jcyA9ICZ2
Y25fdjJfMF9qcGVnX3Jpbmdfdm1fZnVuY3M7CisJYWRldi0+dmNuLmluc3QtPnJpbmdfanBlZy5m
dW5jcyA9ICZ2Y25fdjJfMF9qcGVnX3Jpbmdfdm1fZnVuY3M7CiAJRFJNX0lORk8oIlZDTiBqcGVn
IGRlY29kZSBpcyBlbmFibGVkIGluIFZNIG1vZGVcbiIpOwogfQogCkBAIC0yMjYwLDggKzIyNjAs
OCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGFtZGdwdV9pcnFfc3JjX2Z1bmNzIHZjbl92Ml8wX2ly
cV9mdW5jcyA9IHsKIAogc3RhdGljIHZvaWQgdmNuX3YyXzBfc2V0X2lycV9mdW5jcyhzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldikKIHsKLQlhZGV2LT52Y24uaXJxLm51bV90eXBlcyA9IGFkZXYt
PnZjbi5udW1fZW5jX3JpbmdzICsgMjsKLQlhZGV2LT52Y24uaXJxLmZ1bmNzID0gJnZjbl92Ml8w
X2lycV9mdW5jczsKKwlhZGV2LT52Y24uaW5zdC0+aXJxLm51bV90eXBlcyA9IGFkZXYtPnZjbi5u
dW1fZW5jX3JpbmdzICsgMjsKKwlhZGV2LT52Y24uaW5zdC0+aXJxLmZ1bmNzID0gJnZjbl92Ml8w
X2lycV9mdW5jczsKIH0KIAogY29uc3Qgc3RydWN0IGFtZGdwdV9pcF9ibG9ja192ZXJzaW9uIHZj
bl92Ml8wX2lwX2Jsb2NrID0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L3Zjbl92Ml81LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS92Y25fdjJfNS5jCmluZGV4
IDc1ZmRiNjg4MWFjMC4uZTI3MzUxMjY3YzllIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS92Y25fdjJfNS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3Zj
bl92Ml81LmMKQEAgLTY2LDYgKzY2LDcgQEAgc3RhdGljIGludCB2Y25fdjJfNV9lYXJseV9pbml0
KHZvaWQgKmhhbmRsZSkKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqKWhhbmRsZTsKIAorCWFkZXYtPnZjbi5udW1fdmNuX2luc3QgPSAxOwog
CWFkZXYtPnZjbi5udW1fZW5jX3JpbmdzID0gMjsKIAogCXZjbl92Ml81X3NldF9kZWNfcmluZ19m
dW5jcyhhZGV2KTsKQEAgLTkxLDIxICs5MiwyMSBAQCBzdGF0aWMgaW50IHZjbl92Ml81X3N3X2lu
aXQodm9pZCAqaGFuZGxlKQogCiAJLyogVkNOIERFQyBUUkFQICovCiAJciA9IGFtZGdwdV9pcnFf
YWRkX2lkKGFkZXYsIFNPQzE1X0lIX0NMSUVOVElEX1ZDTiwKLQkJCVZDTl8yXzBfX1NSQ0lEX19V
VkRfU1lTVEVNX01FU1NBR0VfSU5URVJSVVBULCAmYWRldi0+dmNuLmlycSk7CisJCQlWQ05fMl8w
X19TUkNJRF9fVVZEX1NZU1RFTV9NRVNTQUdFX0lOVEVSUlVQVCwgJmFkZXYtPnZjbi5pbnN0WzBd
LmlycSk7CiAJaWYgKHIpCiAJCXJldHVybiByOwogCiAJLyogVkNOIEVOQyBUUkFQICovCiAJZm9y
IChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fZW5jX3JpbmdzOyArK2kpIHsKIAkJciA9IGFtZGdw
dV9pcnFfYWRkX2lkKGFkZXYsIFNPQzE1X0lIX0NMSUVOVElEX1ZDTiwKLQkJCWkgKyBWQ05fMl8w
X19TUkNJRF9fVVZEX0VOQ19HRU5FUkFMX1BVUlBPU0UsICZhZGV2LT52Y24uaXJxKTsKKwkJCWkg
KyBWQ05fMl8wX19TUkNJRF9fVVZEX0VOQ19HRU5FUkFMX1BVUlBPU0UsICZhZGV2LT52Y24uaW5z
dFswXS5pcnEpOwogCQlpZiAocikKIAkJCXJldHVybiByOwogCX0KIAogCS8qIFZDTiBKUEVHIFRS
QVAgKi8KIAlyID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRldiwgU09DMTVfSUhfQ0xJRU5USURfVkNO
LAotCQkJVkNOXzJfMF9fU1JDSURfX0pQRUdfREVDT0RFLCAmYWRldi0+dmNuLmlycSk7CisJCQlW
Q05fMl8wX19TUkNJRF9fSlBFR19ERUNPREUsICZhZGV2LT52Y24uaW5zdFswXS5pcnEpOwogCWlm
IChyKQogCQlyZXR1cm4gcjsKIApAQCAtMTI3LDExICsxMjgsMTEgQEAgc3RhdGljIGludCB2Y25f
djJfNV9zd19pbml0KHZvaWQgKmhhbmRsZSkKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKLQlyaW5n
ID0gJmFkZXYtPnZjbi5yaW5nX2RlYzsKKwlyaW5nID0gJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdf
ZGVjOwogCXJpbmctPnVzZV9kb29yYmVsbCA9IHRydWU7CiAJcmluZy0+ZG9vcmJlbGxfaW5kZXgg
PSBhZGV2LT5kb29yYmVsbF9pbmRleC52Y24udmNuX3JpbmcwXzEgPDwgMTsKIAlzcHJpbnRmKHJp
bmctPm5hbWUsICJ2Y25fZGVjIik7Ci0JciA9IGFtZGdwdV9yaW5nX2luaXQoYWRldiwgcmluZywg
NTEyLCAmYWRldi0+dmNuLmlycSwgMCk7CisJciA9IGFtZGdwdV9yaW5nX2luaXQoYWRldiwgcmlu
ZywgNTEyLCAmYWRldi0+dmNuLmluc3RbMF0uaXJxLCAwKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7
CiAKQEAgLTE0MywzNiArMTQ0LDM2IEBAIHN0YXRpYyBpbnQgdmNuX3YyXzVfc3dfaW5pdCh2b2lk
ICpoYW5kbGUpCiAJYWRldi0+dmNuLmludGVybmFsLmdwX3NjcmF0Y2g4ID0gbW1VVkRfR1BfU0NS
QVRDSDhfSU5URVJOQUxfT0ZGU0VUOwogCiAJYWRldi0+dmNuLmludGVybmFsLnNjcmF0Y2g5ID0g
bW1VVkRfU0NSQVRDSDlfSU5URVJOQUxfT0ZGU0VUOwotCWFkZXYtPnZjbi5leHRlcm5hbC5zY3Jh
dGNoOSA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBtbVVWRF9TQ1JBVENIOSk7CisJYWRldi0+
dmNuLmluc3RbMF0uZXh0ZXJuYWwuc2NyYXRjaDkgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwg
bW1VVkRfU0NSQVRDSDkpOwogCWFkZXYtPnZjbi5pbnRlcm5hbC5kYXRhMCA9IG1tVVZEX0dQQ09N
X1ZDUFVfREFUQTBfSU5URVJOQUxfT0ZGU0VUOwotCWFkZXYtPnZjbi5leHRlcm5hbC5kYXRhMCA9
IFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBtbVVWRF9HUENPTV9WQ1BVX0RBVEEwKTsKKwlhZGV2
LT52Y24uaW5zdFswXS5leHRlcm5hbC5kYXRhMCA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBt
bVVWRF9HUENPTV9WQ1BVX0RBVEEwKTsKIAlhZGV2LT52Y24uaW50ZXJuYWwuZGF0YTEgPSBtbVVW
RF9HUENPTV9WQ1BVX0RBVEExX0lOVEVSTkFMX09GRlNFVDsKLQlhZGV2LT52Y24uZXh0ZXJuYWwu
ZGF0YTEgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfR1BDT01fVkNQVV9EQVRBMSk7
CisJYWRldi0+dmNuLmluc3RbMF0uZXh0ZXJuYWwuZGF0YTEgPSBTT0MxNV9SRUdfT0ZGU0VUKFVW
RCwgMCwgbW1VVkRfR1BDT01fVkNQVV9EQVRBMSk7CiAJYWRldi0+dmNuLmludGVybmFsLmNtZCA9
IG1tVVZEX0dQQ09NX1ZDUFVfQ01EX0lOVEVSTkFMX09GRlNFVDsKLQlhZGV2LT52Y24uZXh0ZXJu
YWwuY21kID0gU09DMTVfUkVHX09GRlNFVChVVkQsIDAsIG1tVVZEX0dQQ09NX1ZDUFVfQ01EKTsK
KwlhZGV2LT52Y24uaW5zdFswXS5leHRlcm5hbC5jbWQgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwg
MCwgbW1VVkRfR1BDT01fVkNQVV9DTUQpOwogCWFkZXYtPnZjbi5pbnRlcm5hbC5ub3AgPSBtbVVW
RF9OT19PUF9JTlRFUk5BTF9PRkZTRVQ7Ci0JYWRldi0+dmNuLmV4dGVybmFsLm5vcCA9IFNPQzE1
X1JFR19PRkZTRVQoVVZELCAwLCBtbVVWRF9OT19PUCk7CisJYWRldi0+dmNuLmluc3RbMF0uZXh0
ZXJuYWwubm9wID0gU09DMTVfUkVHX09GRlNFVChVVkQsIDAsIG1tVVZEX05PX09QKTsKIAogCWZv
ciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX2VuY19yaW5nczsgKytpKSB7Ci0JCXJpbmcgPSAm
YWRldi0+dmNuLnJpbmdfZW5jW2ldOworCQlyaW5nID0gJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdf
ZW5jW2ldOwogCQlyaW5nLT51c2VfZG9vcmJlbGwgPSB0cnVlOwogCQlyaW5nLT5kb29yYmVsbF9p
bmRleCA9IChhZGV2LT5kb29yYmVsbF9pbmRleC52Y24udmNuX3JpbmcwXzEgPDwgMSkgKyAyICsg
aTsKIAkJc3ByaW50ZihyaW5nLT5uYW1lLCAidmNuX2VuYyVkIiwgaSk7Ci0JCXIgPSBhbWRncHVf
cmluZ19pbml0KGFkZXYsIHJpbmcsIDUxMiwgJmFkZXYtPnZjbi5pcnEsIDApOworCQlyID0gYW1k
Z3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaW5zdFswXS5pcnEsIDAp
OwogCQlpZiAocikKIAkJCXJldHVybiByOwogCX0KIAotCXJpbmcgPSAmYWRldi0+dmNuLnJpbmdf
anBlZzsKKwlyaW5nID0gJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfanBlZzsKIAlyaW5nLT51c2Vf
ZG9vcmJlbGwgPSB0cnVlOwogCXJpbmctPmRvb3JiZWxsX2luZGV4ID0gKGFkZXYtPmRvb3JiZWxs
X2luZGV4LnZjbi52Y25fcmluZzBfMSA8PCAxKSArIDE7CiAJc3ByaW50ZihyaW5nLT5uYW1lLCAi
dmNuX2pwZWciKTsKLQlyID0gYW1kZ3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2
LT52Y24uaXJxLCAwKTsKKwlyID0gYW1kZ3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZh
ZGV2LT52Y24uaW5zdFswXS5pcnEsIDApOwogCWlmIChyKQogCQlyZXR1cm4gcjsKIAogCWFkZXYt
PnZjbi5pbnRlcm5hbC5qcGVnX3BpdGNoID0gbW1VVkRfSlBFR19QSVRDSF9JTlRFUk5BTF9PRkZT
RVQ7Ci0JYWRldi0+dmNuLmV4dGVybmFsLmpwZWdfcGl0Y2ggPSBTT0MxNV9SRUdfT0ZGU0VUKFVW
RCwgMCwgbW1VVkRfSlBFR19QSVRDSCk7CisJYWRldi0+dmNuLmluc3RbMF0uZXh0ZXJuYWwuanBl
Z19waXRjaCA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBtbVVWRF9KUEVHX1BJVENIKTsKIAog
CXJldHVybiAwOwogfQpAQCAtMjA4LDcgKzIwOSw3IEBAIHN0YXRpYyBpbnQgdmNuX3YyXzVfc3df
ZmluaSh2b2lkICpoYW5kbGUpCiBzdGF0aWMgaW50IHZjbl92Ml81X2h3X2luaXQodm9pZCAqaGFu
ZGxlKQogewogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2
aWNlICopaGFuZGxlOwotCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24ucmlu
Z19kZWM7CisJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPnZjbi5pbnN0WzBdLnJp
bmdfZGVjOwogCWludCBpLCByOwogCiAJYWRldi0+bmJpb19mdW5jcy0+dmNuX2Rvb3JiZWxsX3Jh
bmdlKGFkZXYsIHJpbmctPnVzZV9kb29yYmVsbCwKQEAgLTIyMSw3ICsyMjIsNyBAQCBzdGF0aWMg
aW50IHZjbl92Ml81X2h3X2luaXQodm9pZCAqaGFuZGxlKQogCX0KIAogCWZvciAoaSA9IDA7IGkg
PCBhZGV2LT52Y24ubnVtX2VuY19yaW5nczsgKytpKSB7Ci0JCXJpbmcgPSAmYWRldi0+dmNuLnJp
bmdfZW5jW2ldOworCQlyaW5nID0gJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfZW5jW2ldOwogCQly
aW5nLT5zY2hlZC5yZWFkeSA9IGZhbHNlOwogCQljb250aW51ZTsKIAkJciA9IGFtZGdwdV9yaW5n
X3Rlc3RfcmluZyhyaW5nKTsKQEAgLTIzMSw3ICsyMzIsNyBAQCBzdGF0aWMgaW50IHZjbl92Ml81
X2h3X2luaXQodm9pZCAqaGFuZGxlKQogCQl9CiAJfQogCi0JcmluZyA9ICZhZGV2LT52Y24ucmlu
Z19qcGVnOworCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19qcGVnOwogCXIgPSBhbWRn
cHVfcmluZ190ZXN0X3JpbmcocmluZyk7CiAJaWYgKHIpIHsKIAkJcmluZy0+c2NoZWQucmVhZHkg
PSBmYWxzZTsKQEAgLTI1NSw3ICsyNTYsNyBAQCBzdGF0aWMgaW50IHZjbl92Ml81X2h3X2luaXQo
dm9pZCAqaGFuZGxlKQogc3RhdGljIGludCB2Y25fdjJfNV9od19maW5pKHZvaWQgKmhhbmRsZSkK
IHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
KWhhbmRsZTsKLQlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcgPSAmYWRldi0+dmNuLnJpbmdfZGVj
OworCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2Rl
YzsKIAlpbnQgaTsKIAogCWlmIChSUkVHMzJfU09DMTUoVkNOLCAwLCBtbVVWRF9TVEFUVVMpKQpA
QCAtMjY0LDExICsyNjUsMTEgQEAgc3RhdGljIGludCB2Y25fdjJfNV9od19maW5pKHZvaWQgKmhh
bmRsZSkKIAlyaW5nLT5zY2hlZC5yZWFkeSA9IGZhbHNlOwogCiAJZm9yIChpID0gMDsgaSA8IGFk
ZXYtPnZjbi5udW1fZW5jX3JpbmdzOyArK2kpIHsKLQkJcmluZyA9ICZhZGV2LT52Y24ucmluZ19l
bmNbaV07CisJCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19lbmNbaV07CiAJCXJpbmct
PnNjaGVkLnJlYWR5ID0gZmFsc2U7CiAJfQogCi0JcmluZyA9ICZhZGV2LT52Y24ucmluZ19qcGVn
OworCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19qcGVnOwogCXJpbmctPnNjaGVkLnJl
YWR5ID0gZmFsc2U7CiAKIAlyZXR1cm4gMDsKQEAgLTMzOCw5ICszMzksOSBAQCBzdGF0aWMgdm9p
ZCB2Y25fdjJfNV9tY19yZXN1bWUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCW9mZnNl
dCA9IDA7CiAJfSBlbHNlIHsKIAkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfTE1JX1ZDUFVf
Q0FDSEVfNjRCSVRfQkFSX0xPVywKLQkJCWxvd2VyXzMyX2JpdHMoYWRldi0+dmNuLmdwdV9hZGRy
KSk7CisJCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0WzBdLmdwdV9hZGRyKSk7CiAJCVdS
RUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFXzY0QklUX0JBUl9ISUdILAot
CQkJdXBwZXJfMzJfYml0cyhhZGV2LT52Y24uZ3B1X2FkZHIpKTsKKwkJCXVwcGVyXzMyX2JpdHMo
YWRldi0+dmNuLmluc3RbMF0uZ3B1X2FkZHIpKTsKIAkJb2Zmc2V0ID0gc2l6ZTsKIAkJLyogTm8g
c2lnbmVkIGhlYWRlciBmb3Igbm93IGZyb20gZmlybXdhcmUKIAkJV1JFRzMyX1NPQzE1KFVWRCwg
MCwgbW1VVkRfVkNQVV9DQUNIRV9PRkZTRVQwLApAQCAtMzUyLDE3ICszNTMsMTcgQEAgc3RhdGlj
IHZvaWQgdmNuX3YyXzVfbWNfcmVzdW1lKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCiAJ
LyogY2FjaGUgd2luZG93IDE6IHN0YWNrICovCiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRf
TE1JX1ZDUFVfQ0FDSEUxXzY0QklUX0JBUl9MT1csCi0JCWxvd2VyXzMyX2JpdHMoYWRldi0+dmNu
LmdwdV9hZGRyICsgb2Zmc2V0KSk7CisJCWxvd2VyXzMyX2JpdHMoYWRldi0+dmNuLmluc3RbMF0u
Z3B1X2FkZHIgKyBvZmZzZXQpKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9MTUlfVkNQ
VV9DQUNIRTFfNjRCSVRfQkFSX0hJR0gsCi0JCXVwcGVyXzMyX2JpdHMoYWRldi0+dmNuLmdwdV9h
ZGRyICsgb2Zmc2V0KSk7CisJCXVwcGVyXzMyX2JpdHMoYWRldi0+dmNuLmluc3RbMF0uZ3B1X2Fk
ZHIgKyBvZmZzZXQpKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX09G
RlNFVDEsIDApOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1ZDUFVfQ0FDSEVfU0laRTEs
IEFNREdQVV9WQ05fU1RBQ0tfU0laRSk7CiAKIAkvKiBjYWNoZSB3aW5kb3cgMjogY29udGV4dCAq
LwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMl82NEJJVF9CQVJf
TE9XLAotCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5ncHVfYWRkciArIG9mZnNldCArIEFNREdQ
VV9WQ05fU1RBQ0tfU0laRSkpOworCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0WzBdLmdw
dV9hZGRyICsgb2Zmc2V0ICsgQU1ER1BVX1ZDTl9TVEFDS19TSVpFKSk7CiAJV1JFRzMyX1NPQzE1
KFVWRCwgMCwgbW1VVkRfTE1JX1ZDUFVfQ0FDSEUyXzY0QklUX0JBUl9ISUdILAotCQl1cHBlcl8z
Ml9iaXRzKGFkZXYtPnZjbi5ncHVfYWRkciArIG9mZnNldCArIEFNREdQVV9WQ05fU1RBQ0tfU0la
RSkpOworCQl1cHBlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0WzBdLmdwdV9hZGRyICsgb2Zmc2V0
ICsgQU1ER1BVX1ZDTl9TVEFDS19TSVpFKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRf
VkNQVV9DQUNIRV9PRkZTRVQyLCAwKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BV
X0NBQ0hFX1NJWkUyLCBBTURHUFVfVkNOX0NPTlRFWFRfU0laRSk7CiB9CkBAIC01NDgsNyArNTQ5
LDcgQEAgc3RhdGljIHZvaWQgdmNuX3YyXzVfZW5hYmxlX2Nsb2NrX2dhdGluZyhzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldikKICAqLwogc3RhdGljIGludCBqcGVnX3YyXzVfc3RhcnQoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7Ci0Jc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFk
ZXYtPnZjbi5yaW5nX2pwZWc7CisJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPnZj
bi5pbnN0WzBdLnJpbmdfanBlZzsKIAl1aW50MzJfdCB0bXA7CiAKIAkvKiBkaXNhYmxlIGFudGkg
aGFuZyBtZWNoYW5pc20gKi8KQEAgLTYzOSw3ICs2NDAsNyBAQCBzdGF0aWMgaW50IGpwZWdfdjJf
NV9zdG9wKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCiBzdGF0aWMgaW50IHZjbl92Ml81
X3N0YXJ0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogewotCXN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZyA9ICZhZGV2LT52Y24ucmluZ19kZWM7CisJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5n
ID0gJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfZGVjOwogCXVpbnQzMl90IHJiX2J1ZnN6LCB0bXA7
CiAJaW50IGksIGosIHI7CiAKQEAgLTc4MSwxNCArNzgyLDE0IEBAIHN0YXRpYyBpbnQgdmNuX3Yy
XzVfc3RhcnQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJcmluZy0+d3B0ciA9IFJSRUcz
Ml9TT0MxNShVVkQsIDAsIG1tVVZEX1JCQ19SQl9SUFRSKTsKIAlXUkVHMzJfU09DMTUoVVZELCAw
LCBtbVVWRF9SQkNfUkJfV1BUUiwKIAkJCWxvd2VyXzMyX2JpdHMocmluZy0+d3B0cikpOwotCXJp
bmcgPSAmYWRldi0+dmNuLnJpbmdfZW5jWzBdOworCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0u
cmluZ19lbmNbMF07CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfUlBUUiwgbG93ZXJf
MzJfYml0cyhyaW5nLT53cHRyKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfV1BU
UiwgbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1V
VkRfUkJfQkFTRV9MTywgcmluZy0+Z3B1X2FkZHIpOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1t
VVZEX1JCX0JBU0VfSEksIHVwcGVyXzMyX2JpdHMocmluZy0+Z3B1X2FkZHIpKTsKIAlXUkVHMzJf
U09DMTUoVVZELCAwLCBtbVVWRF9SQl9TSVpFLCByaW5nLT5yaW5nX3NpemUgLyA0KTsKIAotCXJp
bmcgPSAmYWRldi0+dmNuLnJpbmdfZW5jWzFdOworCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0u
cmluZ19lbmNbMV07CiAJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfUlBUUjIsIGxvd2Vy
XzMyX2JpdHMocmluZy0+d3B0cikpOwogCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX1dQ
VFIyLCBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpKTsKIAlXUkVHMzJfU09DMTUoVVZELCAwLCBt
bVVWRF9SQl9CQVNFX0xPMiwgcmluZy0+Z3B1X2FkZHIpOwpAQCAtOTUxLDcgKzk1Miw3IEBAIHN0
YXRpYyB1aW50NjRfdCB2Y25fdjJfNV9lbmNfcmluZ19nZXRfcnB0cihzdHJ1Y3QgYW1kZ3B1X3Jp
bmcgKnJpbmcpCiB7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5nLT5hZGV2Owog
Ci0JaWYgKHJpbmcgPT0gJmFkZXYtPnZjbi5yaW5nX2VuY1swXSkKKwlpZiAocmluZyA9PSAmYWRl
di0+dmNuLmluc3RbMF0ucmluZ19lbmNbMF0pCiAJCXJldHVybiBSUkVHMzJfU09DMTUoVVZELCAw
LCBtbVVWRF9SQl9SUFRSKTsKIAllbHNlCiAJCXJldHVybiBSUkVHMzJfU09DMTUoVVZELCAwLCBt
bVVWRF9SQl9SUFRSMik7CkBAIC05NjgsNyArOTY5LDcgQEAgc3RhdGljIHVpbnQ2NF90IHZjbl92
Ml81X2VuY19yaW5nX2dldF93cHRyKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykKIHsKIAlzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IHJpbmctPmFkZXY7CiAKLQlpZiAocmluZyA9PSAmYWRl
di0+dmNuLnJpbmdfZW5jWzBdKSB7CisJaWYgKHJpbmcgPT0gJmFkZXYtPnZjbi5pbnN0WzBdLnJp
bmdfZW5jWzBdKSB7CiAJCWlmIChyaW5nLT51c2VfZG9vcmJlbGwpCiAJCQlyZXR1cm4gYWRldi0+
d2Iud2JbcmluZy0+d3B0cl9vZmZzXTsKIAkJZWxzZQpAQCAtOTkyLDcgKzk5Myw3IEBAIHN0YXRp
YyB2b2lkIHZjbl92Ml81X2VuY19yaW5nX3NldF93cHRyKHN0cnVjdCBhbWRncHVfcmluZyAqcmlu
ZykKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IHJpbmctPmFkZXY7CiAKLQlpZiAo
cmluZyA9PSAmYWRldi0+dmNuLnJpbmdfZW5jWzBdKSB7CisJaWYgKHJpbmcgPT0gJmFkZXYtPnZj
bi5pbnN0WzBdLnJpbmdfZW5jWzBdKSB7CiAJCWlmIChyaW5nLT51c2VfZG9vcmJlbGwpIHsKIAkJ
CWFkZXYtPndiLndiW3JpbmctPndwdHJfb2Zmc10gPSBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIp
OwogCQkJV0RPT1JCRUxMMzIocmluZy0+ZG9vcmJlbGxfaW5kZXgsIGxvd2VyXzMyX2JpdHMocmlu
Zy0+d3B0cikpOwpAQCAtMTEyMSw3ICsxMTIyLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBhbWRn
cHVfcmluZ19mdW5jcyB2Y25fdjJfNV9qcGVnX3Jpbmdfdm1fZnVuY3MgPSB7CiAKIHN0YXRpYyB2
b2lkIHZjbl92Ml81X3NldF9kZWNfcmluZ19mdW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
dikKIHsKLQlhZGV2LT52Y24ucmluZ19kZWMuZnVuY3MgPSAmdmNuX3YyXzVfZGVjX3Jpbmdfdm1f
ZnVuY3M7CisJYWRldi0+dmNuLmluc3RbMF0ucmluZ19kZWMuZnVuY3MgPSAmdmNuX3YyXzVfZGVj
X3Jpbmdfdm1fZnVuY3M7CiAJRFJNX0lORk8oIlZDTiBkZWNvZGUgaXMgZW5hYmxlZCBpbiBWTSBt
b2RlXG4iKTsKIH0KIApAQCAtMTEzMCwxNCArMTEzMSwxNCBAQCBzdGF0aWMgdm9pZCB2Y25fdjJf
NV9zZXRfZW5jX3JpbmdfZnVuY3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJaW50IGk7
CiAKIAlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7ICsraSkKLQkJYWRl
di0+dmNuLnJpbmdfZW5jW2ldLmZ1bmNzID0gJnZjbl92Ml81X2VuY19yaW5nX3ZtX2Z1bmNzOwor
CQlhZGV2LT52Y24uaW5zdFswXS5yaW5nX2VuY1tpXS5mdW5jcyA9ICZ2Y25fdjJfNV9lbmNfcmlu
Z192bV9mdW5jczsKIAogCURSTV9JTkZPKCJWQ04gZW5jb2RlIGlzIGVuYWJsZWQgaW4gVk0gbW9k
ZVxuIik7CiB9CiAKIHN0YXRpYyB2b2lkIHZjbl92Ml81X3NldF9qcGVnX3JpbmdfZnVuY3Moc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7Ci0JYWRldi0+dmNuLnJpbmdfanBlZy5mdW5jcyA9
ICZ2Y25fdjJfNV9qcGVnX3Jpbmdfdm1fZnVuY3M7CisJYWRldi0+dmNuLmluc3RbMF0ucmluZ19q
cGVnLmZ1bmNzID0gJnZjbl92Ml81X2pwZWdfcmluZ192bV9mdW5jczsKIAlEUk1fSU5GTygiVkNO
IGpwZWcgZGVjb2RlIGlzIGVuYWJsZWQgaW4gVk0gbW9kZVxuIik7CiB9CiAKQEAgLTEyMTIsMTYg
KzEyMTMsMTYgQEAgc3RhdGljIGludCB2Y25fdjJfNV9wcm9jZXNzX2ludGVycnVwdChzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldiwKIAogCXN3aXRjaCAoZW50cnktPnNyY19pZCkgewogCWNhc2Ug
VkNOXzJfMF9fU1JDSURfX1VWRF9TWVNURU1fTUVTU0FHRV9JTlRFUlJVUFQ6Ci0JCWFtZGdwdV9m
ZW5jZV9wcm9jZXNzKCZhZGV2LT52Y24ucmluZ19kZWMpOworCQlhbWRncHVfZmVuY2VfcHJvY2Vz
cygmYWRldi0+dmNuLmluc3RbMF0ucmluZ19kZWMpOwogCQlicmVhazsKIAljYXNlIFZDTl8yXzBf
X1NSQ0lEX19VVkRfRU5DX0dFTkVSQUxfUFVSUE9TRToKLQkJYW1kZ3B1X2ZlbmNlX3Byb2Nlc3Mo
JmFkZXYtPnZjbi5yaW5nX2VuY1swXSk7CisJCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2LT52
Y24uaW5zdFswXS5yaW5nX2VuY1swXSk7CiAJCWJyZWFrOwogCWNhc2UgVkNOXzJfMF9fU1JDSURf
X1VWRF9FTkNfTE9XX0xBVEVOQ1k6Ci0JCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2LT52Y24u
cmluZ19lbmNbMV0pOworCQlhbWRncHVfZmVuY2VfcHJvY2VzcygmYWRldi0+dmNuLmluc3RbMF0u
cmluZ19lbmNbMV0pOwogCQlicmVhazsKIAljYXNlIFZDTl8yXzBfX1NSQ0lEX19KUEVHX0RFQ09E
RToKLQkJYW1kZ3B1X2ZlbmNlX3Byb2Nlc3MoJmFkZXYtPnZjbi5yaW5nX2pwZWcpOworCQlhbWRn
cHVfZmVuY2VfcHJvY2VzcygmYWRldi0+dmNuLmluc3RbMF0ucmluZ19qcGVnKTsKIAkJYnJlYWs7
CiAJZGVmYXVsdDoKIAkJRFJNX0VSUk9SKCJVbmhhbmRsZWQgaW50ZXJydXB0OiAlZCAlZFxuIiwK
QEAgLTEyMzksOCArMTI0MCw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgYW1kZ3B1X2lycV9zcmNf
ZnVuY3MgdmNuX3YyXzVfaXJxX2Z1bmNzID0gewogCiBzdGF0aWMgdm9pZCB2Y25fdjJfNV9zZXRf
aXJxX2Z1bmNzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogewotCWFkZXYtPnZjbi5pcnEu
bnVtX3R5cGVzID0gYWRldi0+dmNuLm51bV9lbmNfcmluZ3MgKyAyOwotCWFkZXYtPnZjbi5pcnEu
ZnVuY3MgPSAmdmNuX3YyXzVfaXJxX2Z1bmNzOworCWFkZXYtPnZjbi5pbnN0WzBdLmlycS5udW1f
dHlwZXMgPSBhZGV2LT52Y24ubnVtX2VuY19yaW5ncyArIDI7CisJYWRldi0+dmNuLmluc3RbMF0u
aXJxLmZ1bmNzID0gJnZjbl92Ml81X2lycV9mdW5jczsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVj
dCBhbWRfaXBfZnVuY3MgdmNuX3YyXzVfaXBfZnVuY3MgPSB7Ci0tIAoyLjIwLjEKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBs
aXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
