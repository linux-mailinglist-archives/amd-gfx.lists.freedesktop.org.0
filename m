Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9066F69E49
	for <lists+amd-gfx@lfdr.de>; Mon, 15 Jul 2019 23:26:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 993716E02C;
	Mon, 15 Jul 2019 21:26:03 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x844.google.com (mail-qt1-x844.google.com
 [IPv6:2607:f8b0:4864:20::844])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5C79289FF9
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 21:26:01 +0000 (UTC)
Received: by mail-qt1-x844.google.com with SMTP id d17so17233696qtj.8
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 14:26:01 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=B7T2hJUw3Cg6Fwf9sYExazfiUNgCvaH9kD86M+Sg8Js=;
 b=XNIAhgHTSXccaNlMdme2ZrKw5gCk9BH2t4AASUpECt5ZKxX9Yn+GSgXOwIvYgfK2Ko
 enu7r5SHYWNGGJCgFlqs6jM0BUOdhVXySaxwkWQhUjPhRpYNDisOVDGAtngHbicfLCw5
 79h4GX5z7G4t4PEZDlVJz97kowNwn/tsi1jljIYBhuLI/Rdf6hzAyZXoxLUCDxP4Hw58
 iHkFRQPmsQH6iT37m4Cv7D9Hy0N52J1Ca0DTmfqhVt1kNIgVGVU1OUhxFNL6P+QAvZpq
 LFQm7HUumn53K2MWFtPDHy1Ldrv7kwrG60alB0cx1UJdpz/u7s/s2H/TFlT3SVRpld5O
 jIXQ==
X-Gm-Message-State: APjAAAUAUUJYN8umrb22iqStQ/OQ0/0jnko9LYjMUAv5QgMRcvG8hLFD
 ZiR7ePnrg5hMssHdhSscszJyce/K
X-Google-Smtp-Source: APXvYqyvEgS1nAxPyA2vk//V4OP1hmI4X/kY1qirTgFhvaSLgdRgyEK62Qnm3v8ym+OzNlb1rjJl9w==
X-Received: by 2002:ac8:170f:: with SMTP id w15mr19456704qtj.370.1563225959424; 
 Mon, 15 Jul 2019 14:25:59 -0700 (PDT)
Received: from localhost.localdomain ([71.219.21.119])
 by smtp.gmail.com with ESMTPSA id q56sm10274133qtq.64.2019.07.15.14.25.58
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 15 Jul 2019 14:25:58 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 081/102] drm/amdgpu: add multiple instances support for
 Arcturus
Date: Mon, 15 Jul 2019 16:24:16 -0500
Message-Id: <20190715212437.31793-79-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190715212437.31793-1-alexander.deucher@amd.com>
References: <20190715212437.31793-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=B7T2hJUw3Cg6Fwf9sYExazfiUNgCvaH9kD86M+Sg8Js=;
 b=utY787tnrD/Cg8oOzUBoUsYkxgfRJkNvowJc5oZOq4TTzQCeTBM9UR+zdOV86u3uk1
 zfR2LSdgTWRwyYmZGZSXBCCmT04uCX5xZpEjr2WbIrKZv9+9953ZBPpXRZgsqP1eYB5i
 Zs0PrRWrrImA50/pvEOfI3IiHpmiqt2l92sCKfJ0g9Bsz9Q7AoZyudWx7IBBu4pH8TZ/
 T/BkqnKpmk0wRv2XqcnhiMHZ4rGsGD0ksO8VsyeKsOtp568utKuZ31lcKnujCT+A96ZO
 7s8YthNPyp1MI/nqreZd+1p9pyPDtG3CHxEwsO/bBBsfzu8qminJDF7eKqI9jiCmBtF/
 N7Pw==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, James Zhu <James.Zhu@amd.com>,
 Leo Liu <leo.liu@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogSmFtZXMgWmh1IDxKYW1lcy5aaHVAYW1kLmNvbT4KCkFyY3R1cnVzIGhhcyBkdWFsLVZD
Ti4gTmVlZCBhZGQgbXVsdGlwbGUgaW5zdGFuY2VzIHN1cHBvcnQgZm9yIEFyY3R1cnVzLgoKU2ln
bmVkLW9mZi1ieTogSmFtZXMgWmh1IDxKYW1lcy5aaHVAYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IExl
byBMaXUgPGxlby5saXVAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogQWxleCBEZXVjaGVyIDxhbGV4
YW5kZXIuZGV1Y2hlckBhbWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9rbXMuYyB8ICAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92
Y24uYyB8ICAxNjYgKystLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvdmNuX3YyXzUuYyAg
IHwgMTE3OCArKysrKysrKysrKystLS0tLS0tLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCA3MzcgaW5z
ZXJ0aW9ucygrKSwgNjI3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9rbXMuYwppbmRleCBiNTZkMGYxNWU0NTcuLjM4ZjZjNzdhNTkzYSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwpAQCAtNDA1LDIzICs0MDUsMjkgQEAgc3RhdGlj
IGludCBhbWRncHVfaHdfaXBfaW5mbyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJYnJl
YWs7CiAJY2FzZSBBTURHUFVfSFdfSVBfVkNOX0RFQzoKIAkJdHlwZSA9IEFNRF9JUF9CTE9DS19U
WVBFX1ZDTjsKLQkJaWYgKGFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfZGVjLnNjaGVkLnJlYWR5KQot
CQkJKytudW1fcmluZ3M7CisJCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX3Zjbl9pbnN0
OyBpKyspIHsKKwkJCWlmIChhZGV2LT52Y24uaW5zdFtpXS5yaW5nX2RlYy5zY2hlZC5yZWFkeSkK
KwkJCQkrK251bV9yaW5nczsKKwkJfQogCQlpYl9zdGFydF9hbGlnbm1lbnQgPSAxNjsKIAkJaWJf
c2l6ZV9hbGlnbm1lbnQgPSAxNjsKIAkJYnJlYWs7CiAJY2FzZSBBTURHUFVfSFdfSVBfVkNOX0VO
QzoKIAkJdHlwZSA9IEFNRF9JUF9CTE9DS19UWVBFX1ZDTjsKLQkJZm9yIChpID0gMDsgaSA8IGFk
ZXYtPnZjbi5udW1fZW5jX3JpbmdzOyBpKyspCi0JCQlpZiAoYWRldi0+dmNuLmluc3RbMF0ucmlu
Z19lbmNbaV0uc2NoZWQucmVhZHkpCi0JCQkJKytudW1fcmluZ3M7CisJCWZvciAoaSA9IDA7IGkg
PCBhZGV2LT52Y24ubnVtX3Zjbl9pbnN0OyBpKyspIHsKKwkJCWZvciAoaiA9IDA7IGogPCBhZGV2
LT52Y24ubnVtX2VuY19yaW5nczsgaisrKQorCQkJCWlmIChhZGV2LT52Y24uaW5zdFtpXS5yaW5n
X2VuY1tqXS5zY2hlZC5yZWFkeSkKKwkJCQkJKytudW1fcmluZ3M7CisJCX0KIAkJaWJfc3RhcnRf
YWxpZ25tZW50ID0gNjQ7CiAJCWliX3NpemVfYWxpZ25tZW50ID0gMTsKIAkJYnJlYWs7CiAJY2Fz
ZSBBTURHUFVfSFdfSVBfVkNOX0pQRUc6CiAJCXR5cGUgPSBBTURfSVBfQkxPQ0tfVFlQRV9WQ047
Ci0JCWlmIChhZGV2LT52Y24uaW5zdFswXS5yaW5nX2pwZWcuc2NoZWQucmVhZHkpCi0JCQkrK251
bV9yaW5nczsKKwkJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fdmNuX2luc3Q7IGkrKykg
eworCQkJaWYgKGFkZXYtPnZjbi5pbnN0W2ldLnJpbmdfanBlZy5zY2hlZC5yZWFkeSkKKwkJCQkr
K251bV9yaW5nczsKKwkJfQogCQlpYl9zdGFydF9hbGlnbm1lbnQgPSAxNjsKIAkJaWJfc2l6ZV9h
bGlnbm1lbnQgPSAxNjsKIAkJYnJlYWs7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdmNuLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dmNuLmMKaW5kZXggMzMwZjM1NWI5M2E5Li41MDE2ZmM1NzAyMTEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92Y24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfdmNuLmMKQEAgLTY0LDcgKzY0LDcgQEAgaW50IGFtZGdwdV92Y25f
c3dfaW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAljb25zdCBjaGFyICpmd19uYW1l
OwogCWNvbnN0IHN0cnVjdCBjb21tb25fZmlybXdhcmVfaGVhZGVyICpoZHI7CiAJdW5zaWduZWQg
Y2hhciBmd19jaGVjazsKLQlpbnQgcjsKKwlpbnQgaSwgcjsKIAogCUlOSVRfREVMQVlFRF9XT1JL
KCZhZGV2LT52Y24uaWRsZV93b3JrLCBhbWRncHVfdmNuX2lkbGVfd29ya19oYW5kbGVyKTsKIApA
QCAtMTQ1LDEyICsxNDUsMTUgQEAgaW50IGFtZGdwdV92Y25fc3dfaW5pdChzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldikKIAlib19zaXplID0gQU1ER1BVX1ZDTl9TVEFDS19TSVpFICsgQU1ER1BV
X1ZDTl9DT05URVhUX1NJWkU7CiAJaWYgKGFkZXYtPmZpcm13YXJlLmxvYWRfdHlwZSAhPSBBTURH
UFVfRldfTE9BRF9QU1ApCiAJCWJvX3NpemUgKz0gQU1ER1BVX0dQVV9QQUdFX0FMSUdOKGxlMzJf
dG9fY3B1KGhkci0+dWNvZGVfc2l6ZV9ieXRlcykgKyA4KTsKLQlyID0gYW1kZ3B1X2JvX2NyZWF0
ZV9rZXJuZWwoYWRldiwgYm9fc2l6ZSwgUEFHRV9TSVpFLAotCQkJCSAgICBBTURHUFVfR0VNX0RP
TUFJTl9WUkFNLCAmYWRldi0+dmNuLmluc3RbMF0udmNwdV9ibywKLQkJCQkgICAgJmFkZXYtPnZj
bi5pbnN0WzBdLmdwdV9hZGRyLCAmYWRldi0+dmNuLmluc3RbMF0uY3B1X2FkZHIpOwotCWlmIChy
KSB7Ci0JCWRldl9lcnIoYWRldi0+ZGV2LCAiKCVkKSBmYWlsZWQgdG8gYWxsb2NhdGUgdmNuIGJv
XG4iLCByKTsKLQkJcmV0dXJuIHI7CisKKwlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV92
Y25faW5zdDsgaSsrKSB7CisJCXIgPSBhbWRncHVfYm9fY3JlYXRlX2tlcm5lbChhZGV2LCBib19z
aXplLCBQQUdFX1NJWkUsCisJCQkJCQlBTURHUFVfR0VNX0RPTUFJTl9WUkFNLCAmYWRldi0+dmNu
Lmluc3RbaV0udmNwdV9ibywKKwkJCQkJCSZhZGV2LT52Y24uaW5zdFtpXS5ncHVfYWRkciwgJmFk
ZXYtPnZjbi5pbnN0W2ldLmNwdV9hZGRyKTsKKwkJaWYgKHIpIHsKKwkJCWRldl9lcnIoYWRldi0+
ZGV2LCAiKCVkKSBmYWlsZWQgdG8gYWxsb2NhdGUgdmNuIGJvXG4iLCByKTsKKwkJCXJldHVybiBy
OworCQl9CiAJfQogCiAJaWYgKGFkZXYtPnZjbi5pbmRpcmVjdF9zcmFtKSB7CkBAIC0xNjgsMjYg
KzE3MSwyOCBAQCBpbnQgYW1kZ3B1X3Zjbl9zd19pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2KQogCiBpbnQgYW1kZ3B1X3Zjbl9zd19maW5pKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KQogewotCWludCBpOwotCi0Ja3ZmcmVlKGFkZXYtPnZjbi5pbnN0WzBdLnNhdmVkX2JvKTsKKwlp
bnQgaSwgajsKIAogCWlmIChhZGV2LT52Y24uaW5kaXJlY3Rfc3JhbSkgewogCQlhbWRncHVfYm9f
ZnJlZV9rZXJuZWwoJmFkZXYtPnZjbi5kcGdfc3JhbV9ibywKLQkJCSAgICAgICZhZGV2LT52Y24u
ZHBnX3NyYW1fZ3B1X2FkZHIsCi0JCQkgICAgICAodm9pZCAqKikmYWRldi0+dmNuLmRwZ19zcmFt
X2NwdV9hZGRyKTsKKwkJCQkgICAgICAmYWRldi0+dmNuLmRwZ19zcmFtX2dwdV9hZGRyLAorCQkJ
CSAgICAgICh2b2lkICoqKSZhZGV2LT52Y24uZHBnX3NyYW1fY3B1X2FkZHIpOwogCX0KIAotCWFt
ZGdwdV9ib19mcmVlX2tlcm5lbCgmYWRldi0+dmNuLmluc3RbMF0udmNwdV9ibywKLQkJCSAgICAg
ICZhZGV2LT52Y24uaW5zdFswXS5ncHVfYWRkciwKLQkJCSAgICAgICh2b2lkICoqKSZhZGV2LT52
Y24uaW5zdFswXS5jcHVfYWRkcik7CisJZm9yIChqID0gMDsgaiA8IGFkZXYtPnZjbi5udW1fdmNu
X2luc3Q7ICsraikgeworCQlrdmZyZWUoYWRldi0+dmNuLmluc3Rbal0uc2F2ZWRfYm8pOwogCi0J
YW1kZ3B1X3JpbmdfZmluaSgmYWRldi0+dmNuLmluc3RbMF0ucmluZ19kZWMpOworCQlhbWRncHVf
Ym9fZnJlZV9rZXJuZWwoJmFkZXYtPnZjbi5pbnN0W2pdLnZjcHVfYm8sCisJCQkJCSAgJmFkZXYt
PnZjbi5pbnN0W2pdLmdwdV9hZGRyLAorCQkJCQkgICh2b2lkICoqKSZhZGV2LT52Y24uaW5zdFtq
XS5jcHVfYWRkcik7CiAKLQlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7
ICsraSkKLQkJYW1kZ3B1X3JpbmdfZmluaSgmYWRldi0+dmNuLmluc3RbMF0ucmluZ19lbmNbaV0p
OworCQlhbWRncHVfcmluZ19maW5pKCZhZGV2LT52Y24uaW5zdFtqXS5yaW5nX2RlYyk7CiAKLQlh
bWRncHVfcmluZ19maW5pKCZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2pwZWcpOworCQlmb3IgKGkg
PSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7ICsraSkKKwkJCWFtZGdwdV9yaW5nX2Zp
bmkoJmFkZXYtPnZjbi5pbnN0W2pdLnJpbmdfZW5jW2ldKTsKKworCQlhbWRncHVfcmluZ19maW5p
KCZhZGV2LT52Y24uaW5zdFtqXS5yaW5nX2pwZWcpOworCX0KIAogCXJlbGVhc2VfZmlybXdhcmUo
YWRldi0+dmNuLmZ3KTsKIApAQCAtMTk4LDIxICsyMDMsMjMgQEAgaW50IGFtZGdwdV92Y25fc3Vz
cGVuZChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKIAl1bnNpZ25lZCBzaXplOwogCXZv
aWQgKnB0cjsKKwlpbnQgaTsKIAogCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmYWRldi0+dmNu
LmlkbGVfd29yayk7CiAKLQlpZiAoYWRldi0+dmNuLmluc3RbMF0udmNwdV9ibyA9PSBOVUxMKQot
CQlyZXR1cm4gMDsKKwlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV92Y25faW5zdDsgKytp
KSB7CisJCWlmIChhZGV2LT52Y24uaW5zdFtpXS52Y3B1X2JvID09IE5VTEwpCisJCQlyZXR1cm4g
MDsKIAotCXNpemUgPSBhbWRncHVfYm9fc2l6ZShhZGV2LT52Y24uaW5zdFswXS52Y3B1X2JvKTsK
LQlwdHIgPSBhZGV2LT52Y24uaW5zdFswXS5jcHVfYWRkcjsKKwkJc2l6ZSA9IGFtZGdwdV9ib19z
aXplKGFkZXYtPnZjbi5pbnN0W2ldLnZjcHVfYm8pOworCQlwdHIgPSBhZGV2LT52Y24uaW5zdFtp
XS5jcHVfYWRkcjsKIAotCWFkZXYtPnZjbi5pbnN0WzBdLnNhdmVkX2JvID0ga3ZtYWxsb2Moc2l6
ZSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFhZGV2LT52Y24uaW5zdFswXS5zYXZlZF9ibykKLQkJcmV0
dXJuIC1FTk9NRU07Ci0KLQltZW1jcHlfZnJvbWlvKGFkZXYtPnZjbi5pbnN0WzBdLnNhdmVkX2Jv
LCBwdHIsIHNpemUpOworCQlhZGV2LT52Y24uaW5zdFtpXS5zYXZlZF9ibyA9IGt2bWFsbG9jKHNp
emUsIEdGUF9LRVJORUwpOworCQlpZiAoIWFkZXYtPnZjbi5pbnN0W2ldLnNhdmVkX2JvKQorCQkJ
cmV0dXJuIC1FTk9NRU07CiAKKwkJbWVtY3B5X2Zyb21pbyhhZGV2LT52Y24uaW5zdFtpXS5zYXZl
ZF9ibywgcHRyLCBzaXplKTsKKwl9CiAJcmV0dXJuIDA7CiB9CiAKQEAgLTIyMCwzMiArMjI3LDM0
IEBAIGludCBhbWRncHVfdmNuX3Jlc3VtZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsK
IAl1bnNpZ25lZCBzaXplOwogCXZvaWQgKnB0cjsKKwlpbnQgaTsKIAotCWlmIChhZGV2LT52Y24u
aW5zdFswXS52Y3B1X2JvID09IE5VTEwpCi0JCXJldHVybiAtRUlOVkFMOwotCi0Jc2l6ZSA9IGFt
ZGdwdV9ib19zaXplKGFkZXYtPnZjbi5pbnN0WzBdLnZjcHVfYm8pOwotCXB0ciA9IGFkZXYtPnZj
bi5pbnN0WzBdLmNwdV9hZGRyOwotCi0JaWYgKGFkZXYtPnZjbi5pbnN0WzBdLnNhdmVkX2JvICE9
IE5VTEwpIHsKLQkJbWVtY3B5X3RvaW8ocHRyLCBhZGV2LT52Y24uaW5zdFswXS5zYXZlZF9ibywg
c2l6ZSk7Ci0JCWt2ZnJlZShhZGV2LT52Y24uaW5zdFswXS5zYXZlZF9ibyk7Ci0JCWFkZXYtPnZj
bi5pbnN0WzBdLnNhdmVkX2JvID0gTlVMTDsKLQl9IGVsc2UgewotCQljb25zdCBzdHJ1Y3QgY29t
bW9uX2Zpcm13YXJlX2hlYWRlciAqaGRyOwotCQl1bnNpZ25lZCBvZmZzZXQ7Ci0KLQkJaGRyID0g
KGNvbnN0IHN0cnVjdCBjb21tb25fZmlybXdhcmVfaGVhZGVyICopYWRldi0+dmNuLmZ3LT5kYXRh
OwotCQlpZiAoYWRldi0+ZmlybXdhcmUubG9hZF90eXBlICE9IEFNREdQVV9GV19MT0FEX1BTUCkg
ewotCQkJb2Zmc2V0ID0gbGUzMl90b19jcHUoaGRyLT51Y29kZV9hcnJheV9vZmZzZXRfYnl0ZXMp
OwotCQkJbWVtY3B5X3RvaW8oYWRldi0+dmNuLmluc3RbMF0uY3B1X2FkZHIsIGFkZXYtPnZjbi5m
dy0+ZGF0YSArIG9mZnNldCwKLQkJCQkgICAgbGUzMl90b19jcHUoaGRyLT51Y29kZV9zaXplX2J5
dGVzKSk7Ci0JCQlzaXplIC09IGxlMzJfdG9fY3B1KGhkci0+dWNvZGVfc2l6ZV9ieXRlcyk7Ci0J
CQlwdHIgKz0gbGUzMl90b19jcHUoaGRyLT51Y29kZV9zaXplX2J5dGVzKTsKKwlmb3IgKGkgPSAw
OyBpIDwgYWRldi0+dmNuLm51bV92Y25faW5zdDsgKytpKSB7CisJCWlmIChhZGV2LT52Y24uaW5z
dFtpXS52Y3B1X2JvID09IE5VTEwpCisJCQlyZXR1cm4gLUVJTlZBTDsKKworCQlzaXplID0gYW1k
Z3B1X2JvX3NpemUoYWRldi0+dmNuLmluc3RbaV0udmNwdV9ibyk7CisJCXB0ciA9IGFkZXYtPnZj
bi5pbnN0W2ldLmNwdV9hZGRyOworCisJCWlmIChhZGV2LT52Y24uaW5zdFtpXS5zYXZlZF9ibyAh
PSBOVUxMKSB7CisJCQltZW1jcHlfdG9pbyhwdHIsIGFkZXYtPnZjbi5pbnN0W2ldLnNhdmVkX2Jv
LCBzaXplKTsKKwkJCWt2ZnJlZShhZGV2LT52Y24uaW5zdFtpXS5zYXZlZF9ibyk7CisJCQlhZGV2
LT52Y24uaW5zdFtpXS5zYXZlZF9ibyA9IE5VTEw7CisJCX0gZWxzZSB7CisJCQljb25zdCBzdHJ1
Y3QgY29tbW9uX2Zpcm13YXJlX2hlYWRlciAqaGRyOworCQkJdW5zaWduZWQgb2Zmc2V0OworCisJ
CQloZHIgPSAoY29uc3Qgc3RydWN0IGNvbW1vbl9maXJtd2FyZV9oZWFkZXIgKilhZGV2LT52Y24u
ZnctPmRhdGE7CisJCQlpZiAoYWRldi0+ZmlybXdhcmUubG9hZF90eXBlICE9IEFNREdQVV9GV19M
T0FEX1BTUCkgeworCQkJCW9mZnNldCA9IGxlMzJfdG9fY3B1KGhkci0+dWNvZGVfYXJyYXlfb2Zm
c2V0X2J5dGVzKTsKKwkJCQltZW1jcHlfdG9pbyhhZGV2LT52Y24uaW5zdFtpXS5jcHVfYWRkciwg
YWRldi0+dmNuLmZ3LT5kYXRhICsgb2Zmc2V0LAorCQkJCQkgICAgbGUzMl90b19jcHUoaGRyLT51
Y29kZV9zaXplX2J5dGVzKSk7CisJCQkJc2l6ZSAtPSBsZTMyX3RvX2NwdShoZHItPnVjb2RlX3Np
emVfYnl0ZXMpOworCQkJCXB0ciArPSBsZTMyX3RvX2NwdShoZHItPnVjb2RlX3NpemVfYnl0ZXMp
OworCQkJfQorCQkJbWVtc2V0X2lvKHB0ciwgMCwgc2l6ZSk7CiAJCX0KLQkJbWVtc2V0X2lvKHB0
ciwgMCwgc2l6ZSk7CiAJfQotCiAJcmV0dXJuIDA7CiB9CiAKQEAgLTI1MywzMSArMjYyLDM0IEBA
IHN0YXRpYyB2b2lkIGFtZGdwdV92Y25faWRsZV93b3JrX2hhbmRsZXIoc3RydWN0IHdvcmtfc3Ry
dWN0ICp3b3JrKQogewogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0KIAkJY29udGFpbmVy
X29mKHdvcmssIHN0cnVjdCBhbWRncHVfZGV2aWNlLCB2Y24uaWRsZV93b3JrLndvcmspOwotCXVu
c2lnbmVkIGludCBmZW5jZXMgPSAwOwotCXVuc2lnbmVkIGludCBpOworCXVuc2lnbmVkIGludCBm
ZW5jZXMgPSAwLCBmZW5jZVtBTURHUFVfTUFYX1ZDTl9JTlNUQU5DRVNdID0gezB9OworCXVuc2ln
bmVkIGludCBpLCBqOwogCi0JZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fZW5jX3Jpbmdz
OyArK2kpIHsKLQkJZmVuY2VzICs9IGFtZGdwdV9mZW5jZV9jb3VudF9lbWl0dGVkKCZhZGV2LT52
Y24uaW5zdFswXS5yaW5nX2VuY1tpXSk7Ci0JfQorCWZvciAoaiA9IDA7IGogPCBhZGV2LT52Y24u
bnVtX3Zjbl9pbnN0OyArK2opIHsKKwkJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fZW5j
X3JpbmdzOyArK2kpIHsKKwkJCWZlbmNlW2pdICs9IGFtZGdwdV9mZW5jZV9jb3VudF9lbWl0dGVk
KCZhZGV2LT52Y24uaW5zdFtqXS5yaW5nX2VuY1tpXSk7CisJCX0KIAotCWlmIChhZGV2LT5wZ19m
bGFncyAmIEFNRF9QR19TVVBQT1JUX1ZDTl9EUEcpCXsKLQkJc3RydWN0IGRwZ19wYXVzZV9zdGF0
ZSBuZXdfc3RhdGU7CisJCWlmIChhZGV2LT5wZ19mbGFncyAmIEFNRF9QR19TVVBQT1JUX1ZDTl9E
UEcpCXsKKwkJCXN0cnVjdCBkcGdfcGF1c2Vfc3RhdGUgbmV3X3N0YXRlOwogCi0JCWlmIChmZW5j
ZXMpCi0JCQluZXdfc3RhdGUuZndfYmFzZWQgPSBWQ05fRFBHX1NUQVRFX19QQVVTRTsKLQkJZWxz
ZQotCQkJbmV3X3N0YXRlLmZ3X2Jhc2VkID0gVkNOX0RQR19TVEFURV9fVU5QQVVTRTsKKwkJCWlm
IChmZW5jZVtqXSkKKwkJCQluZXdfc3RhdGUuZndfYmFzZWQgPSBWQ05fRFBHX1NUQVRFX19QQVVT
RTsKKwkJCWVsc2UKKwkJCQluZXdfc3RhdGUuZndfYmFzZWQgPSBWQ05fRFBHX1NUQVRFX19VTlBB
VVNFOwogCi0JCWlmIChhbWRncHVfZmVuY2VfY291bnRfZW1pdHRlZCgmYWRldi0+dmNuLmluc3Rb
MF0ucmluZ19qcGVnKSkKLQkJCW5ld19zdGF0ZS5qcGVnID0gVkNOX0RQR19TVEFURV9fUEFVU0U7
Ci0JCWVsc2UKLQkJCW5ld19zdGF0ZS5qcGVnID0gVkNOX0RQR19TVEFURV9fVU5QQVVTRTsKKwkJ
CWlmIChhbWRncHVfZmVuY2VfY291bnRfZW1pdHRlZCgmYWRldi0+dmNuLmluc3Rbal0ucmluZ19q
cGVnKSkKKwkJCQluZXdfc3RhdGUuanBlZyA9IFZDTl9EUEdfU1RBVEVfX1BBVVNFOworCQkJZWxz
ZQorCQkJCW5ld19zdGF0ZS5qcGVnID0gVkNOX0RQR19TVEFURV9fVU5QQVVTRTsKIAotCQlhZGV2
LT52Y24ucGF1c2VfZHBnX21vZGUoYWRldiwgJm5ld19zdGF0ZSk7Ci0JfQorCQkJYWRldi0+dmNu
LnBhdXNlX2RwZ19tb2RlKGFkZXYsICZuZXdfc3RhdGUpOworCQl9CiAKLQlmZW5jZXMgKz0gYW1k
Z3B1X2ZlbmNlX2NvdW50X2VtaXR0ZWQoJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfanBlZyk7Ci0J
ZmVuY2VzICs9IGFtZGdwdV9mZW5jZV9jb3VudF9lbWl0dGVkKCZhZGV2LT52Y24uaW5zdFswXS5y
aW5nX2RlYyk7CisJCWZlbmNlW2pdICs9IGFtZGdwdV9mZW5jZV9jb3VudF9lbWl0dGVkKCZhZGV2
LT52Y24uaW5zdFtqXS5yaW5nX2pwZWcpOworCQlmZW5jZVtqXSArPSBhbWRncHVfZmVuY2VfY291
bnRfZW1pdHRlZCgmYWRldi0+dmNuLmluc3Rbal0ucmluZ19kZWMpOworCQlmZW5jZXMgKz0gZmVu
Y2Vbal07CisJfQogCiAJaWYgKGZlbmNlcyA9PSAwKSB7CiAJCWFtZGdwdV9nZnhfb2ZmX2N0cmwo
YWRldiwgdHJ1ZSk7CkBAIC0zMTEsMTQgKzMyMywxNCBAQCB2b2lkIGFtZGdwdV92Y25fcmluZ19i
ZWdpbl91c2Uoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nKQogCQl1bnNpZ25lZCBpbnQgaTsKIAog
CQlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7ICsraSkgewotCQkJZmVu
Y2VzICs9IGFtZGdwdV9mZW5jZV9jb3VudF9lbWl0dGVkKCZhZGV2LT52Y24uaW5zdFswXS5yaW5n
X2VuY1tpXSk7CisJCQlmZW5jZXMgKz0gYW1kZ3B1X2ZlbmNlX2NvdW50X2VtaXR0ZWQoJmFkZXYt
PnZjbi5pbnN0W3JpbmctPm1lXS5yaW5nX2VuY1tpXSk7CiAJCX0KIAkJaWYgKGZlbmNlcykKIAkJ
CW5ld19zdGF0ZS5md19iYXNlZCA9IFZDTl9EUEdfU1RBVEVfX1BBVVNFOwogCQllbHNlCiAJCQlu
ZXdfc3RhdGUuZndfYmFzZWQgPSBWQ05fRFBHX1NUQVRFX19VTlBBVVNFOwogCi0JCWlmIChhbWRn
cHVfZmVuY2VfY291bnRfZW1pdHRlZCgmYWRldi0+dmNuLmluc3RbMF0ucmluZ19qcGVnKSkKKwkJ
aWYgKGFtZGdwdV9mZW5jZV9jb3VudF9lbWl0dGVkKCZhZGV2LT52Y24uaW5zdFtyaW5nLT5tZV0u
cmluZ19qcGVnKSkKIAkJCW5ld19zdGF0ZS5qcGVnID0gVkNOX0RQR19TVEFURV9fUEFVU0U7CiAJ
CWVsc2UKIAkJCW5ld19zdGF0ZS5qcGVnID0gVkNOX0RQR19TVEFURV9fVU5QQVVTRTsKQEAgLTM0
NCw3ICszNTYsNyBAQCBpbnQgYW1kZ3B1X3Zjbl9kZWNfcmluZ190ZXN0X3Jpbmcoc3RydWN0IGFt
ZGdwdV9yaW5nICpyaW5nKQogCXVuc2lnbmVkIGk7CiAJaW50IHI7CiAKLQlXUkVHMzIoYWRldi0+
dmNuLmluc3RbMF0uZXh0ZXJuYWwuc2NyYXRjaDksIDB4Q0FGRURFQUQpOworCVdSRUczMihhZGV2
LT52Y24uaW5zdFtyaW5nLT5tZV0uZXh0ZXJuYWwuc2NyYXRjaDksIDB4Q0FGRURFQUQpOwogCXIg
PSBhbWRncHVfcmluZ19hbGxvYyhyaW5nLCAzKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CkBAIC0z
NTIsNyArMzY0LDcgQEAgaW50IGFtZGdwdV92Y25fZGVjX3JpbmdfdGVzdF9yaW5nKHN0cnVjdCBh
bWRncHVfcmluZyAqcmluZykKIAlhbWRncHVfcmluZ193cml0ZShyaW5nLCAweERFQURCRUVGKTsK
IAlhbWRncHVfcmluZ19jb21taXQocmluZyk7CiAJZm9yIChpID0gMDsgaSA8IGFkZXYtPnVzZWNf
dGltZW91dDsgaSsrKSB7Ci0JCXRtcCA9IFJSRUczMihhZGV2LT52Y24uaW5zdFswXS5leHRlcm5h
bC5zY3JhdGNoOSk7CisJCXRtcCA9IFJSRUczMihhZGV2LT52Y24uaW5zdFtyaW5nLT5tZV0uZXh0
ZXJuYWwuc2NyYXRjaDkpOwogCQlpZiAodG1wID09IDB4REVBREJFRUYpCiAJCQlicmVhazsKIAkJ
RFJNX1VERUxBWSgxKTsKQEAgLTY2Myw3ICs2NzUsNyBAQCBpbnQgYW1kZ3B1X3Zjbl9qcGVnX3Jp
bmdfdGVzdF9yaW5nKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykKIAl1bnNpZ25lZCBpOwogCWlu
dCByOwogCi0JV1JFRzMyKGFkZXYtPnZjbi5pbnN0WzBdLmV4dGVybmFsLmpwZWdfcGl0Y2gsIDB4
Q0FGRURFQUQpOworCVdSRUczMihhZGV2LT52Y24uaW5zdFtyaW5nLT5tZV0uZXh0ZXJuYWwuanBl
Z19waXRjaCwgMHhDQUZFREVBRCk7CiAJciA9IGFtZGdwdV9yaW5nX2FsbG9jKHJpbmcsIDMpOwog
CWlmIChyKQogCQlyZXR1cm4gcjsKQEAgLTY3Myw3ICs2ODUsNyBAQCBpbnQgYW1kZ3B1X3Zjbl9q
cGVnX3JpbmdfdGVzdF9yaW5nKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykKIAlhbWRncHVfcmlu
Z19jb21taXQocmluZyk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dXNlY190aW1lb3V0OyBp
KyspIHsKLQkJdG1wID0gUlJFRzMyKGFkZXYtPnZjbi5pbnN0WzBdLmV4dGVybmFsLmpwZWdfcGl0
Y2gpOworCQl0bXAgPSBSUkVHMzIoYWRldi0+dmNuLmluc3RbcmluZy0+bWVdLmV4dGVybmFsLmpw
ZWdfcGl0Y2gpOwogCQlpZiAodG1wID09IDB4REVBREJFRUYpCiAJCQlicmVhazsKIAkJRFJNX1VE
RUxBWSgxKTsKQEAgLTc0Nyw3ICs3NTksNyBAQCBpbnQgYW1kZ3B1X3Zjbl9qcGVnX3JpbmdfdGVz
dF9pYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIGxvbmcgdGltZW91dCkKIAl9CiAKIAlmb3Ig
KGkgPSAwOyBpIDwgYWRldi0+dXNlY190aW1lb3V0OyBpKyspIHsKLQkJdG1wID0gUlJFRzMyKGFk
ZXYtPnZjbi5pbnN0WzBdLmV4dGVybmFsLmpwZWdfcGl0Y2gpOworCQl0bXAgPSBSUkVHMzIoYWRl
di0+dmNuLmluc3RbcmluZy0+bWVdLmV4dGVybmFsLmpwZWdfcGl0Y2gpOwogCQlpZiAodG1wID09
IDB4REVBREJFRUYpCiAJCQlicmVhazsKIAkJRFJNX1VERUxBWSgxKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3Zjbl92Ml81LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS92Y25fdjJfNS5jCmluZGV4IGUyNzM1MTI2N2M5ZS4uYjdkYzA2OWI2MzdjIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS92Y25fdjJfNS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3Zjbl92Ml81LmMKQEAgLTQ4LDYgKzQ4LDggQEAKIAogI2Rl
ZmluZSBtbVVWRF9KUEVHX1BJVENIX0lOVEVSTkFMX09GRlNFVAkJCTB4NDAxZgogCisjZGVmaW5l
IFZDTjI1X01BWF9IV19JTlNUQU5DRVNfQVJDVFVSVVMJCQkJMgorCiBzdGF0aWMgdm9pZCB2Y25f
djJfNV9zZXRfZGVjX3JpbmdfZnVuY3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpOwogc3Rh
dGljIHZvaWQgdmNuX3YyXzVfc2V0X2VuY19yaW5nX2Z1bmNzKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2KTsKIHN0YXRpYyB2b2lkIHZjbl92Ml81X3NldF9qcGVnX3JpbmdfZnVuY3Moc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYpOwpAQCAtNTUsNiArNTcsMTEgQEAgc3RhdGljIHZvaWQgdmNu
X3YyXzVfc2V0X2lycV9mdW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7CiBzdGF0aWMg
aW50IHZjbl92Ml81X3NldF9wb3dlcmdhdGluZ19zdGF0ZSh2b2lkICpoYW5kbGUsCiAJCQkJZW51
bSBhbWRfcG93ZXJnYXRpbmdfc3RhdGUgc3RhdGUpOwogCitzdGF0aWMgaW50IGFtZGdwdV9paF9j
bGllbnRpZF92Y25zW10gPSB7CisJU09DMTVfSUhfQ0xJRU5USURfVkNOLAorCVNPQzE1X0lIX0NM
SUVOVElEX1ZDTjEKK307CisKIC8qKgogICogdmNuX3YyXzVfZWFybHlfaW5pdCAtIHNldCBmdW5j
dGlvbiBwb2ludGVycwogICoKQEAgLTY1LDggKzcyLDExIEBAIHN0YXRpYyBpbnQgdmNuX3YyXzVf
c2V0X3Bvd2VyZ2F0aW5nX3N0YXRlKHZvaWQgKmhhbmRsZSwKIHN0YXRpYyBpbnQgdmNuX3YyXzVf
ZWFybHlfaW5pdCh2b2lkICpoYW5kbGUpCiB7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYg
PSAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKiloYW5kbGU7CisJaWYgKGFkZXYtPmFzaWNfdHlwZSA9
PSBDSElQX0FSQ1RVUlVTKQogCi0JYWRldi0+dmNuLm51bV92Y25faW5zdCA9IDE7CisJCWFkZXYt
PnZjbi5udW1fdmNuX2luc3QgPSBWQ04yNV9NQVhfSFdfSU5TVEFOQ0VTX0FSQ1RVUlVTOworCWVs
c2UKKwkJYWRldi0+dmNuLm51bV92Y25faW5zdCA9IDE7CiAJYWRldi0+dmNuLm51bV9lbmNfcmlu
Z3MgPSAyOwogCiAJdmNuX3YyXzVfc2V0X2RlY19yaW5nX2Z1bmNzKGFkZXYpOwpAQCAtODcsMjkg
Kzk3LDMxIEBAIHN0YXRpYyBpbnQgdmNuX3YyXzVfZWFybHlfaW5pdCh2b2lkICpoYW5kbGUpCiBz
dGF0aWMgaW50IHZjbl92Ml81X3N3X2luaXQodm9pZCAqaGFuZGxlKQogewogCXN0cnVjdCBhbWRn
cHVfcmluZyAqcmluZzsKLQlpbnQgaSwgcjsKKwlpbnQgaSwgaiwgcjsKIAlzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWhhbmRsZTsKIAotCS8qIFZD
TiBERUMgVFJBUCAqLwotCXIgPSBhbWRncHVfaXJxX2FkZF9pZChhZGV2LCBTT0MxNV9JSF9DTElF
TlRJRF9WQ04sCi0JCQlWQ05fMl8wX19TUkNJRF9fVVZEX1NZU1RFTV9NRVNTQUdFX0lOVEVSUlVQ
VCwgJmFkZXYtPnZjbi5pbnN0WzBdLmlycSk7Ci0JaWYgKHIpCi0JCXJldHVybiByOworCWZvciAo
aiA9IDA7IGogPCBhZGV2LT52Y24ubnVtX3Zjbl9pbnN0OyBqKyspIHsKKwkJLyogVkNOIERFQyBU
UkFQICovCisJCXIgPSBhbWRncHVfaXJxX2FkZF9pZChhZGV2LCBhbWRncHVfaWhfY2xpZW50aWRf
dmNuc1tqXSwKKwkJCQlWQ05fMl8wX19TUkNJRF9fVVZEX1NZU1RFTV9NRVNTQUdFX0lOVEVSUlVQ
VCwgJmFkZXYtPnZjbi5pbnN0W2pdLmlycSk7CisJCWlmIChyKQorCQkJcmV0dXJuIHI7CisKKwkJ
LyogVkNOIEVOQyBUUkFQICovCisJCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX2VuY19y
aW5nczsgKytpKSB7CisJCQlyID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRldiwgYW1kZ3B1X2loX2Ns
aWVudGlkX3ZjbnNbal0sCisJCQkJaSArIFZDTl8yXzBfX1NSQ0lEX19VVkRfRU5DX0dFTkVSQUxf
UFVSUE9TRSwgJmFkZXYtPnZjbi5pbnN0W2pdLmlycSk7CisJCQlpZiAocikKKwkJCQlyZXR1cm4g
cjsKKwkJfQogCi0JLyogVkNOIEVOQyBUUkFQICovCi0JZm9yIChpID0gMDsgaSA8IGFkZXYtPnZj
bi5udW1fZW5jX3JpbmdzOyArK2kpIHsKLQkJciA9IGFtZGdwdV9pcnFfYWRkX2lkKGFkZXYsIFNP
QzE1X0lIX0NMSUVOVElEX1ZDTiwKLQkJCWkgKyBWQ05fMl8wX19TUkNJRF9fVVZEX0VOQ19HRU5F
UkFMX1BVUlBPU0UsICZhZGV2LT52Y24uaW5zdFswXS5pcnEpOworCQkvKiBWQ04gSlBFRyBUUkFQ
ICovCisJCXIgPSBhbWRncHVfaXJxX2FkZF9pZChhZGV2LCBhbWRncHVfaWhfY2xpZW50aWRfdmNu
c1tqXSwKKwkJCQlWQ05fMl8wX19TUkNJRF9fSlBFR19ERUNPREUsICZhZGV2LT52Y24uaW5zdFtq
XS5pcnEpOwogCQlpZiAocikKIAkJCXJldHVybiByOwogCX0KIAotCS8qIFZDTiBKUEVHIFRSQVAg
Ki8KLQlyID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRldiwgU09DMTVfSUhfQ0xJRU5USURfVkNOLAot
CQkJVkNOXzJfMF9fU1JDSURfX0pQRUdfREVDT0RFLCAmYWRldi0+dmNuLmluc3RbMF0uaXJxKTsK
LQlpZiAocikKLQkJcmV0dXJuIHI7Ci0KIAlyID0gYW1kZ3B1X3Zjbl9zd19pbml0KGFkZXYpOwog
CWlmIChyKQogCQlyZXR1cm4gcjsKQEAgLTEyMSw2ICsxMzMsMTMgQEAgc3RhdGljIGludCB2Y25f
djJfNV9zd19pbml0KHZvaWQgKmhhbmRsZSkKIAkJYWRldi0+ZmlybXdhcmUudWNvZGVbQU1ER1BV
X1VDT0RFX0lEX1ZDTl0uZncgPSBhZGV2LT52Y24uZnc7CiAJCWFkZXYtPmZpcm13YXJlLmZ3X3Np
emUgKz0KIAkJCUFMSUdOKGxlMzJfdG9fY3B1KGhkci0+dWNvZGVfc2l6ZV9ieXRlcyksIFBBR0Vf
U0laRSk7CisKKwkJaWYgKGFkZXYtPnZjbi5udW1fdmNuX2luc3QgPT0gVkNOMjVfTUFYX0hXX0lO
U1RBTkNFU19BUkNUVVJVUykgeworCQkJYWRldi0+ZmlybXdhcmUudWNvZGVbQU1ER1BVX1VDT0RF
X0lEX1ZDTjFdLnVjb2RlX2lkID0gQU1ER1BVX1VDT0RFX0lEX1ZDTjE7CisJCQlhZGV2LT5maXJt
d2FyZS51Y29kZVtBTURHUFVfVUNPREVfSURfVkNOMV0uZncgPSBhZGV2LT52Y24uZnc7CisJCQlh
ZGV2LT5maXJtd2FyZS5md19zaXplICs9CisJCQkJQUxJR04obGUzMl90b19jcHUoaGRyLT51Y29k
ZV9zaXplX2J5dGVzKSwgUEFHRV9TSVpFKTsKKwkJfQogCQlEUk1fSU5GTygiUFNQIGxvYWRpbmcg
VkNOIGZpcm13YXJlXG4iKTsKIAl9CiAKQEAgLTEyOCw1MiArMTQ3LDU0IEBAIHN0YXRpYyBpbnQg
dmNuX3YyXzVfc3dfaW5pdCh2b2lkICpoYW5kbGUpCiAJaWYgKHIpCiAJCXJldHVybiByOwogCi0J
cmluZyA9ICZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2RlYzsKLQlyaW5nLT51c2VfZG9vcmJlbGwg
PSB0cnVlOwotCXJpbmctPmRvb3JiZWxsX2luZGV4ID0gYWRldi0+ZG9vcmJlbGxfaW5kZXgudmNu
LnZjbl9yaW5nMF8xIDw8IDE7Ci0Jc3ByaW50ZihyaW5nLT5uYW1lLCAidmNuX2RlYyIpOwotCXIg
PSBhbWRncHVfcmluZ19pbml0KGFkZXYsIHJpbmcsIDUxMiwgJmFkZXYtPnZjbi5pbnN0WzBdLmly
cSwgMCk7Ci0JaWYgKHIpCi0JCXJldHVybiByOwotCi0JYWRldi0+dmNuLmludGVybmFsLmNvbnRl
eHRfaWQgPSBtbVVWRF9DT05URVhUX0lEX0lOVEVSTkFMX09GRlNFVDsKLQlhZGV2LT52Y24uaW50
ZXJuYWwuaWJfdm1pZCA9IG1tVVZEX0xNSV9SQkNfSUJfVk1JRF9JTlRFUk5BTF9PRkZTRVQ7Ci0J
YWRldi0+dmNuLmludGVybmFsLmliX2Jhcl9sb3cgPSBtbVVWRF9MTUlfUkJDX0lCXzY0QklUX0JB
Ul9MT1dfSU5URVJOQUxfT0ZGU0VUOwotCWFkZXYtPnZjbi5pbnRlcm5hbC5pYl9iYXJfaGlnaCA9
IG1tVVZEX0xNSV9SQkNfSUJfNjRCSVRfQkFSX0hJR0hfSU5URVJOQUxfT0ZGU0VUOwotCWFkZXYt
PnZjbi5pbnRlcm5hbC5pYl9zaXplID0gbW1VVkRfUkJDX0lCX1NJWkVfSU5URVJOQUxfT0ZGU0VU
OwotCWFkZXYtPnZjbi5pbnRlcm5hbC5ncF9zY3JhdGNoOCA9IG1tVVZEX0dQX1NDUkFUQ0g4X0lO
VEVSTkFMX09GRlNFVDsKLQotCWFkZXYtPnZjbi5pbnRlcm5hbC5zY3JhdGNoOSA9IG1tVVZEX1ND
UkFUQ0g5X0lOVEVSTkFMX09GRlNFVDsKLQlhZGV2LT52Y24uaW5zdFswXS5leHRlcm5hbC5zY3Jh
dGNoOSA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBtbVVWRF9TQ1JBVENIOSk7Ci0JYWRldi0+
dmNuLmludGVybmFsLmRhdGEwID0gbW1VVkRfR1BDT01fVkNQVV9EQVRBMF9JTlRFUk5BTF9PRkZT
RVQ7Ci0JYWRldi0+dmNuLmluc3RbMF0uZXh0ZXJuYWwuZGF0YTAgPSBTT0MxNV9SRUdfT0ZGU0VU
KFVWRCwgMCwgbW1VVkRfR1BDT01fVkNQVV9EQVRBMCk7Ci0JYWRldi0+dmNuLmludGVybmFsLmRh
dGExID0gbW1VVkRfR1BDT01fVkNQVV9EQVRBMV9JTlRFUk5BTF9PRkZTRVQ7Ci0JYWRldi0+dmNu
Lmluc3RbMF0uZXh0ZXJuYWwuZGF0YTEgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRf
R1BDT01fVkNQVV9EQVRBMSk7Ci0JYWRldi0+dmNuLmludGVybmFsLmNtZCA9IG1tVVZEX0dQQ09N
X1ZDUFVfQ01EX0lOVEVSTkFMX09GRlNFVDsKLQlhZGV2LT52Y24uaW5zdFswXS5leHRlcm5hbC5j
bWQgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfR1BDT01fVkNQVV9DTUQpOwotCWFk
ZXYtPnZjbi5pbnRlcm5hbC5ub3AgPSBtbVVWRF9OT19PUF9JTlRFUk5BTF9PRkZTRVQ7Ci0JYWRl
di0+dmNuLmluc3RbMF0uZXh0ZXJuYWwubm9wID0gU09DMTVfUkVHX09GRlNFVChVVkQsIDAsIG1t
VVZEX05PX09QKTsKLQotCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX2VuY19yaW5nczsg
KytpKSB7Ci0JCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19lbmNbaV07CisJZm9yIChq
ID0gMDsgaiA8IGFkZXYtPnZjbi5udW1fdmNuX2luc3Q7IGorKykgeworCQlhZGV2LT52Y24uaW50
ZXJuYWwuY29udGV4dF9pZCA9IG1tVVZEX0NPTlRFWFRfSURfSU5URVJOQUxfT0ZGU0VUOworCQlh
ZGV2LT52Y24uaW50ZXJuYWwuaWJfdm1pZCA9IG1tVVZEX0xNSV9SQkNfSUJfVk1JRF9JTlRFUk5B
TF9PRkZTRVQ7CisJCWFkZXYtPnZjbi5pbnRlcm5hbC5pYl9iYXJfbG93ID0gbW1VVkRfTE1JX1JC
Q19JQl82NEJJVF9CQVJfTE9XX0lOVEVSTkFMX09GRlNFVDsKKwkJYWRldi0+dmNuLmludGVybmFs
LmliX2Jhcl9oaWdoID0gbW1VVkRfTE1JX1JCQ19JQl82NEJJVF9CQVJfSElHSF9JTlRFUk5BTF9P
RkZTRVQ7CisJCWFkZXYtPnZjbi5pbnRlcm5hbC5pYl9zaXplID0gbW1VVkRfUkJDX0lCX1NJWkVf
SU5URVJOQUxfT0ZGU0VUOworCQlhZGV2LT52Y24uaW50ZXJuYWwuZ3Bfc2NyYXRjaDggPSBtbVVW
RF9HUF9TQ1JBVENIOF9JTlRFUk5BTF9PRkZTRVQ7CisKKwkJYWRldi0+dmNuLmludGVybmFsLnNj
cmF0Y2g5ID0gbW1VVkRfU0NSQVRDSDlfSU5URVJOQUxfT0ZGU0VUOworCQlhZGV2LT52Y24uaW5z
dFtqXS5leHRlcm5hbC5zY3JhdGNoOSA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCBqLCBtbVVWRF9T
Q1JBVENIOSk7CisJCWFkZXYtPnZjbi5pbnRlcm5hbC5kYXRhMCA9IG1tVVZEX0dQQ09NX1ZDUFVf
REFUQTBfSU5URVJOQUxfT0ZGU0VUOworCQlhZGV2LT52Y24uaW5zdFtqXS5leHRlcm5hbC5kYXRh
MCA9IFNPQzE1X1JFR19PRkZTRVQoVVZELCBqLCBtbVVWRF9HUENPTV9WQ1BVX0RBVEEwKTsKKwkJ
YWRldi0+dmNuLmludGVybmFsLmRhdGExID0gbW1VVkRfR1BDT01fVkNQVV9EQVRBMV9JTlRFUk5B
TF9PRkZTRVQ7CisJCWFkZXYtPnZjbi5pbnN0W2pdLmV4dGVybmFsLmRhdGExID0gU09DMTVfUkVH
X09GRlNFVChVVkQsIGosIG1tVVZEX0dQQ09NX1ZDUFVfREFUQTEpOworCQlhZGV2LT52Y24uaW50
ZXJuYWwuY21kID0gbW1VVkRfR1BDT01fVkNQVV9DTURfSU5URVJOQUxfT0ZGU0VUOworCQlhZGV2
LT52Y24uaW5zdFtqXS5leHRlcm5hbC5jbWQgPSBTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgaiwgbW1V
VkRfR1BDT01fVkNQVV9DTUQpOworCQlhZGV2LT52Y24uaW50ZXJuYWwubm9wID0gbW1VVkRfTk9f
T1BfSU5URVJOQUxfT0ZGU0VUOworCQlhZGV2LT52Y24uaW5zdFtqXS5leHRlcm5hbC5ub3AgPSBT
T0MxNV9SRUdfT0ZGU0VUKFVWRCwgaiwgbW1VVkRfTk9fT1ApOworCisJCWFkZXYtPnZjbi5pbnRl
cm5hbC5qcGVnX3BpdGNoID0gbW1VVkRfSlBFR19QSVRDSF9JTlRFUk5BTF9PRkZTRVQ7CisJCWFk
ZXYtPnZjbi5pbnN0W2pdLmV4dGVybmFsLmpwZWdfcGl0Y2ggPSBTT0MxNV9SRUdfT0ZGU0VUKFVW
RCwgaiwgbW1VVkRfSlBFR19QSVRDSCk7CisKKwkJcmluZyA9ICZhZGV2LT52Y24uaW5zdFtqXS5y
aW5nX2RlYzsKIAkJcmluZy0+dXNlX2Rvb3JiZWxsID0gdHJ1ZTsKLQkJcmluZy0+ZG9vcmJlbGxf
aW5kZXggPSAoYWRldi0+ZG9vcmJlbGxfaW5kZXgudmNuLnZjbl9yaW5nMF8xIDw8IDEpICsgMiAr
IGk7Ci0JCXNwcmludGYocmluZy0+bmFtZSwgInZjbl9lbmMlZCIsIGkpOwotCQlyID0gYW1kZ3B1
X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaW5zdFswXS5pcnEsIDApOwor
CQlyaW5nLT5kb29yYmVsbF9pbmRleCA9IChhZGV2LT5kb29yYmVsbF9pbmRleC52Y24udmNuX3Jp
bmcwXzEgPDwgMSkgKyA4Kmo7CisJCXNwcmludGYocmluZy0+bmFtZSwgInZjbl9kZWNfJWQiLCBq
KTsKKwkJciA9IGFtZGdwdV9yaW5nX2luaXQoYWRldiwgcmluZywgNTEyLCAmYWRldi0+dmNuLmlu
c3Rbal0uaXJxLCAwKTsKIAkJaWYgKHIpCiAJCQlyZXR1cm4gcjsKLQl9CiAKLQlyaW5nID0gJmFk
ZXYtPnZjbi5pbnN0WzBdLnJpbmdfanBlZzsKLQlyaW5nLT51c2VfZG9vcmJlbGwgPSB0cnVlOwot
CXJpbmctPmRvb3JiZWxsX2luZGV4ID0gKGFkZXYtPmRvb3JiZWxsX2luZGV4LnZjbi52Y25fcmlu
ZzBfMSA8PCAxKSArIDE7Ci0Jc3ByaW50ZihyaW5nLT5uYW1lLCAidmNuX2pwZWciKTsKLQlyID0g
YW1kZ3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaW5zdFswXS5pcnEs
IDApOwotCWlmIChyKQotCQlyZXR1cm4gcjsKKwkJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5u
dW1fZW5jX3JpbmdzOyArK2kpIHsKKwkJCXJpbmcgPSAmYWRldi0+dmNuLmluc3Rbal0ucmluZ19l
bmNbaV07CisJCQlyaW5nLT51c2VfZG9vcmJlbGwgPSB0cnVlOworCQkJcmluZy0+ZG9vcmJlbGxf
aW5kZXggPSAoYWRldi0+ZG9vcmJlbGxfaW5kZXgudmNuLnZjbl9yaW5nMF8xIDw8IDEpICsgMiAr
IGkgKyA4Kmo7CisJCQlzcHJpbnRmKHJpbmctPm5hbWUsICJ2Y25fZW5jXyVkLiVkIiwgaiwgaSk7
CisJCQlyID0gYW1kZ3B1X3JpbmdfaW5pdChhZGV2LCByaW5nLCA1MTIsICZhZGV2LT52Y24uaW5z
dFtqXS5pcnEsIDApOworCQkJaWYgKHIpCisJCQkJcmV0dXJuIHI7CisJCX0KIAotCWFkZXYtPnZj
bi5pbnRlcm5hbC5qcGVnX3BpdGNoID0gbW1VVkRfSlBFR19QSVRDSF9JTlRFUk5BTF9PRkZTRVQ7
Ci0JYWRldi0+dmNuLmluc3RbMF0uZXh0ZXJuYWwuanBlZ19waXRjaCA9IFNPQzE1X1JFR19PRkZT
RVQoVVZELCAwLCBtbVVWRF9KUEVHX1BJVENIKTsKKwkJcmluZyA9ICZhZGV2LT52Y24uaW5zdFtq
XS5yaW5nX2pwZWc7CisJCXJpbmctPnVzZV9kb29yYmVsbCA9IHRydWU7CisJCXJpbmctPmRvb3Ji
ZWxsX2luZGV4ID0gKGFkZXYtPmRvb3JiZWxsX2luZGV4LnZjbi52Y25fcmluZzBfMSA8PCAxKSAr
IDEgKyA4Kmo7CisJCXNwcmludGYocmluZy0+bmFtZSwgInZjbl9qcGVnXyVkIiwgaik7CisJCXIg
PSBhbWRncHVfcmluZ19pbml0KGFkZXYsIHJpbmcsIDUxMiwgJmFkZXYtPnZjbi5pbnN0W2pdLmly
cSwgMCk7CisJCWlmIChyKQorCQkJcmV0dXJuIHI7CisJfQogCiAJcmV0dXJuIDA7CiB9CkBAIC0y
MDksMzYgKzIzMCwzOSBAQCBzdGF0aWMgaW50IHZjbl92Ml81X3N3X2Zpbmkodm9pZCAqaGFuZGxl
KQogc3RhdGljIGludCB2Y25fdjJfNV9od19pbml0KHZvaWQgKmhhbmRsZSkKIHsKIAlzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWhhbmRsZTsKLQlz
dHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19kZWM7Ci0J
aW50IGksIHI7CisJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nOworCWludCBpLCBqLCByOwogCi0J
YWRldi0+bmJpb19mdW5jcy0+dmNuX2Rvb3JiZWxsX3JhbmdlKGFkZXYsIHJpbmctPnVzZV9kb29y
YmVsbCwKLQkJCQkJICAgICByaW5nLT5kb29yYmVsbF9pbmRleCwgMCk7CisJZm9yIChqID0gMDsg
aiA8IGFkZXYtPnZjbi5udW1fdmNuX2luc3Q7ICsraikgeworCQlyaW5nID0gJmFkZXYtPnZjbi5p
bnN0W2pdLnJpbmdfZGVjOwogCi0JciA9IGFtZGdwdV9yaW5nX3Rlc3RfcmluZyhyaW5nKTsKLQlp
ZiAocikgewotCQlyaW5nLT5zY2hlZC5yZWFkeSA9IGZhbHNlOwotCQlnb3RvIGRvbmU7Ci0JfQor
CQlhZGV2LT5uYmlvX2Z1bmNzLT52Y25fZG9vcmJlbGxfcmFuZ2UoYWRldiwgcmluZy0+dXNlX2Rv
b3JiZWxsLAorCQkJCQkJICAgICByaW5nLT5kb29yYmVsbF9pbmRleCwgaik7CiAKLQlmb3IgKGkg
PSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7ICsraSkgewotCQlyaW5nID0gJmFkZXYt
PnZjbi5pbnN0WzBdLnJpbmdfZW5jW2ldOwotCQlyaW5nLT5zY2hlZC5yZWFkeSA9IGZhbHNlOwot
CQljb250aW51ZTsKIAkJciA9IGFtZGdwdV9yaW5nX3Rlc3RfcmluZyhyaW5nKTsKIAkJaWYgKHIp
IHsKIAkJCXJpbmctPnNjaGVkLnJlYWR5ID0gZmFsc2U7CiAJCQlnb3RvIGRvbmU7CiAJCX0KLQl9
CiAKLQlyaW5nID0gJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfanBlZzsKLQlyID0gYW1kZ3B1X3Jp
bmdfdGVzdF9yaW5nKHJpbmcpOwotCWlmIChyKSB7Ci0JCXJpbmctPnNjaGVkLnJlYWR5ID0gZmFs
c2U7Ci0JCWdvdG8gZG9uZTsKLQl9CisJCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX2Vu
Y19yaW5nczsgKytpKSB7CisJCQlyaW5nID0gJmFkZXYtPnZjbi5pbnN0W2pdLnJpbmdfZW5jW2ld
OworCQkJcmluZy0+c2NoZWQucmVhZHkgPSBmYWxzZTsKKwkJCWNvbnRpbnVlOworCQkJciA9IGFt
ZGdwdV9yaW5nX3Rlc3RfcmluZyhyaW5nKTsKKwkJCWlmIChyKSB7CisJCQkJcmluZy0+c2NoZWQu
cmVhZHkgPSBmYWxzZTsKKwkJCQlnb3RvIGRvbmU7CisJCQl9CisJCX0KIAorCQlyaW5nID0gJmFk
ZXYtPnZjbi5pbnN0W2pdLnJpbmdfanBlZzsKKwkJciA9IGFtZGdwdV9yaW5nX3Rlc3RfcmluZyhy
aW5nKTsKKwkJaWYgKHIpIHsKKwkJCXJpbmctPnNjaGVkLnJlYWR5ID0gZmFsc2U7CisJCQlnb3Rv
IGRvbmU7CisJCX0KKwl9CiBkb25lOgogCWlmICghcikKIAkJRFJNX0lORk8oIlZDTiBkZWNvZGUg
YW5kIGVuY29kZSBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuXG4iKTsKQEAgLTI1NiwyMSArMjgw
LDI1IEBAIHN0YXRpYyBpbnQgdmNuX3YyXzVfaHdfaW5pdCh2b2lkICpoYW5kbGUpCiBzdGF0aWMg
aW50IHZjbl92Ml81X2h3X2Zpbmkodm9pZCAqaGFuZGxlKQogewogCXN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopaGFuZGxlOwotCXN0cnVjdCBhbWRn
cHVfcmluZyAqcmluZyA9ICZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2RlYzsKKwlzdHJ1Y3QgYW1k
Z3B1X3JpbmcgKnJpbmc7CiAJaW50IGk7CiAKLQlpZiAoUlJFRzMyX1NPQzE1KFZDTiwgMCwgbW1V
VkRfU1RBVFVTKSkKLQkJdmNuX3YyXzVfc2V0X3Bvd2VyZ2F0aW5nX3N0YXRlKGFkZXYsIEFNRF9Q
R19TVEFURV9HQVRFKTsKKwlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV92Y25faW5zdDsg
KytpKSB7CisJCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbaV0ucmluZ19kZWM7CiAKLQlyaW5nLT5z
Y2hlZC5yZWFkeSA9IGZhbHNlOworCQlpZiAoUlJFRzMyX1NPQzE1KFZDTiwgaSwgbW1VVkRfU1RB
VFVTKSkKKwkJCXZjbl92Ml81X3NldF9wb3dlcmdhdGluZ19zdGF0ZShhZGV2LCBBTURfUEdfU1RB
VEVfR0FURSk7CiAKLQlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmluZ3M7ICsr
aSkgewotCQlyaW5nID0gJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfZW5jW2ldOwogCQlyaW5nLT5z
Y2hlZC5yZWFkeSA9IGZhbHNlOwotCX0KIAotCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0ucmlu
Z19qcGVnOwotCXJpbmctPnNjaGVkLnJlYWR5ID0gZmFsc2U7CisJCWZvciAoaSA9IDA7IGkgPCBh
ZGV2LT52Y24ubnVtX2VuY19yaW5nczsgKytpKSB7CisJCQlyaW5nID0gJmFkZXYtPnZjbi5pbnN0
W2ldLnJpbmdfZW5jW2ldOworCQkJcmluZy0+c2NoZWQucmVhZHkgPSBmYWxzZTsKKwkJfQorCisJ
CXJpbmcgPSAmYWRldi0+dmNuLmluc3RbaV0ucmluZ19qcGVnOworCQlyaW5nLT5zY2hlZC5yZWFk
eSA9IGZhbHNlOworCX0KIAogCXJldHVybiAwOwogfQpAQCAtMzI4LDQ0ICszNTYsNDcgQEAgc3Rh
dGljIHZvaWQgdmNuX3YyXzVfbWNfcmVzdW1lKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQog
ewogCXVpbnQzMl90IHNpemUgPSBBTURHUFVfR1BVX1BBR0VfQUxJR04oYWRldi0+dmNuLmZ3LT5z
aXplICsgNCk7CiAJdWludDMyX3Qgb2Zmc2V0OworCWludCBpOwogCi0JLyogY2FjaGUgd2luZG93
IDA6IGZ3ICovCi0JaWYgKGFkZXYtPmZpcm13YXJlLmxvYWRfdHlwZSA9PSBBTURHUFVfRldfTE9B
RF9QU1ApIHsKLQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfTE1JX1ZDUFVfQ0FDSEVfNjRC
SVRfQkFSX0xPVywKLQkJCShhZGV2LT5maXJtd2FyZS51Y29kZVtBTURHUFVfVUNPREVfSURfVkNO
XS50bXJfbWNfYWRkcl9sbykpOwotCQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9MTUlfVkNQ
VV9DQUNIRV82NEJJVF9CQVJfSElHSCwKLQkJCShhZGV2LT5maXJtd2FyZS51Y29kZVtBTURHUFVf
VUNPREVfSURfVkNOXS50bXJfbWNfYWRkcl9oaSkpOwotCQlXUkVHMzJfU09DMTUoVVZELCAwLCBt
bVVWRF9WQ1BVX0NBQ0hFX09GRlNFVDAsIDApOwotCQlvZmZzZXQgPSAwOwotCX0gZWxzZSB7Ci0J
CVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFXzY0QklUX0JBUl9MT1cs
Ci0JCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0WzBdLmdwdV9hZGRyKSk7Ci0JCVdSRUcz
Ml9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFXzY0QklUX0JBUl9ISUdILAotCQkJ
dXBwZXJfMzJfYml0cyhhZGV2LT52Y24uaW5zdFswXS5ncHVfYWRkcikpOwotCQlvZmZzZXQgPSBz
aXplOwotCQkvKiBObyBzaWduZWQgaGVhZGVyIGZvciBub3cgZnJvbSBmaXJtd2FyZQotCQlXUkVH
MzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX09GRlNFVDAsCi0JCQlBTURHUFVfVVZE
X0ZJUk1XQVJFX09GRlNFVCA+PiAzKTsKLQkJKi8KLQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1V
VkRfVkNQVV9DQUNIRV9PRkZTRVQwLCAwKTsKKwlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51
bV92Y25faW5zdDsgKytpKSB7CisJCS8qIGNhY2hlIHdpbmRvdyAwOiBmdyAqLworCQlpZiAoYWRl
di0+ZmlybXdhcmUubG9hZF90eXBlID09IEFNREdQVV9GV19MT0FEX1BTUCkgeworCQkJV1JFRzMy
X1NPQzE1KFVWRCwgaSwgbW1VVkRfTE1JX1ZDUFVfQ0FDSEVfNjRCSVRfQkFSX0xPVywKKwkJCQko
YWRldi0+ZmlybXdhcmUudWNvZGVbQU1ER1BVX1VDT0RFX0lEX1ZDTl0udG1yX21jX2FkZHJfbG8p
KTsKKwkJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFXzY0QklUX0JB
Ul9ISUdILAorCQkJCShhZGV2LT5maXJtd2FyZS51Y29kZVtBTURHUFVfVUNPREVfSURfVkNOXS50
bXJfbWNfYWRkcl9oaSkpOworCQkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfVkNQVV9DQUNI
RV9PRkZTRVQwLCAwKTsKKwkJCW9mZnNldCA9IDA7CisJCX0gZWxzZSB7CisJCQlXUkVHMzJfU09D
MTUoVVZELCBpLCBtbVVWRF9MTUlfVkNQVV9DQUNIRV82NEJJVF9CQVJfTE9XLAorCQkJCWxvd2Vy
XzMyX2JpdHMoYWRldi0+dmNuLmluc3RbaV0uZ3B1X2FkZHIpKTsKKwkJCVdSRUczMl9TT0MxNShV
VkQsIGksIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFXzY0QklUX0JBUl9ISUdILAorCQkJCXVwcGVyXzMy
X2JpdHMoYWRldi0+dmNuLmluc3RbaV0uZ3B1X2FkZHIpKTsKKwkJCW9mZnNldCA9IHNpemU7CisJ
CQkvKiBObyBzaWduZWQgaGVhZGVyIGZvciBub3cgZnJvbSBmaXJtd2FyZQorCQkJV1JFRzMyX1NP
QzE1KFVWRCwgaSwgbW1VVkRfVkNQVV9DQUNIRV9PRkZTRVQwLAorCQkJCUFNREdQVV9VVkRfRklS
TVdBUkVfT0ZGU0VUID4+IDMpOworCQkJKi8KKwkJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZE
X1ZDUFVfQ0FDSEVfT0ZGU0VUMCwgMCk7CisJCX0KKwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1V
VkRfVkNQVV9DQUNIRV9TSVpFMCwgc2l6ZSk7CisKKwkJLyogY2FjaGUgd2luZG93IDE6IHN0YWNr
ICovCisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMV82NEJJVF9C
QVJfTE9XLAorCQkJbG93ZXJfMzJfYml0cyhhZGV2LT52Y24uaW5zdFtpXS5ncHVfYWRkciArIG9m
ZnNldCkpOworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVWRF9MTUlfVkNQVV9DQUNIRTFfNjRC
SVRfQkFSX0hJR0gsCisJCQl1cHBlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0W2ldLmdwdV9hZGRy
ICsgb2Zmc2V0KSk7CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX1ZDUFVfQ0FDSEVfT0ZG
U0VUMSwgMCk7CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX1ZDUFVfQ0FDSEVfU0laRTEs
IEFNREdQVV9WQ05fU1RBQ0tfU0laRSk7CisKKwkJLyogY2FjaGUgd2luZG93IDI6IGNvbnRleHQg
Ki8KKwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfTE1JX1ZDUFVfQ0FDSEUyXzY0QklUX0JB
Ul9MT1csCisJCQlsb3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0W2ldLmdwdV9hZGRyICsgb2Zm
c2V0ICsgQU1ER1BVX1ZDTl9TVEFDS19TSVpFKSk7CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1t
VVZEX0xNSV9WQ1BVX0NBQ0hFMl82NEJJVF9CQVJfSElHSCwKKwkJCXVwcGVyXzMyX2JpdHMoYWRl
di0+dmNuLmluc3RbaV0uZ3B1X2FkZHIgKyBvZmZzZXQgKyBBTURHUFVfVkNOX1NUQUNLX1NJWkUp
KTsKKwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfVkNQVV9DQUNIRV9PRkZTRVQyLCAwKTsK
KwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfVkNQVV9DQUNIRV9TSVpFMiwgQU1ER1BVX1ZD
Tl9DT05URVhUX1NJWkUpOwogCX0KLQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NB
Q0hFX1NJWkUwLCBzaXplKTsKLQotCS8qIGNhY2hlIHdpbmRvdyAxOiBzdGFjayAqLwotCVdSRUcz
Ml9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMV82NEJJVF9CQVJfTE9XLAotCQls
b3dlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0WzBdLmdwdV9hZGRyICsgb2Zmc2V0KSk7Ci0JV1JF
RzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfTE1JX1ZDUFVfQ0FDSEUxXzY0QklUX0JBUl9ISUdILAot
CQl1cHBlcl8zMl9iaXRzKGFkZXYtPnZjbi5pbnN0WzBdLmdwdV9hZGRyICsgb2Zmc2V0KSk7Ci0J
V1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfVkNQVV9DQUNIRV9PRkZTRVQxLCAwKTsKLQlXUkVH
MzJfU09DMTUoVVZELCAwLCBtbVVWRF9WQ1BVX0NBQ0hFX1NJWkUxLCBBTURHUFVfVkNOX1NUQUNL
X1NJWkUpOwotCi0JLyogY2FjaGUgd2luZG93IDI6IGNvbnRleHQgKi8KLQlXUkVHMzJfU09DMTUo
VVZELCAwLCBtbVVWRF9MTUlfVkNQVV9DQUNIRTJfNjRCSVRfQkFSX0xPVywKLQkJbG93ZXJfMzJf
Yml0cyhhZGV2LT52Y24uaW5zdFswXS5ncHVfYWRkciArIG9mZnNldCArIEFNREdQVV9WQ05fU1RB
Q0tfU0laRSkpOwotCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9WQ1BVX0NBQ0hFMl82
NEJJVF9CQVJfSElHSCwKLQkJdXBwZXJfMzJfYml0cyhhZGV2LT52Y24uaW5zdFswXS5ncHVfYWRk
ciArIG9mZnNldCArIEFNREdQVV9WQ05fU1RBQ0tfU0laRSkpOwotCVdSRUczMl9TT0MxNShVVkQs
IDAsIG1tVVZEX1ZDUFVfQ0FDSEVfT0ZGU0VUMiwgMCk7Ci0JV1JFRzMyX1NPQzE1KFVWRCwgMCwg
bW1VVkRfVkNQVV9DQUNIRV9TSVpFMiwgQU1ER1BVX1ZDTl9DT05URVhUX1NJWkUpOwogfQogCiAv
KioKQEAgLTM4MCwxMDYgKzQxMSwxMDkgQEAgc3RhdGljIHZvaWQgdmNuX3YyXzVfZGlzYWJsZV9j
bG9ja19nYXRpbmcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7CiAJdWludDMyX3QgZGF0
YTsKIAlpbnQgcmV0ID0gMDsKKwlpbnQgaTsKIAotCS8qIFVWRCBkaXNhYmxlIENHQyAqLwotCWRh
dGEgPSBSUkVHMzJfU09DMTUoVkNOLCAwLCBtbVVWRF9DR0NfQ1RSTCk7Ci0JaWYgKGFkZXYtPmNn
X2ZsYWdzICYgQU1EX0NHX1NVUFBPUlRfVkNOX01HQ0cpCi0JCWRhdGEgfD0gMSA8PCBVVkRfQ0dD
X0NUUkxfX0RZTl9DTE9DS19NT0RFX19TSElGVDsKLQllbHNlCi0JCWRhdGEgJj0gfiBVVkRfQ0dD
X0NUUkxfX0RZTl9DTE9DS19NT0RFX01BU0s7Ci0JZGF0YSB8PSAxIDw8IFVWRF9DR0NfQ1RSTF9f
Q0xLX0dBVEVfRExZX1RJTUVSX19TSElGVDsKLQlkYXRhIHw9IDQgPDwgVVZEX0NHQ19DVFJMX19D
TEtfT0ZGX0RFTEFZX19TSElGVDsKLQlXUkVHMzJfU09DMTUoVkNOLCAwLCBtbVVWRF9DR0NfQ1RS
TCwgZGF0YSk7Ci0KLQlkYXRhID0gUlJFRzMyX1NPQzE1KFZDTiwgMCwgbW1VVkRfQ0dDX0dBVEUp
OwotCWRhdGEgJj0gfihVVkRfQ0dDX0dBVEVfX1NZU19NQVNLCi0JCXwgVVZEX0NHQ19HQVRFX19V
REVDX01BU0sKLQkJfCBVVkRfQ0dDX0dBVEVfX01QRUcyX01BU0sKLQkJfCBVVkRfQ0dDX0dBVEVf
X1JFR1NfTUFTSwotCQl8IFVWRF9DR0NfR0FURV9fUkJDX01BU0sKLQkJfCBVVkRfQ0dDX0dBVEVf
X0xNSV9NQ19NQVNLCi0JCXwgVVZEX0NHQ19HQVRFX19MTUlfVU1DX01BU0sKLQkJfCBVVkRfQ0dD
X0dBVEVfX0lEQ1RfTUFTSwotCQl8IFVWRF9DR0NfR0FURV9fTVBSRF9NQVNLCi0JCXwgVVZEX0NH
Q19HQVRFX19NUENfTUFTSwotCQl8IFVWRF9DR0NfR0FURV9fTEJTSV9NQVNLCi0JCXwgVVZEX0NH
Q19HQVRFX19MUkJCTV9NQVNLCi0JCXwgVVZEX0NHQ19HQVRFX19VREVDX1JFX01BU0sKLQkJfCBV
VkRfQ0dDX0dBVEVfX1VERUNfQ01fTUFTSwotCQl8IFVWRF9DR0NfR0FURV9fVURFQ19JVF9NQVNL
Ci0JCXwgVVZEX0NHQ19HQVRFX19VREVDX0RCX01BU0sKLQkJfCBVVkRfQ0dDX0dBVEVfX1VERUNf
TVBfTUFTSwotCQl8IFVWRF9DR0NfR0FURV9fV0NCX01BU0sKLQkJfCBVVkRfQ0dDX0dBVEVfX1ZD
UFVfTUFTSwotCQl8IFVWRF9DR0NfR0FURV9fTU1TQ0hfTUFTSyk7Ci0KLQlXUkVHMzJfU09DMTUo
VkNOLCAwLCBtbVVWRF9DR0NfR0FURSwgZGF0YSk7Ci0KLQlTT0MxNV9XQUlUX09OX1JSRUcoVkNO
LCAwLCBtbVVWRF9DR0NfR0FURSwgMCwgIDB4RkZGRkZGRkYsIHJldCk7Ci0KLQlkYXRhID0gUlJF
RzMyX1NPQzE1KFZDTiwgMCwgbW1VVkRfQ0dDX0NUUkwpOwotCWRhdGEgJj0gfihVVkRfQ0dDX0NU
UkxfX1VERUNfUkVfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19VREVDX0NNX01PREVfTUFT
SwotCQl8IFVWRF9DR0NfQ1RSTF9fVURFQ19JVF9NT0RFX01BU0sKLQkJfCBVVkRfQ0dDX0NUUkxf
X1VERUNfREJfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19VREVDX01QX01PREVfTUFTSwot
CQl8IFVWRF9DR0NfQ1RSTF9fU1lTX01PREVfTUFTSwotCQl8IFVWRF9DR0NfQ1RSTF9fVURFQ19N
T0RFX01BU0sKLQkJfCBVVkRfQ0dDX0NUUkxfX01QRUcyX01PREVfTUFTSwotCQl8IFVWRF9DR0Nf
Q1RSTF9fUkVHU19NT0RFX01BU0sKLQkJfCBVVkRfQ0dDX0NUUkxfX1JCQ19NT0RFX01BU0sKLQkJ
fCBVVkRfQ0dDX0NUUkxfX0xNSV9NQ19NT0RFX01BU0sKLQkJfCBVVkRfQ0dDX0NUUkxfX0xNSV9V
TUNfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19JRENUX01PREVfTUFTSwotCQl8IFVWRF9D
R0NfQ1RSTF9fTVBSRF9NT0RFX01BU0sKLQkJfCBVVkRfQ0dDX0NUUkxfX01QQ19NT0RFX01BU0sK
LQkJfCBVVkRfQ0dDX0NUUkxfX0xCU0lfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19MUkJC
TV9NT0RFX01BU0sKLQkJfCBVVkRfQ0dDX0NUUkxfX1dDQl9NT0RFX01BU0sKLQkJfCBVVkRfQ0dD
X0NUUkxfX1ZDUFVfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19NTVNDSF9NT0RFX01BU0sp
OwotCVdSRUczMl9TT0MxNShWQ04sIDAsIG1tVVZEX0NHQ19DVFJMLCBkYXRhKTsKLQotCS8qIHR1
cm4gb24gKi8KLQlkYXRhID0gUlJFRzMyX1NPQzE1KFZDTiwgMCwgbW1VVkRfU1VWRF9DR0NfR0FU
RSk7Ci0JZGF0YSB8PSAoVVZEX1NVVkRfQ0dDX0dBVEVfX1NSRV9NQVNLCi0JCXwgVVZEX1NVVkRf
Q0dDX0dBVEVfX1NJVF9NQVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0dBVEVfX1NNUF9NQVNLCi0JCXwg
VVZEX1NVVkRfQ0dDX0dBVEVfX1NDTV9NQVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0dBVEVfX1NEQl9N
QVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0dBVEVfX1NSRV9IMjY0X01BU0sKLQkJfCBVVkRfU1VWRF9D
R0NfR0FURV9fU1JFX0hFVkNfTUFTSwotCQl8IFVWRF9TVVZEX0NHQ19HQVRFX19TSVRfSDI2NF9N
QVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0dBVEVfX1NJVF9IRVZDX01BU0sKLQkJfCBVVkRfU1VWRF9D
R0NfR0FURV9fU0NNX0gyNjRfTUFTSwotCQl8IFVWRF9TVVZEX0NHQ19HQVRFX19TQ01fSEVWQ19N
QVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0dBVEVfX1NEQl9IMjY0X01BU0sKLQkJfCBVVkRfU1VWRF9D
R0NfR0FURV9fU0RCX0hFVkNfTUFTSwotCQl8IFVWRF9TVVZEX0NHQ19HQVRFX19TQ0xSX01BU0sK
LQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fVVZEX1NDX01BU0sKLQkJfCBVVkRfU1VWRF9DR0NfR0FU
RV9fRU5UX01BU0sKLQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fU0lUX0hFVkNfREVDX01BU0sKLQkJ
fCBVVkRfU1VWRF9DR0NfR0FURV9fU0lUX0hFVkNfRU5DX01BU0sKLQkJfCBVVkRfU1VWRF9DR0Nf
R0FURV9fU0lURV9NQVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0dBVEVfX1NSRV9WUDlfTUFTSwotCQl8
IFVWRF9TVVZEX0NHQ19HQVRFX19TQ01fVlA5X01BU0sKLQkJfCBVVkRfU1VWRF9DR0NfR0FURV9f
U0lUX1ZQOV9ERUNfTUFTSwotCQl8IFVWRF9TVVZEX0NHQ19HQVRFX19TREJfVlA5X01BU0sKLQkJ
fCBVVkRfU1VWRF9DR0NfR0FURV9fSU1FX0hFVkNfTUFTSyk7Ci0JV1JFRzMyX1NPQzE1KFZDTiwg
MCwgbW1VVkRfU1VWRF9DR0NfR0FURSwgZGF0YSk7Ci0KLQlkYXRhID0gUlJFRzMyX1NPQzE1KFZD
TiwgMCwgbW1VVkRfU1VWRF9DR0NfQ1RSTCk7Ci0JZGF0YSAmPSB+KFVWRF9TVVZEX0NHQ19DVFJM
X19TUkVfTU9ERV9NQVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NJVF9NT0RFX01BU0sKLQkJ
fCBVVkRfU1VWRF9DR0NfQ1RSTF9fU01QX01PREVfTUFTSwotCQl8IFVWRF9TVVZEX0NHQ19DVFJM
X19TQ01fTU9ERV9NQVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NEQl9NT0RFX01BU0sKLQkJ
fCBVVkRfU1VWRF9DR0NfQ1RSTF9fU0NMUl9NT0RFX01BU0sKLQkJfCBVVkRfU1VWRF9DR0NfQ1RS
TF9fVVZEX1NDX01PREVfTUFTSwotCQl8IFVWRF9TVVZEX0NHQ19DVFJMX19FTlRfTU9ERV9NQVNL
Ci0JCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX0lNRV9NT0RFX01BU0sKLQkJfCBVVkRfU1VWRF9DR0Nf
Q1RSTF9fU0lURV9NT0RFX01BU0spOwotCVdSRUczMl9TT0MxNShWQ04sIDAsIG1tVVZEX1NVVkRf
Q0dDX0NUUkwsIGRhdGEpOworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX3Zjbl9pbnN0
OyArK2kpIHsKKwkJLyogVVZEIGRpc2FibGUgQ0dDICovCisJCWRhdGEgPSBSUkVHMzJfU09DMTUo
VkNOLCBpLCBtbVVWRF9DR0NfQ1RSTCk7CisJCWlmIChhZGV2LT5jZ19mbGFncyAmIEFNRF9DR19T
VVBQT1JUX1ZDTl9NR0NHKQorCQkJZGF0YSB8PSAxIDw8IFVWRF9DR0NfQ1RSTF9fRFlOX0NMT0NL
X01PREVfX1NISUZUOworCQllbHNlCisJCQlkYXRhICY9IH5VVkRfQ0dDX0NUUkxfX0RZTl9DTE9D
S19NT0RFX01BU0s7CisJCWRhdGEgfD0gMSA8PCBVVkRfQ0dDX0NUUkxfX0NMS19HQVRFX0RMWV9U
SU1FUl9fU0hJRlQ7CisJCWRhdGEgfD0gNCA8PCBVVkRfQ0dDX0NUUkxfX0NMS19PRkZfREVMQVlf
X1NISUZUOworCQlXUkVHMzJfU09DMTUoVkNOLCBpLCBtbVVWRF9DR0NfQ1RSTCwgZGF0YSk7CisK
KwkJZGF0YSA9IFJSRUczMl9TT0MxNShWQ04sIGksIG1tVVZEX0NHQ19HQVRFKTsKKwkJZGF0YSAm
PSB+KFVWRF9DR0NfR0FURV9fU1lTX01BU0sKKwkJCXwgVVZEX0NHQ19HQVRFX19VREVDX01BU0sK
KwkJCXwgVVZEX0NHQ19HQVRFX19NUEVHMl9NQVNLCisJCQl8IFVWRF9DR0NfR0FURV9fUkVHU19N
QVNLCisJCQl8IFVWRF9DR0NfR0FURV9fUkJDX01BU0sKKwkJCXwgVVZEX0NHQ19HQVRFX19MTUlf
TUNfTUFTSworCQkJfCBVVkRfQ0dDX0dBVEVfX0xNSV9VTUNfTUFTSworCQkJfCBVVkRfQ0dDX0dB
VEVfX0lEQ1RfTUFTSworCQkJfCBVVkRfQ0dDX0dBVEVfX01QUkRfTUFTSworCQkJfCBVVkRfQ0dD
X0dBVEVfX01QQ19NQVNLCisJCQl8IFVWRF9DR0NfR0FURV9fTEJTSV9NQVNLCisJCQl8IFVWRF9D
R0NfR0FURV9fTFJCQk1fTUFTSworCQkJfCBVVkRfQ0dDX0dBVEVfX1VERUNfUkVfTUFTSworCQkJ
fCBVVkRfQ0dDX0dBVEVfX1VERUNfQ01fTUFTSworCQkJfCBVVkRfQ0dDX0dBVEVfX1VERUNfSVRf
TUFTSworCQkJfCBVVkRfQ0dDX0dBVEVfX1VERUNfREJfTUFTSworCQkJfCBVVkRfQ0dDX0dBVEVf
X1VERUNfTVBfTUFTSworCQkJfCBVVkRfQ0dDX0dBVEVfX1dDQl9NQVNLCisJCQl8IFVWRF9DR0Nf
R0FURV9fVkNQVV9NQVNLCisJCQl8IFVWRF9DR0NfR0FURV9fTU1TQ0hfTUFTSyk7CisKKwkJV1JF
RzMyX1NPQzE1KFZDTiwgaSwgbW1VVkRfQ0dDX0dBVEUsIGRhdGEpOworCisJCVNPQzE1X1dBSVRf
T05fUlJFRyhWQ04sIGksIG1tVVZEX0NHQ19HQVRFLCAwLCAgMHhGRkZGRkZGRiwgcmV0KTsKKwor
CQlkYXRhID0gUlJFRzMyX1NPQzE1KFZDTiwgaSwgbW1VVkRfQ0dDX0NUUkwpOworCQlkYXRhICY9
IH4oVVZEX0NHQ19DVFJMX19VREVDX1JFX01PREVfTUFTSworCQkJfCBVVkRfQ0dDX0NUUkxfX1VE
RUNfQ01fTU9ERV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9fVURFQ19JVF9NT0RFX01BU0sKKwkJ
CXwgVVZEX0NHQ19DVFJMX19VREVDX0RCX01PREVfTUFTSworCQkJfCBVVkRfQ0dDX0NUUkxfX1VE
RUNfTVBfTU9ERV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9fU1lTX01PREVfTUFTSworCQkJfCBV
VkRfQ0dDX0NUUkxfX1VERUNfTU9ERV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9fTVBFRzJfTU9E
RV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9fUkVHU19NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19D
VFJMX19SQkNfTU9ERV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9fTE1JX01DX01PREVfTUFTSwor
CQkJfCBVVkRfQ0dDX0NUUkxfX0xNSV9VTUNfTU9ERV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9f
SURDVF9NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19NUFJEX01PREVfTUFTSworCQkJfCBV
VkRfQ0dDX0NUUkxfX01QQ19NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19MQlNJX01PREVf
TUFTSworCQkJfCBVVkRfQ0dDX0NUUkxfX0xSQkJNX01PREVfTUFTSworCQkJfCBVVkRfQ0dDX0NU
UkxfX1dDQl9NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19WQ1BVX01PREVfTUFTSworCQkJ
fCBVVkRfQ0dDX0NUUkxfX01NU0NIX01PREVfTUFTSyk7CisJCVdSRUczMl9TT0MxNShWQ04sIGks
IG1tVVZEX0NHQ19DVFJMLCBkYXRhKTsKKworCQkvKiB0dXJuIG9uICovCisJCWRhdGEgPSBSUkVH
MzJfU09DMTUoVkNOLCBpLCBtbVVWRF9TVVZEX0NHQ19HQVRFKTsKKwkJZGF0YSB8PSAoVVZEX1NV
VkRfQ0dDX0dBVEVfX1NSRV9NQVNLCisJCQl8IFVWRF9TVVZEX0NHQ19HQVRFX19TSVRfTUFTSwor
CQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fU01QX01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0dBVEVf
X1NDTV9NQVNLCisJCQl8IFVWRF9TVVZEX0NHQ19HQVRFX19TREJfTUFTSworCQkJfCBVVkRfU1VW
RF9DR0NfR0FURV9fU1JFX0gyNjRfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fU1JFX0hF
VkNfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fU0lUX0gyNjRfTUFTSworCQkJfCBVVkRf
U1VWRF9DR0NfR0FURV9fU0lUX0hFVkNfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fU0NN
X0gyNjRfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fU0NNX0hFVkNfTUFTSworCQkJfCBV
VkRfU1VWRF9DR0NfR0FURV9fU0RCX0gyNjRfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9f
U0RCX0hFVkNfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fU0NMUl9NQVNLCisJCQl8IFVW
RF9TVVZEX0NHQ19HQVRFX19VVkRfU0NfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fRU5U
X01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0dBVEVfX1NJVF9IRVZDX0RFQ19NQVNLCisJCQl8IFVW
RF9TVVZEX0NHQ19HQVRFX19TSVRfSEVWQ19FTkNfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FU
RV9fU0lURV9NQVNLCisJCQl8IFVWRF9TVVZEX0NHQ19HQVRFX19TUkVfVlA5X01BU0sKKwkJCXwg
VVZEX1NVVkRfQ0dDX0dBVEVfX1NDTV9WUDlfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9f
U0lUX1ZQOV9ERUNfTUFTSworCQkJfCBVVkRfU1VWRF9DR0NfR0FURV9fU0RCX1ZQOV9NQVNLCisJ
CQl8IFVWRF9TVVZEX0NHQ19HQVRFX19JTUVfSEVWQ19NQVNLKTsKKwkJV1JFRzMyX1NPQzE1KFZD
TiwgaSwgbW1VVkRfU1VWRF9DR0NfR0FURSwgZGF0YSk7CisKKwkJZGF0YSA9IFJSRUczMl9TT0Mx
NShWQ04sIGksIG1tVVZEX1NVVkRfQ0dDX0NUUkwpOworCQlkYXRhICY9IH4oVVZEX1NVVkRfQ0dD
X0NUUkxfX1NSRV9NT0RFX01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NJVF9NT0RFX01B
U0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NNUF9NT0RFX01BU0sKKwkJCXwgVVZEX1NVVkRf
Q0dDX0NUUkxfX1NDTV9NT0RFX01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NEQl9NT0RF
X01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NDTFJfTU9ERV9NQVNLCisJCQl8IFVWRF9T
VVZEX0NHQ19DVFJMX19VVkRfU0NfTU9ERV9NQVNLCisJCQl8IFVWRF9TVVZEX0NHQ19DVFJMX19F
TlRfTU9ERV9NQVNLCisJCQl8IFVWRF9TVVZEX0NHQ19DVFJMX19JTUVfTU9ERV9NQVNLCisJCQl8
IFVWRF9TVVZEX0NHQ19DVFJMX19TSVRFX01PREVfTUFTSyk7CisJCVdSRUczMl9TT0MxNShWQ04s
IGksIG1tVVZEX1NVVkRfQ0dDX0NUUkwsIGRhdGEpOworCX0KIH0KIAogLyoqCkBAIC00OTMsNTEg
KzUyNyw1NCBAQCBzdGF0aWMgdm9pZCB2Y25fdjJfNV9kaXNhYmxlX2Nsb2NrX2dhdGluZyhzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHN0YXRpYyB2b2lkIHZjbl92Ml81X2VuYWJsZV9jbG9j
a19nYXRpbmcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7CiAJdWludDMyX3QgZGF0YSA9
IDA7CisJaW50IGk7CiAKLQkvKiBlbmFibGUgVVZEIENHQyAqLwotCWRhdGEgPSBSUkVHMzJfU09D
MTUoVkNOLCAwLCBtbVVWRF9DR0NfQ1RSTCk7Ci0JaWYgKGFkZXYtPmNnX2ZsYWdzICYgQU1EX0NH
X1NVUFBPUlRfVkNOX01HQ0cpCi0JCWRhdGEgfD0gMSA8PCBVVkRfQ0dDX0NUUkxfX0RZTl9DTE9D
S19NT0RFX19TSElGVDsKLQllbHNlCi0JCWRhdGEgfD0gMCA8PCBVVkRfQ0dDX0NUUkxfX0RZTl9D
TE9DS19NT0RFX19TSElGVDsKLQlkYXRhIHw9IDEgPDwgVVZEX0NHQ19DVFJMX19DTEtfR0FURV9E
TFlfVElNRVJfX1NISUZUOwotCWRhdGEgfD0gNCA8PCBVVkRfQ0dDX0NUUkxfX0NMS19PRkZfREVM
QVlfX1NISUZUOwotCVdSRUczMl9TT0MxNShWQ04sIDAsIG1tVVZEX0NHQ19DVFJMLCBkYXRhKTsK
LQotCWRhdGEgPSBSUkVHMzJfU09DMTUoVkNOLCAwLCBtbVVWRF9DR0NfQ1RSTCk7Ci0JZGF0YSB8
PSAoVVZEX0NHQ19DVFJMX19VREVDX1JFX01PREVfTUFTSwotCQl8IFVWRF9DR0NfQ1RSTF9fVURF
Q19DTV9NT0RFX01BU0sKLQkJfCBVVkRfQ0dDX0NUUkxfX1VERUNfSVRfTU9ERV9NQVNLCi0JCXwg
VVZEX0NHQ19DVFJMX19VREVDX0RCX01PREVfTUFTSwotCQl8IFVWRF9DR0NfQ1RSTF9fVURFQ19N
UF9NT0RFX01BU0sKLQkJfCBVVkRfQ0dDX0NUUkxfX1NZU19NT0RFX01BU0sKLQkJfCBVVkRfQ0dD
X0NUUkxfX1VERUNfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19NUEVHMl9NT0RFX01BU0sK
LQkJfCBVVkRfQ0dDX0NUUkxfX1JFR1NfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19SQkNf
TU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19MTUlfTUNfTU9ERV9NQVNLCi0JCXwgVVZEX0NH
Q19DVFJMX19MTUlfVU1DX01PREVfTUFTSwotCQl8IFVWRF9DR0NfQ1RSTF9fSURDVF9NT0RFX01B
U0sKLQkJfCBVVkRfQ0dDX0NUUkxfX01QUkRfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19N
UENfTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19MQlNJX01PREVfTUFTSwotCQl8IFVWRF9D
R0NfQ1RSTF9fTFJCQk1fTU9ERV9NQVNLCi0JCXwgVVZEX0NHQ19DVFJMX19XQ0JfTU9ERV9NQVNL
Ci0JCXwgVVZEX0NHQ19DVFJMX19WQ1BVX01PREVfTUFTSyk7Ci0JV1JFRzMyX1NPQzE1KFZDTiwg
MCwgbW1VVkRfQ0dDX0NUUkwsIGRhdGEpOwotCi0JZGF0YSA9IFJSRUczMl9TT0MxNShWQ04sIDAs
IG1tVVZEX1NVVkRfQ0dDX0NUUkwpOwotCWRhdGEgfD0gKFVWRF9TVVZEX0NHQ19DVFJMX19TUkVf
TU9ERV9NQVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NJVF9NT0RFX01BU0sKLQkJfCBVVkRf
U1VWRF9DR0NfQ1RSTF9fU01QX01PREVfTUFTSwotCQl8IFVWRF9TVVZEX0NHQ19DVFJMX19TQ01f
TU9ERV9NQVNLCi0JCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NEQl9NT0RFX01BU0sKLQkJfCBVVkRf
U1VWRF9DR0NfQ1RSTF9fU0NMUl9NT0RFX01BU0sKLQkJfCBVVkRfU1VWRF9DR0NfQ1RSTF9fVVZE
X1NDX01PREVfTUFTSwotCQl8IFVWRF9TVVZEX0NHQ19DVFJMX19FTlRfTU9ERV9NQVNLCi0JCXwg
VVZEX1NVVkRfQ0dDX0NUUkxfX0lNRV9NT0RFX01BU0sKLQkJfCBVVkRfU1VWRF9DR0NfQ1RSTF9f
U0lURV9NT0RFX01BU0spOwotCVdSRUczMl9TT0MxNShWQ04sIDAsIG1tVVZEX1NVVkRfQ0dDX0NU
UkwsIGRhdGEpOworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX3Zjbl9pbnN0OyArK2kp
IHsKKwkJLyogZW5hYmxlIFVWRCBDR0MgKi8KKwkJZGF0YSA9IFJSRUczMl9TT0MxNShWQ04sIGks
IG1tVVZEX0NHQ19DVFJMKTsKKwkJaWYgKGFkZXYtPmNnX2ZsYWdzICYgQU1EX0NHX1NVUFBPUlRf
VkNOX01HQ0cpCisJCQlkYXRhIHw9IDEgPDwgVVZEX0NHQ19DVFJMX19EWU5fQ0xPQ0tfTU9ERV9f
U0hJRlQ7CisJCWVsc2UKKwkJCWRhdGEgfD0gMCA8PCBVVkRfQ0dDX0NUUkxfX0RZTl9DTE9DS19N
T0RFX19TSElGVDsKKwkJZGF0YSB8PSAxIDw8IFVWRF9DR0NfQ1RSTF9fQ0xLX0dBVEVfRExZX1RJ
TUVSX19TSElGVDsKKwkJZGF0YSB8PSA0IDw8IFVWRF9DR0NfQ1RSTF9fQ0xLX09GRl9ERUxBWV9f
U0hJRlQ7CisJCVdSRUczMl9TT0MxNShWQ04sIGksIG1tVVZEX0NHQ19DVFJMLCBkYXRhKTsKKwor
CQlkYXRhID0gUlJFRzMyX1NPQzE1KFZDTiwgaSwgbW1VVkRfQ0dDX0NUUkwpOworCQlkYXRhIHw9
IChVVkRfQ0dDX0NUUkxfX1VERUNfUkVfTU9ERV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9fVURF
Q19DTV9NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19VREVDX0lUX01PREVfTUFTSworCQkJ
fCBVVkRfQ0dDX0NUUkxfX1VERUNfREJfTU9ERV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9fVURF
Q19NUF9NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19TWVNfTU9ERV9NQVNLCisJCQl8IFVW
RF9DR0NfQ1RSTF9fVURFQ19NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19NUEVHMl9NT0RF
X01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19SRUdTX01PREVfTUFTSworCQkJfCBVVkRfQ0dDX0NU
UkxfX1JCQ19NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19MTUlfTUNfTU9ERV9NQVNLCisJ
CQl8IFVWRF9DR0NfQ1RSTF9fTE1JX1VNQ19NT0RFX01BU0sKKwkJCXwgVVZEX0NHQ19DVFJMX19J
RENUX01PREVfTUFTSworCQkJfCBVVkRfQ0dDX0NUUkxfX01QUkRfTU9ERV9NQVNLCisJCQl8IFVW
RF9DR0NfQ1RSTF9fTVBDX01PREVfTUFTSworCQkJfCBVVkRfQ0dDX0NUUkxfX0xCU0lfTU9ERV9N
QVNLCisJCQl8IFVWRF9DR0NfQ1RSTF9fTFJCQk1fTU9ERV9NQVNLCisJCQl8IFVWRF9DR0NfQ1RS
TF9fV0NCX01PREVfTUFTSworCQkJfCBVVkRfQ0dDX0NUUkxfX1ZDUFVfTU9ERV9NQVNLKTsKKwkJ
V1JFRzMyX1NPQzE1KFZDTiwgaSwgbW1VVkRfQ0dDX0NUUkwsIGRhdGEpOworCisJCWRhdGEgPSBS
UkVHMzJfU09DMTUoVkNOLCBpLCBtbVVWRF9TVVZEX0NHQ19DVFJMKTsKKwkJZGF0YSB8PSAoVVZE
X1NVVkRfQ0dDX0NUUkxfX1NSRV9NT0RFX01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NJ
VF9NT0RFX01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NNUF9NT0RFX01BU0sKKwkJCXwg
VVZEX1NVVkRfQ0dDX0NUUkxfX1NDTV9NT0RFX01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0NUUkxf
X1NEQl9NT0RFX01BU0sKKwkJCXwgVVZEX1NVVkRfQ0dDX0NUUkxfX1NDTFJfTU9ERV9NQVNLCisJ
CQl8IFVWRF9TVVZEX0NHQ19DVFJMX19VVkRfU0NfTU9ERV9NQVNLCisJCQl8IFVWRF9TVVZEX0NH
Q19DVFJMX19FTlRfTU9ERV9NQVNLCisJCQl8IFVWRF9TVVZEX0NHQ19DVFJMX19JTUVfTU9ERV9N
QVNLCisJCQl8IFVWRF9TVVZEX0NHQ19DVFJMX19TSVRFX01PREVfTUFTSyk7CisJCVdSRUczMl9T
T0MxNShWQ04sIGksIG1tVVZEX1NVVkRfQ0dDX0NUUkwsIGRhdGEpOworCX0KIH0KIAogLyoqCkBA
IC01NDksNjAgKzU4Niw2NCBAQCBzdGF0aWMgdm9pZCB2Y25fdjJfNV9lbmFibGVfY2xvY2tfZ2F0
aW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogICovCiBzdGF0aWMgaW50IGpwZWdfdjJf
NV9zdGFydChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKLQlzdHJ1Y3QgYW1kZ3B1X3Jp
bmcgKnJpbmcgPSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19qcGVnOworCXN0cnVjdCBhbWRncHVf
cmluZyAqcmluZzsKIAl1aW50MzJfdCB0bXA7CisJaW50IGk7CiAKLQkvKiBkaXNhYmxlIGFudGkg
aGFuZyBtZWNoYW5pc20gKi8KLQlXUkVHMzJfUChTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1V
VkRfSlBFR19QT1dFUl9TVEFUVVMpLCAwLAotCQl+VVZEX0pQRUdfUE9XRVJfU1RBVFVTX19KUEVH
X1BPV0VSX1NUQVRVU19NQVNLKTsKLQotCS8qIEpQRUcgZGlzYWJsZSBDR0MgKi8KLQl0bXAgPSBS
UkVHMzJfU09DMTUoVkNOLCAwLCBtbUpQRUdfQ0dDX0NUUkwpOwotCXRtcCB8PSAxIDw8IEpQRUdf
Q0dDX0NUUkxfX0RZTl9DTE9DS19NT0RFX19TSElGVDsKLQl0bXAgfD0gMSA8PCBKUEVHX0NHQ19D
VFJMX19DTEtfR0FURV9ETFlfVElNRVJfX1NISUZUOwotCXRtcCB8PSA0IDw8IEpQRUdfQ0dDX0NU
UkxfX0NMS19PRkZfREVMQVlfX1NISUZUOwotCVdSRUczMl9TT0MxNShWQ04sIDAsIG1tSlBFR19D
R0NfQ1RSTCwgdG1wKTsKLQotCXRtcCA9IFJSRUczMl9TT0MxNShWQ04sIDAsIG1tSlBFR19DR0Nf
R0FURSk7Ci0JdG1wICY9IH4oSlBFR19DR0NfR0FURV9fSlBFR19ERUNfTUFTSwotCQl8IEpQRUdf
Q0dDX0dBVEVfX0pQRUcyX0RFQ19NQVNLCi0JCXwgSlBFR19DR0NfR0FURV9fSk1DSUZfTUFTSwot
CQl8IEpQRUdfQ0dDX0dBVEVfX0pSQkJNX01BU0spOwotCVdSRUczMl9TT0MxNShWQ04sIDAsIG1t
SlBFR19DR0NfR0FURSwgdG1wKTsKLQotCXRtcCA9IFJSRUczMl9TT0MxNShWQ04sIDAsIG1tSlBF
R19DR0NfQ1RSTCk7Ci0JdG1wICY9IH4oSlBFR19DR0NfQ1RSTF9fSlBFR19ERUNfTU9ERV9NQVNL
Ci0JCXwgSlBFR19DR0NfQ1RSTF9fSlBFRzJfREVDX01PREVfTUFTSwotCQl8IEpQRUdfQ0dDX0NU
UkxfX0pNQ0lGX01PREVfTUFTSwotCQl8IEpQRUdfQ0dDX0NUUkxfX0pSQkJNX01PREVfTUFTSyk7
Ci0JV1JFRzMyX1NPQzE1KFZDTiwgMCwgbW1KUEVHX0NHQ19DVFJMLCB0bXApOwotCi0JLyogTUpQ
RUcgZ2xvYmFsIHRpbGluZyByZWdpc3RlcnMgKi8KLQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbUpQ
RUdfREVDX0dGWDhfQUREUl9DT05GSUcsCi0JCWFkZXYtPmdmeC5jb25maWcuZ2JfYWRkcl9jb25m
aWcpOwotCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tSlBFR19ERUNfR0ZYMTBfQUREUl9DT05GSUcs
Ci0JCWFkZXYtPmdmeC5jb25maWcuZ2JfYWRkcl9jb25maWcpOwotCi0JLyogZW5hYmxlIEpNSSBj
aGFubmVsICovCi0JV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQsIDAsIG1tVVZEX0pNSV9D
TlRMKSwgMCwKLQkJflVWRF9KTUlfQ05UTF9fU09GVF9SRVNFVF9NQVNLKTsKLQotCS8qIGVuYWJs
ZSBTeXN0ZW0gSW50ZXJydXB0IGZvciBKUkJDICovCi0JV1JFRzMyX1AoU09DMTVfUkVHX09GRlNF
VChWQ04sIDAsIG1tSlBFR19TWVNfSU5UX0VOKSwKLQkJSlBFR19TWVNfSU5UX0VOX19ESlJCQ19N
QVNLLAotCQl+SlBFR19TWVNfSU5UX0VOX19ESlJCQ19NQVNLKTsKLQotCVdSRUczMl9TT0MxNShV
VkQsIDAsIG1tVVZEX0xNSV9KUkJDX1JCX1ZNSUQsIDApOwotCVdSRUczMl9TT0MxNShVVkQsIDAs
IG1tVVZEX0pSQkNfUkJfQ05UTCwgKDB4MDAwMDAwMDFMIHwgMHgwMDAwMDAwMkwpKTsKLQlXUkVH
MzJfU09DMTUoVVZELCAwLCBtbVVWRF9MTUlfSlJCQ19SQl82NEJJVF9CQVJfTE9XLAotCQlsb3dl
cl8zMl9iaXRzKHJpbmctPmdwdV9hZGRyKSk7Ci0JV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRf
TE1JX0pSQkNfUkJfNjRCSVRfQkFSX0hJR0gsCi0JCXVwcGVyXzMyX2JpdHMocmluZy0+Z3B1X2Fk
ZHIpKTsKLQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9KUkJDX1JCX1JQVFIsIDApOwotCVdS
RUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0pSQkNfUkJfV1BUUiwgMCk7Ci0JV1JFRzMyX1NPQzE1
KFVWRCwgMCwgbW1VVkRfSlJCQ19SQl9DTlRMLCAweDAwMDAwMDAyTCk7Ci0JV1JFRzMyX1NPQzE1
KFVWRCwgMCwgbW1VVkRfSlJCQ19SQl9TSVpFLCByaW5nLT5yaW5nX3NpemUgLyA0KTsKLQlyaW5n
LT53cHRyID0gUlJFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfSlJCQ19SQl9XUFRSKTsKKwlmb3Ig
KGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV92Y25faW5zdDsgKytpKSB7CisJCXJpbmcgPSAmYWRl
di0+dmNuLmluc3RbaV0ucmluZ19qcGVnOworCQkvKiBkaXNhYmxlIGFudGkgaGFuZyBtZWNoYW5p
c20gKi8KKwkJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQsIGksIG1tVVZEX0pQRUdfUE9X
RVJfU1RBVFVTKSwgMCwKKwkJCX5VVkRfSlBFR19QT1dFUl9TVEFUVVNfX0pQRUdfUE9XRVJfU1RB
VFVTX01BU0spOworCisJCS8qIEpQRUcgZGlzYWJsZSBDR0MgKi8KKwkJdG1wID0gUlJFRzMyX1NP
QzE1KFZDTiwgaSwgbW1KUEVHX0NHQ19DVFJMKTsKKwkJdG1wIHw9IDEgPDwgSlBFR19DR0NfQ1RS
TF9fRFlOX0NMT0NLX01PREVfX1NISUZUOworCQl0bXAgfD0gMSA8PCBKUEVHX0NHQ19DVFJMX19D
TEtfR0FURV9ETFlfVElNRVJfX1NISUZUOworCQl0bXAgfD0gNCA8PCBKUEVHX0NHQ19DVFJMX19D
TEtfT0ZGX0RFTEFZX19TSElGVDsKKwkJV1JFRzMyX1NPQzE1KFZDTiwgaSwgbW1KUEVHX0NHQ19D
VFJMLCB0bXApOworCisJCXRtcCA9IFJSRUczMl9TT0MxNShWQ04sIGksIG1tSlBFR19DR0NfR0FU
RSk7CisJCXRtcCAmPSB+KEpQRUdfQ0dDX0dBVEVfX0pQRUdfREVDX01BU0sKKwkJCXwgSlBFR19D
R0NfR0FURV9fSlBFRzJfREVDX01BU0sKKwkJCXwgSlBFR19DR0NfR0FURV9fSk1DSUZfTUFTSwor
CQkJfCBKUEVHX0NHQ19HQVRFX19KUkJCTV9NQVNLKTsKKwkJV1JFRzMyX1NPQzE1KFZDTiwgaSwg
bW1KUEVHX0NHQ19HQVRFLCB0bXApOworCisJCXRtcCA9IFJSRUczMl9TT0MxNShWQ04sIGksIG1t
SlBFR19DR0NfQ1RSTCk7CisJCXRtcCAmPSB+KEpQRUdfQ0dDX0NUUkxfX0pQRUdfREVDX01PREVf
TUFTSworCQkJfCBKUEVHX0NHQ19DVFJMX19KUEVHMl9ERUNfTU9ERV9NQVNLCisJCQl8IEpQRUdf
Q0dDX0NUUkxfX0pNQ0lGX01PREVfTUFTSworCQkJfCBKUEVHX0NHQ19DVFJMX19KUkJCTV9NT0RF
X01BU0spOworCQlXUkVHMzJfU09DMTUoVkNOLCBpLCBtbUpQRUdfQ0dDX0NUUkwsIHRtcCk7CisK
KwkJLyogTUpQRUcgZ2xvYmFsIHRpbGluZyByZWdpc3RlcnMgKi8KKwkJV1JFRzMyX1NPQzE1KFVW
RCwgaSwgbW1KUEVHX0RFQ19HRlg4X0FERFJfQ09ORklHLAorCQkJYWRldi0+Z2Z4LmNvbmZpZy5n
Yl9hZGRyX2NvbmZpZyk7CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tSlBFR19ERUNfR0ZYMTBf
QUREUl9DT05GSUcsCisJCQlhZGV2LT5nZnguY29uZmlnLmdiX2FkZHJfY29uZmlnKTsKKworCQkv
KiBlbmFibGUgSk1JIGNoYW5uZWwgKi8KKwkJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQs
IGksIG1tVVZEX0pNSV9DTlRMKSwgMCwKKwkJCX5VVkRfSk1JX0NOVExfX1NPRlRfUkVTRVRfTUFT
Syk7CisKKwkJLyogZW5hYmxlIFN5c3RlbSBJbnRlcnJ1cHQgZm9yIEpSQkMgKi8KKwkJV1JFRzMy
X1AoU09DMTVfUkVHX09GRlNFVChWQ04sIGksIG1tSlBFR19TWVNfSU5UX0VOKSwKKwkJCUpQRUdf
U1lTX0lOVF9FTl9fREpSQkNfTUFTSywKKwkJCX5KUEVHX1NZU19JTlRfRU5fX0RKUkJDX01BU0sp
OworCisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX0xNSV9KUkJDX1JCX1ZNSUQsIDApOwor
CQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVWRF9KUkJDX1JCX0NOVEwsICgweDAwMDAwMDAxTCB8
IDB4MDAwMDAwMDJMKSk7CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX0xNSV9KUkJDX1JC
XzY0QklUX0JBUl9MT1csCisJCQlsb3dlcl8zMl9iaXRzKHJpbmctPmdwdV9hZGRyKSk7CisJCVdS
RUczMl9TT0MxNShVVkQsIGksIG1tVVZEX0xNSV9KUkJDX1JCXzY0QklUX0JBUl9ISUdILAorCQkJ
dXBwZXJfMzJfYml0cyhyaW5nLT5ncHVfYWRkcikpOworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBt
bVVWRF9KUkJDX1JCX1JQVFIsIDApOworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVWRF9KUkJD
X1JCX1dQVFIsIDApOworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVWRF9KUkJDX1JCX0NOVEws
IDB4MDAwMDAwMDJMKTsKKwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfSlJCQ19SQl9TSVpF
LCByaW5nLT5yaW5nX3NpemUgLyA0KTsKKwkJcmluZy0+d3B0ciA9IFJSRUczMl9TT0MxNShVVkQs
IGksIG1tVVZEX0pSQkNfUkJfV1BUUik7CisJfQogCiAJcmV0dXJuIDA7CiB9CkBAIC02MTcsMTg1
ICs2NTgsMTk0IEBAIHN0YXRpYyBpbnQganBlZ192Ml81X3N0YXJ0KHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2KQogc3RhdGljIGludCBqcGVnX3YyXzVfc3RvcChzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldikKIHsKIAl1aW50MzJfdCB0bXA7CisJaW50IGk7CiAKLQkvKiByZXNldCBKTUkgKi8K
LQlXUkVHMzJfUChTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfSk1JX0NOVEwpLAotCQlV
VkRfSk1JX0NOVExfX1NPRlRfUkVTRVRfTUFTSywKLQkJflVWRF9KTUlfQ05UTF9fU09GVF9SRVNF
VF9NQVNLKTsKLQotCXRtcCA9IFJSRUczMl9TT0MxNShWQ04sIDAsIG1tSlBFR19DR0NfR0FURSk7
Ci0JdG1wIHw9IChKUEVHX0NHQ19HQVRFX19KUEVHX0RFQ19NQVNLCi0JCXxKUEVHX0NHQ19HQVRF
X19KUEVHMl9ERUNfTUFTSwotCQl8SlBFR19DR0NfR0FURV9fSk1DSUZfTUFTSwotCQl8SlBFR19D
R0NfR0FURV9fSlJCQk1fTUFTSyk7Ci0JV1JFRzMyX1NPQzE1KFZDTiwgMCwgbW1KUEVHX0NHQ19H
QVRFLCB0bXApOwotCi0JLyogZW5hYmxlIGFudGkgaGFuZyBtZWNoYW5pc20gKi8KLQlXUkVHMzJf
UChTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfSlBFR19QT1dFUl9TVEFUVVMpLAotCQlV
VkRfSlBFR19QT1dFUl9TVEFUVVNfX0pQRUdfUE9XRVJfU1RBVFVTX01BU0ssCi0JCX5VVkRfSlBF
R19QT1dFUl9TVEFUVVNfX0pQRUdfUE9XRVJfU1RBVFVTX01BU0spOworCWZvciAoaSA9IDA7IGkg
PCBhZGV2LT52Y24ubnVtX3Zjbl9pbnN0OyArK2kpIHsKKwkJLyogcmVzZXQgSk1JICovCisJCVdS
RUczMl9QKFNPQzE1X1JFR19PRkZTRVQoVVZELCBpLCBtbVVWRF9KTUlfQ05UTCksCisJCQlVVkRf
Sk1JX0NOVExfX1NPRlRfUkVTRVRfTUFTSywKKwkJCX5VVkRfSk1JX0NOVExfX1NPRlRfUkVTRVRf
TUFTSyk7CisKKwkJdG1wID0gUlJFRzMyX1NPQzE1KFZDTiwgaSwgbW1KUEVHX0NHQ19HQVRFKTsK
KwkJdG1wIHw9IChKUEVHX0NHQ19HQVRFX19KUEVHX0RFQ19NQVNLCisJCQl8SlBFR19DR0NfR0FU
RV9fSlBFRzJfREVDX01BU0sKKwkJCXxKUEVHX0NHQ19HQVRFX19KTUNJRl9NQVNLCisJCQl8SlBF
R19DR0NfR0FURV9fSlJCQk1fTUFTSyk7CisJCVdSRUczMl9TT0MxNShWQ04sIGksIG1tSlBFR19D
R0NfR0FURSwgdG1wKTsKKworCQkvKiBlbmFibGUgYW50aSBoYW5nIG1lY2hhbmlzbSAqLworCQlX
UkVHMzJfUChTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgaSwgbW1VVkRfSlBFR19QT1dFUl9TVEFUVVMp
LAorCQkJVVZEX0pQRUdfUE9XRVJfU1RBVFVTX19KUEVHX1BPV0VSX1NUQVRVU19NQVNLLAorCQkJ
flVWRF9KUEVHX1BPV0VSX1NUQVRVU19fSlBFR19QT1dFUl9TVEFUVVNfTUFTSyk7CisJfQogCiAJ
cmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgdmNuX3YyXzVfc3RhcnQoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYpCiB7Ci0Jc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPnZjbi5p
bnN0WzBdLnJpbmdfZGVjOworCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZzsKIAl1aW50MzJfdCBy
Yl9idWZzeiwgdG1wOwotCWludCBpLCBqLCByOworCWludCBpLCBqLCBrLCByOwogCi0JLyogZGlz
YWJsZSByZWdpc3RlciBhbnRpLWhhbmcgbWVjaGFuaXNtICovCi0JV1JFRzMyX1AoU09DMTVfUkVH
X09GRlNFVChVVkQsIDAsIG1tVVZEX1BPV0VSX1NUQVRVUyksIDAsCi0JCX5VVkRfUE9XRVJfU1RB
VFVTX19VVkRfUE9XRVJfU1RBVFVTX01BU0spOworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24u
bnVtX3Zjbl9pbnN0OyArK2kpIHsKKwkJLyogZGlzYWJsZSByZWdpc3RlciBhbnRpLWhhbmcgbWVj
aGFuaXNtICovCisJCVdSRUczMl9QKFNPQzE1X1JFR19PRkZTRVQoVVZELCBpLCBtbVVWRF9QT1dF
Ul9TVEFUVVMpLCAwLAorCQkJflVWRF9QT1dFUl9TVEFUVVNfX1VWRF9QT1dFUl9TVEFUVVNfTUFT
Syk7CiAKLQkvKiBzZXQgdXZkIHN0YXR1cyBidXN5ICovCi0JdG1wID0gUlJFRzMyX1NPQzE1KFVW
RCwgMCwgbW1VVkRfU1RBVFVTKSB8IFVWRF9TVEFUVVNfX1VWRF9CVVNZOwotCVdSRUczMl9TT0Mx
NShVVkQsIDAsIG1tVVZEX1NUQVRVUywgdG1wKTsKKwkJLyogc2V0IHV2ZCBzdGF0dXMgYnVzeSAq
LworCQl0bXAgPSBSUkVHMzJfU09DMTUoVVZELCBpLCBtbVVWRF9TVEFUVVMpIHwgVVZEX1NUQVRV
U19fVVZEX0JVU1k7CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX1NUQVRVUywgdG1wKTsK
Kwl9CiAKIAkvKlNXIGNsb2NrIGdhdGluZyAqLwogCXZjbl92Ml81X2Rpc2FibGVfY2xvY2tfZ2F0
aW5nKGFkZXYpOwogCi0JLyogZW5hYmxlIFZDUFUgY2xvY2sgKi8KLQlXUkVHMzJfUChTT0MxNV9S
RUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfVkNQVV9DTlRMKSwKLQkJVVZEX1ZDUFVfQ05UTF9fQ0xL
X0VOX01BU0ssIH5VVkRfVkNQVV9DTlRMX19DTEtfRU5fTUFTSyk7Ci0KLQkvKiBkaXNhYmxlIG1h
c3RlciBpbnRlcnJ1cHQgKi8KLQlXUkVHMzJfUChTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1V
VkRfTUFTVElOVF9FTiksIDAsCi0JCX5VVkRfTUFTVElOVF9FTl9fVkNQVV9FTl9NQVNLKTsKLQot
CS8qIHNldHVwIG1tVVZEX0xNSV9DVFJMICovCi0JdG1wID0gUlJFRzMyX1NPQzE1KFVWRCwgMCwg
bW1VVkRfTE1JX0NUUkwpOwotCXRtcCAmPSB+MHhmZjsKLQlXUkVHMzJfU09DMTUoVVZELCAwLCBt
bVVWRF9MTUlfQ1RSTCwgdG1wIHwgMHg4fAotCQlVVkRfTE1JX0NUUkxfX1dSSVRFX0NMRUFOX1RJ
TUVSX0VOX01BU0sJfAotCQlVVkRfTE1JX0NUUkxfX01BU0tfTUNfVVJHRU5UX01BU0sgfAotCQlV
VkRfTE1JX0NUUkxfX0RBVEFfQ09IRVJFTkNZX0VOX01BU0sgfAotCQlVVkRfTE1JX0NUUkxfX1ZD
UFVfREFUQV9DT0hFUkVOQ1lfRU5fTUFTSyk7Ci0KLQkvKiBzZXR1cCBtbVVWRF9NUENfQ05UTCAq
LwotCXRtcCA9IFJSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX01QQ19DTlRMKTsKLQl0bXAgJj0g
flVWRF9NUENfQ05UTF9fUkVQTEFDRU1FTlRfTU9ERV9NQVNLOwotCXRtcCB8PSAweDIgPDwgVVZE
X01QQ19DTlRMX19SRVBMQUNFTUVOVF9NT0RFX19TSElGVDsKLQlXUkVHMzJfU09DMTUoVkNOLCAw
LCBtbVVWRF9NUENfQ05UTCwgdG1wKTsKLQotCS8qIHNldHVwIFVWRF9NUENfU0VUX01VWEEwICov
Ci0JV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfTVBDX1NFVF9NVVhBMCwKLQkJKCgweDEgPDwg
VVZEX01QQ19TRVRfTVVYQTBfX1ZBUkFfMV9fU0hJRlQpIHwKLQkJKDB4MiA8PCBVVkRfTVBDX1NF
VF9NVVhBMF9fVkFSQV8yX19TSElGVCkgfAotCQkoMHgzIDw8IFVWRF9NUENfU0VUX01VWEEwX19W
QVJBXzNfX1NISUZUKSB8Ci0JCSgweDQgPDwgVVZEX01QQ19TRVRfTVVYQTBfX1ZBUkFfNF9fU0hJ
RlQpKSk7Ci0KLQkvKiBzZXR1cCBVVkRfTVBDX1NFVF9NVVhCMCAqLwotCVdSRUczMl9TT0MxNShV
VkQsIDAsIG1tVVZEX01QQ19TRVRfTVVYQjAsCi0JCSgoMHgxIDw8IFVWRF9NUENfU0VUX01VWEIw
X19WQVJCXzFfX1NISUZUKSB8Ci0JCSgweDIgPDwgVVZEX01QQ19TRVRfTVVYQjBfX1ZBUkJfMl9f
U0hJRlQpIHwKLQkJKDB4MyA8PCBVVkRfTVBDX1NFVF9NVVhCMF9fVkFSQl8zX19TSElGVCkgfAot
CQkoMHg0IDw8IFVWRF9NUENfU0VUX01VWEIwX19WQVJCXzRfX1NISUZUKSkpOwotCi0JLyogc2V0
dXAgbW1VVkRfTVBDX1NFVF9NVVggKi8KLQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9NUENf
U0VUX01VWCwKLQkJKCgweDAgPDwgVVZEX01QQ19TRVRfTVVYX19TRVRfMF9fU0hJRlQpIHwKLQkJ
KDB4MSA8PCBVVkRfTVBDX1NFVF9NVVhfX1NFVF8xX19TSElGVCkgfAotCQkoMHgyIDw8IFVWRF9N
UENfU0VUX01VWF9fU0VUXzJfX1NISUZUKSkpOworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24u
bnVtX3Zjbl9pbnN0OyArK2kpIHsKKwkJLyogZW5hYmxlIFZDUFUgY2xvY2sgKi8KKwkJV1JFRzMy
X1AoU09DMTVfUkVHX09GRlNFVChVVkQsIGksIG1tVVZEX1ZDUFVfQ05UTCksCisJCQlVVkRfVkNQ
VV9DTlRMX19DTEtfRU5fTUFTSywgflVWRF9WQ1BVX0NOVExfX0NMS19FTl9NQVNLKTsKKworCQkv
KiBkaXNhYmxlIG1hc3RlciBpbnRlcnJ1cHQgKi8KKwkJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNF
VChVVkQsIGksIG1tVVZEX01BU1RJTlRfRU4pLCAwLAorCQkJflVWRF9NQVNUSU5UX0VOX19WQ1BV
X0VOX01BU0spOworCisJCS8qIHNldHVwIG1tVVZEX0xNSV9DVFJMICovCisJCXRtcCA9IFJSRUcz
Ml9TT0MxNShVVkQsIGksIG1tVVZEX0xNSV9DVFJMKTsKKwkJdG1wICY9IH4weGZmOworCQlXUkVH
MzJfU09DMTUoVVZELCBpLCBtbVVWRF9MTUlfQ1RSTCwgdG1wIHwgMHg4fAorCQkJVVZEX0xNSV9D
VFJMX19XUklURV9DTEVBTl9USU1FUl9FTl9NQVNLCXwKKwkJCVVWRF9MTUlfQ1RSTF9fTUFTS19N
Q19VUkdFTlRfTUFTSyB8CisJCQlVVkRfTE1JX0NUUkxfX0RBVEFfQ09IRVJFTkNZX0VOX01BU0sg
fAorCQkJVVZEX0xNSV9DVFJMX19WQ1BVX0RBVEFfQ09IRVJFTkNZX0VOX01BU0spOworCisJCS8q
IHNldHVwIG1tVVZEX01QQ19DTlRMICovCisJCXRtcCA9IFJSRUczMl9TT0MxNShVVkQsIGksIG1t
VVZEX01QQ19DTlRMKTsKKwkJdG1wICY9IH5VVkRfTVBDX0NOVExfX1JFUExBQ0VNRU5UX01PREVf
TUFTSzsKKwkJdG1wIHw9IDB4MiA8PCBVVkRfTVBDX0NOVExfX1JFUExBQ0VNRU5UX01PREVfX1NI
SUZUOworCQlXUkVHMzJfU09DMTUoVkNOLCBpLCBtbVVWRF9NUENfQ05UTCwgdG1wKTsKKworCQkv
KiBzZXR1cCBVVkRfTVBDX1NFVF9NVVhBMCAqLworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVW
RF9NUENfU0VUX01VWEEwLAorCQkJKCgweDEgPDwgVVZEX01QQ19TRVRfTVVYQTBfX1ZBUkFfMV9f
U0hJRlQpIHwKKwkJCSgweDIgPDwgVVZEX01QQ19TRVRfTVVYQTBfX1ZBUkFfMl9fU0hJRlQpIHwK
KwkJCSgweDMgPDwgVVZEX01QQ19TRVRfTVVYQTBfX1ZBUkFfM19fU0hJRlQpIHwKKwkJCSgweDQg
PDwgVVZEX01QQ19TRVRfTVVYQTBfX1ZBUkFfNF9fU0hJRlQpKSk7CisKKwkJLyogc2V0dXAgVVZE
X01QQ19TRVRfTVVYQjAgKi8KKwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfTVBDX1NFVF9N
VVhCMCwKKwkJCSgoMHgxIDw8IFVWRF9NUENfU0VUX01VWEIwX19WQVJCXzFfX1NISUZUKSB8CisJ
CQkoMHgyIDw8IFVWRF9NUENfU0VUX01VWEIwX19WQVJCXzJfX1NISUZUKSB8CisJCQkoMHgzIDw8
IFVWRF9NUENfU0VUX01VWEIwX19WQVJCXzNfX1NISUZUKSB8CisJCQkoMHg0IDw8IFVWRF9NUENf
U0VUX01VWEIwX19WQVJCXzRfX1NISUZUKSkpOworCisJCS8qIHNldHVwIG1tVVZEX01QQ19TRVRf
TVVYICovCisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX01QQ19TRVRfTVVYLAorCQkJKCgw
eDAgPDwgVVZEX01QQ19TRVRfTVVYX19TRVRfMF9fU0hJRlQpIHwKKwkJCSgweDEgPDwgVVZEX01Q
Q19TRVRfTVVYX19TRVRfMV9fU0hJRlQpIHwKKwkJCSgweDIgPDwgVVZEX01QQ19TRVRfTVVYX19T
RVRfMl9fU0hJRlQpKSk7CisJfQogCiAJdmNuX3YyXzVfbWNfcmVzdW1lKGFkZXYpOwogCi0JLyog
VkNOIGdsb2JhbCB0aWxpbmcgcmVnaXN0ZXJzICovCi0JV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1V
VkRfR0ZYOF9BRERSX0NPTkZJRywKLQkJYWRldi0+Z2Z4LmNvbmZpZy5nYl9hZGRyX2NvbmZpZyk7
Ci0JV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfR0ZYOF9BRERSX0NPTkZJRywKLQkJYWRldi0+
Z2Z4LmNvbmZpZy5nYl9hZGRyX2NvbmZpZyk7CisJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5u
dW1fdmNuX2luc3Q7ICsraSkgeworCQkvKiBWQ04gZ2xvYmFsIHRpbGluZyByZWdpc3RlcnMgKi8K
KwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfR0ZYOF9BRERSX0NPTkZJRywKKwkJCWFkZXYt
PmdmeC5jb25maWcuZ2JfYWRkcl9jb25maWcpOworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVW
RF9HRlg4X0FERFJfQ09ORklHLAorCQkJYWRldi0+Z2Z4LmNvbmZpZy5nYl9hZGRyX2NvbmZpZyk7
CiAKLQkvKiBlbmFibGUgTE1JIE1DIGFuZCBVTUMgY2hhbm5lbHMgKi8KLQlXUkVHMzJfUChTT0Mx
NV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfTE1JX0NUUkwyKSwgMCwKLQkJflVWRF9MTUlfQ1RS
TDJfX1NUQUxMX0FSQl9VTUNfTUFTSyk7CisJCS8qIGVuYWJsZSBMTUkgTUMgYW5kIFVNQyBjaGFu
bmVscyAqLworCQlXUkVHMzJfUChTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgaSwgbW1VVkRfTE1JX0NU
UkwyKSwgMCwKKwkJCX5VVkRfTE1JX0NUUkwyX19TVEFMTF9BUkJfVU1DX01BU0spOwogCi0JLyog
dW5ibG9jayBWQ1BVIHJlZ2lzdGVyIGFjY2VzcyAqLwotCVdSRUczMl9QKFNPQzE1X1JFR19PRkZT
RVQoVVZELCAwLCBtbVVWRF9SQl9BUkJfQ1RSTCksIDAsCi0JCX5VVkRfUkJfQVJCX0NUUkxfX1ZD
UFVfRElTX01BU0spOworCQkvKiB1bmJsb2NrIFZDUFUgcmVnaXN0ZXIgYWNjZXNzICovCisJCVdS
RUczMl9QKFNPQzE1X1JFR19PRkZTRVQoVVZELCBpLCBtbVVWRF9SQl9BUkJfQ1RSTCksIDAsCisJ
CQl+VVZEX1JCX0FSQl9DVFJMX19WQ1BVX0RJU19NQVNLKTsKIAotCVdSRUczMl9QKFNPQzE1X1JF
R19PRkZTRVQoVVZELCAwLCBtbVVWRF9WQ1BVX0NOVEwpLCAwLAotCQl+VVZEX1ZDUFVfQ05UTF9f
QkxLX1JTVF9NQVNLKTsKLQotCWZvciAoaSA9IDA7IGkgPCAxMDsgKytpKSB7Ci0JCXVpbnQzMl90
IHN0YXR1czsKKwkJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQsIGksIG1tVVZEX1ZDUFVf
Q05UTCksIDAsCisJCQl+VVZEX1ZDUFVfQ05UTF9fQkxLX1JTVF9NQVNLKTsKIAotCQlmb3IgKGog
PSAwOyBqIDwgMTAwOyArK2opIHsKLQkJCXN0YXR1cyA9IFJSRUczMl9TT0MxNShVVkQsIDAsIG1t
VVZEX1NUQVRVUyk7CisJCWZvciAoayA9IDA7IGsgPCAxMDsgKytrKSB7CisJCQl1aW50MzJfdCBz
dGF0dXM7CisKKwkJCWZvciAoaiA9IDA7IGogPCAxMDA7ICsraikgeworCQkJCXN0YXR1cyA9IFJS
RUczMl9TT0MxNShVVkQsIGksIG1tVVZEX1NUQVRVUyk7CisJCQkJaWYgKHN0YXR1cyAmIDIpCisJ
CQkJCWJyZWFrOworCQkJCWlmIChhbWRncHVfZW11X21vZGUgPT0gMSkKKwkJCQkJbXNsZWVwKDUw
MCk7CisJCQkJZWxzZQorCQkJCQltZGVsYXkoMTApOworCQkJfQorCQkJciA9IDA7CiAJCQlpZiAo
c3RhdHVzICYgMikKIAkJCQlicmVhazsKLQkJCWlmIChhbWRncHVfZW11X21vZGUgPT0gMSkKLQkJ
CQltc2xlZXAoNTAwKTsKLQkJCWVsc2UKLQkJCQltZGVsYXkoMTApOwotCQl9Ci0JCXIgPSAwOwot
CQlpZiAoc3RhdHVzICYgMikKLQkJCWJyZWFrOwotCi0JCURSTV9FUlJPUigiVkNOIGRlY29kZSBu
b3QgcmVzcG9uZGluZywgdHJ5aW5nIHRvIHJlc2V0IHRoZSBWQ1BVISEhXG4iKTsKLQkJV1JFRzMy
X1AoU09DMTVfUkVHX09GRlNFVChVVkQsIDAsIG1tVVZEX1ZDUFVfQ05UTCksCi0JCQlVVkRfVkNQ
VV9DTlRMX19CTEtfUlNUX01BU0ssCi0JCQl+VVZEX1ZDUFVfQ05UTF9fQkxLX1JTVF9NQVNLKTsK
LQkJbWRlbGF5KDEwKTsKLQkJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQsIDAsIG1tVVZE
X1ZDUFVfQ05UTCksIDAsCi0JCQl+VVZEX1ZDUFVfQ05UTF9fQkxLX1JTVF9NQVNLKTsKIAotCQlt
ZGVsYXkoMTApOwotCQlyID0gLTE7Ci0JfQorCQkJRFJNX0VSUk9SKCJWQ04gZGVjb2RlIG5vdCBy
ZXNwb25kaW5nLCB0cnlpbmcgdG8gcmVzZXQgdGhlIFZDUFUhISFcbiIpOworCQkJV1JFRzMyX1Ao
U09DMTVfUkVHX09GRlNFVChVVkQsIGksIG1tVVZEX1ZDUFVfQ05UTCksCisJCQkJVVZEX1ZDUFVf
Q05UTF9fQkxLX1JTVF9NQVNLLAorCQkJCX5VVkRfVkNQVV9DTlRMX19CTEtfUlNUX01BU0spOwor
CQkJbWRlbGF5KDEwKTsKKwkJCVdSRUczMl9QKFNPQzE1X1JFR19PRkZTRVQoVVZELCBpLCBtbVVW
RF9WQ1BVX0NOVEwpLCAwLAorCQkJCX5VVkRfVkNQVV9DTlRMX19CTEtfUlNUX01BU0spOwogCi0J
aWYgKHIpIHsKLQkJRFJNX0VSUk9SKCJWQ04gZGVjb2RlIG5vdCByZXNwb25kaW5nLCBnaXZpbmcg
dXAhISFcbiIpOwotCQlyZXR1cm4gcjsKLQl9CisJCQltZGVsYXkoMTApOworCQkJciA9IC0xOwor
CQl9CiAKLQkvKiBlbmFibGUgbWFzdGVyIGludGVycnVwdCAqLwotCVdSRUczMl9QKFNPQzE1X1JF
R19PRkZTRVQoVVZELCAwLCBtbVVWRF9NQVNUSU5UX0VOKSwKLQkJVVZEX01BU1RJTlRfRU5fX1ZD
UFVfRU5fTUFTSywKLQkJflVWRF9NQVNUSU5UX0VOX19WQ1BVX0VOX01BU0spOwotCi0JLyogY2xl
YXIgdGhlIGJ1c3kgYml0IG9mIFZDTl9TVEFUVVMgKi8KLQlXUkVHMzJfUChTT0MxNV9SRUdfT0ZG
U0VUKFVWRCwgMCwgbW1VVkRfU1RBVFVTKSwgMCwKLQkJfigyIDw8IFVWRF9TVEFUVVNfX1ZDUFVf
UkVQT1JUX19TSElGVCkpOwotCi0JV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfTE1JX1JCQ19S
Ql9WTUlELCAwKTsKLQotCS8qIGZvcmNlIFJCQyBpbnRvIGlkbGUgc3RhdGUgKi8KLQlyYl9idWZz
eiA9IG9yZGVyX2Jhc2VfMihyaW5nLT5yaW5nX3NpemUpOwotCXRtcCA9IFJFR19TRVRfRklFTEQo
MCwgVVZEX1JCQ19SQl9DTlRMLCBSQl9CVUZTWiwgcmJfYnVmc3opOwotCXRtcCA9IFJFR19TRVRf
RklFTEQodG1wLCBVVkRfUkJDX1JCX0NOVEwsIFJCX0JMS1NaLCAxKTsKLQl0bXAgPSBSRUdfU0VU
X0ZJRUxEKHRtcCwgVVZEX1JCQ19SQl9DTlRMLCBSQl9OT19GRVRDSCwgMSk7Ci0JdG1wID0gUkVH
X1NFVF9GSUVMRCh0bXAsIFVWRF9SQkNfUkJfQ05UTCwgUkJfTk9fVVBEQVRFLCAxKTsKLQl0bXAg
PSBSRUdfU0VUX0ZJRUxEKHRtcCwgVVZEX1JCQ19SQl9DTlRMLCBSQl9SUFRSX1dSX0VOLCAxKTsK
LQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQkNfUkJfQ05UTCwgdG1wKTsKLQotCS8qIHBy
b2dyYW1tIHRoZSBSQl9CQVNFIGZvciByaW5nIGJ1ZmZlciAqLwotCVdSRUczMl9TT0MxNShVVkQs
IDAsIG1tVVZEX0xNSV9SQkNfUkJfNjRCSVRfQkFSX0xPVywKLQkJbG93ZXJfMzJfYml0cyhyaW5n
LT5ncHVfYWRkcikpOwotCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX0xNSV9SQkNfUkJfNjRC
SVRfQkFSX0hJR0gsCi0JCXVwcGVyXzMyX2JpdHMocmluZy0+Z3B1X2FkZHIpKTsKLQotCS8qIElu
aXRpYWxpemUgdGhlIHJpbmcgYnVmZmVyJ3MgcmVhZCBhbmQgd3JpdGUgcG9pbnRlcnMgKi8KLQlX
UkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQkNfUkJfUlBUUiwgMCk7Ci0KLQlyaW5nLT53cHRy
ID0gUlJFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJDX1JCX1JQVFIpOwotCVdSRUczMl9TT0Mx
NShVVkQsIDAsIG1tVVZEX1JCQ19SQl9XUFRSLAotCQkJbG93ZXJfMzJfYml0cyhyaW5nLT53cHRy
KSk7Ci0JcmluZyA9ICZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2VuY1swXTsKLQlXUkVHMzJfU09D
MTUoVVZELCAwLCBtbVVWRF9SQl9SUFRSLCBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpKTsKLQlX
UkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9XUFRSLCBsb3dlcl8zMl9iaXRzKHJpbmctPndw
dHIpKTsKLQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9CQVNFX0xPLCByaW5nLT5ncHVf
YWRkcik7Ci0JV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfQkFTRV9ISSwgdXBwZXJfMzJf
Yml0cyhyaW5nLT5ncHVfYWRkcikpOwotCVdSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX1NJ
WkUsIHJpbmctPnJpbmdfc2l6ZSAvIDQpOwotCi0JcmluZyA9ICZhZGV2LT52Y24uaW5zdFswXS5y
aW5nX2VuY1sxXTsKLQlXUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9SUFRSMiwgbG93ZXJf
MzJfYml0cyhyaW5nLT53cHRyKSk7Ci0JV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfV1BU
UjIsIGxvd2VyXzMyX2JpdHMocmluZy0+d3B0cikpOwotCVdSRUczMl9TT0MxNShVVkQsIDAsIG1t
VVZEX1JCX0JBU0VfTE8yLCByaW5nLT5ncHVfYWRkcik7Ci0JV1JFRzMyX1NPQzE1KFVWRCwgMCwg
bW1VVkRfUkJfQkFTRV9ISTIsIHVwcGVyXzMyX2JpdHMocmluZy0+Z3B1X2FkZHIpKTsKLQlXUkVH
MzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9TSVpFMiwgcmluZy0+cmluZ19zaXplIC8gNCk7CisJ
CWlmIChyKSB7CisJCQlEUk1fRVJST1IoIlZDTiBkZWNvZGUgbm90IHJlc3BvbmRpbmcsIGdpdmlu
ZyB1cCEhIVxuIik7CisJCQlyZXR1cm4gcjsKKwkJfQogCisJCS8qIGVuYWJsZSBtYXN0ZXIgaW50
ZXJydXB0ICovCisJCVdSRUczMl9QKFNPQzE1X1JFR19PRkZTRVQoVVZELCBpLCBtbVVWRF9NQVNU
SU5UX0VOKSwKKwkJCVVWRF9NQVNUSU5UX0VOX19WQ1BVX0VOX01BU0ssCisJCQl+VVZEX01BU1RJ
TlRfRU5fX1ZDUFVfRU5fTUFTSyk7CisKKwkJLyogY2xlYXIgdGhlIGJ1c3kgYml0IG9mIFZDTl9T
VEFUVVMgKi8KKwkJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQsIGksIG1tVVZEX1NUQVRV
UyksIDAsCisJCQl+KDIgPDwgVVZEX1NUQVRVU19fVkNQVV9SRVBPUlRfX1NISUZUKSk7CisKKwkJ
V1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfTE1JX1JCQ19SQl9WTUlELCAwKTsKKworCQlyaW5n
ID0gJmFkZXYtPnZjbi5pbnN0W2ldLnJpbmdfZGVjOworCQkvKiBmb3JjZSBSQkMgaW50byBpZGxl
IHN0YXRlICovCisJCXJiX2J1ZnN6ID0gb3JkZXJfYmFzZV8yKHJpbmctPnJpbmdfc2l6ZSk7CisJ
CXRtcCA9IFJFR19TRVRfRklFTEQoMCwgVVZEX1JCQ19SQl9DTlRMLCBSQl9CVUZTWiwgcmJfYnVm
c3opOworCQl0bXAgPSBSRUdfU0VUX0ZJRUxEKHRtcCwgVVZEX1JCQ19SQl9DTlRMLCBSQl9CTEtT
WiwgMSk7CisJCXRtcCA9IFJFR19TRVRfRklFTEQodG1wLCBVVkRfUkJDX1JCX0NOVEwsIFJCX05P
X0ZFVENILCAxKTsKKwkJdG1wID0gUkVHX1NFVF9GSUVMRCh0bXAsIFVWRF9SQkNfUkJfQ05UTCwg
UkJfTk9fVVBEQVRFLCAxKTsKKwkJdG1wID0gUkVHX1NFVF9GSUVMRCh0bXAsIFVWRF9SQkNfUkJf
Q05UTCwgUkJfUlBUUl9XUl9FTiwgMSk7CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX1JC
Q19SQl9DTlRMLCB0bXApOworCisJCS8qIHByb2dyYW1tIHRoZSBSQl9CQVNFIGZvciByaW5nIGJ1
ZmZlciAqLworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVWRF9MTUlfUkJDX1JCXzY0QklUX0JB
Ul9MT1csCisJCQlsb3dlcl8zMl9iaXRzKHJpbmctPmdwdV9hZGRyKSk7CisJCVdSRUczMl9TT0Mx
NShVVkQsIGksIG1tVVZEX0xNSV9SQkNfUkJfNjRCSVRfQkFSX0hJR0gsCisJCQl1cHBlcl8zMl9i
aXRzKHJpbmctPmdwdV9hZGRyKSk7CisKKwkJLyogSW5pdGlhbGl6ZSB0aGUgcmluZyBidWZmZXIn
cyByZWFkIGFuZCB3cml0ZSBwb2ludGVycyAqLworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVW
RF9SQkNfUkJfUlBUUiwgMCk7CisKKwkJcmluZy0+d3B0ciA9IFJSRUczMl9TT0MxNShVVkQsIGks
IG1tVVZEX1JCQ19SQl9SUFRSKTsKKwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfUkJDX1JC
X1dQVFIsCisJCQkJbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CisJCXJpbmcgPSAmYWRldi0+
dmNuLmluc3RbaV0ucmluZ19lbmNbMF07CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX1JC
X1JQVFIsIGxvd2VyXzMyX2JpdHMocmluZy0+d3B0cikpOworCQlXUkVHMzJfU09DMTUoVVZELCBp
LCBtbVVWRF9SQl9XUFRSLCBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpKTsKKwkJV1JFRzMyX1NP
QzE1KFVWRCwgaSwgbW1VVkRfUkJfQkFTRV9MTywgcmluZy0+Z3B1X2FkZHIpOworCQlXUkVHMzJf
U09DMTUoVVZELCBpLCBtbVVWRF9SQl9CQVNFX0hJLCB1cHBlcl8zMl9iaXRzKHJpbmctPmdwdV9h
ZGRyKSk7CisJCVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX1JCX1NJWkUsIHJpbmctPnJpbmdf
c2l6ZSAvIDQpOworCisJCXJpbmcgPSAmYWRldi0+dmNuLmluc3RbaV0ucmluZ19lbmNbMV07CisJ
CVdSRUczMl9TT0MxNShVVkQsIGksIG1tVVZEX1JCX1JQVFIyLCBsb3dlcl8zMl9iaXRzKHJpbmct
PndwdHIpKTsKKwkJV1JFRzMyX1NPQzE1KFVWRCwgaSwgbW1VVkRfUkJfV1BUUjIsIGxvd2VyXzMy
X2JpdHMocmluZy0+d3B0cikpOworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVWRF9SQl9CQVNF
X0xPMiwgcmluZy0+Z3B1X2FkZHIpOworCQlXUkVHMzJfU09DMTUoVVZELCBpLCBtbVVWRF9SQl9C
QVNFX0hJMiwgdXBwZXJfMzJfYml0cyhyaW5nLT5ncHVfYWRkcikpOworCQlXUkVHMzJfU09DMTUo
VVZELCBpLCBtbVVWRF9SQl9TSVpFMiwgcmluZy0+cmluZ19zaXplIC8gNCk7CisJfQogCXIgPSBq
cGVnX3YyXzVfc3RhcnQoYWRldik7CiAKIAlyZXR1cm4gcjsKQEAgLTgwNCw1OSArODU0LDYxIEBA
IHN0YXRpYyBpbnQgdmNuX3YyXzVfc3RhcnQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiBz
dGF0aWMgaW50IHZjbl92Ml81X3N0b3Aoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7CiAJ
dWludDMyX3QgdG1wOwotCWludCByOworCWludCBpLCByOwogCiAJciA9IGpwZWdfdjJfNV9zdG9w
KGFkZXYpOwogCWlmIChyKQogCQlyZXR1cm4gcjsKIAotCS8qIHdhaXQgZm9yIHZjbiBpZGxlICov
Ci0JU09DMTVfV0FJVF9PTl9SUkVHKFZDTiwgMCwgbW1VVkRfU1RBVFVTLCBVVkRfU1RBVFVTX19J
RExFLCAweDcsIHIpOwotCWlmIChyKQotCQlyZXR1cm4gcjsKKwlmb3IgKGkgPSAwOyBpIDwgYWRl
di0+dmNuLm51bV92Y25faW5zdDsgKytpKSB7CisJCS8qIHdhaXQgZm9yIHZjbiBpZGxlICovCisJ
CVNPQzE1X1dBSVRfT05fUlJFRyhWQ04sIGksIG1tVVZEX1NUQVRVUywgVVZEX1NUQVRVU19fSURM
RSwgMHg3LCByKTsKKwkJaWYgKHIpCisJCQlyZXR1cm4gcjsKIAotCXRtcCA9IFVWRF9MTUlfU1RB
VFVTX19WQ1BVX0xNSV9XUklURV9DTEVBTl9NQVNLIHwKLQkJVVZEX0xNSV9TVEFUVVNfX1JFQURf
Q0xFQU5fTUFTSyB8Ci0JCVVWRF9MTUlfU1RBVFVTX19XUklURV9DTEVBTl9NQVNLIHwKLQkJVVZE
X0xNSV9TVEFUVVNfX1dSSVRFX0NMRUFOX1JBV19NQVNLOwotCVNPQzE1X1dBSVRfT05fUlJFRyhW
Q04sIDAsIG1tVVZEX0xNSV9TVEFUVVMsIHRtcCwgdG1wLCByKTsKLQlpZiAocikKLQkJcmV0dXJu
IHI7CisJCXRtcCA9IFVWRF9MTUlfU1RBVFVTX19WQ1BVX0xNSV9XUklURV9DTEVBTl9NQVNLIHwK
KwkJCVVWRF9MTUlfU1RBVFVTX19SRUFEX0NMRUFOX01BU0sgfAorCQkJVVZEX0xNSV9TVEFUVVNf
X1dSSVRFX0NMRUFOX01BU0sgfAorCQkJVVZEX0xNSV9TVEFUVVNfX1dSSVRFX0NMRUFOX1JBV19N
QVNLOworCQlTT0MxNV9XQUlUX09OX1JSRUcoVkNOLCBpLCBtbVVWRF9MTUlfU1RBVFVTLCB0bXAs
IHRtcCwgcik7CisJCWlmIChyKQorCQkJcmV0dXJuIHI7CiAKLQkvKiBibG9jayBMTUkgVU1DIGNo
YW5uZWwgKi8KLQl0bXAgPSBSUkVHMzJfU09DMTUoVkNOLCAwLCBtbVVWRF9MTUlfQ1RSTDIpOwot
CXRtcCB8PSBVVkRfTE1JX0NUUkwyX19TVEFMTF9BUkJfVU1DX01BU0s7Ci0JV1JFRzMyX1NPQzE1
KFZDTiwgMCwgbW1VVkRfTE1JX0NUUkwyLCB0bXApOworCQkvKiBibG9jayBMTUkgVU1DIGNoYW5u
ZWwgKi8KKwkJdG1wID0gUlJFRzMyX1NPQzE1KFZDTiwgaSwgbW1VVkRfTE1JX0NUUkwyKTsKKwkJ
dG1wIHw9IFVWRF9MTUlfQ1RSTDJfX1NUQUxMX0FSQl9VTUNfTUFTSzsKKwkJV1JFRzMyX1NPQzE1
KFZDTiwgaSwgbW1VVkRfTE1JX0NUUkwyLCB0bXApOwogCi0JdG1wID0gVVZEX0xNSV9TVEFUVVNf
X1VNQ19SRUFEX0NMRUFOX1JBV19NQVNLfAotCQlVVkRfTE1JX1NUQVRVU19fVU1DX1dSSVRFX0NM
RUFOX1JBV19NQVNLOwotCVNPQzE1X1dBSVRfT05fUlJFRyhWQ04sIDAsIG1tVVZEX0xNSV9TVEFU
VVMsIHRtcCwgdG1wLCByKTsKLQlpZiAocikKLQkJcmV0dXJuIHI7CisJCXRtcCA9IFVWRF9MTUlf
U1RBVFVTX19VTUNfUkVBRF9DTEVBTl9SQVdfTUFTS3wKKwkJCVVWRF9MTUlfU1RBVFVTX19VTUNf
V1JJVEVfQ0xFQU5fUkFXX01BU0s7CisJCVNPQzE1X1dBSVRfT05fUlJFRyhWQ04sIGksIG1tVVZE
X0xNSV9TVEFUVVMsIHRtcCwgdG1wLCByKTsKKwkJaWYgKHIpCisJCQlyZXR1cm4gcjsKIAotCS8q
IGJsb2NrIFZDUFUgcmVnaXN0ZXIgYWNjZXNzICovCi0JV1JFRzMyX1AoU09DMTVfUkVHX09GRlNF
VChVVkQsIDAsIG1tVVZEX1JCX0FSQl9DVFJMKSwKLQkJVVZEX1JCX0FSQl9DVFJMX19WQ1BVX0RJ
U19NQVNLLAotCQl+VVZEX1JCX0FSQl9DVFJMX19WQ1BVX0RJU19NQVNLKTsKKwkJLyogYmxvY2sg
VkNQVSByZWdpc3RlciBhY2Nlc3MgKi8KKwkJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQs
IGksIG1tVVZEX1JCX0FSQl9DVFJMKSwKKwkJCVVWRF9SQl9BUkJfQ1RSTF9fVkNQVV9ESVNfTUFT
SywKKwkJCX5VVkRfUkJfQVJCX0NUUkxfX1ZDUFVfRElTX01BU0spOwogCi0JLyogcmVzZXQgVkNQ
VSAqLwotCVdSRUczMl9QKFNPQzE1X1JFR19PRkZTRVQoVVZELCAwLCBtbVVWRF9WQ1BVX0NOVEwp
LAotCQlVVkRfVkNQVV9DTlRMX19CTEtfUlNUX01BU0ssCi0JCX5VVkRfVkNQVV9DTlRMX19CTEtf
UlNUX01BU0spOworCQkvKiByZXNldCBWQ1BVICovCisJCVdSRUczMl9QKFNPQzE1X1JFR19PRkZT
RVQoVVZELCBpLCBtbVVWRF9WQ1BVX0NOVEwpLAorCQkJVVZEX1ZDUFVfQ05UTF9fQkxLX1JTVF9N
QVNLLAorCQkJflVWRF9WQ1BVX0NOVExfX0JMS19SU1RfTUFTSyk7CiAKLQkvKiBkaXNhYmxlIFZD
UFUgY2xvY2sgKi8KLQlXUkVHMzJfUChTT0MxNV9SRUdfT0ZGU0VUKFVWRCwgMCwgbW1VVkRfVkNQ
VV9DTlRMKSwgMCwKLQkJfihVVkRfVkNQVV9DTlRMX19DTEtfRU5fTUFTSykpOworCQkvKiBkaXNh
YmxlIFZDUFUgY2xvY2sgKi8KKwkJV1JFRzMyX1AoU09DMTVfUkVHX09GRlNFVChVVkQsIGksIG1t
VVZEX1ZDUFVfQ05UTCksIDAsCisJCQl+KFVWRF9WQ1BVX0NOVExfX0NMS19FTl9NQVNLKSk7CiAK
LQkvKiBjbGVhciBzdGF0dXMgKi8KLQlXUkVHMzJfU09DMTUoVkNOLCAwLCBtbVVWRF9TVEFUVVMs
IDApOworCQkvKiBjbGVhciBzdGF0dXMgKi8KKwkJV1JFRzMyX1NPQzE1KFZDTiwgaSwgbW1VVkRf
U1RBVFVTLCAwKTsKIAotCXZjbl92Ml81X2VuYWJsZV9jbG9ja19nYXRpbmcoYWRldik7CisJCXZj
bl92Ml81X2VuYWJsZV9jbG9ja19nYXRpbmcoYWRldik7CiAKLQkvKiBlbmFibGUgcmVnaXN0ZXIg
YW50aS1oYW5nIG1lY2hhbmlzbSAqLwotCVdSRUczMl9QKFNPQzE1X1JFR19PRkZTRVQoVVZELCAw
LCBtbVVWRF9QT1dFUl9TVEFUVVMpLAotCQlVVkRfUE9XRVJfU1RBVFVTX19VVkRfUE9XRVJfU1RB
VFVTX01BU0ssCi0JCX5VVkRfUE9XRVJfU1RBVFVTX19VVkRfUE9XRVJfU1RBVFVTX01BU0spOwor
CQkvKiBlbmFibGUgcmVnaXN0ZXIgYW50aS1oYW5nIG1lY2hhbmlzbSAqLworCQlXUkVHMzJfUChT
T0MxNV9SRUdfT0ZGU0VUKFVWRCwgaSwgbW1VVkRfUE9XRVJfU1RBVFVTKSwKKwkJCVVWRF9QT1dF
Ul9TVEFUVVNfX1VWRF9QT1dFUl9TVEFUVVNfTUFTSywKKwkJCX5VVkRfUE9XRVJfU1RBVFVTX19V
VkRfUE9XRVJfU1RBVFVTX01BU0spOworCX0KIAogCXJldHVybiAwOwogfQpAQCAtODcyLDcgKzky
NCw3IEBAIHN0YXRpYyB1aW50NjRfdCB2Y25fdjJfNV9kZWNfcmluZ19nZXRfcnB0cihzdHJ1Y3Qg
YW1kZ3B1X3JpbmcgKnJpbmcpCiB7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5n
LT5hZGV2OwogCi0JcmV0dXJuIFJSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCQ19SQl9SUFRS
KTsKKwlyZXR1cm4gUlJFRzMyX1NPQzE1KFVWRCwgcmluZy0+bWUsIG1tVVZEX1JCQ19SQl9SUFRS
KTsKIH0KIAogLyoqCkBAIC04ODksNyArOTQxLDcgQEAgc3RhdGljIHVpbnQ2NF90IHZjbl92Ml81
X2RlY19yaW5nX2dldF93cHRyKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykKIAlpZiAocmluZy0+
dXNlX2Rvb3JiZWxsKQogCQlyZXR1cm4gYWRldi0+d2Iud2JbcmluZy0+d3B0cl9vZmZzXTsKIAll
bHNlCi0JCXJldHVybiBSUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQkNfUkJfV1BUUik7CisJ
CXJldHVybiBSUkVHMzJfU09DMTUoVVZELCByaW5nLT5tZSwgbW1VVkRfUkJDX1JCX1dQVFIpOwog
fQogCiAvKioKQEAgLTkwNyw3ICs5NTksNyBAQCBzdGF0aWMgdm9pZCB2Y25fdjJfNV9kZWNfcmlu
Z19zZXRfd3B0cihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCiAJCWFkZXYtPndiLndiW3Jpbmct
PndwdHJfb2Zmc10gPSBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpOwogCQlXRE9PUkJFTEwzMihy
aW5nLT5kb29yYmVsbF9pbmRleCwgbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJfSBlbHNl
IHsKLQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJDX1JCX1dQVFIsIGxvd2VyXzMyX2Jp
dHMocmluZy0+d3B0cikpOworCQlXUkVHMzJfU09DMTUoVVZELCByaW5nLT5tZSwgbW1VVkRfUkJD
X1JCX1dQVFIsIGxvd2VyXzMyX2JpdHMocmluZy0+d3B0cikpOwogCX0KIH0KIApAQCAtOTUyLDEw
ICsxMDA0LDEwIEBAIHN0YXRpYyB1aW50NjRfdCB2Y25fdjJfNV9lbmNfcmluZ19nZXRfcnB0cihz
dHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCiB7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYg
PSByaW5nLT5hZGV2OwogCi0JaWYgKHJpbmcgPT0gJmFkZXYtPnZjbi5pbnN0WzBdLnJpbmdfZW5j
WzBdKQotCQlyZXR1cm4gUlJFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfUlBUUik7CisJaWYg
KHJpbmcgPT0gJmFkZXYtPnZjbi5pbnN0W3JpbmctPm1lXS5yaW5nX2VuY1swXSkKKwkJcmV0dXJu
IFJSRUczMl9TT0MxNShVVkQsIHJpbmctPm1lLCBtbVVWRF9SQl9SUFRSKTsKIAllbHNlCi0JCXJl
dHVybiBSUkVHMzJfU09DMTUoVVZELCAwLCBtbVVWRF9SQl9SUFRSMik7CisJCXJldHVybiBSUkVH
MzJfU09DMTUoVVZELCByaW5nLT5tZSwgbW1VVkRfUkJfUlBUUjIpOwogfQogCiAvKioKQEAgLTk2
OSwxNiArMTAyMSwxNiBAQCBzdGF0aWMgdWludDY0X3QgdmNuX3YyXzVfZW5jX3JpbmdfZ2V0X3dw
dHIoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nKQogewogCXN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2ID0gcmluZy0+YWRldjsKIAotCWlmIChyaW5nID09ICZhZGV2LT52Y24uaW5zdFswXS5yaW5n
X2VuY1swXSkgeworCWlmIChyaW5nID09ICZhZGV2LT52Y24uaW5zdFtyaW5nLT5tZV0ucmluZ19l
bmNbMF0pIHsKIAkJaWYgKHJpbmctPnVzZV9kb29yYmVsbCkKIAkJCXJldHVybiBhZGV2LT53Yi53
YltyaW5nLT53cHRyX29mZnNdOwogCQllbHNlCi0JCQlyZXR1cm4gUlJFRzMyX1NPQzE1KFVWRCwg
MCwgbW1VVkRfUkJfV1BUUik7CisJCQlyZXR1cm4gUlJFRzMyX1NPQzE1KFVWRCwgcmluZy0+bWUs
IG1tVVZEX1JCX1dQVFIpOwogCX0gZWxzZSB7CiAJCWlmIChyaW5nLT51c2VfZG9vcmJlbGwpCiAJ
CQlyZXR1cm4gYWRldi0+d2Iud2JbcmluZy0+d3B0cl9vZmZzXTsKIAkJZWxzZQotCQkJcmV0dXJu
IFJSRUczMl9TT0MxNShVVkQsIDAsIG1tVVZEX1JCX1dQVFIyKTsKKwkJCXJldHVybiBSUkVHMzJf
U09DMTUoVVZELCByaW5nLT5tZSwgbW1VVkRfUkJfV1BUUjIpOwogCX0KIH0KIApAQCAtOTkzLDE5
ICsxMDQ1LDE5IEBAIHN0YXRpYyB2b2lkIHZjbl92Ml81X2VuY19yaW5nX3NldF93cHRyKHN0cnVj
dCBhbWRncHVfcmluZyAqcmluZykKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IHJp
bmctPmFkZXY7CiAKLQlpZiAocmluZyA9PSAmYWRldi0+dmNuLmluc3RbMF0ucmluZ19lbmNbMF0p
IHsKKwlpZiAocmluZyA9PSAmYWRldi0+dmNuLmluc3RbcmluZy0+bWVdLnJpbmdfZW5jWzBdKSB7
CiAJCWlmIChyaW5nLT51c2VfZG9vcmJlbGwpIHsKIAkJCWFkZXYtPndiLndiW3JpbmctPndwdHJf
b2Zmc10gPSBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpOwogCQkJV0RPT1JCRUxMMzIocmluZy0+
ZG9vcmJlbGxfaW5kZXgsIGxvd2VyXzMyX2JpdHMocmluZy0+d3B0cikpOwogCQl9IGVsc2Ugewot
CQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfUkJfV1BUUiwgbG93ZXJfMzJfYml0cyhyaW5n
LT53cHRyKSk7CisJCQlXUkVHMzJfU09DMTUoVVZELCByaW5nLT5tZSwgbW1VVkRfUkJfV1BUUiwg
bG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJCX0KIAl9IGVsc2UgewogCQlpZiAocmluZy0+
dXNlX2Rvb3JiZWxsKSB7CiAJCQlhZGV2LT53Yi53YltyaW5nLT53cHRyX29mZnNdID0gbG93ZXJf
MzJfYml0cyhyaW5nLT53cHRyKTsKIAkJCVdET09SQkVMTDMyKHJpbmctPmRvb3JiZWxsX2luZGV4
LCBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpKTsKIAkJfSBlbHNlIHsKLQkJCVdSRUczMl9TT0Mx
NShVVkQsIDAsIG1tVVZEX1JCX1dQVFIyLCBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpKTsKKwkJ
CVdSRUczMl9TT0MxNShVVkQsIHJpbmctPm1lLCBtbVVWRF9SQl9XUFRSMiwgbG93ZXJfMzJfYml0
cyhyaW5nLT53cHRyKSk7CiAJCX0KIAl9CiB9CkBAIC0xMDUxLDcgKzExMDMsNyBAQCBzdGF0aWMg
dWludDY0X3QgdmNuX3YyXzVfanBlZ19yaW5nX2dldF9ycHRyKHN0cnVjdCBhbWRncHVfcmluZyAq
cmluZykKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IHJpbmctPmFkZXY7CiAKLQly
ZXR1cm4gUlJFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfSlJCQ19SQl9SUFRSKTsKKwlyZXR1cm4g
UlJFRzMyX1NPQzE1KFVWRCwgcmluZy0+bWUsIG1tVVZEX0pSQkNfUkJfUlBUUik7CiB9CiAKIC8q
KgpAQCAtMTA2OCw3ICsxMTIwLDcgQEAgc3RhdGljIHVpbnQ2NF90IHZjbl92Ml81X2pwZWdfcmlu
Z19nZXRfd3B0cihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCiAJaWYgKHJpbmctPnVzZV9kb29y
YmVsbCkKIAkJcmV0dXJuIGFkZXYtPndiLndiW3JpbmctPndwdHJfb2Zmc107CiAJZWxzZQotCQly
ZXR1cm4gUlJFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfSlJCQ19SQl9XUFRSKTsKKwkJcmV0dXJu
IFJSRUczMl9TT0MxNShVVkQsIHJpbmctPm1lLCBtbVVWRF9KUkJDX1JCX1dQVFIpOwogfQogCiAv
KioKQEAgLTEwODYsNyArMTEzOCw3IEBAIHN0YXRpYyB2b2lkIHZjbl92Ml81X2pwZWdfcmluZ19z
ZXRfd3B0cihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCiAJCWFkZXYtPndiLndiW3JpbmctPndw
dHJfb2Zmc10gPSBsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIpOwogCQlXRE9PUkJFTEwzMihyaW5n
LT5kb29yYmVsbF9pbmRleCwgbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJfSBlbHNlIHsK
LQkJV1JFRzMyX1NPQzE1KFVWRCwgMCwgbW1VVkRfSlJCQ19SQl9XUFRSLCBsb3dlcl8zMl9iaXRz
KHJpbmctPndwdHIpKTsKKwkJV1JFRzMyX1NPQzE1KFVWRCwgcmluZy0+bWUsIG1tVVZEX0pSQkNf
UkJfV1BUUiwgbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSk7CiAJfQogfQogCkBAIC0xMTIyLDQw
ICsxMTc0LDYyIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgYW1kZ3B1X3JpbmdfZnVuY3MgdmNuX3Yy
XzVfanBlZ19yaW5nX3ZtX2Z1bmNzID0gewogCiBzdGF0aWMgdm9pZCB2Y25fdjJfNV9zZXRfZGVj
X3JpbmdfZnVuY3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7Ci0JYWRldi0+dmNuLmlu
c3RbMF0ucmluZ19kZWMuZnVuY3MgPSAmdmNuX3YyXzVfZGVjX3Jpbmdfdm1fZnVuY3M7Ci0JRFJN
X0lORk8oIlZDTiBkZWNvZGUgaXMgZW5hYmxlZCBpbiBWTSBtb2RlXG4iKTsKKwlpbnQgaTsKKwor
CWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX3Zjbl9pbnN0OyArK2kpIHsKKwkJYWRldi0+
dmNuLmluc3RbaV0ucmluZ19kZWMuZnVuY3MgPSAmdmNuX3YyXzVfZGVjX3Jpbmdfdm1fZnVuY3M7
CisJCWFkZXYtPnZjbi5pbnN0W2ldLnJpbmdfZGVjLm1lID0gaTsKKwkJRFJNX0lORk8oIlZDTigl
ZCkgZGVjb2RlIGlzIGVuYWJsZWQgaW4gVk0gbW9kZVxuIiwgaSk7CisJfQogfQogCiBzdGF0aWMg
dm9pZCB2Y25fdjJfNV9zZXRfZW5jX3JpbmdfZnVuY3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYpCiB7Ci0JaW50IGk7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dmNuLm51bV9lbmNfcmlu
Z3M7ICsraSkKLQkJYWRldi0+dmNuLmluc3RbMF0ucmluZ19lbmNbaV0uZnVuY3MgPSAmdmNuX3Yy
XzVfZW5jX3Jpbmdfdm1fZnVuY3M7CisJaW50IGksIGo7CiAKLQlEUk1fSU5GTygiVkNOIGVuY29k
ZSBpcyBlbmFibGVkIGluIFZNIG1vZGVcbiIpOworCWZvciAoaiA9IDA7IGogPCBhZGV2LT52Y24u
bnVtX3Zjbl9pbnN0OyArK2opIHsKKwkJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fZW5j
X3JpbmdzOyArK2kpIHsKKwkJCWFkZXYtPnZjbi5pbnN0W2pdLnJpbmdfZW5jW2ldLmZ1bmNzID0g
JnZjbl92Ml81X2VuY19yaW5nX3ZtX2Z1bmNzOworCQkJYWRldi0+dmNuLmluc3Rbal0ucmluZ19l
bmNbaV0ubWUgPSBqOworCQl9CisJCURSTV9JTkZPKCJWQ04oJWQpIGVuY29kZSBpcyBlbmFibGVk
IGluIFZNIG1vZGVcbiIsIGopOworCX0KIH0KIAogc3RhdGljIHZvaWQgdmNuX3YyXzVfc2V0X2pw
ZWdfcmluZ19mdW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKLQlhZGV2LT52Y24u
aW5zdFswXS5yaW5nX2pwZWcuZnVuY3MgPSAmdmNuX3YyXzVfanBlZ19yaW5nX3ZtX2Z1bmNzOwot
CURSTV9JTkZPKCJWQ04ganBlZyBkZWNvZGUgaXMgZW5hYmxlZCBpbiBWTSBtb2RlXG4iKTsKKwlp
bnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT52Y24ubnVtX3Zjbl9pbnN0OyArK2kpIHsK
KwkJYWRldi0+dmNuLmluc3RbaV0ucmluZ19qcGVnLmZ1bmNzID0gJnZjbl92Ml81X2pwZWdfcmlu
Z192bV9mdW5jczsKKwkJYWRldi0+dmNuLmluc3RbaV0ucmluZ19qcGVnLm1lID0gaTsKKwkJRFJN
X0lORk8oIlZDTiglZCkganBlZyBkZWNvZGUgaXMgZW5hYmxlZCBpbiBWTSBtb2RlXG4iLCBpKTsK
Kwl9CiB9CiAKIHN0YXRpYyBib29sIHZjbl92Ml81X2lzX2lkbGUodm9pZCAqaGFuZGxlKQogewog
CXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopaGFu
ZGxlOworCWludCBpLCByZXQgPSAxOworCisJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1f
dmNuX2luc3Q7ICsraSkgeworCQlyZXQgJj0gKFJSRUczMl9TT0MxNShWQ04sIGksIG1tVVZEX1NU
QVRVUykgPT0gVVZEX1NUQVRVU19fSURMRSk7CisJfQogCi0JcmV0dXJuIChSUkVHMzJfU09DMTUo
VkNOLCAwLCBtbVVWRF9TVEFUVVMpID09IFVWRF9TVEFUVVNfX0lETEUpOworCXJldHVybiByZXQ7
CiB9CiAKIHN0YXRpYyBpbnQgdmNuX3YyXzVfd2FpdF9mb3JfaWRsZSh2b2lkICpoYW5kbGUpCiB7
CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKilo
YW5kbGU7Ci0JaW50IHJldCA9IDA7CisJaW50IGksIHJldCA9IDA7CiAKLQlTT0MxNV9XQUlUX09O
X1JSRUcoVkNOLCAwLCBtbVVWRF9TVEFUVVMsIFVWRF9TVEFUVVNfX0lETEUsCi0JCVVWRF9TVEFU
VVNfX0lETEUsIHJldCk7CisJZm9yIChpID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fdmNuX2luc3Q7
ICsraSkgeworCQlTT0MxNV9XQUlUX09OX1JSRUcoVkNOLCBpLCBtbVVWRF9TVEFUVVMsIFVWRF9T
VEFUVVNfX0lETEUsCisJCQlVVkRfU1RBVFVTX19JRExFLCByZXQpOworCQlpZiAocmV0KQorCQkJ
cmV0dXJuIHJldDsKKwl9CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtMTIwOSwyMCArMTI4MywzNCBA
QCBzdGF0aWMgaW50IHZjbl92Ml81X3Byb2Nlc3NfaW50ZXJydXB0KHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LAogCQkJCSAgICAgIHN0cnVjdCBhbWRncHVfaXJxX3NyYyAqc291cmNlLAogCQkJ
CSAgICAgIHN0cnVjdCBhbWRncHVfaXZfZW50cnkgKmVudHJ5KQogeworCXVpbnQzMl90IGlwX2lu
c3RhbmNlOworCisJc3dpdGNoIChlbnRyeS0+Y2xpZW50X2lkKSB7CisJY2FzZSBTT0MxNV9JSF9D
TElFTlRJRF9WQ046CisJCWlwX2luc3RhbmNlID0gMDsKKwkJYnJlYWs7CisJY2FzZSBTT0MxNV9J
SF9DTElFTlRJRF9WQ04xOgorCQlpcF9pbnN0YW5jZSA9IDE7CisJCWJyZWFrOworCWRlZmF1bHQ6
CisJCURSTV9FUlJPUigiVW5oYW5kbGVkIGNsaWVudCBpZDogJWRcbiIsIGVudHJ5LT5jbGllbnRf
aWQpOworCQlyZXR1cm4gMDsKKwl9CisKIAlEUk1fREVCVUcoIklIOiBWQ04gVFJBUFxuIik7CiAK
IAlzd2l0Y2ggKGVudHJ5LT5zcmNfaWQpIHsKIAljYXNlIFZDTl8yXzBfX1NSQ0lEX19VVkRfU1lT
VEVNX01FU1NBR0VfSU5URVJSVVBUOgotCQlhbWRncHVfZmVuY2VfcHJvY2VzcygmYWRldi0+dmNu
Lmluc3RbMF0ucmluZ19kZWMpOworCQlhbWRncHVfZmVuY2VfcHJvY2VzcygmYWRldi0+dmNuLmlu
c3RbaXBfaW5zdGFuY2VdLnJpbmdfZGVjKTsKIAkJYnJlYWs7CiAJY2FzZSBWQ05fMl8wX19TUkNJ
RF9fVVZEX0VOQ19HRU5FUkFMX1BVUlBPU0U6Ci0JCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2
LT52Y24uaW5zdFswXS5yaW5nX2VuY1swXSk7CisJCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2
LT52Y24uaW5zdFtpcF9pbnN0YW5jZV0ucmluZ19lbmNbMF0pOwogCQlicmVhazsKIAljYXNlIFZD
Tl8yXzBfX1NSQ0lEX19VVkRfRU5DX0xPV19MQVRFTkNZOgotCQlhbWRncHVfZmVuY2VfcHJvY2Vz
cygmYWRldi0+dmNuLmluc3RbMF0ucmluZ19lbmNbMV0pOworCQlhbWRncHVfZmVuY2VfcHJvY2Vz
cygmYWRldi0+dmNuLmluc3RbaXBfaW5zdGFuY2VdLnJpbmdfZW5jWzFdKTsKIAkJYnJlYWs7CiAJ
Y2FzZSBWQ05fMl8wX19TUkNJRF9fSlBFR19ERUNPREU6Ci0JCWFtZGdwdV9mZW5jZV9wcm9jZXNz
KCZhZGV2LT52Y24uaW5zdFswXS5yaW5nX2pwZWcpOworCQlhbWRncHVfZmVuY2VfcHJvY2Vzcygm
YWRldi0+dmNuLmluc3RbaXBfaW5zdGFuY2VdLnJpbmdfanBlZyk7CiAJCWJyZWFrOwogCWRlZmF1
bHQ6CiAJCURSTV9FUlJPUigiVW5oYW5kbGVkIGludGVycnVwdDogJWQgJWRcbiIsCkBAIC0xMjQw
LDggKzEzMjgsMTIgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBhbWRncHVfaXJxX3NyY19mdW5jcyB2
Y25fdjJfNV9pcnFfZnVuY3MgPSB7CiAKIHN0YXRpYyB2b2lkIHZjbl92Ml81X3NldF9pcnFfZnVu
Y3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7Ci0JYWRldi0+dmNuLmluc3RbMF0uaXJx
Lm51bV90eXBlcyA9IGFkZXYtPnZjbi5udW1fZW5jX3JpbmdzICsgMjsKLQlhZGV2LT52Y24uaW5z
dFswXS5pcnEuZnVuY3MgPSAmdmNuX3YyXzVfaXJxX2Z1bmNzOworCWludCBpOworCisJZm9yIChp
ID0gMDsgaSA8IGFkZXYtPnZjbi5udW1fdmNuX2luc3Q7ICsraSkgeworCQlhZGV2LT52Y24uaW5z
dFtpXS5pcnEubnVtX3R5cGVzID0gYWRldi0+dmNuLm51bV9lbmNfcmluZ3MgKyAyOworCQlhZGV2
LT52Y24uaW5zdFtpXS5pcnEuZnVuY3MgPSAmdmNuX3YyXzVfaXJxX2Z1bmNzOworCX0KIH0KIAog
c3RhdGljIGNvbnN0IHN0cnVjdCBhbWRfaXBfZnVuY3MgdmNuX3YyXzVfaXBfZnVuY3MgPSB7Ci0t
IAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
