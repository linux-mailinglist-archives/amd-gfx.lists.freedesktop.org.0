Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EBD953325E3
	for <lists+amd-gfx@lfdr.de>; Tue,  9 Mar 2021 13:57:05 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6FB2E6E4A7;
	Tue,  9 Mar 2021 12:57:03 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-ed1-x52c.google.com (mail-ed1-x52c.google.com
 [IPv6:2a00:1450:4864:20::52c])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7C0916E4A7
 for <amd-gfx@lists.freedesktop.org>; Tue,  9 Mar 2021 12:57:02 +0000 (UTC)
Received: by mail-ed1-x52c.google.com with SMTP id t1so19857778eds.7
 for <amd-gfx@lists.freedesktop.org>; Tue, 09 Mar 2021 04:57:02 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=subject:to:cc:references:from:message-id:date:user-agent
 :mime-version:in-reply-to:content-transfer-encoding:content-language;
 bh=LJmdVEKm07UvfRqE699eKLOuTYw4wFjvhWgKdImW2Rg=;
 b=q2iXEeM56S19wP6FLp21TGccgGgd7Tpcu3MPDvPsPfOeP585d6/k0Qg7FVlZXFmvsW
 7UWaXhLqbbkm5wYmLN2PqOBbOXqge+34TEdawvv7himwr0FhkTs5muqMVMcxqKHL5/KJ
 MISX1j7RIQlbQqx/OjnLM9zvtubfeJ6fHUwUh0uIkIheUVLHI+8t5zPMwOe7IqeVwXIU
 lYE9vmxHrH6v6OhVSQXkRXsMEqeESFtSfxc0q2ozICvRBxFfNi+Oc4QH+xvilV8cEsBE
 NWuoMsUwq8kt4OCmaku0RGmQB6WjxwlC3Hafbcu6oUUXlckCHz3ZF9KTRAktN04tRpcl
 s6iw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:subject:to:cc:references:from:message-id:date
 :user-agent:mime-version:in-reply-to:content-transfer-encoding
 :content-language;
 bh=LJmdVEKm07UvfRqE699eKLOuTYw4wFjvhWgKdImW2Rg=;
 b=E5aVEH3IiWHTgSm8c/6tLLditWYz8NpolEsN4ebvOOZLORVJ00uA6mb7+isD+vkjkV
 5iEbU0NKwimQWavss/TT9JY9n4FCR4PRzu7DCrGSwQm4c+mrAoFdjgFw5k/l0b22h70D
 pc/CWhsARVxR/0uw2gE8E3XFDv1xMENKDNu3p5eifNTYiOrLRj8ILCfG5VABqObvEuh5
 XWXWqksy/Rnc/a0N5TDMKX65OjmRbeRNzYG2pzyiNjHXt/qYpMUm6afEnNihoo1QmT5A
 HqvW5ljrutZ5JcufqEtANylXU1V0tpBYEWdi9NdmRzfzNd0V+lGs45bQovUGsUIeqqb9
 eSFw==
X-Gm-Message-State: AOAM532oS3j3kf/E5Hkxk6suoN66NWsfG6h/6LGDhRw1Csxvig0KvHyJ
 hNXtXQq+0r+Md6y5ymeXEsdb0jbKXjMnCg==
X-Google-Smtp-Source: ABdhPJwTcOVlbuNunYM2Ta0t+kxn1wJaHg6s5IyuTQTadvBGK8yuLTBqp6jNJB8aXs1JhoHjE9aZSg==
X-Received: by 2002:a50:ec0e:: with SMTP id g14mr4001810edr.264.1615294620988; 
 Tue, 09 Mar 2021 04:57:00 -0800 (PST)
Received: from ?IPv6:2a02:908:1252:fb60:7f9b:4f7c:c70d:c3fe?
 ([2a02:908:1252:fb60:7f9b:4f7c:c70d:c3fe])
 by smtp.gmail.com with ESMTPSA id r4sm8200725ejd.125.2021.03.09.04.57.00
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Tue, 09 Mar 2021 04:57:00 -0800 (PST)
Subject: Re: [PATCH] drm/amdgpu: capture invalid hardware access v2
To: "Li, Dennis" <Dennis.Li@amd.com>,
 "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
References: <20210308180649.2117-1-christian.koenig@amd.com>
 <SN1PR12MB2544244642707C3EA1E27026ED929@SN1PR12MB2544.namprd12.prod.outlook.com>
From: =?UTF-8?Q?Christian_K=c3=b6nig?= <ckoenig.leichtzumerken@gmail.com>
Message-ID: <91af0abc-ddde-9799-dab1-71d6eae7b765@gmail.com>
Date: Tue, 9 Mar 2021 13:56:59 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101
 Thunderbird/78.7.1
MIME-Version: 1.0
In-Reply-To: <SN1PR12MB2544244642707C3EA1E27026ED929@SN1PR12MB2544.namprd12.prod.outlook.com>
Content-Language: en-US
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Grodzovsky, Andrey" <Andrey.Grodzovsky@amd.com>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

SGkgRGVubmlzLAoKd2h5IGRvIHlvdSB0aGluayB0aGF0IHRoaXMgd2lsbCBhbHdheXMgYXNzZXJ0
IGluIHJlc2V0IHRocmVhZD8KCkluIHRoZSByZXNldCB0aHJlYWQgd2hpbGUgd2UgYXJlIGhvbGRp
bmcgdGhlIHJlc2V0IGxvY2sgd3JpdGUgc2lkZSAKbG9ja2RlcF9hc3NlcnRfaGVsZCgpIHNob3Vs
ZCBiZSBzYXRpc2ZpZWQgYW5kIG5vdCBjYXVzZSBhbnkgc3BsYXQgaW4gdGhlIApzeXN0ZW0gbG9n
LgoKUmVnYXJkcywKQ2hyaXN0aWFuLgoKQW0gMDkuMDMuMjEgdW0gMDM6MDMgc2NocmllYiBMaSwg
RGVubmlzOgo+IFtBTUQgT2ZmaWNpYWwgVXNlIE9ubHkgLSBJbnRlcm5hbCBEaXN0cmlidXRpb24g
T25seV0KPgo+IEhpLCBDaHJpc3RpYW4sCj4gICAgICAgICBhbWRncHVfZGV2aWNlX3NraXBfaHdf
YWNjZXNzIHdpbGwgYWx3YXlzIGFzc2VydCBpbiByZXNldCB0aHJlYWQsIHdoaWNoIHNlZW1zIG5v
dCBhIGdvb2QgaWRlYS4KPgo+IEJlc3QgUmVnYXJkcwo+IERlbm5pcyBMaQo+IC0tLS0tT3JpZ2lu
YWwgTWVzc2FnZS0tLS0tCj4gRnJvbTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2tvZW5pZy5sZWljaHR6
dW1lcmtlbkBnbWFpbC5jb20+Cj4gU2VudDogVHVlc2RheSwgTWFyY2ggOSwgMjAyMSAyOjA3IEFN
Cj4gVG86IGFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCj4gQ2M6IEdyb2R6b3Zza3ksIEFu
ZHJleSA8QW5kcmV5Lkdyb2R6b3Zza3lAYW1kLmNvbT47IExpLCBEZW5uaXMgPERlbm5pcy5MaUBh
bWQuY29tPgo+IFN1YmplY3Q6IFtQQVRDSF0gZHJtL2FtZGdwdTogY2FwdHVyZSBpbnZhbGlkIGhh
cmR3YXJlIGFjY2VzcyB2Mgo+Cj4gRnJvbTogRGVubmlzIExpIDxEZW5uaXMuTGlAYW1kLmNvbT4K
Pgo+IFdoZW4gcmVjb3ZlcnkgdGhyZWFkIGhhcyBiZWd1biBHUFUgcmVzZXQsIHRoZXJlIHNob3Vs
ZCBiZSBub3Qgb3RoZXIgdGhyZWFkcyB0byBhY2Nlc3MgaGFyZHdhcmUsIG90aGVyd2lzZSBzeXN0
ZW0gcmFuZG9tbHkgaGFuZy4KPgo+IHYyIChjaGspOiByZXdyaXR0ZW4gZnJvbSBzY3JhdGNoLCB1
c2UgdHJ5bG9jayBhbmQgbG9ja2RlcCBpbnN0ZWFkIG9mCj4gICAgaGFuZCB3aXJpbmcgdGhlIGxv
Z2ljLgo+Cj4gU2lnbmVkLW9mZi1ieTogRGVubmlzIExpIDxEZW5uaXMuTGlAYW1kLmNvbT4KPiBT
aWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+
Cj4gLS0tCj4gICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMgfCA3
NCArKysrKysrKysrKysrKysrKy0tLS0tCj4gICAxIGZpbGUgY2hhbmdlZCwgNTcgaW5zZXJ0aW9u
cygrKSwgMTcgZGVsZXRpb25zKC0pCj4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2RldmljZS5jCj4gaW5kZXggZTI0N2MzYTJlYzA4Li5jOTkwYWY2YTQzY2EgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCj4gKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCj4gQEAgLTMyNiw2ICsz
MjYsMzQgQEAgdm9pZCBhbWRncHVfZGV2aWNlX3ZyYW1fYWNjZXNzKHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LCBsb2ZmX3QgcG9zLAo+ICAgLyoKPiAgICAqIHJlZ2lzdGVyIGFjY2VzcyBoZWxw
ZXIgZnVuY3Rpb25zLgo+ICAgICovCj4gKwo+ICsvKiBDaGVjayBpZiBodyBhY2Nlc3Mgc2hvdWxk
IGJlIHNraXBwZWQgYmVjYXVzZSBvZiBob3RwbHVnIG9yIGRldmljZQo+ICtlcnJvciAqLyBzdGF0
aWMgYm9vbCBhbWRncHVfZGV2aWNlX3NraXBfaHdfYWNjZXNzKHN0cnVjdCBhbWRncHVfZGV2aWNl
Cj4gKyphZGV2KSB7Cj4gK2lmIChhZGV2LT5pbl9wY2lfZXJyX3JlY292ZXJ5KQo+ICtyZXR1cm4g
dHJ1ZTsKPiArCj4gKyNpZmRlZiBDT05GSUdfTE9DS0RFUAo+ICsvKgo+ICsgKiBUaGlzIGlzIGEg
Yml0IGNvbXBsaWNhdGVkIHRvIHVuZGVyc3RhbmQsIHNvIHdvcnRoIGEgY29tbWVudC4gV2hhdCB3
ZSBhc3NlcnQKPiArICogaGVyZSBpcyB0aGF0IHRoZSBHUFUgcmVzZXQgaXMgbm90IHJ1bm5pbmcg
b24gYW5vdGhlciB0aHJlYWQgaW4gcGFyYWxsZWwuCj4gKyAqCj4gKyAqIEZvciB0aGlzIHdlIHRy
eWxvY2sgdGhlIHJlYWQgc2lkZSBvZiB0aGUgcmVzZXQgc2VtYXBob3JlLCBpZiB0aGF0IHN1Y2Nl
ZWRzCj4gKyAqIHdlIGtub3cgdGhhdCB0aGUgcmVzZXQgaXMgbm90IHJ1bm5pbmcgaW4gcGFyYWxl
bGwuCj4gKyAqCj4gKyAqIElmIHRoZSB0cnlsb2NrIGZhaWxzIHdlIGFzc2VydCB0aGF0IHdlIGFy
ZSBlaXRoZXIgYWxyZWFkeSBob2xkaW5nIHRoZSByZWFkCj4gKyAqIHNpZGUgb2YgdGhlIGxvY2sg
b3IgYXJlIHRoZSByZXNldCB0aHJlYWQgaXRzZWxmIGFuZCBob2xkIHRoZSB3cml0ZSBzaWRlIG9m
Cj4gKyAqIHRoZSBsb2NrLgo+ICsgKi8KPiAraWYgKGRvd25fcmVhZF90cnlsb2NrKCZhZGV2LT5y
ZXNldF9zZW0pKQo+ICt1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICtlbHNlCj4gK2xvY2tk
ZXBfYXNzZXJ0X2hlbGQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKyNlbmRpZgo+ICsKPiArcmV0dXJu
IGZhbHNlOwo+ICt9Cj4gKwo+ICAgLyoqCj4gICAgKiBhbWRncHVfZGV2aWNlX3JyZWcgLSByZWFk
IGEgbWVtb3J5IG1hcHBlZCBJTyBvciBpbmRpcmVjdCByZWdpc3Rlcgo+ICAgICoKPiBAQCAtMzQw
LDcgKzM2OCw3IEBAIHVpbnQzMl90IGFtZGdwdV9kZXZpY2VfcnJlZyhzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwgIHsKPiAgIHVpbnQzMl90IHJldDsKPgo+IC1pZiAoYWRldi0+aW5fcGNpX2Vy
cl9yZWNvdmVyeSkKPiAraWYgKGFtZGdwdV9kZXZpY2Vfc2tpcF9od19hY2Nlc3MoYWRldikpCj4g
ICByZXR1cm4gMDsKPgo+ICAgaWYgKChyZWcgKiA0KSA8IGFkZXYtPnJtbWlvX3NpemUpIHsKPiBA
QCAtMzc3LDcgKzQwNSw3IEBAIHVpbnQzMl90IGFtZGdwdV9kZXZpY2VfcnJlZyhzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKPiAgICAqLwo+ICAgdWludDhfdCBhbWRncHVfbW1fcnJlZzgoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IG9mZnNldCkgIHsKPiAtaWYgKGFkZXYt
PmluX3BjaV9lcnJfcmVjb3ZlcnkpCj4gK2lmIChhbWRncHVfZGV2aWNlX3NraXBfaHdfYWNjZXNz
KGFkZXYpKQo+ICAgcmV0dXJuIDA7Cj4KPiAgIGlmIChvZmZzZXQgPCBhZGV2LT5ybW1pb19zaXpl
KQo+IEBAIC00MDIsNyArNDMwLDcgQEAgdWludDhfdCBhbWRncHVfbW1fcnJlZzgoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IG9mZnNldCkKPiAgICAqLwo+ICAgdm9pZCBhbWRn
cHVfbW1fd3JlZzgoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IG9mZnNldCwg
dWludDhfdCB2YWx1ZSkgIHsKPiAtaWYgKGFkZXYtPmluX3BjaV9lcnJfcmVjb3ZlcnkpCj4gK2lm
IChhbWRncHVfZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQo+ICAgcmV0dXJuOwo+Cj4gICBp
ZiAob2Zmc2V0IDwgYWRldi0+cm1taW9fc2l6ZSkKPiBAQCAtNDI1LDcgKzQ1Myw3IEBAIHZvaWQg
YW1kZ3B1X2RldmljZV93cmVnKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAgdWludDMy
X3QgcmVnLCB1aW50MzJfdCB2LAo+ICAgdWludDMyX3QgYWNjX2ZsYWdzKQo+ICAgewo+IC1pZiAo
YWRldi0+aW5fcGNpX2Vycl9yZWNvdmVyeSkKPiAraWYgKGFtZGdwdV9kZXZpY2Vfc2tpcF9od19h
Y2Nlc3MoYWRldikpCj4gICByZXR1cm47Cj4KPiAgIGlmICgocmVnICogNCkgPCBhZGV2LT5ybW1p
b19zaXplKSB7Cj4gQEAgLTQ1Miw3ICs0ODAsNyBAQCB2b2lkIGFtZGdwdV9kZXZpY2Vfd3JlZyhz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgIHZvaWQgYW1kZ3B1X21tX3dyZWdfbW1pb19ybGMo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gICAgICAgIHVpbnQzMl90IHJlZywgdWludDMy
X3QgdikKPiAgIHsKPiAtaWYgKGFkZXYtPmluX3BjaV9lcnJfcmVjb3ZlcnkpCj4gK2lmIChhbWRn
cHVfZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQo+ICAgcmV0dXJuOwo+Cj4gICBpZiAoYW1k
Z3B1X3NyaW92X2Z1bGxhY2Nlc3MoYWRldikgJiYKPiBAQCAtNDc1LDcgKzUwMyw3IEBAIHZvaWQg
YW1kZ3B1X21tX3dyZWdfbW1pb19ybGMoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gICAg
Ki8KPiAgIHUzMiBhbWRncHVfaW9fcnJlZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdTMy
IHJlZykgIHsKPiAtaWYgKGFkZXYtPmluX3BjaV9lcnJfcmVjb3ZlcnkpCj4gK2lmIChhbWRncHVf
ZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQo+ICAgcmV0dXJuIDA7Cj4KPiAgIGlmICgocmVn
ICogNCkgPCBhZGV2LT5yaW9fbWVtX3NpemUpCj4gQEAgLTQ5Nyw3ICs1MjUsNyBAQCB1MzIgYW1k
Z3B1X2lvX3JyZWcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiByZWcpCj4gICAgKi8K
PiAgIHZvaWQgYW1kZ3B1X2lvX3dyZWcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiBy
ZWcsIHUzMiB2KSAgewo+IC1pZiAoYWRldi0+aW5fcGNpX2Vycl9yZWNvdmVyeSkKPiAraWYgKGFt
ZGdwdV9kZXZpY2Vfc2tpcF9od19hY2Nlc3MoYWRldikpCj4gICByZXR1cm47Cj4KPiAgIGlmICgo
cmVnICogNCkgPCBhZGV2LT5yaW9fbWVtX3NpemUpCj4gQEAgLTUxOSw3ICs1NDcsNyBAQCB2b2lk
IGFtZGdwdV9pb193cmVnKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgcmVnLCB1MzIg
dikKPiAgICAqLwo+ICAgdTMyIGFtZGdwdV9tbV9yZG9vcmJlbGwoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsIHUzMiBpbmRleCkgIHsKPiAtaWYgKGFkZXYtPmluX3BjaV9lcnJfcmVjb3Zlcnkp
Cj4gK2lmIChhbWRncHVfZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQo+ICAgcmV0dXJuIDA7
Cj4KPiAgIGlmIChpbmRleCA8IGFkZXYtPmRvb3JiZWxsLm51bV9kb29yYmVsbHMpIHsgQEAgLTU0
Miw3ICs1NzAsNyBAQCB1MzIgYW1kZ3B1X21tX3Jkb29yYmVsbChzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwgdTMyIGluZGV4KQo+ICAgICovCj4gICB2b2lkIGFtZGdwdV9tbV93ZG9vcmJlbGwo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiBpbmRleCwgdTMyIHYpICB7Cj4gLWlmIChh
ZGV2LT5pbl9wY2lfZXJyX3JlY292ZXJ5KQo+ICtpZiAoYW1kZ3B1X2RldmljZV9za2lwX2h3X2Fj
Y2VzcyhhZGV2KSkKPiAgIHJldHVybjsKPgo+ICAgaWYgKGluZGV4IDwgYWRldi0+ZG9vcmJlbGwu
bnVtX2Rvb3JiZWxscykgeyBAQCAtNTYzLDcgKzU5MSw3IEBAIHZvaWQgYW1kZ3B1X21tX3dkb29y
YmVsbChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdTMyIGluZGV4LCB1MzIgdikKPiAgICAq
Lwo+ICAgdTY0IGFtZGdwdV9tbV9yZG9vcmJlbGw2NChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
diwgdTMyIGluZGV4KSAgewo+IC1pZiAoYWRldi0+aW5fcGNpX2Vycl9yZWNvdmVyeSkKPiAraWYg
KGFtZGdwdV9kZXZpY2Vfc2tpcF9od19hY2Nlc3MoYWRldikpCj4gICByZXR1cm4gMDsKPgo+ICAg
aWYgKGluZGV4IDwgYWRldi0+ZG9vcmJlbGwubnVtX2Rvb3JiZWxscykgeyBAQCAtNTg2LDcgKzYx
NCw3IEBAIHU2NCBhbWRncHVfbW1fcmRvb3JiZWxsNjQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsIHUzMiBpbmRleCkKPiAgICAqLwo+ICAgdm9pZCBhbWRncHVfbW1fd2Rvb3JiZWxsNjQoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiBpbmRleCwgdTY0IHYpICB7Cj4gLWlmIChhZGV2
LT5pbl9wY2lfZXJyX3JlY292ZXJ5KQo+ICtpZiAoYW1kZ3B1X2RldmljZV9za2lwX2h3X2FjY2Vz
cyhhZGV2KSkKPiAgIHJldHVybjsKPgo+ICAgaWYgKGluZGV4IDwgYWRldi0+ZG9vcmJlbGwubnVt
X2Rvb3JiZWxscykgeyBAQCAtNjEwLDEwICs2MzgsMTMgQEAgdTMyIGFtZGdwdV9kZXZpY2VfaW5k
aXJlY3RfcnJlZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKPiAgIHUzMiBwY2llX2luZGV4
LCB1MzIgcGNpZV9kYXRhLAo+ICAgdTMyIHJlZ19hZGRyKQo+ICAgewo+IC11bnNpZ25lZCBsb25n
IGZsYWdzOwo+IC11MzIgcjsKPiAgIHZvaWQgX19pb21lbSAqcGNpZV9pbmRleF9vZmZzZXQ7Cj4g
ICB2b2lkIF9faW9tZW0gKnBjaWVfZGF0YV9vZmZzZXQ7Cj4gK3Vuc2lnbmVkIGxvbmcgZmxhZ3M7
Cj4gK3UzMiByOwo+ICsKPiAraWYgKGFtZGdwdV9kZXZpY2Vfc2tpcF9od19hY2Nlc3MoYWRldikp
Cj4gK3JldHVybiAwOwo+Cj4gICBzcGluX2xvY2tfaXJxc2F2ZSgmYWRldi0+cGNpZV9pZHhfbG9j
aywgZmxhZ3MpOwo+ICAgcGNpZV9pbmRleF9vZmZzZXQgPSAodm9pZCBfX2lvbWVtICopYWRldi0+
cm1taW8gKyBwY2llX2luZGV4ICogNDsgQEAgLTY0MSwxMCArNjcyLDEzIEBAIHU2NCBhbWRncHVf
ZGV2aWNlX2luZGlyZWN0X3JyZWc2NChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKPiAgICAg
dTMyIHBjaWVfaW5kZXgsIHUzMiBwY2llX2RhdGEsCj4gICAgIHUzMiByZWdfYWRkcikKPiAgIHsK
PiAtdW5zaWduZWQgbG9uZyBmbGFnczsKPiAtdTY0IHI7Cj4gICB2b2lkIF9faW9tZW0gKnBjaWVf
aW5kZXhfb2Zmc2V0Owo+ICAgdm9pZCBfX2lvbWVtICpwY2llX2RhdGFfb2Zmc2V0Owo+ICt1bnNp
Z25lZCBsb25nIGZsYWdzOwo+ICt1NjQgcjsKPiArCj4gK2lmIChhbWRncHVfZGV2aWNlX3NraXBf
aHdfYWNjZXNzKGFkZXYpKQo+ICtyZXR1cm4gMDsKPgo+ICAgc3Bpbl9sb2NrX2lycXNhdmUoJmFk
ZXYtPnBjaWVfaWR4X2xvY2ssIGZsYWdzKTsKPiAgIHBjaWVfaW5kZXhfb2Zmc2V0ID0gKHZvaWQg
X19pb21lbSAqKWFkZXYtPnJtbWlvICsgcGNpZV9pbmRleCAqIDQ7IEBAIC02NzcsOSArNzExLDEy
IEBAIHZvaWQgYW1kZ3B1X2RldmljZV9pbmRpcmVjdF93cmVnKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LAo+ICAgIHUzMiBwY2llX2luZGV4LCB1MzIgcGNpZV9kYXRhLAo+ICAgIHUzMiByZWdf
YWRkciwgdTMyIHJlZ19kYXRhKQo+ICAgewo+IC11bnNpZ25lZCBsb25nIGZsYWdzOwo+ICAgdm9p
ZCBfX2lvbWVtICpwY2llX2luZGV4X29mZnNldDsKPiAgIHZvaWQgX19pb21lbSAqcGNpZV9kYXRh
X29mZnNldDsKPiArdW5zaWduZWQgbG9uZyBmbGFnczsKPiArCj4gK2lmIChhbWRncHVfZGV2aWNl
X3NraXBfaHdfYWNjZXNzKGFkZXYpKQo+ICtyZXR1cm47Cj4KPiAgIHNwaW5fbG9ja19pcnFzYXZl
KCZhZGV2LT5wY2llX2lkeF9sb2NrLCBmbGFncyk7Cj4gICBwY2llX2luZGV4X29mZnNldCA9ICh2
b2lkIF9faW9tZW0gKilhZGV2LT5ybW1pbyArIHBjaWVfaW5kZXggKiA0OyBAQCAtNzA2LDkgKzc0
MywxMiBAQCB2b2lkIGFtZGdwdV9kZXZpY2VfaW5kaXJlY3Rfd3JlZzY0KHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LAo+ICAgICAgdTMyIHBjaWVfaW5kZXgsIHUzMiBwY2llX2RhdGEsCj4gICAg
ICB1MzIgcmVnX2FkZHIsIHU2NCByZWdfZGF0YSkKPiAgIHsKPiAtdW5zaWduZWQgbG9uZyBmbGFn
czsKPiAgIHZvaWQgX19pb21lbSAqcGNpZV9pbmRleF9vZmZzZXQ7Cj4gICB2b2lkIF9faW9tZW0g
KnBjaWVfZGF0YV9vZmZzZXQ7Cj4gK3Vuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4gKwo+ICtpZiAoYW1k
Z3B1X2RldmljZV9za2lwX2h3X2FjY2VzcyhhZGV2KSkKPiArcmV0dXJuOwo+Cj4gICBzcGluX2xv
Y2tfaXJxc2F2ZSgmYWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOwo+ICAgcGNpZV9pbmRleF9v
ZmZzZXQgPSAodm9pZCBfX2lvbWVtICopYWRldi0+cm1taW8gKyBwY2llX2luZGV4ICogNDsKPiAt
LQo+IDIuMjUuMQo+CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZngK
