Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BD3CEE74A7
	for <lists+amd-gfx@lfdr.de>; Mon, 28 Oct 2019 16:14:13 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0AA9E6E90E;
	Mon, 28 Oct 2019 15:14:12 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wm1-x344.google.com (mail-wm1-x344.google.com
 [IPv6:2a00:1450:4864:20::344])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 66A216E915
 for <amd-gfx@lists.freedesktop.org>; Mon, 28 Oct 2019 15:14:11 +0000 (UTC)
Received: by mail-wm1-x344.google.com with SMTP id n7so9886663wmc.3
 for <amd-gfx@lists.freedesktop.org>; Mon, 28 Oct 2019 08:14:11 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=/NQ1SVehuPNmexNX1DtwxXvRB6WKQVu8goHjJhYe8fE=;
 b=iy+YSb6EHoQI4qYcxxKF+tr6mWbeJiijNqVpzJ1+Hw2UFw2VDXrpLoEa3cknIznldF
 +gihj3XnnUamc4BZAphDpi4oJDNecPrz8r64MPH07xp1ae6m0dg64Qm7lEtO1i0kQ28t
 9srCxOjdx63kMc9PeNbZGjU6FGIN13UFbFvaQNmHG0M1Ke6ko23QWnKBVORkI5drKUe3
 l9AMZOyVwQ7MSHhsj4lz0SYZes82huyH6fNGJpL4q+0vAcgtWwAc4l0UnGtSxizHNE6k
 BryCPQ5aLwZIEUi4dAHuVtKSl7+IwZ8wnXAoe2RtnO3mNmoqWSOcyowFJxMLobDqeuvW
 ShYw==
X-Gm-Message-State: APjAAAUxzjPdYj+5FWIKUIoTv7cfp1A8WK0HK7w5o9HBB279D3EBN3SF
 TMy3h0JmiJTkJ+G2K9OhB8IZmHet
X-Google-Smtp-Source: APXvYqxZRfdNK9/38bDvMTdoMjZNMjAuQZtPYvzVVtQWCUOGx5ic3rr/tuBkoWHEswsktBHmxWr9YA==
X-Received: by 2002:a1c:a805:: with SMTP id r5mr413616wme.122.1572275649714;
 Mon, 28 Oct 2019 08:14:09 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:8f3:7d2:1770:2e29])
 by smtp.gmail.com with ESMTPSA id r5sm2772334wrl.86.2019.10.28.08.14.09
 for <amd-gfx@lists.freedesktop.org>
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 28 Oct 2019 08:14:09 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 2/2] drm/amdgpu: add independent DMA-buf import v9
Date: Mon, 28 Oct 2019 16:14:07 +0100
Message-Id: <20191028151407.15357-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191028151407.15357-1-christian.koenig@amd.com>
References: <20191028151407.15357-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=/NQ1SVehuPNmexNX1DtwxXvRB6WKQVu8goHjJhYe8fE=;
 b=EyUTp1k76G4JcsypbZzWfunfglChNjrhObQcLisT1N3ootdzvPfERhliAxHtVlO3Ct
 jqcgKp5hoK5ZSDbKZLO6JwCzWQbBf3GHJqW6Rn2SeGBo3YkmQ6+tM9m0LwGzGbg1S4G7
 wdVMU7p/JQdQagUZGFy7hbil8wR+R5mWp3e9JTi9Nc9RFVd6gFdrTyAjHteXoMDEj1bY
 HkvrVEDmP1sdQMOBvAkyspxDd8xDbTLYGoXPlucsUwZvYS8dEn1YYCeWdTWW64vIQXyI
 XIO2CZipHm/C6qwfNb9ckClY6rCElFHGsmHr6QALDR+wHUrItzmaT5jRjLiMtPdwhr+m
 sT1w==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiByZWx5aW5nIG9uIHRoZSBEUk0gZnVuY3Rpb25zIGp1c3QgaW1wbGVtZW50IG91
ciBvd24gaW1wb3J0CmZ1bmN0aW9ucy4gVGhpcyBwcmVwYXJlcyBzdXBwb3J0IGZvciB0YWtpbmcg
Y2FyZSBvZiB1bnBpbm5lZCBETUEtYnVmLgoKdjI6IGVuYWJsZSBmb3IgYWxsIGV4cG9ydGVycywg
bm90IGp1c3QgYW1kZ3B1LCBmaXggaW52YWxpZGF0aW9uCiAgICBoYW5kbGluZywgbG9jayByZXNl
cnZhdGlvbiBvYmplY3Qgd2hpbGUgc2V0dGluZyBjYWxsYmFjawp2MzogY2hhbmdlIHRvIG5ldyBk
bWFfYnVmIGF0dGFjaCBpbnRlcmZhY2UKdjQ6IHNwbGl0IG91dCBmcm9tIHVucGlubmVkIERNQS1i
dWYgd29yawp2NTogcmViYXNlZCBhbmQgY2xlYW51cCBvbiBuZXcgRE1BLWJ1ZiBpbnRlcmZhY2UK
djY6IHNxdWFzaCB3aXRoIGludmFsaWRhdGlvbiBjYWxsYmFjayBjaGFuZ2UsCiAgICBzdG9wIHVz
aW5nIF8obWFwfHVubWFwKV9sb2NrZWQKdjc6IGRyb3AgaW52YWxpZGF0aW9ucyB3aGVuIHRoZSBC
TyBpcyBhbHJlYWR5IGluIHN5c3RlbSBkb21haW4Kdjg6IHJlYmFzZSBvbiBuZXcgRE1BLWJ1ZiBw
YXRjaCBhbmQgZHJvcCBtb3ZlIG5vdGlmaWNhdGlvbgp2OTogY2xlYW51cCBjb21tZW50cwoKU2ln
bmVkLW9mZi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMgfCA0MyArKysr
KysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFf
YnVmLmggfCAgNCAtLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jICAg
ICB8ICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyAgICAgfCAz
MiArKysrKysrKysrKystLS0KIDQgZmlsZXMgY2hhbmdlZCwgNTIgaW5zZXJ0aW9ucygrKSwgMjgg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2RtYV9idWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVm
LmMKaW5kZXggZjE0YjUyY2M3MjA1Li5kNWJjZGZlZmJhZDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYwpAQCAtMzcwLDMxICszNzAsMjggQEAgc3RydWN0
IGRtYV9idWYgKmFtZGdwdV9nZW1fcHJpbWVfZXhwb3J0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAq
Z29iaiwKIH0KIAogLyoqCi0gKiBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSAtICZk
cm1fZHJpdmVyLmdlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUKLSAqIGltcGxlbWVudGF0aW9uCisg
KiBhbWRncHVfZG1hX2J1Zl9jcmVhdGVfb2JqIC0gY3JlYXRlIEJPIGZvciBETUEtYnVmIGltcG9y
dAorICoKICAqIEBkZXY6IERSTSBkZXZpY2UKLSAqIEBhdHRhY2g6IERNQS1idWYgYXR0YWNobWVu
dAotICogQHNnOiBTY2F0dGVyL2dhdGhlciB0YWJsZQorICogQGRtYV9idWY6IERNQS1idWYKICAq
Ci0gKiBJbXBvcnRzIHNoYXJlZCBETUEgYnVmZmVyIG1lbW9yeSBleHBvcnRlZCBieSBhbm90aGVy
IGRldmljZS4KKyAqIENyZWF0ZXMgYW4gZW1wdHkgU0cgQk8gZm9yIERNQS1idWYgaW1wb3J0Lgog
ICoKICAqIFJldHVybnM6CiAgKiBBIG5ldyBHRU0gQk8gb2YgdGhlIGdpdmVuIERSTSBkZXZpY2Us
IHJlcHJlc2VudGluZyB0aGUgbWVtb3J5CiAgKiBkZXNjcmliZWQgYnkgdGhlIGdpdmVuIERNQS1i
dWYgYXR0YWNobWVudCBhbmQgc2NhdHRlci9nYXRoZXIgdGFibGUuCiAgKi8KLXN0cnVjdCBkcm1f
Z2VtX29iamVjdCAqCi1hbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAotCQkJCSBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCi0J
CQkJIHN0cnVjdCBzZ190YWJsZSAqc2cpCitzdGF0aWMgc3RydWN0IGRybV9nZW1fb2JqZWN0ICoK
K2FtZGdwdV9kbWFfYnVmX2NyZWF0ZV9vYmooc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0
IGRtYV9idWYgKmRtYV9idWYpCiB7Ci0Jc3RydWN0IGRtYV9yZXN2ICpyZXN2ID0gYXR0YWNoLT5k
bWFidWYtPnJlc3Y7CisJc3RydWN0IGRtYV9yZXN2ICpyZXN2ID0gZG1hX2J1Zi0+cmVzdjsKIAlz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IGFt
ZGdwdV9ibyAqYm87CiAJc3RydWN0IGFtZGdwdV9ib19wYXJhbSBicDsKIAlpbnQgcmV0OwogCiAJ
bWVtc2V0KCZicCwgMCwgc2l6ZW9mKGJwKSk7Ci0JYnAuc2l6ZSA9IGF0dGFjaC0+ZG1hYnVmLT5z
aXplOworCWJwLnNpemUgPSBkbWFfYnVmLT5zaXplOwogCWJwLmJ5dGVfYWxpZ24gPSBQQUdFX1NJ
WkU7CiAJYnAuZG9tYWluID0gQU1ER1BVX0dFTV9ET01BSU5fQ1BVOwogCWJwLmZsYWdzID0gMDsK
QEAgLTQwNSwxMSArNDAyLDkgQEAgYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwKIAlpZiAocmV0KQogCQlnb3RvIGVycm9yOwogCi0JYm8tPnRi
by5zZyA9IHNnOwotCWJvLT50Ym8udHRtLT5zZyA9IHNnOwogCWJvLT5hbGxvd2VkX2RvbWFpbnMg
PSBBTURHUFVfR0VNX0RPTUFJTl9HVFQ7CiAJYm8tPnByZWZlcnJlZF9kb21haW5zID0gQU1ER1BV
X0dFTV9ET01BSU5fR1RUOwotCWlmIChhdHRhY2gtPmRtYWJ1Zi0+b3BzICE9ICZhbWRncHVfZG1h
YnVmX29wcykKKwlpZiAoZG1hX2J1Zi0+b3BzICE9ICZhbWRncHVfZG1hYnVmX29wcykKIAkJYm8t
PnByaW1lX3NoYXJlZF9jb3VudCA9IDE7CiAKIAlkbWFfcmVzdl91bmxvY2socmVzdik7CkBAIC00
MjUsMTUgKzQyMCwxNSBAQCBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZShzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAogICogQGRldjogRFJNIGRldmljZQogICogQGRtYV9idWY6IFNoYXJl
ZCBETUEgYnVmZmVyCiAgKgotICogVGhlIG1haW4gd29yayBpcyBkb25lIGJ5IHRoZSAmZHJtX2dl
bV9wcmltZV9pbXBvcnQgaGVscGVyLCB3aGljaCBpbiB0dXJuCi0gKiB1c2VzICZhbWRncHVfZ2Vt
X3ByaW1lX2ltcG9ydF9zZ190YWJsZS4KKyAqIEltcG9ydCBhIGRtYV9idWYgaW50byBhIHRoZSBk
cml2ZXIgYW5kIHBvdGVudGlhbGx5IGNyZWF0ZSBhIG5ldyBHRU0gb2JqZWN0LgogICoKICAqIFJl
dHVybnM6CiAgKiBHRU0gQk8gcmVwcmVzZW50aW5nIHRoZSBzaGFyZWQgRE1BIGJ1ZmZlciBmb3Ig
dGhlIGdpdmVuIGRldmljZS4KICAqLwogc3RydWN0IGRybV9nZW1fb2JqZWN0ICphbWRncHVfZ2Vt
X3ByaW1lX2ltcG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJCQkgICAgc3RydWN0IGRt
YV9idWYgKmRtYV9idWYpCisJCQkJCSAgICAgICBzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZikKIHsK
KwlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2g7CiAJc3RydWN0IGRybV9nZW1fb2Jq
ZWN0ICpvYmo7CiAKIAlpZiAoZG1hX2J1Zi0+b3BzID09ICZhbWRncHVfZG1hYnVmX29wcykgewpA
QCAtNDQ4LDUgKzQ0MywxNyBAQCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmFtZGdwdV9nZW1fcHJp
bWVfaW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCX0KIAl9CiAKLQlyZXR1cm4gZHJt
X2dlbV9wcmltZV9pbXBvcnQoZGV2LCBkbWFfYnVmKTsKKwlvYmogPSBhbWRncHVfZG1hX2J1Zl9j
cmVhdGVfb2JqKGRldiwgZG1hX2J1Zik7CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gb2Jq
OworCisJYXR0YWNoID0gZG1hX2J1Zl9keW5hbWljX2F0dGFjaChkbWFfYnVmLCBkZXYtPmRldiwg
dHJ1ZSk7CisJaWYgKElTX0VSUihhdHRhY2gpKSB7CisJCWRybV9nZW1fb2JqZWN0X3B1dChvYmop
OworCQlyZXR1cm4gRVJSX0NBU1QoYXR0YWNoKTsKKwl9CisKKwlnZXRfZG1hX2J1ZihkbWFfYnVm
KTsKKwlvYmotPmltcG9ydF9hdHRhY2ggPSBhdHRhY2g7CisJcmV0dXJuIG9iajsKIH0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmggYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oCmluZGV4IGNlMWIzZjAxNzQ1
MS4uZWM0NDdhN2I2YjI4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZG1hX2J1Zi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9k
bWFfYnVmLmgKQEAgLTI1LDEwICsyNSw2IEBACiAKICNpbmNsdWRlIDxkcm0vZHJtX2dlbS5oPgog
Ci1zdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKgotYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFi
bGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCQkgc3RydWN0IGRtYV9idWZfYXR0YWNobWVu
dCAqYXR0YWNoLAotCQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnNnKTsKIHN0cnVjdCBkbWFfYnVmICph
bWRncHVfZ2VtX3ByaW1lX2V4cG9ydChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdvYmosCiAJCQkJ
CWludCBmbGFncyk7CiBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmFtZGdwdV9nZW1fcHJpbWVfaW1w
b3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZHJ2LmMKaW5kZXggODgwNTc3NmM4YzUyLi4yNWFkZjJiODQ3ZTggMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKQEAgLTE0NDUsNyArMTQ0NSw2IEBAIHN0YXRpYyBz
dHJ1Y3QgZHJtX2RyaXZlciBrbXNfZHJpdmVyID0gewogCS5wcmltZV9mZF90b19oYW5kbGUgPSBk
cm1fZ2VtX3ByaW1lX2ZkX3RvX2hhbmRsZSwKIAkuZ2VtX3ByaW1lX2V4cG9ydCA9IGFtZGdwdV9n
ZW1fcHJpbWVfZXhwb3J0LAogCS5nZW1fcHJpbWVfaW1wb3J0ID0gYW1kZ3B1X2dlbV9wcmltZV9p
bXBvcnQsCi0JLmdlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUgPSBhbWRncHVfZ2VtX3ByaW1lX2lt
cG9ydF9zZ190YWJsZSwKIAkuZ2VtX3ByaW1lX3ZtYXAgPSBhbWRncHVfZ2VtX3ByaW1lX3ZtYXAs
CiAJLmdlbV9wcmltZV92dW5tYXAgPSBhbWRncHVfZ2VtX3ByaW1lX3Z1bm1hcCwKIAkuZ2VtX3By
aW1lX21tYXAgPSBhbWRncHVfZ2VtX3ByaW1lX21tYXAsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfdHRtLmMKaW5kZXggOGU4NjdiOGI0MzJmLi5jMTkxMDBjZWQwNDAgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKQEAgLTM5LDYgKzM5LDcgQEAKICNpbmNs
dWRlIDxsaW51eC9zbGFiLmg+CiAjaW5jbHVkZSA8bGludXgvc3dhcC5oPgogI2luY2x1ZGUgPGxp
bnV4L3N3aW90bGIuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CiAKICNpbmNsdWRlIDxk
cm0vdHRtL3R0bV9ib19hcGkuaD4KICNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19kcml2ZXIuaD4K
QEAgLTc2Myw2ICs3NjQsNyBAQCBzdGF0aWMgdW5zaWduZWQgbG9uZyBhbWRncHVfdHRtX2lvX21l
bV9wZm4oc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKICAqLwogc3RydWN0IGFtZGdwdV90
dG1fdHQgewogCXN0cnVjdCB0dG1fZG1hX3R0CXR0bTsKKwlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QJ
KmdvYmo7CiAJdTY0CQkJb2Zmc2V0OwogCXVpbnQ2NF90CQl1c2VycHRyOwogCXN0cnVjdCB0YXNr
X3N0cnVjdAkqdXNlcnRhc2s7CkBAIC0xMjI3LDYgKzEyMjksNyBAQCBzdGF0aWMgc3RydWN0IHR0
bV90dCAqYW1kZ3B1X3R0bV90dF9jcmVhdGUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywK
IAkJcmV0dXJuIE5VTEw7CiAJfQogCWd0dC0+dHRtLnR0bS5mdW5jID0gJmFtZGdwdV9iYWNrZW5k
X2Z1bmM7CisJZ3R0LT5nb2JqID0gJmJvLT5iYXNlOwogCiAJLyogYWxsb2NhdGUgc3BhY2UgZm9y
IHRoZSB1bmluaXRpYWxpemVkIHBhZ2UgZW50cmllcyAqLwogCWlmICh0dG1fc2dfdHRfaW5pdCgm
Z3R0LT50dG0sIGJvLCBwYWdlX2ZsYWdzKSkgewpAQCAtMTI0Nyw3ICsxMjUwLDYgQEAgc3RhdGlj
IGludCBhbWRncHVfdHRtX3R0X3BvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSwKIHsKIAlzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGFtZGdwdV90dG1fYWRldih0dG0tPmJkZXYpOwogCXN0
cnVjdCBhbWRncHVfdHRtX3R0ICpndHQgPSAodm9pZCAqKXR0bTsKLQlib29sIHNsYXZlID0gISEo
dHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19TRyk7CiAKIAkvKiB1c2VyIHBhZ2VzIGFy
ZSBib3VuZCBieSBhbWRncHVfdHRtX3R0X3Bpbl91c2VycHRyKCkgKi8KIAlpZiAoZ3R0ICYmIGd0
dC0+dXNlcnB0cikgewpAQCAtMTI2MCw3ICsxMjYyLDE5IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3R0
bV90dF9wb3B1bGF0ZShzdHJ1Y3QgdHRtX3R0ICp0dG0sCiAJCXJldHVybiAwOwogCX0KIAotCWlm
IChzbGF2ZSAmJiB0dG0tPnNnKSB7CisJaWYgKHR0bS0+cGFnZV9mbGFncyAmIFRUTV9QQUdFX0ZM
QUdfU0cpIHsKKwkJaWYgKCF0dG0tPnNnKSB7CisJCQlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50
ICphdHRhY2g7CisJCQlzdHJ1Y3Qgc2dfdGFibGUgKnNndDsKKworCQkJYXR0YWNoID0gZ3R0LT5n
b2JqLT5pbXBvcnRfYXR0YWNoOworCQkJc2d0ID0gZG1hX2J1Zl9tYXBfYXR0YWNobWVudChhdHRh
Y2gsIERNQV9CSURJUkVDVElPTkFMKTsKKwkJCWlmIChJU19FUlIoc2d0KSkKKwkJCQlyZXR1cm4g
UFRSX0VSUihzZ3QpOworCisJCQl0dG0tPnNnID0gc2d0OworCQl9CisKIAkJZHJtX3ByaW1lX3Nn
X3RvX3BhZ2VfYWRkcl9hcnJheXModHRtLT5zZywgdHRtLT5wYWdlcywKIAkJCQkJCSBndHQtPnR0
bS5kbWFfYWRkcmVzcywKIAkJCQkJCSB0dG0tPm51bV9wYWdlcyk7CkBAIC0xMjg3LDkgKzEzMDEs
OCBAQCBzdGF0aWMgaW50IGFtZGdwdV90dG1fdHRfcG9wdWxhdGUoc3RydWN0IHR0bV90dCAqdHRt
LAogICovCiBzdGF0aWMgdm9pZCBhbWRncHVfdHRtX3R0X3VucG9wdWxhdGUoc3RydWN0IHR0bV90
dCAqdHRtKQogewotCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2OwogCXN0cnVjdCBhbWRncHVf
dHRtX3R0ICpndHQgPSAodm9pZCAqKXR0bTsKLQlib29sIHNsYXZlID0gISEodHRtLT5wYWdlX2Zs
YWdzICYgVFRNX1BBR0VfRkxBR19TRyk7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXY7CiAK
IAlpZiAoZ3R0ICYmIGd0dC0+dXNlcnB0cikgewogCQlhbWRncHVfdHRtX3R0X3NldF91c2VyX3Bh
Z2VzKHR0bSwgTlVMTCk7CkBAIC0xMjk4LDcgKzEzMTEsMTYgQEAgc3RhdGljIHZvaWQgYW1kZ3B1
X3R0bV90dF91bnBvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSkKIAkJcmV0dXJuOwogCX0KIAot
CWlmIChzbGF2ZSkKKwlpZiAodHRtLT5zZyAmJiBndHQtPmdvYmotPmltcG9ydF9hdHRhY2gpIHsK
KwkJc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoOworCisJCWF0dGFjaCA9IGd0dC0+
Z29iai0+aW1wb3J0X2F0dGFjaDsKKwkJZG1hX2J1Zl91bm1hcF9hdHRhY2htZW50KGF0dGFjaCwg
dHRtLT5zZywgRE1BX0JJRElSRUNUSU9OQUwpOworCQl0dG0tPnNnID0gTlVMTDsKKwkJcmV0dXJu
OworCX0KKworCWlmICh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX1NHKQogCQlyZXR1
cm47CiAKIAlhZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KHR0bS0+YmRldik7Ci0tIAoyLjE3LjEKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFp
bGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
