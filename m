Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E3E6D199FC
	for <lists+amd-gfx@lfdr.de>; Fri, 10 May 2019 10:48:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3ED9C89930;
	Fri, 10 May 2019 08:48:51 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM03-CO1-obe.outbound.protection.outlook.com
 (mail-eopbgr790042.outbound.protection.outlook.com [40.107.79.42])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 17D1389930
 for <amd-gfx@lists.freedesktop.org>; Fri, 10 May 2019 08:48:49 +0000 (UTC)
Received: from CY4PR12CA0032.namprd12.prod.outlook.com (2603:10b6:903:129::18)
 by CY4PR1201MB0053.namprd12.prod.outlook.com (2603:10b6:910:23::22)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.1856.12; Fri, 10 May
 2019 08:48:48 +0000
Received: from DM3NAM03FT025.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e49::204) by CY4PR12CA0032.outlook.office365.com
 (2603:10b6:903:129::18) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id 15.20.1878.20 via Frontend
 Transport; Fri, 10 May 2019 08:48:47 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV02.amd.com (165.204.84.17) by
 DM3NAM03FT025.mail.protection.outlook.com (10.152.82.181) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.1856.11 via Frontend Transport; Fri, 10 May 2019 08:48:47 +0000
Received: from gc-System-Product-Name.amd.com (10.34.1.3) by
 SATLEXCHOV02.amd.com (10.181.40.72) with Microsoft SMTP Server id 14.3.389.1; 
 Fri, 10 May 2019 03:48:45 -0500
From: Chengming Gui <Jack.Gui@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 1/2] drm/amd/powerplay: Enable "disable dpm" feature to
 support swSMU debug
Date: Fri, 10 May 2019 16:48:36 +0800
Message-ID: <1557478117-17823-1-git-send-email-Jack.Gui@amd.com>
X-Mailer: git-send-email 2.7.4
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(376002)(39860400002)(346002)(396003)(136003)(2980300002)(428003)(189003)(199004)(6916009)(2351001)(81166006)(81156014)(68736007)(336012)(6666004)(8936002)(486006)(53416004)(4326008)(8676002)(50226002)(86362001)(426003)(14444005)(126002)(2616005)(70586007)(36756003)(476003)(305945005)(70206006)(47776003)(48376002)(26005)(50466002)(77096007)(5660300002)(186003)(2906002)(356004)(53936002)(316002)(16586007)(72206003)(51416003)(478600001)(7696005);
 DIR:OUT; SFP:1101; SCL:1; SRVR:CY4PR1201MB0053; H:SATLEXCHOV02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 9f529789-c99c-4588-2cd9-08d6d524512d
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600141)(711020)(4605104)(2017052603328);
 SRVR:CY4PR1201MB0053; 
X-MS-TrafficTypeDiagnostic: CY4PR1201MB0053:
X-Microsoft-Antispam-PRVS: <CY4PR1201MB00533D3F7D0849A18051A2CD8B0C0@CY4PR1201MB0053.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:773;
X-Forefront-PRVS: 0033AAD26D
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: sXxMd6ZSG+aEoqzGhoYaFsAYqULdsuvnq0NnQcHE2B4gfKkfqr6hR9lybeUznxtY+IuMD0wt+CsdTMgMiZatOiChmCKW2PfMjAQFlf5G5mSyUOsz1xhSqM0V4Z1sXSkrLier7EGaMqLWn449odCjKEjt1sQVlYOMeDgPDiN+tdAYeVcOWzD5WT9dN0+vz6Zdv/XODJmkgkyj1X+McoLI4upV317c7CwMXc7/oxnzT1Um2iYHx9RY+2NMNpl7jcMCbx1byYNi0muNz4edF+MHgsC1qQc18MP+F9hoZ8wkK8NpbPibvj5BUwGnRNjRCWckVvYVfCDNFpA5Q5tyb9oFG9Rw8bQ2aJtZt4JBAXPLUn/zURsDlvyMLyBmJ3bg2q5QznnoaonqIcG6xCIcQXIDPiWJA0zg3m7L2X7uDwUPyD4=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 10 May 2019 08:48:47.5666 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 9f529789-c99c-4588-2cd9-08d6d524512d
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: CY4PR1201MB0053
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amd-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=ZoN/VSDDvKJLQ9QTfKk0grsK+zJ7JFUn/Q0Da14jjz4=;
 b=w5Uzbz4C7DCEJP8pI2YSsQJyQCwPE8rpCuoVSNk8i2jmnB6TQCAjxEFLUX+nwfk45glUhUv3pg7NlazV2Wva1siO90PoyGNklFs0Jg/MpPU+Rg7PUgh00+bw2lMEfk+7Gli4TWqWa4bMI280JK1Zosy/Muoz6cSkgrV9gu2/w8c=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chengming Gui <Jack.Gui@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

YWRkIHBtX2VuYWJsZWQgdG8gY29udHJvbCB0aGUgZHBtIG9mZi9vbi4KClNpZ25lZC1vZmYtYnk6
IENoZW5nbWluZyBHdWkgPEphY2suR3VpQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2Ft
ZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jICAgICB8IDM0ICsrKysrKysrKysrKysrKysrKysrKysr
LS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9pbmMvYW1kZ3B1X3NtdS5oIHwgIDEg
KwogZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211X3YxMV8wLmMgICAgICB8IDM0ICsr
KysrKysrKysrKysrKysrKysrKystLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDYwIGluc2VydGlvbnMo
KyksIDkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dl
cnBsYXkvYW1kZ3B1X3NtdS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1
X3NtdS5jCmluZGV4IDUyZDkxOWEuLjk5YjIwODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvcG93ZXJwbGF5L2FtZGdwdV9zbXUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bv
d2VycGxheS9hbWRncHVfc211LmMKQEAgLTE5OCw2ICsxOTgsOCBAQCBpbnQgc211X3N5c19zZXRf
cHBfdGFibGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsICB2b2lkICpidWYsIHNpemVfdCBzaXpl
KQogCUFUT01fQ09NTU9OX1RBQkxFX0hFQURFUiAqaGVhZGVyID0gKEFUT01fQ09NTU9OX1RBQkxF
X0hFQURFUiAqKWJ1ZjsKIAlpbnQgcmV0ID0gMDsKIAorCWlmICghc211LT5wbV9lbmFibGVkKQor
CQlyZXR1cm4gLUVJTlZBTDsKIAlpZiAoaGVhZGVyLT51c1N0cnVjdHVyZVNpemUgIT0gc2l6ZSkg
ewogCQlwcl9lcnIoInBwIHRhYmxlIHNpemUgbm90IG1hdGNoZWQgIVxuIik7CiAJCXJldHVybiAt
RUlPOwpAQCAtMjMzLDYgKzIzNSw4IEBAIGludCBzbXVfZmVhdHVyZV9pbml0X2RwbShzdHJ1Y3Qg
c211X2NvbnRleHQgKnNtdSkKIAlpbnQgcmV0ID0gMDsKIAl1aW50MzJfdCB1bmFsbG93ZWRfZmVh
dHVyZV9tYXNrW1NNVV9GRUFUVVJFX01BWC8zMl07CiAKKwlpZiAoIXNtdS0+cG1fZW5hYmxlZCkK
KwkJcmV0dXJuIHJldDsKIAltdXRleF9sb2NrKCZmZWF0dXJlLT5tdXRleCk7CiAJYml0bWFwX2Zp
bGwoZmVhdHVyZS0+YWxsb3dlZCwgU01VX0ZFQVRVUkVfTUFYKTsKIAltdXRleF91bmxvY2soJmZl
YXR1cmUtPm11dGV4KTsKQEAgLTM0NCw2ICszNDgsNyBAQCBzdGF0aWMgaW50IHNtdV9lYXJseV9p
bml0KHZvaWQgKmhhbmRsZSkKIAlzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSA9ICZhZGV2LT5zbXU7
CiAKIAlzbXUtPmFkZXYgPSBhZGV2OworCXNtdS0+cG1fZW5hYmxlZCA9IGFtZGdwdV9kcG07CiAJ
bXV0ZXhfaW5pdCgmc211LT5tdXRleCk7CiAKIAlyZXR1cm4gc211X3NldF9mdW5jcyhhZGV2KTsK
QEAgLTM1Myw2ICszNTgsOSBAQCBzdGF0aWMgaW50IHNtdV9sYXRlX2luaXQodm9pZCAqaGFuZGxl
KQogewogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICopaGFuZGxlOwogCXN0cnVjdCBzbXVfY29udGV4dCAqc211ID0gJmFkZXYtPnNtdTsKKworCWlm
ICghc211LT5wbV9lbmFibGVkKQorCQlyZXR1cm4gMDsKIAltdXRleF9sb2NrKCZzbXUtPm11dGV4
KTsKIAlzbXVfaGFuZGxlX3Rhc2soJmFkZXYtPnNtdSwKIAkJCXNtdS0+c211X2RwbS5kcG1fbGV2
ZWwsCkBAIC03NDYsNiArNzU0LDkgQEAgc3RhdGljIGludCBzbXVfc21jX3RhYmxlX2h3X2luaXQo
c3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJICovCiAJcmV0ID0gc211X3NldF90b29sX3RhYmxl
X2xvY2F0aW9uKHNtdSk7CiAKKwlpZiAoIXNtdV9pc19kcG1fcnVubmluZyhzbXUpKQorCQlwcl9p
bmZvKCJkcG0gaGFzIGJlZW4gZGlzYWJsZWRcbiIpOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAt
ODYxLDcgKzg3MiwxMCBAQCBzdGF0aWMgaW50IHNtdV9od19pbml0KHZvaWQgKmhhbmRsZSkKIAog
CW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CiAKLQlhZGV2LT5wbS5kcG1fZW5hYmxlZCA9IHRy
dWU7CisJaWYgKCFzbXUtPnBtX2VuYWJsZWQpCisJCWFkZXYtPnBtLmRwbV9lbmFibGVkID0gZmFs
c2U7CisJZWxzZQorCQlhZGV2LT5wbS5kcG1fZW5hYmxlZCA9IHRydWU7CiAKIAlwcl9pbmZvKCJT
TVUgaXMgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5IVxuIik7CiAKQEAgLTg3OSw2ICs4OTMsOCBA
QCBzdGF0aWMgaW50IHNtdV9od19maW5pKHZvaWQgKmhhbmRsZSkKIAlzdHJ1Y3Qgc211X3RhYmxl
X2NvbnRleHQgKnRhYmxlX2NvbnRleHQgPSAmc211LT5zbXVfdGFibGU7CiAJaW50IHJldCA9IDA7
CiAKKwlpZiAoIXNtdS0+cG1fZW5hYmxlZCkKKwkJcmV0dXJuIHJldDsKIAlpZiAoIWlzX3N1cHBv
cnRfc3dfc211KGFkZXYpKQogCQlyZXR1cm4gLUVJTlZBTDsKIApAQCAtOTMyLDEwICs5NDgsMTIg
QEAgaW50IHNtdV9yZXNldChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKIAogc3RhdGljIGludCBz
bXVfc3VzcGVuZCh2b2lkICpoYW5kbGUpCiB7Ci0JaW50IHJldDsKKwlpbnQgcmV0ID0gMDsKIAlz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWhhbmRs
ZTsKIAlzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSA9ICZhZGV2LT5zbXU7CiAKKwlpZiAoIXNtdS0+
cG1fZW5hYmxlZCkKKwkJcmV0dXJuIHJldDsKIAlpZiAoIWlzX3N1cHBvcnRfc3dfc211KGFkZXYp
KQogCQlyZXR1cm4gLUVJTlZBTDsKIApAQCAtOTUwLDEwICs5NjgsMTIgQEAgc3RhdGljIGludCBz
bXVfc3VzcGVuZCh2b2lkICpoYW5kbGUpCiAKIHN0YXRpYyBpbnQgc211X3Jlc3VtZSh2b2lkICpo
YW5kbGUpCiB7Ci0JaW50IHJldDsKKwlpbnQgcmV0ID0gMDsKIAlzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWhhbmRsZTsKIAlzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSA9ICZhZGV2LT5zbXU7CiAKKwlpZiAoIXNtdS0+cG1fZW5hYmxlZCkKKwkJcmV0
dXJuIHJldDsKIAlpZiAoIWlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQogCQlyZXR1cm4gLUVJTlZB
TDsKIApAQCAtOTg1LDcgKzEwMDUsNyBAQCBpbnQgc211X2Rpc3BsYXlfY29uZmlndXJhdGlvbl9j
aGFuZ2Uoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJaW50IGluZGV4ID0gMDsKIAlpbnQgbnVt
X29mX2FjdGl2ZV9kaXNwbGF5ID0gMDsKIAotCWlmICghaXNfc3VwcG9ydF9zd19zbXUoc211LT5h
ZGV2KSkKKwlpZiAoIXNtdS0+cG1fZW5hYmxlZCB8fCAhaXNfc3VwcG9ydF9zd19zbXUoc211LT5h
ZGV2KSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKIAlpZiAoIWRpc3BsYXlfY29uZmlnKQpAQCAtMTEx
Myw2ICsxMTMzLDggQEAgc3RhdGljIGludCBzbXVfZW5hYmxlX3VtZF9wc3RhdGUodm9pZCAqaGFu
ZGxlLAogCiAJc3RydWN0IHNtdV9jb250ZXh0ICpzbXUgPSAoc3RydWN0IHNtdV9jb250ZXh0Kiko
aGFuZGxlKTsKIAlzdHJ1Y3Qgc211X2RwbV9jb250ZXh0ICpzbXVfZHBtX2N0eCA9ICYoc211LT5z
bXVfZHBtKTsKKwlpZiAoIXNtdS0+cG1fZW5hYmxlZCkKKwkJcmV0dXJuIC1FSU5WQUw7CiAJaWYg
KCFzbXVfZHBtX2N0eC0+ZHBtX2NvbnRleHQpCiAJCXJldHVybiAtRUlOVkFMOwogCkBAIC0xMTU2
LDYgKzExNzgsOCBAQCBpbnQgc211X2FkanVzdF9wb3dlcl9zdGF0ZV9keW5hbWljKHN0cnVjdCBz
bXVfY29udGV4dCAqc211LAogCWxvbmcgd29ya2xvYWQ7CiAJc3RydWN0IHNtdV9kcG1fY29udGV4
dCAqc211X2RwbV9jdHggPSAmKHNtdS0+c211X2RwbSk7CiAKKwlpZiAoIXNtdS0+cG1fZW5hYmxl
ZCkKKwkJcmV0dXJuIC1FSU5WQUw7CiAJaWYgKCFza2lwX2Rpc3BsYXlfc2V0dGluZ3MpIHsKIAkJ
cmV0ID0gc211X2Rpc3BsYXlfY29uZmlnX2NoYW5nZWQoc211KTsKIAkJaWYgKHJldCkgewpAQCAt
MTE2NCw2ICsxMTg4LDggQEAgaW50IHNtdV9hZGp1c3RfcG93ZXJfc3RhdGVfZHluYW1pYyhzdHJ1
Y3Qgc211X2NvbnRleHQgKnNtdSwKIAkJfQogCX0KIAorCWlmICghc211LT5wbV9lbmFibGVkKQor
CQlyZXR1cm4gLUVJTlZBTDsKIAlyZXQgPSBzbXVfYXBwbHlfY2xvY2tzX2FkanVzdF9ydWxlcyhz
bXUpOwogCWlmIChyZXQpIHsKIAkJcHJfZXJyKCJGYWlsZWQgdG8gYXBwbHkgY2xvY2tzIGFkanVz
dCBydWxlcyEiKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2lu
Yy9hbWRncHVfc211LmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9pbmMvYW1kZ3B1
X3NtdS5oCmluZGV4IDg5MDUyNDEuLjU2Yjk4MTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvcG93ZXJwbGF5L2luYy9hbWRncHVfc211LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9wb3dlcnBsYXkvaW5jL2FtZGdwdV9zbXUuaApAQCAtNDAxLDYgKzQwMSw3IEBAIHN0cnVjdCBz
bXVfY29udGV4dAogCXVpbnQzMl90IHdvcmtsb2FkX3NldHRpbmdbV09SS0xPQURfUE9MSUNZX01B
WF07CiAJdWludDMyX3QgcG93ZXJfcHJvZmlsZV9tb2RlOwogCXVpbnQzMl90IGRlZmF1bHRfcG93
ZXJfcHJvZmlsZV9tb2RlOworCWJvb2wgcG1fZW5hYmxlZDsKIAogCXVpbnQzMl90IHNtY19pZl92
ZXJzaW9uOwogfTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3Nt
dV92MTFfMC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211X3YxMV8wLmMKaW5k
ZXggY2QzNmM0Mi4uZGVlMWU5MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dl
cnBsYXkvc211X3YxMV8wLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211
X3YxMV8wLmMKQEAgLTM2MCw2ICszNjAsOCBAQCBzdGF0aWMgaW50IHNtdV92MTFfMF9pbml0X3Bv
d2VyKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQogewogCXN0cnVjdCBzbXVfcG93ZXJfY29udGV4
dCAqc211X3Bvd2VyID0gJnNtdS0+c211X3Bvd2VyOwogCisJaWYgKCFzbXUtPnBtX2VuYWJsZWQp
CisJCXJldHVybiAwOwogCWlmIChzbXVfcG93ZXItPnBvd2VyX2NvbnRleHQgfHwgc211X3Bvd2Vy
LT5wb3dlcl9jb250ZXh0X3NpemUgIT0gMCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKQEAgLTM3Niw2
ICszNzgsOCBAQCBzdGF0aWMgaW50IHNtdV92MTFfMF9maW5pX3Bvd2VyKHN0cnVjdCBzbXVfY29u
dGV4dCAqc211KQogewogCXN0cnVjdCBzbXVfcG93ZXJfY29udGV4dCAqc211X3Bvd2VyID0gJnNt
dS0+c211X3Bvd2VyOwogCisJaWYgKCFzbXUtPnBtX2VuYWJsZWQpCisJCXJldHVybiAwOwogCWlm
ICghc211X3Bvd2VyLT5wb3dlcl9jb250ZXh0IHx8IHNtdV9wb3dlci0+cG93ZXJfY29udGV4dF9z
aXplID09IDApCiAJCXJldHVybiAtRUlOVkFMOwogCkBAIC02NDEsNiArNjQ1LDggQEAgc3RhdGlj
IGludCBzbXVfdjExXzBfc2V0X21pbl9kY2VmX2RlZXBfc2xlZXAoc3RydWN0IHNtdV9jb250ZXh0
ICpzbXUpCiB7CiAJc3RydWN0IHNtdV90YWJsZV9jb250ZXh0ICp0YWJsZV9jb250ZXh0ID0gJnNt
dS0+c211X3RhYmxlOwogCisJaWYgKCFzbXUtPnBtX2VuYWJsZWQpCisJCXJldHVybiAwOwogCWlm
ICghdGFibGVfY29udGV4dCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKQEAgLTY2OSw2ICs2NzUsOSBA
QCBzdGF0aWMgaW50IHNtdV92MTFfMF9zZXRfdG9vbF90YWJsZV9sb2NhdGlvbihzdHJ1Y3Qgc211
X2NvbnRleHQgKnNtdSkKIHN0YXRpYyBpbnQgc211X3YxMV8wX2luaXRfZGlzcGxheShzdHJ1Y3Qg
c211X2NvbnRleHQgKnNtdSkKIHsKIAlpbnQgcmV0ID0gMDsKKworCWlmICghc211LT5wbV9lbmFi
bGVkKQorCQlyZXR1cm4gcmV0OwogCXJldCA9IHNtdV9zZW5kX3NtY19tc2dfd2l0aF9wYXJhbShz
bXUsIFNNVV9NU0dfTnVtT2ZEaXNwbGF5cywgMCk7CiAJcmV0dXJuIHJldDsKIH0KQEAgLTY3OCw2
ICs2ODcsOCBAQCBzdGF0aWMgaW50IHNtdV92MTFfMF91cGRhdGVfZmVhdHVyZV9lbmFibGVfc3Rh
dGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQzMgogCXVpbnQzMl90IGZlYXR1cmVfbG93
ID0gMCwgZmVhdHVyZV9oaWdoID0gMDsKIAlpbnQgcmV0ID0gMDsKIAorCWlmICghc211LT5wbV9l
bmFibGVkKQorCQlyZXR1cm4gcmV0OwogCWlmIChmZWF0dXJlX2lkID49IDAgJiYgZmVhdHVyZV9p
ZCA8IDMxKQogCQlmZWF0dXJlX2xvdyA9ICgxIDw8IGZlYXR1cmVfaWQpOwogCWVsc2UgaWYgKGZl
YXR1cmVfaWQgPiAzMSAmJiBmZWF0dXJlX2lkIDwgNjMpCkBAIC03ODQsMTAgKzc5NSwxMyBAQCBz
dGF0aWMgaW50IHNtdV92MTFfMF9zeXN0ZW1fZmVhdHVyZXNfY29udHJvbChzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwKIAl1aW50MzJfdCBmZWF0dXJlX21hc2tbMl07CiAJaW50IHJldCA9IDA7CiAK
LQlyZXQgPSBzbXVfc2VuZF9zbWNfbXNnKHNtdSwgKGVuID8gU01VX01TR19FbmFibGVBbGxTbXVG
ZWF0dXJlcyA6Ci0JCQkJICAgICBTTVVfTVNHX0Rpc2FibGVBbGxTbXVGZWF0dXJlcykpOwotCWlm
IChyZXQpCi0JCXJldHVybiByZXQ7CisJaWYgKHNtdS0+cG1fZW5hYmxlZCkgeworCQlyZXQgPSBz
bXVfc2VuZF9zbWNfbXNnKHNtdSwgKGVuID8gU01VX01TR19FbmFibGVBbGxTbXVGZWF0dXJlcyA6
CisJCQkJCSAgICAgU01VX01TR19EaXNhYmxlQWxsU211RmVhdHVyZXMpKTsKKwkJaWYgKHJldCkK
KwkJCXJldHVybiByZXQ7CisJfQorCiAJcmV0ID0gc211X2ZlYXR1cmVfZ2V0X2VuYWJsZWRfbWFz
ayhzbXUsIGZlYXR1cmVfbWFzaywgMik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKQEAgLTgw
NCw2ICs4MTgsOCBAQCBzdGF0aWMgaW50IHNtdV92MTFfMF9ub3RpZnlfZGlzcGxheV9jaGFuZ2Uo
c3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCiB7CiAJaW50IHJldCA9IDA7CiAKKwlpZiAoIXNtdS0+
cG1fZW5hYmxlZCkKKwkJcmV0dXJuIHJldDsKIAlpZiAoc211X2ZlYXR1cmVfaXNfZW5hYmxlZChz
bXUsIEZFQVRVUkVfRFBNX1VDTEtfQklUKSkKIAkgICAgcmV0ID0gc211X3NlbmRfc21jX21zZ193
aXRoX3BhcmFtKHNtdSwgU01VX01TR19TZXRVY2xrRmFzdFN3aXRjaCwgMSk7CiAKQEAgLTgxNiw2
ICs4MzIsOCBAQCBzbXVfdjExXzBfZ2V0X21heF9zdXN0YWluYWJsZV9jbG9jayhzdHJ1Y3Qgc211
X2NvbnRleHQgKnNtdSwgdWludDMyX3QgKmNsb2NrLAogewogCWludCByZXQgPSAwOwogCisJaWYg
KCFzbXUtPnBtX2VuYWJsZWQpCisJCXJldHVybiByZXQ7CiAJcmV0ID0gc211X3NlbmRfc21jX21z
Z193aXRoX3BhcmFtKHNtdSwgU01VX01TR19HZXREY01vZGVNYXhEcG1GcmVxLAogCQkJCQkgIGNs
b2NrX3NlbGVjdCA8PCAxNik7CiAJaWYgKHJldCkgewpAQCAtMTA3Miw2ICsxMDkwLDggQEAgc3Rh
dGljIGludCBzbXVfdjExXzBfc3RhcnRfdGhlcm1hbF9jb250cm9sKHN0cnVjdCBzbXVfY29udGV4
dCAqc211KQogCXN0cnVjdCBQUF9UZW1wZXJhdHVyZVJhbmdlIHJhbmdlOwogCXN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2ID0gc211LT5hZGV2OwogCisJaWYgKCFzbXUtPnBtX2VuYWJsZWQpCisJ
CXJldHVybiByZXQ7CiAJc211X3YxMV8wX2dldF90aGVybWFsX3JhbmdlKHNtdSwgJnJhbmdlKTsK
IAogCWlmIChzbXUtPnNtdV90YWJsZS50aGVybWFsX2NvbnRyb2xsZXJfdHlwZSkgewpAQCAtMTI0
Miw2ICsxMjYyLDggQEAgc211X3YxMV8wX2Rpc3BsYXlfY2xvY2tfdm9sdGFnZV9yZXF1ZXN0KHN0
cnVjdCBzbXVfY29udGV4dCAqc211LAogCVBQQ0xLX2UgY2xrX3NlbGVjdCA9IDA7CiAJdWludDMy
X3QgY2xrX2ZyZXEgPSBjbG9ja19yZXEtPmNsb2NrX2ZyZXFfaW5fa2h6IC8gMTAwMDsKIAorCWlm
ICghc211LT5wbV9lbmFibGVkKQorCQlyZXR1cm4gLUVJTlZBTDsKIAlpZiAoc211X2ZlYXR1cmVf
aXNfZW5hYmxlZChzbXUsIEZFQVRVUkVfRFBNX0RDRUZDTEtfQklUKSkgewogCQlzd2l0Y2ggKGNs
a190eXBlKSB7CiAJCWNhc2UgYW1kX3BwX2RjZWZfY2xvY2s6CkBAIC0xNTI1LDcgKzE1NDcsNyBA
QCBzdGF0aWMgaW50IHNtdV92MTFfMF9nZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHN0cnVjdCBzbXVf
Y29udGV4dCAqc211LCBjaGFyICpidWYpCiAJCQkiUERfRGF0YV9lcnJvcl9yYXRlX2NvZWZmIn07
CiAJaW50IHJlc3VsdCA9IDA7CiAKLQlpZiAoIWJ1ZikKKwlpZiAoIXNtdS0+cG1fZW5hYmxlZCB8
fCAhYnVmKQogCQlyZXR1cm4gLUVJTlZBTDsKIAogCXNpemUgKz0gc3ByaW50ZihidWYgKyBzaXpl
LCAiJTE2cyAlcyAlcyAlcyAlcyAlcyAlcyAlcyAlcyAlcyAlc1xuIiwKQEAgLTE2MTIsNiArMTYz
NCw4IEBAIHN0YXRpYyBpbnQgc211X3YxMV8wX3NldF9wb3dlcl9wcm9maWxlX21vZGUoc3RydWN0
IHNtdV9jb250ZXh0ICpzbXUsIGxvbmcgKmlucHV0CiAKIAlzbXUtPnBvd2VyX3Byb2ZpbGVfbW9k
ZSA9IGlucHV0W3NpemVdOwogCisJaWYgKCFzbXUtPnBtX2VuYWJsZWQpCisJCXJldHVybiByZXQ7
CiAJaWYgKHNtdS0+cG93ZXJfcHJvZmlsZV9tb2RlID4gUFBfU01DX1BPV0VSX1BST0ZJTEVfQ1VT
VE9NKSB7CiAJCXByX2VycigiSW52YWxpZCBwb3dlciBwcm9maWxlIG1vZGUgJWRcbiIsIHNtdS0+
cG93ZXJfcHJvZmlsZV9tb2RlKTsKIAkJcmV0dXJuIC1FSU5WQUw7Ci0tIAoyLjcuNAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5n
IGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
