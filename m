Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A14B5B1D10
	for <lists+amd-gfx@lfdr.de>; Fri, 13 Sep 2019 14:08:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E5F016EF43;
	Fri, 13 Sep 2019 12:08:04 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 618336EF43
 for <amd-gfx@lists.freedesktop.org>; Fri, 13 Sep 2019 12:08:03 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id x2so2484321wmj.2
 for <amd-gfx@lists.freedesktop.org>; Fri, 13 Sep 2019 05:08:03 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=FyUZCMci05gTAMpuyyeW0mYgVXwJUNc+8+A8STcrAtM=;
 b=bD2FoXpeoaghm67VPZ/ZA+RxOZHR7G4WGSjkJpEKCUcKyE7Ub9G2JjTel2IN0+b3DH
 /RsVBk5xGIeWJ54yPW4IVahWvchrqzgeK2EJvXnw5q1wDX9MspvDqPvdcVUmByXmdkRC
 6lC4lK29lggeJqtY1dumVjLKI1hvikNB7eM10rWdpRzjVHPFD2R9pbJr9gPOXF7iCcPx
 gHDxI/1T1+L3Hc+VXoIguwDNALpHZXtmfGcb+WWRHOZGfoscBIJifgkvDDVVQtCjSPfo
 RB+KTyw19OkAWYRXJf0JqVO1Y336Kj9RH/cvi3TRrz0bbszcUfyMfKA/KJyUU+sCcwuj
 rG7g==
X-Gm-Message-State: APjAAAXtLrX//wRB8LyDOW4mwbkpIaWzTreNiZN31v1c0FdCxQCsvbju
 g7A86vuh0Hs37Ixb+z7PAxM=
X-Google-Smtp-Source: APXvYqx1mFB6rlE/s/5TDptyg7NwkG8so7NNwoP5ICM24SPGY65GjSLRTHag9RhoSHMJhX75bsAb1Q==
X-Received: by 2002:a7b:c392:: with SMTP id s18mr3390318wmj.25.1568376481896; 
 Fri, 13 Sep 2019 05:08:01 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:fd97:b16a:b9f0:9362])
 by smtp.gmail.com with ESMTPSA id y3sm38095629wra.88.2019.09.13.05.08.00
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 13 Sep 2019 05:08:01 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: Andrey.Grodzovsky@amd.com, Tao.Zhou1@amd.com, Guchun.Chen@amd.com,
 amd-gfx@lists.freedesktop.org
Subject: [PATCH] drm/amdgpu: cleanup creating BOs at fixed location
Date: Fri, 13 Sep 2019 14:08:00 +0200
Message-Id: <20190913120800.96299-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=FyUZCMci05gTAMpuyyeW0mYgVXwJUNc+8+A8STcrAtM=;
 b=XWWMmYPyk8keLKsk20YVyLc9YSeNOHzTyH987nEFIIexPnyaB9iUlU7MlFzLzPHZP1
 WKK6LeJk3hnChBxc5uLppfhywxZcuc2SIRR75K6yrOyM0BRmE0NbvKgFSKeGQk5g75tU
 Edi24kuuKCLkqtglSClBbrK0Zyxf3O6++ujAgKP3OuWFfPBKuAL0UgU9sTvPIvrXP8RI
 ffmRUdRkwPmwKYKL8HiTeaJ9TH6eEEa/3ZYBTQzZ+T38CNVHP9gIs7VNUwiwZFXIWWUL
 CtEjfVYRo53iRsina5T7Biigj0Ej+Z/saEy1hl/F+izSaJU/Z5mM0C/qymkk9KUY1h08
 apSg==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhlIHBsYWNlbWVudCBpcyBzb21ldGhpbmcgVFRNL0JPIGludGVybmFsIGFuZCB0aGUgUkFTIGNv
ZGUgc2hvdWxkCmF2b2lkIHRvdWNoaW5nIHRoYXQgZGlyZWN0bHkuCgpBZGQgYSBoZWxwZXIgdG8g
Y3JlYXRlIGEgQk8gYXQgYSBmaXhlZCBsb2NhdGlvbiBhbmQgdXNlIHRoYXQgaW5zdGVhZC4KClNp
Z25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4K
LS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgfCA2MSArKysr
KysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0Lmgg
fCAgMyArCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmMgICAgfCA4MiAr
Ky0tLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dHRtLmMgICAgfCA4MiArKysrLS0tLS0tLS0tLS0tLS0tLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDgx
IGluc2VydGlvbnMoKyksIDE0NyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfb2JqZWN0LmMKaW5kZXggNTEwZDA0ZmQ2ZTVmLi43MGQ0NWQ0ODkwN2EgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKQEAgLTM0Miw2ICsz
NDIsNjcgQEAgaW50IGFtZGdwdV9ib19jcmVhdGVfa2VybmVsKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LAogCXJldHVybiAwOwogfQogCisvKioKKyAqIGFtZGdwdV9ib19jcmVhdGVfa2VybmVs
IC0gY3JlYXRlIEJPIGZvciBrZXJuZWwgdXNlIGF0IHNwZWNpZmljIGxvY2F0aW9uCisgKgorICog
QGFkZXY6IGFtZGdwdSBkZXZpY2Ugb2JqZWN0CisgKiBAb2Zmc2V0OiBvZmZzZXQgb2YgdGhlIEJP
CisgKiBAc2l6ZTogc2l6ZSBvZiB0aGUgQk8KKyAqIEBkb21haW46IHdoZXJlIHRvIHBsYWNlIGl0
CisgKiBAYm9fcHRyOiAgdXNlZCB0byBpbml0aWFsaXplIEJPcyBpbiBzdHJ1Y3R1cmVzCisgKiBA
Y3B1X2FkZHI6IG9wdGlvbmFsIENQVSBhZGRyZXNzIG1hcHBpbmcKKyAqCisgKiBDcmVhdGVzIGEg
a2VybmVsIEJPIGF0IGEgc3BlY2lmaWMgb2Zmc2V0IGluIHRoZSBhZGRyZXNzIHNwYWNlIG9mIHRo
ZSBkb21haW4uCisgKgorICogUmV0dXJuczoKKyAqIDAgb24gc3VjY2VzcywgbmVnYXRpdmUgZXJy
b3IgY29kZSBvdGhlcndpc2UuCisgKi8KK2ludCBhbWRncHVfYm9fY3JlYXRlX2tlcm5lbF9hdChz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKKwkJCSAgICAgICB1aW50NjRfdCBvZmZzZXQsIHVp
bnQ2NF90IHNpemUsIHVpbnQzMl90IGRvbWFpbiwKKwkJCSAgICAgICBzdHJ1Y3QgYW1kZ3B1X2Jv
ICoqYm9fcHRyLCB2b2lkICoqY3B1X2FkZHIpCit7CisJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4
IGN0eCA9IHsgZmFsc2UsIGZhbHNlIH07CisJdW5zaWduZWQgaW50IGk7CisJaW50IHI7CisKKwlv
ZmZzZXQgJj0gUEFHRV9NQVNLOworCXNpemUgPSBBTElHTihvZmZzZXQsIFBBR0VfU0laRSk7CisK
KwlyID0gYW1kZ3B1X2JvX2NyZWF0ZV9yZXNlcnZlZChhZGV2LCBzaXplLCBQQUdFX1NJWkUsIGRv
bWFpbiwgYm9fcHRyLAorCQkJCSAgICAgIE5VTEwsIE5VTEwpOworCWlmIChyKQorCQlyZXR1cm4g
cjsKKworCS8qCisJICogUmVtb3ZlIHRoZSBvcmlnaW5hbCBtZW0gbm9kZSBhbmQgY3JlYXRlIGEg
bmV3IG9uZSBhdCB0aGUgcmVxdWVzdAorCSAqIHBvc2l0aW9uLgorCSAqLworCWZvciAoaSA9IDA7
IGkgPCAoKmJvX3B0ciktPnBsYWNlbWVudC5udW1fcGxhY2VtZW50OyArK2kpIHsKKwkJKCpib19w
dHIpLT5wbGFjZW1lbnRzW2ldLmZwZm4gPSBvZmZzZXQgPj4gUEFHRV9TSElGVDsKKwkJKCpib19w
dHIpLT5wbGFjZW1lbnRzW2ldLmxwZm4gPSAob2Zmc2V0ICsgc2l6ZSkgPj4gUEFHRV9TSElGVDsK
Kwl9CisKKwl0dG1fYm9fbWVtX3B1dCgmKCpib19wdHIpLT50Ym8sICYoKmJvX3B0ciktPnRiby5t
ZW0pOworCXIgPSB0dG1fYm9fbWVtX3NwYWNlKCYoKmJvX3B0ciktPnRibywgJigqYm9fcHRyKS0+
cGxhY2VtZW50LAorCQkJICAgICAmKCpib19wdHIpLT50Ym8ubWVtLCAmY3R4KTsKKwlpZiAocikK
KwkJZ290byBlcnJvcjsKKworCWlmIChjcHVfYWRkcikgeworCQlyID0gYW1kZ3B1X2JvX2ttYXAo
KmJvX3B0ciwgY3B1X2FkZHIpOworCQlpZiAocikKKwkJCWdvdG8gZXJyb3I7CisJfQorCisJYW1k
Z3B1X2JvX3VucmVzZXJ2ZSgqYm9fcHRyKTsKKwlyZXR1cm4gMDsKKworZXJyb3I6CisJYW1kZ3B1
X2JvX3VucmVzZXJ2ZSgqYm9fcHRyKTsKKwlhbWRncHVfYm9fdW5yZWYoYm9fcHRyKTsKKwlyZXR1
cm4gcjsKK30KKwogLyoqCiAgKiBhbWRncHVfYm9fZnJlZV9rZXJuZWwgLSBmcmVlIEJPIGZvciBr
ZXJuZWwgdXNlCiAgKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5o
CmluZGV4IGU2ZGRkMDQ4YTk4NC4uZjliNTUwZjE5ZWE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oCkBAIC0yMzksNiArMjM5LDkgQEAgaW50IGFtZGdwdV9i
b19jcmVhdGVfa2VybmVsKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkJICAgIHVuc2ln
bmVkIGxvbmcgc2l6ZSwgaW50IGFsaWduLAogCQkJICAgIHUzMiBkb21haW4sIHN0cnVjdCBhbWRn
cHVfYm8gKipib19wdHIsCiAJCQkgICAgdTY0ICpncHVfYWRkciwgdm9pZCAqKmNwdV9hZGRyKTsK
K2ludCBhbWRncHVfYm9fY3JlYXRlX2tlcm5lbF9hdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
diwKKwkJCSAgICAgICB1aW50NjRfdCBvZmZzZXQsIHVpbnQ2NF90IHNpemUsIHVpbnQzMl90IGRv
bWFpbiwKKwkJCSAgICAgICBzdHJ1Y3QgYW1kZ3B1X2JvICoqYm9fcHRyLCB2b2lkICoqY3B1X2Fk
ZHIpOwogdm9pZCBhbWRncHVfYm9fZnJlZV9rZXJuZWwoc3RydWN0IGFtZGdwdV9ibyAqKmJvLCB1
NjQgKmdwdV9hZGRyLAogCQkJICAgdm9pZCAqKmNwdV9hZGRyKTsKIGludCBhbWRncHVfYm9fa21h
cChzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdm9pZCAqKnB0cik7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfcmFzLmMKaW5kZXggNWYwNmYxZTY0NWM3Li5jZmRhNzI2NTA3NzMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmMKQEAgLTY5LDEyICs2OSw2IEBAIGNv
bnN0IGNoYXIgKnJhc19ibG9ja19zdHJpbmdbXSA9IHsKIAogYXRvbWljX3QgYW1kZ3B1X3Jhc19p
bl9pbnRyID0gQVRPTUlDX0lOSVQoMCk7CiAKLXN0YXRpYyBpbnQgYW1kZ3B1X3Jhc19yZXNlcnZl
X3ZyYW0oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCi0JCXVpbnQ2NF90IG9mZnNldCwgdWlu
dDY0X3Qgc2l6ZSwKLQkJc3RydWN0IGFtZGdwdV9ibyAqKmJvX3B0cik7Ci1zdGF0aWMgaW50IGFt
ZGdwdV9yYXNfcmVsZWFzZV92cmFtKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAotCQlzdHJ1
Y3QgYW1kZ3B1X2JvICoqYm9fcHRyKTsKLQogc3RhdGljIHNzaXplX3QgYW1kZ3B1X3Jhc19kZWJ1
Z2ZzX3JlYWQoc3RydWN0IGZpbGUgKmYsIGNoYXIgX191c2VyICpidWYsCiAJCQkJCXNpemVfdCBz
aXplLCBsb2ZmX3QgKnBvcykKIHsKQEAgLTEyNjAsNzUgKzEyNTQsNiBAQCBzdGF0aWMgdm9pZCBh
bWRncHVfcmFzX2RvX3JlY292ZXJ5KHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlhdG9taWNf
c2V0KCZyYXMtPmluX3JlY292ZXJ5LCAwKTsKIH0KIAotc3RhdGljIGludCBhbWRncHVfcmFzX3Jl
bGVhc2VfdnJhbShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKLQkJc3RydWN0IGFtZGdwdV9i
byAqKmJvX3B0cikKLXsKLQkvKiBubyBuZWVkIHRvIGZyZWUgaXQgYWN0dWFsbHkuICovCi0JYW1k
Z3B1X2JvX2ZyZWVfa2VybmVsKGJvX3B0ciwgTlVMTCwgTlVMTCk7Ci0JcmV0dXJuIDA7Ci19Ci0K
LS8qIHJlc2VydmUgdnJhbSB3aXRoIHNpemVAb2Zmc2V0ICovCi1zdGF0aWMgaW50IGFtZGdwdV9y
YXNfcmVzZXJ2ZV92cmFtKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAotCQl1aW50NjRfdCBv
ZmZzZXQsIHVpbnQ2NF90IHNpemUsCi0JCXN0cnVjdCBhbWRncHVfYm8gKipib19wdHIpCi17Ci0J
c3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IGN0eCA9IHsgZmFsc2UsIGZhbHNlIH07Ci0Jc3RydWN0
IGFtZGdwdV9ib19wYXJhbSBicDsKLQlpbnQgciA9IDA7Ci0JaW50IGk7Ci0Jc3RydWN0IGFtZGdw
dV9ibyAqYm87Ci0KLQlpZiAoYm9fcHRyKQotCQkqYm9fcHRyID0gTlVMTDsKLQltZW1zZXQoJmJw
LCAwLCBzaXplb2YoYnApKTsKLQlicC5zaXplID0gc2l6ZTsKLQlicC5ieXRlX2FsaWduID0gUEFH
RV9TSVpFOwotCWJwLmRvbWFpbiA9IEFNREdQVV9HRU1fRE9NQUlOX1ZSQU07Ci0JYnAuZmxhZ3Mg
PSBBTURHUFVfR0VNX0NSRUFURV9WUkFNX0NPTlRJR1VPVVMgfAotCQlBTURHUFVfR0VNX0NSRUFU
RV9OT19DUFVfQUNDRVNTOwotCWJwLnR5cGUgPSB0dG1fYm9fdHlwZV9rZXJuZWw7Ci0JYnAucmVz
diA9IE5VTEw7Ci0KLQlyID0gYW1kZ3B1X2JvX2NyZWF0ZShhZGV2LCAmYnAsICZibyk7Ci0JaWYg
KHIpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JciA9IGFtZGdwdV9ib19yZXNlcnZlKGJvLCBmYWxz
ZSk7Ci0JaWYgKHIpCi0JCWdvdG8gZXJyb3JfcmVzZXJ2ZTsKLQotCW9mZnNldCA9IEFMSUdOKG9m
ZnNldCwgUEFHRV9TSVpFKTsKLQlmb3IgKGkgPSAwOyBpIDwgYm8tPnBsYWNlbWVudC5udW1fcGxh
Y2VtZW50OyArK2kpIHsKLQkJYm8tPnBsYWNlbWVudHNbaV0uZnBmbiA9IG9mZnNldCA+PiBQQUdF
X1NISUZUOwotCQliby0+cGxhY2VtZW50c1tpXS5scGZuID0gKG9mZnNldCArIHNpemUpID4+IFBB
R0VfU0hJRlQ7Ci0JfQotCi0JdHRtX2JvX21lbV9wdXQoJmJvLT50Ym8sICZiby0+dGJvLm1lbSk7
Ci0JciA9IHR0bV9ib19tZW1fc3BhY2UoJmJvLT50Ym8sICZiby0+cGxhY2VtZW50LCAmYm8tPnRi
by5tZW0sICZjdHgpOwotCWlmIChyKQotCQlnb3RvIGVycm9yX3BpbjsKLQotCXIgPSBhbWRncHVf
Ym9fcGluX3Jlc3RyaWN0ZWQoYm8sCi0JCQlBTURHUFVfR0VNX0RPTUFJTl9WUkFNLAotCQkJb2Zm
c2V0LAotCQkJb2Zmc2V0ICsgc2l6ZSk7Ci0JaWYgKHIpCi0JCWdvdG8gZXJyb3JfcGluOwotCi0J
aWYgKGJvX3B0cikKLQkJKmJvX3B0ciA9IGJvOwotCi0JYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7
Ci0JcmV0dXJuIHI7Ci0KLWVycm9yX3BpbjoKLQlhbWRncHVfYm9fdW5yZXNlcnZlKGJvKTsKLWVy
cm9yX3Jlc2VydmU6Ci0JYW1kZ3B1X2JvX3VucmVmKCZibyk7Ci0JcmV0dXJuIHI7Ci19Ci0KIC8q
IGFsbG9jL3JlYWxsb2MgYnBzIGFycmF5ICovCiBzdGF0aWMgaW50IGFtZGdwdV9yYXNfcmVhbGxv
Y19laF9kYXRhX3NwYWNlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQlzdHJ1Y3QgcmFz
X2Vycl9oYW5kbGVyX2RhdGEgKmRhdGEsIGludCBwYWdlcykKQEAgLTE0NzgsOCArMTQwMyw5IEBA
IGludCBhbWRncHVfcmFzX3Jlc2VydmVfYmFkX3BhZ2VzKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2KQogCWZvciAoaSA9IGRhdGEtPmxhc3RfcmVzZXJ2ZWQ7IGkgPCBkYXRhLT5jb3VudDsgaSsr
KSB7CiAJCWJwID0gZGF0YS0+YnBzW2ldLnJldGlyZWRfcGFnZTsKIAotCQlpZiAoYW1kZ3B1X3Jh
c19yZXNlcnZlX3ZyYW0oYWRldiwgYnAgPDwgUEFHRV9TSElGVCwKLQkJCQkJUEFHRV9TSVpFLCAm
Ym8pKQorCQlpZiAoYW1kZ3B1X2JvX2NyZWF0ZV9rZXJuZWxfYXQoYWRldiwgYnAgPDwgUEFHRV9T
SVpFLCBQQUdFX1NJWkUsCisJCQkJCSAgICAgICBBTURHUFVfR0VNX0RPTUFJTl9WUkFNLAorCQkJ
CQkgICAgICAgJmJvLCBOVUxMKSkKIAkJCURSTV9FUlJPUigiUkFTIEVSUk9SOiByZXNlcnZlIHZy
YW0gJWxseCBmYWlsXG4iLCBicCk7CiAKIAkJZGF0YS0+YnBzX2JvW2ldID0gYm87CkBAIC0xNTEy
LDcgKzE0MzgsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9yYXNfcmVsZWFzZV9iYWRfcGFnZXMoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJZm9yIChpID0gZGF0YS0+bGFzdF9yZXNlcnZlZCAt
IDE7IGkgPj0gMDsgaS0tKSB7CiAJCWJvID0gZGF0YS0+YnBzX2JvW2ldOwogCi0JCWFtZGdwdV9y
YXNfcmVsZWFzZV92cmFtKGFkZXYsICZibyk7CisJCWFtZGdwdV9ib19mcmVlX2tlcm5lbCgmYm8s
IE5VTEwsIE5VTEwpOwogCiAJCWRhdGEtPmJwc19ib1tpXSA9IGJvOwogCQlkYXRhLT5sYXN0X3Jl
c2VydmVkID0gaTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwppbmRleCBj
MDU2MzhjZjNmM2QuLjAwZjhmMzhkNzk5MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV90dG0uYwpAQCAtMTY0NSw4MSArMTY0NSwyNSBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdHRt
X2Z3X3Jlc2VydmVfdnJhbV9maW5pKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogICovCiBz
dGF0aWMgaW50IGFtZGdwdV90dG1fZndfcmVzZXJ2ZV92cmFtX2luaXQoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYpCiB7Ci0Jc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IGN0eCA9IHsgZmFsc2Us
IGZhbHNlIH07Ci0Jc3RydWN0IGFtZGdwdV9ib19wYXJhbSBicDsKLQlpbnQgciA9IDA7Ci0JaW50
IGk7Ci0JdTY0IHZyYW1fc2l6ZSA9IGFkZXYtPmdtYy52aXNpYmxlX3ZyYW1fc2l6ZTsKLQl1NjQg
b2Zmc2V0ID0gYWRldi0+ZndfdnJhbV91c2FnZS5zdGFydF9vZmZzZXQ7Ci0JdTY0IHNpemUgPSBh
ZGV2LT5md192cmFtX3VzYWdlLnNpemU7Ci0Jc3RydWN0IGFtZGdwdV9ibyAqYm87Ci0KLQltZW1z
ZXQoJmJwLCAwLCBzaXplb2YoYnApKTsKLQlicC5zaXplID0gYWRldi0+ZndfdnJhbV91c2FnZS5z
aXplOwotCWJwLmJ5dGVfYWxpZ24gPSBQQUdFX1NJWkU7Ci0JYnAuZG9tYWluID0gQU1ER1BVX0dF
TV9ET01BSU5fVlJBTTsKLQlicC5mbGFncyA9IEFNREdQVV9HRU1fQ1JFQVRFX0NQVV9BQ0NFU1Nf
UkVRVUlSRUQgfAotCQlBTURHUFVfR0VNX0NSRUFURV9WUkFNX0NPTlRJR1VPVVM7Ci0JYnAudHlw
ZSA9IHR0bV9ib190eXBlX2tlcm5lbDsKLQlicC5yZXN2ID0gTlVMTDsKKwl1aW50NjRfdCB2cmFt
X3NpemUgPSBhZGV2LT5nbWMudmlzaWJsZV92cmFtX3NpemU7CisJaW50IHI7CisKIAlhZGV2LT5m
d192cmFtX3VzYWdlLnZhID0gTlVMTDsKIAlhZGV2LT5md192cmFtX3VzYWdlLnJlc2VydmVkX2Jv
ID0gTlVMTDsKIAotCWlmIChhZGV2LT5md192cmFtX3VzYWdlLnNpemUgPiAwICYmCi0JCWFkZXYt
PmZ3X3ZyYW1fdXNhZ2Uuc2l6ZSA8PSB2cmFtX3NpemUpIHsKLQotCQlyID0gYW1kZ3B1X2JvX2Ny
ZWF0ZShhZGV2LCAmYnAsCi0JCQkJICAgICAmYWRldi0+ZndfdnJhbV91c2FnZS5yZXNlcnZlZF9i
byk7Ci0JCWlmIChyKQotCQkJZ290byBlcnJvcl9jcmVhdGU7Ci0KLQkJciA9IGFtZGdwdV9ib19y
ZXNlcnZlKGFkZXYtPmZ3X3ZyYW1fdXNhZ2UucmVzZXJ2ZWRfYm8sIGZhbHNlKTsKLQkJaWYgKHIp
Ci0JCQlnb3RvIGVycm9yX3Jlc2VydmU7Ci0KLQkJLyogcmVtb3ZlIHRoZSBvcmlnaW5hbCBtZW0g
bm9kZSBhbmQgY3JlYXRlIGEgbmV3IG9uZSBhdCB0aGUKLQkJICogcmVxdWVzdCBwb3NpdGlvbgot
CQkgKi8KLQkJYm8gPSBhZGV2LT5md192cmFtX3VzYWdlLnJlc2VydmVkX2JvOwotCQlvZmZzZXQg
PSBBTElHTihvZmZzZXQsIFBBR0VfU0laRSk7Ci0JCWZvciAoaSA9IDA7IGkgPCBiby0+cGxhY2Vt
ZW50Lm51bV9wbGFjZW1lbnQ7ICsraSkgewotCQkJYm8tPnBsYWNlbWVudHNbaV0uZnBmbiA9IG9m
ZnNldCA+PiBQQUdFX1NISUZUOwotCQkJYm8tPnBsYWNlbWVudHNbaV0ubHBmbiA9IChvZmZzZXQg
KyBzaXplKSA+PiBQQUdFX1NISUZUOwotCQl9Ci0KLQkJdHRtX2JvX21lbV9wdXQoJmJvLT50Ym8s
ICZiby0+dGJvLm1lbSk7Ci0JCXIgPSB0dG1fYm9fbWVtX3NwYWNlKCZiby0+dGJvLCAmYm8tPnBs
YWNlbWVudCwKLQkJCQkgICAgICZiby0+dGJvLm1lbSwgJmN0eCk7Ci0JCWlmIChyKQotCQkJZ290
byBlcnJvcl9waW47Ci0KLQkJciA9IGFtZGdwdV9ib19waW5fcmVzdHJpY3RlZChhZGV2LT5md192
cmFtX3VzYWdlLnJlc2VydmVkX2JvLAotCQkJQU1ER1BVX0dFTV9ET01BSU5fVlJBTSwKLQkJCWFk
ZXYtPmZ3X3ZyYW1fdXNhZ2Uuc3RhcnRfb2Zmc2V0LAotCQkJKGFkZXYtPmZ3X3ZyYW1fdXNhZ2Uu
c3RhcnRfb2Zmc2V0ICsKLQkJCWFkZXYtPmZ3X3ZyYW1fdXNhZ2Uuc2l6ZSkpOwotCQlpZiAocikK
LQkJCWdvdG8gZXJyb3JfcGluOwotCQlyID0gYW1kZ3B1X2JvX2ttYXAoYWRldi0+ZndfdnJhbV91
c2FnZS5yZXNlcnZlZF9ibywKLQkJCSZhZGV2LT5md192cmFtX3VzYWdlLnZhKTsKLQkJaWYgKHIp
Ci0JCQlnb3RvIGVycm9yX2ttYXA7Ci0KLQkJYW1kZ3B1X2JvX3VucmVzZXJ2ZShhZGV2LT5md192
cmFtX3VzYWdlLnJlc2VydmVkX2JvKTsKLQl9Ci0JcmV0dXJuIHI7CisJaWYgKGFkZXYtPmZ3X3Zy
YW1fdXNhZ2Uuc2l6ZSA9PSAwIHx8CisJICAgIGFkZXYtPmZ3X3ZyYW1fdXNhZ2Uuc2l6ZSA+IHZy
YW1fc2l6ZSkKKwkJcmV0dXJuIDA7CiAKLWVycm9yX2ttYXA6Ci0JYW1kZ3B1X2JvX3VucGluKGFk
ZXYtPmZ3X3ZyYW1fdXNhZ2UucmVzZXJ2ZWRfYm8pOwotZXJyb3JfcGluOgotCWFtZGdwdV9ib191
bnJlc2VydmUoYWRldi0+ZndfdnJhbV91c2FnZS5yZXNlcnZlZF9ibyk7Ci1lcnJvcl9yZXNlcnZl
OgotCWFtZGdwdV9ib191bnJlZigmYWRldi0+ZndfdnJhbV91c2FnZS5yZXNlcnZlZF9ibyk7Ci1l
cnJvcl9jcmVhdGU6Ci0JYWRldi0+ZndfdnJhbV91c2FnZS52YSA9IE5VTEw7Ci0JYWRldi0+Zndf
dnJhbV91c2FnZS5yZXNlcnZlZF9ibyA9IE5VTEw7CisJcmV0dXJuIGFtZGdwdV9ib19jcmVhdGVf
a2VybmVsX2F0KGFkZXYsCisJCQkJCSAgYWRldi0+ZndfdnJhbV91c2FnZS5zdGFydF9vZmZzZXQs
CisJCQkJCSAgYWRldi0+ZndfdnJhbV91c2FnZS5zaXplLAorCQkJCQkgIEFNREdQVV9HRU1fRE9N
QUlOX1ZSQU0sCisJCQkJCSAgJmFkZXYtPmZ3X3ZyYW1fdXNhZ2UucmVzZXJ2ZWRfYm8sCisJCQkJ
CSAgJmFkZXYtPmZ3X3ZyYW1fdXNhZ2UudmEpOwogCXJldHVybiByOwogfQorCiAvKioKICAqIGFt
ZGdwdV90dG1faW5pdCAtIEluaXQgdGhlIG1lbW9yeSBtYW5hZ2VtZW50ICh0dG0pIGFzIHdlbGwg
YXMgdmFyaW91cwogICogZ3R0L3ZyYW0gcmVsYXRlZCBmaWVsZHMuCi0tIAoyLjE3LjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGlu
ZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
