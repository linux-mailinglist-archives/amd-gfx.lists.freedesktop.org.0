Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D93502D1A2
	for <lists+amd-gfx@lfdr.de>; Wed, 29 May 2019 00:38:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B71A76E039;
	Tue, 28 May 2019 22:38:43 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM03-DM3-obe.outbound.protection.outlook.com
 (mail-eopbgr800072.outbound.protection.outlook.com [40.107.80.72])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3206C6E029
 for <amd-gfx@lists.freedesktop.org>; Tue, 28 May 2019 22:38:40 +0000 (UTC)
Received: from DM6PR12MB3947.namprd12.prod.outlook.com (10.255.174.156) by
 DM6PR12MB3305.namprd12.prod.outlook.com (20.179.106.93) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1922.15; Tue, 28 May 2019 22:38:36 +0000
Received: from DM6PR12MB3947.namprd12.prod.outlook.com
 ([fe80::5964:8c3c:1b5b:c480]) by DM6PR12MB3947.namprd12.prod.outlook.com
 ([fe80::5964:8c3c:1b5b:c480%2]) with mapi id 15.20.1922.021; Tue, 28 May 2019
 22:38:36 +0000
From: "Kuehling, Felix" <Felix.Kuehling@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 1/3] drm/amdkfd: Simplify eviction state logic
Thread-Topic: [PATCH 1/3] drm/amdkfd: Simplify eviction state logic
Thread-Index: AQHVFaYWfRH3KMAnX0iHnvRXYFwbJg==
Date: Tue, 28 May 2019 22:38:36 +0000
Message-ID: <20190528223811.13947-2-Felix.Kuehling@amd.com>
References: <20190528223811.13947-1-Felix.Kuehling@amd.com>
In-Reply-To: <20190528223811.13947-1-Felix.Kuehling@amd.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [165.204.55.251]
x-mailer: git-send-email 2.17.1
x-clientproxiedby: YTBPR01CA0008.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b01:14::21) To DM6PR12MB3947.namprd12.prod.outlook.com
 (2603:10b6:5:1cb::28)
x-ms-exchange-messagesentrepresentingtype: 1
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: d28eaea6-43e8-4b4e-145f-08d6e3bd38b5
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(4618075)(2017052603328)(7193020);
 SRVR:DM6PR12MB3305; 
x-ms-traffictypediagnostic: DM6PR12MB3305:
x-microsoft-antispam-prvs: <DM6PR12MB33053F8935D18C5527E5CF2E921E0@DM6PR12MB3305.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:5236;
x-forefront-prvs: 00514A2FE6
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(396003)(39860400002)(346002)(136003)(366004)(376002)(189003)(199004)(3846002)(6116002)(2501003)(2906002)(6486002)(8936002)(6506007)(86362001)(81166006)(50226002)(99286004)(81156014)(256004)(8676002)(72206003)(6436002)(14454004)(14444005)(71190400001)(386003)(71200400001)(52116002)(7736002)(305945005)(2351001)(102836004)(64756008)(5660300002)(36756003)(5640700003)(66066001)(316002)(478600001)(186003)(4326008)(476003)(486006)(30864003)(68736007)(6512007)(446003)(53936002)(1076003)(73956011)(66476007)(66946007)(26005)(76176011)(66556008)(66446008)(25786009)(2616005)(11346002)(6916009)(309714004);
 DIR:OUT; SFP:1101; SCL:1; SRVR:DM6PR12MB3305;
 H:DM6PR12MB3947.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: uk/X5zpbLfIw1SlRnETNy/iP/dgbEjUmIVOgwPZc9EXYpxcLG1q0vICTl10wvVzORiOY1CMgMPgeXcjXJzWAvndhHs20R2pur3vsz2O+hKX16BEIeg/s/9Gd33ranD5aO2HxcgwZUgapI0aVroDTIQPDr+h+v8Vm24mWKmWkB3Ok5yYli93cJQab1HgBq8hJ2z3boXz0esxtoFTSwMrFgCtT1GNa4rzPuiGntz76hxmdHgJdQ659JeZP2GEMxjO6TFmTIyaystkFxMr0ne2QbeLvIWNosOpEfsfLKuBsilA74orJUPsHB+v+/frc2Yod0++kXbl1DQHJ4Xjul6LVh+xxHxLZK/fAbODHa9HxceGVyA3lxbLNv+OD5m/fNEmfWzi/Jx4R6/zDGB7yezmx9FO6t5n69RiytzDZbG5bLk0=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: d28eaea6-43e8-4b4e-145f-08d6e3bd38b5
X-MS-Exchange-CrossTenant-originalarrivaltime: 28 May 2019 22:38:36.1248 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: fkuehlin@amd.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM6PR12MB3305
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=xGpjdYooEfFMhmezJUHNHHIj1lVggL7IGsXYnf3y7no=;
 b=yWYVBX1jtHqyLVyabtjQQObcJohhk5lNj1i0QGnstiHdsIblRFYV2uHueeic2sW6MM4rn5KmsBt/4ZLoJojkAQ0iq9S1qC4gWLO6lVXGfZ/R+KJpX9Hz+IcpeQgOhru7fyr4lNSVwyb5db63Vm/tMvndCivkrjL0IqMGX2FuzMY=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Felix.Kuehling@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Kuehling, Felix" <Felix.Kuehling@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

QWx3YXlzIG1hcmsgZXZpY3RlZCBxdWV1ZXMgd2l0aCBxLT5wcm9wZXJ0aWVzLmlzX2V2aWN0ZWQg
PSB0cnVlLCBldmVuDQpxdWV1ZXMgdGhhdCBhcmUgaW5hY3RpdmUgZm9yIG90aGVyIHJlYXNvbi4g
VGhpcyBzaW1wbGlmaWVzIG1haW50YWluaW5nDQp0aGUgZXZpY3Rpb24gc3RhdGUgYXMgaXQgZG9l
c24ndCByZXF1aXJlIHVwZGF0aW5nIGlzX2V2aWN0ZWQgd2hlbiBvdGhlcg0KcXVldWUgYWN0aXZh
dGlvbiBjb25kaXRpb25zIGNoYW5nZS4NCg0KT24gdGhlIG90aGVyIGhhbmQsIHdlIG5vdyBuZWVk
IHRvIGNoZWNrIHRob3NlIG90aGVyIHF1ZXVlIGFjdGl2YXRpb24NCmNvbmRpdGlvbnMgd2hlbmV2
ZXIgYW4gZXZpY3RlZCBxdWV1ZXMgaXMgcmVzdG9yZWQuIFRvIG1pbmltaXplIGNvZGUNCmR1cGxp
Y2F0aW9uLCBtb3ZlIHRoZSBxdWV1ZSBhY3RpdmF0aW9uIGNoZWNrIGludG8gYSBtYWNybyBzbyBp
dCBjYW4gYmUNCm1haW50YWluZWQgaW4gb25lIGNlbnRyYWwgcGxhY2UuDQoNClNpZ25lZC1vZmYt
Ynk6IEZlbGl4IEt1ZWhsaW5nIDxGZWxpeC5LdWVobGluZ0BhbWQuY29tPg0KUmV2aWV3ZWQtYnk6
IFBoaWxpcCBDb3ggPFBoaWxpcC5Db3hAYW1kLmNvbT4NCi0tLQ0KIC4uLi9kcm0vYW1kL2FtZGtm
ZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuYyB8IDg0ICsrKysrKysrKystLS0tLS0tLS0NCiAu
Li4vZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9tcWRfbWFuYWdlcl9jaWsuYyAgfCAxNSArLS0tDQog
Li4uL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFkX21hbmFnZXJfdjkuYyAgIHwgMTAgKy0tDQog
Li4uL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFkX21hbmFnZXJfdmkuYyAgIHwgMTAgKy0tDQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX3ByaXYuaCAgICAgICAgIHwgIDUgKysNCiA1
IGZpbGVzIGNoYW5nZWQsIDU2IGluc2VydGlvbnMoKyksIDY4IGRlbGV0aW9ucygtKQ0KDQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1ZV9tYW5h
Z2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFn
ZXIuYw0KaW5kZXggZWNlMzVjN2E3N2I1Li5jMTgzNTVkNGNiOTUgMTAwNjQ0DQotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuYw0KKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2VyLmMNCkBA
IC0yODksMTMgKzI4OSwxMSBAQCBzdGF0aWMgaW50IGNyZWF0ZV9xdWV1ZV9ub2Nwc2NoKHN0cnVj
dCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLA0KIAl9DQogCXEtPnByb3BlcnRpZXMudm1pZCA9
IHFwZC0+dm1pZDsNCiAJLyoNCi0JICogRXZpY3Rpb24gc3RhdGUgbG9naWM6IHdlIG9ubHkgbWFy
ayBhY3RpdmUgcXVldWVzIGFzIGV2aWN0ZWQNCi0JICogdG8gYXZvaWQgdGhlIG92ZXJoZWFkIG9m
IHJlc3RvcmluZyBpbmFjdGl2ZSBxdWV1ZXMgbGF0ZXINCisJICogRXZpY3Rpb24gc3RhdGUgbG9n
aWM6IG1hcmsgYWxsIHF1ZXVlcyBhcyBldmljdGVkLCBldmVuIG9uZXMNCisJICogbm90IGN1cnJl
bnRseSBhY3RpdmUuIFJlc3RvcmluZyBpbmFjdGl2ZSBxdWV1ZXMgbGF0ZXIgb25seQ0KKwkgKiB1
cGRhdGVzIHRoZSBpc19ldmljdGVkIGZsYWcgYnV0IGlzIGEgbm8tb3Agb3RoZXJ3aXNlLg0KIAkg
Ki8NCi0JaWYgKHFwZC0+ZXZpY3RlZCkNCi0JCXEtPnByb3BlcnRpZXMuaXNfZXZpY3RlZCA9IChx
LT5wcm9wZXJ0aWVzLnF1ZXVlX3NpemUgPiAwICYmDQotCQkJCQkgICAgcS0+cHJvcGVydGllcy5x
dWV1ZV9wZXJjZW50ID4gMCAmJg0KLQkJCQkJICAgIHEtPnByb3BlcnRpZXMucXVldWVfYWRkcmVz
cyAhPSAwKTsNCisJcS0+cHJvcGVydGllcy5pc19ldmljdGVkID0gISFxcGQtPmV2aWN0ZWQ7DQog
DQogCXEtPnByb3BlcnRpZXMudGJhX2FkZHIgPSBxcGQtPnRiYV9hZGRyOw0KIAlxLT5wcm9wZXJ0
aWVzLnRtYV9hZGRyID0gcXBkLT50bWFfYWRkcjsNCkBAIC01MTgsMTQgKzUxNiw2IEBAIHN0YXRp
YyBpbnQgdXBkYXRlX3F1ZXVlKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLCBzdHJ1
Y3QgcXVldWUgKnEpDQogCX0NCiAJbXFkX21nciA9IGRxbS0+bXFkX21ncnNbZ2V0X21xZF90eXBl
X2Zyb21fcXVldWVfdHlwZSgNCiAJCQlxLT5wcm9wZXJ0aWVzLnR5cGUpXTsNCi0JLyoNCi0JICog
RXZpY3Rpb24gc3RhdGUgbG9naWM6IHdlIG9ubHkgbWFyayBhY3RpdmUgcXVldWVzIGFzIGV2aWN0
ZWQNCi0JICogdG8gYXZvaWQgdGhlIG92ZXJoZWFkIG9mIHJlc3RvcmluZyBpbmFjdGl2ZSBxdWV1
ZXMgbGF0ZXINCi0JICovDQotCWlmIChwZGQtPnFwZC5ldmljdGVkKQ0KLQkJcS0+cHJvcGVydGll
cy5pc19ldmljdGVkID0gKHEtPnByb3BlcnRpZXMucXVldWVfc2l6ZSA+IDAgJiYNCi0JCQkJCSAg
ICBxLT5wcm9wZXJ0aWVzLnF1ZXVlX3BlcmNlbnQgPiAwICYmDQotCQkJCQkgICAgcS0+cHJvcGVy
dGllcy5xdWV1ZV9hZGRyZXNzICE9IDApOw0KIA0KIAkvKiBTYXZlIHByZXZpb3VzIGFjdGl2aXR5
IHN0YXRlIGZvciBjb3VudGVycyAqLw0KIAlwcmV2X2FjdGl2ZSA9IHEtPnByb3BlcnRpZXMuaXNf
YWN0aXZlOw0KQEAgLTU5MCw3ICs1ODAsNyBAQCBzdGF0aWMgaW50IGV2aWN0X3Byb2Nlc3NfcXVl
dWVzX25vY3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sDQogCXN0cnVjdCBx
dWV1ZSAqcTsNCiAJc3RydWN0IG1xZF9tYW5hZ2VyICptcWRfbWdyOw0KIAlzdHJ1Y3Qga2ZkX3By
b2Nlc3NfZGV2aWNlICpwZGQ7DQotCWludCByZXR2YWwgPSAwOw0KKwlpbnQgcmV0dmFsLCByZXQg
PSAwOw0KIA0KIAlkcW1fbG9jayhkcW0pOw0KIAlpZiAocXBkLT5ldmljdGVkKysgPiAwKSAvKiBh
bHJlYWR5IGV2aWN0ZWQsIGRvIG5vdGhpbmcgKi8NCkBAIC02MDAsMjUgKzU5MCwzMSBAQCBzdGF0
aWMgaW50IGV2aWN0X3Byb2Nlc3NfcXVldWVzX25vY3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9t
YW5hZ2VyICpkcW0sDQogCXByX2luZm9fcmF0ZWxpbWl0ZWQoIkV2aWN0aW5nIFBBU0lEICV1IHF1
ZXVlc1xuIiwNCiAJCQkgICAgcGRkLT5wcm9jZXNzLT5wYXNpZCk7DQogDQotCS8qIHVuYWN0aXZh
dGUgYWxsIGFjdGl2ZSBxdWV1ZXMgb24gdGhlIHFwZCAqLw0KKwkvKiBNYXJrIGFsbCBxdWV1ZXMg
YXMgZXZpY3RlZC4gRGVhY3RpdmF0ZSBhbGwgYWN0aXZlIHF1ZXVlcyBvbg0KKwkgKiB0aGUgcXBk
Lg0KKwkgKi8NCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShxLCAmcXBkLT5xdWV1ZXNfbGlzdCwgbGlz
dCkgew0KKwkJcS0+cHJvcGVydGllcy5pc19ldmljdGVkID0gdHJ1ZTsNCiAJCWlmICghcS0+cHJv
cGVydGllcy5pc19hY3RpdmUpDQogCQkJY29udGludWU7DQorDQogCQltcWRfbWdyID0gZHFtLT5t
cWRfbWdyc1tnZXRfbXFkX3R5cGVfZnJvbV9xdWV1ZV90eXBlKA0KIAkJCQlxLT5wcm9wZXJ0aWVz
LnR5cGUpXTsNCi0JCXEtPnByb3BlcnRpZXMuaXNfZXZpY3RlZCA9IHRydWU7DQogCQlxLT5wcm9w
ZXJ0aWVzLmlzX2FjdGl2ZSA9IGZhbHNlOw0KIAkJcmV0dmFsID0gbXFkX21nci0+ZGVzdHJveV9t
cWQobXFkX21nciwgcS0+bXFkLA0KIAkJCQlLRkRfUFJFRU1QVF9UWVBFX1dBVkVGUk9OVF9EUkFJ
TiwNCiAJCQkJS0ZEX1VOTUFQX0xBVEVOQ1lfTVMsIHEtPnBpcGUsIHEtPnF1ZXVlKTsNCi0JCWlm
IChyZXR2YWwpDQotCQkJZ290byBvdXQ7DQorCQlpZiAocmV0dmFsICYmICFyZXQpDQorCQkJLyog
UmV0dXJuIHRoZSBmaXJzdCBlcnJvciwgYnV0IGtlZXAgZ29pbmcgdG8NCisJCQkgKiBtYWludGFp
biBhIGNvbnNpc3RlbnQgZXZpY3Rpb24gc3RhdGUNCisJCQkgKi8NCisJCQlyZXQgPSByZXR2YWw7
DQogCQlkcW0tPnF1ZXVlX2NvdW50LS07DQogCX0NCiANCiBvdXQ6DQogCWRxbV91bmxvY2soZHFt
KTsNCi0JcmV0dXJuIHJldHZhbDsNCisJcmV0dXJuIHJldDsNCiB9DQogDQogc3RhdGljIGludCBl
dmljdF9wcm9jZXNzX3F1ZXVlc19jcHNjaChzdHJ1Y3QgZGV2aWNlX3F1ZXVlX21hbmFnZXIgKmRx
bSwNCkBAIC02MzYsMTEgKzYzMiwxNCBAQCBzdGF0aWMgaW50IGV2aWN0X3Byb2Nlc3NfcXVldWVz
X2Nwc2NoKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLA0KIAlwcl9pbmZvX3JhdGVs
aW1pdGVkKCJFdmljdGluZyBQQVNJRCAldSBxdWV1ZXNcbiIsDQogCQkJICAgIHBkZC0+cHJvY2Vz
cy0+cGFzaWQpOw0KIA0KLQkvKiB1bmFjdGl2YXRlIGFsbCBhY3RpdmUgcXVldWVzIG9uIHRoZSBx
cGQgKi8NCisJLyogTWFyayBhbGwgcXVldWVzIGFzIGV2aWN0ZWQuIERlYWN0aXZhdGUgYWxsIGFj
dGl2ZSBxdWV1ZXMgb24NCisJICogdGhlIHFwZC4NCisJICovDQogCWxpc3RfZm9yX2VhY2hfZW50
cnkocSwgJnFwZC0+cXVldWVzX2xpc3QsIGxpc3QpIHsNCisJCXEtPnByb3BlcnRpZXMuaXNfZXZp
Y3RlZCA9IHRydWU7DQogCQlpZiAoIXEtPnByb3BlcnRpZXMuaXNfYWN0aXZlKQ0KIAkJCWNvbnRp
bnVlOw0KLQkJcS0+cHJvcGVydGllcy5pc19ldmljdGVkID0gdHJ1ZTsNCisNCiAJCXEtPnByb3Bl
cnRpZXMuaXNfYWN0aXZlID0gZmFsc2U7DQogCQlkcW0tPnF1ZXVlX2NvdW50LS07DQogCX0NCkBA
IC02NjIsNyArNjYxLDcgQEAgc3RhdGljIGludCByZXN0b3JlX3Byb2Nlc3NfcXVldWVzX25vY3Bz
Y2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sDQogCXN0cnVjdCBtcWRfbWFuYWdl
ciAqbXFkX21ncjsNCiAJc3RydWN0IGtmZF9wcm9jZXNzX2RldmljZSAqcGRkOw0KIAl1aW50NjRf
dCBwZF9iYXNlOw0KLQlpbnQgcmV0dmFsID0gMDsNCisJaW50IHJldHZhbCwgcmV0ID0gMDsNCiAN
CiAJcGRkID0gcXBkX3RvX3BkZChxcGQpOw0KIAkvKiBSZXRyaWV2ZSBQRCBiYXNlICovDQpAQCAt
Njk2LDIyICs2OTUsMjggQEAgc3RhdGljIGludCByZXN0b3JlX3Byb2Nlc3NfcXVldWVzX25vY3Bz
Y2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sDQogCSAqLw0KIAltbSA9IGdldF90
YXNrX21tKHBkZC0+cHJvY2Vzcy0+bGVhZF90aHJlYWQpOw0KIAlpZiAoIW1tKSB7DQotCQlyZXR2
YWwgPSAtRUZBVUxUOw0KKwkJcmV0ID0gLUVGQVVMVDsNCiAJCWdvdG8gb3V0Ow0KIAl9DQogDQot
CS8qIGFjdGl2YXRlIGFsbCBhY3RpdmUgcXVldWVzIG9uIHRoZSBxcGQgKi8NCisJLyogUmVtb3Zl
IHRoZSBldmljdGlvbiBmbGFncy4gQWN0aXZhdGUgcXVldWVzIHRoYXQgYXJlIG5vdA0KKwkgKiBp
bmFjdGl2ZSBmb3Igb3RoZXIgcmVhc29ucy4NCisJICovDQogCWxpc3RfZm9yX2VhY2hfZW50cnko
cSwgJnFwZC0+cXVldWVzX2xpc3QsIGxpc3QpIHsNCi0JCWlmICghcS0+cHJvcGVydGllcy5pc19l
dmljdGVkKQ0KKwkJcS0+cHJvcGVydGllcy5pc19ldmljdGVkID0gZmFsc2U7DQorCQlpZiAoIVFV
RVVFX0lTX0FDVElWRShxLT5wcm9wZXJ0aWVzKSkNCiAJCQljb250aW51ZTsNCisNCiAJCW1xZF9t
Z3IgPSBkcW0tPm1xZF9tZ3JzW2dldF9tcWRfdHlwZV9mcm9tX3F1ZXVlX3R5cGUoDQogCQkJCXEt
PnByb3BlcnRpZXMudHlwZSldOw0KLQkJcS0+cHJvcGVydGllcy5pc19ldmljdGVkID0gZmFsc2U7
DQogCQlxLT5wcm9wZXJ0aWVzLmlzX2FjdGl2ZSA9IHRydWU7DQogCQlyZXR2YWwgPSBtcWRfbWdy
LT5sb2FkX21xZChtcWRfbWdyLCBxLT5tcWQsIHEtPnBpcGUsDQogCQkJCSAgICAgICBxLT5xdWV1
ZSwgJnEtPnByb3BlcnRpZXMsIG1tKTsNCi0JCWlmIChyZXR2YWwpDQotCQkJZ290byBvdXQ7DQor
CQlpZiAocmV0dmFsICYmICFyZXQpDQorCQkJLyogUmV0dXJuIHRoZSBmaXJzdCBlcnJvciwgYnV0
IGtlZXAgZ29pbmcgdG8NCisJCQkgKiBtYWludGFpbiBhIGNvbnNpc3RlbnQgZXZpY3Rpb24gc3Rh
dGUNCisJCQkgKi8NCisJCQlyZXQgPSByZXR2YWw7DQogCQlkcW0tPnF1ZXVlX2NvdW50Kys7DQog
CX0NCiAJcXBkLT5ldmljdGVkID0gMDsNCkBAIC03MTksNyArNzI0LDcgQEAgc3RhdGljIGludCBy
ZXN0b3JlX3Byb2Nlc3NfcXVldWVzX25vY3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2Vy
ICpkcW0sDQogCWlmIChtbSkNCiAJCW1tcHV0KG1tKTsNCiAJZHFtX3VubG9jayhkcW0pOw0KLQly
ZXR1cm4gcmV0dmFsOw0KKwlyZXR1cm4gcmV0Ow0KIH0NCiANCiBzdGF0aWMgaW50IHJlc3RvcmVf
cHJvY2Vzc19xdWV1ZXNfY3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sDQpA
QCAtNzUxLDE2ICs3NTYsMTYgQEAgc3RhdGljIGludCByZXN0b3JlX3Byb2Nlc3NfcXVldWVzX2Nw
c2NoKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLA0KIA0KIAkvKiBhY3RpdmF0ZSBh
bGwgYWN0aXZlIHF1ZXVlcyBvbiB0aGUgcXBkICovDQogCWxpc3RfZm9yX2VhY2hfZW50cnkocSwg
JnFwZC0+cXVldWVzX2xpc3QsIGxpc3QpIHsNCi0JCWlmICghcS0+cHJvcGVydGllcy5pc19ldmlj
dGVkKQ0KLQkJCWNvbnRpbnVlOw0KIAkJcS0+cHJvcGVydGllcy5pc19ldmljdGVkID0gZmFsc2U7
DQorCQlpZiAoIVFVRVVFX0lTX0FDVElWRShxLT5wcm9wZXJ0aWVzKSkNCisJCQljb250aW51ZTsN
CisNCiAJCXEtPnByb3BlcnRpZXMuaXNfYWN0aXZlID0gdHJ1ZTsNCiAJCWRxbS0+cXVldWVfY291
bnQrKzsNCiAJfQ0KIAlyZXR2YWwgPSBleGVjdXRlX3F1ZXVlc19jcHNjaChkcW0sDQogCQkJCUtG
RF9VTk1BUF9RVUVVRVNfRklMVEVSX0RZTkFNSUNfUVVFVUVTLCAwKTsNCi0JaWYgKCFyZXR2YWwp
DQotCQlxcGQtPmV2aWN0ZWQgPSAwOw0KKwlxcGQtPmV2aWN0ZWQgPSAwOw0KIG91dDoNCiAJZHFt
X3VubG9jayhkcW0pOw0KIAlyZXR1cm4gcmV0dmFsOw0KQEAgLTExOTksMTMgKzEyMDQsMTIgQEAg
c3RhdGljIGludCBjcmVhdGVfcXVldWVfY3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2Vy
ICpkcW0sIHN0cnVjdCBxdWV1ZSAqcSwNCiAJbXFkX21nciA9IGRxbS0+bXFkX21ncnNbZ2V0X21x
ZF90eXBlX2Zyb21fcXVldWVfdHlwZSgNCiAJCQlxLT5wcm9wZXJ0aWVzLnR5cGUpXTsNCiAJLyoN
Ci0JICogRXZpY3Rpb24gc3RhdGUgbG9naWM6IHdlIG9ubHkgbWFyayBhY3RpdmUgcXVldWVzIGFz
IGV2aWN0ZWQNCi0JICogdG8gYXZvaWQgdGhlIG92ZXJoZWFkIG9mIHJlc3RvcmluZyBpbmFjdGl2
ZSBxdWV1ZXMgbGF0ZXINCisJICogRXZpY3Rpb24gc3RhdGUgbG9naWM6IG1hcmsgYWxsIHF1ZXVl
cyBhcyBldmljdGVkLCBldmVuIG9uZXMNCisJICogbm90IGN1cnJlbnRseSBhY3RpdmUuIFJlc3Rv
cmluZyBpbmFjdGl2ZSBxdWV1ZXMgbGF0ZXIgb25seQ0KKwkgKiB1cGRhdGVzIHRoZSBpc19ldmlj
dGVkIGZsYWcgYnV0IGlzIGEgbm8tb3Agb3RoZXJ3aXNlLg0KIAkgKi8NCi0JaWYgKHFwZC0+ZXZp
Y3RlZCkNCi0JCXEtPnByb3BlcnRpZXMuaXNfZXZpY3RlZCA9IChxLT5wcm9wZXJ0aWVzLnF1ZXVl
X3NpemUgPiAwICYmDQotCQkJCQkgICAgcS0+cHJvcGVydGllcy5xdWV1ZV9wZXJjZW50ID4gMCAm
Jg0KLQkJCQkJICAgIHEtPnByb3BlcnRpZXMucXVldWVfYWRkcmVzcyAhPSAwKTsNCisJcS0+cHJv
cGVydGllcy5pc19ldmljdGVkID0gISFxcGQtPmV2aWN0ZWQ7DQorDQogCWRxbS0+YXNpY19vcHMu
aW5pdF9zZG1hX3ZtKGRxbSwgcSwgcXBkKTsNCiAJcS0+cHJvcGVydGllcy50YmFfYWRkciA9IHFw
ZC0+dGJhX2FkZHI7DQogCXEtPnByb3BlcnRpZXMudG1hX2FkZHIgPSBxcGQtPnRtYV9hZGRyOw0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9tcWRfbWFuYWdlcl9j
aWsuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9tcWRfbWFuYWdlcl9jaWsuYw0K
aW5kZXggNmU4NTA5ZWMyOWQ5Li41MzcwYTg5NzUyNmEgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFkX21hbmFnZXJfY2lrLmMNCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1ka2ZkL2tmZF9tcWRfbWFuYWdlcl9jaWsuYw0KQEAgLTIzMSwxMCArMjMxLDcg
QEAgc3RhdGljIGludCBfX3VwZGF0ZV9tcWQoc3RydWN0IG1xZF9tYW5hZ2VyICptbSwgdm9pZCAq
bXFkLA0KIA0KIAl1cGRhdGVfY3VfbWFzayhtbSwgbXFkLCBxKTsNCiANCi0JcS0+aXNfYWN0aXZl
ID0gKHEtPnF1ZXVlX3NpemUgPiAwICYmDQotCQkJcS0+cXVldWVfYWRkcmVzcyAhPSAwICYmDQot
CQkJcS0+cXVldWVfcGVyY2VudCA+IDAgJiYNCi0JCQkhcS0+aXNfZXZpY3RlZCk7DQorCXEtPmlz
X2FjdGl2ZSA9IFFVRVVFX0lTX0FDVElWRSgqcSk7DQogDQogCXJldHVybiAwOw0KIH0NCkBAIC0y
NzUsMTAgKzI3Miw3IEBAIHN0YXRpYyBpbnQgdXBkYXRlX21xZF9zZG1hKHN0cnVjdCBtcWRfbWFu
YWdlciAqbW0sIHZvaWQgKm1xZCwNCiAJbS0+c2RtYV9lbmdpbmVfaWQgPSBxLT5zZG1hX2VuZ2lu
ZV9pZDsNCiAJbS0+c2RtYV9xdWV1ZV9pZCA9IHEtPnNkbWFfcXVldWVfaWQ7DQogDQotCXEtPmlz
X2FjdGl2ZSA9IChxLT5xdWV1ZV9zaXplID4gMCAmJg0KLQkJCXEtPnF1ZXVlX2FkZHJlc3MgIT0g
MCAmJg0KLQkJCXEtPnF1ZXVlX3BlcmNlbnQgPiAwICYmDQotCQkJIXEtPmlzX2V2aWN0ZWQpOw0K
KwlxLT5pc19hY3RpdmUgPSBRVUVVRV9JU19BQ1RJVkUoKnEpOw0KIA0KIAlyZXR1cm4gMDsNCiB9
DQpAQCAtMzU4LDEwICszNTIsNyBAQCBzdGF0aWMgaW50IHVwZGF0ZV9tcWRfaGlxKHN0cnVjdCBt
cWRfbWFuYWdlciAqbW0sIHZvaWQgKm1xZCwNCiANCiAJbS0+Y3BfaHFkX3ZtaWQgPSBxLT52bWlk
Ow0KIA0KLQlxLT5pc19hY3RpdmUgPSAocS0+cXVldWVfc2l6ZSA+IDAgJiYNCi0JCQlxLT5xdWV1
ZV9hZGRyZXNzICE9IDAgJiYNCi0JCQlxLT5xdWV1ZV9wZXJjZW50ID4gMCAmJg0KLQkJCSFxLT5p
c19ldmljdGVkKTsNCisJcS0+aXNfYWN0aXZlID0gUVVFVUVfSVNfQUNUSVZFKCpxKTsNCiANCiAJ
cmV0dXJuIDA7DQogfQ0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tm
ZF9tcWRfbWFuYWdlcl92OS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX21xZF9t
YW5hZ2VyX3Y5LmMNCmluZGV4IDQ3NTAzMzgxOTliNi4uYTY1ZWZjYTM2MjE3IDEwMDY0NA0KLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX21xZF9tYW5hZ2VyX3Y5LmMNCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9tcWRfbWFuYWdlcl92OS5jDQpAQCAtMjQ3
LDEwICsyNDcsNyBAQCBzdGF0aWMgaW50IHVwZGF0ZV9tcWQoc3RydWN0IG1xZF9tYW5hZ2VyICpt
bSwgdm9pZCAqbXFkLA0KIA0KIAl1cGRhdGVfY3VfbWFzayhtbSwgbXFkLCBxKTsNCiANCi0JcS0+
aXNfYWN0aXZlID0gKHEtPnF1ZXVlX3NpemUgPiAwICYmDQotCQkJcS0+cXVldWVfYWRkcmVzcyAh
PSAwICYmDQotCQkJcS0+cXVldWVfcGVyY2VudCA+IDAgJiYNCi0JCQkhcS0+aXNfZXZpY3RlZCk7
DQorCXEtPmlzX2FjdGl2ZSA9IFFVRVVFX0lTX0FDVElWRSgqcSk7DQogDQogCXJldHVybiAwOw0K
IH0NCkBAIC00MDIsMTAgKzM5OSw3IEBAIHN0YXRpYyBpbnQgdXBkYXRlX21xZF9zZG1hKHN0cnVj
dCBtcWRfbWFuYWdlciAqbW0sIHZvaWQgKm1xZCwNCiAJbS0+c2RtYV9xdWV1ZV9pZCA9IHEtPnNk
bWFfcXVldWVfaWQ7DQogCW0tPnNkbWF4X3JsY3hfZHVtbXlfcmVnID0gU0RNQV9STENfRFVNTVlf
REVGQVVMVDsNCiANCi0JcS0+aXNfYWN0aXZlID0gKHEtPnF1ZXVlX3NpemUgPiAwICYmDQotCQkJ
cS0+cXVldWVfYWRkcmVzcyAhPSAwICYmDQotCQkJcS0+cXVldWVfcGVyY2VudCA+IDAgJiYNCi0J
CQkhcS0+aXNfZXZpY3RlZCk7DQorCXEtPmlzX2FjdGl2ZSA9IFFVRVVFX0lTX0FDVElWRSgqcSk7
DQogDQogCXJldHVybiAwOw0KIH0NCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGtmZC9rZmRfbXFkX21hbmFnZXJfdmkuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tm
ZF9tcWRfbWFuYWdlcl92aS5jDQppbmRleCBiNTUwZGVhOWIxMGEuLjMzNWFkZWQ4ODU1ZCAxMDA2
NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9tcWRfbWFuYWdlcl92aS5j
DQorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFkX21hbmFnZXJfdmkuYw0K
QEAgLTIzOCwxMCArMjM4LDcgQEAgc3RhdGljIGludCBfX3VwZGF0ZV9tcWQoc3RydWN0IG1xZF9t
YW5hZ2VyICptbSwgdm9pZCAqbXFkLA0KIA0KIAl1cGRhdGVfY3VfbWFzayhtbSwgbXFkLCBxKTsN
CiANCi0JcS0+aXNfYWN0aXZlID0gKHEtPnF1ZXVlX3NpemUgPiAwICYmDQotCQkJcS0+cXVldWVf
YWRkcmVzcyAhPSAwICYmDQotCQkJcS0+cXVldWVfcGVyY2VudCA+IDAgJiYNCi0JCQkhcS0+aXNf
ZXZpY3RlZCk7DQorCXEtPmlzX2FjdGl2ZSA9IFFVRVVFX0lTX0FDVElWRSgqcSk7DQogDQogCXJl
dHVybiAwOw0KIH0NCkBAIC0zOTYsMTAgKzM5Myw3IEBAIHN0YXRpYyBpbnQgdXBkYXRlX21xZF9z
ZG1hKHN0cnVjdCBtcWRfbWFuYWdlciAqbW0sIHZvaWQgKm1xZCwNCiAJbS0+c2RtYV9lbmdpbmVf
aWQgPSBxLT5zZG1hX2VuZ2luZV9pZDsNCiAJbS0+c2RtYV9xdWV1ZV9pZCA9IHEtPnNkbWFfcXVl
dWVfaWQ7DQogDQotCXEtPmlzX2FjdGl2ZSA9IChxLT5xdWV1ZV9zaXplID4gMCAmJg0KLQkJCXEt
PnF1ZXVlX2FkZHJlc3MgIT0gMCAmJg0KLQkJCXEtPnF1ZXVlX3BlcmNlbnQgPiAwICYmDQotCQkJ
IXEtPmlzX2V2aWN0ZWQpOw0KKwlxLT5pc19hY3RpdmUgPSBRVUVVRV9JU19BQ1RJVkUoKnEpOw0K
IA0KIAlyZXR1cm4gMDsNCiB9DQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRr
ZmQva2ZkX3ByaXYuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wcml2LmgNCmlu
ZGV4IGI2MWRjNTNmNDJkMi4uNmQyOWQ1ODlhNGE1IDEwMDY0NA0KLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRrZmQva2ZkX3ByaXYuaA0KKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRr
ZmQva2ZkX3ByaXYuaA0KQEAgLTQzMCw2ICs0MzAsMTEgQEAgc3RydWN0IHF1ZXVlX3Byb3BlcnRp
ZXMgew0KIAl1aW50MzJfdCAqY3VfbWFzazsNCiB9Ow0KIA0KKyNkZWZpbmUgUVVFVUVfSVNfQUNU
SVZFKHEpICgocSkucXVldWVfc2l6ZSA+IDAgJiYJXA0KKwkJCSAgICAocSkucXVldWVfYWRkcmVz
cyAhPSAwICYmCVwNCisJCQkgICAgKHEpLnF1ZXVlX3BlcmNlbnQgPiAwICYmCVwNCisJCQkgICAg
IShxKS5pc19ldmljdGVkKQ0KKw0KIC8qKg0KICAqIHN0cnVjdCBxdWV1ZQ0KICAqDQotLSANCjIu
MTcuMQ0KDQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwph
bWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
