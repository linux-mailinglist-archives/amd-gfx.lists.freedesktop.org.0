Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D4A83A3C2F
	for <lists+amd-gfx@lfdr.de>; Fri, 30 Aug 2019 18:39:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 703A36E375;
	Fri, 30 Aug 2019 16:39:35 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-BN3-obe.outbound.protection.outlook.com
 (mail-eopbgr740043.outbound.protection.outlook.com [40.107.74.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 19AB08825B
 for <amd-gfx@lists.freedesktop.org>; Fri, 30 Aug 2019 16:39:34 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=QHLOMFLyG3W79omHKnj3y+N8xW75wpED2XxkRT1Santg8hc7WDs44pghZea+qGN0uypCha/KW3bi2NC8RmBRma3u5cmHjYJYXUIy7j9Tu40u75TBV/UwBJ6wtMBF7bMy6mSSJPsssvknPLl5VkwWO1wFLH5lVSXd/XHm2yaQZf8hu9KessxLae8O0w6ZIuWpClT/W90W0h4gg0lObadxElzjnhdgvkWmY4GPJGSbl5WRJ0UE5TavIa59NOn3mbBTeBTU6Ebe4Jteu7rc1/L3/41xDPd1sCPYtuPAJYhw6z75Ykb6YgVOxOEGqy0DGmwVtA1bS0wwxh0qno0/VjanxA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=mU9/39MCDNp5eFW8M6uDqSXCKdXT+eddUdvWmGLuqkA=;
 b=VtxgPrjugJUtFxkEZATFufUqdiP7vFXvvN4/Vc6LGZ9Qs3kNYPp3eCmDwi42AGm8lb0Oocz5h4INyftTbQRiChyGNlLMutg5TJxTNYDT0RSCNNa3DIOW8zxlm2WS3peqdTN6Eump8iZ0XBfO0ZHBVgZqc0evccLbXRKYkyIxB+fdzoXwnVlGYcPh7HqGd6kfDRL96HcrMwYspOeyrjcST0F/5Ne+cqPa2U69a+UnnZ+jylTHv9DKxE7JoTziz056xcb7Q6dcncmP8gQ6PIcI4O8KcnaU6HFssUzP8vlEhQaLcKy3cY54+Cp8HYyB8H1MEZbURQp5lq5Th4nIyNFe4g==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=gmail.com smtp.mailfrom=amd.com;
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from DM5PR12CA0021.namprd12.prod.outlook.com (2603:10b6:4:1::31) by
 BN8PR12MB3268.namprd12.prod.outlook.com (2603:10b6:408:6c::18) with
 Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2199.21; Fri, 30 Aug 2019 16:39:32 +0000
Received: from DM3NAM03FT007.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e49::202) by DM5PR12CA0021.outlook.office365.com
 (2603:10b6:4:1::31) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id 15.20.2220.19 via Frontend
 Transport; Fri, 30 Aug 2019 16:39:31 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV02.amd.com (165.204.84.17) by
 DM3NAM03FT007.mail.protection.outlook.com (10.152.82.68) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2220.16 via Frontend Transport; Fri, 30 Aug 2019 16:39:31 +0000
Received: from agrodzovsky-All-Series.amd.com (10.34.1.3) by
 SATLEXCHOV02.amd.com (10.181.40.72) with Microsoft SMTP Server id 14.3.389.1; 
 Fri, 30 Aug 2019 11:39:29 -0500
From: Andrey Grodzovsky <andrey.grodzovsky@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH v3 2/3] dmr/amdgpu: Avoid HW GPU reset for RAS.
Date: Fri, 30 Aug 2019 12:39:12 -0400
Message-ID: <1567183153-11014-2-git-send-email-andrey.grodzovsky@amd.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1567183153-11014-1-git-send-email-andrey.grodzovsky@amd.com>
References: <1567183153-11014-1-git-send-email-andrey.grodzovsky@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(39860400002)(136003)(376002)(396003)(346002)(2980300002)(428003)(189003)(199004)(8676002)(50226002)(81156014)(54906003)(81166006)(53416004)(70586007)(70206006)(7696005)(53936002)(316002)(426003)(26005)(51416003)(50466002)(30864003)(48376002)(47776003)(16586007)(36756003)(4326008)(14444005)(356004)(186003)(305945005)(5660300002)(2906002)(478600001)(11346002)(446003)(336012)(476003)(2616005)(6916009)(486006)(86362001)(76176011)(6666004)(2351001)(126002)(44832011)(8936002)(309714004);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN8PR12MB3268; H:SATLEXCHOV02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 56ddb7a1-d432-4db1-2591-08d72d68a22f
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600166)(711020)(4605104)(1401327)(4618075)(2017052603328);
 SRVR:BN8PR12MB3268; 
X-MS-TrafficTypeDiagnostic: BN8PR12MB3268:
X-Microsoft-Antispam-PRVS: <BN8PR12MB32686D5873977828F9905DF8EABD0@BN8PR12MB3268.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:949;
X-Forefront-PRVS: 0145758B1D
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: +T5Cojk//FsUC7Y8erdgzQ3XZzSgrbKQCYq7k/yXg8y95Nv38B3PmNxJ2PJpWYUDkuAQeBTB7JlvJpfHHOsmgYLCiZsKWMb7RRf90RbFs87KKoyFFAD6YYbgySPCgte7wtVoVVKmX7q1qoQ21AdGGmaaOtPtA7AeLAKuCJCdR0iPT+CHkzBEyRIHDdqaqIWaV4hIkdxnX2msLht7F9+FtH0T6AKjhMt2hiq1CBxeIJiVdYZI0u2yHG5ChsZZq5/VN462wfliE3uoLK6dJdZhAQ86Qro6VRymbsxMlQcn6YJNgkGNcPTpPRyJsdhyp3sitICMhqwtH2b8yIY8XIOLclcKNDAhJpwK6RNZ65fW1qBd0aQUraNfjx1d23QXKKMALWyzHZz32s8jDrH31m2p2DQzxRSzb5KmXL/FonN0mFQ=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 30 Aug 2019 16:39:31.4359 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 56ddb7a1-d432-4db1-2591-08d72d68a22f
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN8PR12MB3268
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=mU9/39MCDNp5eFW8M6uDqSXCKdXT+eddUdvWmGLuqkA=;
 b=gRxd4Q3DOEo0KLME22oS8oA6QYapt5XDl5H/c8uXhXYUupzg/gey+dnoAuUPJX/+qNlPLV+8K87sLFbxI5wvh9RKcl5v+VZSlmBJRefgY5Ga1aEr7s8zrxxuidp0GT1ChSJ1ptkEJ9czoSRb7yEEN90DDDRGNQjSSUK4RripINE=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; gmail.com; dkim=none (message not signed)
 header.d=none;gmail.com; dmarc=permerror action=none header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Andrey Grodzovsky <andrey.grodzovsky@amd.com>,
 ckoenig.leichtzumerken@gmail.com, Felix.Kuehling@amd.com, Tao.Zhou1@amd.com,
 alexdeucher@gmail.com, Hawking.Zhang@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

UHJvYmxlbToKVW5kZXIgY2VydGFpbiBjb25kaXRpb25zLCB3aGVuIHNvbWUgSVAgYm9ja3MgdGFr
ZSBhIFJBUyBlcnJvciwKd2UgY2FuIGdldCBpbnRvIGEgc2l0dWF0aW9uIHdoZXJlIGEgR1BVIHJl
c2V0IGlzIG5vdCBwb3NzaWJsZQpkdWUgdG8gaXNzdWVzIGluIFJBUyBpbiBTTVUvUFNQLgoKVGVt
cG9yYXJ5IGZpeCB1bnRpbCBwcm9wZXIgc29sdXRpb24gaW4gUFNQL1NNVSBpcyByZWFkeToKV2hl
biB1bmNvcnJlY3RhYmxlIGVycm9yIGhhcHBlbnMgdGhlIERGIHdpbGwgdW5jb25kaXRpb25hbGx5
CmJyb2FkY2FzdCBlcnJvciBldmVudCBwYWNrZXRzIHRvIGFsbCBpdHMgY2xpZW50cy9zbGF2ZSB1
cG9uCnJlY2VpdmluZyBmYXRhbCBlcnJvciBldmVudCBhbmQgZnJlZXplIGFsbCBpdHMgb3V0Ym91
bmQgcXVldWVzLAplcnJfZXZlbnRfYXRodWIgaW50ZXJydXB0ICB3aWxsIGJlIHRyaWdnZXJlZC4K
SW4gc3VjaCBjYXNlIGFuZCB3ZSB1c2UgdGhpcyBpbnRlcnJ1cHQKdG8gaXNzdWUgR1BVIHJlc2V0
LiBUSGUgR1BVIHJlc2V0IGNvZGUgaXMgbW9kaWZpZWQgZm9yIHN1Y2ggY2FzZSB0byBhdm9pZCBI
VwpyZXNldCwgb25seSBzdG9wcyBzY2hlZHVsZXJzLCBkZWF0Y2hlcyBhbGwgaW4gcHJvZ3Jlc3Mg
YW5kIG5vdCB5ZXQgc2NoZWR1bGVkCmpvYidzIGZlbmNlcywgc2V0IGVycm9yIGNvZGUgb24gdGhl
bSBhbmQgc2lnbmFscy4KQWxzbyByZWplY3QgYW55IG5ldyBpbmNvbWluZyBqb2Igc3VibWlzc2lv
bnMgZnJvbSB1c2VyIHNwYWNlLgpBbGwgdGhpcyBpcyBkb25lIHRvIG5vdGlmeSB0aGUgYXBwbGlj
YXRpb25zIG9mIHRoZSBwcm9ibGVtLgoKdjI6CkV4dHJhY3QgYW1kZ3B1X2FtZGtmZF9wcmUvcG9z
dF9yZXNldCBmcm9tIGFtZGdwdV9kZXZpY2VfbG9jay91bmxvY2tfYWRldgpNb3ZlIGFtZGdwdV9q
b2Jfc3RvcF9hbGxfam9ic19vbl9zY2hlZCB0byBhbWRncHVfam9iLmMKUmVtb3ZlIHByaW50IHBh
cmFtIGZyb20gYW1kZ3B1X3Jhc19xdWVyeV9lcnJvcl9jb3VudAoKdjM6ClVwZGF0ZSBiYXNlZCBv
biBwcmV2aW91cyBidWcgZml4aW5nIHBhdGNoIHRvIHByb3Blcmx5IGNhbGwgYW1kZ3B1X2FtZGtm
ZF9wcmVfcmVzZXQKZm9yIG90aGVyIFhHTUkgaGl2ZSBtZW1lYmVycy4KClNpZ25lZC1vZmYtYnk6
IEFuZHJleSBHcm9kem92c2t5IDxhbmRyZXkuZ3JvZHpvdnNreUBhbWQuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jICAgICB8ICA0ICsrKysKIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyB8IDM4ICsrKysrKysrKysrKysrKysr
KysrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jICAg
IHwgIDUgKysrKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5jICAgIHwg
MzggKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfam9iLmggICAgfCAgMyArKysKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9rbXMuYyAgICB8ICA2ICsrKysrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfcmFzLmMgICAgfCAyMiArKysrKysrKysrKysrKystLQogZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3Jhcy5oICAgIHwgMTAgKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2dmeF92OV8wLmMgICAgICB8IDEwICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9nbWNfdjlfMC5jICAgICAgfCAyNCArKysrKysrKysrLS0tLS0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9uYmlvX3Y3XzQuYyAgICAgfCAgNSArKysrCiBkcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9zZG1hX3Y0XzAuYyAgICAgfCAzMiArKysrKysrKysrKysrLS0t
LS0tLS0tLS0tCiAxMiBmaWxlcyBjaGFuZ2VkLCAxNTUgaW5zZXJ0aW9ucygrKSwgNDIgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Nz
LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYwppbmRleCBkODYwMTcw
Li40OTRjMzg0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
Y3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYwpAQCAtMzgs
NiArMzgsNyBAQAogI2luY2x1ZGUgImFtZGdwdV9nbWMuaCIKICNpbmNsdWRlICJhbWRncHVfZ2Vt
LmgiCiAjaW5jbHVkZSAiYW1kZ3B1X2Rpc3BsYXkuaCIKKyNpbmNsdWRlICJhbWRncHVfcmFzLmgi
CiAKIHN0YXRpYyBpbnQgYW1kZ3B1X2NzX3VzZXJfZmVuY2VfY2h1bmsoc3RydWN0IGFtZGdwdV9j
c19wYXJzZXIgKnAsCiAJCQkJICAgICAgc3RydWN0IGRybV9hbWRncHVfY3NfY2h1bmtfZmVuY2Ug
KmRhdGEsCkBAIC0xNDM4LDYgKzE0MzksOSBAQCBpbnQgYW1kZ3B1X2NzX2lvY3RsKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlscCkKIAlib29s
IHJlc2VydmVkX2J1ZmZlcnMgPSBmYWxzZTsKIAlpbnQgaSwgcjsKIAorCWlmIChhbWRncHVfcmFz
X2ludHJfdHJpZ2dlcmVkKCkpCisJCXJldHVybiAtRUhXUE9JU09OOworCiAJaWYgKCFhZGV2LT5h
Y2NlbF93b3JraW5nKQogCQlyZXR1cm4gLUVCVVNZOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZGV2aWNlLmMKaW5kZXggMTlmNjYyNC4uYzk4MjVhZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYwpAQCAtMzcyNywyNSArMzcyNywxOCBA
QCBzdGF0aWMgYm9vbCBhbWRncHVfZGV2aWNlX2xvY2tfYWRldihzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwgYm9vbCB0cnlsb2NrKQogCQlhZGV2LT5tcDFfc3RhdGUgPSBQUF9NUDFfU1RBVEVf
Tk9ORTsKIAkJYnJlYWs7CiAJfQotCS8qIEJsb2NrIGtmZDogU1JJT1Ygd291bGQgZG8gaXQgc2Vw
YXJhdGVseSAqLwotCWlmICghYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKQotICAgICAgICAgICAgICAg
IGFtZGdwdV9hbWRrZmRfcHJlX3Jlc2V0KGFkZXYpOwogCiAJcmV0dXJuIHRydWU7CiB9CiAKIHN0
YXRpYyB2b2lkIGFtZGdwdV9kZXZpY2VfdW5sb2NrX2FkZXYoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYpCiB7Ci0JLyp1bmxvY2sga2ZkOiBTUklPViB3b3VsZCBkbyBpdCBzZXBhcmF0ZWx5ICov
Ci0JaWYgKCFhbWRncHVfc3Jpb3ZfdmYoYWRldikpCi0gICAgICAgICAgICAgICAgYW1kZ3B1X2Ft
ZGtmZF9wb3N0X3Jlc2V0KGFkZXYpOwogCWFtZGdwdV92Zl9lcnJvcl90cmFuc19hbGwoYWRldik7
CiAJYWRldi0+bXAxX3N0YXRlID0gUFBfTVAxX1NUQVRFX05PTkU7CiAJYWRldi0+aW5fZ3B1X3Jl
c2V0ID0gMDsKIAltdXRleF91bmxvY2soJmFkZXYtPmxvY2tfcmVzZXQpOwogfQogCi0KIC8qKgog
ICogYW1kZ3B1X2RldmljZV9ncHVfcmVjb3ZlciAtIHJlc2V0IHRoZSBhc2ljIGFuZCByZWNvdmVy
IHNjaGVkdWxlcgogICoKQEAgLTM3NjUsMTEgKzM3NTgsMTIgQEAgaW50IGFtZGdwdV9kZXZpY2Vf
Z3B1X3JlY292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJc3RydWN0IGFtZGdwdV9o
aXZlX2luZm8gKmhpdmUgPSBOVUxMOwogCXN0cnVjdCBhbWRncHVfZGV2aWNlICp0bXBfYWRldiA9
IE5VTEw7CiAJaW50IGksIHIgPSAwOworCWJvb2wgaW5fcmFzX2ludHIgPSBhbWRncHVfcmFzX2lu
dHJfdHJpZ2dlcmVkKCk7CiAKIAluZWVkX2Z1bGxfcmVzZXQgPSBqb2Jfc2lnbmFsZWQgPSBmYWxz
ZTsKIAlJTklUX0xJU1RfSEVBRCgmZGV2aWNlX2xpc3QpOwogCi0JZGV2X2luZm8oYWRldi0+ZGV2
LCAiR1BVIHJlc2V0IGJlZ2luIVxuIik7CisJZGV2X2luZm8oYWRldi0+ZGV2LCAiR1BVICVzIGJl
Z2luIVxuIiwgaW5fcmFzX2ludHIgPyAiam9icyBzdG9wIjoicmVzZXQiKTsKIAogCWNhbmNlbF9k
ZWxheWVkX3dvcmtfc3luYygmYWRldi0+ZGVsYXllZF9pbml0X3dvcmspOwogCkBAIC0zNzk2LDkg
KzM3OTAsMTYgQEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1X3JlY292ZXIoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsCiAJCXJldHVybiAwOwogCX0KIAorCS8qIEJsb2NrIGtmZDogU1JJT1Ygd291
bGQgZG8gaXQgc2VwYXJhdGVseSAqLworCWlmICghYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKQorICAg
ICAgICAgICAgICAgIGFtZGdwdV9hbWRrZmRfcHJlX3Jlc2V0KGFkZXYpOworCiAJLyogQnVpbGQg
bGlzdCBvZiBkZXZpY2VzIHRvIHJlc2V0ICovCiAJaWYgIChhZGV2LT5nbWMueGdtaS5udW1fcGh5
c2ljYWxfbm9kZXMgPiAxKSB7CiAJCWlmICghaGl2ZSkgeworCQkJLyp1bmxvY2sga2ZkOiBTUklP
ViB3b3VsZCBkbyBpdCBzZXBhcmF0ZWx5ICovCisJCQlpZiAoIWFtZGdwdV9zcmlvdl92ZihhZGV2
KSkKKwkJICAgICAgICAgICAgICAgIGFtZGdwdV9hbWRrZmRfcG9zdF9yZXNldChhZGV2KTsKIAkJ
CWFtZGdwdV9kZXZpY2VfdW5sb2NrX2FkZXYoYWRldik7CiAJCQlyZXR1cm4gLUVOT0RFVjsKIAkJ
fQpAQCAtMzgxNiw4ICszODE3LDEyIEBAIGludCBhbWRncHVfZGV2aWNlX2dwdV9yZWNvdmVyKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCiAJLyogYmxvY2sgYWxsIHNjaGVkdWxlcnMgYW5k
IHJlc2V0IGdpdmVuIGpvYidzIHJpbmcgKi8KIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHRtcF9hZGV2
LCBkZXZpY2VfbGlzdF9oYW5kbGUsIGdtYy54Z21pLmhlYWQpIHsKLQkJaWYgKHRtcF9hZGV2ICE9
IGFkZXYpCisJCWlmICh0bXBfYWRldiAhPSBhZGV2KSB7CiAJCQlhbWRncHVfZGV2aWNlX2xvY2tf
YWRldih0bXBfYWRldiwgZmFsc2UpOworCQkJaWYgKCFhbWRncHVfc3Jpb3ZfdmYodG1wX2FkZXYp
KQorCQkJICAgICAgICAgICAgICAgIGFtZGdwdV9hbWRrZmRfcHJlX3Jlc2V0KHRtcF9hZGV2KTsK
KwkJfQorCiAJCS8qCiAJCSAqIE1hcmsgdGhlc2UgQVNJQ3MgdG8gYmUgcmVzZXRlZCBhcyB1bnRy
YWNrZWQgZmlyc3QKIAkJICogQW5kIGFkZCB0aGVtIGJhY2sgYWZ0ZXIgcmVzZXQgY29tcGxldGVk
CkBAIC0zODI1LDcgKzM4MzAsNyBAQCBpbnQgYW1kZ3B1X2RldmljZV9ncHVfcmVjb3ZlcihzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJYW1kZ3B1X3VucmVnaXN0ZXJfZ3B1X2luc3RhbmNl
KHRtcF9hZGV2KTsKIAogCQkvKiBkaXNhYmxlIHJhcyBvbiBBTEwgSVBzICovCi0JCWlmIChhbWRn
cHVfZGV2aWNlX2lwX25lZWRfZnVsbF9yZXNldCh0bXBfYWRldikpCisJCWlmICghaW5fcmFzX2lu
dHIgJiYgYW1kZ3B1X2RldmljZV9pcF9uZWVkX2Z1bGxfcmVzZXQodG1wX2FkZXYpKQogCQkJYW1k
Z3B1X3Jhc19zdXNwZW5kKHRtcF9hZGV2KTsKIAogCQlmb3IgKGkgPSAwOyBpIDwgQU1ER1BVX01B
WF9SSU5HUzsgKytpKSB7CkBAIC0zODM1LDEwICszODQwLDE2IEBAIGludCBhbWRncHVfZGV2aWNl
X2dwdV9yZWNvdmVyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkJCWNvbnRpbnVlOwog
CiAJCQlkcm1fc2NoZWRfc3RvcCgmcmluZy0+c2NoZWQsIGpvYiA/ICZqb2ItPmJhc2UgOiBOVUxM
KTsKKworCQkJaWYgKGluX3Jhc19pbnRyKQorCQkJCWFtZGdwdV9qb2Jfc3RvcF9hbGxfam9ic19v
bl9zY2hlZCgmcmluZy0+c2NoZWQpOwogCQl9CiAJfQogCiAKKwlpZiAoaW5fcmFzX2ludHIpCisJ
CWdvdG8gc2tpcF9zY2hlZF9yZXN1bWU7CisKIAkvKgogCSAqIE11c3QgY2hlY2sgZ3VpbHR5IHNp
Z25hbCBoZXJlIHNpbmNlIGFmdGVyIHRoaXMgcG9pbnQgYWxsIG9sZAogCSAqIEhXIGZlbmNlcyBh
cmUgZm9yY2Ugc2lnbmFsZWQuCkBAIC0zODk3LDYgKzM5MDgsNyBAQCBpbnQgYW1kZ3B1X2Rldmlj
ZV9ncHVfcmVjb3ZlcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAogCS8qIFBvc3QgQVNJ
QyByZXNldCBmb3IgYWxsIGRldnMgLiovCiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh0bXBfYWRldiwg
ZGV2aWNlX2xpc3RfaGFuZGxlLCBnbWMueGdtaS5oZWFkKSB7CisKIAkJZm9yIChpID0gMDsgaSA8
IEFNREdQVV9NQVhfUklOR1M7ICsraSkgewogCQkJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0g
dG1wX2FkZXYtPnJpbmdzW2ldOwogCkBAIC0zOTIzLDcgKzM5MzUsMTMgQEAgaW50IGFtZGdwdV9k
ZXZpY2VfZ3B1X3JlY292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCX0gZWxzZSB7
CiAJCQlkZXZfaW5mbyh0bXBfYWRldi0+ZGV2LCAiR1BVIHJlc2V0KCVkKSBzdWNjZWVkZWQhXG4i
LCBhdG9taWNfcmVhZCgmdG1wX2FkZXYtPmdwdV9yZXNldF9jb3VudGVyKSk7CiAJCX0KKwl9CiAK
K3NraXBfc2NoZWRfcmVzdW1lOgorCWxpc3RfZm9yX2VhY2hfZW50cnkodG1wX2FkZXYsIGRldmlj
ZV9saXN0X2hhbmRsZSwgZ21jLnhnbWkuaGVhZCkgeworCQkvKnVubG9jayBrZmQ6IFNSSU9WIHdv
dWxkIGRvIGl0IHNlcGFyYXRlbHkgKi8KKwkJaWYgKCFpbl9yYXNfaW50ciAmJiAhYW1kZ3B1X3Ny
aW92X3ZmKHRtcF9hZGV2KSkKKwkgICAgICAgICAgICAgICAgYW1kZ3B1X2FtZGtmZF9wb3N0X3Jl
c2V0KHRtcF9hZGV2KTsKIAkJYW1kZ3B1X2RldmljZV91bmxvY2tfYWRldih0bXBfYWRldik7CiAJ
fQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKaW5kZXggNzY3OWZlOC4u
YzczZDI2YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Ry
di5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYwpAQCAtNDAs
NiArNDAsOCBAQAogCiAjaW5jbHVkZSAiYW1kZ3B1X2FtZGtmZC5oIgogCisjaW5jbHVkZSAiYW1k
Z3B1X3Jhcy5oIgorCiAvKgogICogS01TIHdyYXBwZXIuCiAgKiAtIDMuMC4wIC0gaW5pdGlhbCBk
cml2ZXIKQEAgLTExODAsNiArMTE4Miw5IEBAIGFtZGdwdV9wY2lfc2h1dGRvd24oc3RydWN0IHBj
aV9kZXYgKnBkZXYpCiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHBjaV9nZXRfZHJ2ZGF0YShw
ZGV2KTsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRldi0+ZGV2X3ByaXZhdGU7CiAK
KwlpZiAoYW1kZ3B1X3Jhc19pbnRyX3RyaWdnZXJlZCgpKQorCQlyZXR1cm47CisKIAkvKiBpZiB3
ZSBhcmUgcnVubmluZyBpbiBhIFZNLCBtYWtlIHN1cmUgdGhlIGRldmljZQogCSAqIHRvcm4gZG93
biBwcm9wZXJseSBvbiByZWJvb3Qvc2h1dGRvd24uCiAJICogdW5mb3J0dW5hdGVseSB3ZSBjYW4n
dCBkZXRlY3QgY2VydGFpbgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2pvYi5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5jCmlu
ZGV4IDRkNjdiNzcuLmIxMjk4MWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9qb2IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
am9iLmMKQEAgLTI1MCw2ICsyNTAsNDQgQEAgc3RhdGljIHN0cnVjdCBkbWFfZmVuY2UgKmFtZGdw
dV9qb2JfcnVuKHN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2IpCiAJcmV0dXJuIGZlbmNl
OwogfQogCisjZGVmaW5lIHRvX2RybV9zY2hlZF9qb2Ioc2NoZWRfam9iKQkJXAorCQljb250YWlu
ZXJfb2YoKHNjaGVkX2pvYiksIHN0cnVjdCBkcm1fc2NoZWRfam9iLCBxdWV1ZV9ub2RlKQorCit2
b2lkIGFtZGdwdV9qb2Jfc3RvcF9hbGxfam9ic19vbl9zY2hlZChzdHJ1Y3QgZHJtX2dwdV9zY2hl
ZHVsZXIgKnNjaGVkKQoreworCXN0cnVjdCBkcm1fc2NoZWRfam9iICpzX2pvYjsKKwlzdHJ1Y3Qg
ZHJtX3NjaGVkX2VudGl0eSAqc19lbnRpdHkgPSBOVUxMOworCWludCBpOworCisJLyogU2lnbmFs
IGFsbCBqb2JzIG5vdCB5ZXQgc2NoZWR1bGVkICovCisJZm9yIChpID0gRFJNX1NDSEVEX1BSSU9S
SVRZX01BWCAtIDE7IGkgPj0gRFJNX1NDSEVEX1BSSU9SSVRZX01JTjsgaS0tKSB7CisJCXN0cnVj
dCBkcm1fc2NoZWRfcnEgKnJxID0gJnNjaGVkLT5zY2hlZF9ycVtpXTsKKworCQlpZiAoIXJxKQor
CQkJY29udGludWU7CisKKwkJc3Bpbl9sb2NrKCZycS0+bG9jayk7CisJCWxpc3RfZm9yX2VhY2hf
ZW50cnkoc19lbnRpdHksICZycS0+ZW50aXRpZXMsIGxpc3QpIHsKKwkJCXdoaWxlICgoc19qb2Ig
PSB0b19kcm1fc2NoZWRfam9iKHNwc2NfcXVldWVfcG9wKCZzX2VudGl0eS0+am9iX3F1ZXVlKSkp
KSB7CisJCQkJc3RydWN0IGRybV9zY2hlZF9mZW5jZSAqc19mZW5jZSA9IHNfam9iLT5zX2ZlbmNl
OworCisJCQkJZG1hX2ZlbmNlX3NpZ25hbCgmc19mZW5jZS0+c2NoZWR1bGVkKTsKKwkJCQlkbWFf
ZmVuY2Vfc2V0X2Vycm9yKCZzX2ZlbmNlLT5maW5pc2hlZCwgLUVIV1BPSVNPTik7CisJCQkJZG1h
X2ZlbmNlX3NpZ25hbCgmc19mZW5jZS0+ZmluaXNoZWQpOworCQkJfQorCQl9CisJCXNwaW5fdW5s
b2NrKCZycS0+bG9jayk7CisJfQorCisJLyogU2lnbmFsIGFsbCBqb2JzIGFscmVhZHkgc2NoZWR1
bGVkIHRvIEhXICovCisJbGlzdF9mb3JfZWFjaF9lbnRyeShzX2pvYiwgJnNjaGVkLT5yaW5nX21p
cnJvcl9saXN0LCBub2RlKSB7CisJCXN0cnVjdCBkcm1fc2NoZWRfZmVuY2UgKnNfZmVuY2UgPSBz
X2pvYi0+c19mZW5jZTsKKworCQlkbWFfZmVuY2Vfc2V0X2Vycm9yKCZzX2ZlbmNlLT5maW5pc2hl
ZCwgLUVIV1BPSVNPTik7CisJCWRtYV9mZW5jZV9zaWduYWwoJnNfZmVuY2UtPmZpbmlzaGVkKTsK
Kwl9Cit9CisKIGNvbnN0IHN0cnVjdCBkcm1fc2NoZWRfYmFja2VuZF9vcHMgYW1kZ3B1X3NjaGVk
X29wcyA9IHsKIAkuZGVwZW5kZW5jeSA9IGFtZGdwdV9qb2JfZGVwZW5kZW5jeSwKIAkucnVuX2pv
YiA9IGFtZGdwdV9qb2JfcnVuLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2pvYi5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5o
CmluZGV4IDUxZTYyNTAuLmRjN2VlOTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9qb2IuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfam9iLmgKQEAgLTc2LDQgKzc2LDcgQEAgaW50IGFtZGdwdV9qb2Jfc3VibWl0KHN0cnVjdCBh
bWRncHVfam9iICpqb2IsIHN0cnVjdCBkcm1fc2NoZWRfZW50aXR5ICplbnRpdHksCiAJCSAgICAg
IHZvaWQgKm93bmVyLCBzdHJ1Y3QgZG1hX2ZlbmNlICoqZik7CiBpbnQgYW1kZ3B1X2pvYl9zdWJt
aXRfZGlyZWN0KHN0cnVjdCBhbWRncHVfam9iICpqb2IsIHN0cnVjdCBhbWRncHVfcmluZyAqcmlu
ZywKIAkJCSAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKTsKKwordm9pZCBhbWRncHVfam9i
X3N0b3BfYWxsX2pvYnNfb25fc2NoZWQoc3RydWN0IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCk7
CisKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2ttcy5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jCmluZGV4IDM1
YTA4NjYuLjUzNWY2OTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9rbXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMK
QEAgLTEwNDYsNiArMTA0NiwxMiBAQCBpbnQgYW1kZ3B1X2RyaXZlcl9vcGVuX2ttcyhzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKIAkvKiBFbnN1cmUg
SUIgdGVzdHMgYXJlIHJ1biBvbiByaW5nICovCiAJZmx1c2hfZGVsYXllZF93b3JrKCZhZGV2LT5k
ZWxheWVkX2luaXRfd29yayk7CiAKKworCWlmIChhbWRncHVfcmFzX2ludHJfdHJpZ2dlcmVkKCkp
IHsKKwkJRFJNX0VSUk9SKCJSQVMgSW50ciB0cmlnZ2VyZWQsIGRldmljZSBkaXNhYmxlZCEhIik7
CisJCXJldHVybiAtRUhXUE9JU09OOworCX0KKwogCWZpbGVfcHJpdi0+ZHJpdmVyX3ByaXYgPSBO
VUxMOwogCiAJciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGV2LT5kZXYpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Jhcy5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3Jhcy5jCmluZGV4IGFhNTFjMDAuLjFjYzM0ZGUgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmMKQEAgLTI0LDYgKzI0LDggQEAKICNpbmNs
dWRlIDxsaW51eC9kZWJ1Z2ZzLmg+CiAjaW5jbHVkZSA8bGludXgvbGlzdC5oPgogI2luY2x1ZGUg
PGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4L3JlYm9vdC5oPgorI2luY2x1ZGUgPGxp
bnV4L3N5c2NhbGxzLmg+CiAjaW5jbHVkZSAiYW1kZ3B1LmgiCiAjaW5jbHVkZSAiYW1kZ3B1X3Jh
cy5oIgogI2luY2x1ZGUgImFtZGdwdV9hdG9tZmlybXdhcmUuaCIKQEAgLTY0LDYgKzY2LDkgQEAg
Y29uc3QgY2hhciAqcmFzX2Jsb2NrX3N0cmluZ1tdID0gewogLyogaW5qZWN0IGFkZHJlc3MgaXMg
NTIgYml0cyAqLwogI2RlZmluZQlSQVNfVU1DX0lOSkVDVF9BRERSX0xJTUlUCSgweDFVTEwgPDwg
NTIpCiAKKworYXRvbWljX3QgYW1kZ3B1X3Jhc19pbl9pbnRyID0gQVRPTUlDX0lOSVQoMCk7CisK
IHN0YXRpYyBpbnQgYW1kZ3B1X3Jhc19yZXNlcnZlX3ZyYW0oc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYsCiAJCXVpbnQ2NF90IG9mZnNldCwgdWludDY0X3Qgc2l6ZSwKIAkJc3RydWN0IGFtZGdw
dV9ibyAqKmJvX3B0cik7CkBAIC0xODgsNiArMTkzLDEwIEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Jh
c19kZWJ1Z2ZzX2N0cmxfcGFyc2VfZGF0YShzdHJ1Y3QgZmlsZSAqZiwKIAogCXJldHVybiAwOwog
fQorCitzdGF0aWMgc3RydWN0IHJhc19tYW5hZ2VyICphbWRncHVfcmFzX2ZpbmRfb2JqKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2LAorCQlzdHJ1Y3QgcmFzX2NvbW1vbl9pZiAqaGVhZCk7CisK
IC8qKgogICogRE9DOiBBTURHUFUgUkFTIGRlYnVnZnMgY29udHJvbCBpbnRlcmZhY2UKICAqCkBA
IC02MjcsMTIgKzYzNiwxNCBAQCBpbnQgYW1kZ3B1X3Jhc19lcnJvcl9xdWVyeShzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKIAlpbmZvLT51ZV9jb3VudCA9IG9iai0+ZXJyX2RhdGEudWVfY291
bnQ7CiAJaW5mby0+Y2VfY291bnQgPSBvYmotPmVycl9kYXRhLmNlX2NvdW50OwogCi0JaWYgKGVy
cl9kYXRhLmNlX2NvdW50KQorCWlmIChlcnJfZGF0YS5jZV9jb3VudCkgewogCQlkZXZfaW5mbyhh
ZGV2LT5kZXYsICIlbGQgY29ycmVjdGFibGUgZXJyb3JzIGRldGVjdGVkIGluICVzIGJsb2NrXG4i
LAogCQkJIG9iai0+ZXJyX2RhdGEuY2VfY291bnQsIHJhc19ibG9ja19zdHIoaW5mby0+aGVhZC5i
bG9jaykpOwotCWlmIChlcnJfZGF0YS51ZV9jb3VudCkKKwl9CisJaWYgKGVycl9kYXRhLnVlX2Nv
dW50KSB7CiAJCWRldl9pbmZvKGFkZXYtPmRldiwgIiVsZCB1bmNvcnJlY3RhYmxlIGVycm9ycyBk
ZXRlY3RlZCBpbiAlcyBibG9ja1xuIiwKIAkJCSBvYmotPmVycl9kYXRhLnVlX2NvdW50LCByYXNf
YmxvY2tfc3RyKGluZm8tPmhlYWQuYmxvY2spKTsKKwl9CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE3
MTgsMyArMTcyOSwxMCBAQCBpbnQgYW1kZ3B1X3Jhc19maW5pKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2KQogCiAJcmV0dXJuIDA7CiB9CisKK3ZvaWQgYW1kZ3B1X3Jhc19nbG9iYWxfcmFzX2lz
cihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKK3sKKwlpZiAoYXRvbWljX2NtcHhjaGcoJmFt
ZGdwdV9yYXNfaW5faW50ciwgMCwgMSkgPT0gMCkgeworCQlEUk1fV0FSTigiUkFTIGV2ZW50IG9m
IHR5cGUgRVJSRVZFTlRfQVRIVUJfSU5URVJSVVBUIGRldGVjdGVkISBTdG9wcGluZyBhbGwgR1BV
IGpvYnMuXG4iKTsKKwl9Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfcmFzLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmgK
aW5kZXggZmM0ZmIwZi4uM2VjMmE4NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X3Jhcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9yYXMuaApAQCAtNjAwLDQgKzYwMCwxNCBAQCBpbnQgYW1kZ3B1X3Jhc19pbnRlcnJ1cHRfcmVt
b3ZlX2hhbmRsZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAKIGludCBhbWRncHVfcmFz
X2ludGVycnVwdF9kaXNwYXRjaChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJc3RydWN0
IHJhc19kaXNwYXRjaF9pZiAqaW5mbyk7CisKK2V4dGVybiBhdG9taWNfdCBhbWRncHVfcmFzX2lu
X2ludHI7CisKK3N0YXRpYyBpbmxpbmUgYm9vbCBhbWRncHVfcmFzX2ludHJfdHJpZ2dlcmVkKHZv
aWQpCit7CisJcmV0dXJuICEhYXRvbWljX3JlYWQoJmFtZGdwdV9yYXNfaW5faW50cik7Cit9CisK
K3ZvaWQgYW1kZ3B1X3Jhc19nbG9iYWxfcmFzX2lzcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
dik7CisKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4
X3Y5XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKaW5kZXggOTNl
M2U4OS4uODE3OTk3YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4
X3Y5XzAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjlfMC5jCkBAIC01
Njc2LDEwICs1Njc2LDEyIEBAIHN0YXRpYyBpbnQgZ2Z4X3Y5XzBfcHJvY2Vzc19yYXNfZGF0YV9j
YihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJc3RydWN0IGFtZGdwdV9pdl9lbnRyeSAq
ZW50cnkpCiB7CiAJLyogVE9ETyB1ZSB3aWxsIHRyaWdnZXIgYW4gaW50ZXJydXB0LiAqLwotCWtn
ZDJrZmRfc2V0X3NyYW1fZWNjX2ZsYWcoYWRldi0+a2ZkLmRldik7Ci0JaWYgKGFkZXYtPmdmeC5m
dW5jcy0+cXVlcnlfcmFzX2Vycm9yX2NvdW50KQotCQlhZGV2LT5nZnguZnVuY3MtPnF1ZXJ5X3Jh
c19lcnJvcl9jb3VudChhZGV2LCBlcnJfZGF0YSk7Ci0JYW1kZ3B1X3Jhc19yZXNldF9ncHUoYWRl
diwgMCk7CisJaWYgKCFhbWRncHVfcmFzX2lzX3N1cHBvcnRlZChhZGV2LCBBTURHUFVfUkFTX0JM
T0NLX19HRlgpKSB7CisJCWtnZDJrZmRfc2V0X3NyYW1fZWNjX2ZsYWcoYWRldi0+a2ZkLmRldik7
CisJCWlmIChhZGV2LT5nZnguZnVuY3MtPnF1ZXJ5X3Jhc19lcnJvcl9jb3VudCkKKwkJCWFkZXYt
PmdmeC5mdW5jcy0+cXVlcnlfcmFzX2Vycm9yX2NvdW50KGFkZXYsIGVycl9kYXRhKTsKKwkJYW1k
Z3B1X3Jhc19yZXNldF9ncHUoYWRldiwgMCk7CisJfQogCXJldHVybiBBTURHUFVfUkFTX1NVQ0NF
U1M7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8w
LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjlfMC5jCmluZGV4IDVlYjE3Yzcu
LjJhNmFjNjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8w
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYwpAQCAtMjQzLDE4
ICsyNDMsMjAgQEAgc3RhdGljIGludCBnbWNfdjlfMF9wcm9jZXNzX3Jhc19kYXRhX2NiKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2LAogCQlzdHJ1Y3QgcmFzX2Vycl9kYXRhICplcnJfZGF0YSwK
IAkJc3RydWN0IGFtZGdwdV9pdl9lbnRyeSAqZW50cnkpCiB7Ci0Ja2dkMmtmZF9zZXRfc3JhbV9l
Y2NfZmxhZyhhZGV2LT5rZmQuZGV2KTsKLQlpZiAoYWRldi0+dW1jLmZ1bmNzLT5xdWVyeV9yYXNf
ZXJyb3JfY291bnQpCi0JCWFkZXYtPnVtYy5mdW5jcy0+cXVlcnlfcmFzX2Vycm9yX2NvdW50KGFk
ZXYsIGVycl9kYXRhKTsKLQkvKiB1bWMgcXVlcnlfcmFzX2Vycm9yX2FkZHJlc3MgaXMgYWxzbyBy
ZXNwb25zaWJsZSBmb3IgY2xlYXJpbmcKLQkgKiBlcnJvciBzdGF0dXMKLQkgKi8KLQlpZiAoYWRl
di0+dW1jLmZ1bmNzLT5xdWVyeV9yYXNfZXJyb3JfYWRkcmVzcykKLQkJYWRldi0+dW1jLmZ1bmNz
LT5xdWVyeV9yYXNfZXJyb3JfYWRkcmVzcyhhZGV2LCBlcnJfZGF0YSk7CisJaWYgKCFhbWRncHVf
cmFzX2lzX3N1cHBvcnRlZChhZGV2LCBBTURHUFVfUkFTX0JMT0NLX19HRlgpKSB7CisJCWtnZDJr
ZmRfc2V0X3NyYW1fZWNjX2ZsYWcoYWRldi0+a2ZkLmRldik7CisJCWlmIChhZGV2LT51bWMuZnVu
Y3MtPnF1ZXJ5X3Jhc19lcnJvcl9jb3VudCkKKwkJCWFkZXYtPnVtYy5mdW5jcy0+cXVlcnlfcmFz
X2Vycm9yX2NvdW50KGFkZXYsIGVycl9kYXRhKTsKKwkJLyogdW1jIHF1ZXJ5X3Jhc19lcnJvcl9h
ZGRyZXNzIGlzIGFsc28gcmVzcG9uc2libGUgZm9yIGNsZWFyaW5nCisJCSAqIGVycm9yIHN0YXR1
cworCQkgKi8KKwkJaWYgKGFkZXYtPnVtYy5mdW5jcy0+cXVlcnlfcmFzX2Vycm9yX2FkZHJlc3Mp
CisJCQlhZGV2LT51bWMuZnVuY3MtPnF1ZXJ5X3Jhc19lcnJvcl9hZGRyZXNzKGFkZXYsIGVycl9k
YXRhKTsKIAotCS8qIG9ubHkgdW5jb3JyZWN0YWJsZSBlcnJvciBuZWVkcyBncHUgcmVzZXQgKi8K
LQlpZiAoZXJyX2RhdGEtPnVlX2NvdW50KQotCQlhbWRncHVfcmFzX3Jlc2V0X2dwdShhZGV2LCAw
KTsKKwkJLyogb25seSB1bmNvcnJlY3RhYmxlIGVycm9yIG5lZWRzIGdwdSByZXNldCAqLworCQlp
ZiAoZXJyX2RhdGEtPnVlX2NvdW50KQorCQkJYW1kZ3B1X3Jhc19yZXNldF9ncHUoYWRldiwgMCk7
CisJfQogCiAJcmV0dXJuIEFNREdQVV9SQVNfU1VDQ0VTUzsKIH0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L25iaW9fdjdfNC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvbmJpb192N180LmMKaW5kZXggMzY3ZjlkNi4uNTQ1OTkwYyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvbmJpb192N180LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvbmJpb192N180LmMKQEAgLTMwLDYgKzMwLDcgQEAKICNpbmNsdWRlICJuYmlv
L25iaW9fN180XzBfc21uLmgiCiAjaW5jbHVkZSAiaXZzcmNpZC9uYmlvL2lycXNyY3NfbmJpZl83
XzQuaCIKICNpbmNsdWRlIDx1YXBpL2xpbnV4L2tmZF9pb2N0bC5oPgorI2luY2x1ZGUgImFtZGdw
dV9yYXMuaCIKIAogI2RlZmluZSBzbW5OQklGX01HQ0dfQ1RSTF9MQ0xLCTB4MTAxM2EyMWMKIApA
QCAtMzI5LDYgKzMzMCw4IEBAIHN0YXRpYyB2b2lkIG5iaW9fdjdfNF9oYW5kbGVfcmFzX2NvbnRy
b2xsZXJfaW50cl9ub19iaWZyaW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlCiAJCQkJCQlCSUZfRE9P
UkJFTExfSU5UX0NOVEwsCiAJCQkJCQlSQVNfQ05UTFJfSU5URVJSVVBUX0NMRUFSLCAxKTsKIAkJ
V1JFRzMyX1NPQzE1KE5CSU8sIDAsIG1tQklGX0RPT1JCRUxMX0lOVF9DTlRMLCBiaWZfZG9vcmJl
bGxfaW50cl9jbnRsKTsKKworCQlhbWRncHVfcmFzX2dsb2JhbF9yYXNfaXNyKGFkZXYpOwogCX0K
IH0KIApAQCAtMzQ0LDYgKzM0Nyw4IEBAIHN0YXRpYyB2b2lkIG5iaW9fdjdfNF9oYW5kbGVfcmFz
X2Vycl9ldmVudF9hdGh1Yl9pbnRyX25vX2JpZnJpbmcoc3RydWN0IGFtZGdwdV9kCiAJCQkJCQlC
SUZfRE9PUkJFTExfSU5UX0NOVEwsCiAJCQkJCQlSQVNfQVRIVUJfRVJSX0VWRU5UX0lOVEVSUlVQ
VF9DTEVBUiwgMSk7CiAJCVdSRUczMl9TT0MxNShOQklPLCAwLCBtbUJJRl9ET09SQkVMTF9JTlRf
Q05UTCwgYmlmX2Rvb3JiZWxsX2ludHJfY250bCk7CisKKwkJYW1kZ3B1X3Jhc19nbG9iYWxfcmFz
X2lzcihhZGV2KTsKIAl9CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L3NkbWFfdjRfMC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2RtYV92NF8wLmMK
aW5kZXggYjNlZDUzMy4uYjA1NDI4ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvc2RtYV92NF8wLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2RtYV92
NF8wLmMKQEAgLTE5NzIsMjQgKzE5NzIsMjYgQEAgc3RhdGljIGludCBzZG1hX3Y0XzBfcHJvY2Vz
c19yYXNfZGF0YV9jYihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAl1aW50MzJfdCBlcnJf
c291cmNlOwogCWludCBpbnN0YW5jZTsKIAotCWluc3RhbmNlID0gc2RtYV92NF8wX2lycV9pZF90
b19zZXEoZW50cnktPmNsaWVudF9pZCk7Ci0JaWYgKGluc3RhbmNlIDwgMCkKLQkJcmV0dXJuIDA7
CisJaWYgKCFhbWRncHVfcmFzX2lzX3N1cHBvcnRlZChhZGV2LCBBTURHUFVfUkFTX0JMT0NLX19H
RlgpKSB7CisJCWluc3RhbmNlID0gc2RtYV92NF8wX2lycV9pZF90b19zZXEoZW50cnktPmNsaWVu
dF9pZCk7CisJCWlmIChpbnN0YW5jZSA8IDApCisJCQlyZXR1cm4gMDsKIAotCXN3aXRjaCAoZW50
cnktPnNyY19pZCkgewotCWNhc2UgU0RNQTBfNF8wX19TUkNJRF9fU0RNQV9TUkFNX0VDQzoKLQkJ
ZXJyX3NvdXJjZSA9IDA7Ci0JCWJyZWFrOwotCWNhc2UgU0RNQTBfNF8wX19TUkNJRF9fU0RNQV9F
Q0M6Ci0JCWVycl9zb3VyY2UgPSAxOwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlyZXR1cm4gMDsK
LQl9CisJCXN3aXRjaCAoZW50cnktPnNyY19pZCkgeworCQljYXNlIFNETUEwXzRfMF9fU1JDSURf
X1NETUFfU1JBTV9FQ0M6CisJCQllcnJfc291cmNlID0gMDsKKwkJCWJyZWFrOworCQljYXNlIFNE
TUEwXzRfMF9fU1JDSURfX1NETUFfRUNDOgorCQkJZXJyX3NvdXJjZSA9IDE7CisJCQlicmVhazsK
KwkJZGVmYXVsdDoKKwkJCXJldHVybiAwOworCQl9CiAKLQlrZ2Qya2ZkX3NldF9zcmFtX2VjY19m
bGFnKGFkZXYtPmtmZC5kZXYpOworCQlrZ2Qya2ZkX3NldF9zcmFtX2VjY19mbGFnKGFkZXYtPmtm
ZC5kZXYpOwogCi0JYW1kZ3B1X3Jhc19yZXNldF9ncHUoYWRldiwgMCk7CisJCWFtZGdwdV9yYXNf
cmVzZXRfZ3B1KGFkZXYsIDApOworCX0KIAogCXJldHVybiBBTURHUFVfUkFTX1NVQ0NFU1M7CiB9
Ci0tIAoyLjcuNAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
