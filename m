Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3343AEB2FF
	for <lists+amd-gfx@lfdr.de>; Thu, 31 Oct 2019 15:42:54 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 35D5D6EEB0;
	Thu, 31 Oct 2019 14:42:51 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-BN3-obe.outbound.protection.outlook.com
 (mail-eopbgr740070.outbound.protection.outlook.com [40.107.74.70])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ED2156EEB7
 for <amd-gfx@lists.freedesktop.org>; Thu, 31 Oct 2019 14:42:49 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=Bm7AGD/4V9qvKLbBjG3voOkSZjSiPByCcSBU/nXdRZK4u3MD2GIXRGNopFK8UGL9o9NmYqoqqbU2zQdWAkN1wDzZauezb0Vac52zeyOwNXK8s+Yj4xns2Qov9s/sDF5jSY8SQVJQlk4L/ci7brDhGXCfBIPsJDdsoyD76cynCeYjZT29KxBpxqD8lWXRA3NxI8+9z1dlqrn3pLivmNLnS5Bih10KJ/1ASArQJd3n2ZWGfxSD9RAZDrwDZXimMTfY0SnzkNnpmCVjqnEYT1Qfk/9HCDq2N+HMYA1ZGKHiojpGq8jkLRGC4CCwzwtQVUhnmJBUtPMfBa09wqCtHZwbng==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=qoawNgmrk1l/I/sqHMhr+V/hDVn9NEMjb7SA7s4vrq4=;
 b=l23gyjUXx8dB6XIibASoP8QvIGhs/hSXvkrmoyjlfdWXmWPbRsJR0qCIXz7Jpty/jFd0YZeMWH7ZNitUVn7Sk0de/ewkc1HgMGKirim9aiPQH/f3uLD17wckPibazbptfp1wtCBzGSAji05PHDiQaam/SHC0rQ8B/B0EjKN7ZLwiNOHKk9sbNP3REr99bFOp/CftlMVkAIZKco0Guq7cTnjc90JUIqgIVbXURpslwEzFd9hHGIc52q8lnexe//ZzH8CBbquVjICTDrsQZA/YfC2wnEzLAay0NtyVFuWHV8koBrfSc0hmnmX2fAMGbWdzhJXLUlTMHMtjpQd8yrGijA==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org smtp.mailfrom=amd.com; 
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from MWHPR1201CA0001.namprd12.prod.outlook.com
 (2603:10b6:301:4a::11) by BL0PR12MB2385.namprd12.prod.outlook.com
 (2603:10b6:207:4d::15) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2387.24; Thu, 31 Oct
 2019 14:42:47 +0000
Received: from DM3NAM03FT046.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e49::204) by MWHPR1201CA0001.outlook.office365.com
 (2603:10b6:301:4a::11) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2408.21 via Frontend
 Transport; Thu, 31 Oct 2019 14:42:47 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXMB02.amd.com (165.204.84.17) by
 DM3NAM03FT046.mail.protection.outlook.com (10.152.83.87) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.20.2387.20 via Frontend Transport; Thu, 31 Oct 2019 14:42:47 +0000
Received: from SATLEXMB02.amd.com (10.181.40.143) by SATLEXMB02.amd.com
 (10.181.40.143) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1713.5; Thu, 31 Oct
 2019 09:42:42 -0500
Received: from blakha.amd.com (10.180.168.240) by SATLEXMB02.amd.com
 (10.181.40.143) with Microsoft SMTP Server id 15.1.1713.5 via Frontend
 Transport; Thu, 31 Oct 2019 09:42:42 -0500
From: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 18/20] drm/amd/display: implement lttpr logic
Date: Thu, 31 Oct 2019 10:42:08 -0400
Message-ID: <20191031144210.24011-19-Bhawanpreet.Lakha@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191031144210.24011-1-Bhawanpreet.Lakha@amd.com>
References: <20191031144210.24011-1-Bhawanpreet.Lakha@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(136003)(39860400002)(346002)(376002)(396003)(428003)(189003)(199004)(30864003)(19627235002)(305945005)(478600001)(86362001)(426003)(336012)(316002)(2351001)(14444005)(48376002)(50466002)(50226002)(16586007)(8936002)(126002)(26005)(36756003)(81166006)(81156014)(186003)(70206006)(5660300002)(1076003)(53416004)(486006)(476003)(2906002)(6666004)(70586007)(356004)(51416003)(2616005)(11346002)(446003)(47776003)(76176011)(7696005)(8676002)(6916009)(4326008);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BL0PR12MB2385; H:SATLEXMB02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 16731b3b-005c-43c3-dcc5-08d75e1098e0
X-MS-TrafficTypeDiagnostic: BL0PR12MB2385:
X-Microsoft-Antispam-PRVS: <BL0PR12MB238588EFF4506C039D7A5188F9630@BL0PR12MB2385.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:4714;
X-Forefront-PRVS: 02070414A1
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: dIBFVjYM3B6e18i507Wgn0SB6mDZNYLdilrj5ybGesewC+0tiPkvqTZh/wpyXqSleL1dYmjaSlghijcmKP3WAP72nGMQyegKv6Fs+ZyH8DZDZXdVN3RqPhPMHSjwH88xIqKXYhHoThl/QYTm8xPSPQIqs1bDj/vW28SRURHuHm11/dQ4F0Af+Hxh0hzaTDIR39/b4jUaCmVtrEwsweCJ/DkhpMD9s4azbnGmKPkEWYKStT8ovDJEM7bxgPoBmbdydUT6dbRocqp+pgxyNHLCTDDKWAKuCq3VWH0psP3RWKe5VNSPlM7FDlMJuZPjN3F9ah3O7JGIBK6hHWSegAXuTiQqJOOB3S4eljBSRUMs69EkIE3yC1HboQzDblRqHFMx5JFLL3Ddx4mbiv1ZIaTZAqan1dOepz3uuNllQzoSDnKZOI0dyw2uKL61VMvPRKf4
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 31 Oct 2019 14:42:47.2584 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 16731b3b-005c-43c3-dcc5-08d75e1098e0
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXMB02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BL0PR12MB2385
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=qoawNgmrk1l/I/sqHMhr+V/hDVn9NEMjb7SA7s4vrq4=;
 b=pk2aRoKiLLiy4hyMnJ77t6lF0f2BYlaozsPfCjU77ZhsJsDthOGXDMpWhRfmTb0aT267x0b1NjqrcYQ7f0zOlHNUrWk8xC5U4R2cxQpRPYXP/tK6wvIXcGyxiXbeZ11np6YtlSOTl522ebKO1BwPZUV3MyGMUlbFGI2WSWaAD1o=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: abdoulaye berthe <abdoulaye.berthe@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogYWJkb3VsYXllIGJlcnRoZSA8YWJkb3VsYXllLmJlcnRoZUBhbWQuY29tPgoKMS1JZiBh
dCBsZWFzdCBvbmUgcmVwZWF0ZXIgaXMgcHJlc2VudCBpbiB0aGUgbGluayBhbmQgd2UgYXJlIGlu
IG5vbgp0cmFuc3BhcmVudCBtb2RlLCBwZXJmb3JtIGNsb2NrIHJlY292ZXJ5IHRoZW4gY2hhbm5l
bCBlcXVhbGl6YXRpb24Kd2l0aCBhbGwgcmVwZWF0ZXJzIG9uZSBieSBvbmUgYmVmb3JlIHRyYWlu
aW5nIERQUlguCgoyLU1hcmsgdGhlIGVuZCBvZiBMVCB3aXRoIGEgcmVwZWF0ZXIgYnkgc2V0dGlu
ZyB0cmFpbmluZyBwYXR0ZXJuIDAKYXQgdGhlIGVuZCBvZiBjaGFubmVsIGVxdWFsaXphdGlvbiB3
aXRoIGVhY2ggcmVwZWF0ZXIuCgpTaWduZWQtb2ZmLWJ5OiBhYmRvdWxheWUgYmVydGhlIDxhYmRv
dWxheWUuYmVydGhlQGFtZC5jb20+ClJldmlld2VkLWJ5OiBBcmljIEN5ciA8QXJpYy5DeXJAYW1k
LmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9jb3JlL2RjX2xpbmtfZHAuYyAg
fCAzMTkgKysrKysrKysrKysrKystLS0tCiAuLi4vZHJtL2FtZC9kaXNwbGF5L2RjL2NvcmUvZGNf
bGlua19od3NzLmMgICAgfCAgMzkgKystCiAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9pbmMv
bGlua19od3NzLmggICAgfCAgIDYgKy0KIDMgZmlsZXMgY2hhbmdlZCwgMjkyIGluc2VydGlvbnMo
KyksIDcyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlz
cGxheS9kYy9jb3JlL2RjX2xpbmtfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9k
Yy9jb3JlL2RjX2xpbmtfZHAuYwppbmRleCA5NGQ1YTBhYzMwOGYuLjExYjZlMTRiMzQ1ZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2NvcmUvZGNfbGlua19kcC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9jb3JlL2RjX2xpbmtfZHAuYwpA
QCAtMjIsNyArMjIsNyBAQAogCWxpbmstPmN0eC0+bG9nZ2VyCiAKIAotI2RlZmluZSBEUF9SRVBF
QVRFUl9DT05GSUdVUkFUSU9OX0FORF9TVEFUVVNfT0ZGU0VUICAgMHg1MAorI2RlZmluZSBEUF9S
RVBFQVRFUl9DT05GSUdVUkFUSU9OX0FORF9TVEFUVVNfU0laRSAgIDB4NTAKIAogLyogbWF4aW11
bSBwcmUgZW1waGFzaXMgbGV2ZWwgYWxsb3dlZCBmb3IgZWFjaCB2b2x0YWdlIHN3aW5nIGxldmVs
Ki8KIHN0YXRpYyBjb25zdCBlbnVtIGRjX3ByZV9lbXBoYXNpcyB2b2x0YWdlX3N3aW5nX3RvX3By
ZV9lbXBoYXNpc1tdID0gewpAQCAtMjI0LDE5ICsyMjQsMzEgQEAgc3RhdGljIGVudW0gZHBjZF90
cmFpbmluZ19wYXR0ZXJucwogCXJldHVybiBkcGNkX3RyX3BhdHRlcm47CiB9CiAKK3N0YXRpYyBp
bmxpbmUgYm9vbCBpc19yZXBlYXRlcihzdHJ1Y3QgZGNfbGluayAqbGluaywgdWludDMyX3Qgb2Zm
c2V0KQoreworCXJldHVybiAoIWxpbmstPmlzX2x0dHByX21vZGVfdHJhbnNwYXJlbnQgJiYgb2Zm
c2V0ICE9IDApOworfQorCiBzdGF0aWMgdm9pZCBkcGNkX3NldF9sdF9wYXR0ZXJuX2FuZF9sYW5l
X3NldHRpbmdzKAogCXN0cnVjdCBkY19saW5rICpsaW5rLAogCWNvbnN0IHN0cnVjdCBsaW5rX3Ry
YWluaW5nX3NldHRpbmdzICpsdF9zZXR0aW5ncywKLQllbnVtIGRjX2RwX3RyYWluaW5nX3BhdHRl
cm4gcGF0dGVybikKKwllbnVtIGRjX2RwX3RyYWluaW5nX3BhdHRlcm4gcGF0dGVybiwKKwl1aW50
MzJfdCBvZmZzZXQpCiB7CiAJdW5pb24gZHBjZF90cmFpbmluZ19sYW5lIGRwY2RfbGFuZVtMQU5F
X0NPVU5UX0RQX01BWF0gPSB7IHsgezB9IH0gfTsKLQljb25zdCB1aW50MzJfdCBkcGNkX2Jhc2Vf
bHRfb2Zmc2V0ID0KLQlEUF9UUkFJTklOR19QQVRURVJOX1NFVDsKKworCXVpbnQzMl90IGRwY2Rf
YmFzZV9sdF9vZmZzZXQ7CisKIAl1aW50OF90IGRwY2RfbHRfYnVmZmVyWzVdID0gezB9OwogCXVu
aW9uIGRwY2RfdHJhaW5pbmdfcGF0dGVybiBkcGNkX3BhdHRlcm4gPSB7IHswfSB9OwogCXVpbnQz
Ml90IGxhbmU7CiAJdWludDMyX3Qgc2l6ZV9pbl9ieXRlczsKIAlib29sIGVkcF93b3JrYXJvdW5k
ID0gZmFsc2U7IC8qIFRPRE8gbGlua19wcm9wLklOVEVSTkFMICovCisJZHBjZF9iYXNlX2x0X29m
ZnNldCA9IERQX1RSQUlOSU5HX1BBVFRFUk5fU0VUOworCisJaWYgKGlzX3JlcGVhdGVyKGxpbmss
IG9mZnNldCkpCisJCWRwY2RfYmFzZV9sdF9vZmZzZXQgPSBEUF9UUkFJTklOR19QQVRURVJOX1NF
VF9QSFlfUkVQRUFURVIxICsKKwkJCSgoRFBfUkVQRUFURVJfQ09ORklHVVJBVElPTl9BTkRfU1RB
VFVTX1NJWkUpICogKG9mZnNldCAtIDEpKTsKIAogCS8qKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogCSogRHBjZEFkZHJlc3Nf
VHJhaW5pbmdQYXR0ZXJuU2V0CkBAIC0yNDQsMTIgKzI1NiwxMiBAQCBzdGF0aWMgdm9pZCBkcGNk
X3NldF9sdF9wYXR0ZXJuX2FuZF9sYW5lX3NldHRpbmdzKAogCWRwY2RfcGF0dGVybi52MV80LlRS
QUlOSU5HX1BBVFRFUk5fU0VUID0KIAkJZGNfZHBfdHJhaW5pbmdfcGF0dGVybl90b19kcGNkX3Ry
YWluaW5nX3BhdHRlcm4obGluaywgcGF0dGVybik7CiAKLQlkcGNkX2x0X2J1ZmZlcltEUF9UUkFJ
TklOR19QQVRURVJOX1NFVCAtIGRwY2RfYmFzZV9sdF9vZmZzZXRdCisJZHBjZF9sdF9idWZmZXJb
RFBfVFJBSU5JTkdfUEFUVEVSTl9TRVQgLSBEUF9UUkFJTklOR19QQVRURVJOX1NFVF0KIAkJPSBk
cGNkX3BhdHRlcm4ucmF3OwogCi0JRENfTE9HX0hXX0xJTktfVFJBSU5JTkcoIiVzXG4gJXggcGF0
dGVybiA9ICV4XG4iLAorCURDX0xPR19IV19MSU5LX1RSQUlOSU5HKCIlc1xuIDB4JVggcGF0dGVy
biA9ICV4XG4iLAogCQlfX2Z1bmNfXywKLQkJRFBfVFJBSU5JTkdfUEFUVEVSTl9TRVQsCisJCWRw
Y2RfYmFzZV9sdF9vZmZzZXQsCiAJCWRwY2RfcGF0dGVybi52MV80LlRSQUlOSU5HX1BBVFRFUk5f
U0VUKTsKIAogCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKgpAQCAtMjcxLDE5ICsyODMsMTkgQEAgc3RhdGljIHZvaWQgZHBj
ZF9zZXRfbHRfcGF0dGVybl9hbmRfbGFuZV9zZXR0aW5ncygKIAkJUFJFX0VNUEhBU0lTX01BWF9M
RVZFTCA/IDEgOiAwKTsKIAl9CiAKLQkvKiBjb25jYXRpbmF0ZSBldmVyeXRoaW5nIGludG8gb25l
IGJ1ZmZlciovCisJLyogY29uY2F0ZW5hdGUgZXZlcnl0aGluZyBpbnRvIG9uZSBidWZmZXIqLwog
CiAJc2l6ZV9pbl9ieXRlcyA9IGx0X3NldHRpbmdzLT5saW5rX3NldHRpbmdzLmxhbmVfY291bnQg
KiBzaXplb2YoZHBjZF9sYW5lWzBdKTsKIAogCSAvLyAweDAwMTAzIC0gMHgwMDEwMgogCW1lbW1v
dmUoCi0JCSZkcGNkX2x0X2J1ZmZlcltEUF9UUkFJTklOR19MQU5FMF9TRVQgLSBkcGNkX2Jhc2Vf
bHRfb2Zmc2V0XSwKKwkJJmRwY2RfbHRfYnVmZmVyW0RQX1RSQUlOSU5HX0xBTkUwX1NFVCAtIERQ
X1RSQUlOSU5HX1BBVFRFUk5fU0VUXSwKIAkJZHBjZF9sYW5lLAogCQlzaXplX2luX2J5dGVzKTsK
IAotCURDX0xPR19IV19MSU5LX1RSQUlOSU5HKCIlczpcbiAleCBWUyBzZXQgPSAleCAgUEUgc2V0
ID0gJXggbWF4IFZTIFJlYWNoZWQgPSAleCAgbWF4IFBFIFJlYWNoZWQgPSAleFxuIiwKKwlEQ19M
T0dfSFdfTElOS19UUkFJTklORygiJXM6XG4gMHglWCBWUyBzZXQgPSAleCAgUEUgc2V0ID0gJXgg
bWF4IFZTIFJlYWNoZWQgPSAleCAgbWF4IFBFIFJlYWNoZWQgPSAleFxuIiwKIAkJX19mdW5jX18s
Ci0JCURQX1RSQUlOSU5HX0xBTkUwX1NFVCwKKwkJZHBjZF9iYXNlX2x0X29mZnNldCwKIAkJZHBj
ZF9sYW5lWzBdLmJpdHMuVk9MVEFHRV9TV0lOR19TRVQsCiAJCWRwY2RfbGFuZVswXS5iaXRzLlBS
RV9FTVBIQVNJU19TRVQsCiAJCWRwY2RfbGFuZVswXS5iaXRzLk1BWF9TV0lOR19SRUFDSEVELApA
QCAtNDk4LDggKzUxMCwxMiBAQCBzdGF0aWMgdm9pZCBnZXRfbGFuZV9zdGF0dXNfYW5kX2RyaXZl
X3NldHRpbmdzKAogCWNvbnN0IHN0cnVjdCBsaW5rX3RyYWluaW5nX3NldHRpbmdzICpsaW5rX3Ry
YWluaW5nX3NldHRpbmcsCiAJdW5pb24gbGFuZV9zdGF0dXMgKmxuX3N0YXR1cywKIAl1bmlvbiBs
YW5lX2FsaWduX3N0YXR1c191cGRhdGVkICpsbl9zdGF0dXNfdXBkYXRlZCwKLQlzdHJ1Y3QgbGlu
a190cmFpbmluZ19zZXR0aW5ncyAqcmVxX3NldHRpbmdzKQorCXN0cnVjdCBsaW5rX3RyYWluaW5n
X3NldHRpbmdzICpyZXFfc2V0dGluZ3MsCisJdWludDMyX3Qgb2Zmc2V0KQogeworCXVuc2lnbmVk
IGludCBsYW5lMDFfc3RhdHVzX2FkZHJlc3MgPSBEUF9MQU5FMF8xX1NUQVRVUzsKKwl1aW50OF90
IGxhbmVfYWRqdXN0X29mZnNldCA9IDQ7CisJdW5zaWduZWQgaW50IGxhbmUwMV9hZGp1c3RfYWRk
cmVzczsKIAl1aW50OF90IGRwY2RfYnVmWzZdID0gezB9OwogCXVuaW9uIGxhbmVfYWRqdXN0IGRw
Y2RfbGFuZV9hZGp1c3RbTEFORV9DT1VOVF9EUF9NQVhdID0geyB7IHswfSB9IH07CiAJc3RydWN0
IGxpbmtfdHJhaW5pbmdfc2V0dGluZ3MgcmVxdWVzdF9zZXR0aW5ncyA9IHsgezB9IH07CkBAIC01
MDcsOSArNTIzLDE2IEBAIHN0YXRpYyB2b2lkIGdldF9sYW5lX3N0YXR1c19hbmRfZHJpdmVfc2V0
dGluZ3MoCiAKIAltZW1zZXQocmVxX3NldHRpbmdzLCAnXDAnLCBzaXplb2Yoc3RydWN0IGxpbmtf
dHJhaW5pbmdfc2V0dGluZ3MpKTsKIAorCWlmIChpc19yZXBlYXRlcihsaW5rLCBvZmZzZXQpKSB7
CisJCWxhbmUwMV9zdGF0dXNfYWRkcmVzcyA9CisJCQkJRFBfTEFORTBfMV9TVEFUVVNfUEhZX1JF
UEVBVEVSMSArCisJCQkJKChEUF9SRVBFQVRFUl9DT05GSUdVUkFUSU9OX0FORF9TVEFUVVNfU0la
RSkgKiAob2Zmc2V0IC0gMSkpOworCQlsYW5lX2FkanVzdF9vZmZzZXQgPSAzOworCX0KKwogCWNv
cmVfbGlua19yZWFkX2RwY2QoCiAJCWxpbmssCi0JCURQX0xBTkUwXzFfU1RBVFVTLAorCQlsYW5l
MDFfc3RhdHVzX2FkZHJlc3MsCiAJCSh1aW50OF90ICopKGRwY2RfYnVmKSwKIAkJc2l6ZW9mKGRw
Y2RfYnVmKSk7CiAKQEAgLTUyMCwyMiArNTQzLDI4IEBAIHN0YXRpYyB2b2lkIGdldF9sYW5lX3N0
YXR1c19hbmRfZHJpdmVfc2V0dGluZ3MoCiAJCWxuX3N0YXR1c1tsYW5lXS5yYXcgPQogCQkJZ2V0
X25pYmJsZV9hdF9pbmRleCgmZHBjZF9idWZbMF0sIGxhbmUpOwogCQlkcGNkX2xhbmVfYWRqdXN0
W2xhbmVdLnJhdyA9Ci0JCQlnZXRfbmliYmxlX2F0X2luZGV4KCZkcGNkX2J1Zls0XSwgbGFuZSk7
CisJCQlnZXRfbmliYmxlX2F0X2luZGV4KCZkcGNkX2J1ZltsYW5lX2FkanVzdF9vZmZzZXRdLCBs
YW5lKTsKIAl9CiAKIAlsbl9zdGF0dXNfdXBkYXRlZC0+cmF3ID0gZHBjZF9idWZbMl07CiAKLQlE
Q19MT0dfSFdfTElOS19UUkFJTklORygiJXM6XG4leCBMYW5lMDFTdGF0dXMgPSAleFxuICV4IExh
bmUyM1N0YXR1cyA9ICV4XG4gIiwKKwlEQ19MT0dfSFdfTElOS19UUkFJTklORygiJXM6XG4gMHgl
WCBMYW5lMDFTdGF0dXMgPSAleFxuIDB4JVggTGFuZTIzU3RhdHVzID0gJXhcbiAiLAogCQlfX2Z1
bmNfXywKLQkJRFBfTEFORTBfMV9TVEFUVVMsIGRwY2RfYnVmWzBdLAotCQlEUF9MQU5FMl8zX1NU
QVRVUywgZHBjZF9idWZbMV0pOworCQlsYW5lMDFfc3RhdHVzX2FkZHJlc3MsIGRwY2RfYnVmWzBd
LAorCQlsYW5lMDFfc3RhdHVzX2FkZHJlc3MgKyAxLCBkcGNkX2J1ZlsxXSk7CisKKwlsYW5lMDFf
YWRqdXN0X2FkZHJlc3MgPSBEUF9BREpVU1RfUkVRVUVTVF9MQU5FMF8xOworCisJaWYgKGlzX3Jl
cGVhdGVyKGxpbmssIG9mZnNldCkpCisJCWxhbmUwMV9hZGp1c3RfYWRkcmVzcyA9IERQX0FESlVT
VF9SRVFVRVNUX0xBTkUwXzFfUEhZX1JFUEVBVEVSMSArCisJCQkJKChEUF9SRVBFQVRFUl9DT05G
SUdVUkFUSU9OX0FORF9TVEFUVVNfU0laRSkgKiAob2Zmc2V0IC0gMSkpOwogCi0JRENfTE9HX0hX
X0xJTktfVFJBSU5JTkcoIiVzOlxuICV4IExhbmUwMUFkanVzdFJlcXVlc3QgPSAleFxuICV4IExh
bmUyM0FkanVzdFJlcXVlc3QgPSAleFxuIiwKKwlEQ19MT0dfSFdfTElOS19UUkFJTklORygiJXM6
XG4gMHglWCBMYW5lMDFBZGp1c3RSZXF1ZXN0ID0gJXhcbiAweCVYIExhbmUyM0FkanVzdFJlcXVl
c3QgPSAleFxuIiwKIAkJX19mdW5jX18sCi0JCURQX0FESlVTVF9SRVFVRVNUX0xBTkUwXzEsCi0J
CWRwY2RfYnVmWzRdLAotCQlEUF9BREpVU1RfUkVRVUVTVF9MQU5FMl8zLAotCQlkcGNkX2J1Zls1
XSk7CisJCWxhbmUwMV9hZGp1c3RfYWRkcmVzcywKKwkJZHBjZF9idWZbbGFuZV9hZGp1c3Rfb2Zm
c2V0XSwKKwkJbGFuZTAxX2FkanVzdF9hZGRyZXNzICsgMSwKKwkJZHBjZF9idWZbbGFuZV9hZGp1
c3Rfb2Zmc2V0ICsgMV0pOwogCiAJLypjb3B5IHRvIHJlcV9zZXR0aW5ncyovCiAJcmVxdWVzdF9z
ZXR0aW5ncy5saW5rX3NldHRpbmdzLmxhbmVfY291bnQgPQpAQCAtNTc0LDEwICs2MDMsMTggQEAg
c3RhdGljIHZvaWQgZ2V0X2xhbmVfc3RhdHVzX2FuZF9kcml2ZV9zZXR0aW5ncygKIAogc3RhdGlj
IHZvaWQgZHBjZF9zZXRfbGFuZV9zZXR0aW5ncygKIAlzdHJ1Y3QgZGNfbGluayAqbGluaywKLQlj
b25zdCBzdHJ1Y3QgbGlua190cmFpbmluZ19zZXR0aW5ncyAqbGlua190cmFpbmluZ19zZXR0aW5n
KQorCWNvbnN0IHN0cnVjdCBsaW5rX3RyYWluaW5nX3NldHRpbmdzICpsaW5rX3RyYWluaW5nX3Nl
dHRpbmcsCisJdWludDMyX3Qgb2Zmc2V0KQogewogCXVuaW9uIGRwY2RfdHJhaW5pbmdfbGFuZSBk
cGNkX2xhbmVbTEFORV9DT1VOVF9EUF9NQVhdID0ge3t7MH19fTsKIAl1aW50MzJfdCBsYW5lOwor
CXVuc2lnbmVkIGludCBsYW5lMF9zZXRfYWRkcmVzczsKKworCWxhbmUwX3NldF9hZGRyZXNzID0g
RFBfVFJBSU5JTkdfTEFORTBfU0VUOworCisJaWYgKGlzX3JlcGVhdGVyKGxpbmssIG9mZnNldCkp
CisJCWxhbmUwX3NldF9hZGRyZXNzID0gRFBfVFJBSU5JTkdfTEFORTBfU0VUX1BIWV9SRVBFQVRF
UjEgKworCQkoKERQX1JFUEVBVEVSX0NPTkZJR1VSQVRJT05fQU5EX1NUQVRVU19TSVpFKSAqIChv
ZmZzZXQgLSAxKSk7CiAKIAlmb3IgKGxhbmUgPSAwOyBsYW5lIDwKIAkJKHVpbnQzMl90KShsaW5r
X3RyYWluaW5nX3NldHRpbmctPgpAQCAtNjAwLDcgKzYzNyw3IEBAIHN0YXRpYyB2b2lkIGRwY2Rf
c2V0X2xhbmVfc2V0dGluZ3MoCiAJfQogCiAJY29yZV9saW5rX3dyaXRlX2RwY2QobGluaywKLQkJ
RFBfVFJBSU5JTkdfTEFORTBfU0VULAorCQlsYW5lMF9zZXRfYWRkcmVzcywKIAkJKHVpbnQ4X3Qg
KikoZHBjZF9sYW5lKSwKIAkJbGlua190cmFpbmluZ19zZXR0aW5nLT5saW5rX3NldHRpbmdzLmxh
bmVfY291bnQpOwogCkBAIC02MjMsOSArNjYwLDkgQEAgc3RhdGljIHZvaWQgZHBjZF9zZXRfbGFu
ZV9zZXR0aW5ncygKIAl9CiAJKi8KIAotCURDX0xPR19IV19MSU5LX1RSQUlOSU5HKCIlc1xuICV4
IFZTIHNldCA9ICV4ICBQRSBzZXQgPSAleCBtYXggVlMgUmVhY2hlZCA9ICV4ICBtYXggUEUgUmVh
Y2hlZCA9ICV4XG4iLAorCURDX0xPR19IV19MSU5LX1RSQUlOSU5HKCIlc1xuIDB4JVggVlMgc2V0
ID0gJXggIFBFIHNldCA9ICV4IG1heCBWUyBSZWFjaGVkID0gJXggIG1heCBQRSBSZWFjaGVkID0g
JXhcbiIsCiAJCV9fZnVuY19fLAotCQlEUF9UUkFJTklOR19MQU5FMF9TRVQsCisJCWxhbmUwX3Nl
dF9hZGRyZXNzLAogCQlkcGNkX2xhbmVbMF0uYml0cy5WT0xUQUdFX1NXSU5HX1NFVCwKIAkJZHBj
ZF9sYW5lWzBdLmJpdHMuUFJFX0VNUEhBU0lTX1NFVCwKIAkJZHBjZF9sYW5lWzBdLmJpdHMuTUFY
X1NXSU5HX1JFQUNIRUQsCkBAIC02NTAsMTcgKzY4Nyw2IEBAIHN0YXRpYyBib29sIGlzX21heF92
c19yZWFjaGVkKAogCiB9CiAKLXZvaWQgZGNfbGlua19kcF9zZXRfZHJpdmVfc2V0dGluZ3MoCi0J
c3RydWN0IGRjX2xpbmsgKmxpbmssCi0Jc3RydWN0IGxpbmtfdHJhaW5pbmdfc2V0dGluZ3MgKmx0
X3NldHRpbmdzKQotewotCS8qIHByb2dyYW0gQVNJQyBQSFkgc2V0dGluZ3MqLwotCWRwX3NldF9o
d19sYW5lX3NldHRpbmdzKGxpbmssIGx0X3NldHRpbmdzKTsKLQotCS8qIE5vdGlmeSBEUCBzaW5r
IHRoZSBQSFkgc2V0dGluZ3MgZnJvbSBzb3VyY2UgKi8KLQlkcGNkX3NldF9sYW5lX3NldHRpbmdz
KGxpbmssIGx0X3NldHRpbmdzKTsKLX0KLQogc3RhdGljIGJvb2wgcGVyZm9ybV9wb3N0X2x0X2Fk
al9yZXFfc2VxdWVuY2UoCiAJc3RydWN0IGRjX2xpbmsgKmxpbmssCiAJc3RydWN0IGxpbmtfdHJh
aW5pbmdfc2V0dGluZ3MgKmx0X3NldHRpbmdzKQpAQCAtNjkzLDcgKzcxOSw4IEBAIHN0YXRpYyBi
b29sIHBlcmZvcm1fcG9zdF9sdF9hZGpfcmVxX3NlcXVlbmNlKAogCQkJbHRfc2V0dGluZ3MsCiAJ
CQlkcGNkX2xhbmVfc3RhdHVzLAogCQkJJmRwY2RfbGFuZV9zdGF0dXNfdXBkYXRlZCwKLQkJCSZy
ZXFfc2V0dGluZ3MpOworCQkJJnJlcV9zZXR0aW5ncywKKwkJCURQUlgpOwogCiAJCQlpZiAoZHBj
ZF9sYW5lX3N0YXR1c191cGRhdGVkLmJpdHMuCiAJCQkJCVBPU1RfTFRfQURKX1JFUV9JTl9QUk9H
UkVTUyA9PSAwKQpAQCAtNzUwLDYgKzc3NywzMSBAQCBzdGF0aWMgYm9vbCBwZXJmb3JtX3Bvc3Rf
bHRfYWRqX3JlcV9zZXF1ZW5jZSgKIAogfQogCisvKiBPbmx5IHVzZWQgZm9yIGNoYW5uZWwgZXF1
YWxpemF0aW9uICovCitzdGF0aWMgdWludDMyX3QgdHJhbnNsYXRlX3RyYWluaW5nX2F1eF9yZWFk
X2ludGVydmFsKHVpbnQzMl90IGRwY2RfYXV4X3JlYWRfaW50ZXJ2YWwpCit7CisJdW5zaWduZWQg
aW50IGF1eF9yZF9pbnRlcnZhbF91cyA9IDQwMDsKKworCXN3aXRjaCAoZHBjZF9hdXhfcmVhZF9p
bnRlcnZhbCkgeworCWNhc2UgMHgwMToKKwkJYXV4X3JkX2ludGVydmFsX3VzID0gNDAwOworCQli
cmVhazsKKwljYXNlIDB4MDI6CisJCWF1eF9yZF9pbnRlcnZhbF91cyA9IDQwMDA7CisJCWJyZWFr
OworCWNhc2UgMHgwMzoKKwkJYXV4X3JkX2ludGVydmFsX3VzID0gODAwMDsKKwkJYnJlYWs7CisJ
Y2FzZSAweDA0OgorCQlhdXhfcmRfaW50ZXJ2YWxfdXMgPSAxNjAwMDsKKwkJYnJlYWs7CisJZGVm
YXVsdDoKKwkJYnJlYWs7CisJfQorCisJcmV0dXJuIGF1eF9yZF9pbnRlcnZhbF91czsKK30KKwog
c3RhdGljIGVudW0gbGlua190cmFpbmluZ19yZXN1bHQgZ2V0X2NyX2ZhaWx1cmUoZW51bSBkY19s
YW5lX2NvdW50IGxuX2NvdW50LAogCQkJCQl1bmlvbiBsYW5lX3N0YXR1cyAqZHBjZF9sYW5lX3N0
YXR1cykKIHsKQEAgLTc2OCwzNyArODIwLDU1IEBAIHN0YXRpYyBlbnVtIGxpbmtfdHJhaW5pbmdf
cmVzdWx0IGdldF9jcl9mYWlsdXJlKGVudW0gZGNfbGFuZV9jb3VudCBsbl9jb3VudCwKIAogc3Rh
dGljIGVudW0gbGlua190cmFpbmluZ19yZXN1bHQgcGVyZm9ybV9jaGFubmVsX2VxdWFsaXphdGlv
bl9zZXF1ZW5jZSgKIAlzdHJ1Y3QgZGNfbGluayAqbGluaywKLQlzdHJ1Y3QgbGlua190cmFpbmlu
Z19zZXR0aW5ncyAqbHRfc2V0dGluZ3MpCisJc3RydWN0IGxpbmtfdHJhaW5pbmdfc2V0dGluZ3Mg
Kmx0X3NldHRpbmdzLAorCXVpbnQzMl90IG9mZnNldCkKIHsKIAlzdHJ1Y3QgbGlua190cmFpbmlu
Z19zZXR0aW5ncyByZXFfc2V0dGluZ3M7CiAJZW51bSBkY19kcF90cmFpbmluZ19wYXR0ZXJuIHRy
X3BhdHRlcm47CiAJdWludDMyX3QgcmV0cmllc19jaF9lcTsKKwl1aW50MzJfdCB3YWl0X3RpbWVf
bWljcm9zZWM7CiAJZW51bSBkY19sYW5lX2NvdW50IGxhbmVfY291bnQgPSBsdF9zZXR0aW5ncy0+
bGlua19zZXR0aW5ncy5sYW5lX2NvdW50OwogCXVuaW9uIGxhbmVfYWxpZ25fc3RhdHVzX3VwZGF0
ZWQgZHBjZF9sYW5lX3N0YXR1c191cGRhdGVkID0geyB7MH0gfTsKIAl1bmlvbiBsYW5lX3N0YXR1
cyBkcGNkX2xhbmVfc3RhdHVzW0xBTkVfQ09VTlRfRFBfTUFYXSA9IHsgeyB7MH0gfSB9OwogCisJ
LyogTm90ZTogYWxzbyBjaGVjayB0aGF0IFRQUzQgaXMgYSBzdXBwb3J0ZWQgZmVhdHVyZSovCisK
IAl0cl9wYXR0ZXJuID0gbHRfc2V0dGluZ3MtPnBhdHRlcm5fZm9yX2VxOwogCi0JZHBfc2V0X2h3
X3RyYWluaW5nX3BhdHRlcm4obGluaywgdHJfcGF0dGVybik7CisJaWYgKGlzX3JlcGVhdGVyKGxp
bmssIG9mZnNldCkpCisJCXRyX3BhdHRlcm4gPSBEUF9UUkFJTklOR19QQVRURVJOX1NFUVVFTkNF
XzQ7CisKKwlkcF9zZXRfaHdfdHJhaW5pbmdfcGF0dGVybihsaW5rLCB0cl9wYXR0ZXJuLCBvZmZz
ZXQpOwogCiAJZm9yIChyZXRyaWVzX2NoX2VxID0gMDsgcmV0cmllc19jaF9lcSA8PSBMSU5LX1RS
QUlOSU5HX01BWF9SRVRSWV9DT1VOVDsKIAkJcmV0cmllc19jaF9lcSsrKSB7CiAKLQkJZHBfc2V0
X2h3X2xhbmVfc2V0dGluZ3MobGluaywgbHRfc2V0dGluZ3MpOworCQlkcF9zZXRfaHdfbGFuZV9z
ZXR0aW5ncyhsaW5rLCBsdF9zZXR0aW5ncywgb2Zmc2V0KTsKIAogCQkvKiAyLiB1cGRhdGUgRFBD
RCovCiAJCWlmICghcmV0cmllc19jaF9lcSkKIAkJCS8qIEVQUiAjMzYxMDc2IC0gd3JpdGUgYXMg
YSA1LWJ5dGUgYnVyc3QsCi0JCQkgKiBidXQgb25seSBmb3IgdGhlIDEtc3QgaXRlcmF0aW9uKi8K
KwkJCSAqIGJ1dCBvbmx5IGZvciB0aGUgMS1zdCBpdGVyYXRpb24KKwkJCSAqLworCiAJCQlkcGNk
X3NldF9sdF9wYXR0ZXJuX2FuZF9sYW5lX3NldHRpbmdzKAogCQkJCWxpbmssCiAJCQkJbHRfc2V0
dGluZ3MsCi0JCQkJdHJfcGF0dGVybik7CisJCQkJdHJfcGF0dGVybiwgb2Zmc2V0KTsKIAkJZWxz
ZQotCQkJZHBjZF9zZXRfbGFuZV9zZXR0aW5ncyhsaW5rLCBsdF9zZXR0aW5ncyk7CisJCQlkcGNk
X3NldF9sYW5lX3NldHRpbmdzKGxpbmssIGx0X3NldHRpbmdzLCBvZmZzZXQpOwogCiAJCS8qIDMu
IHdhaXQgZm9yIHJlY2VpdmVyIHRvIGxvY2stb24qLwotCQl3YWl0X2Zvcl90cmFpbmluZ19hdXhf
cmRfaW50ZXJ2YWwobGluaywgbHRfc2V0dGluZ3MtPmVxX3BhdHRlcm5fdGltZSk7CisJCXdhaXRf
dGltZV9taWNyb3NlYyA9IGx0X3NldHRpbmdzLT5lcV9wYXR0ZXJuX3RpbWU7CisKKwkJaWYgKCFs
aW5rLT5pc19sdHRwcl9tb2RlX3RyYW5zcGFyZW50KQorCQkJd2FpdF90aW1lX21pY3Jvc2VjID0K
KwkJCQkJdHJhbnNsYXRlX3RyYWluaW5nX2F1eF9yZWFkX2ludGVydmFsKAorCQkJCQkJbGluay0+
ZHBjZF9jYXBzLmx0dHByX2NhcHMuYXV4X3JkX2ludGVydmFsW29mZnNldF0pOworCisJCXdhaXRf
Zm9yX3RyYWluaW5nX2F1eF9yZF9pbnRlcnZhbCgKKwkJCQlsaW5rLAorCQkJCXdhaXRfdGltZV9t
aWNyb3NlYyk7CiAKIAkJLyogNC4gUmVhZCBsYW5lIHN0YXR1cyBhbmQgcmVxdWVzdGVkCiAJCSAq
IGRyaXZlIHNldHRpbmdzIGFzIHNldCBieSB0aGUgc2luayovCkBAIC04MDgsNyArODc4LDggQEAg
c3RhdGljIGVudW0gbGlua190cmFpbmluZ19yZXN1bHQgcGVyZm9ybV9jaGFubmVsX2VxdWFsaXph
dGlvbl9zZXF1ZW5jZSgKIAkJCWx0X3NldHRpbmdzLAogCQkJZHBjZF9sYW5lX3N0YXR1cywKIAkJ
CSZkcGNkX2xhbmVfc3RhdHVzX3VwZGF0ZWQsCi0JCQkmcmVxX3NldHRpbmdzKTsKKwkJCSZyZXFf
c2V0dGluZ3MsCisJCQlvZmZzZXQpOwogCiAJCS8qIDUuIGNoZWNrIENSIGRvbmUqLwogCQlpZiAo
IWlzX2NyX2RvbmUobGFuZV9jb3VudCwgZHBjZF9sYW5lX3N0YXR1cykpCkBAIC04MjcsMTMgKzg5
OCwxNiBAQCBzdGF0aWMgZW51bSBsaW5rX3RyYWluaW5nX3Jlc3VsdCBwZXJmb3JtX2NoYW5uZWxf
ZXF1YWxpemF0aW9uX3NlcXVlbmNlKAogCXJldHVybiBMSU5LX1RSQUlOSU5HX0VRX0ZBSUxfRVE7
CiAKIH0KKyNkZWZpbmUgVFJBSU5JTkdfQVVYX1JEX0lOVEVSVkFMIDEwMCAvL3VzCiAKIHN0YXRp
YyBlbnVtIGxpbmtfdHJhaW5pbmdfcmVzdWx0IHBlcmZvcm1fY2xvY2tfcmVjb3Zlcnlfc2VxdWVu
Y2UoCiAJc3RydWN0IGRjX2xpbmsgKmxpbmssCi0Jc3RydWN0IGxpbmtfdHJhaW5pbmdfc2V0dGlu
Z3MgKmx0X3NldHRpbmdzKQorCXN0cnVjdCBsaW5rX3RyYWluaW5nX3NldHRpbmdzICpsdF9zZXR0
aW5ncywKKwl1aW50MzJfdCBvZmZzZXQpCiB7CiAJdWludDMyX3QgcmV0cmllc19jcjsKIAl1aW50
MzJfdCByZXRyeV9jb3VudDsKKwl1aW50MzJfdCB3YWl0X3RpbWVfbWljcm9zZWM7CiAJc3RydWN0
IGxpbmtfdHJhaW5pbmdfc2V0dGluZ3MgcmVxX3NldHRpbmdzOwogCWVudW0gZGNfbGFuZV9jb3Vu
dCBsYW5lX2NvdW50ID0gbHRfc2V0dGluZ3MtPmxpbmtfc2V0dGluZ3MubGFuZV9jb3VudDsKIAll
bnVtIGRjX2RwX3RyYWluaW5nX3BhdHRlcm4gdHJfcGF0dGVybiA9IERQX1RSQUlOSU5HX1BBVFRF
Uk5fU0VRVUVOQ0VfMTsKQEAgLTg0Myw3ICs5MTcsNyBAQCBzdGF0aWMgZW51bSBsaW5rX3RyYWlu
aW5nX3Jlc3VsdCBwZXJmb3JtX2Nsb2NrX3JlY292ZXJ5X3NlcXVlbmNlKAogCXJldHJpZXNfY3Ig
PSAwOwogCXJldHJ5X2NvdW50ID0gMDsKIAotCWRwX3NldF9od190cmFpbmluZ19wYXR0ZXJuKGxp
bmssIHRyX3BhdHRlcm4pOworCWRwX3NldF9od190cmFpbmluZ19wYXR0ZXJuKGxpbmssIHRyX3Bh
dHRlcm4sIG9mZnNldCk7CiAKIAkvKiBuYWplZWIgLSBUaGUgc3luYXB0aWNzIE1TVCBodWIgY2Fu
IHB1dCB0aGUgTFQgaW4KIAkqIGluZmluaXRlIGxvb3AgYnkgc3dpdGNoaW5nIHRoZSBWUwpAQCAt
ODYwLDcgKzkzNCw4IEBAIHN0YXRpYyBlbnVtIGxpbmtfdHJhaW5pbmdfcmVzdWx0IHBlcmZvcm1f
Y2xvY2tfcmVjb3Zlcnlfc2VxdWVuY2UoCiAJCS8qIDEuIGNhbGwgSFdTUyB0byBzZXQgbGFuZSBz
ZXR0aW5ncyovCiAJCWRwX3NldF9od19sYW5lX3NldHRpbmdzKAogCQkJCWxpbmssCi0JCQkJbHRf
c2V0dGluZ3MpOworCQkJCWx0X3NldHRpbmdzLAorCQkJCW9mZnNldCk7CiAKIAkJLyogMi4gdXBk
YXRlIERQQ0Qgb2YgdGhlIHJlY2VpdmVyKi8KIAkJaWYgKCFyZXRyaWVzX2NyKQpAQCAtODY5LDE2
ICs5NDQsMjMgQEAgc3RhdGljIGVudW0gbGlua190cmFpbmluZ19yZXN1bHQgcGVyZm9ybV9jbG9j
a19yZWNvdmVyeV9zZXF1ZW5jZSgKIAkJCWRwY2Rfc2V0X2x0X3BhdHRlcm5fYW5kX2xhbmVfc2V0
dGluZ3MoCiAJCQkJCWxpbmssCiAJCQkJCWx0X3NldHRpbmdzLAotCQkJCQl0cl9wYXR0ZXJuKTsK
KwkJCQkJdHJfcGF0dGVybiwKKwkJCQkJb2Zmc2V0KTsKIAkJZWxzZQogCQkJZHBjZF9zZXRfbGFu
ZV9zZXR0aW5ncygKIAkJCQkJbGluaywKLQkJCQkJbHRfc2V0dGluZ3MpOworCQkJCQlsdF9zZXR0
aW5ncywKKwkJCQkJb2Zmc2V0KTsKIAogCQkvKiAzLiB3YWl0IHJlY2VpdmVyIHRvIGxvY2stb24q
LworCQl3YWl0X3RpbWVfbWljcm9zZWMgPSBsdF9zZXR0aW5ncy0+Y3JfcGF0dGVybl90aW1lOwor
CisJCWlmICghbGluay0+aXNfbHR0cHJfbW9kZV90cmFuc3BhcmVudCkKKwkJCXdhaXRfdGltZV9t
aWNyb3NlYyA9IFRSQUlOSU5HX0FVWF9SRF9JTlRFUlZBTDsKKwogCQl3YWl0X2Zvcl90cmFpbmlu
Z19hdXhfcmRfaW50ZXJ2YWwoCiAJCQkJbGluaywKLQkJCQlsdF9zZXR0aW5ncy0+Y3JfcGF0dGVy
bl90aW1lKTsKKwkJCQl3YWl0X3RpbWVfbWljcm9zZWMpOwogCiAJCS8qIDQuIFJlYWQgbGFuZSBz
dGF0dXMgYW5kIHJlcXVlc3RlZCBkcml2ZQogCQkqIHNldHRpbmdzIGFzIHNldCBieSB0aGUgc2lu
awpAQCAtODg4LDcgKzk3MCw4IEBAIHN0YXRpYyBlbnVtIGxpbmtfdHJhaW5pbmdfcmVzdWx0IHBl
cmZvcm1fY2xvY2tfcmVjb3Zlcnlfc2VxdWVuY2UoCiAJCQkJbHRfc2V0dGluZ3MsCiAJCQkJZHBj
ZF9sYW5lX3N0YXR1cywKIAkJCQkmZHBjZF9sYW5lX3N0YXR1c191cGRhdGVkLAotCQkJCSZyZXFf
c2V0dGluZ3MpOworCQkJCSZyZXFfc2V0dGluZ3MsCisJCQkJb2Zmc2V0KTsKIAogCQkvKiA1LiBj
aGVjayBDUiBkb25lKi8KIAkJaWYgKGlzX2NyX2RvbmUobGFuZV9jb3VudCwgZHBjZF9sYW5lX3N0
YXR1cykpCkBAIC0xMDU3LDEwICsxMTQwLDM4IEBAIHN0YXRpYyB2b2lkIGluaXRpYWxpemVfdHJh
aW5pbmdfc2V0dGluZ3MoCiAJCWx0X3NldHRpbmdzLT5lbmhhbmNlZF9mcmFtaW5nID0gMTsKIH0K
IAorc3RhdGljIHVpbnQ4X3QgY29udmVydF90b19jb3VudCh1aW50OF90IGx0dHByX3JlcGVhdGVy
X2NvdW50KQoreworCXN3aXRjaCAobHR0cHJfcmVwZWF0ZXJfY291bnQpIHsKKwljYXNlIDB4ODA6
IC8vIDEgbHR0cHIgcmVwZWF0ZXIKKwkJcmV0dXJuIDE7CisJY2FzZSAweDQwOiAvLyAyIGx0dHBy
IHJlcGVhdGVycworCQlyZXR1cm4gMjsKKwljYXNlIDB4MjA6IC8vIDMgbHR0cHIgcmVwZWF0ZXJz
CisJCXJldHVybiAzOworCWNhc2UgMHgxMDogLy8gNCBsdHRwciByZXBlYXRlcnMKKwkJcmV0dXJu
IDQ7CisJY2FzZSAweDA4OiAvLyA1IGx0dHByIHJlcGVhdGVycworCQlyZXR1cm4gNTsKKwljYXNl
IDB4MDQ6IC8vIDYgbHR0cHIgcmVwZWF0ZXJzCisJCXJldHVybiA2OworCWNhc2UgMHgwMjogLy8g
NyBsdHRwciByZXBlYXRlcnMKKwkJcmV0dXJuIDc7CisJY2FzZSAweDAxOiAvLyA4IGx0dHByIHJl
cGVhdGVycworCQlyZXR1cm4gODsKKwlkZWZhdWx0OgorCQlicmVhazsKKwl9CisJcmV0dXJuIDA7
IC8vIGludmFsaWQgdmFsdWUKK30KKwogc3RhdGljIHZvaWQgY29uZmlndXJlX2x0dHByX21vZGUo
c3RydWN0IGRjX2xpbmsgKmxpbmspCiB7CiAJLyogYXV4IHRpbWVvdXQgaXMgYWxyZWFkeSBzZXQg
dG8gZXh0ZW5kZWQgKi8KIAkvKiBSRVNFVC9TRVQgbHR0cHIgbW9kZSB0byBlbmFibGUgbm9uIHRy
YW5zcGFyZW50IG1vZGUgKi8KKwl1aW50OF90IHJlcGVhdGVyX2NudDsKKwl1aW50MzJfdCBhdXhf
aW50ZXJ2YWxfYWRkcmVzczsKKwl1aW50OF90IHJlcGVhdGVyX2lkOwogCWVudW0gbHR0cHJfbW9k
ZSByZXBlYXRlcl9tb2RlID0gcGh5X3JlcGVhdGVyX21vZGVfdHJhbnNwYXJlbnQ7CiAKIAljb3Jl
X2xpbmtfd3JpdGVfZHBjZChsaW5rLApAQCAtMTA3NCw5ICsxMTg1LDQzIEBAIHN0YXRpYyB2b2lk
IGNvbmZpZ3VyZV9sdHRwcl9tb2RlKHN0cnVjdCBkY19saW5rICpsaW5rKQogCQkJCURQX1BIWV9S
RVBFQVRFUl9NT0RFLAogCQkJCSh1aW50OF90ICopJnJlcGVhdGVyX21vZGUsCiAJCQkJc2l6ZW9m
KHJlcGVhdGVyX21vZGUpKTsKKworCQlyZXBlYXRlcl9jbnQgPSBjb252ZXJ0X3RvX2NvdW50KGxp
bmstPmRwY2RfY2Fwcy5sdHRwcl9jYXBzLnBoeV9yZXBlYXRlcl9jbnQpOworCQlmb3IgKHJlcGVh
dGVyX2lkID0gcmVwZWF0ZXJfY250OyByZXBlYXRlcl9pZCA+IDA7IHJlcGVhdGVyX2lkLS0pIHsK
KwkJCWF1eF9pbnRlcnZhbF9hZGRyZXNzID0gRFBfVFJBSU5JTkdfQVVYX1JEX0lOVEVSVkFMX1BI
WV9SRVBFQVRFUjEgKworCQkJCQkJKChEUF9SRVBFQVRFUl9DT05GSUdVUkFUSU9OX0FORF9TVEFU
VVNfU0laRSkgKiAocmVwZWF0ZXJfaWQgLSAxKSk7CisJCQljb3JlX2xpbmtfcmVhZF9kcGNkKAor
CQkJCWxpbmssCisJCQkJYXV4X2ludGVydmFsX2FkZHJlc3MsCisJCQkJKHVpbnQ4X3QgKikmbGlu
ay0+ZHBjZF9jYXBzLmx0dHByX2NhcHMuYXV4X3JkX2ludGVydmFsW3JlcGVhdGVyX2lkIC0gMV0s
CisJCQkJc2l6ZW9mKGxpbmstPmRwY2RfY2Fwcy5sdHRwcl9jYXBzLmF1eF9yZF9pbnRlcnZhbFty
ZXBlYXRlcl9pZCAtIDFdKSk7CisJCQlsaW5rLT5kcGNkX2NhcHMubHR0cHJfY2Fwcy5hdXhfcmRf
aW50ZXJ2YWxbcmVwZWF0ZXJfaWQgLSAxXSAmPSAweDdGOworCQl9CiAJfQogfQogCitzdGF0aWMg
dm9pZCByZXBlYXRlcl90cmFpbmluZ19kb25lKHN0cnVjdCBkY19saW5rICpsaW5rLCB1aW50MzJf
dCBvZmZzZXQpCit7CisJdW5pb24gZHBjZF90cmFpbmluZ19wYXR0ZXJuIGRwY2RfcGF0dGVybiA9
IHsgezB9IH07CisKKwljb25zdCB1aW50MzJfdCBkcGNkX2Jhc2VfbHRfb2Zmc2V0ID0KKwkJCURQ
X1RSQUlOSU5HX1BBVFRFUk5fU0VUX1BIWV9SRVBFQVRFUjEgKworCQkJCSgoRFBfUkVQRUFURVJf
Q09ORklHVVJBVElPTl9BTkRfU1RBVFVTX1NJWkUpICogKG9mZnNldCAtIDEpKTsKKwkvKiBTZXQg
dHJhaW5pbmcgbm90IGluIHByb2dyZXNzKi8KKwlkcGNkX3BhdHRlcm4udjFfNC5UUkFJTklOR19Q
QVRURVJOX1NFVCA9IERQQ0RfVFJBSU5JTkdfUEFUVEVSTl9WSURFT0lETEU7CisKKwljb3JlX2xp
bmtfd3JpdGVfZHBjZCgKKwkJbGluaywKKwkJZHBjZF9iYXNlX2x0X29mZnNldCwKKwkJJmRwY2Rf
cGF0dGVybi5yYXcsCisJCTEpOworCisJRENfTE9HX0hXX0xJTktfVFJBSU5JTkcoIiVzXG4gMHgl
WCBwYXR0ZXJuID0gJXhcbiIsCisJCV9fZnVuY19fLAorCQlkcGNkX2Jhc2VfbHRfb2Zmc2V0LAor
CQlkcGNkX3BhdHRlcm4udjFfNC5UUkFJTklOR19QQVRURVJOX1NFVCk7Cit9CisKIHN0YXRpYyB2
b2lkIHByaW50X3N0YXR1c19tZXNzYWdlKAogCXN0cnVjdCBkY19saW5rICpsaW5rLAogCWNvbnN0
IHN0cnVjdCBsaW5rX3RyYWluaW5nX3NldHRpbmdzICpsdF9zZXR0aW5ncywKQEAgLTExNTYsNiAr
MTMwMSwxNyBAQCBzdGF0aWMgdm9pZCBwcmludF9zdGF0dXNfbWVzc2FnZSgKIAkJCQlsdF9zcHJl
YWQpOwogfQogCit2b2lkIGRjX2xpbmtfZHBfc2V0X2RyaXZlX3NldHRpbmdzKAorCXN0cnVjdCBk
Y19saW5rICpsaW5rLAorCXN0cnVjdCBsaW5rX3RyYWluaW5nX3NldHRpbmdzICpsdF9zZXR0aW5n
cykKK3sKKwkvKiBwcm9ncmFtIEFTSUMgUEhZIHNldHRpbmdzKi8KKwlkcF9zZXRfaHdfbGFuZV9z
ZXR0aW5ncyhsaW5rLCBsdF9zZXR0aW5ncywgRFBSWCk7CisKKwkvKiBOb3RpZnkgRFAgc2luayB0
aGUgUEhZIHNldHRpbmdzIGZyb20gc291cmNlICovCisJZHBjZF9zZXRfbGFuZV9zZXR0aW5ncyhs
aW5rLCBsdF9zZXR0aW5ncywgRFBSWCk7Cit9CisKIGJvb2wgZGNfbGlua19kcF9wZXJmb3JtX2xp
bmtfdHJhaW5pbmdfc2tpcF9hdXgoCiAJc3RydWN0IGRjX2xpbmsgKmxpbmssCiAJY29uc3Qgc3Ry
dWN0IGRjX2xpbmtfc2V0dGluZ3MgKmxpbmtfc2V0dGluZykKQEAgLTExNzIsMTAgKzEzMjgsMTAg
QEAgYm9vbCBkY19saW5rX2RwX3BlcmZvcm1fbGlua190cmFpbmluZ19za2lwX2F1eCgKIAkvKiAx
LiBQZXJmb3JtX2Nsb2NrX3JlY292ZXJ5X3NlcXVlbmNlLiAqLwogCiAJLyogdHJhbnNtaXQgdHJh
aW5pbmcgcGF0dGVybiBmb3IgY2xvY2sgcmVjb3ZlcnkgKi8KLQlkcF9zZXRfaHdfdHJhaW5pbmdf
cGF0dGVybihsaW5rLCBwYXR0ZXJuX2Zvcl9jcik7CisJZHBfc2V0X2h3X3RyYWluaW5nX3BhdHRl
cm4obGluaywgcGF0dGVybl9mb3JfY3IsIERQUlgpOwogCiAJLyogY2FsbCBIV1NTIHRvIHNldCBs
YW5lIHNldHRpbmdzKi8KLQlkcF9zZXRfaHdfbGFuZV9zZXR0aW5ncyhsaW5rLCAmbHRfc2V0dGlu
Z3MpOworCWRwX3NldF9od19sYW5lX3NldHRpbmdzKGxpbmssICZsdF9zZXR0aW5ncywgRFBSWCk7
CiAKIAkvKiB3YWl0IHJlY2VpdmVyIHRvIGxvY2stb24qLwogCXdhaXRfZm9yX3RyYWluaW5nX2F1
eF9yZF9pbnRlcnZhbChsaW5rLCBsdF9zZXR0aW5ncy5jcl9wYXR0ZXJuX3RpbWUpOwpAQCAtMTE4
MywxMCArMTMzOSwxMCBAQCBib29sIGRjX2xpbmtfZHBfcGVyZm9ybV9saW5rX3RyYWluaW5nX3Nr
aXBfYXV4KAogCS8qIDIuIFBlcmZvcm1fY2hhbm5lbF9lcXVhbGl6YXRpb25fc2VxdWVuY2UuICov
CiAKIAkvKiB0cmFuc21pdCB0cmFpbmluZyBwYXR0ZXJuIGZvciBjaGFubmVsIGVxdWFsaXphdGlv
bi4gKi8KLQlkcF9zZXRfaHdfdHJhaW5pbmdfcGF0dGVybihsaW5rLCBsdF9zZXR0aW5ncy5wYXR0
ZXJuX2Zvcl9lcSk7CisJZHBfc2V0X2h3X3RyYWluaW5nX3BhdHRlcm4obGluaywgbHRfc2V0dGlu
Z3MucGF0dGVybl9mb3JfZXEsIERQUlgpOwogCiAJLyogY2FsbCBIV1NTIHRvIHNldCBsYW5lIHNl
dHRpbmdzKi8KLQlkcF9zZXRfaHdfbGFuZV9zZXR0aW5ncyhsaW5rLCAmbHRfc2V0dGluZ3MpOwor
CWRwX3NldF9od19sYW5lX3NldHRpbmdzKGxpbmssICZsdF9zZXR0aW5ncywgRFBSWCk7CiAKIAkv
KiB3YWl0IHJlY2VpdmVyIHRvIGxvY2stb24uICovCiAJd2FpdF9mb3JfdHJhaW5pbmdfYXV4X3Jk
X2ludGVydmFsKGxpbmssIGx0X3NldHRpbmdzLmVxX3BhdHRlcm5fdGltZSk7CkBAIC0xMjA4LDkg
KzEzNjQsMTIgQEAgZW51bSBsaW5rX3RyYWluaW5nX3Jlc3VsdCBkY19saW5rX2RwX3BlcmZvcm1f
bGlua190cmFpbmluZygKIHsKIAllbnVtIGxpbmtfdHJhaW5pbmdfcmVzdWx0IHN0YXR1cyA9IExJ
TktfVFJBSU5JTkdfU1VDQ0VTUzsKIAlzdHJ1Y3QgbGlua190cmFpbmluZ19zZXR0aW5ncyBsdF9z
ZXR0aW5nczsKKwogI2lmZGVmIENPTkZJR19EUk1fQU1EX0RDX0RTQ19TVVBQT1JUCiAJYm9vbCBm
ZWNfZW5hYmxlOwogI2VuZGlmCisJdWludDhfdCByZXBlYXRlcl9jbnQ7CisJdWludDhfdCByZXBl
YXRlcl9pZDsKIAogCWluaXRpYWxpemVfdHJhaW5pbmdfc2V0dGluZ3MoCiAJCQlsaW5rLApAQCAt
MTIzMCwxNyArMTM4OSw0MCBAQCBlbnVtIGxpbmtfdHJhaW5pbmdfcmVzdWx0IGRjX2xpbmtfZHBf
cGVyZm9ybV9saW5rX3RyYWluaW5nKAogCWRwX3NldF9mZWNfcmVhZHkobGluaywgZmVjX2VuYWJs
ZSk7CiAjZW5kaWYKIAotCS8qIENvbmZpZ3VyZSBsdHRwciBtb2RlICovCi0JaWYgKCFsaW5rLT5p
c19sdHRwcl9tb2RlX3RyYW5zcGFyZW50KQorCWlmICghbGluay0+aXNfbHR0cHJfbW9kZV90cmFu
c3BhcmVudCkgeworCQkvKiBDb25maWd1cmUgbHR0cHIgbW9kZSAqLwogCQljb25maWd1cmVfbHR0
cHJfbW9kZShsaW5rKTsKIAotCS8qIDIuIHBlcmZvcm0gbGluayB0cmFpbmluZyAoc2V0IGxpbmsg
dHJhaW5pbmcgZG9uZQotCSAqICB0byBmYWxzZSBpcyBkb25lIGFzIHdlbGwpCi0JICovCi0Jc3Rh
dHVzID0gcGVyZm9ybV9jbG9ja19yZWNvdmVyeV9zZXF1ZW5jZShsaW5rLCAmbHRfc2V0dGluZ3Mp
OworCQkvKiAyLiBwZXJmb3JtIGxpbmsgdHJhaW5pbmcgKHNldCBsaW5rIHRyYWluaW5nIGRvbmUK
KwkJICogIHRvIGZhbHNlIGlzIGRvbmUgYXMgd2VsbCkKKwkJICovCisJCXJlcGVhdGVyX2NudCA9
IGNvbnZlcnRfdG9fY291bnQobGluay0+ZHBjZF9jYXBzLmx0dHByX2NhcHMucGh5X3JlcGVhdGVy
X2NudCk7CisKKwkJZm9yIChyZXBlYXRlcl9pZCA9IHJlcGVhdGVyX2NudDsgKHJlcGVhdGVyX2lk
ID4gMCAmJiBzdGF0dXMgPT0gTElOS19UUkFJTklOR19TVUNDRVNTKTsKKwkJCQlyZXBlYXRlcl9p
ZC0tKSB7CisJCQlzdGF0dXMgPSBwZXJmb3JtX2Nsb2NrX3JlY292ZXJ5X3NlcXVlbmNlKGxpbmss
ICZsdF9zZXR0aW5ncywgcmVwZWF0ZXJfaWQpOworCisJCQlpZiAoc3RhdHVzICE9IExJTktfVFJB
SU5JTkdfU1VDQ0VTUykKKwkJCQlicmVhazsKKworCQkJc3RhdHVzID0gcGVyZm9ybV9jaGFubmVs
X2VxdWFsaXphdGlvbl9zZXF1ZW5jZShsaW5rLAorCQkJCQkmbHRfc2V0dGluZ3MsCisJCQkJCXJl
cGVhdGVyX2lkKTsKKworCQkJaWYgKHN0YXR1cyAhPSBMSU5LX1RSQUlOSU5HX1NVQ0NFU1MpCisJ
CQkJYnJlYWs7CisKKwkJCXJlcGVhdGVyX3RyYWluaW5nX2RvbmUobGluaywgcmVwZWF0ZXJfaWQp
OworCQl9CisJfQorCisJaWYgKHN0YXR1cyA9PSBMSU5LX1RSQUlOSU5HX1NVQ0NFU1MpIHsKKwkJ
c3RhdHVzID0gcGVyZm9ybV9jbG9ja19yZWNvdmVyeV9zZXF1ZW5jZShsaW5rLCAmbHRfc2V0dGlu
Z3MsIERQUlgpOwogCWlmIChzdGF0dXMgPT0gTElOS19UUkFJTklOR19TVUNDRVNTKSB7CiAJCXN0
YXR1cyA9IHBlcmZvcm1fY2hhbm5lbF9lcXVhbGl6YXRpb25fc2VxdWVuY2UobGluaywKLQkJCQkm
bHRfc2V0dGluZ3MpOworCQkJCQkmbHRfc2V0dGluZ3MsCisJCQkJCURQUlgpOworCQl9CiAJfQog
CiAJaWYgKChzdGF0dXMgPT0gTElOS19UUkFJTklOR19TVUNDRVNTKSB8fCAhc2tpcF92aWRlb19w
YXR0ZXJuKSB7CkBAIC0xMzkzLDEwICsxNTc1LDExIEBAIGVudW0gbGlua190cmFpbmluZ19yZXN1
bHQgZGNfbGlua19kcF9zeW5jX2x0X2F0dGVtcHQoCiAJLyogMi4gcGVyZm9ybSBsaW5rIHRyYWlu
aW5nIChzZXQgbGluayB0cmFpbmluZyBkb25lCiAJICogIHRvIGZhbHNlIGlzIGRvbmUgYXMgd2Vs
bCkKIAkgKi8KLQlsdF9zdGF0dXMgPSBwZXJmb3JtX2Nsb2NrX3JlY292ZXJ5X3NlcXVlbmNlKGxp
bmssICZsdF9zZXR0aW5ncyk7CisJbHRfc3RhdHVzID0gcGVyZm9ybV9jbG9ja19yZWNvdmVyeV9z
ZXF1ZW5jZShsaW5rLCAmbHRfc2V0dGluZ3MsIERQUlgpOwogCWlmIChsdF9zdGF0dXMgPT0gTElO
S19UUkFJTklOR19TVUNDRVNTKSB7CiAJCWx0X3N0YXR1cyA9IHBlcmZvcm1fY2hhbm5lbF9lcXVh
bGl6YXRpb25fc2VxdWVuY2UobGluaywKLQkJCQkJCSZsdF9zZXR0aW5ncyk7CisJCQkJCQkmbHRf
c2V0dGluZ3MsCisJCQkJCQlEUFJYKTsKIAl9CiAKIAkvKiAzLiBTeW5jIExUIG11c3Qgc2tpcCBU
UkFJTklOR19QQVRURVJOX1NFVDowICh2aWRlbyBwYXR0ZXJuKSovCkBAIC0zMzU1LDggKzM1Mzgs
OCBAQCBib29sIGRjX2xpbmtfZHBfc2V0X3Rlc3RfcGF0dGVybigKIAlpZiAoaXNfZHBfcGh5X3Bh
dHRlcm4odGVzdF9wYXR0ZXJuKSkgewogCQkvKiBTZXQgRFBDRCBMYW5lIFNldHRpbmdzIGJlZm9y
ZSBydW5uaW5nIHRlc3QgcGF0dGVybiAqLwogCQlpZiAocF9saW5rX3NldHRpbmdzICE9IE5VTEwp
IHsKLQkJCWRwX3NldF9od19sYW5lX3NldHRpbmdzKGxpbmssIHBfbGlua19zZXR0aW5ncyk7Ci0J
CQlkcGNkX3NldF9sYW5lX3NldHRpbmdzKGxpbmssIHBfbGlua19zZXR0aW5ncyk7CisJCQlkcF9z
ZXRfaHdfbGFuZV9zZXR0aW5ncyhsaW5rLCBwX2xpbmtfc2V0dGluZ3MsIERQUlgpOworCQkJZHBj
ZF9zZXRfbGFuZV9zZXR0aW5ncyhsaW5rLCBwX2xpbmtfc2V0dGluZ3MsIERQUlgpOwogCQl9CiAK
IAkJLyogQmxhbmsgc3RyZWFtIGlmIHJ1bm5pbmcgdGVzdCBwYXR0ZXJuICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kY19saW5rX2h3c3MuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9jb3JlL2RjX2xpbmtfaHdzcy5jCmluZGV4IGE1
MTlkYmM1ZWNiNi4uNWVmYmRjMWViMTczIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2Rpc3BsYXkvZGMvY29yZS9kY19saW5rX2h3c3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2Rpc3BsYXkvZGMvY29yZS9kY19saW5rX2h3c3MuYwpAQCAtMTksNiArMTksMzYgQEAKICNpbmNs
dWRlICJyZXNvdXJjZS5oIgogI2VuZGlmCiAKK3N0YXRpYyB1aW50OF90IGNvbnZlcnRfdG9fY291
bnQodWludDhfdCBsdHRwcl9yZXBlYXRlcl9jb3VudCkKK3sKKwlzd2l0Y2ggKGx0dHByX3JlcGVh
dGVyX2NvdW50KSB7CisJY2FzZSAweDgwOiAvLyAxIGx0dHByIHJlcGVhdGVyCisJCXJldHVybiAx
OworCWNhc2UgMHg0MDogLy8gMiBsdHRwciByZXBlYXRlcnMKKwkJcmV0dXJuIDI7CisJY2FzZSAw
eDIwOiAvLyAzIGx0dHByIHJlcGVhdGVycworCQlyZXR1cm4gMzsKKwljYXNlIDB4MTA6IC8vIDQg
bHR0cHIgcmVwZWF0ZXJzCisJCXJldHVybiA0OworCWNhc2UgMHgwODogLy8gNSBsdHRwciByZXBl
YXRlcnMKKwkJcmV0dXJuIDU7CisJY2FzZSAweDA0OiAvLyA2IGx0dHByIHJlcGVhdGVycworCQly
ZXR1cm4gNjsKKwljYXNlIDB4MDI6IC8vIDcgbHR0cHIgcmVwZWF0ZXJzCisJCXJldHVybiA3Owor
CWNhc2UgMHgwMTogLy8gOCBsdHRwciByZXBlYXRlcnMKKwkJcmV0dXJuIDg7CisJZGVmYXVsdDoK
KwkJYnJlYWs7CisJfQorCXJldHVybiAwOyAvLyBpbnZhbGlkIHZhbHVlCit9CisKK3N0YXRpYyBp
bmxpbmUgYm9vbCBpc19pbW1lZGlhdGVfZG93bnN0cmVhbShzdHJ1Y3QgZGNfbGluayAqbGluaywg
dWludDMyX3Qgb2Zmc2V0KQoreworCXJldHVybiAoY29udmVydF90b19jb3VudChsaW5rLT5kcGNk
X2NhcHMubHR0cHJfY2Fwcy5waHlfcmVwZWF0ZXJfY250KSA9PSBvZmZzZXQpOworfQorCiBlbnVt
IGRjX3N0YXR1cyBjb3JlX2xpbmtfcmVhZF9kcGNkKAogCXN0cnVjdCBkY19saW5rICpsaW5rLAog
CXVpbnQzMl90IGFkZHJlc3MsCkBAIC0yMTIsNyArMjQyLDggQEAgdm9pZCBkcF9kaXNhYmxlX2xp
bmtfcGh5X21zdChzdHJ1Y3QgZGNfbGluayAqbGluaywgZW51bSBzaWduYWxfdHlwZSBzaWduYWwp
CiAKIGJvb2wgZHBfc2V0X2h3X3RyYWluaW5nX3BhdHRlcm4oCiAJc3RydWN0IGRjX2xpbmsgKmxp
bmssCi0JZW51bSBkY19kcF90cmFpbmluZ19wYXR0ZXJuIHBhdHRlcm4pCisJZW51bSBkY19kcF90
cmFpbmluZ19wYXR0ZXJuIHBhdHRlcm4sCisJdWludDMyX3Qgb2Zmc2V0KQogewogCWVudW0gZHBf
dGVzdF9wYXR0ZXJuIHRlc3RfcGF0dGVybiA9IERQX1RFU1RfUEFUVEVSTl9VTlNVUFBPUlRFRDsK
IApAQCAtMjQwLDEwICsyNzEsMTQgQEAgYm9vbCBkcF9zZXRfaHdfdHJhaW5pbmdfcGF0dGVybigK
IAogdm9pZCBkcF9zZXRfaHdfbGFuZV9zZXR0aW5ncygKIAlzdHJ1Y3QgZGNfbGluayAqbGluaywK
LQljb25zdCBzdHJ1Y3QgbGlua190cmFpbmluZ19zZXR0aW5ncyAqbGlua19zZXR0aW5ncykKKwlj
b25zdCBzdHJ1Y3QgbGlua190cmFpbmluZ19zZXR0aW5ncyAqbGlua19zZXR0aW5ncywKKwl1aW50
MzJfdCBvZmZzZXQpCiB7CiAJc3RydWN0IGxpbmtfZW5jb2RlciAqZW5jb2RlciA9IGxpbmstPmxp
bmtfZW5jOwogCisJaWYgKCFsaW5rLT5pc19sdHRwcl9tb2RlX3RyYW5zcGFyZW50ICYmICFpc19p
bW1lZGlhdGVfZG93bnN0cmVhbShsaW5rLCBvZmZzZXQpKQorCQlyZXR1cm47CisKIAkvKiBjYWxs
IEVuY29kZXIgdG8gc2V0IGxhbmUgc2V0dGluZ3MgKi8KIAllbmNvZGVyLT5mdW5jcy0+ZHBfc2V0
X2xhbmVfc2V0dGluZ3MoZW5jb2RlciwgbGlua19zZXR0aW5ncyk7CiB9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvaW5jL2xpbmtfaHdzcy5oIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9kaXNwbGF5L2RjL2luYy9saW5rX2h3c3MuaAppbmRleCA0ZWZmNWQzOGEyZjku
LjlhZjdlZTViYzhlZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2Rj
L2luYy9saW5rX2h3c3MuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvaW5j
L2xpbmtfaHdzcy5oCkBAIC02MCwxMSArNjAsMTMgQEAgdm9pZCBkcF9kaXNhYmxlX2xpbmtfcGh5
X21zdChzdHJ1Y3QgZGNfbGluayAqbGluaywgZW51bSBzaWduYWxfdHlwZSBzaWduYWwpOwogCiBi
b29sIGRwX3NldF9od190cmFpbmluZ19wYXR0ZXJuKAogCXN0cnVjdCBkY19saW5rICpsaW5rLAot
CWVudW0gZGNfZHBfdHJhaW5pbmdfcGF0dGVybiBwYXR0ZXJuKTsKKwllbnVtIGRjX2RwX3RyYWlu
aW5nX3BhdHRlcm4gcGF0dGVybiwKKwl1aW50MzJfdCBvZmZzZXQpOwogCiB2b2lkIGRwX3NldF9o
d19sYW5lX3NldHRpbmdzKAogCXN0cnVjdCBkY19saW5rICpsaW5rLAotCWNvbnN0IHN0cnVjdCBs
aW5rX3RyYWluaW5nX3NldHRpbmdzICpsaW5rX3NldHRpbmdzKTsKKwljb25zdCBzdHJ1Y3QgbGlu
a190cmFpbmluZ19zZXR0aW5ncyAqbGlua19zZXR0aW5ncywKKwl1aW50MzJfdCBvZmZzZXQpOwog
CiB2b2lkIGRwX3NldF9od190ZXN0X3BhdHRlcm4oCiAJc3RydWN0IGRjX2xpbmsgKmxpbmssCi0t
IAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
