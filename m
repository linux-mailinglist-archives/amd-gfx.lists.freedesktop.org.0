Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F057D1141A5
	for <lists+amd-gfx@lfdr.de>; Thu,  5 Dec 2019 14:39:47 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 824346F647;
	Thu,  5 Dec 2019 13:39:46 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wr1-x441.google.com (mail-wr1-x441.google.com
 [IPv6:2a00:1450:4864:20::441])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9A1136E84C
 for <amd-gfx@lists.freedesktop.org>; Thu,  5 Dec 2019 13:39:44 +0000 (UTC)
Received: by mail-wr1-x441.google.com with SMTP id y11so3634249wrt.6
 for <amd-gfx@lists.freedesktop.org>; Thu, 05 Dec 2019 05:39:44 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=kXatoMjxGwBGHnLM6N5CbSdWkKvxYOJHZy7gEZur07Q=;
 b=bMccrBBPIT7Uxfq1qMpzTKOHDt4rkG/nZ4yEpOsSaCEK5YNmd63mvV3OeZCWZu8XsU
 X5UVHGhm4hAwLeawm+1xAKtxAh7LoYb9M/0/DGakj4DP5wGNSElqzHh81hB/7XBkg2dT
 GIXtl+0DpS7twp8+WhwUaNc/cvtDzMVVSrPx4N/mmp35qUUOn6sIOTZBR//474dfB3Fb
 1ziFNt6UAkIz6+l2mOgjVUWlDi2Hj9hcF0msmhgbeSoWaSufIL8olDYuH5Ht7Q5jVr+s
 T9sDY8eAjQJnYCyPM87SgN2jJsT8CI7cAK5g9Hp8axY9LcdNqJQ0yfiVo3N8XYWdQWDs
 0p3g==
X-Gm-Message-State: APjAAAXjlPiCBFSh6g+OqZrFnOLOFF2XmDhhfnrazNblM3SLNetX7htS
 BrVIUa/DvmcJcHkGyAeinEObUKxO
X-Google-Smtp-Source: APXvYqyGVW4AvUMFwLKZTtRXXWMdF+JLCCIVoCdTehD+kdgR4cWC+G7TevKEB+Fa+d4sbOpztFWT1w==
X-Received: by 2002:a5d:65cf:: with SMTP id e15mr10558379wrw.126.1575553182906; 
 Thu, 05 Dec 2019 05:39:42 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:cd79:9e7:bab3:4698])
 by smtp.gmail.com with ESMTPSA id z189sm11219565wmc.2.2019.12.05.05.39.42
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 05 Dec 2019 05:39:42 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org, philip.yang@amd.com, Alex.Sierra@amd.com,
 felix.kuehling@amd.com
Subject: [PATCH 2/5] drm/amdgpu: explicitely sync to VM updates v2
Date: Thu,  5 Dec 2019 14:39:37 +0100
Message-Id: <20191205133940.3865-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191205133940.3865-1-christian.koenig@amd.com>
References: <20191205133940.3865-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=kXatoMjxGwBGHnLM6N5CbSdWkKvxYOJHZy7gEZur07Q=;
 b=bfoUl25g2zeDg1VzzXCfOPOtBOTfweAe6Qiii1AWWg/iFhDvj+lLzJ0ZPcPbZRpnY2
 J31C7weVmd1ihJobv7NdqbEYs7N5feTMG9pCyDy06xuHZBn4JVDhYgXLzZitADRwUs30
 SMLvKxNN2EAWW4+h/+GfFyxn7LF4+eWRBg/nEkFa2tRWDO5VL6oLohR6W5czfxFf8KA8
 rTcapKE6ABP7im2Dy5BQctc/fmuE/NpvBBWeLYdwg82qAUt41G/t5H2Jm2nGc0+1mgf5
 jAbTSYVcBXF6E/2tyaFLFc7lZ2lmD1cc9WLzRBxe4Bg7RzpiGGwIhbN2JdnPbyF4N2A1
 f9/A==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

QWxsb3dzIHVzIHRvIHJlZHVjZSB0aGUgb3ZlcmhlYWQgd2hpbGUgc3luY2luZyB0byBmZW5jZXMg
YSBiaXQuCgp2MjogYWxzbyBkcm9wIGFkZXYgcGFyYW1ldGVyIGZyb20gdGhlIGZ1bmN0aW9ucwoK
U2lnbmVkLW9mZi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29t
PgotLS0KIC4uLi9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jICB8ICA4
ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jICAgICAgICB8IDE5
ICsrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pZHMuYyAgICAg
ICB8IDEzICsrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9qb2IuYyAg
ICAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5jICAg
ICAgfCAzOCArKysrKysrKysrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfc3luYy5oICAgICAgfCAgOCArKy0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdm1fc2RtYS5jICAgfCAgMiArLQogNyBmaWxlcyBjaGFuZ2VkLCA1MSBpbnNlcnRpb25z
KCspLCA0MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfYW1ka2ZkX2dwdXZtLmMKaW5kZXggYjZkMTk1OGQ1MTRmLi5kOGRiNWVjZGY5YzEgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMK
QEAgLTM1OCw3ICszNTgsNyBAQCBzdGF0aWMgaW50IHZtX3VwZGF0ZV9wZHMoc3RydWN0IGFtZGdw
dV92bSAqdm0sIHN0cnVjdCBhbWRncHVfc3luYyAqc3luYykKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCi0JcmV0dXJuIGFtZGdwdV9zeW5jX2ZlbmNlKE5VTEwsIHN5bmMsIHZtLT5sYXN0X3Vw
ZGF0ZSwgZmFsc2UpOworCXJldHVybiBhbWRncHVfc3luY19mZW5jZShzeW5jLCB2bS0+bGFzdF91
cGRhdGUsIGZhbHNlKTsKIH0KIAogc3RhdGljIHVpbnQ2NF90IGdldF9wdGVfZmxhZ3Moc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBrZ2RfbWVtICptZW0pCkBAIC03NTEsNyArNzUx
LDcgQEAgc3RhdGljIGludCB1bm1hcF9ib19mcm9tX2dwdXZtKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LAogCiAJYW1kZ3B1X3ZtX2NsZWFyX2ZyZWVkKGFkZXYsIHZtLCAmYm9fdmEtPmxhc3Rf
cHRfdXBkYXRlKTsKIAotCWFtZGdwdV9zeW5jX2ZlbmNlKE5VTEwsIHN5bmMsIGJvX3ZhLT5sYXN0
X3B0X3VwZGF0ZSwgZmFsc2UpOworCWFtZGdwdV9zeW5jX2ZlbmNlKHN5bmMsIGJvX3ZhLT5sYXN0
X3B0X3VwZGF0ZSwgZmFsc2UpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC03NzAsNyArNzcwLDcgQEAg
c3RhdGljIGludCB1cGRhdGVfZ3B1dm1fcHRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAog
CQlyZXR1cm4gcmV0OwogCX0KIAotCXJldHVybiBhbWRncHVfc3luY19mZW5jZShOVUxMLCBzeW5j
LCBib192YS0+bGFzdF9wdF91cGRhdGUsIGZhbHNlKTsKKwlyZXR1cm4gYW1kZ3B1X3N5bmNfZmVu
Y2Uoc3luYywgYm9fdmEtPmxhc3RfcHRfdXBkYXRlLCBmYWxzZSk7CiB9CiAKIHN0YXRpYyBpbnQg
bWFwX2JvX3RvX2dwdXZtKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LApAQCAtMjA0NSw3ICsy
MDQ1LDcgQEAgaW50IGFtZGdwdV9hbWRrZmRfZ3B1dm1fcmVzdG9yZV9wcm9jZXNzX2Jvcyh2b2lk
ICppbmZvLCBzdHJ1Y3QgZG1hX2ZlbmNlICoqZWYpCiAJCQlwcl9kZWJ1ZygiTWVtb3J5IGV2aWN0
aW9uOiBWYWxpZGF0ZSBCT3MgZmFpbGVkLiBUcnkgYWdhaW5cbiIpOwogCQkJZ290byB2YWxpZGF0
ZV9tYXBfZmFpbDsKIAkJfQotCQlyZXQgPSBhbWRncHVfc3luY19mZW5jZShOVUxMLCAmc3luY19v
YmosIGJvLT50Ym8ubW92aW5nLCBmYWxzZSk7CisJCXJldCA9IGFtZGdwdV9zeW5jX2ZlbmNlKCZz
eW5jX29iaiwgYm8tPnRiby5tb3ZpbmcsIGZhbHNlKTsKIAkJaWYgKHJldCkgewogCQkJcHJfZGVi
dWcoIk1lbW9yeSBldmljdGlvbjogU3luYyBCTyBmZW5jZSBmYWlsZWQuIFRyeSBhZ2FpblxuIik7
CiAJCQlnb3RvIHZhbGlkYXRlX21hcF9mYWlsOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfY3MuYwppbmRleCA5ZTBjOTk3NjAzNjcuLjYxNDkxOWYyNjViOSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMKQEAgLTc5OSwyOSArNzk5LDIzIEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X2NzX3ZtX2hhbmRsaW5nKHN0cnVjdCBhbWRncHVfY3NfcGFyc2VyICpwKQogCWlmIChy
KQogCQlyZXR1cm4gcjsKIAotCXIgPSBhbWRncHVfc3luY19mZW5jZShhZGV2LCAmcC0+am9iLT5z
eW5jLAotCQkJICAgICAgZnByaXYtPnBydF92YS0+bGFzdF9wdF91cGRhdGUsIGZhbHNlKTsKKwly
ID0gYW1kZ3B1X3N5bmNfdm1fZmVuY2UoJnAtPmpvYi0+c3luYywgZnByaXYtPnBydF92YS0+bGFz
dF9wdF91cGRhdGUpOwogCWlmIChyKQogCQlyZXR1cm4gcjsKIAogCWlmIChhbWRncHVfbWNicCB8
fCBhbWRncHVfc3Jpb3ZfdmYoYWRldikpIHsKLQkJc3RydWN0IGRtYV9mZW5jZSAqZjsKLQogCQli
b192YSA9IGZwcml2LT5jc2FfdmE7CiAJCUJVR19PTighYm9fdmEpOwogCQlyID0gYW1kZ3B1X3Zt
X2JvX3VwZGF0ZShhZGV2LCBib192YSwgZmFsc2UpOwogCQlpZiAocikKIAkJCXJldHVybiByOwog
Ci0JCWYgPSBib192YS0+bGFzdF9wdF91cGRhdGU7Ci0JCXIgPSBhbWRncHVfc3luY19mZW5jZShh
ZGV2LCAmcC0+am9iLT5zeW5jLCBmLCBmYWxzZSk7CisJCXIgPSBhbWRncHVfc3luY192bV9mZW5j
ZSgmcC0+am9iLT5zeW5jLCBib192YS0+bGFzdF9wdF91cGRhdGUpOwogCQlpZiAocikKIAkJCXJl
dHVybiByOwogCX0KIAogCWFtZGdwdV9ib19saXN0X2Zvcl9lYWNoX2VudHJ5KGUsIHAtPmJvX2xp
c3QpIHsKLQkJc3RydWN0IGRtYV9mZW5jZSAqZjsKLQogCQkvKiBpZ25vcmUgZHVwbGljYXRlcyAq
LwogCQlibyA9IHR0bV90b19hbWRncHVfYm8oZS0+dHYuYm8pOwogCQlpZiAoIWJvKQpAQCAtODM1
LDggKzgyOSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2NzX3ZtX2hhbmRsaW5nKHN0cnVjdCBhbWRn
cHVfY3NfcGFyc2VyICpwKQogCQlpZiAocikKIAkJCXJldHVybiByOwogCi0JCWYgPSBib192YS0+
bGFzdF9wdF91cGRhdGU7Ci0JCXIgPSBhbWRncHVfc3luY19mZW5jZShhZGV2LCAmcC0+am9iLT5z
eW5jLCBmLCBmYWxzZSk7CisJCXIgPSBhbWRncHVfc3luY192bV9mZW5jZSgmcC0+am9iLT5zeW5j
LCBib192YS0+bGFzdF9wdF91cGRhdGUpOwogCQlpZiAocikKIAkJCXJldHVybiByOwogCX0KQEAg
LTg0OSw3ICs4NDIsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9jc192bV9oYW5kbGluZyhzdHJ1Y3Qg
YW1kZ3B1X2NzX3BhcnNlciAqcCkKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKLQlyID0gYW1kZ3B1
X3N5bmNfZmVuY2UoYWRldiwgJnAtPmpvYi0+c3luYywgdm0tPmxhc3RfdXBkYXRlLCBmYWxzZSk7
CisJciA9IGFtZGdwdV9zeW5jX3ZtX2ZlbmNlKCZwLT5qb2ItPnN5bmMsIHZtLT5sYXN0X3VwZGF0
ZSk7CiAJaWYgKHIpCiAJCXJldHVybiByOwogCkBAIC05OTEsNyArOTg0LDcgQEAgc3RhdGljIGlu
dCBhbWRncHVfY3NfcHJvY2Vzc19mZW5jZV9kZXAoc3RydWN0IGFtZGdwdV9jc19wYXJzZXIgKnAs
CiAJCQlkbWFfZmVuY2VfcHV0KG9sZCk7CiAJCX0KIAotCQlyID0gYW1kZ3B1X3N5bmNfZmVuY2Uo
cC0+YWRldiwgJnAtPmpvYi0+c3luYywgZmVuY2UsIHRydWUpOworCQlyID0gYW1kZ3B1X3N5bmNf
ZmVuY2UoJnAtPmpvYi0+c3luYywgZmVuY2UsIHRydWUpOwogCQlkbWFfZmVuY2VfcHV0KGZlbmNl
KTsKIAkJaWYgKHIpCiAJCQlyZXR1cm4gcjsKQEAgLTEwMTMsNyArMTAwNiw3IEBAIHN0YXRpYyBp
bnQgYW1kZ3B1X3N5bmNvYmpfbG9va3VwX2FuZF9hZGRfdG9fc3luYyhzdHJ1Y3QgYW1kZ3B1X2Nz
X3BhcnNlciAqcCwKIAkJcmV0dXJuIHI7CiAJfQogCi0JciA9IGFtZGdwdV9zeW5jX2ZlbmNlKHAt
PmFkZXYsICZwLT5qb2ItPnN5bmMsIGZlbmNlLCB0cnVlKTsKKwlyID0gYW1kZ3B1X3N5bmNfZmVu
Y2UoJnAtPmpvYi0+c3luYywgZmVuY2UsIHRydWUpOwogCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwog
CiAJcmV0dXJuIHI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfaWRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfaWRzLmMKaW5kZXgg
NmY5Mjg5NzM1ZTMxLi4zYTY3ZjZjMDQ2ZDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9pZHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfaWRzLmMKQEAgLTIwNiw3ICsyMDYsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV92bWlkX2dy
YWJfaWRsZShzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKIAlpbnQgcjsKIAogCWlmIChyaW5nLT52bWlk
X3dhaXQgJiYgIWRtYV9mZW5jZV9pc19zaWduYWxlZChyaW5nLT52bWlkX3dhaXQpKQotCQlyZXR1
cm4gYW1kZ3B1X3N5bmNfZmVuY2UoYWRldiwgc3luYywgcmluZy0+dm1pZF93YWl0LCBmYWxzZSk7
CisJCXJldHVybiBhbWRncHVfc3luY19mZW5jZShzeW5jLCByaW5nLT52bWlkX3dhaXQsIGZhbHNl
KTsKIAogCWZlbmNlcyA9IGttYWxsb2NfYXJyYXkoc2l6ZW9mKHZvaWQgKiksIGlkX21nci0+bnVt
X2lkcywgR0ZQX0tFUk5FTCk7CiAJaWYgKCFmZW5jZXMpCkBAIC0yNDEsNyArMjQxLDcgQEAgc3Rh
dGljIGludCBhbWRncHVfdm1pZF9ncmFiX2lkbGUoc3RydWN0IGFtZGdwdV92bSAqdm0sCiAJCQly
ZXR1cm4gLUVOT01FTTsKIAkJfQogCi0JCXIgPSBhbWRncHVfc3luY19mZW5jZShhZGV2LCBzeW5j
LCAmYXJyYXktPmJhc2UsIGZhbHNlKTsKKwkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKHN5bmMsICZh
cnJheS0+YmFzZSwgZmFsc2UpOwogCQlkbWFfZmVuY2VfcHV0KHJpbmctPnZtaWRfd2FpdCk7CiAJ
CXJpbmctPnZtaWRfd2FpdCA9ICZhcnJheS0+YmFzZTsKIAkJcmV0dXJuIHI7CkBAIC0yOTQsNyAr
Mjk0LDcgQEAgc3RhdGljIGludCBhbWRncHVfdm1pZF9ncmFiX3Jlc2VydmVkKHN0cnVjdCBhbWRn
cHVfdm0gKnZtLAogCQl0bXAgPSBhbWRncHVfc3luY19wZWVrX2ZlbmNlKCYoKmlkKS0+YWN0aXZl
LCByaW5nKTsKIAkJaWYgKHRtcCkgewogCQkJKmlkID0gTlVMTDsKLQkJCXIgPSBhbWRncHVfc3lu
Y19mZW5jZShhZGV2LCBzeW5jLCB0bXAsIGZhbHNlKTsKKwkJCXIgPSBhbWRncHVfc3luY19mZW5j
ZShzeW5jLCB0bXAsIGZhbHNlKTsKIAkJCXJldHVybiByOwogCQl9CiAJCW5lZWRzX2ZsdXNoID0g
dHJ1ZTsKQEAgLTMwMyw3ICszMDMsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV92bWlkX2dyYWJfcmVz
ZXJ2ZWQoc3RydWN0IGFtZGdwdV92bSAqdm0sCiAJLyogR29vZCB3ZSBjYW4gdXNlIHRoaXMgVk1J
RC4gUmVtZW1iZXIgdGhpcyBzdWJtaXNzaW9uIGFzCiAJKiB1c2VyIG9mIHRoZSBWTUlELgogCSov
Ci0JciA9IGFtZGdwdV9zeW5jX2ZlbmNlKHJpbmctPmFkZXYsICYoKmlkKS0+YWN0aXZlLCBmZW5j
ZSwgZmFsc2UpOworCXIgPSBhbWRncHVfc3luY19mZW5jZSgmKCppZCktPmFjdGl2ZSwgZmVuY2Us
IGZhbHNlKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKQEAgLTM3NSw3ICszNzUsNyBAQCBzdGF0
aWMgaW50IGFtZGdwdV92bWlkX2dyYWJfdXNlZChzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKIAkJLyog
R29vZCwgd2UgY2FuIHVzZSB0aGlzIFZNSUQuIFJlbWVtYmVyIHRoaXMgc3VibWlzc2lvbiBhcwog
CQkgKiB1c2VyIG9mIHRoZSBWTUlELgogCQkgKi8KLQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKHJp
bmctPmFkZXYsICYoKmlkKS0+YWN0aXZlLCBmZW5jZSwgZmFsc2UpOworCQlyID0gYW1kZ3B1X3N5
bmNfZmVuY2UoJigqaWQpLT5hY3RpdmUsIGZlbmNlLCBmYWxzZSk7CiAJCWlmIChyKQogCQkJcmV0
dXJuIHI7CiAKQEAgLTQzNSw4ICs0MzUsNyBAQCBpbnQgYW1kZ3B1X3ZtaWRfZ3JhYihzdHJ1Y3Qg
YW1kZ3B1X3ZtICp2bSwgc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLAogCQkJaWQgPSBpZGxlOwog
CiAJCQkvKiBSZW1lbWJlciB0aGlzIHN1Ym1pc3Npb24gYXMgdXNlciBvZiB0aGUgVk1JRCAqLwot
CQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKHJpbmctPmFkZXYsICZpZC0+YWN0aXZlLAotCQkJCQkg
ICAgICBmZW5jZSwgZmFsc2UpOworCQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKCZpZC0+YWN0aXZl
LCBmZW5jZSwgZmFsc2UpOwogCQkJaWYgKHIpCiAJCQkJZ290byBlcnJvcjsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5jIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5jCmluZGV4IDRmYjIwZTg3MGU2My4uNzMzMjhkMGM3
NDFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2pvYi5jCkBAIC0xOTMsOCAr
MTkzLDcgQEAgc3RhdGljIHN0cnVjdCBkbWFfZmVuY2UgKmFtZGdwdV9qb2JfZGVwZW5kZW5jeShz
dHJ1Y3QgZHJtX3NjaGVkX2pvYiAqc2NoZWRfam9iLAogCWZlbmNlID0gYW1kZ3B1X3N5bmNfZ2V0
X2ZlbmNlKCZqb2ItPnN5bmMsICZleHBsaWNpdCk7CiAJaWYgKGZlbmNlICYmIGV4cGxpY2l0KSB7
CiAJCWlmIChkcm1fc2NoZWRfZGVwZW5kZW5jeV9vcHRpbWl6ZWQoZmVuY2UsIHNfZW50aXR5KSkg
ewotCQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKHJpbmctPmFkZXYsICZqb2ItPnNjaGVkX3N5bmMs
Ci0JCQkJCSAgICAgIGZlbmNlLCBmYWxzZSk7CisJCQlyID0gYW1kZ3B1X3N5bmNfZmVuY2UoJmpv
Yi0+c2NoZWRfc3luYywgZmVuY2UsIGZhbHNlKTsKIAkJCWlmIChyKQogCQkJCURSTV9FUlJPUigi
RXJyb3IgYWRkaW5nIGZlbmNlICglZClcbiIsIHIpOwogCQl9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X3N5bmMuYwppbmRleCA5NWU1ZTkzZWRkMTguLmYxZTVmYmVmNTRkOCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3N5bmMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5jCkBAIC0xMjksNyArMTI5LDgg
QEAgc3RhdGljIHZvaWQgYW1kZ3B1X3N5bmNfa2VlcF9sYXRlcihzdHJ1Y3QgZG1hX2ZlbmNlICoq
a2VlcCwKICAqIFRyaWVzIHRvIGFkZCB0aGUgZmVuY2UgdG8gYW4gZXhpc3RpbmcgaGFzaCBlbnRy
eS4gUmV0dXJucyB0cnVlIHdoZW4gYW4gZW50cnkKICAqIHdhcyBmb3VuZCwgZmFsc2Ugb3RoZXJ3
aXNlLgogICovCi1zdGF0aWMgYm9vbCBhbWRncHVfc3luY19hZGRfbGF0ZXIoc3RydWN0IGFtZGdw
dV9zeW5jICpzeW5jLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmLCBib29sIGV4cGxpY2l0KQorc3RhdGlj
IGJvb2wgYW1kZ3B1X3N5bmNfYWRkX2xhdGVyKHN0cnVjdCBhbWRncHVfc3luYyAqc3luYywgc3Ry
dWN0IGRtYV9mZW5jZSAqZiwKKwkJCQkgIGJvb2wgZXhwbGljaXQpCiB7CiAJc3RydWN0IGFtZGdw
dV9zeW5jX2VudHJ5ICplOwogCkBAIC0xNTEsMTkgKzE1MiwxOCBAQCBzdGF0aWMgYm9vbCBhbWRn
cHVfc3luY19hZGRfbGF0ZXIoc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLCBzdHJ1Y3QgZG1hX2Zl
bmNlICpmLAogICogYW1kZ3B1X3N5bmNfZmVuY2UgLSByZW1lbWJlciB0byBzeW5jIHRvIHRoaXMg
ZmVuY2UKICAqCiAgKiBAc3luYzogc3luYyBvYmplY3QgdG8gYWRkIGZlbmNlIHRvCi0gKiBAZmVu
Y2U6IGZlbmNlIHRvIHN5bmMgdG8KKyAqIEBmOiBmZW5jZSB0byBzeW5jIHRvCisgKiBAZXhwbGlj
aXQ6IGlmIHRoaXMgaXMgYW4gZXhwbGljaXQgZGVwZW5kZW5jeQogICoKKyAqIEFkZCB0aGUgZmVu
Y2UgdG8gdGhlIHN5bmMgb2JqZWN0LgogICovCi1pbnQgYW1kZ3B1X3N5bmNfZmVuY2Uoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfc3luYyAqc3luYywKLQkJICAgICAg
c3RydWN0IGRtYV9mZW5jZSAqZiwgYm9vbCBleHBsaWNpdCkKK2ludCBhbWRncHVfc3luY19mZW5j
ZShzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsIHN0cnVjdCBkbWFfZmVuY2UgKmYsCisJCSAgICAg
IGJvb2wgZXhwbGljaXQpCiB7CiAJc3RydWN0IGFtZGdwdV9zeW5jX2VudHJ5ICplOwogCiAJaWYg
KCFmKQogCQlyZXR1cm4gMDsKLQlpZiAoYW1kZ3B1X3N5bmNfc2FtZV9kZXYoYWRldiwgZikgJiYK
LQkgICAgYW1kZ3B1X3N5bmNfZ2V0X293bmVyKGYpID09IEFNREdQVV9GRU5DRV9PV05FUl9WTSkK
LQkJYW1kZ3B1X3N5bmNfa2VlcF9sYXRlcigmc3luYy0+bGFzdF92bV91cGRhdGUsIGYpOwogCiAJ
aWYgKGFtZGdwdV9zeW5jX2FkZF9sYXRlcihzeW5jLCBmLCBleHBsaWNpdCkpCiAJCXJldHVybiAw
OwpAQCAtMTc5LDYgKzE3OSwyNCBAQCBpbnQgYW1kZ3B1X3N5bmNfZmVuY2Uoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfc3luYyAqc3luYywKIAlyZXR1cm4gMDsKIH0K
IAorLyoqCisgKiBhbWRncHVfc3luY192bV9mZW5jZSAtIHJlbWVtYmVyIHRvIHN5bmMgdG8gdGhp
cyBWTSBmZW5jZQorICoKKyAqIEBhZGV2OiBhbWRncHUgZGV2aWNlCisgKiBAc3luYzogc3luYyBv
YmplY3QgdG8gYWRkIGZlbmNlIHRvCisgKiBAZmVuY2U6IHRoZSBWTSBmZW5jZSB0byBhZGQKKyAq
CisgKiBBZGQgdGhlIGZlbmNlIHRvIHRoZSBzeW5jIG9iamVjdCBhbmQgcmVtZW1iZXIgaXQgYXMg
Vk0gdXBkYXRlLgorICovCitpbnQgYW1kZ3B1X3N5bmNfdm1fZmVuY2Uoc3RydWN0IGFtZGdwdV9z
eW5jICpzeW5jLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKK3sKKwlpZiAoIWZlbmNlKQorCQly
ZXR1cm4gMDsKKworCWFtZGdwdV9zeW5jX2tlZXBfbGF0ZXIoJnN5bmMtPmxhc3Rfdm1fdXBkYXRl
LCBmZW5jZSk7CisJcmV0dXJuIGFtZGdwdV9zeW5jX2ZlbmNlKHN5bmMsIGZlbmNlLCBmYWxzZSk7
Cit9CisKIC8qKgogICogYW1kZ3B1X3N5bmNfcmVzdiAtIHN5bmMgdG8gYSByZXNlcnZhdGlvbiBv
YmplY3QKICAqCkBAIC0yMDQsNyArMjIyLDcgQEAgaW50IGFtZGdwdV9zeW5jX3Jlc3Yoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAKIAkvKiBhbHdheXMgc3luYyB0byB0aGUgZXhjbHVzaXZl
IGZlbmNlICovCiAJZiA9IGRtYV9yZXN2X2dldF9leGNsKHJlc3YpOwotCXIgPSBhbWRncHVfc3lu
Y19mZW5jZShhZGV2LCBzeW5jLCBmLCBmYWxzZSk7CisJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKHN5
bmMsIGYsIGZhbHNlKTsKIAogCWZsaXN0ID0gZG1hX3Jlc3ZfZ2V0X2xpc3QocmVzdik7CiAJaWYg
KCFmbGlzdCB8fCByKQpAQCAtMjM5LDcgKzI1Nyw3IEBAIGludCBhbWRncHVfc3luY19yZXN2KHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkJCWNvbnRpbnVlOwogCQl9CiAKLQkJciA9IGFt
ZGdwdV9zeW5jX2ZlbmNlKGFkZXYsIHN5bmMsIGYsIGZhbHNlKTsKKwkJciA9IGFtZGdwdV9zeW5j
X2ZlbmNlKHN5bmMsIGYsIGZhbHNlKTsKIAkJaWYgKHIpCiAJCQlicmVhazsKIAl9CkBAIC0zNDAs
NyArMzU4LDcgQEAgaW50IGFtZGdwdV9zeW5jX2Nsb25lKHN0cnVjdCBhbWRncHVfc3luYyAqc291
cmNlLCBzdHJ1Y3QgYW1kZ3B1X3N5bmMgKmNsb25lKQogCWhhc2hfZm9yX2VhY2hfc2FmZShzb3Vy
Y2UtPmZlbmNlcywgaSwgdG1wLCBlLCBub2RlKSB7CiAJCWYgPSBlLT5mZW5jZTsKIAkJaWYgKCFk
bWFfZmVuY2VfaXNfc2lnbmFsZWQoZikpIHsKLQkJCXIgPSBhbWRncHVfc3luY19mZW5jZShOVUxM
LCBjbG9uZSwgZiwgZS0+ZXhwbGljaXQpOworCQkJciA9IGFtZGdwdV9zeW5jX2ZlbmNlKGNsb25l
LCBmLCBlLT5leHBsaWNpdCk7CiAJCQlpZiAocikKIAkJCQlyZXR1cm4gcjsKIAkJfSBlbHNlIHsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmggYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5oCmluZGV4IGI1ZjE3NzhhMjMx
OS4uZDYyYzJiODFkOTJiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfc3luYy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5j
LmgKQEAgLTQwLDggKzQwLDkgQEAgc3RydWN0IGFtZGdwdV9zeW5jIHsKIH07CiAKIHZvaWQgYW1k
Z3B1X3N5bmNfY3JlYXRlKHN0cnVjdCBhbWRncHVfc3luYyAqc3luYyk7Ci1pbnQgYW1kZ3B1X3N5
bmNfZmVuY2Uoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfc3luYyAq
c3luYywKLQkJICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZiwgYm9vbCBleHBsaWNpdCk7CitpbnQg
YW1kZ3B1X3N5bmNfZmVuY2Uoc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLCBzdHJ1Y3QgZG1hX2Zl
bmNlICpmLAorCQkgICAgICBib29sIGV4cGxpY2l0KTsKK2ludCBhbWRncHVfc3luY192bV9mZW5j
ZShzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKTsKIGlu
dCBhbWRncHVfc3luY19yZXN2KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkgICAgIHN0
cnVjdCBhbWRncHVfc3luYyAqc3luYywKIAkJICAgICBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsCkBA
IC00OSw3ICs1MCw4IEBAIGludCBhbWRncHVfc3luY19yZXN2KHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LAogCQkgICAgIGJvb2wgZXhwbGljaXRfc3luYyk7CiBzdHJ1Y3QgZG1hX2ZlbmNlICph
bWRncHVfc3luY19wZWVrX2ZlbmNlKHN0cnVjdCBhbWRncHVfc3luYyAqc3luYywKIAkJCQkgICAg
IHN0cnVjdCBhbWRncHVfcmluZyAqcmluZyk7Ci1zdHJ1Y3QgZG1hX2ZlbmNlICphbWRncHVfc3lu
Y19nZXRfZmVuY2Uoc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLCBib29sICpleHBsaWNpdCk7Citz
dHJ1Y3QgZG1hX2ZlbmNlICphbWRncHVfc3luY19nZXRfZmVuY2Uoc3RydWN0IGFtZGdwdV9zeW5j
ICpzeW5jLAorCQkJCQlib29sICpleHBsaWNpdCk7CiBpbnQgYW1kZ3B1X3N5bmNfY2xvbmUoc3Ry
dWN0IGFtZGdwdV9zeW5jICpzb3VyY2UsIHN0cnVjdCBhbWRncHVfc3luYyAqY2xvbmUpOwogaW50
IGFtZGdwdV9zeW5jX3dhaXQoc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLCBib29sIGludHIpOwog
dm9pZCBhbWRncHVfc3luY19mcmVlKHN0cnVjdCBhbWRncHVfc3luYyAqc3luYyk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYwppbmRleCA4MzJkYjU5ZjQ0MWUu
LjUwZjQ4NzY2Njk3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3ZtX3NkbWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1f
c2RtYS5jCkBAIC03MSw3ICs3MSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX3NkbWFfcHJlcGFy
ZShzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9wYXJhbXMgKnAsCiAJcC0+bnVtX2R3X2xlZnQgPSBu
ZHc7CiAKIAkvKiBXYWl0IGZvciBtb3ZlcyB0byBiZSBjb21wbGV0ZWQgKi8KLQlyID0gYW1kZ3B1
X3N5bmNfZmVuY2UocC0+YWRldiwgJnAtPmpvYi0+c3luYywgZXhjbHVzaXZlLCBmYWxzZSk7CisJ
ciA9IGFtZGdwdV9zeW5jX2ZlbmNlKCZwLT5qb2ItPnN5bmMsIGV4Y2x1c2l2ZSwgZmFsc2UpOwog
CWlmIChyKQogCQlyZXR1cm4gcjsKIAotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2FtZC1nZng=
