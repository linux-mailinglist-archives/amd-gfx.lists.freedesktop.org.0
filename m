Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 82A7938DC15
	for <lists+amd-gfx@lfdr.de>; Sun, 23 May 2021 19:10:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 11CB26E0A2;
	Sun, 23 May 2021 17:10:44 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-ej1-x62a.google.com (mail-ej1-x62a.google.com
 [IPv6:2a00:1450:4864:20::62a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DEEB96E0A2
 for <amd-gfx@lists.freedesktop.org>; Sun, 23 May 2021 17:10:42 +0000 (UTC)
Received: by mail-ej1-x62a.google.com with SMTP id n2so38006266ejy.7
 for <amd-gfx@lists.freedesktop.org>; Sun, 23 May 2021 10:10:42 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=subject:to:cc:references:from:message-id:date:user-agent
 :mime-version:in-reply-to:content-transfer-encoding:content-language;
 bh=VxCO0PLZX0FhGVC1jzhJDMIPeznoi+f53kXHHaPIn9I=;
 b=Y4Li2ysvIiPUOStPCkC7IcYB64jDBPm6MlTcVAXWWp3IKt31n9B4SIANNEEuUGiljf
 WiIurhaSDlqkWRnQ3X+kNY3RXOOYz+YhFasa5+52WRTpw1tQFDhxHm8wQQE4mA/EXlyq
 T5bKFgycX/ZM8eSDxSQAJ+HCpIgHvGxrsTzQFMF8qPkZ4gy022QajBKZMbH8zeRIQ/UA
 UV/TRBV6eiowi//xUNUN0ti/79oS1YS2VQAk0CSkfz/7bGv9++mCaIPIVSJ46QnFxpCa
 e4rT5SBzOsIiMp+uCPEVJYuTLbn7A5MMT75ajSt3vEYSK2RKkpNuvRuC4fK1WowkeH/p
 0wow==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:subject:to:cc:references:from:message-id:date
 :user-agent:mime-version:in-reply-to:content-transfer-encoding
 :content-language;
 bh=VxCO0PLZX0FhGVC1jzhJDMIPeznoi+f53kXHHaPIn9I=;
 b=dThNOR75Sa2QllbsZgH+ebXtTfdnquaQ7K6BlaOaT0Rc5E2Hr7RTelSdhjgAheWmrA
 pTaBNmWmdi/4JxK555eJ5mf1JeGktIsnVeiMsssC8bCE27mvufcXNUz0EGqDWecOjI/6
 uxzxTCO4BWa0W/V39N4xbCZjadf/FUCzPXh99dnUYu+afbAepNR2Yo1hVnn10mJ/vAy8
 gjMqw7fL1Odf7X7YcC8jAtAFCagCbk4CL46fu4UobAUlp4u9QdCAW5EGtj7GFyDcX2Yv
 Wo0X0CYDTqdft96hw4b51PvEzzK8Owd85Nd7WnFhQxTTxqKcz1lcm+e8yXG+In2l5FxC
 qLnw==
X-Gm-Message-State: AOAM5311Jm9otOsZJeRA+O0QYg5oDWj7aavfpiNo+nuHma+2MIjwCQwC
 sqNqvPz7CIXAFUYmBSfr6gYRAK1asZg=
X-Google-Smtp-Source: ABdhPJzBX2GUntxBh6e0wAVPz25NtYu5uIoVAoSi1mGiUhMIqmBMhiW20XmPADzsDS5wxtrKBuf4yg==
X-Received: by 2002:a17:906:26cb:: with SMTP id
 u11mr19770320ejc.385.1621789841560; 
 Sun, 23 May 2021 10:10:41 -0700 (PDT)
Received: from ?IPv6:2a02:908:1252:fb60:d716:abf2:6ef8:7167?
 ([2a02:908:1252:fb60:d716:abf2:6ef8:7167])
 by smtp.gmail.com with ESMTPSA id di7sm8010266edb.34.2021.05.23.10.10.40
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Sun, 23 May 2021 10:10:41 -0700 (PDT)
Subject: Re: [PATCH] drm/amdkfd: use resource cursor in
 svm_migrate_copy_to_vram
To: philip yang <yangp@amd.com>, felix.kuehling@amd.com
References: <20210521135203.169068-1-christian.koenig@amd.com>
 <914a1fbd-653a-3edf-27cb-4aa064267985@amd.com>
From: =?UTF-8?Q?Christian_K=c3=b6nig?= <ckoenig.leichtzumerken@gmail.com>
Message-ID: <091aaf6e-73f2-3ae1-e4cb-309732424150@gmail.com>
Date: Sun, 23 May 2021 19:10:40 +0200
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101
 Thunderbird/78.8.1
MIME-Version: 1.0
In-Reply-To: <914a1fbd-653a-3edf-27cb-4aa064267985@amd.com>
Content-Language: en-US
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: amd-gfx@lists.freedesktop.org
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

QW0gMjEuMDUuMjEgdW0gMjE6Mjggc2NocmllYiBwaGlsaXAgeWFuZzoKPgo+IFRoaXMgc2ltcGx5
IHRoZSBsb2dpYywgc2V2ZXJhbCBjb21tZW50cyBpbmxpbmUuCj4KPiBUaGFua3MsCj4KPiBQaGls
aXAKPgo+IE9uIDIwMjEtMDUtMjEgOTo1MiBhLm0uLCBDaHJpc3RpYW4gS8O2bmlnIHdyb3RlOgo+
PiBBY2Nlc3MgdG8gdGhlIG1tX25vZGUgaXMgbm93IGZvcmJpZGRlbi4gU28gaW5zdGVhZCBvZiBo
YW5kIHdpcmluZyB0aGF0Cj4+IHVzZSB0aGUgY3Vyc29yIGZ1bmN0aW9uYWxpdHkuCj4+Cj4+IFNp
Z25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWc8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgo+
PiAtLS0KPj4gICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbWlncmF0ZS5jIHwgNzYg
KysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tCj4+ICAgMSBmaWxlIGNoYW5nZWQsIDkgaW5zZXJ0aW9u
cygrKSwgNjcgZGVsZXRpb25zKC0pCj4+Cj4+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGtmZC9rZmRfbWlncmF0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2Zk
X21pZ3JhdGUuYwo+PiBpbmRleCBmZDhmNTQ0ZjBkZTIuLmNiMjhkMWU2NjBhZiAxMDA2NDQKPj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX21pZ3JhdGUuYwo+PiArKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbWlncmF0ZS5jCj4+IEBAIC0yOSw2ICsyOSw3
IEBACj4+ICAgI2luY2x1ZGUgImFtZGdwdV9vYmplY3QuaCIKPj4gICAjaW5jbHVkZSAiYW1kZ3B1
X3ZtLmgiCj4+ICAgI2luY2x1ZGUgImFtZGdwdV9tbi5oIgo+PiArI2luY2x1ZGUgImFtZGdwdV9y
ZXNfY3Vyc29yLmgiCj4+ICAgI2luY2x1ZGUgImtmZF9wcml2LmgiCj4+ICAgI2luY2x1ZGUgImtm
ZF9zdm0uaCIKPj4gICAjaW5jbHVkZSAia2ZkX21pZ3JhdGUuaCIKPj4gQEAgLTIwNSwzNCArMjA2
LDYgQEAgc3ZtX21pZ3JhdGVfY29weV9kb25lKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBz
dHJ1Y3QgZG1hX2ZlbmNlICptZmVuY2UpCj4+ICAgCXJldHVybiByOwo+PiAgIH0KPj4gICAKPj4g
LXN0YXRpYyB1aW50NjRfdAo+PiAtc3ZtX21pZ3JhdGVfbm9kZV9waHlzaWNhbF9hZGRyKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2LAo+PiAtCQkJICAgICAgIHN0cnVjdCBkcm1fbW1fbm9kZSAq
Km1tX25vZGUsIHVpbnQ2NF90ICpvZmZzZXQpCj4+IC17Cj4+IC0Jc3RydWN0IGRybV9tbV9ub2Rl
ICpub2RlID0gKm1tX25vZGU7Cj4+IC0JdWludDY0X3QgcG9zID0gKm9mZnNldDsKPj4gLQo+PiAt
CWlmIChub2RlLT5zdGFydCA9PSBBTURHUFVfQk9fSU5WQUxJRF9PRkZTRVQpIHsKPj4gLQkJcHJf
ZGVidWcoImRybSBub2RlIGlzIG5vdCB2YWxpZGF0ZWRcbiIpOwo+PiAtCQlyZXR1cm4gMDsKPj4g
LQl9Cj4+IC0KPj4gLQlwcl9kZWJ1ZygidnJhbSBub2RlIHN0YXJ0IDB4JWxseCBucGFnZXMgMHgl
bGx4XG4iLCBub2RlLT5zdGFydCwKPj4gLQkJIG5vZGUtPnNpemUpOwo+PiAtCj4+IC0JaWYgKHBv
cyA+PSBub2RlLT5zaXplKSB7Cj4+IC0JCWRvICB7Cj4+IC0JCQlwb3MgLT0gbm9kZS0+c2l6ZTsK
Pj4gLQkJCW5vZGUrKzsKPj4gLQkJfSB3aGlsZSAocG9zID49IG5vZGUtPnNpemUpOwo+PiAtCj4+
IC0JCSptbV9ub2RlID0gbm9kZTsKPj4gLQkJKm9mZnNldCA9IHBvczsKPj4gLQl9Cj4+IC0KPj4g
LQlyZXR1cm4gKG5vZGUtPnN0YXJ0ICsgcG9zKSA8PCBQQUdFX1NISUZUOwo+PiAtfQo+PiAtCj4+
ICAgdW5zaWduZWQgbG9uZwo+PiAgIHN2bV9taWdyYXRlX2FkZHJfdG9fcGZuKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LCB1bnNpZ25lZCBsb25nIGFkZHIpCj4+ICAgewo+PiBAQCAtMjk3LDEx
ICsyNzAsOSBAQCBzdm1fbWlncmF0ZV9jb3B5X3RvX3ZyYW0oc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYsIHN0cnVjdCBzdm1fcmFuZ2UgKnByYW5nZSwKPj4gICB7Cj4+ICAgCXVpbnQ2NF90IG5w
YWdlcyA9IG1pZ3JhdGUtPmNwYWdlczsKPj4gICAJc3RydWN0IGRldmljZSAqZGV2ID0gYWRldi0+
ZGV2Owo+PiAtCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZTsKPj4gKwlzdHJ1Y3QgYW1kZ3B1X3Jl
c19jdXJzb3IgY3Vyc29yOwo+PiAgIAlkbWFfYWRkcl90ICpzcmM7Cj4+ICAgCXVpbnQ2NF90ICpk
c3Q7Cj4+IC0JdWludDY0X3QgdnJhbV9hZGRyOwo+PiAtCXVpbnQ2NF90IG9mZnNldDsKPj4gICAJ
dWludDY0X3QgaSwgajsKPj4gICAJaW50IHI7Cj4+ICAgCj4+IEBAIC0zMTcsMTkgKzI4OCwxMiBA
QCBzdm1fbWlncmF0ZV9jb3B5X3RvX3ZyYW0oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0
cnVjdCBzdm1fcmFuZ2UgKnByYW5nZSwKPj4gICAJCWdvdG8gb3V0Owo+PiAgIAl9Cj4+ICAgCj4+
IC0Jbm9kZSA9IHByYW5nZS0+dHRtX3Jlcy0+bW1fbm9kZTsKPj4gLQlvZmZzZXQgPSBwcmFuZ2Ut
Pm9mZnNldDsKPj4gLQl2cmFtX2FkZHIgPSBzdm1fbWlncmF0ZV9ub2RlX3BoeXNpY2FsX2FkZHIo
YWRldiwgJm5vZGUsICZvZmZzZXQpOwo+PiAtCWlmICghdnJhbV9hZGRyKSB7Cj4gVGhlIHByYW5n
ZS0+dHRtX3JlcyB2YWxpZCBjaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugd2UgYWxyZWFkeSBj
aGVjayAKPiBzdm1fcmFuZ2VfdnJhbV9ub2RlX25ldyByZXR1cm4gdmFsdWUKPj4gLQkJV0FSTl9P
TkNFKDEsICJ2cmFtIG5vZGUgYWRkcmVzcyBpcyAwXG4iKTsKPj4gLQkJciA9IC1FTk9NRU07Cj4+
IC0JCWdvdG8gb3V0Owo+PiAtCX0KPj4gLQo+PiArCWFtZGdwdV9yZXNfZmlyc3QocHJhbmdlLT50
dG1fcmVzLCBwcmFuZ2UtPm9mZnNldCwgbnBhZ2VzIDw8IFBBR0VfU0hJRlQsCj4KPiBwcmFuZ2Ut
Pm9mZnNldDw8IFBBR0VfU0hJRlQKPgo+IGFtZGdwdV9yZXNfZmlyc3QgdGFrZXMgc3RhcnQgYW5k
IHNpemUgaW4gYnl0ZXMsIHByYW5nZS0+b2Zmc2V0IHVzZSAKPiBwYWdlIGFsaWduZWQgb2Zmc2V0
Cj4KCkFoLCB5ZXMgZ29vZCBwb2ludC4KCj4KPj4gKwkJCSAmY3Vyc29yKTsKPj4gICAJZm9yIChp
ID0gaiA9IDA7IGkgPCBucGFnZXM7IGkrKykgewo+PiAgIAkJc3RydWN0IHBhZ2UgKnNwYWdlOwo+
PiAgIAo+PiAtCQlkc3RbaV0gPSB2cmFtX2FkZHIgKyAoaiA8PCBQQUdFX1NISUZUKTsKPj4gKwkJ
ZHN0W2ldID0gY3Vyc29yLnN0YXJ0ICsgKGogPDwgUEFHRV9TSElGVCk7Cj4+ICAgCQltaWdyYXRl
LT5kc3RbaV0gPSBzdm1fbWlncmF0ZV9hZGRyX3RvX3BmbihhZGV2LCBkc3RbaV0pOwo+PiAgIAkJ
c3ZtX21pZ3JhdGVfZ2V0X3ZyYW1fcGFnZShwcmFuZ2UsIG1pZ3JhdGUtPmRzdFtpXSk7Cj4+ICAg
Cj4+IEBAIC0zNTQsMTggKzMxOCwxMCBAQCBzdm1fbWlncmF0ZV9jb3B5X3RvX3ZyYW0oc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBzdm1fcmFuZ2UgKnByYW5nZSwKPj4gICAJCQkJ
CQltZmVuY2UpOwo+PiAgIAkJCQlpZiAocikKPj4gICAJCQkJCWdvdG8gb3V0X2ZyZWVfdnJhbV9w
YWdlczsKPj4gLQkJCQlvZmZzZXQgKz0gajsKPj4gLQkJCQl2cmFtX2FkZHIgPSAobm9kZS0+c3Rh
cnQgKyBvZmZzZXQpIDw8IFBBR0VfU0hJRlQ7Cj4+ICsJCQkJYW1kZ3B1X3Jlc19uZXh0KCZjdXJz
b3IsIGogPDwgUEFHRV9TSElGVCk7Cj4+ICAgCQkJCWogPSAwOwo+PiAgIAkJCX0gZWxzZSB7Cj4+
IC0JCQkJb2Zmc2V0Kys7Cj4+IC0JCQkJdnJhbV9hZGRyICs9IFBBR0VfU0laRTsKPj4gLQkJCX0K
Pj4gLQkJCWlmIChvZmZzZXQgPj0gbm9kZS0+c2l6ZSkgewo+PiAtCQkJCW5vZGUrKzsKPj4gLQkJ
CQlwcl9kZWJ1ZygibmV4dCBub2RlIHNpemUgMHglbGx4XG4iLCBub2RlLT5zaXplKTsKPj4gLQkJ
CQl2cmFtX2FkZHIgPSBub2RlLT5zdGFydCA8PCBQQUdFX1NISUZUOwo+PiAtCQkJCW9mZnNldCA9
IDA7Cj4+ICsJCQkJYW1kZ3B1X3Jlc19uZXh0KCZjdXJzb3IsIFBBR0VfU0laRSk7Cj4+ICAgCQkJ
fQo+PiAgIAkJCWNvbnRpbnVlOwo+PiAgIAkJfQo+PiBAQCAtMzczLDIyICszMjksOCBAQCBzdm1f
bWlncmF0ZV9jb3B5X3RvX3ZyYW0oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBz
dm1fcmFuZ2UgKnByYW5nZSwKPj4gICAJCXByX2RlYnVnKCJkbWEgbWFwcGluZyBzcmMgdG8gMHgl
bGx4LCBwYWdlX3RvX3BmbiAweCVseFxuIiwKPj4gICAJCQkgc3JjW2ldID4+IFBBR0VfU0hJRlQs
IHBhZ2VfdG9fcGZuKHNwYWdlKSk7Cj4+ICAgCj4+IC0JCWlmIChqICsgb2Zmc2V0ID49IG5vZGUt
PnNpemUgLSAxICYmIGkgPCBucGFnZXMgLSAxKSB7Cj4+IC0JCQlyID0gc3ZtX21pZ3JhdGVfY29w
eV9tZW1vcnlfZ2FydChhZGV2LCBzcmMgKyBpIC0gaiwKPj4gLQkJCQkJCQkgZHN0ICsgaSAtIGos
IGogKyAxLAo+PiAtCQkJCQkJCSBGUk9NX1JBTV9UT19WUkFNLAo+PiAtCQkJCQkJCSBtZmVuY2Up
Owo+PiAtCQkJaWYgKHIpCj4+IC0JCQkJZ290byBvdXRfZnJlZV92cmFtX3BhZ2VzOwo+PiAtCj4+
IC0JCQlub2RlKys7Cj4+IC0JCQlwcl9kZWJ1ZygibmV4dCBub2RlIHNpemUgMHglbGx4XG4iLCBu
b2RlLT5zaXplKTsKPj4gLQkJCXZyYW1fYWRkciA9IG5vZGUtPnN0YXJ0IDw8IFBBR0VfU0hJRlQ7
Cj4+IC0JCQlvZmZzZXQgPSAwOwo+PiAtCQkJaiA9IDA7Cj4+IC0JCX0gZWxzZSB7Cj4+IC0JCQlq
Kys7Cj4+IC0JCX0KPj4gKwkJYW1kZ3B1X3Jlc19uZXh0KCZjdXJzb3IsIFBBR0VfU0laRSk7Cj4+
ICsJCWorKzsKPiBIZXJlIHRvIGhhbmRsZSBjcm9zcyBtbV9ub2RlIGNhc2UuCj4KPiBpZiAoaiA+
PSBjdXJzb3ItPnNpemUgLSAxICYmIGkgPCBucGFnZXMgLSAxKSB7Cj4KPiDCoMKgwqAgciA9IHN2
bV9taWdyYXRlX2NvcHlfbWVtb3J5X2dhcnQoYWRldiwgc3JjICsgaSAtIGosCj4KPiDCoMKgwqAg
wqDCoMKgIMKgwqDCoCDCoMKgwqAgwqDCoMKgIMKgwqDCoCDCoMKgwqAgwqDCoMKgIGRzdCArIGkg
LSBqLCBqICsgMSwKPgo+IAkJCUZST01fUkFNX1RPX1ZSQU0sCj4gCQkJIG1mZW5jZSk7Cj4gICAg
ICBpZiAocikKPiAJZ290byBvdXRfZnJlZV92cmFtX3BhZ2VzOwo+ICAgICAgCj4gICAgICBhbWRn
cHVfcmVzX25leHQoJmN1cnNvciwgKGogKyAxKSAqIFBBR0VfU0laRSk7Cj4gICAgICBqPSAwOwo+
IH0gZWxzZSB7Cj4gICAgIGorKzsKPiB9CgpZZWFoLCB0aGF0IHdhcyB0aGUgcG9pbnQgSSBjb3Vs
ZG4ndCB1bmRlcnN0YW5kLiBXaHkgd291bGQgd2Ugd2FudCB0aGF0IAphbnl3YXk/CgpSZWdhcmRz
LApDaHJpc3RpYW4uCgo+Cj4KPj4gICAJfQo+PiAgIAo+PiAgIAlyID0gc3ZtX21pZ3JhdGVfY29w
eV9tZW1vcnlfZ2FydChhZGV2LCBzcmMgKyBpIC0gaiwgZHN0ICsgaSAtIGosIGosCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcg
bGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZngK
