Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 524C56AD60
	for <lists+amd-gfx@lfdr.de>; Tue, 16 Jul 2019 19:08:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E402E6E159;
	Tue, 16 Jul 2019 17:08:42 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-BL2-obe.outbound.protection.outlook.com
 (mail-eopbgr750050.outbound.protection.outlook.com [40.107.75.50])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 654276E159
 for <amd-gfx@lists.freedesktop.org>; Tue, 16 Jul 2019 17:08:41 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=HArIQIfJyIWCDwjyd7lE+aRKDTl26aG1RmfxNncJYdN0aBRGyXjp6+FU5TuTU7ZmZwi4qSHT/RWIdEjiLLYWtvhko0tGLAF/S2wAds6x5Nq4zsc6GcwhUZzCqTKo/cdVlxpFb3RGI9Nsyib8JEKKRaixeg4uSpoes0Y/fq6CPgm91Slkz6XEdEduBLTnmG8ozqLpu8K6b0WZnlyiZXJbVn8QQ2xSykMpl83MRk1G+CJhdUpU6Kt612SWjfCzWLX41KFw4hpWeJ9z5lhMLbRGc1KXubBfmGYI1+XM0vmJtGhaKAXFsOvK0HepyEB3JRWcs8QULqlbzA7V1a0tJU10qA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=lcvzvut2Nwpzp/AHoQkIxJefNz82dq6bj3uQdx0vLLE=;
 b=VKZs6RIwzeRC0jXnzAW6Dlh4Ah8kQ8mYflZGwjPEvUEG8MUuipDBUsDzKLEPrhvowF6WZAPChRoYjtwt9ACF6KVLwKNed217JWR+NN8Um+hh3sFs+kH4po2lEwTb3LrtzTqy/Jf6mLevsoL2YzZMHpbXlMACjgTvpFebXYRFtpPBpWRF2/e15hw9yCwV6d4PyVCfk95iaqZRxzGG+ayIKYEmcH6oim4CZcJaTNY61P55YQxcRThfVOnia2ydLEYZWNbYWABm2qb6UK7oZ7TsB5pqFk/OmOxvZEqsEbs4a2iHViI2tvLIUd5sqOO/7+aboyR3yTRprkunfLRTLAGWfw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=pass
 smtp.mailfrom=amd.com;dmarc=pass action=none header.from=amd.com;dkim=pass
 header.d=amd.com;arc=none
Received: from CH2PR12MB3831.namprd12.prod.outlook.com (52.132.245.141) by
 CH2PR12MB3782.namprd12.prod.outlook.com (52.132.245.12) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2073.14; Tue, 16 Jul 2019 17:08:38 +0000
Received: from CH2PR12MB3831.namprd12.prod.outlook.com
 ([fe80::6c10:a243:58ee:29e2]) by CH2PR12MB3831.namprd12.prod.outlook.com
 ([fe80::6c10:a243:58ee:29e2%4]) with mapi id 15.20.2073.012; Tue, 16 Jul 2019
 17:08:38 +0000
From: "Kim, Jonathan" <Jonathan.Kim@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 2/3] drm/amdgpu: add perfmon and fica atomics for df
Thread-Topic: [PATCH 2/3] drm/amdgpu: add perfmon and fica atomics for df
Thread-Index: AQHVO/kciHXsTpwjmkCzl7i5kFXriQ==
Date: Tue, 16 Jul 2019 17:08:38 +0000
Message-ID: <20190716170825.97385-1-jonathan.kim@amd.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: YTOPR0101CA0066.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b00:14::43) To CH2PR12MB3831.namprd12.prod.outlook.com
 (2603:10b6:610:29::13)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.17.1
x-originating-ip: [165.204.55.251]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: e6463865-b679-4542-5aad-08d70a103e76
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(4618075)(2017052603328)(7193020);
 SRVR:CH2PR12MB3782; 
x-ms-traffictypediagnostic: CH2PR12MB3782:
x-microsoft-antispam-prvs: <CH2PR12MB3782043B10FCD42D5DAA8E3485CE0@CH2PR12MB3782.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:2958;
x-forefront-prvs: 0100732B76
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(4636009)(366004)(396003)(136003)(376002)(346002)(39860400002)(199004)(189003)(2501003)(2351001)(5640700003)(8676002)(476003)(2616005)(6916009)(66066001)(6486002)(486006)(14454004)(2906002)(386003)(6506007)(6436002)(102836004)(14444005)(52116002)(256004)(36756003)(26005)(186003)(66476007)(66556008)(66946007)(3846002)(6116002)(50226002)(66446008)(71190400001)(71200400001)(99286004)(316002)(54906003)(7736002)(6512007)(68736007)(81156014)(5660300002)(81166006)(53936002)(478600001)(8936002)(86362001)(4326008)(64756008)(1076003)(305945005)(25786009);
 DIR:OUT; SFP:1101; SCL:1; SRVR:CH2PR12MB3782;
 H:CH2PR12MB3831.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: VtcEQkKu/My5WZ8cU6ghAk9gpp9OeF8xmTpipD8qRXBmmBSTU4GE8G39baa6FwKBqrqaonJomAcD9E6wtMGTUpKTMEmjy3d+96yGBc3r3JpNFs1UcncIc800o0Y+Uv44SNslPlH1JxRsenxFeSGehPsPbHu9WxgKgrQSofyYpZtxxWxHATdrHRmJFAeBLymFhCvBh7PFZxL9c5hLx2Xt+Bm+f+XBzy+m//oofJI7iG9Bqy0astf/+zKNTyvIiP8aWhxeVM/2slRmMDgSUSlV+nOoSQ9/eOmkKeFJOZRXt6YNg/JNevz9C/vl97DFF9jMHrYXW2jx1IMbbPbnTfd0pNjNWFJr1KT3Ellzzns5JXsyvIu/ZdOUQa/ayrL1t+tdI5z6tsdUp9FtZzyttIrGuEzGldViYNQbvvjKfCZWzVU=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: e6463865-b679-4542-5aad-08d70a103e76
X-MS-Exchange-CrossTenant-originalarrivaltime: 16 Jul 2019 17:08:38.2021 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: jokim@amd.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: CH2PR12MB3782
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=lcvzvut2Nwpzp/AHoQkIxJefNz82dq6bj3uQdx0vLLE=;
 b=XpFSjCoWolPsYqrDhWhX6s1Gf/Ns3SCY/QvFWc4iWmGAuEsxfRaOJcyZJKHAU1cwfQ2BmtQ/xIMGEtA7/FHMCe9Z2kcBncKGQqJ0T1J4AsT/jFwjAQzw01Hk6dS2VUMUBYninH2F+W6/qeySPN9iQXHkGFllOrCNvkGbtxXhBG4=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Jonathan.Kim@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Kim, Jonathan" <Jonathan.Kim@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

YWRkaW5nIHBlcmZtb24gYW5kIGZpY2EgYXRvbWljIG9wZXJhdGlvbnMgdG8gYWRoZXJlIHRvIGRh
dGEgZmFicmljcyBmaW5pdGUKc3RhdGUgbWFjaGluZSByZXF1aXJlbWVudHMgZm9yIGluZGlyZWN0
IHJlZ2lzdGVyIGFjY2Vzcy4KCkNoYW5nZS1JZDogSTJhYjE3ZmQ1OWQ1NjZiNDI1MWM5YTlkMGU2
N2I4OTdiOGMyMjEyNDkKU2lnbmVkLW9mZi1ieTogSm9uYXRoYW4gS2ltIDxKb25hdGhhbi5LaW1A
YW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaCAgfCAgIDMg
KwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jIHwgMjAyICsrKysrKysrKysr
KysrKysrLS0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAxMjggaW5zZXJ0aW9ucygrKSwgNzcg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1LmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaAppbmRleCAyY2RmNDZi
YmVkZGYuLjc3Y2ExOTRiMTNkMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmgKQEAg
LTcwOCw2ICs3MDgsOSBAQCBzdHJ1Y3QgYW1kZ3B1X2RmX2Z1bmNzIHsKIAkJCQkJIGludCBpc19k
aXNhYmxlKTsKIAl2b2lkICgqcG1jX2dldF9jb3VudCkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsIHVpbnQ2NF90IGNvbmZpZywKIAkJCQkJIHVpbnQ2NF90ICpjb3VudCk7CisJdWludDY0X3Qg
KCpnZXRfZmljYSkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IGZpY2FhX3Zh
bCk7CisJdm9pZCAoKnNldF9maWNhKShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdWludDMy
X3QgZmljYWFfdmFsLAorCQkJIHVpbnQzMl90IGZpY2FkbF92YWwsIHVpbnQzMl90IGZpY2FkaF92
YWwpOwogfTsKIC8qIERlZmluZSB0aGUgSFcgSVAgYmxvY2tzIHdpbGwgYmUgdXNlZCBpbiBkcml2
ZXIgLCBhZGQgbW9yZSBpZiBuZWNlc3NhcnkgKi8KIGVudW0gYW1kX2h3X2lwX2Jsb2NrX3R5cGUg
ewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jCmluZGV4IGVmNmU5MWY5ZjUxYy4uNTg1
MGM4ZTM0Y2FhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9kZl92M182
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jCkBAIC05Myw2ICs5
Myw5NiBAQCBjb25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwICpkZl92M182X2F0dHJfZ3JvdXBz
W10gPSB7CiAJCU5VTEwKIH07CiAKK3N0YXRpYyB1aW50NjRfdCBkZl92M182X2dldF9maWNhKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJCSB1aW50MzJfdCBmaWNhYV92YWwpCit7CisJ
dW5zaWduZWQgbG9uZyBmbGFncywgYWRkcmVzcywgZGF0YTsKKwl1aW50MzJfdCBmaWNhZGxfdmFs
LCBmaWNhZGhfdmFsOworCisJYWRkcmVzcyA9IGFkZXYtPm5iaW9fZnVuY3MtPmdldF9wY2llX2lu
ZGV4X29mZnNldChhZGV2KTsKKwlkYXRhID0gYWRldi0+bmJpb19mdW5jcy0+Z2V0X3BjaWVfZGF0
YV9vZmZzZXQoYWRldik7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmYWRldi0+cGNpZV9pZHhfbG9j
aywgZmxhZ3MpOworCVdSRUczMihhZGRyZXNzLCBzbW5ERl9QSUVfQU9OX0ZhYnJpY0luZGlyZWN0
Q29uZmlnQWNjZXNzQWRkcmVzczMpOworCVdSRUczMihkYXRhLCBmaWNhYV92YWwpOworCisJV1JF
RzMyKGFkZHJlc3MsIHNtbkRGX1BJRV9BT05fRmFicmljSW5kaXJlY3RDb25maWdBY2Nlc3NEYXRh
TG8zKTsKKwlmaWNhZGxfdmFsID0gUlJFRzMyKGRhdGEpOworCisJV1JFRzMyKGFkZHJlc3MsIHNt
bkRGX1BJRV9BT05fRmFicmljSW5kaXJlY3RDb25maWdBY2Nlc3NEYXRhSGkzKTsKKwlmaWNhZGhf
dmFsID0gUlJFRzMyKGRhdGEpOworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYWRldi0+cGNp
ZV9pZHhfbG9jaywgZmxhZ3MpOworCisJcmV0dXJuICgoKGZpY2FkaF92YWwgJiAweEZGRkZGRkZG
RkZGRkZGRkYpIDw8IDMyKSB8IGZpY2FkbF92YWwpOworfQorCitzdGF0aWMgdm9pZCBkZl92M182
X3NldF9maWNhKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50MzJfdCBmaWNhYV92YWws
CisJCQkgICAgIHVpbnQzMl90IGZpY2FkbF92YWwsIHVpbnQzMl90IGZpY2FkaF92YWwpCit7CisJ
dW5zaWduZWQgbG9uZyBmbGFncywgYWRkcmVzcywgZGF0YTsKKworCWFkZHJlc3MgPSBhZGV2LT5u
YmlvX2Z1bmNzLT5nZXRfcGNpZV9pbmRleF9vZmZzZXQoYWRldik7CisJZGF0YSA9IGFkZXYtPm5i
aW9fZnVuY3MtPmdldF9wY2llX2RhdGFfb2Zmc2V0KGFkZXYpOworCisJc3Bpbl9sb2NrX2lycXNh
dmUoJmFkZXYtPnBjaWVfaWR4X2xvY2ssIGZsYWdzKTsKKwlXUkVHMzIoYWRkcmVzcywgc21uREZf
UElFX0FPTl9GYWJyaWNJbmRpcmVjdENvbmZpZ0FjY2Vzc0FkZHJlc3MzKTsKKwlXUkVHMzIoZGF0
YSwgZmljYWFfdmFsKTsKKworCVdSRUczMihhZGRyZXNzLCBzbW5ERl9QSUVfQU9OX0ZhYnJpY0lu
ZGlyZWN0Q29uZmlnQWNjZXNzRGF0YUxvMyk7CisJV1JFRzMyKGRhdGEsIGZpY2FkbF92YWwpOwor
CisJV1JFRzMyKGFkZHJlc3MsIHNtbkRGX1BJRV9BT05fRmFicmljSW5kaXJlY3RDb25maWdBY2Nl
c3NEYXRhSGkzKTsKKwlXUkVHMzIoZGF0YSwgZmljYWRoX3ZhbCk7CisKKwlzcGluX3VubG9ja19p
cnFyZXN0b3JlKCZhZGV2LT5wY2llX2lkeF9sb2NrLCBmbGFncyk7Cit9CisKKy8qCisgKiBkZl92
M182X3BlcmZtb25fcnJlZyAtIHJlYWQgcGVyZm1vbiBsbyBhbmQgaGkKKyAqCisgKiByZXF1aXJl
ZCB0byBiZSBhdG9taWMuICBubyBtbWlvIG1ldGhvZCBwcm92aWRlZCBzbyBzdWJzZXF1ZW50IHJl
YWRzIGZvciBsbworICogYW5kIGhpIHJlcXVpcmUgdG8gcHJlc2VydmUgZGYgZmluaXRlIHN0YXRl
IG1hY2hpbmUKKyAqLworc3RhdGljIHZvaWQgZGZfdjNfNl9wZXJmbW9uX3JyZWcoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsCisJCQkgICAgdWludDMyX3QgbG9fYWRkciwgdWludDMyX3QgKmxv
X3ZhbCwKKwkJCSAgICB1aW50MzJfdCBoaV9hZGRyLCB1aW50MzJfdCAqaGlfdmFsKQoreworCXVu
c2lnbmVkIGxvbmcgZmxhZ3MsIGFkZHJlc3MsIGRhdGE7CisKKwlhZGRyZXNzID0gYWRldi0+bmJp
b19mdW5jcy0+Z2V0X3BjaWVfaW5kZXhfb2Zmc2V0KGFkZXYpOworCWRhdGEgPSBhZGV2LT5uYmlv
X2Z1bmNzLT5nZXRfcGNpZV9kYXRhX29mZnNldChhZGV2KTsKKworCXNwaW5fbG9ja19pcnFzYXZl
KCZhZGV2LT5wY2llX2lkeF9sb2NrLCBmbGFncyk7CisJV1JFRzMyKGFkZHJlc3MsIGxvX2FkZHIp
OworCSpsb192YWwgPSBSUkVHMzIoZGF0YSk7CisJV1JFRzMyKGFkZHJlc3MsIGhpX2FkZHIpOwor
CSpoaV92YWwgPSBSUkVHMzIoZGF0YSk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYWRldi0+
cGNpZV9pZHhfbG9jaywgZmxhZ3MpOworfQorCisvKgorICogZGZfdjNfNl9wZXJmbW9uX3dyZWcg
LSB3cml0ZSB0byBwZXJmbW9uIGxvIGFuZCBoaQorICoKKyAqIHJlcXVpcmVkIHRvIGJlIGF0b21p
Yy4gIG5vIG1taW8gbWV0aG9kIHByb3ZpZGVkIHNvIHN1YnNlcXVlbnQgcmVhZHMgYWZ0ZXIKKyAq
IGRhdGEgd3JpdGVzIGNhbm5vdCBvY2N1ciB0byBwcmVzZXJ2ZSBkYXRhIGZhYnJpY3MgZmluaXRl
IHN0YXRlIG1hY2hpbmUuCisgKi8KK3N0YXRpYyB2b2lkIGRmX3YzXzZfcGVyZm1vbl93cmVnKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50MzJfdCBsb19hZGRyLAorCQkJICAgIHVpbnQz
Ml90IGxvX3ZhbCwgdWludDMyX3QgaGlfYWRkciwgdWludDMyX3QgaGlfdmFsKQoreworCXVuc2ln
bmVkIGxvbmcgZmxhZ3MsIGFkZHJlc3MsIGRhdGE7CisKKwlhZGRyZXNzID0gYWRldi0+bmJpb19m
dW5jcy0+Z2V0X3BjaWVfaW5kZXhfb2Zmc2V0KGFkZXYpOworCWRhdGEgPSBhZGV2LT5uYmlvX2Z1
bmNzLT5nZXRfcGNpZV9kYXRhX29mZnNldChhZGV2KTsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZh
ZGV2LT5wY2llX2lkeF9sb2NrLCBmbGFncyk7CisJV1JFRzMyKGFkZHJlc3MsIGxvX2FkZHIpOwor
CVdSRUczMihkYXRhLCBsb192YWwpOworCVdSRUczMihhZGRyZXNzLCBoaV9hZGRyKTsKKwlXUkVH
MzIoZGF0YSwgaGlfdmFsKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZhZGV2LT5wY2llX2lk
eF9sb2NrLCBmbGFncyk7Cit9CisKIC8qIGdldCB0aGUgbnVtYmVyIG9mIGRmIGNvdW50ZXJzIGF2
YWlsYWJsZSAqLwogc3RhdGljIHNzaXplX3QgZGZfdjNfNl9nZXRfZGZfY250cl9hdmFpbChzdHJ1
Y3QgZGV2aWNlICpkZXYsCiAJCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLApAQCAtMjY4
LDYgKzM1OCwxMCBAQCBzdGF0aWMgaW50IGRmX3YzXzZfcG1jX2dldF9jdHJsX3NldHRpbmdzKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkJCQkgIHVpbnQzMl90ICpsb192YWwsCiAJCQkJ
CSAgdWludDMyX3QgKmhpX3ZhbCkKIHsKKworCXVpbnQzMl90IGV2ZW50c2VsLCBpbnN0YW5jZSwg
dW5pdG1hc2s7CisJdWludDMyX3QgaW5zdGFuY2VfMTAsIGluc3RhbmNlXzU0MzIsIGluc3RhbmNl
Xzc2OworCiAJZGZfdjNfNl9wbWNfZ2V0X2FkZHIoYWRldiwgY29uZmlnLCAxLCBsb19iYXNlX2Fk
ZHIsIGhpX2Jhc2VfYWRkcik7CiAKIAlpZiAoKCpsb19iYXNlX2FkZHIgPT0gMCkgfHwgKCpoaV9i
YXNlX2FkZHIgPT0gMCkpIHsKQEAgLTI3Niw0MCArMzcwLDMzIEBAIHN0YXRpYyBpbnQgZGZfdjNf
Nl9wbWNfZ2V0X2N0cmxfc2V0dGluZ3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCXJl
dHVybiAtRU5YSU87CiAJfQogCi0JaWYgKGxvX3ZhbCAmJiBoaV92YWwpIHsKLQkJdWludDMyX3Qg
ZXZlbnRzZWwsIGluc3RhbmNlLCB1bml0bWFzazsKLQkJdWludDMyX3QgaW5zdGFuY2VfMTAsIGlu
c3RhbmNlXzU0MzIsIGluc3RhbmNlXzc2OworCWV2ZW50c2VsID0gREZfVjNfNl9HRVRfRVZFTlQo
Y29uZmlnKSAmIDB4M2Y7CisJdW5pdG1hc2sgPSBERl9WM182X0dFVF9VTklUTUFTSyhjb25maWcp
ICYgMHhmOworCWluc3RhbmNlID0gREZfVjNfNl9HRVRfSU5TVEFOQ0UoY29uZmlnKTsKIAotCQll
dmVudHNlbCA9IERGX1YzXzZfR0VUX0VWRU5UKGNvbmZpZykgJiAweDNmOwotCQl1bml0bWFzayA9
IERGX1YzXzZfR0VUX1VOSVRNQVNLKGNvbmZpZykgJiAweGY7Ci0JCWluc3RhbmNlID0gREZfVjNf
Nl9HRVRfSU5TVEFOQ0UoY29uZmlnKTsKKwlpbnN0YW5jZV8xMCA9IGluc3RhbmNlICYgMHgzOwor
CWluc3RhbmNlXzU0MzIgPSAoaW5zdGFuY2UgPj4gMikgJiAweGY7CisJaW5zdGFuY2VfNzYgPSAo
aW5zdGFuY2UgPj4gNikgJiAweDM7CiAKLQkJaW5zdGFuY2VfMTAgPSBpbnN0YW5jZSAmIDB4MzsK
LQkJaW5zdGFuY2VfNTQzMiA9IChpbnN0YW5jZSA+PiAyKSAmIDB4ZjsKLQkJaW5zdGFuY2VfNzYg
PSAoaW5zdGFuY2UgPj4gNikgJiAweDM7CisJKmxvX3ZhbCA9ICh1bml0bWFzayA8PCA4KSB8IChp
bnN0YW5jZV8xMCA8PCA2KSB8IGV2ZW50c2VsIHwgKDEgPDwgMjIpOworCSpoaV92YWwgPSAoaW5z
dGFuY2VfNzYgPDwgMjkpIHwgaW5zdGFuY2VfNTQzMjsKIAotCQkqbG9fdmFsID0gKHVuaXRtYXNr
IDw8IDgpIHwgKGluc3RhbmNlXzEwIDw8IDYpIHwgZXZlbnRzZWw7Ci0JCSpoaV92YWwgPSAoaW5z
dGFuY2VfNzYgPDwgMjkpIHwgaW5zdGFuY2VfNTQzMjsKLQl9CisJRFJNX0RFQlVHX0RSSVZFUigi
Y29uZmlnPSVsbHggYWRkcj0lMDh4OiUwOHggdmFsPSUwOHg6JTA4eCIsCisJCWNvbmZpZywgKmxv
X2Jhc2VfYWRkciwgKmhpX2Jhc2VfYWRkciwgKmxvX3ZhbCwgKmhpX3ZhbCk7CiAKIAlyZXR1cm4g
MDsKIH0KIAotLyogYXNzaWduIGRmIHBlcmZvcm1hbmNlIGNvdW50ZXJzIGZvciByZWFkICovCi1z
dGF0aWMgaW50IGRmX3YzXzZfcG1jX2Fzc2lnbl9jbnRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LAotCQkJCSAgIHVpbnQ2NF90IGNvbmZpZywKLQkJCQkgICBpbnQgKmlzX2Fzc2lnbmVkKQor
LyogYWRkIGRmIHBlcmZvcm1hbmNlIGNvdW50ZXJzIGZvciByZWFkICovCitzdGF0aWMgaW50IGRm
X3YzXzZfcG1jX2FkZF9jbnRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJCSAgIHVp
bnQ2NF90IGNvbmZpZykKIHsKIAlpbnQgaSwgdGFyZ2V0X2NudHI7CiAKLQkqaXNfYXNzaWduZWQg
PSAwOwotCiAJdGFyZ2V0X2NudHIgPSBkZl92M182X3BtY19jb25maWdfMl9jbnRyKGFkZXYsIGNv
bmZpZyk7CiAKLQlpZiAodGFyZ2V0X2NudHIgPj0gMCkgewotCQkqaXNfYXNzaWduZWQgPSAxOwor
CWlmICh0YXJnZXRfY250ciA+PSAwKQogCQlyZXR1cm4gMDsKLQl9CiAKIAlmb3IgKGkgPSAwOyBp
IDwgREZfVjNfNl9NQVhfQ09VTlRFUlM7IGkrKykgewogCQlpZiAoYWRldi0+ZGZfcGVyZm1vbl9j
b25maWdfYXNzaWduX21hc2tbaV0gPT0gMFUpIHsKQEAgLTM0NCw0NSArNDMxLDEzIEBAIHN0YXRp
YyB2b2lkIGRmX3YzXzZfcmVzZXRfcGVyZm1vbl9jbnRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LAogCWlmICgobG9fYmFzZV9hZGRyID09IDApIHx8IChoaV9iYXNlX2FkZHIgPT0gMCkpCiAJ
CXJldHVybjsKIAotCVdSRUczMl9QQ0lFKGxvX2Jhc2VfYWRkciwgMFVMKTsKLQlXUkVHMzJfUENJ
RShoaV9iYXNlX2FkZHIsIDBVTCk7Ci19Ci0KLQotc3RhdGljIGludCBkZl92M182X2FkZF9wZXJm
bW9uX2NudHIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCi0JCQkJICAgICAgdWludDY0X3Qg
Y29uZmlnKQotewotCXVpbnQzMl90IGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWws
IGhpX3ZhbDsKLQlpbnQgcmV0LCBpc19hc3NpZ25lZDsKLQotCXJldCA9IGRmX3YzXzZfcG1jX2Fz
c2lnbl9jbnRyKGFkZXYsIGNvbmZpZywgJmlzX2Fzc2lnbmVkKTsKLQotCWlmIChyZXQgfHwgaXNf
YXNzaWduZWQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBkZl92M182X3BtY19nZXRfY3RybF9z
ZXR0aW5ncyhhZGV2LAotCQkJY29uZmlnLAotCQkJJmxvX2Jhc2VfYWRkciwKLQkJCSZoaV9iYXNl
X2FkZHIsCi0JCQkmbG9fdmFsLAotCQkJJmhpX3ZhbCk7Ci0KLQlpZiAocmV0KQotCQlyZXR1cm4g
cmV0OwotCi0JRFJNX0RFQlVHX0RSSVZFUigiY29uZmlnPSVsbHggYWRkcj0lMDh4OiUwOHggdmFs
PSUwOHg6JTA4eCIsCi0JCQljb25maWcsIGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192
YWwsIGhpX3ZhbCk7Ci0KLQlXUkVHMzJfUENJRShsb19iYXNlX2FkZHIsIGxvX3ZhbCk7Ci0JV1JF
RzMyX1BDSUUoaGlfYmFzZV9hZGRyLCBoaV92YWwpOwotCi0JcmV0dXJuIHJldDsKKwlkZl92M182
X3BlcmZtb25fd3JlZyhhZGV2LCBsb19iYXNlX2FkZHIsIDAsIGhpX2Jhc2VfYWRkciwgMCk7CiB9
CiAKIHN0YXRpYyBpbnQgZGZfdjNfNl9wbWNfc3RhcnQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsIHVpbnQ2NF90IGNvbmZpZywKIAkJCSAgICAgaW50IGlzX2VuYWJsZSkKIHsKLQl1aW50MzJf
dCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwgbG9fdmFsOworCXVpbnQzMl90IGxvX2Jhc2Vf
YWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWwsIGhpX3ZhbDsKIAlpbnQgcmV0ID0gMDsKIAogCXN3
aXRjaCAoYWRldi0+YXNpY190eXBlKSB7CkBAIC0zOTEsMjQgKzQ0NiwyMCBAQCBzdGF0aWMgaW50
IGRmX3YzXzZfcG1jX3N0YXJ0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50NjRfdCBj
b25maWcsCiAJCWRmX3YzXzZfcmVzZXRfcGVyZm1vbl9jbnRyKGFkZXYsIGNvbmZpZyk7CiAKIAkJ
aWYgKGlzX2VuYWJsZSkgewotCQkJcmV0ID0gZGZfdjNfNl9hZGRfcGVyZm1vbl9jbnRyKGFkZXYs
IGNvbmZpZyk7CisJCQlyZXQgPSBkZl92M182X3BtY19hZGRfY250cihhZGV2LCBjb25maWcpOwog
CQl9IGVsc2UgewogCQkJcmV0ID0gZGZfdjNfNl9wbWNfZ2V0X2N0cmxfc2V0dGluZ3MoYWRldiwK
IAkJCQkJY29uZmlnLAogCQkJCQkmbG9fYmFzZV9hZGRyLAogCQkJCQkmaGlfYmFzZV9hZGRyLAot
CQkJCQlOVUxMLAotCQkJCQlOVUxMKTsKKwkJCQkJJmxvX3ZhbCwKKwkJCQkJJmhpX3ZhbCk7CiAK
IAkJCWlmIChyZXQpCiAJCQkJcmV0dXJuIHJldDsKIAotCQkJbG9fdmFsID0gUlJFRzMyX1BDSUUo
bG9fYmFzZV9hZGRyKTsKLQotCQkJRFJNX0RFQlVHX0RSSVZFUigiY29uZmlnPSVsbHggYWRkcj0l
MDh4OiUwOHggdmFsPSUwOHgiLAotCQkJCWNvbmZpZywgbG9fYmFzZV9hZGRyLCBoaV9iYXNlX2Fk
ZHIsIGxvX3ZhbCk7Ci0KLQkJCVdSRUczMl9QQ0lFKGxvX2Jhc2VfYWRkciwgbG9fdmFsIHwgKDFV
TEwgPDwgMjIpKTsKKwkJCWRmX3YzXzZfcGVyZm1vbl93cmVnKGFkZXYsIGxvX2Jhc2VfYWRkciwg
bG9fdmFsLAorCQkJCQloaV9iYXNlX2FkZHIsIGhpX3ZhbCk7CiAJCX0KIAogCQlicmVhazsKQEAg
LTQyMiw3ICs0NzMsNyBAQCBzdGF0aWMgaW50IGRmX3YzXzZfcG1jX3N0YXJ0KHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LCB1aW50NjRfdCBjb25maWcsCiBzdGF0aWMgaW50IGRmX3YzXzZfcG1j
X3N0b3Aoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQ2NF90IGNvbmZpZywKIAkJCSAg
ICBpbnQgaXNfZGlzYWJsZSkKIHsKLQl1aW50MzJfdCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRk
ciwgbG9fdmFsOworCXVpbnQzMl90IGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWws
IGhpX3ZhbDsKIAlpbnQgcmV0ID0gMDsKIAogCXN3aXRjaCAoYWRldi0+YXNpY190eXBlKSB7CkBA
IC00MzEsMTggKzQ4MiwxMyBAQCBzdGF0aWMgaW50IGRmX3YzXzZfcG1jX3N0b3Aoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQ2NF90IGNvbmZpZywKIAkJCWNvbmZpZywKIAkJCSZsb19i
YXNlX2FkZHIsCiAJCQkmaGlfYmFzZV9hZGRyLAotCQkJTlVMTCwKLQkJCU5VTEwpOworCQkJJmxv
X3ZhbCwKKwkJCSZoaV92YWwpOwogCiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCi0JCWxv
X3ZhbCA9IFJSRUczMl9QQ0lFKGxvX2Jhc2VfYWRkcik7Ci0KLQkJRFJNX0RFQlVHX0RSSVZFUigi
Y29uZmlnPSVsbHggYWRkcj0lMDh4OiUwOHggdmFsPSUwOHgiLAotCQkJCWNvbmZpZywgbG9fYmFz
ZV9hZGRyLCBoaV9iYXNlX2FkZHIsIGxvX3ZhbCk7Ci0KLQkJV1JFRzMyX1BDSUUobG9fYmFzZV9h
ZGRyLCBsb192YWwgJiB+KDFVTEwgPDwgMjIpKTsKKwkJZGZfdjNfNl9wZXJmbW9uX3dyZWcoYWRl
diwgbG9fYmFzZV9hZGRyLCAwLCBoaV9iYXNlX2FkZHIsIDApOwogCiAJCWlmIChpc19kaXNhYmxl
KQogCQkJZGZfdjNfNl9wbWNfcmVsZWFzZV9jbnRyKGFkZXYsIGNvbmZpZyk7CkBAIC00NzEsOCAr
NTE3LDggQEAgc3RhdGljIHZvaWQgZGZfdjNfNl9wbWNfZ2V0X2NvdW50KHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LAogCQlpZiAoKGxvX2Jhc2VfYWRkciA9PSAwKSB8fCAoaGlfYmFzZV9hZGRy
ID09IDApKQogCQkJcmV0dXJuOwogCi0JCWxvX3ZhbCA9IFJSRUczMl9QQ0lFKGxvX2Jhc2VfYWRk
cik7Ci0JCWhpX3ZhbCA9IFJSRUczMl9QQ0lFKGhpX2Jhc2VfYWRkcik7CisJCWRmX3YzXzZfcGVy
Zm1vbl9ycmVnKGFkZXYsIGxvX2Jhc2VfYWRkciwgJmxvX3ZhbCwKKwkJCQloaV9iYXNlX2FkZHIs
ICZoaV92YWwpOwogCiAJCSpjb3VudCAgPSAoKGhpX3ZhbCB8IDBVTEwpIDw8IDMyKSB8IChsb192
YWwgfCAwVUxMKTsKIApAQCAtNDgwLDcgKzUyNiw3IEBAIHN0YXRpYyB2b2lkIGRmX3YzXzZfcG1j
X2dldF9jb3VudChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCSpjb3VudCA9IDA7CiAK
IAkJRFJNX0RFQlVHX0RSSVZFUigiY29uZmlnPSVsbHggYWRkcj0lMDh4OiUwOHggdmFsPSUwOHg6
JTA4eCIsCi0JCQljb25maWcsIGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWwsIGhp
X3ZhbCk7CisJCQkgY29uZmlnLCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwgbG9fdmFsLCBo
aV92YWwpOwogCiAJCWJyZWFrOwogCkBAIC00OTksNSArNTQ1LDcgQEAgY29uc3Qgc3RydWN0IGFt
ZGdwdV9kZl9mdW5jcyBkZl92M182X2Z1bmNzID0gewogCS5nZXRfY2xvY2tnYXRpbmdfc3RhdGUg
PSBkZl92M182X2dldF9jbG9ja2dhdGluZ19zdGF0ZSwKIAkucG1jX3N0YXJ0ID0gZGZfdjNfNl9w
bWNfc3RhcnQsCiAJLnBtY19zdG9wID0gZGZfdjNfNl9wbWNfc3RvcCwKLQkucG1jX2dldF9jb3Vu
dCA9IGRmX3YzXzZfcG1jX2dldF9jb3VudAorCS5wbWNfZ2V0X2NvdW50ID0gZGZfdjNfNl9wbWNf
Z2V0X2NvdW50LAorCS5nZXRfZmljYSA9IGRmX3YzXzZfZ2V0X2ZpY2EsCisJLnNldF9maWNhID0g
ZGZfdjNfNl9zZXRfZmljYQogfTsKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9hbWQtZ2Z4
