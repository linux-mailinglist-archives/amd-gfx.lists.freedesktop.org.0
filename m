Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 87F997B85B
	for <lists+amd-gfx@lfdr.de>; Wed, 31 Jul 2019 05:53:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B21606E666;
	Wed, 31 Jul 2019 03:53:57 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM04-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr700050.outbound.protection.outlook.com [40.107.70.50])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E820D6E666
 for <amd-gfx@lists.freedesktop.org>; Wed, 31 Jul 2019 03:53:55 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=Qbm/MhoWWYTHEB9s2Y4rm9HA8d9eBqfOy/hC0ZfuH4wZ8xUHW46Gi91pHQicJ+3JXRQofCC+VzqeGwOwyDWqkUPUYiqb1pN4L8aZtN+MXEpbK4Jsybl0Y9alE+dmzqAFzKCgOWw2g18asmvMWpzkT4WoDamc5sRneMSZfH4hRXCUKnGJ0vBA8+t36F8ACNOEo2awaFsCc+ENBIlz5TMhNh8VneuifaPSbFrpalxIQNpEmTXVUAumExdplX7odXdfU6WzjeQRbCn5iw1tuuXTwTBdawVTIfcZi9vVUMLz9CSUSig05P+a+wBs9KAbbpW1D6Dq+0ic6KlfWU/kcQDb2g==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=4F2VOooHdAAFqRyNmMRREvoiVr6G+iuUbu+RroCABds=;
 b=junkOaP5sTrAnRYJKMYy85FwpFIbf6xjnLaJ8AThOE18SlPOnR3ig15es9NJ4s7SRH6Wr9AWA9GKyWhwzRjnGrZZWLu6FcH+9AT0Ha0wV0hSus31TsPWc6bLsFhVJ0BwpkG6GL1kdkD/V4rVuxofzcueFkknBUuqt+k8Yh2CkhAvFTWFwZ+2Dk5eoTBYD5t/vKVrB8UiJiMZaXqDuvwHI+ApsH00ear3BzRiEOIJjPLW5MuF/Mz0HoLM8nqyj8qIjkIbsl/KBfEefwRuKll+yxKifEwIzsFDHEnTWEVnJhH8Dpu+qZAmSY+PR8sh4JTFrgANa+MiMLq3tYhrJ300+Q==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org
 smtp.mailfrom=amd.com;dmarc=permerror action=none
 header.from=amd.com;dkim=none (message not signed);arc=none
Received: from DM5PR12CA0024.namprd12.prod.outlook.com (2603:10b6:4:1::34) by
 BL0PR12MB2532.namprd12.prod.outlook.com (2603:10b6:207:4a::20) with
 Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2115.15; Wed, 31 Jul 2019 03:53:53 +0000
Received: from CO1NAM03FT059.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e48::207) by DM5PR12CA0024.outlook.office365.com
 (2603:10b6:4:1::34) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2115.15 via Frontend
 Transport; Wed, 31 Jul 2019 03:53:53 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV02.amd.com (165.204.84.17) by
 CO1NAM03FT059.mail.protection.outlook.com (10.152.81.192) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2115.10 via Frontend Transport; Wed, 31 Jul 2019 03:53:52 +0000
Received: from monk-build.amd.com (10.34.1.3) by SATLEXCHOV02.amd.com
 (10.181.40.72) with Microsoft SMTP Server id 14.3.389.1; Tue, 30 Jul 2019
 22:53:51 -0500
From: Monk Liu <Monk.Liu@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 1/3] drm/amdgpu: cleanup vega10 SRIOV code path
Date: Wed, 31 Jul 2019 11:53:44 +0800
Message-ID: <1564545226-2633-1-git-send-email-Monk.Liu@amd.com>
X-Mailer: git-send-email 2.7.4
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(376002)(396003)(39860400002)(346002)(136003)(2980300002)(428003)(189003)(199004)(6666004)(81156014)(81166006)(68736007)(8676002)(6916009)(47776003)(36756003)(2351001)(26005)(186003)(53936002)(7696005)(51416003)(53416004)(50226002)(8936002)(305945005)(356004)(70206006)(2906002)(316002)(70586007)(336012)(48376002)(16586007)(126002)(86362001)(486006)(30864003)(5660300002)(50466002)(478600001)(4326008)(14444005)(2616005)(426003)(476003)(309714004);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BL0PR12MB2532; H:SATLEXCHOV02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 473d693d-650c-4a1f-87d5-08d7156ab439
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(2017052603328);
 SRVR:BL0PR12MB2532; 
X-MS-TrafficTypeDiagnostic: BL0PR12MB2532:
X-Microsoft-Antispam-PRVS: <BL0PR12MB25324DF2FE4C0015115D22D284DF0@BL0PR12MB2532.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:7691;
X-Forefront-PRVS: 011579F31F
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: V9f5c2zlrjIXdAHLp2p5YvSoHU7PRW9Z/bckL6vS/ZBv8vALSMy/5WvOt9xqippO/MM+OYGra2Iqf78N5zBzG1YGKwdVDa2u3W+/pz9D/mPirJpFVaNiWM7EXlkwgSbti9BMZ+NoCBtLWBwHkDRzbDSCdTMVpL+9EowSoMsouCVPti01nPy/Y8kUGUzTCDJc5FAFN2X2ThHt1/0eeKwt5qHE/i77aggQDT94+63h2/hOun+8EwwKT5sUJ0nfSIZRmPupu04EHWHLITfwMR+VI6LafZ+hj7qxO9eErq23+Upyqj+RLdFLPfmje+C/HVJwO0z3E6o3i8ZE0bWZmrTFXSoJq/GgyI/yE6Kd4jMU/p39Zl/klPTK29jYfKvZ40H74AgDjh9WnDEPd1SMpCDm4N5Zd0IhJYeEgoHnwvAp/Ig=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 31 Jul 2019 03:53:52.7788 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 473d693d-650c-4a1f-87d5-08d7156ab439
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BL0PR12MB2532
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=4F2VOooHdAAFqRyNmMRREvoiVr6G+iuUbu+RroCABds=;
 b=E8qPqnKzUa0jjJ9P2qNNmxIKtKqqtRaBbpwmX8mMiIdJ75H+8J2DgQd0LRCtFUpnOPPXS/MOEJE0d9w0CvvOMTYh0ESnfGtMJctw9S3BQamQYD4hU0OzfU+fpzLjh/BSStC16tH+u2g01l8lv+8Ij1qJlAGoiAZRH29++dQHn4o=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Monk Liu <Monk.Liu@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

d2UgY2FuIHNpbXBsaWZ5IGFsbCB0aG9zZSB1bm5lY2Vzc2FyeSBmdW5jdGlvbiB1bmRlcgpTUklP
ViBmb3IgdmVnYTEwIHNpbmNlOgoxKSBQU1AgTDEgcG9saWN5IGlzIGJ5IGZvcmNlIGVuYWJsZWQg
aW4gU1JJT1YKMikgb3JpZ2luYWwgbG9naWMgYWx3YXlzIHNldCBhbGwgZmxhZ3Mgd2hpY2ggbWFr
ZSBpdHNlbGYKICAgYSBkdW1teSBzdGVwCgpiZXNpZGVzLAoxKSB0aGUgaWhfZG9vcmJlbGxfcmFu
Z2Ugc2V0IHNob3VsZCBhbHNvIGJlIHNraXBwZWQKZm9yIFZFR0ExMCBTUklPVi4KMikgdGhlIGdm
eF9jb21tb24gcmVnaXN0ZXJzIHNob3VsZCBhbHNvIGJlIHNraXBwZWQKZm9yIFZFR0ExMCBTUklP
Vi4KClNpZ25lZC1vZmYtYnk6IE1vbmsgTGl1IDxNb25rLkxpdUBhbWQuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyB8ICAzIC0tCiBkcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmlydC5jICAgfCA0NSAtLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92aXJ0LmggICB8
IDEzIC0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYyAgICAg
IHwgMTcgKysrKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8wLmMg
ICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9tbWh1Yl92MV8wLmMgICAg
fCAxMCArKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9teGdwdV9haS5jICAgICAg
fCAxNSAtLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zZG1hX3Y0XzAuYyAg
ICAgfCAxNyArKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc29jMTUuYyAg
ICAgICAgIHwgMTEgKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NvYzE1X2Nv
bW1vbi5oICB8ICA1ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3ZlZ2ExMF9paC5j
ICAgICB8IDE4ICsrKysrKy0tLS0tLQogMTEgZmlsZXMgY2hhbmdlZCwgMzggaW5zZXJ0aW9ucygr
KSwgMTE4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9k
ZXZpY2UuYwppbmRleCAxMjdlZDAxLi42Y2IzNThjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2RldmljZS5jCkBAIC0xNTcxLDkgKzE1NzEsNiBAQCBzdGF0aWMgaW50IGFt
ZGdwdV9kZXZpY2VfaXBfZWFybHlfaW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAkJ
ciA9IGFtZGdwdV92aXJ0X3JlcXVlc3RfZnVsbF9ncHUoYWRldiwgdHJ1ZSk7CiAJCWlmIChyKQog
CQkJcmV0dXJuIC1FQUdBSU47Ci0KLQkJLyogcXVlcnkgdGhlIHJlZyBhY2Nlc3MgbW9kZSBhdCB0
aGUgdmVyeSBiZWdpbm5pbmcgKi8KLQkJYW1kZ3B1X3ZpcnRfaW5pdF9yZWdfYWNjZXNzX21vZGUo
YWRldik7CiAJfQogCiAJYWRldi0+cG0ucHBfZmVhdHVyZSA9IGFtZGdwdV9wcF9mZWF0dXJlX21h
c2s7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmlydC5j
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQuYwppbmRleCAxZDY4NzI5
Li5mMDRlYjFhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dmlydC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92aXJ0LmMKQEAg
LTQyNiw0OCArNDI2LDMgQEAgdWludDMyX3QgYW1kZ3B1X3ZpcnRfZ2V0X21jbGsoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsIGJvb2wgbG93ZXN0KQogCiAJcmV0dXJuIGNsazsKIH0KLQotdm9p
ZCBhbWRncHVfdmlydF9pbml0X3JlZ19hY2Nlc3NfbW9kZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldikKLXsKLQlzdHJ1Y3QgYW1kZ3B1X3ZpcnQgKnZpcnQgPSAmYWRldi0+dmlydDsKLQotCWlm
ICh2aXJ0LT5vcHMgJiYgdmlydC0+b3BzLT5pbml0X3JlZ19hY2Nlc3NfbW9kZSkKLQkJdmlydC0+
b3BzLT5pbml0X3JlZ19hY2Nlc3NfbW9kZShhZGV2KTsKLX0KLQotYm9vbCBhbWRncHVfdmlydF9z
dXBwb3J0X3BzcF9wcmdfaWhfcmVnKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQotewotCWJv
b2wgcmV0ID0gZmFsc2U7Ci0Jc3RydWN0IGFtZGdwdV92aXJ0ICp2aXJ0ID0gJmFkZXYtPnZpcnQ7
Ci0KLQlpZiAoYW1kZ3B1X3NyaW92X3ZmKGFkZXYpCi0JCSYmICh2aXJ0LT5yZWdfYWNjZXNzX21v
ZGUgJiBBTURHUFVfVklSVF9SRUdfQUNDRVNTX1BTUF9QUkdfSUgpKQotCQlyZXQgPSB0cnVlOwot
Ci0JcmV0dXJuIHJldDsKLX0KLQotYm9vbCBhbWRncHVfdmlydF9zdXBwb3J0X3JsY19wcmdfcmVn
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQotewotCWJvb2wgcmV0ID0gZmFsc2U7Ci0Jc3Ry
dWN0IGFtZGdwdV92aXJ0ICp2aXJ0ID0gJmFkZXYtPnZpcnQ7Ci0KLQlpZiAoYW1kZ3B1X3NyaW92
X3ZmKGFkZXYpCi0JCSYmICh2aXJ0LT5yZWdfYWNjZXNzX21vZGUgJiBBTURHUFVfVklSVF9SRUdf
QUNDRVNTX1JMQykKLQkJJiYgIShhbWRncHVfc3Jpb3ZfcnVudGltZShhZGV2KSkpCi0JCXJldCA9
IHRydWU7Ci0KLQlyZXR1cm4gcmV0OwotfQotCi1ib29sIGFtZGdwdV92aXJ0X3N1cHBvcnRfc2tp
cF9zZXR0aW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQotewotCWJvb2wgcmV0ID0gZmFs
c2U7Ci0Jc3RydWN0IGFtZGdwdV92aXJ0ICp2aXJ0ID0gJmFkZXYtPnZpcnQ7Ci0KLQlpZiAoYW1k
Z3B1X3NyaW92X3ZmKGFkZXYpCi0JCSYmICh2aXJ0LT5yZWdfYWNjZXNzX21vZGUgJiBBTURHUFVf
VklSVF9SRUdfU0tJUF9TRUVUSU5HKSkKLQkJcmV0ID0gdHJ1ZTsKLQotCXJldHVybiByZXQ7Ci19
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmlydC5oIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQuaAppbmRleCBmNTEwNzczLi5i
MGIyYmRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmly
dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92aXJ0LmgKQEAgLTQ4
LDEyICs0OCw2IEBAIHN0cnVjdCBhbWRncHVfdmZfZXJyb3JfYnVmZmVyIHsKIAl1aW50NjRfdCBk
YXRhW0FNREdQVV9WRl9FUlJPUl9FTlRSWV9TSVpFXTsKIH07CiAKLS8qIEFjY29yZGluZyB0byB0
aGUgZncgZmVhdHVyZSwgc29tZSBuZXcgcmVnIGFjY2VzcyBtb2RlcyBhcmUgc3VwcG9ydGVkICov
Ci0jZGVmaW5lIEFNREdQVV9WSVJUX1JFR19BQ0NFU1NfTEVHQUNZICAgICAgICAgICgxIDw8IDAp
IC8qIGRpcmVjdGx5IG1taW8gKi8KLSNkZWZpbmUgQU1ER1BVX1ZJUlRfUkVHX0FDQ0VTU19QU1Bf
UFJHX0lIICAgICAgKDEgPDwgMSkgLyogYnkgUFNQICovCi0jZGVmaW5lIEFNREdQVV9WSVJUX1JF
R19BQ0NFU1NfUkxDICAgICAgICAgICAgICgxIDw8IDIpIC8qIGJ5IFJMQyAqLwotI2RlZmluZSBB
TURHUFVfVklSVF9SRUdfU0tJUF9TRUVUSU5HICAgICAgICAgICAoMSA8PCAzKSAvKiBTa2lwIHNl
dHRpbmcgcmVnICovCi0KIC8qKgogICogc3RydWN0IGFtZGdwdV92aXJ0X29wcyAtIGFtZGdwdSBk
ZXZpY2UgdmlydCBvcGVyYXRpb25zCiAgKi8KQEAgLTY1LDcgKzU5LDYgQEAgc3RydWN0IGFtZGdw
dV92aXJ0X29wcyB7CiAJdm9pZCAoKnRyYW5zX21zZykoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsIHUzMiByZXEsIHUzMiBkYXRhMSwgdTMyIGRhdGEyLCB1MzIgZGF0YTMpOwogCWludCAoKmdl
dF9wcF9jbGspKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgdHlwZSwgY2hhciAqYnVm
KTsKIAlpbnQgKCpmb3JjZV9kcG1fbGV2ZWwpKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1
MzIgbGV2ZWwpOwotCXZvaWQgKCppbml0X3JlZ19hY2Nlc3NfbW9kZSkoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYpOwogfTsKIAogLyoKQEAgLTMxNSwxMCArMzA4LDQgQEAgaW50IGFtZGdwdV92
aXJ0X2Z3X3Jlc2VydmVfZ2V0X2NoZWNrc3VtKHZvaWQgKm9iaiwgdW5zaWduZWQgbG9uZyBvYmpf
c2l6ZSwKIHZvaWQgYW1kZ3B1X3ZpcnRfaW5pdF9kYXRhX2V4Y2hhbmdlKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2KTsKIHVpbnQzMl90IGFtZGdwdV92aXJ0X2dldF9zY2xrKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LCBib29sIGxvd2VzdCk7CiB1aW50MzJfdCBhbWRncHVfdmlydF9nZXRf
bWNsayhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgYm9vbCBsb3dlc3QpOwotCi12b2lkIGFt
ZGdwdV92aXJ0X2luaXRfcmVnX2FjY2Vzc19tb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KTsKLWJvb2wgYW1kZ3B1X3ZpcnRfc3VwcG9ydF9wc3BfcHJnX2loX3JlZyhzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldik7Ci1ib29sIGFtZGdwdV92aXJ0X3N1cHBvcnRfcmxjX3ByZ19yZWcoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpOwotYm9vbCBhbWRncHVfdmlydF9zdXBwb3J0X3NraXBf
c2V0dGluZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7Ci0KICNlbmRpZgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKaW5kZXggYmQ3ZjQzMS4uYmFjNmQ0ZiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9nZnhfdjlfMC5jCkBAIC0zNDAsMTQgKzM0MCwxMiBAQCBzdGF0aWMg
dm9pZCBnZnhfdjlfMF9pbml0X2dvbGRlbl9yZWdpc3RlcnMoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYpCiB7CiAJc3dpdGNoIChhZGV2LT5hc2ljX3R5cGUpIHsKIAljYXNlIENISVBfVkVHQTEw
OgotCQlpZiAoIWFtZGdwdV92aXJ0X3N1cHBvcnRfc2tpcF9zZXR0aW5nKGFkZXYpKSB7Ci0JCQlz
b2MxNV9wcm9ncmFtX3JlZ2lzdGVyX3NlcXVlbmNlKGFkZXYsCi0JCQkJCQkJIGdvbGRlbl9zZXR0
aW5nc19nY185XzAsCi0JCQkJCQkJIEFSUkFZX1NJWkUoZ29sZGVuX3NldHRpbmdzX2djXzlfMCkp
OwotCQkJc29jMTVfcHJvZ3JhbV9yZWdpc3Rlcl9zZXF1ZW5jZShhZGV2LAotCQkJCQkJCSBnb2xk
ZW5fc2V0dGluZ3NfZ2NfOV8wX3ZnMTAsCi0JCQkJCQkJIEFSUkFZX1NJWkUoZ29sZGVuX3NldHRp
bmdzX2djXzlfMF92ZzEwKSk7Ci0JCX0KKwkJc29jMTVfcHJvZ3JhbV9yZWdpc3Rlcl9zZXF1ZW5j
ZShhZGV2LAorCQkJCQkJZ29sZGVuX3NldHRpbmdzX2djXzlfMCwKKwkJCQkJCUFSUkFZX1NJWkUo
Z29sZGVuX3NldHRpbmdzX2djXzlfMCkpOworCQlzb2MxNV9wcm9ncmFtX3JlZ2lzdGVyX3NlcXVl
bmNlKGFkZXYsCisJCQkJCQlnb2xkZW5fc2V0dGluZ3NfZ2NfOV8wX3ZnMTAsCisJCQkJCQlBUlJB
WV9TSVpFKGdvbGRlbl9zZXR0aW5nc19nY185XzBfdmcxMCkpOwogCQlicmVhazsKIAljYXNlIENI
SVBfVkVHQTEyOgogCQlzb2MxNV9wcm9ncmFtX3JlZ2lzdGVyX3NlcXVlbmNlKGFkZXYsCkBAIC0z
NDI0LDcgKzM0MjIsOCBAQCBzdGF0aWMgaW50IGdmeF92OV8wX2h3X2luaXQodm9pZCAqaGFuZGxl
KQogCWludCByOwogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICopaGFuZGxlOwogCi0JZ2Z4X3Y5XzBfaW5pdF9nb2xkZW5fcmVnaXN0ZXJzKGFkZXYp
OworCWlmICghYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKQorCQlnZnhfdjlfMF9pbml0X2dvbGRlbl9y
ZWdpc3RlcnMoYWRldik7CiAKIAlnZnhfdjlfMF9jb25zdGFudHNfaW5pdChhZGV2KTsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8wLmMKaW5kZXggNWJkOTM3Zi4uNDljNDU0ZCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjlfMC5jCkBAIC0xMTc4LDcgKzExNzgsNyBAQCBz
dGF0aWMgdm9pZCBnbWNfdjlfMF9pbml0X2dvbGRlbl9yZWdpc3RlcnMoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYpCiAKIAlzd2l0Y2ggKGFkZXYtPmFzaWNfdHlwZSkgewogCWNhc2UgQ0hJUF9W
RUdBMTA6Ci0JCWlmIChhbWRncHVfdmlydF9zdXBwb3J0X3NraXBfc2V0dGluZyhhZGV2KSkKKwkJ
aWYgKGFtZGdwdV9zcmlvdl92ZihhZGV2KSkKIAkJCWJyZWFrOwogCQkvKiBmYWxsIHRocm91Z2gg
Ki8KIAljYXNlIENISVBfVkVHQTIwOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvbW1odWJfdjFfMC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvbW1odWJfdjFf
MC5jCmluZGV4IDNhYmQwMmIuLjI5MmYzYjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L21taHViX3YxXzAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9t
bWh1Yl92MV8wLmMKQEAgLTExMSw3ICsxMTEsNyBAQCBzdGF0aWMgdm9pZCBtbWh1Yl92MV8wX2lu
aXRfc3lzdGVtX2FwZXJ0dXJlX3JlZ3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCVdS
RUczMl9TT0MxNShNTUhVQiwgMCwgbW1NQ19WTV9TWVNURU1fQVBFUlRVUkVfSElHSF9BRERSLAog
CQkJICAgICBtYXgoYWRldi0+Z21jLmZiX2VuZCwgYWRldi0+Z21jLmFncF9lbmQpID4+IDE4KTsK
IAotCWlmIChhbWRncHVfdmlydF9zdXBwb3J0X3NraXBfc2V0dGluZyhhZGV2KSkKKwlpZiAoYW1k
Z3B1X3NyaW92X3ZmKGFkZXYpKQogCQlyZXR1cm47CiAKIAkvKiBTZXQgZGVmYXVsdCBwYWdlIGFk
ZHJlc3MuICovCkBAIC0xNTksNyArMTU5LDcgQEAgc3RhdGljIHZvaWQgbW1odWJfdjFfMF9pbml0
X2NhY2hlX3JlZ3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7CiAJdWludDMyX3QgdG1w
OwogCi0JaWYgKGFtZGdwdV92aXJ0X3N1cHBvcnRfc2tpcF9zZXR0aW5nKGFkZXYpKQorCWlmIChh
bWRncHVfc3Jpb3ZfdmYoYWRldikpCiAJCXJldHVybjsKIAogCS8qIFNldHVwIEwyIGNhY2hlICov
CkBAIC0yMDgsNyArMjA4LDcgQEAgc3RhdGljIHZvaWQgbW1odWJfdjFfMF9lbmFibGVfc3lzdGVt
X2RvbWFpbihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAogc3RhdGljIHZvaWQgbW1odWJf
djFfMF9kaXNhYmxlX2lkZW50aXR5X2FwZXJ0dXJlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KQogewotCWlmIChhbWRncHVfdmlydF9zdXBwb3J0X3NraXBfc2V0dGluZyhhZGV2KSkKKwlpZiAo
YW1kZ3B1X3NyaW92X3ZmKGFkZXYpKQogCQlyZXR1cm47CiAKIAlXUkVHMzJfU09DMTUoTU1IVUIs
IDAsIG1tVk1fTDJfQ09OVEVYVDFfSURFTlRJVFlfQVBFUlRVUkVfTE9XX0FERFJfTE8zMiwKQEAg
LTM0OCw3ICszNDgsNyBAQCB2b2lkIG1taHViX3YxXzBfZ2FydF9kaXNhYmxlKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2KQogCQkJCTApOwogCVdSRUczMl9TT0MxNShNTUhVQiwgMCwgbW1NQ19W
TV9NWF9MMV9UTEJfQ05UTCwgdG1wKTsKIAotCWlmICghYW1kZ3B1X3ZpcnRfc3VwcG9ydF9za2lw
X3NldHRpbmcoYWRldikpIHsKKwlpZiAoIWFtZGdwdV9zcmlvdl92ZihhZGV2KSkgewogCQkvKiBT
ZXR1cCBMMiBjYWNoZSAqLwogCQl0bXAgPSBSUkVHMzJfU09DMTUoTU1IVUIsIDAsIG1tVk1fTDJf
Q05UTCk7CiAJCXRtcCA9IFJFR19TRVRfRklFTEQodG1wLCBWTV9MMl9DTlRMLCBFTkFCTEVfTDJf
Q0FDSEUsIDApOwpAQCAtMzY3LDcgKzM2Nyw3IEBAIHZvaWQgbW1odWJfdjFfMF9zZXRfZmF1bHRf
ZW5hYmxlX2RlZmF1bHQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGJvb2wgdmFsdWUpCiB7
CiAJdTMyIHRtcDsKIAotCWlmIChhbWRncHVfdmlydF9zdXBwb3J0X3NraXBfc2V0dGluZyhhZGV2
KSkKKwlpZiAoYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKQogCQlyZXR1cm47CiAKIAl0bXAgPSBSUkVH
MzJfU09DMTUoTU1IVUIsIDAsIG1tVk1fTDJfUFJPVEVDVElPTl9GQVVMVF9DTlRMKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L214Z3B1X2FpLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9teGdwdV9haS5jCmluZGV4IDIzNTU0OGMuLmNjNWJmNTkgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L214Z3B1X2FpLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvbXhncHVfYWkuYwpAQCAtNDQ5LDIwICs0NDksNiBAQCB2b2lk
IHhncHVfYWlfbWFpbGJveF9wdXRfaXJxKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCWFt
ZGdwdV9pcnFfcHV0KGFkZXYsICZhZGV2LT52aXJ0LnJjdl9pcnEsIDApOwogfQogCi1zdGF0aWMg
dm9pZCB4Z3B1X2FpX2luaXRfcmVnX2FjY2Vzc19tb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2KQotewotCWFkZXYtPnZpcnQucmVnX2FjY2Vzc19tb2RlID0gQU1ER1BVX1ZJUlRfUkVHX0FD
Q0VTU19MRUdBQ1k7Ci0KLQkvKiBFbmFibGUgTDEgc2VjdXJpdHkgcmVnIGFjY2VzcyBtb2RlIGJ5
IGRlZmF1bCwgIGFzIG5vbi1zZWN1cml0eSBWRgotCSAqIHdpbGwgbm8gbG9uZ2VyIGJlIHN1cHBv
cnRlZC4KLQkgKi8KLQlhZGV2LT52aXJ0LnJlZ19hY2Nlc3NfbW9kZSB8PSBBTURHUFVfVklSVF9S
RUdfQUNDRVNTX1JMQzsKLQotCWFkZXYtPnZpcnQucmVnX2FjY2Vzc19tb2RlIHw9IEFNREdQVV9W
SVJUX1JFR19BQ0NFU1NfUFNQX1BSR19JSDsKLQotCWFkZXYtPnZpcnQucmVnX2FjY2Vzc19tb2Rl
IHw9IEFNREdQVV9WSVJUX1JFR19TS0lQX1NFRVRJTkc7Ci19Ci0KIGNvbnN0IHN0cnVjdCBhbWRn
cHVfdmlydF9vcHMgeGdwdV9haV92aXJ0X29wcyA9IHsKIAkucmVxX2Z1bGxfZ3B1CT0geGdwdV9h
aV9yZXF1ZXN0X2Z1bGxfZ3B1X2FjY2VzcywKIAkucmVsX2Z1bGxfZ3B1CT0geGdwdV9haV9yZWxl
YXNlX2Z1bGxfZ3B1X2FjY2VzcywKQEAgLTQ3MSw1ICs0NTcsNCBAQCBjb25zdCBzdHJ1Y3QgYW1k
Z3B1X3ZpcnRfb3BzIHhncHVfYWlfdmlydF9vcHMgPSB7CiAJLnRyYW5zX21zZyA9IHhncHVfYWlf
bWFpbGJveF90cmFuc19tc2csCiAJLmdldF9wcF9jbGsgPSB4Z3B1X2FpX2dldF9wcF9jbGssCiAJ
LmZvcmNlX2RwbV9sZXZlbCA9IHhncHVfYWlfZm9yY2VfZHBtX2xldmVsLAotCS5pbml0X3JlZ19h
Y2Nlc3NfbW9kZSA9IHhncHVfYWlfaW5pdF9yZWdfYWNjZXNzX21vZGUsCiB9OwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2RtYV92NF8wLmMgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9zZG1hX3Y0XzAuYwppbmRleCBiYmZiOWNmLi5jZmFjNTNjIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zZG1hX3Y0XzAuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9zZG1hX3Y0XzAuYwpAQCAtMzI3LDE0ICszMjcsMTIgQEAgc3Rh
dGljIHZvaWQgc2RtYV92NF8wX2luaXRfZ29sZGVuX3JlZ2lzdGVycyhzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldikKIHsKIAlzd2l0Y2ggKGFkZXYtPmFzaWNfdHlwZSkgewogCWNhc2UgQ0hJUF9W
RUdBMTA6Ci0JCWlmICghYW1kZ3B1X3ZpcnRfc3VwcG9ydF9za2lwX3NldHRpbmcoYWRldikpIHsK
LQkJCXNvYzE1X3Byb2dyYW1fcmVnaXN0ZXJfc2VxdWVuY2UoYWRldiwKLQkJCQkJCQkgZ29sZGVu
X3NldHRpbmdzX3NkbWFfNCwKLQkJCQkJCQkgQVJSQVlfU0laRShnb2xkZW5fc2V0dGluZ3Nfc2Rt
YV80KSk7Ci0JCQlzb2MxNV9wcm9ncmFtX3JlZ2lzdGVyX3NlcXVlbmNlKGFkZXYsCi0JCQkJCQkJ
IGdvbGRlbl9zZXR0aW5nc19zZG1hX3ZnMTAsCi0JCQkJCQkJIEFSUkFZX1NJWkUoZ29sZGVuX3Nl
dHRpbmdzX3NkbWFfdmcxMCkpOwotCQl9CisJCXNvYzE1X3Byb2dyYW1fcmVnaXN0ZXJfc2VxdWVu
Y2UoYWRldiwKKwkJCQkJCWdvbGRlbl9zZXR0aW5nc19zZG1hXzQsCisJCQkJCQlBUlJBWV9TSVpF
KGdvbGRlbl9zZXR0aW5nc19zZG1hXzQpKTsKKwkJc29jMTVfcHJvZ3JhbV9yZWdpc3Rlcl9zZXF1
ZW5jZShhZGV2LAorCQkJCQkJZ29sZGVuX3NldHRpbmdzX3NkbWFfdmcxMCwKKwkJCQkJCUFSUkFZ
X1NJWkUoZ29sZGVuX3NldHRpbmdzX3NkbWFfdmcxMCkpOwogCQlicmVhazsKIAljYXNlIENISVBf
VkVHQTEyOgogCQlzb2MxNV9wcm9ncmFtX3JlZ2lzdGVyX3NlcXVlbmNlKGFkZXYsCkBAIC0xODM3
LDcgKzE4MzUsOCBAQCBzdGF0aWMgaW50IHNkbWFfdjRfMF9od19pbml0KHZvaWQgKmhhbmRsZSkK
IAkJCWFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+c2V0X3Bvd2VyZ2F0aW5nX2J5X3NtdSkKIAkJ
YW1kZ3B1X2RwbV9zZXRfcG93ZXJnYXRpbmdfYnlfc211KGFkZXYsIEFNRF9JUF9CTE9DS19UWVBF
X1NETUEsIGZhbHNlKTsKIAotCXNkbWFfdjRfMF9pbml0X2dvbGRlbl9yZWdpc3RlcnMoYWRldik7
CisJaWYgKCFhbWRncHVfc3Jpb3ZfdmYoYWRldikpCisJCXNkbWFfdjRfMF9pbml0X2dvbGRlbl9y
ZWdpc3RlcnMoYWRldik7CiAKIAlyID0gc2RtYV92NF8wX3N0YXJ0KGFkZXYpOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zb2MxNS5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvc29jMTUuYwppbmRleCA0NDA1Yjk4Li44OTA4ODk5IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zb2MxNS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L3NvYzE1LmMKQEAgLTEwNzYsMjEgKzEwNzYsMTggQEAgc3RhdGljIHZvaWQgc29j
MTVfZG9vcmJlbGxfcmFuZ2VfaW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAlpbnQg
aTsKIAlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmc7CiAKLQkvKiAgVHdvIHJlYXNvbnMgdG8gc2tp
cAotCSoJCTEsIEhvc3QgZHJpdmVyIGFscmVhZHkgcHJvZ3JhbW1lZCB0aGVtCi0JKgkJMiwgVG8g
YXZvaWQgcmVnaXN0ZXJzIHByb2dyYW0gdmlvbGF0aW9ucyBpbiBTUi1JT1YKLQkqLwotCWlmICgh
YW1kZ3B1X3ZpcnRfc3VwcG9ydF9za2lwX3NldHRpbmcoYWRldikpIHsKKwkvKiBzZG1hL2loIGRv
b3JiZWxsIHJhbmdlIGFyZSBwcm9ncmFtZWQgYnkgaHlwZXJ2aXNvciAqLworCWlmICghYW1kZ3B1
X3NyaW92X3ZmKGFkZXYpKSB7CiAJCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5zZG1hLm51bV9pbnN0
YW5jZXM7IGkrKykgewogCQkJcmluZyA9ICZhZGV2LT5zZG1hLmluc3RhbmNlW2ldLnJpbmc7CiAJ
CQlhZGV2LT5uYmlvX2Z1bmNzLT5zZG1hX2Rvb3JiZWxsX3JhbmdlKGFkZXYsIGksCiAJCQkJcmlu
Zy0+dXNlX2Rvb3JiZWxsLCByaW5nLT5kb29yYmVsbF9pbmRleCwKIAkJCQlhZGV2LT5kb29yYmVs
bF9pbmRleC5zZG1hX2Rvb3JiZWxsX3JhbmdlKTsKIAkJfQotCX0KIAotCWFkZXYtPm5iaW9fZnVu
Y3MtPmloX2Rvb3JiZWxsX3JhbmdlKGFkZXYsIGFkZXYtPmlycS5paC51c2VfZG9vcmJlbGwsCisJ
CWFkZXYtPm5iaW9fZnVuY3MtPmloX2Rvb3JiZWxsX3JhbmdlKGFkZXYsIGFkZXYtPmlycS5paC51
c2VfZG9vcmJlbGwsCiAJCQkJCQlhZGV2LT5pcnEuaWguZG9vcmJlbGxfaW5kZXgpOworCX0KIH0K
IAogc3RhdGljIGludCBzb2MxNV9jb21tb25faHdfaW5pdCh2b2lkICpoYW5kbGUpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zb2MxNV9jb21tb24uaCBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L3NvYzE1X2NvbW1vbi5oCmluZGV4IDQ3Zjc0ZGEuLjgzOWYxODYg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NvYzE1X2NvbW1vbi5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NvYzE1X2NvbW1vbi5oCkBAIC02OSw5ICs2
OSwxMCBAQAogCQl9CQkJCQkJXAogCX0gd2hpbGUgKDApCiAKKyNkZWZpbmUgQU1ER1BVX1ZJUlRf
U1VQUE9SVF9STENfUFJHX1JFRyhhKSAoYW1kZ3B1X3NyaW92X3ZmKChhKSkgJiYgIWFtZGdwdV9z
cmlvdl9ydW50aW1lKChhKSkpCiAjZGVmaW5lIFdSRUczMl9STEMocmVnLCB2YWx1ZSkgXAogCWRv
IHsJCQkJCQkJXAotCQlpZiAoYW1kZ3B1X3ZpcnRfc3VwcG9ydF9ybGNfcHJnX3JlZyhhZGV2KSkg
eyAgICBcCisJCWlmIChBTURHUFVfVklSVF9TVVBQT1JUX1JMQ19QUkdfUkVHKGFkZXYpKSB7ICAg
IFwKIAkJCXVpbnQzMl90IGkgPSAwOwlcCiAJCQl1aW50MzJfdCByZXRyaWVzID0gNTAwMDA7CVwK
IAkJCXVpbnQzMl90IHIwID0gYWRldi0+cmVnX29mZnNldFtHQ19IV0lQXVswXVttbVNDUkFUQ0hf
UkVHMF9CQVNFX0lEWF0gKyBtbVNDUkFUQ0hfUkVHMDsJXApAQCAtOTYsNyArOTcsNyBAQAogI2Rl
ZmluZSBXUkVHMzJfU09DMTVfUkxDX1NIQURPVyhpcCwgaW5zdCwgcmVnLCB2YWx1ZSkgXAogCWRv
IHsJCQkJCQkJXAogCQl1aW50MzJfdCB0YXJnZXRfcmVnID0gYWRldi0+cmVnX29mZnNldFtpcCMj
X0hXSVBdW2luc3RdW3JlZyMjX0JBU0VfSURYXSArIHJlZztcCi0JCWlmIChhbWRncHVfdmlydF9z
dXBwb3J0X3JsY19wcmdfcmVnKGFkZXYpKSB7ICAgIFwKKwkJaWYgKEFNREdQVV9WSVJUX1NVUFBP
UlRfUkxDX1BSR19SRUcoYWRldikpIHsgICAgXAogCQkJdWludDMyX3QgcjIgPSBhZGV2LT5yZWdf
b2Zmc2V0W0dDX0hXSVBdWzBdW21tU0NSQVRDSF9SRUcxX0JBU0VfSURYXSArIG1tU0NSQVRDSF9S
RUcyOwlcCiAJCQl1aW50MzJfdCByMyA9IGFkZXYtPnJlZ19vZmZzZXRbR0NfSFdJUF1bMF1bbW1T
Q1JBVENIX1JFRzFfQkFTRV9JRFhdICsgbW1TQ1JBVENIX1JFRzM7CVwKIAkJCXVpbnQzMl90IGdy
Ym1fY250bCA9IGFkZXYtPnJlZ19vZmZzZXRbR0NfSFdJUF1bMF1bbW1HUkJNX0dGWF9DTlRMX0JB
U0VfSURYXSArIG1tR1JCTV9HRlhfQ05UTDsgICBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS92ZWdhMTBfaWguYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3Zl
Z2ExMF9paC5jCmluZGV4IGVlOWNkODUuLmE1NTUyNWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L3ZlZ2ExMF9paC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L3ZlZ2ExMF9paC5jCkBAIC00OCw3ICs0OCw3IEBAIHN0YXRpYyB2b2lkIHZlZ2ExMF9paF9l
bmFibGVfaW50ZXJydXB0cyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAogCWloX3JiX2Nu
dGwgPSBSRUdfU0VUX0ZJRUxEKGloX3JiX2NudGwsIElIX1JCX0NOVEwsIFJCX0VOQUJMRSwgMSk7
CiAJaWhfcmJfY250bCA9IFJFR19TRVRfRklFTEQoaWhfcmJfY250bCwgSUhfUkJfQ05UTCwgRU5B
QkxFX0lOVFIsIDEpOwotCWlmIChhbWRncHVfdmlydF9zdXBwb3J0X3BzcF9wcmdfaWhfcmVnKGFk
ZXYpKSB7CisJaWYgKGFtZGdwdV9zcmlvdl92ZihhZGV2KSkgewogCQlpZiAocHNwX3JlZ19wcm9n
cmFtKCZhZGV2LT5wc3AsIFBTUF9SRUdfSUhfUkJfQ05UTCwgaWhfcmJfY250bCkpIHsKIAkJCURS
TV9FUlJPUigiUFNQIHByb2dyYW0gSUhfUkJfQ05UTCBmYWlsZWQhXG4iKTsKIAkJCXJldHVybjsK
QEAgLTYyLDcgKzYyLDcgQEAgc3RhdGljIHZvaWQgdmVnYTEwX2loX2VuYWJsZV9pbnRlcnJ1cHRz
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCQlpaF9yYl9jbnRsID0gUlJFRzMyX1NPQzE1
KE9TU1NZUywgMCwgbW1JSF9SQl9DTlRMX1JJTkcxKTsKIAkJaWhfcmJfY250bCA9IFJFR19TRVRf
RklFTEQoaWhfcmJfY250bCwgSUhfUkJfQ05UTF9SSU5HMSwKIAkJCQkJICAgUkJfRU5BQkxFLCAx
KTsKLQkJaWYgKGFtZGdwdV92aXJ0X3N1cHBvcnRfcHNwX3ByZ19paF9yZWcoYWRldikpIHsKKwkJ
aWYgKGFtZGdwdV9zcmlvdl92ZihhZGV2KSkgewogCQkJaWYgKHBzcF9yZWdfcHJvZ3JhbSgmYWRl
di0+cHNwLCBQU1BfUkVHX0lIX1JCX0NOVExfUklORzEsCiAJCQkJCQlpaF9yYl9jbnRsKSkgewog
CQkJCURSTV9FUlJPUigicHJvZ3JhbSBJSF9SQl9DTlRMX1JJTkcxIGZhaWxlZCFcbiIpOwpAQCAt
NzgsNyArNzgsNyBAQCBzdGF0aWMgdm9pZCB2ZWdhMTBfaWhfZW5hYmxlX2ludGVycnVwdHMoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCWloX3JiX2NudGwgPSBSUkVHMzJfU09DMTUoT1NT
U1lTLCAwLCBtbUlIX1JCX0NOVExfUklORzIpOwogCQlpaF9yYl9jbnRsID0gUkVHX1NFVF9GSUVM
RChpaF9yYl9jbnRsLCBJSF9SQl9DTlRMX1JJTkcyLAogCQkJCQkgICBSQl9FTkFCTEUsIDEpOwot
CQlpZiAoYW1kZ3B1X3ZpcnRfc3VwcG9ydF9wc3BfcHJnX2loX3JlZyhhZGV2KSkgeworCQlpZiAo
YW1kZ3B1X3NyaW92X3ZmKGFkZXYpKSB7CiAJCQlpZiAocHNwX3JlZ19wcm9ncmFtKCZhZGV2LT5w
c3AsIFBTUF9SRUdfSUhfUkJfQ05UTF9SSU5HMiwKIAkJCQkJCWloX3JiX2NudGwpKSB7CiAJCQkJ
RFJNX0VSUk9SKCJwcm9ncmFtIElIX1JCX0NOVExfUklORzIgZmFpbGVkIVxuIik7CkBAIC0xMDQs
NyArMTA0LDcgQEAgc3RhdGljIHZvaWQgdmVnYTEwX2loX2Rpc2FibGVfaW50ZXJydXB0cyhzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAogCWloX3JiX2NudGwgPSBSRUdfU0VUX0ZJRUxEKGlo
X3JiX2NudGwsIElIX1JCX0NOVEwsIFJCX0VOQUJMRSwgMCk7CiAJaWhfcmJfY250bCA9IFJFR19T
RVRfRklFTEQoaWhfcmJfY250bCwgSUhfUkJfQ05UTCwgRU5BQkxFX0lOVFIsIDApOwotCWlmIChh
bWRncHVfdmlydF9zdXBwb3J0X3BzcF9wcmdfaWhfcmVnKGFkZXYpKSB7CisJaWYgKGFtZGdwdV9z
cmlvdl92ZihhZGV2KSkgewogCQlpZiAocHNwX3JlZ19wcm9ncmFtKCZhZGV2LT5wc3AsIFBTUF9S
RUdfSUhfUkJfQ05UTCwgaWhfcmJfY250bCkpIHsKIAkJCURSTV9FUlJPUigiUFNQIHByb2dyYW0g
SUhfUkJfQ05UTCBmYWlsZWQhXG4iKTsKIAkJCXJldHVybjsKQEAgLTEyMyw3ICsxMjMsNyBAQCBz
dGF0aWMgdm9pZCB2ZWdhMTBfaWhfZGlzYWJsZV9pbnRlcnJ1cHRzKHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2KQogCQlpaF9yYl9jbnRsID0gUlJFRzMyX1NPQzE1KE9TU1NZUywgMCwgbW1JSF9S
Ql9DTlRMX1JJTkcxKTsKIAkJaWhfcmJfY250bCA9IFJFR19TRVRfRklFTEQoaWhfcmJfY250bCwg
SUhfUkJfQ05UTF9SSU5HMSwKIAkJCQkJICAgUkJfRU5BQkxFLCAwKTsKLQkJaWYgKGFtZGdwdV92
aXJ0X3N1cHBvcnRfcHNwX3ByZ19paF9yZWcoYWRldikpIHsKKwkJaWYgKGFtZGdwdV9zcmlvdl92
ZihhZGV2KSkgewogCQkJaWYgKHBzcF9yZWdfcHJvZ3JhbSgmYWRldi0+cHNwLCBQU1BfUkVHX0lI
X1JCX0NOVExfUklORzEsCiAJCQkJCQlpaF9yYl9jbnRsKSkgewogCQkJCURSTV9FUlJPUigicHJv
Z3JhbSBJSF9SQl9DTlRMX1JJTkcxIGZhaWxlZCFcbiIpOwpAQCAtMTQzLDcgKzE0Myw3IEBAIHN0
YXRpYyB2b2lkIHZlZ2ExMF9paF9kaXNhYmxlX2ludGVycnVwdHMoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYpCiAJCWloX3JiX2NudGwgPSBSUkVHMzJfU09DMTUoT1NTU1lTLCAwLCBtbUlIX1JC
X0NOVExfUklORzIpOwogCQlpaF9yYl9jbnRsID0gUkVHX1NFVF9GSUVMRChpaF9yYl9jbnRsLCBJ
SF9SQl9DTlRMX1JJTkcyLAogCQkJCQkgICBSQl9FTkFCTEUsIDApOwotCQlpZiAoYW1kZ3B1X3Zp
cnRfc3VwcG9ydF9wc3BfcHJnX2loX3JlZyhhZGV2KSkgeworCQlpZiAoYW1kZ3B1X3NyaW92X3Zm
KGFkZXYpKSB7CiAJCQlpZiAocHNwX3JlZ19wcm9ncmFtKCZhZGV2LT5wc3AsIFBTUF9SRUdfSUhf
UkJfQ05UTF9SSU5HMiwKIAkJCQkJCWloX3JiX2NudGwpKSB7CiAJCQkJRFJNX0VSUk9SKCJwcm9n
cmFtIElIX1JCX0NOVExfUklORzIgZmFpbGVkIVxuIik7CkBAIC0yMzYsNyArMjM2LDcgQEAgc3Rh
dGljIGludCB2ZWdhMTBfaWhfaXJxX2luaXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJ
aWhfcmJfY250bCA9IFJFR19TRVRfRklFTEQoaWhfcmJfY250bCwgSUhfUkJfQ05UTCwgUlBUUl9S
RUFSTSwKIAkJCQkgICAhIWFkZXYtPmlycS5tc2lfZW5hYmxlZCk7CiAKLQlpZiAoYW1kZ3B1X3Zp
cnRfc3VwcG9ydF9wc3BfcHJnX2loX3JlZyhhZGV2KSkgeworCWlmIChhbWRncHVfc3Jpb3ZfdmYo
YWRldikpIHsKIAkJaWYgKHBzcF9yZWdfcHJvZ3JhbSgmYWRldi0+cHNwLCBQU1BfUkVHX0lIX1JC
X0NOVEwsIGloX3JiX2NudGwpKSB7CiAJCQlEUk1fRVJST1IoIlBTUCBwcm9ncmFtIElIX1JCX0NO
VEwgZmFpbGVkIVxuIik7CiAJCQlyZXR1cm4gLUVUSU1FRE9VVDsKQEAgLTI3OSw3ICsyNzksNyBA
QCBzdGF0aWMgaW50IHZlZ2ExMF9paF9pcnFfaW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
dikKIAkJCQkJICAgV1BUUl9PVkVSRkxPV19FTkFCTEUsIDApOwogCQlpaF9yYl9jbnRsID0gUkVH
X1NFVF9GSUVMRChpaF9yYl9jbnRsLCBJSF9SQl9DTlRMLAogCQkJCQkgICBSQl9GVUxMX0RSQUlO
X0VOQUJMRSwgMSk7Ci0JCWlmIChhbWRncHVfdmlydF9zdXBwb3J0X3BzcF9wcmdfaWhfcmVnKGFk
ZXYpKSB7CisJCWlmIChhbWRncHVfc3Jpb3ZfdmYoYWRldikpIHsKIAkJCWlmIChwc3BfcmVnX3By
b2dyYW0oJmFkZXYtPnBzcCwgUFNQX1JFR19JSF9SQl9DTlRMX1JJTkcxLAogCQkJCQkJaWhfcmJf
Y250bCkpIHsKIAkJCQlEUk1fRVJST1IoInByb2dyYW0gSUhfUkJfQ05UTF9SSU5HMSBmYWlsZWQh
XG4iKTsKQEAgLTMwNiw3ICszMDYsNyBAQCBzdGF0aWMgaW50IHZlZ2ExMF9paF9pcnFfaW5pdChz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAkJaWhfcmJfY250bCA9IFJSRUczMl9TT0MxNShP
U1NTWVMsIDAsIG1tSUhfUkJfQ05UTF9SSU5HMik7CiAJCWloX3JiX2NudGwgPSB2ZWdhMTBfaWhf
cmJfY250bChpaCwgaWhfcmJfY250bCk7CiAKLQkJaWYgKGFtZGdwdV92aXJ0X3N1cHBvcnRfcHNw
X3ByZ19paF9yZWcoYWRldikpIHsKKwkJaWYgKGFtZGdwdV9zcmlvdl92ZihhZGV2KSkgewogCQkJ
aWYgKHBzcF9yZWdfcHJvZ3JhbSgmYWRldi0+cHNwLCBQU1BfUkVHX0lIX1JCX0NOVExfUklORzIs
CiAJCQkJCQlpaF9yYl9jbnRsKSkgewogCQkJCURSTV9FUlJPUigicHJvZ3JhbSBJSF9SQl9DTlRM
X1JJTkcyIGZhaWxlZCFcbiIpOwotLSAKMi43LjQKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vYW1kLWdmeA==
