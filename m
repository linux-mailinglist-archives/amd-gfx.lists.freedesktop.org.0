Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BB5A1350BB
	for <lists+amd-gfx@lfdr.de>; Tue,  4 Jun 2019 22:13:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 282FF89C52;
	Tue,  4 Jun 2019 20:13:57 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-BL2-obe.outbound.protection.outlook.com
 (mail-eopbgr750088.outbound.protection.outlook.com [40.107.75.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0FC3789C33
 for <amd-gfx@lists.freedesktop.org>; Tue,  4 Jun 2019 20:13:55 +0000 (UTC)
Received: from DM5PR1201MB0155.namprd12.prod.outlook.com (10.174.106.148) by
 DM5PR1201MB0251.namprd12.prod.outlook.com (10.174.106.139) with Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1965.12; Tue, 4 Jun 2019 20:13:54 +0000
Received: from DM5PR1201MB0155.namprd12.prod.outlook.com
 ([fe80::dde4:7ea4:1b9b:45ae]) by DM5PR1201MB0155.namprd12.prod.outlook.com
 ([fe80::dde4:7ea4:1b9b:45ae%9]) with mapi id 15.20.1943.018; Tue, 4 Jun 2019
 20:13:54 +0000
From: "Yang, Philip" <Philip.Yang@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: [PATCH] drm/amdgpu: use new HMM APIs and helpers v4
Thread-Topic: [PATCH] drm/amdgpu: use new HMM APIs and helpers v4
Thread-Index: AQHVGxIIW5LBXT7vMkm/Ua8ypEwQzw==
Date: Tue, 4 Jun 2019 20:13:53 +0000
Message-ID: <20190604201341.24018-1-Philip.Yang@amd.com>
Accept-Language: en-ZA, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: YTBPR01CA0013.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b01:14::26) To DM5PR1201MB0155.namprd12.prod.outlook.com
 (2603:10b6:4:55::20)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.17.1
x-originating-ip: [165.204.55.251]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 5f21f47e-a0c4-4664-5b57-08d6e9292a72
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(4618075)(2017052603328)(7193020);
 SRVR:DM5PR1201MB0251; 
x-ms-traffictypediagnostic: DM5PR1201MB0251:
x-microsoft-antispam-prvs: <DM5PR1201MB0251C4800243CEBDBEE25253E6150@DM5PR1201MB0251.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:5797;
x-forefront-prvs: 0058ABBBC7
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(39860400002)(366004)(346002)(136003)(376002)(396003)(199004)(189003)(476003)(2616005)(3846002)(386003)(6116002)(4326008)(53936002)(64756008)(25786009)(81156014)(73956011)(66946007)(486006)(81166006)(6512007)(2501003)(71200400001)(5640700003)(478600001)(102836004)(99286004)(26005)(72206003)(8676002)(8936002)(6506007)(52116002)(66476007)(66556008)(66446008)(6436002)(6486002)(5660300002)(305945005)(7736002)(86362001)(14454004)(256004)(66066001)(186003)(71190400001)(1076003)(2351001)(2906002)(50226002)(316002)(36756003)(68736007)(6916009);
 DIR:OUT; SFP:1101; SCL:1; SRVR:DM5PR1201MB0251;
 H:DM5PR1201MB0155.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: lFrlQM+6D5ZYQwgsDhYOZ+MjVPzve2dfkk+iW7e31UvNcliVWF0WBqxHHKI/p8x8TXJyglo81Ah0UBfhD3fARJKKrgpuzpbdku45pIM0rWD+/gEJF0i5AilifCWN0VbKg/53kUypstwRD6LkpYl9zXf3OkodaWqQfooKaekMGxpCNhXLj+b2NYrFxm3Y8ZQsS2FKWj6GkJ0zYnLhg+p7ZtRpWnLyxnetWHbfD2R9DYEoYw89yQlY9p3LmUeNKSuC7iSObLWbJ7jKpyl/ZeZ8YY3EvzgMOZ8YXVs5lf8H8QftHe7YitSd2AXQ4idHSgu4qNRdRtXKFkgrFfjo5zygQqUMvM87mnAV0QVT/SdoPWiUgH4Uv3t3Sg4ggxak4EVnUFZQn/B8nyvPUlYuPFUz+S8dHQevVrwGnWTry8mBCB8=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 5f21f47e-a0c4-4664-5b57-08d6e9292a72
X-MS-Exchange-CrossTenant-originalarrivaltime: 04 Jun 2019 20:13:53.9206 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: yangp@amd.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM5PR1201MB0251
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=Mu9XaChzdi81Kq6Xq05uBRZsA8wgCSz4bCvKjQqRAB4=;
 b=VWKqs1uEifPCVShVZThinRoNgjTkm3OozNlfzdNwcGe0mZTCjueTa8adXMaNuLWvC6hAlRiLAzfEl20Vw4aYOelgcRRufydQVLDNVfZP5YsSthUtzWjMPRNR+c+2oZR0ivPwle8N7NuSK5Z0zqEb729wFPENbhoVN3xdbORn0WA=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Philip.Yang@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Yang, Philip" <Philip.Yang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

SE1NIHByb3ZpZGVzIG5ldyBBUElzIGFuZCBoZWxwcyBpbiBrZXJuZWwgNS4yLXJjMSB0byBzaW1w
bGlmeSBkcml2ZXINCnBhdGguIFRoZSBvbGQgaG1tIEFQSXMgYXJlIGRlcHJlY2F0ZWQgYW5kIHdp
bGwgYmUgcmVtb3ZlZCBpbiBmdXR1cmUuDQoNCkJlbG93IGFyZSBjaGFuZ2VzIGluIGRyaXZlcjoN
Cg0KMS4gQ2hhbmdlIGhtbV92bWFfZmF1bHQgdG8gaG1tX3JhbmdlX3JlZ2lzdGVyIGFuZCBobW1f
cmFuZ2VfZmF1bHQgd2hpY2gNCnN1cHBvcnRzIHJhbmdlIHdpdGggbXVsdGlwbGUgdm1hcywgcmVt
b3ZlIHRoZSBtdWx0aXBsZSB2bWFzIGhhbmRsZSBwYXRoDQphbmQgZGF0YSBzdHJ1Y3R1cmUuDQoy
LiBDaGFuZ2UgaG1tX3ZtYV9yYW5nZV9kb25lIHRvIGhtbV9yYW5nZV91bnJlZ2lzdGVyLg0KMy4g
VXNlIGRlZmF1bHQgZmxhZ3MgdG8gYXZvaWQgcHJlLWZpbGwgcGZuIGFycmF5cy4NCjQuIFVzZSBu
ZXcgaG1tX2RldmljZV8gaGVscGVycy4NCg0KdjI6IHJldHJ5IGlmIGhtbV9yYW5nZV9mYXVsdCBy
ZXR1cm5zIC1FQUdBSU4NCnYzOiBkZWZpbmUgTUFYX1JFVFJZX0hNTV9SQU5HRV9GQVVMVCwgc2tp
cCBkcm9wIG1tYXBfc2VtIGlmIHJldHJ5DQp2NDogZmluZSBncmFpbmVkIHVwX3JlYWQobW0tPm1t
YXBfc2VtKQ0KDQpDaGFuZ2UtSWQ6IEkxYTAwZjg4NDU5ZjNiOTZjOTUzNjkzM2U5YTE3ZWIxZWJh
YTc4MTEzDQpTaWduZWQtb2ZmLWJ5OiBQaGlsaXAgWWFuZyA8UGhpbGlwLllhbmdAYW1kLmNvbT4N
Ci0tLQ0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9tbi5jICB8ICAgMSAtDQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jIHwgMTUyICsrKysrKysrKysr
LS0tLS0tLS0tLS0tLQ0KIDIgZmlsZXMgY2hhbmdlZCwgNjggaW5zZXJ0aW9ucygrKSwgODUgZGVs
ZXRpb25zKC0pDQoNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfbW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9tbi5jDQppbmRleCA0
MWNjZWU0OWEyMjQuLmUwYmI0N2NlNTcwYiAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9tbi5jDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfbW4uYw0KQEAgLTUxOSw3ICs1MTksNiBAQCB2b2lkIGFtZGdwdV9obW1faW5pdF9yYW5n
ZShzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSkNCiAJCXJhbmdlLT5mbGFncyA9IGhtbV9yYW5nZV9m
bGFnczsNCiAJCXJhbmdlLT52YWx1ZXMgPSBobW1fcmFuZ2VfdmFsdWVzOw0KIAkJcmFuZ2UtPnBm
bl9zaGlmdCA9IFBBR0VfU0hJRlQ7DQotCQlyYW5nZS0+cGZucyA9IE5VTEw7DQogCQlJTklUX0xJ
U1RfSEVBRCgmcmFuZ2UtPmxpc3QpOw0KIAl9DQogfQ0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV90dG0uYw0KaW5kZXggZWI0Yjg1MDYxYzdlLi4wMDc5MDIwNzA4NmEgMTAwNjQ0DQot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMNCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYw0KQEAgLTcxMSw4ICs3MTEsNyBAQCBz
dHJ1Y3QgYW1kZ3B1X3R0bV90dCB7DQogCXN0cnVjdCB0YXNrX3N0cnVjdAkqdXNlcnRhc2s7DQog
CXVpbnQzMl90CQl1c2VyZmxhZ3M7DQogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9BTURHUFVf
VVNFUlBUUikNCi0Jc3RydWN0IGhtbV9yYW5nZQkqcmFuZ2VzOw0KLQlpbnQJCQlucl9yYW5nZXM7
DQorCXN0cnVjdCBobW1fcmFuZ2UJKnJhbmdlOw0KICNlbmRpZg0KIH07DQogDQpAQCAtNzI1LDU3
ICs3MjQsMzYgQEAgc3RydWN0IGFtZGdwdV90dG1fdHQgew0KICAqLw0KICNpZiBJU19FTkFCTEVE
KENPTkZJR19EUk1fQU1ER1BVX1VTRVJQVFIpDQogDQotLyogU3VwcG9ydCBVc2VycHRyIHBhZ2Vz
IGNyb3NzIG1heCAxNiB2bWFzICovDQotI2RlZmluZSBNQVhfTlJfVk1BUwkoMTYpDQorI2RlZmlu
ZSBNQVhfUkVUUllfSE1NX1JBTkdFX0ZBVUxUCTE2DQogDQogaW50IGFtZGdwdV90dG1fdHRfZ2V0
X3VzZXJfcGFnZXMoc3RydWN0IHR0bV90dCAqdHRtLCBzdHJ1Y3QgcGFnZSAqKnBhZ2VzKQ0KIHsN
CiAJc3RydWN0IGFtZGdwdV90dG1fdHQgKmd0dCA9ICh2b2lkICopdHRtOw0KIAlzdHJ1Y3QgbW1f
c3RydWN0ICptbSA9IGd0dC0+dXNlcnRhc2stPm1tOw0KIAl1bnNpZ25lZCBsb25nIHN0YXJ0ID0g
Z3R0LT51c2VycHRyOw0KLQl1bnNpZ25lZCBsb25nIGVuZCA9IHN0YXJ0ICsgdHRtLT5udW1fcGFn
ZXMgKiBQQUdFX1NJWkU7DQotCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hID0gTlVMTCwgKnZt
YXNbTUFYX05SX1ZNQVNdOw0KLQlzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZXM7DQotCXVuc2lnbmVk
IGxvbmcgbnJfcGFnZXMsIGk7DQotCXVpbnQ2NF90ICpwZm5zLCBmOw0KKwlzdHJ1Y3Qgdm1fYXJl
YV9zdHJ1Y3QgKnZtYTsNCisJc3RydWN0IGhtbV9yYW5nZSAqcmFuZ2U7DQorCXVuc2lnbmVkIGxv
bmcgaTsNCisJdWludDY0X3QgKnBmbnM7DQorCWludCByZXRyeSA9IDA7DQogCWludCByID0gMDsN
CiANCiAJaWYgKCFtbSkgLyogSGFwcGVucyBkdXJpbmcgcHJvY2VzcyBzaHV0ZG93biAqLw0KIAkJ
cmV0dXJuIC1FU1JDSDsNCiANCi0JZG93bl9yZWFkKCZtbS0+bW1hcF9zZW0pOw0KLQ0KLQkvKiB1
c2VyIHBhZ2VzIG1heSBjcm9zcyBtdWx0aXBsZSBWTUFzICovDQotCWd0dC0+bnJfcmFuZ2VzID0g
MDsNCi0JZG8gew0KLQkJdW5zaWduZWQgbG9uZyB2bV9zdGFydDsNCi0NCi0JCWlmIChndHQtPm5y
X3JhbmdlcyA+PSBNQVhfTlJfVk1BUykgew0KLQkJCURSTV9FUlJPUigiVG9vIG1hbnkgVk1BcyBp
biB1c2VycHRyIHJhbmdlXG4iKTsNCi0JCQlyID0gLUVGQVVMVDsNCi0JCQlnb3RvIG91dDsNCi0J
CX0NCi0NCi0JCXZtX3N0YXJ0ID0gdm1hID8gdm1hLT52bV9lbmQgOiBzdGFydDsNCi0JCXZtYSA9
IGZpbmRfdm1hKG1tLCB2bV9zdGFydCk7DQotCQlpZiAodW5saWtlbHkoIXZtYSB8fCB2bV9zdGFy
dCA8IHZtYS0+dm1fc3RhcnQpKSB7DQotCQkJciA9IC1FRkFVTFQ7DQotCQkJZ290byBvdXQ7DQot
CQl9DQotCQl2bWFzW2d0dC0+bnJfcmFuZ2VzKytdID0gdm1hOw0KLQl9IHdoaWxlIChlbmQgPiB2
bWEtPnZtX2VuZCk7DQotDQotCURSTV9ERUJVR19EUklWRVIoIjB4JWx4IG5yX3JhbmdlcyAlZCBw
YWdlcyAweCVseFxuIiwNCi0JCXN0YXJ0LCBndHQtPm5yX3JhbmdlcywgdHRtLT5udW1fcGFnZXMp
Ow0KLQ0KKwl2bWEgPSBmaW5kX3ZtYShtbSwgc3RhcnQpOw0KKwlpZiAodW5saWtlbHkoIXZtYSB8
fCBzdGFydCA8IHZtYS0+dm1fc3RhcnQpKSB7DQorCQlyID0gLUVGQVVMVDsNCisJCWdvdG8gb3V0
Ow0KKwl9DQogCWlmICh1bmxpa2VseSgoZ3R0LT51c2VyZmxhZ3MgJiBBTURHUFVfR0VNX1VTRVJQ
VFJfQU5PTk9OTFkpICYmDQotCQl2bWFzWzBdLT52bV9maWxlKSkgew0KKwkJdm1hLT52bV9maWxl
KSkgew0KIAkJciA9IC1FUEVSTTsNCiAJCWdvdG8gb3V0Ow0KIAl9DQogDQotCXJhbmdlcyA9IGt2
bWFsbG9jX2FycmF5KGd0dC0+bnJfcmFuZ2VzLCBzaXplb2YoKnJhbmdlcyksIEdGUF9LRVJORUwp
Ow0KLQlpZiAodW5saWtlbHkoIXJhbmdlcykpIHsNCisJcmFuZ2UgPSBremFsbG9jKHNpemVvZigq
cmFuZ2UpLCBHRlBfS0VSTkVMKTsNCisJaWYgKHVubGlrZWx5KCFyYW5nZSkpIHsNCiAJCXIgPSAt
RU5PTUVNOw0KIAkJZ290byBvdXQ7DQogCX0NCkBAIC03ODYsNjEgKzc2NCw2NyBAQCBpbnQgYW1k
Z3B1X3R0bV90dF9nZXRfdXNlcl9wYWdlcyhzdHJ1Y3QgdHRtX3R0ICp0dG0sIHN0cnVjdCBwYWdl
ICoqcGFnZXMpDQogCQlnb3RvIG91dF9mcmVlX3JhbmdlczsNCiAJfQ0KIA0KLQlmb3IgKGkgPSAw
OyBpIDwgZ3R0LT5ucl9yYW5nZXM7IGkrKykNCi0JCWFtZGdwdV9obW1faW5pdF9yYW5nZSgmcmFu
Z2VzW2ldKTsNCisJYW1kZ3B1X2htbV9pbml0X3JhbmdlKHJhbmdlKTsNCisJcmFuZ2UtPmRlZmF1
bHRfZmxhZ3MgPSByYW5nZS0+ZmxhZ3NbSE1NX1BGTl9WQUxJRF07DQorCXJhbmdlLT5kZWZhdWx0
X2ZsYWdzIHw9IGFtZGdwdV90dG1fdHRfaXNfcmVhZG9ubHkodHRtKSA/DQorCQkJCTAgOiByYW5n
ZS0+ZmxhZ3NbSE1NX1BGTl9XUklURV07DQorCXJhbmdlLT5wZm5fZmxhZ3NfbWFzayA9IDA7DQor
CXJhbmdlLT5wZm5zID0gcGZuczsNCisJaG1tX3JhbmdlX3JlZ2lzdGVyKHJhbmdlLCBtbSwgc3Rh
cnQsDQorCQkJICAgc3RhcnQgKyB0dG0tPm51bV9wYWdlcyAqIFBBR0VfU0laRSwgUEFHRV9TSElG
VCk7DQogDQotCWYgPSByYW5nZXNbMF0uZmxhZ3NbSE1NX1BGTl9WQUxJRF07DQotCWYgfD0gYW1k
Z3B1X3R0bV90dF9pc19yZWFkb25seSh0dG0pID8NCi0JCQkJMCA6IHJhbmdlc1swXS5mbGFnc1tI
TU1fUEZOX1dSSVRFXTsNCi0JbWVtc2V0NjQocGZucywgZiwgdHRtLT5udW1fcGFnZXMpOw0KK3Jl
dHJ5Og0KKwkvKg0KKwkgKiBKdXN0IHdhaXQgZm9yIHJhbmdlIHRvIGJlIHZhbGlkLCBzYWZlIHRv
IGlnbm9yZSByZXR1cm4gdmFsdWUgYXMgd2UNCisJICogd2lsbCB1c2UgdGhlIHJldHVybiB2YWx1
ZSBvZiBobW1fcmFuZ2VfZmF1bHQoKSBiZWxvdyB1bmRlciB0aGUNCisJICogbW1hcF9zZW0gdG8g
YXNjZXJ0YWluIHRoZSB2YWxpZGl0eSBvZiB0aGUgcmFuZ2UuDQorCSAqLw0KKwlobW1fcmFuZ2Vf
d2FpdF91bnRpbF92YWxpZChyYW5nZSwgSE1NX1JBTkdFX0RFRkFVTFRfVElNRU9VVCk7DQogDQot
CWZvciAobnJfcGFnZXMgPSAwLCBpID0gMDsgaSA8IGd0dC0+bnJfcmFuZ2VzOyBpKyspIHsNCi0J
CXJhbmdlc1tpXS52bWEgPSB2bWFzW2ldOw0KLQkJcmFuZ2VzW2ldLnN0YXJ0ID0gbWF4KHN0YXJ0
LCB2bWFzW2ldLT52bV9zdGFydCk7DQotCQlyYW5nZXNbaV0uZW5kID0gbWluKGVuZCwgdm1hc1tp
XS0+dm1fZW5kKTsNCi0JCXJhbmdlc1tpXS5wZm5zID0gcGZucyArIG5yX3BhZ2VzOw0KLQkJbnJf
cGFnZXMgKz0gKHJhbmdlc1tpXS5lbmQgLSByYW5nZXNbaV0uc3RhcnQpIC8gUEFHRV9TSVpFOw0K
Kwlkb3duX3JlYWQoJm1tLT5tbWFwX3NlbSk7DQogDQotCQlyID0gaG1tX3ZtYV9mYXVsdCgmcmFu
Z2VzW2ldLCB0cnVlKTsNCi0JCWlmICh1bmxpa2VseShyKSkNCi0JCQlicmVhazsNCi0JfQ0KLQlp
ZiAodW5saWtlbHkocikpIHsNCi0JCXdoaWxlIChpLS0pDQotCQkJaG1tX3ZtYV9yYW5nZV9kb25l
KCZyYW5nZXNbaV0pOw0KKwlyID0gaG1tX3JhbmdlX2ZhdWx0KHJhbmdlLCB0cnVlKTsNCisJaWYg
KHVubGlrZWx5KHIgPCAwKSkgew0KKwkJaWYgKGxpa2VseShyID09IC1FQUdBSU4pKSB7DQorCQkJ
LyoNCisJCQkgKiByZXR1cm4gLUVBR0FJTiwgbW1hcF9zZW0gaXMgZHJvcHBlZA0KKwkJCSAqLw0K
KwkJCWlmIChyZXRyeSsrIDwgTUFYX1JFVFJZX0hNTV9SQU5HRV9GQVVMVCkNCisJCQkJZ290byBy
ZXRyeTsNCisJCQllbHNlDQorCQkJCXByX2VycigiUmV0cnkgaG1tIGZhdWx0IHRvbyBtYW55IHRp
bWVzXG4iKTsNCisJCX0NCiANCi0JCWdvdG8gb3V0X2ZyZWVfcGZuczsNCisJCWdvdG8gb3V0X3Vw
X3JlYWQ7DQogCX0NCiANCiAJdXBfcmVhZCgmbW0tPm1tYXBfc2VtKTsNCiANCiAJZm9yIChpID0g
MDsgaSA8IHR0bS0+bnVtX3BhZ2VzOyBpKyspIHsNCi0JCXBhZ2VzW2ldID0gaG1tX3Bmbl90b19w
YWdlKCZyYW5nZXNbMF0sIHBmbnNbaV0pOw0KLQkJaWYgKCFwYWdlc1tpXSkgew0KKwkJcGFnZXNb
aV0gPSBobW1fZGV2aWNlX2VudHJ5X3RvX3BhZ2UocmFuZ2UsIHBmbnNbaV0pOw0KKwkJaWYgKHVu
bGlrZWx5KCFwYWdlc1tpXSkpIHsNCiAJCQlwcl9lcnIoIlBhZ2UgZmF1bHQgZmFpbGVkIGZvciBw
Zm5bJWx1XSA9IDB4JWxseFxuIiwNCiAJCQkgICAgICAgaSwgcGZuc1tpXSk7DQotCQkJZ290byBv
dXRfaW52YWxpZF9wZm47DQorCQkJciA9IC1FTk9NRU07DQorDQorCQkJZ290byBvdXRfZnJlZV9w
Zm5zOw0KIAkJfQ0KIAl9DQotCWd0dC0+cmFuZ2VzID0gcmFuZ2VzOw0KKw0KKwlndHQtPnJhbmdl
ID0gcmFuZ2U7DQogDQogCXJldHVybiAwOw0KIA0KK291dF91cF9yZWFkOg0KKwlpZiAobGlrZWx5
KHIgIT0gLUVBR0FJTikpDQorCQl1cF9yZWFkKCZtbS0+bW1hcF9zZW0pOw0KIG91dF9mcmVlX3Bm
bnM6DQorCWhtbV9yYW5nZV91bnJlZ2lzdGVyKHJhbmdlKTsNCiAJa3ZmcmVlKHBmbnMpOw0KIG91
dF9mcmVlX3JhbmdlczoNCi0Ja3ZmcmVlKHJhbmdlcyk7DQorCWtmcmVlKHJhbmdlKTsNCiBvdXQ6
DQotCXVwX3JlYWQoJm1tLT5tbWFwX3NlbSk7DQotDQogCXJldHVybiByOw0KLQ0KLW91dF9pbnZh
bGlkX3BmbjoNCi0JZm9yIChpID0gMDsgaSA8IGd0dC0+bnJfcmFuZ2VzOyBpKyspDQotCQlobW1f
dm1hX3JhbmdlX2RvbmUoJnJhbmdlc1tpXSk7DQotCWt2ZnJlZShwZm5zKTsNCi0Ja3ZmcmVlKHJh
bmdlcyk7DQotCXJldHVybiAtRU5PTUVNOw0KIH0NCiANCiAvKioNCkBAIC04NTMsMjMgKzgzNywy
MyBAQCBib29sIGFtZGdwdV90dG1fdHRfZ2V0X3VzZXJfcGFnZXNfZG9uZShzdHJ1Y3QgdHRtX3R0
ICp0dG0pDQogew0KIAlzdHJ1Y3QgYW1kZ3B1X3R0bV90dCAqZ3R0ID0gKHZvaWQgKil0dG07DQog
CWJvb2wgciA9IGZhbHNlOw0KLQlpbnQgaTsNCiANCiAJaWYgKCFndHQgfHwgIWd0dC0+dXNlcnB0
cikNCiAJCXJldHVybiBmYWxzZTsNCiANCi0JRFJNX0RFQlVHX0RSSVZFUigidXNlcl9wYWdlc19k
b25lIDB4JWxseCBucl9yYW5nZXMgJWQgcGFnZXMgMHglbHhcbiIsDQotCQlndHQtPnVzZXJwdHIs
IGd0dC0+bnJfcmFuZ2VzLCB0dG0tPm51bV9wYWdlcyk7DQorCURSTV9ERUJVR19EUklWRVIoInVz
ZXJfcGFnZXNfZG9uZSAweCVsbHggcGFnZXMgMHglbHhcbiIsDQorCQlndHQtPnVzZXJwdHIsIHR0
bS0+bnVtX3BhZ2VzKTsNCiANCi0JV0FSTl9PTkNFKCFndHQtPnJhbmdlcyB8fCAhZ3R0LT5yYW5n
ZXNbMF0ucGZucywNCisJV0FSTl9PTkNFKCFndHQtPnJhbmdlIHx8ICFndHQtPnJhbmdlLT5wZm5z
LA0KIAkJIk5vIHVzZXIgcGFnZXMgdG8gY2hlY2tcbiIpOw0KIA0KLQlpZiAoZ3R0LT5yYW5nZXMp
IHsNCi0JCWZvciAoaSA9IDA7IGkgPCBndHQtPm5yX3JhbmdlczsgaSsrKQ0KLQkJCXIgfD0gaG1t
X3ZtYV9yYW5nZV9kb25lKCZndHQtPnJhbmdlc1tpXSk7DQotCQlrdmZyZWUoZ3R0LT5yYW5nZXNb
MF0ucGZucyk7DQotCQlrdmZyZWUoZ3R0LT5yYW5nZXMpOw0KLQkJZ3R0LT5yYW5nZXMgPSBOVUxM
Ow0KKwlpZiAoZ3R0LT5yYW5nZSkgew0KKwkJciA9IGhtbV9yYW5nZV92YWxpZChndHQtPnJhbmdl
KTsNCisJCWhtbV9yYW5nZV91bnJlZ2lzdGVyKGd0dC0+cmFuZ2UpOw0KKw0KKwkJa3ZmcmVlKGd0
dC0+cmFuZ2UtPnBmbnMpOw0KKwkJa2ZyZWUoZ3R0LT5yYW5nZSk7DQorCQlndHQtPnJhbmdlID0g
TlVMTDsNCiAJfQ0KIA0KIAlyZXR1cm4gcjsNCkBAIC05NTMsOSArOTM3LDkgQEAgc3RhdGljIHZv
aWQgYW1kZ3B1X3R0bV90dF91bnBpbl91c2VycHRyKHN0cnVjdCB0dG1fdHQgKnR0bSkNCiAJc2df
ZnJlZV90YWJsZSh0dG0tPnNnKTsNCiANCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0FNREdQ
VV9VU0VSUFRSKQ0KLQlpZiAoZ3R0LT5yYW5nZXMgJiYNCi0JICAgIHR0bS0+cGFnZXNbMF0gPT0g
aG1tX3Bmbl90b19wYWdlKCZndHQtPnJhbmdlc1swXSwNCi0JCQkJCSAgICAgZ3R0LT5yYW5nZXNb
MF0ucGZuc1swXSkpDQorCWlmIChndHQtPnJhbmdlICYmDQorCSAgICB0dG0tPnBhZ2VzWzBdID09
IGhtbV9kZXZpY2VfZW50cnlfdG9fcGFnZShndHQtPnJhbmdlLA0KKwkJCQkJCSAgICAgIGd0dC0+
cmFuZ2UtPnBmbnNbMF0pKQ0KIAkJV0FSTl9PTkNFKDEsICJNaXNzaW5nIGdldF91c2VyX3BhZ2Vf
ZG9uZVxuIik7DQogI2VuZGlmDQogfQ0KLS0gDQoyLjE3LjENCg0KX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9hbWQtZ2Z4
