Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9E3F638E9E3
	for <lists+amd-gfx@lfdr.de>; Mon, 24 May 2021 16:50:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id ECCFB6E874;
	Mon, 24 May 2021 14:50:10 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ABD0E6E870;
 Mon, 24 May 2021 14:50:07 +0000 (UTC)
Received: by mail.kernel.org (Postfix) with ESMTPSA id 8F54A6147F;
 Mon, 24 May 2021 14:50:06 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1621867807;
 bh=akenY2+nrnz0yRofVdRHzxhKQS7tviJ6AFW4Q7dwg0w=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=i6uSDwfDNM1D+V6fPYQLpAvulCPBYb9KlmbHFhkdEQ68Sr+lcgcaa783zud8bThvz
 PmcdehJ0eJDQNiMRjM+cA+1/jQj+//WfqEmiIciHrP+Ao1KyH3UGnBPbiQUwvIzkvI
 kJK1h2W+ziiWl98tkmzPaDm6OCGFKBzB6WjSFM+jmJoYccHkQFbzZRFvwIW4mZxNdG
 dvO8ouzpcq9X216iKbK1xqJ7OQdC5Jhoi0nVT0e4bUeueEQOJHOa7hzJISbO4AmTDy
 Iplrmq8G1QIn5JoC74XCaJ/ERruH5X/POksw+zZPlpCpWRFZPF2qZdr9zTyZB6fH41
 V+RPHrpcgMXYw==
From: Sasha Levin <sashal@kernel.org>
To: linux-kernel@vger.kernel.org,
	stable@vger.kernel.org
Subject: [PATCH AUTOSEL 5.4 52/52] drm/amd/amdgpu: fix a potential deadlock in
 gpu reset
Date: Mon, 24 May 2021 10:49:02 -0400
Message-Id: <20210524144903.2498518-52-sashal@kernel.org>
X-Mailer: git-send-email 2.30.2
In-Reply-To: <20210524144903.2498518-1-sashal@kernel.org>
References: <20210524144903.2498518-1-sashal@kernel.org>
MIME-Version: 1.0
X-stable: review
X-Patchwork-Hint: Ignore
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Sasha Levin <sashal@kernel.org>,
 Andrey Grodzovsky <andrey.grodzovsky@amd.com>, amd-gfx@lists.freedesktop.org,
 dri-devel@lists.freedesktop.org, Alex Deucher <alexander.deucher@amd.com>,
 Lang Yu <Lang.Yu@amd.com>,
 =?UTF-8?q?Christian=20K=C3=83nig?= <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGFuZyBZdSA8TGFuZy5ZdUBhbWQuY29tPgoKWyBVcHN0cmVhbSBjb21taXQgOWMyODc2
ZDU2ZjFjZTliNmIyMDcyZjE0NDZmYjFlOGQxNTMyY2IzZCBdCgpXaGVuIGFtZGdwdV9pYl9yaW5n
X3Rlc3RzIGZhaWxlZCwgdGhlIHJlc2V0IGxvZ2ljIGNhbGxlZAphbWRncHVfZGV2aWNlX2lwX3N1
c3BlbmQgdHdpY2UsIHRoZW4gZGVhZGxvY2sgb2NjdXJyZWQuCkRlYWRsb2NrIGxvZzoKClsgIDgw
NS42NTUxOTJdIGFtZGdwdSAwMDAwOjA0OjAwLjA6IGFtZGdwdTogaWIgcmluZyB0ZXN0IGZhaWxl
ZCAoLTExMCkuClsgIDgwNi4yOTA5NTJdIFtkcm1dIGZyZWUgUFNQIFRNUiBidWZmZXIKClsgIDgw
Ni4zMTk0MDZdID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Clsg
IDgwNi4zMjAzMTVdIFdBUk5JTkc6IHBvc3NpYmxlIHJlY3Vyc2l2ZSBsb2NraW5nIGRldGVjdGVk
ClsgIDgwNi4zMjEyMjVdIDUuMTEuMC1jdXN0b20gIzEgVGFpbnRlZDogRyAgICAgICAgVyAgT0VM
ClsgIDgwNi4zMjIxMzVdIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tClsgIDgwNi4zMjMwNDNdIGNhdC8yNTkzIGlzIHRyeWluZyB0byBhY3F1aXJlIGxvY2s6Clsg
IDgwNi4zMjM4MjVdIGZmZmY4ODgxMzZiMWNkYzggKCZhZGV2LT5kbS5kY19sb2NrKXsrLisufS17
MzozfSwgYXQ6IGRtX3N1c3BlbmQrMHhiOC8weDFkMCBbYW1kZ3B1XQpbICA4MDYuMzI1NjY4XQog
ICAgICAgICAgICAgICBidXQgdGFzayBpcyBhbHJlYWR5IGhvbGRpbmcgbG9jazoKWyAgODA2LjMy
NjY2NF0gZmZmZjg4ODEzNmIxY2RjOCAoJmFkZXYtPmRtLmRjX2xvY2speysuKy59LXszOjN9LCBh
dDogZG1fc3VzcGVuZCsweGI4LzB4MWQwIFthbWRncHVdClsgIDgwNi4zMjg0MzBdCiAgICAgICAg
ICAgICAgIG90aGVyIGluZm8gdGhhdCBtaWdodCBoZWxwIHVzIGRlYnVnIHRoaXM6ClsgIDgwNi4z
Mjk1MzldICBQb3NzaWJsZSB1bnNhZmUgbG9ja2luZyBzY2VuYXJpbzoKClsgIDgwNi4zMzA1NDld
ICAgICAgICBDUFUwClsgIDgwNi4zMzA5ODNdICAgICAgICAtLS0tClsgIDgwNi4zMzE0MTZdICAg
bG9jaygmYWRldi0+ZG0uZGNfbG9jayk7ClsgIDgwNi4zMzIwODZdICAgbG9jaygmYWRldi0+ZG0u
ZGNfbG9jayk7ClsgIDgwNi4zMzI3MzhdCiAgICAgICAgICAgICAgICAqKiogREVBRExPQ0sgKioq
CgpbICA4MDYuMzMzNzQ3XSAgTWF5IGJlIGR1ZSB0byBtaXNzaW5nIGxvY2sgbmVzdGluZyBub3Rh
dGlvbgoKWyAgODA2LjMzNDg5OV0gMyBsb2NrcyBoZWxkIGJ5IGNhdC8yNTkzOgpbICA4MDYuMzM1
NTM3XSAgIzA6IGZmZmY4ODgxMDBkM2YxYjggKCZhdHRyLT5tdXRleCl7Ky4rLn0tezM6M30sIGF0
OiBzaW1wbGVfYXR0cl9yZWFkKzB4NGUvMHgxMTAKWyAgODA2LjMzNzAwOV0gICMxOiBmZmZmODg4
MTM2YjFmZDc4ICgmYWRldi0+cmVzZXRfc2VtKXsrKysrfS17MzozfSwgYXQ6IGFtZGdwdV9kZXZp
Y2VfbG9ja19hZGV2KzB4NDIvMHg5NCBbYW1kZ3B1XQpbICA4MDYuMzM5MDE4XSAgIzI6IGZmZmY4
ODgxMzZiMWNkYzggKCZhZGV2LT5kbS5kY19sb2NrKXsrLisufS17MzozfSwgYXQ6IGRtX3N1c3Bl
bmQrMHhiOC8weDFkMCBbYW1kZ3B1XQpbICA4MDYuMzQwODY5XQogICAgICAgICAgICAgICBzdGFj
ayBiYWNrdHJhY2U6ClsgIDgwNi4zNDE2MjFdIENQVTogNiBQSUQ6IDI1OTMgQ29tbTogY2F0IFRh
aW50ZWQ6IEcgICAgICAgIFcgIE9FTCAgICA1LjExLjAtY3VzdG9tICMxClsgIDgwNi4zNDI5MjFd
IEhhcmR3YXJlIG5hbWU6IEFNRCBDZWxhZG9uLUNaTi9DZWxhZG9uLUNaTiwgQklPUyBXTEQwQzIz
Tl9XZWVrbHlfMjBfMTJfMiAxMi8yMy8yMDIwClsgIDgwNi4zNDQ0MTNdIENhbGwgVHJhY2U6Clsg
IDgwNi4zNDQ4NDldICBkdW1wX3N0YWNrKzB4OTMvMHhiZApbICA4MDYuMzQ1NDM1XSAgX19sb2Nr
X2FjcXVpcmUuY29sZCsweDE4YS8weDJjZgpbICA4MDYuMzQ2MTc5XSAgbG9ja19hY3F1aXJlKzB4
Y2EvMHgzOTAKWyAgODA2LjM0NjgwN10gID8gZG1fc3VzcGVuZCsweGI4LzB4MWQwIFthbWRncHVd
ClsgIDgwNi4zNDc4MTNdICBfX211dGV4X2xvY2srMHg5Yi8weDkzMApbICA4MDYuMzQ4NDU0XSAg
PyBkbV9zdXNwZW5kKzB4YjgvMHgxZDAgW2FtZGdwdV0KWyAgODA2LjM0OTQzNF0gID8gYW1kZ3B1
X2RldmljZV9pbmRpcmVjdF9ycmVnKzB4NTgvMHg3MCBbYW1kZ3B1XQpbICA4MDYuMzUwNTgxXSAg
PyBfcmF3X3NwaW5fdW5sb2NrX2lycXJlc3RvcmUrMHg0Ny8weDUwClsgIDgwNi4zNTE0MzddICA/
IGRtX3N1c3BlbmQrMHhiOC8weDFkMCBbYW1kZ3B1XQpbICA4MDYuMzUyNDM3XSAgPyByY3VfcmVh
ZF9sb2NrX3NjaGVkX2hlbGQrMHg0Zi8weDgwClsgIDgwNi4zNTMyNTJdICA/IHJjdV9yZWFkX2xv
Y2tfc2NoZWRfaGVsZCsweDRmLzB4ODAKWyAgODA2LjM1NDA2NF0gIG11dGV4X2xvY2tfbmVzdGVk
KzB4MWIvMHgyMApbICA4MDYuMzU0NzQ3XSAgPyBtdXRleF9sb2NrX25lc3RlZCsweDFiLzB4MjAK
WyAgODA2LjM1NTQ1N10gIGRtX3N1c3BlbmQrMHhiOC8weDFkMCBbYW1kZ3B1XQpbICA4MDYuMzU2
NDI3XSAgPyBzb2MxNV9jb21tb25fc2V0X2Nsb2NrZ2F0aW5nX3N0YXRlKzB4MTdkLzB4MTkgW2Ft
ZGdwdV0KWyAgODA2LjM1NzczNl0gIGFtZGdwdV9kZXZpY2VfaXBfc3VzcGVuZF9waGFzZTErMHg3
OC8weGQwIFthbWRncHVdClsgIDgwNi4zNjAzOTRdICBhbWRncHVfZGV2aWNlX2lwX3N1c3BlbmQr
MHgyMS8weDcwIFthbWRncHVdClsgIDgwNi4zNjI5MjZdICBhbWRncHVfZGV2aWNlX3ByZV9hc2lj
X3Jlc2V0KzB4YjMvMHgyNzAgW2FtZGdwdV0KWyAgODA2LjM2NTU2MF0gIGFtZGdwdV9kZXZpY2Vf
Z3B1X3JlY292ZXIuY29sZCsweDY3OS8weDhlYiBbYW1kZ3B1XQoKU2lnbmVkLW9mZi1ieTogTGFu
ZyBZdSA8TGFuZy5ZdUBhbWQuY29tPgpBY2tlZC1ieTogQ2hyaXN0aWFuIEvDg25pZyA8Y2hyaXN0
aWFuLmtvZW5pZ0BhbWQuY29tPgpSZXZpZXdlZC1ieTogQW5kcmV5IEdyb2R6b3Zza3kgPGFuZHJl
eS5ncm9kem92c2t5QGFtZC5jb20+ClNpZ25lZC1vZmYtYnk6IEFsZXggRGV1Y2hlciA8YWxleGFu
ZGVyLmRldWNoZXJAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogU2FzaGEgTGV2aW4gPHNhc2hhbEBr
ZXJuZWwub3JnPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2Uu
YyB8IDEgLQogMSBmaWxlIGNoYW5nZWQsIDEgZGVsZXRpb24oLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKaW5kZXggM2IzZmM5YTQyNmU5Li43NjVmOWE2YzQ2
NDAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2Uu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKQEAgLTM3
MDQsNyArMzcwNCw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RvX2FzaWNfcmVzZXQoc3RydWN0IGFt
ZGdwdV9oaXZlX2luZm8gKmhpdmUsCiAJCQlyID0gYW1kZ3B1X2liX3JpbmdfdGVzdHModG1wX2Fk
ZXYpOwogCQkJaWYgKHIpIHsKIAkJCQlkZXZfZXJyKHRtcF9hZGV2LT5kZXYsICJpYiByaW5nIHRl
c3QgZmFpbGVkICglZCkuXG4iLCByKTsKLQkJCQlyID0gYW1kZ3B1X2RldmljZV9pcF9zdXNwZW5k
KHRtcF9hZGV2KTsKIAkJCQluZWVkX2Z1bGxfcmVzZXQgPSB0cnVlOwogCQkJCXIgPSAtRUFHQUlO
OwogCQkJCWdvdG8gZW5kOwotLSAKMi4zMC4yCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2FtZC1nZngK
