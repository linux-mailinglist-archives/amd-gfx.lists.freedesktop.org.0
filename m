Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F1FF4FE271
	for <lists+amd-gfx@lfdr.de>; Fri, 15 Nov 2019 17:15:18 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8E9A76E94B;
	Fri, 15 Nov 2019 16:15:17 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wr1-x444.google.com (mail-wr1-x444.google.com
 [IPv6:2a00:1450:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B04E56E94B
 for <amd-gfx@lists.freedesktop.org>; Fri, 15 Nov 2019 16:15:16 +0000 (UTC)
Received: by mail-wr1-x444.google.com with SMTP id s5so11610874wrw.2
 for <amd-gfx@lists.freedesktop.org>; Fri, 15 Nov 2019 08:15:16 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc;
 bh=AMZsxvN1HAEzLaTF91B/OYhX1RiGaOMOmN354VpK8Ho=;
 b=F5iHSlvLHuGqSlncTy5IfYztqLRfJ6B8Sm53sXUMdTYerV3MZX5oxmPFXKGDy/YZrN
 SMqKjjufIOHzIYS2dwEuQblOxQjdPxkmXHGbaAgTuyec/ZSePLvO5mkeFcqr+ooAGezU
 jnY0q2F9tgNH8NLDyiDsIawJXKM0zAA61H28k1zGKewNTtzQTT8t2g2a1vcdGKiudWxm
 Po6MZW7I/E3XGBAE/KRrJewtLzpKDFDgEcokwRUxK6AZZDQT37L+RDOOGYIXJvMwbdok
 TtUlUR/zvPfvMBYLs36S8XXPjrFCorH4GQP03gX/Td7Sg6RiV3jjkCD8E3F9yHLf3n92
 9OxA==
X-Gm-Message-State: APjAAAU6HoLLxbOx5GHIbMtKU+n7+3FJyQww95QnD/N+RFqfz3HvfmjR
 pAC9QiN/npXGLOmEwoEsCgXHFIOhI8YnBrPUAbOF61Sm
X-Google-Smtp-Source: APXvYqwrt6TlvjFlvaRVut6PiYNLeR2tpWHLMQj/eKToQFig4ahPMq2uHxaM8886atfraoh0ursHMZdHOmhf/BaRgmU=
X-Received: by 2002:a05:6000:18c:: with SMTP id
 p12mr15802801wrx.154.1573834515144; 
 Fri, 15 Nov 2019 08:15:15 -0800 (PST)
MIME-Version: 1.0
References: <20191114164148.2304223-1-alexander.deucher@amd.com>
In-Reply-To: <20191114164148.2304223-1-alexander.deucher@amd.com>
From: Alex Deucher <alexdeucher@gmail.com>
Date: Fri, 15 Nov 2019 11:15:02 -0500
Message-ID: <CADnq5_P35L7Unqn-NwzeB0wdAiJcFhs8Ai0u2Uyx-J5eWjFkrQ@mail.gmail.com>
Subject: Re: [PATCH 1/2] Revert "drm/amdgpu: don't read registers if gfxoff is
 enabled (v2)"
To: amd-gfx list <amd-gfx@lists.freedesktop.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc;
 bh=AMZsxvN1HAEzLaTF91B/OYhX1RiGaOMOmN354VpK8Ho=;
 b=ldJPuz3+AdfNEWGCwrUZHS9+6K5R8PP9KH/2UxZW0LOn/2YtU5I5955Sntgem3UAkf
 BA33I9S4kaNFR8SnqkMUZxtueFIedbnpTIChEbEhPr3+xvmQHa7g/eGjStuUMyAcFIgV
 sZZJoYsX4RqoMuTnKGST6H4mOhTqCdWuH3CU9UYZEKgB3gIiVDZxVwOpFhAxHQOUxT6q
 TOu3O/So7uwpyQcZjZ9M0zM9EQ26XJohY6BLjIP+OrBgo23KUotWOABH6RcQPeSkR/M4
 Z61x15hO0bIaKzvMlWqGabpRVV/d3AB3IHW6fApREKp9T1WrBgMdDRrPpi4LvaHnh67F
 t7wA==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

UGluZz8KCk9uIFRodSwgTm92IDE0LCAyMDE5IGF0IDExOjQxIEFNIEFsZXggRGV1Y2hlciA8YWxl
eGRldWNoZXJAZ21haWwuY29tPiB3cm90ZToKPgo+IFRoaXMgcmV2ZXJ0cyBjb21taXQgNWU0OWQ2
ZjY1NGM1NjljMmRlOTIwYmFiYmFmNWNmN2M0YzRhMzUzZi4KPgo+IERyb3AgdGhpcyB3b3JrYXJv
dW5kIGluIGZhdm9yIG9mIGEgYmV0dGVyIG9uZS4KPgo+IFNpZ25lZC1vZmYtYnk6IEFsZXggRGV1
Y2hlciA8YWxleGFuZGVyLmRldWNoZXJAYW1kLmNvbT4KPiAtLS0KPiAgZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvbnYuYyAgICB8IDI3ICsrKysrKysrKystLS0tLS0tLS0tLS0tLS0tCj4gIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NvYzE1LmMgfCAzMSArKysrKysrKysrKystLS0tLS0t
LS0tLS0tLS0tLS0KPiAgMiBmaWxlcyBjaGFuZ2VkLCAyMiBpbnNlcnRpb25zKCspLCAzNiBkZWxl
dGlvbnMoLSkKPgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9udi5j
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvbnYuYwo+IGluZGV4IDcyODNkNjE5OGI4OS4u
YWY2OGY5ODE1ZjI4IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L252
LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9udi5jCj4gQEAgLTIwMSwyNSAr
MjAxLDE3IEBAIHN0YXRpYyB1aW50MzJfdCBudl9yZWFkX2luZGV4ZWRfcmVnaXN0ZXIoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiBzZV9udW0sCj4gICAgICAgICByZXR1cm4gdmFsOwo+
ICB9Cj4KPiAtc3RhdGljIGludCBudl9nZXRfcmVnaXN0ZXJfdmFsdWUoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsCj4gK3N0YXRpYyB1aW50MzJfdCBudl9nZXRfcmVnaXN0ZXJfdmFsdWUoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBib29sIGluZGV4ZWQsIHUzMiBzZV9udW0sCj4gLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1MzIgc2hfbnVtLCB1MzIgcmVnX29mZnNldCwKPiAtICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUzMiAqdmFsdWUpCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB1MzIgc2hfbnVtLCB1MzIgcmVnX29mZnNldCkKPiAgewo+
ICAgICAgICAgaWYgKGluZGV4ZWQpIHsKPiAtICAgICAgICAgICAgICAgaWYgKGFkZXYtPnBtLnBw
X2ZlYXR1cmUgJiBQUF9HRlhPRkZfTUFTSykKPiAtICAgICAgICAgICAgICAgICAgICAgICByZXR1
cm4gLUVJTlZBTDsKPiAtICAgICAgICAgICAgICAgKnZhbHVlID0gbnZfcmVhZF9pbmRleGVkX3Jl
Z2lzdGVyKGFkZXYsIHNlX251bSwgc2hfbnVtLCByZWdfb2Zmc2V0KTsKPiArICAgICAgICAgICAg
ICAgcmV0dXJuIG52X3JlYWRfaW5kZXhlZF9yZWdpc3RlcihhZGV2LCBzZV9udW0sIHNoX251bSwg
cmVnX29mZnNldCk7Cj4gICAgICAgICB9IGVsc2Ugewo+IC0gICAgICAgICAgICAgICBpZiAocmVn
X29mZnNldCA9PSBTT0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUdCX0FERFJfQ09ORklHKSkgewo+
IC0gICAgICAgICAgICAgICAgICAgICAgICp2YWx1ZSA9IGFkZXYtPmdmeC5jb25maWcuZ2JfYWRk
cl9jb25maWc7Cj4gLSAgICAgICAgICAgICAgIH0gZWxzZSB7Cj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgaWYgKGFkZXYtPnBtLnBwX2ZlYXR1cmUgJiBQUF9HRlhPRkZfTUFTSykKPiAtICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwo+IC0gICAgICAgICAgICAg
ICAgICAgICAgICp2YWx1ZSA9IFJSRUczMihyZWdfb2Zmc2V0KTsKPiAtICAgICAgICAgICAgICAg
fQo+ICsgICAgICAgICAgICAgICBpZiAocmVnX29mZnNldCA9PSBTT0MxNV9SRUdfT0ZGU0VUKEdD
LCAwLCBtbUdCX0FERFJfQ09ORklHKSkKPiArICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g
YWRldi0+Z2Z4LmNvbmZpZy5nYl9hZGRyX2NvbmZpZzsKPiArICAgICAgICAgICAgICAgcmV0dXJu
IFJSRUczMihyZWdfb2Zmc2V0KTsKPiAgICAgICAgIH0KPiAtICAgICAgIHJldHVybiAwOwo+ICB9
Cj4KPiAgc3RhdGljIGludCBudl9yZWFkX3JlZ2lzdGVyKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LCB1MzIgc2VfbnVtLAo+IEBAIC0yMzUsOSArMjI3LDEwIEBAIHN0YXRpYyBpbnQgbnZfcmVh
ZF9yZWdpc3RlcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdTMyIHNlX251bSwKPiAgICAg
ICAgICAgICAgICAgICAgIChhZGV2LT5yZWdfb2Zmc2V0W2VuLT5od2lwXVtlbi0+aW5zdF1bZW4t
PnNlZ10gKyBlbi0+cmVnX29mZnNldCkpCj4gICAgICAgICAgICAgICAgICAgICAgICAgY29udGlu
dWU7Cj4KPiAtICAgICAgICAgICAgICAgcmV0dXJuIG52X2dldF9yZWdpc3Rlcl92YWx1ZShhZGV2
LAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG52X2FsbG93
ZWRfcmVhZF9yZWdpc3RlcnNbaV0uZ3JibV9pbmRleGVkLAo+IC0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHNlX251bSwgc2hfbnVtLCByZWdfb2Zmc2V0LCB2YWx1
ZSk7Cj4gKyAgICAgICAgICAgICAgICp2YWx1ZSA9IG52X2dldF9yZWdpc3Rlcl92YWx1ZShhZGV2
LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnZfYWxs
b3dlZF9yZWFkX3JlZ2lzdGVyc1tpXS5ncmJtX2luZGV4ZWQsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZV9udW0sIHNoX251bSwgcmVnX29mZnNldCk7
Cj4gKyAgICAgICAgICAgICAgIHJldHVybiAwOwo+ICAgICAgICAgfQo+ICAgICAgICAgcmV0dXJu
IC1FSU5WQUw7Cj4gIH0KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
c29jMTUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NvYzE1LmMKPiBpbmRleCAzYjU1
NjU1Zjc5YzQuLjhlMTY0MGJjMDdhZiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9zb2MxNS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc29jMTUu
Ywo+IEBAIC0zNjMsMjcgKzM2MywxOSBAQCBzdGF0aWMgdWludDMyX3Qgc29jMTVfcmVhZF9pbmRl
eGVkX3JlZ2lzdGVyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgc2Vfbgo+ICAgICAg
ICAgcmV0dXJuIHZhbDsKPiAgfQo+Cj4gLXN0YXRpYyBpbnQgc29jMTVfZ2V0X3JlZ2lzdGVyX3Zh
bHVlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICtzdGF0aWMgdWludDMyX3Qgc29jMTVf
Z2V0X3JlZ2lzdGVyX3ZhbHVlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBpbmRleGVkLCB1MzIgc2VfbnVt
LAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdTMyIHNoX251bSwg
dTMyIHJlZ19vZmZzZXQsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB1MzIgKnZhbHVlKQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dTMyIHNoX251bSwgdTMyIHJlZ19vZmZzZXQpCj4gIHsKPiAgICAgICAgIGlmIChpbmRleGVkKSB7
Cj4gLSAgICAgICAgICAgICAgIGlmIChhZGV2LT5wbS5wcF9mZWF0dXJlICYgUFBfR0ZYT0ZGX01B
U0spCj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7Cj4gLSAgICAgICAg
ICAgICAgICp2YWx1ZSA9IHNvYzE1X3JlYWRfaW5kZXhlZF9yZWdpc3RlcihhZGV2LCBzZV9udW0s
IHNoX251bSwgcmVnX29mZnNldCk7Cj4gKyAgICAgICAgICAgICAgIHJldHVybiBzb2MxNV9yZWFk
X2luZGV4ZWRfcmVnaXN0ZXIoYWRldiwgc2VfbnVtLCBzaF9udW0sIHJlZ19vZmZzZXQpOwo+ICAg
ICAgICAgfSBlbHNlIHsKPiAtICAgICAgICAgICAgICAgaWYgKHJlZ19vZmZzZXQgPT0gU09DMTVf
UkVHX09GRlNFVChHQywgMCwgbW1HQl9BRERSX0NPTkZJRykpIHsKPiAtICAgICAgICAgICAgICAg
ICAgICAgICAqdmFsdWUgPSBhZGV2LT5nZnguY29uZmlnLmdiX2FkZHJfY29uZmlnOwo+IC0gICAg
ICAgICAgICAgICB9IGVsc2UgaWYgKHJlZ19vZmZzZXQgPT0gU09DMTVfUkVHX09GRlNFVChHQywg
MCwgbW1EQl9ERUJVRzIpKSB7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgKnZhbHVlID0gYWRl
di0+Z2Z4LmNvbmZpZy5kYl9kZWJ1ZzI7Cj4gLSAgICAgICAgICAgICAgIH0gZWxzZSB7Cj4gLSAg
ICAgICAgICAgICAgICAgICAgICAgaWYgKGFkZXYtPnBtLnBwX2ZlYXR1cmUgJiBQUF9HRlhPRkZf
TUFTSykKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwo+
IC0gICAgICAgICAgICAgICAgICAgICAgICp2YWx1ZSA9IFJSRUczMihyZWdfb2Zmc2V0KTsKPiAt
ICAgICAgICAgICAgICAgfQo+ICsgICAgICAgICAgICAgICBpZiAocmVnX29mZnNldCA9PSBTT0Mx
NV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUdCX0FERFJfQ09ORklHKSkKPiArICAgICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gYWRldi0+Z2Z4LmNvbmZpZy5nYl9hZGRyX2NvbmZpZzsKPiArICAgICAg
ICAgICAgICAgZWxzZSBpZiAocmVnX29mZnNldCA9PSBTT0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBt
bURCX0RFQlVHMikpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFkZXYtPmdmeC5j
b25maWcuZGJfZGVidWcyOwo+ICsgICAgICAgICAgICAgICByZXR1cm4gUlJFRzMyKHJlZ19vZmZz
ZXQpOwo+ICAgICAgICAgfQo+IC0gICAgICAgcmV0dXJuIDA7Cj4gIH0KPgo+ICBzdGF0aWMgaW50
IHNvYzE1X3JlYWRfcmVnaXN0ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiBzZV9u
dW0sCj4gQEAgLTM5OSw5ICszOTEsMTAgQEAgc3RhdGljIGludCBzb2MxNV9yZWFkX3JlZ2lzdGVy
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgc2VfbnVtLAo+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICArIGVuLT5yZWdfb2Zmc2V0KSkKPiAgICAgICAgICAg
ICAgICAgICAgICAgICBjb250aW51ZTsKPgo+IC0gICAgICAgICAgICAgICByZXR1cm4gc29jMTVf
Z2V0X3JlZ2lzdGVyX3ZhbHVlKGFkZXYsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc29jMTVfYWxsb3dlZF9yZWFkX3JlZ2lzdGVyc1tpXS5ncmJtX2lu
ZGV4ZWQsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
c2VfbnVtLCBzaF9udW0sIHJlZ19vZmZzZXQsIHZhbHVlKTsKPiArICAgICAgICAgICAgICAgKnZh
bHVlID0gc29jMTVfZ2V0X3JlZ2lzdGVyX3ZhbHVlKGFkZXYsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2MxNV9hbGxvd2VkX3JlYWRfcmVnaXN0
ZXJzW2ldLmdyYm1faW5kZXhlZCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHNlX251bSwgc2hfbnVtLCByZWdfb2Zmc2V0KTsKPiArICAgICAgICAg
ICAgICAgcmV0dXJuIDA7Cj4gICAgICAgICB9Cj4gICAgICAgICByZXR1cm4gLUVJTlZBTDsKPiAg
fQo+IC0tCj4gMi4yMy4wCj4KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
