Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E3559BBBB1
	for <lists+amd-gfx@lfdr.de>; Mon, 23 Sep 2019 20:38:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5730A6E06D;
	Mon, 23 Sep 2019 18:38:26 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qk1-x741.google.com (mail-qk1-x741.google.com
 [IPv6:2607:f8b0:4864:20::741])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 639816E06D
 for <amd-gfx@lists.freedesktop.org>; Mon, 23 Sep 2019 18:38:25 +0000 (UTC)
Received: by mail-qk1-x741.google.com with SMTP id u184so16539270qkd.4
 for <amd-gfx@lists.freedesktop.org>; Mon, 23 Sep 2019 11:38:25 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=bek4Ntd9CKO8BRJ4UuR2GABzh1H3vYNc1FA9gl4tFYs=;
 b=jXfjCBPaXF4hoV9cuIf8e1ofCC4YxrrJlgtjZggc6BnEXf5/qonrVnGg/DwGARlqUU
 y4gZzas7lBBa+TGiIJHl/dHRsKuzAIVIAqMmIlIDvKSSv4UpwuUYsEB0DBngv94+sKcA
 DkJmempjwFkLm+8pVCsLWhslu58UMt2H+itg0ajQDoZQSTYqEmsZ47OTRWQOVXfIHz3/
 EN4XoGFV/gCjIsvZo7O2Iyo2hqPk959VJDAWqynSgo0ILgg2QdScWiNbJGpzGsfFAW4X
 hr7X7fjCkQs46/hiIdhZgRlnGwEslcqWwoGj2EeeKlKnqWN4xsO3I6rwit1+6G1jANKM
 940Q==
X-Gm-Message-State: APjAAAWo6F5atFlB6n6RfnMjwJyYmVo5CCohl0EQ7mv5UVUz7NYel4Tg
 pKrkFzXWexpXnBm1DWgMQVr8Y9G5
X-Google-Smtp-Source: APXvYqynaisg3MVfBE+yY4scu0MVG5QdhU7/Ds5qXBFxdeHRPrK68fF6ID1G9bGn6BaMD7/liVQA3A==
X-Received: by 2002:a37:a089:: with SMTP id j131mr1371792qke.446.1569263904093; 
 Mon, 23 Sep 2019 11:38:24 -0700 (PDT)
Received: from localhost.localdomain ([71.219.73.178])
 by smtp.gmail.com with ESMTPSA id l7sm5605421qke.67.2019.09.23.11.38.23
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 23 Sep 2019 11:38:23 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH] drm/amdgpu/atomfirmware: use proper index for querying vram
 type (v2)
Date: Mon, 23 Sep 2019 13:38:14 -0500
Message-Id: <20190923183814.2118-1-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=bek4Ntd9CKO8BRJ4UuR2GABzh1H3vYNc1FA9gl4tFYs=;
 b=C9OwBsliaEw+mtJvSyroRMEa7e+p+ku8KtV7g5bTMp4JlYcy3IomLRD+4EOUlljp+P
 hv0dohniY0W9LvGP+txNDNns9KLR6j0rxR4XD8Sz3yVEhixGSUJFl4VG2U2s3H2cNcns
 PGcxBuinjqjxeADEEY9eEci8Bvs1liuZwG3ZBKLngmih19/pOGHXe6OHUaYaSWyWmrAd
 WEEoNMHnSJirEOqdFvsGb0VsULPQfjeJD7oUlFIfTQhJOS2vls3JM/ifKQddy+wCVq7e
 sPin7/o/Gvl2WAsDYmiS6GmfuTag0A6FM+avFJMwSUPWJOHjeGsf+orexcNAM0Npcvte
 bSeg==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhlIGluZGV4IGlzIHN0b3JlZCBpbiBzY3JhdGNoIHJlZ2lzdGVyIDQgYWZ0ZXIgYXNpYyBpbml0
LiAgVXNlCnRoYXQgaW5kZXguICBObyBmdW5jdGlvbmFsIGNoYW5nZSBzaW5jZSBhbGwgYXNpY3Mg
aW4gYSBmYW1pbHkKdXNlIHRoZSBzYW1lIHR5cGUgb2YgdnJhbSAoRzUsIEc2LCBIQk0pIGFuZCB0
aGF0IGlzIGFsbCB3ZSB1c2UKYXQgdGhlIG1vbmVudCwgYnV0IGlmIHdlIGV2ZXIgbmVlZCB0byBx
dWVyeSBvdGhlciBpbmZvLCB3ZSB3aWxsCm5vdyBoYXZlIHRoZSBwcm9wZXIgaW5kZXguCgp2Mjog
bW9kdWxlIGFycmF5IGlzIHZhcmlhYmxlIHNpemVkLCBoYW5kbGUgdGhhdC4KClNpZ25lZC1vZmYt
Ynk6IEFsZXggRGV1Y2hlciA8YWxleGFuZGVyLmRldWNoZXJAYW1kLmNvbT4KLS0tCiAuLi4vZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hdG9tZmlybXdhcmUuYyAgfCAxNTYgKysrKysrKysrKy0t
LS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgODYgaW5zZXJ0aW9ucygrKSwgNzAgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2F0b21maXJt
d2FyZS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2F0b21maXJtd2FyZS5j
CmluZGV4IGRhZjY4NzQyOGNkYi4uYjVmOTlkZGU2NjYzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYXRvbWZpcm13YXJlLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2F0b21maXJtd2FyZS5jCkBAIC0xMjAsNjUgKzEyMCwxNCBA
QCB1bmlvbiB2cmFtX2luZm8gewogCXN0cnVjdCBhdG9tX3ZyYW1faW5mb19oZWFkZXJfdjJfMyB2
MjM7CiAJc3RydWN0IGF0b21fdnJhbV9pbmZvX2hlYWRlcl92Ml80IHYyNDsKIH07Ci0vKgotICog
UmV0dXJuIHZyYW0gd2lkdGggZnJvbSBpbnRlZ3JhdGVkIHN5c3RlbSBpbmZvIHRhYmxlLCBpZiBh
dmFpbGFibGUsCi0gKiBvciAwIGlmIG5vdC4KLSAqLwotaW50IGFtZGdwdV9hdG9tZmlybXdhcmVf
Z2V0X3ZyYW1fd2lkdGgoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCi17Ci0Jc3RydWN0IGFt
ZGdwdV9tb2RlX2luZm8gKm1vZGVfaW5mbyA9ICZhZGV2LT5tb2RlX2luZm87Ci0JaW50IGluZGV4
OwotCXUxNiBkYXRhX29mZnNldCwgc2l6ZTsKLQl1bmlvbiBpZ3BfaW5mbyAqaWdwX2luZm87Ci0J
dW5pb24gdnJhbV9pbmZvICp2cmFtX2luZm87Ci0JdTMyIG1lbV9jaGFubmVsX251bWJlcjsKLQl1
MzIgbWVtX2NoYW5uZWxfd2lkdGg7Ci0JdTggZnJldiwgY3JldjsKLQotCWlmIChhZGV2LT5mbGFn
cyAmIEFNRF9JU19BUFUpCi0JCWluZGV4ID0gZ2V0X2luZGV4X2ludG9fbWFzdGVyX3RhYmxlKGF0
b21fbWFzdGVyX2xpc3Rfb2ZfZGF0YV90YWJsZXNfdjJfMSwKLQkJCQkJCSAgICBpbnRlZ3JhdGVk
c3lzdGVtaW5mbyk7Ci0JZWxzZQotCQlpbmRleCA9IGdldF9pbmRleF9pbnRvX21hc3Rlcl90YWJs
ZShhdG9tX21hc3Rlcl9saXN0X29mX2RhdGFfdGFibGVzX3YyXzEsCi0JCQkJCQkgICAgdnJhbV9p
bmZvKTsKLQotCS8qIGdldCBhbnkgaWdwIHNwZWNpZmljIG92ZXJyaWRlcyAqLwotCWlmIChhbWRn
cHVfYXRvbV9wYXJzZV9kYXRhX2hlYWRlcihtb2RlX2luZm8tPmF0b21fY29udGV4dCwgaW5kZXgs
ICZzaXplLAotCQkJCSAgICZmcmV2LCAmY3JldiwgJmRhdGFfb2Zmc2V0KSkgewotCQlpZiAoYWRl
di0+ZmxhZ3MgJiBBTURfSVNfQVBVKSB7Ci0JCQlpZ3BfaW5mbyA9ICh1bmlvbiBpZ3BfaW5mbyAq
KQotCQkJCShtb2RlX2luZm8tPmF0b21fY29udGV4dC0+YmlvcyArIGRhdGFfb2Zmc2V0KTsKLQkJ
CXN3aXRjaCAoY3JldikgewotCQkJY2FzZSAxMToKLQkJCQltZW1fY2hhbm5lbF9udW1iZXIgPSBp
Z3BfaW5mby0+djExLnVtYWNoYW5uZWxudW1iZXI7Ci0JCQkJLyogY2hhbm5lbCB3aWR0aCBpcyA2
NCAqLwotCQkJCXJldHVybiBtZW1fY2hhbm5lbF9udW1iZXIgKiA2NDsKLQkJCWRlZmF1bHQ6Ci0J
CQkJcmV0dXJuIDA7Ci0JCQl9Ci0JCX0gZWxzZSB7Ci0JCQl2cmFtX2luZm8gPSAodW5pb24gdnJh
bV9pbmZvICopCi0JCQkJKG1vZGVfaW5mby0+YXRvbV9jb250ZXh0LT5iaW9zICsgZGF0YV9vZmZz
ZXQpOwotCQkJc3dpdGNoIChjcmV2KSB7Ci0JCQljYXNlIDM6Ci0JCQkJbWVtX2NoYW5uZWxfbnVt
YmVyID0gdnJhbV9pbmZvLT52MjMudnJhbV9tb2R1bGVbMF0uY2hhbm5lbF9udW07Ci0JCQkJbWVt
X2NoYW5uZWxfd2lkdGggPSB2cmFtX2luZm8tPnYyMy52cmFtX21vZHVsZVswXS5jaGFubmVsX3dp
ZHRoOwotCQkJCXJldHVybiBtZW1fY2hhbm5lbF9udW1iZXIgKiAoMSA8PCBtZW1fY2hhbm5lbF93
aWR0aCk7Ci0JCQljYXNlIDQ6Ci0JCQkJbWVtX2NoYW5uZWxfbnVtYmVyID0gdnJhbV9pbmZvLT52
MjQudnJhbV9tb2R1bGVbMF0uY2hhbm5lbF9udW07Ci0JCQkJbWVtX2NoYW5uZWxfd2lkdGggPSB2
cmFtX2luZm8tPnYyNC52cmFtX21vZHVsZVswXS5jaGFubmVsX3dpZHRoOwotCQkJCXJldHVybiBt
ZW1fY2hhbm5lbF9udW1iZXIgKiAoMSA8PCBtZW1fY2hhbm5lbF93aWR0aCk7Ci0JCQlkZWZhdWx0
OgotCQkJCXJldHVybiAwOwotCQkJfQotCQl9Ci0JfQogCi0JcmV0dXJuIDA7Ci19Cit1bmlvbiB2
cmFtX21vZHVsZSB7CisJc3RydWN0IGF0b21fdnJhbV9tb2R1bGVfdjkgdjk7CisJc3RydWN0IGF0
b21fdnJhbV9tb2R1bGVfdjEwIHYxMDsKK307CiAKLXN0YXRpYyBpbnQgY29udmVydF9hdG9tX21l
bV90eXBlX3RvX3ZyYW1fdHlwZSAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCi0JCQkJCSAg
ICAgICBpbnQgYXRvbV9tZW1fdHlwZSkKK3N0YXRpYyBpbnQgY29udmVydF9hdG9tX21lbV90eXBl
X3RvX3ZyYW1fdHlwZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKKwkJCQkJICAgICAgaW50
IGF0b21fbWVtX3R5cGUpCiB7CiAJaW50IHZyYW1fdHlwZTsKIApAQCAtMjE5LDE5ICsxNjgsMjMg
QEAgc3RhdGljIGludCBjb252ZXJ0X2F0b21fbWVtX3R5cGVfdG9fdnJhbV90eXBlIChzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldiwKIAogCXJldHVybiB2cmFtX3R5cGU7CiB9Ci0vKgotICogUmV0
dXJuIHZyYW0gdHlwZSBmcm9tIGVpdGhlciBpbnRlZ3JhdGVkIHN5c3RlbSBpbmZvIHRhYmxlCi0g
KiBvciB1bWMgaW5mbyB0YWJsZSwgaWYgYXZhaWxhYmxlLCBvciAwIChUWVBFX1VOS05PV04pIGlm
IG5vdAotICovCi1pbnQgYW1kZ3B1X2F0b21maXJtd2FyZV9nZXRfdnJhbV90eXBlKHN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2KQorCitzdGF0aWMgaW50CithbWRncHVfYXRvbWZpcm13YXJlX2dl
dF92cmFtX2luZm8oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJCQkJICBpbnQgKnZyYW1f
d2lkdGgsIGludCAqdnJhbV90eXBlKQogewogCXN0cnVjdCBhbWRncHVfbW9kZV9pbmZvICptb2Rl
X2luZm8gPSAmYWRldi0+bW9kZV9pbmZvOwotCWludCBpbmRleDsKKwlpbnQgaW5kZXgsIGk7CiAJ
dTE2IGRhdGFfb2Zmc2V0LCBzaXplOwogCXVuaW9uIGlncF9pbmZvICppZ3BfaW5mbzsKIAl1bmlv
biB2cmFtX2luZm8gKnZyYW1faW5mbzsKKwl1bmlvbiB2cmFtX21vZHVsZSAqdnJhbV9tb2R1bGU7
CiAJdTggZnJldiwgY3JldjsKIAl1OCBtZW1fdHlwZTsKKwl1MzIgbWVtX2NoYW5uZWxfbnVtYmVy
OworCXUzMiBtZW1fY2hhbm5lbF93aWR0aDsKKwl1MzIgbW9kdWxlX2lkOworCiAKIAlpZiAoYWRl
di0+ZmxhZ3MgJiBBTURfSVNfQVBVKQogCQlpbmRleCA9IGdldF9pbmRleF9pbnRvX21hc3Rlcl90
YWJsZShhdG9tX21hc3Rlcl9saXN0X29mX2RhdGFfdGFibGVzX3YyXzEsCkBAIC0yMzksNiArMTky
LDcgQEAgaW50IGFtZGdwdV9hdG9tZmlybXdhcmVfZ2V0X3ZyYW1fdHlwZShzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldikKIAllbHNlCiAJCWluZGV4ID0gZ2V0X2luZGV4X2ludG9fbWFzdGVyX3Rh
YmxlKGF0b21fbWFzdGVyX2xpc3Rfb2ZfZGF0YV90YWJsZXNfdjJfMSwKIAkJCQkJCSAgICB2cmFt
X2luZm8pOworCiAJaWYgKGFtZGdwdV9hdG9tX3BhcnNlX2RhdGFfaGVhZGVyKG1vZGVfaW5mby0+
YXRvbV9jb250ZXh0LAogCQkJCQkgIGluZGV4LCAmc2l6ZSwKIAkJCQkJICAmZnJldiwgJmNyZXYs
ICZkYXRhX29mZnNldCkpIHsKQEAgLTI0NywzMCArMjAxLDkyIEBAIGludCBhbWRncHVfYXRvbWZp
cm13YXJlX2dldF92cmFtX3R5cGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCQkJKG1v
ZGVfaW5mby0+YXRvbV9jb250ZXh0LT5iaW9zICsgZGF0YV9vZmZzZXQpOwogCQkJc3dpdGNoIChj
cmV2KSB7CiAJCQljYXNlIDExOgorCQkJCW1lbV9jaGFubmVsX251bWJlciA9IGlncF9pbmZvLT52
MTEudW1hY2hhbm5lbG51bWJlcjsKKwkJCQkvKiBjaGFubmVsIHdpZHRoIGlzIDY0ICovCisJCQkJ
aWYgKHZyYW1fd2lkdGgpCisJCQkJCSp2cmFtX3dpZHRoID0gbWVtX2NoYW5uZWxfbnVtYmVyICog
NjQ7CiAJCQkJbWVtX3R5cGUgPSBpZ3BfaW5mby0+djExLm1lbW9yeXR5cGU7Ci0JCQkJcmV0dXJu
IGNvbnZlcnRfYXRvbV9tZW1fdHlwZV90b192cmFtX3R5cGUoYWRldiwgbWVtX3R5cGUpOworCQkJ
CWlmICh2cmFtX3R5cGUpCisJCQkJCSp2cmFtX3R5cGUgPSBjb252ZXJ0X2F0b21fbWVtX3R5cGVf
dG9fdnJhbV90eXBlKGFkZXYsIG1lbV90eXBlKTsKKwkJCQlicmVhazsKIAkJCWRlZmF1bHQ6Ci0J
CQkJcmV0dXJuIDA7CisJCQkJcmV0dXJuIC1FSU5WQUw7CiAJCQl9CiAJCX0gZWxzZSB7CisJCQlt
b2R1bGVfaWQgPSAoUlJFRzMyKGFkZXYtPmJpb3Nfc2NyYXRjaF9yZWdfb2Zmc2V0ICsgNCkgJiAw
eDAwZmYwMDAwKSA+PiAxNjsKIAkJCXZyYW1faW5mbyA9ICh1bmlvbiB2cmFtX2luZm8gKikKIAkJ
CQkobW9kZV9pbmZvLT5hdG9tX2NvbnRleHQtPmJpb3MgKyBkYXRhX29mZnNldCk7CiAJCQlzd2l0
Y2ggKGNyZXYpIHsKIAkJCWNhc2UgMzoKLQkJCQltZW1fdHlwZSA9IHZyYW1faW5mby0+djIzLnZy
YW1fbW9kdWxlWzBdLm1lbW9yeV90eXBlOwotCQkJCXJldHVybiBjb252ZXJ0X2F0b21fbWVtX3R5
cGVfdG9fdnJhbV90eXBlKGFkZXYsIG1lbV90eXBlKTsKKwkJCQl2cmFtX21vZHVsZSA9ICh1bmlv
biB2cmFtX21vZHVsZSAqKXZyYW1faW5mby0+djIzLnZyYW1fbW9kdWxlOworCQkJCWZvciAoaSA9
IDA7IGkgPCB2cmFtX2luZm8tPnYyMy52cmFtX21vZHVsZV9udW07IGkrKykgeworCQkJCQl2cmFt
X21vZHVsZSA9ICh1bmlvbiB2cmFtX21vZHVsZSAqKQorCQkJCQkJKCh1OCAqKXZyYW1fbW9kdWxl
ICsgdnJhbV9tb2R1bGUtPnY5LnZyYW1fbW9kdWxlX3NpemUpOworCQkJCQlpZiAoaSA9PSBtb2R1
bGVfaWQpCisJCQkJCQlicmVhazsKKwkJCQl9CisJCQkJbWVtX3R5cGUgPSB2cmFtX21vZHVsZS0+
djkubWVtb3J5X3R5cGU7CisJCQkJaWYgKHZyYW1fdHlwZSkKKwkJCQkJKnZyYW1fdHlwZSA9IGNv
bnZlcnRfYXRvbV9tZW1fdHlwZV90b192cmFtX3R5cGUoYWRldiwgbWVtX3R5cGUpOworCQkJCW1l
bV9jaGFubmVsX251bWJlciA9IHZyYW1fbW9kdWxlLT52OS5jaGFubmVsX251bTsKKwkJCQltZW1f
Y2hhbm5lbF93aWR0aCA9IHZyYW1fbW9kdWxlLT52OS5jaGFubmVsX3dpZHRoOworCQkJCWlmICh2
cmFtX3dpZHRoKQorCQkJCQkqdnJhbV93aWR0aCA9IG1lbV9jaGFubmVsX251bWJlciAqICgxIDw8
IG1lbV9jaGFubmVsX3dpZHRoKTsKKwkJCQlicmVhazsKIAkJCWNhc2UgNDoKLQkJCQltZW1fdHlw
ZSA9IHZyYW1faW5mby0+djI0LnZyYW1fbW9kdWxlWzBdLm1lbW9yeV90eXBlOwotCQkJCXJldHVy
biBjb252ZXJ0X2F0b21fbWVtX3R5cGVfdG9fdnJhbV90eXBlKGFkZXYsIG1lbV90eXBlKTsKKwkJ
CQl2cmFtX21vZHVsZSA9ICh1bmlvbiB2cmFtX21vZHVsZSAqKXZyYW1faW5mby0+djI0LnZyYW1f
bW9kdWxlOworCQkJCWZvciAoaSA9IDA7IGkgPCB2cmFtX2luZm8tPnYyNC52cmFtX21vZHVsZV9u
dW07IGkrKykgeworCQkJCQl2cmFtX21vZHVsZSA9ICh1bmlvbiB2cmFtX21vZHVsZSAqKQorCQkJ
CQkJKCh1OCAqKXZyYW1fbW9kdWxlICsgdnJhbV9tb2R1bGUtPnYxMC52cmFtX21vZHVsZV9zaXpl
KTsKKwkJCQkJaWYgKGkgPT0gbW9kdWxlX2lkKQorCQkJCQkJYnJlYWs7CisJCQkJfQorCQkJCW1l
bV90eXBlID0gdnJhbV9tb2R1bGUtPnYxMC5tZW1vcnlfdHlwZTsKKwkJCQlpZiAodnJhbV90eXBl
KQorCQkJCQkqdnJhbV90eXBlID0gY29udmVydF9hdG9tX21lbV90eXBlX3RvX3ZyYW1fdHlwZShh
ZGV2LCBtZW1fdHlwZSk7CisJCQkJbWVtX2NoYW5uZWxfbnVtYmVyID0gdnJhbV9tb2R1bGUtPnYx
MC5jaGFubmVsX251bTsKKwkJCQltZW1fY2hhbm5lbF93aWR0aCA9IHZyYW1fbW9kdWxlLT52MTAu
Y2hhbm5lbF93aWR0aDsKKwkJCQlpZiAodnJhbV93aWR0aCkKKwkJCQkJKnZyYW1fd2lkdGggPSBt
ZW1fY2hhbm5lbF9udW1iZXIgKiAoMSA8PCBtZW1fY2hhbm5lbF93aWR0aCk7CisJCQkJYnJlYWs7
CiAJCQlkZWZhdWx0OgotCQkJCXJldHVybiAwOworCQkJCXJldHVybiAtRUlOVkFMOwogCQkJfQog
CQl9CisKIAl9CiAKIAlyZXR1cm4gMDsKIH0KIAorLyoKKyAqIFJldHVybiB2cmFtIHdpZHRoIGZy
b20gaW50ZWdyYXRlZCBzeXN0ZW0gaW5mbyB0YWJsZSwgaWYgYXZhaWxhYmxlLAorICogb3IgMCBp
ZiBub3QuCisgKi8KK2ludCBhbWRncHVfYXRvbWZpcm13YXJlX2dldF92cmFtX3dpZHRoKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2KQoreworCWludCB2cmFtX3dpZHRoID0gMCwgdnJhbV90eXBl
ID0gMDsKKwlpbnQgciA9IGFtZGdwdV9hdG9tZmlybXdhcmVfZ2V0X3ZyYW1faW5mbyhhZGV2LCAm
dnJhbV93aWR0aCwgJnZyYW1fdHlwZSk7CisJaWYgKHIpCisJCXJldHVybiAwOworCisJcmV0dXJu
IHZyYW1fd2lkdGg7Cit9CisKKy8qCisgKiBSZXR1cm4gdnJhbSB0eXBlIGZyb20gZWl0aGVyIGlu
dGVncmF0ZWQgc3lzdGVtIGluZm8gdGFibGUKKyAqIG9yIHVtYyBpbmZvIHRhYmxlLCBpZiBhdmFp
bGFibGUsIG9yIDAgKFRZUEVfVU5LTk9XTikgaWYgbm90CisgKi8KK2ludCBhbWRncHVfYXRvbWZp
cm13YXJlX2dldF92cmFtX3R5cGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCit7CisJaW50
IHZyYW1fd2lkdGggPSAwLCB2cmFtX3R5cGUgPSAwOworCWludCByID0gYW1kZ3B1X2F0b21maXJt
d2FyZV9nZXRfdnJhbV9pbmZvKGFkZXYsICZ2cmFtX3dpZHRoLCAmdnJhbV90eXBlKTsKKwlpZiAo
cikKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gdnJhbV90eXBlOworfQorCiAvKgogICogUmV0dXJu
IHRydWUgaWYgdmJpb3MgZW5hYmxlZCBlY2MgYnkgZGVmYXVsdCwgaWYgdW1jIGluZm8gdGFibGUg
aXMgYXZhaWxhYmxlCiAgKiBvciBmYWxzZSBpZiBlY2MgaXMgbm90IGVuYWJsZWQgb3IgdW1jIGlu
Zm8gdGFibGUgaXMgbm90IGF2YWlsYWJsZQotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2FtZC1nZng=
