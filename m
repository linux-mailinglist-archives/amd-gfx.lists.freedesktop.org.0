Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 21C4EF59D8
	for <lists+amd-gfx@lfdr.de>; Fri,  8 Nov 2019 22:28:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A44CB6FA8E;
	Fri,  8 Nov 2019 21:28:50 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-io1-xd44.google.com (mail-io1-xd44.google.com
 [IPv6:2607:f8b0:4864:20::d44])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0900D6E0D7
 for <amd-gfx@lists.freedesktop.org>; Fri,  8 Nov 2019 21:28:49 +0000 (UTC)
Received: by mail-io1-xd44.google.com with SMTP id q83so7927243iod.1
 for <amd-gfx@lists.freedesktop.org>; Fri, 08 Nov 2019 13:28:48 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=92TIYZFaswslHRDE5y3Z9w/dyn4AJyBvfVnBr3Gndjc=;
 b=KVunepL6jd0X4G5YRs6FqZdJbFmlxUhOgY2HTzZPvczdra72t+g3VLsWnZmhTN25gT
 sluEtKKGfw8/gKzWOBkHdwUSxBpJTHxIs8oenOYwMbl2iHm5dpC6ii25KKb9Ft+ad3ju
 9vAZ4wrBgbAWt0dr4ZqNikdvD/A7+U7C8WuPHzlMul6B9K6ksjTrzw9PzR+iH6xDx1AA
 jDDceM6o+1zstpgikHYHxnS++SzkFT0OKp+ApiOlZlf7D5svcBWExraXBUzvA7kshFpT
 44vboJuwdAJQfZz6oEstfGojJ4tD8HZtiqGaWBaxvSFurn2Cyx9dPT55zd6L7RJM3xyS
 AGWA==
X-Gm-Message-State: APjAAAU0J1AgJmgAYO8/b/Zm2Z4ESJ8/4IWaUGXlikyA0qETiqtbJTCw
 yXunxUtH6Wyqo6tBT3tzmuXBiBHZTvxKDQ==
X-Google-Smtp-Source: APXvYqxKkVIw8GpLhVZitxvF652zPUCwCBoVBliKR3TOxS1rBOmcMnh+BhjJKXjRzRabj3nTIelTag==
X-Received: by 2002:a6b:b54a:: with SMTP id e71mr12868812iof.132.1573248528139; 
 Fri, 08 Nov 2019 13:28:48 -0800 (PST)
Received: from localhost.localdomain ([2602:47:da84:5600:6d4:c4ff:fe4a:ea6b])
 by smtp.gmail.com with ESMTPSA id
 g11sm961732ilq.39.2019.11.08.13.28.47
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 08 Nov 2019 13:28:47 -0800 (PST)
From: Matt Coffin <mcoffin13@gmail.com>
To: amd-gfx@lists.freedesktop.org,
	Evan.Quan@amd.com
Subject: [PATCH v2 1/3] drm/amdgpu/navi10: implement sclk/mclk OD via
 pp_od_clk_voltage
Date: Fri,  8 Nov 2019 14:28:06 -0700
Message-Id: <1be981205c8b0c7f555780e2ad7064d955ce9efb.1573248368.git.mcoffin13@gmail.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <cover.1573248368.git.mcoffin13@gmail.com>
References: <cover.1573248368.git.mcoffin13@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=92TIYZFaswslHRDE5y3Z9w/dyn4AJyBvfVnBr3Gndjc=;
 b=Eqyhjvo8Za3MSQSoYjvuVh1nNeQHJIR6Z8KyprV4WOuQD63g8tupDhrxD+v7SVLaNf
 Uo/6UcG2lJ5HtiN5AL8BCcPMNLynFDFAFurGKAHE8fa3RLlwrM7fFPYAX8U9KXfo7jpw
 hRxZz4YqC7UPn3aZ2/mKqPd1MRMfowEpstl2cT0yAjNccH++YUU6ATWIIdhcaFzm6u0M
 +qeOklcXV9Pp2tHrvViDYv8i54ISwSBCOIfEu64njOWKokWTdp3MmGJWF217grS9YAKo
 ENeWrvtni4MlJfqLYyp7cBR/ghZIalTaciWSlE8iFCtFuVUCF8qfDW4Ua3rwlK8YIPqK
 xzJA==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alexander.Deucher@amd.com, Matt Coffin <mcoffin13@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

W1doeV0KQmVmb3JlIHRoaXMgcGF0Y2gsIHRoZXJlIHdhcyBubyB3YXkgdG8gdXNlIHBwX29kX2Ns
a192b2x0YWdlIG9uIG5hdmkKCltIb3ddClNpbWlsYXIgdG8gdGhlIHZlZ2EyMCBpbXBsZW1lbnRh
dGlvbiwgYnV0IHVzaW5nIHRoZSBjb21tb24gc21jX3YxMV8wCmhlYWRlcnMsIGltcGxlbWVudGVk
IHRoZSBwcF9vZF9jbGtfdm9sdGFnZSBBUEkgZm9yIG5hdmkxMCdzIHBwdGFibGUKaW1wbGVtZW50
YXRpb24KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9pbmMvc211X3YxMV8wLmgg
fCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvbmF2aTEwX3BwdC5jICAgIHwg
MTgwICsrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211
X3YxMV8wLmMgICAgIHwgIDI3ICsrKwogMyBmaWxlcyBjaGFuZ2VkLCAyMDkgaW5zZXJ0aW9ucygr
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2luYy9zbXVfdjEx
XzAuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2luYy9zbXVfdjExXzAuaAppbmRl
eCBmZDZlYzkwMzNkMDYuLjE1NGI1N2E0ZGJiYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9wb3dlcnBsYXkvaW5jL3NtdV92MTFfMC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
cG93ZXJwbGF5L2luYy9zbXVfdjExXzAuaApAQCAtMjUwLDQgKzI1MCw2IEBAIGludCBzbXVfdjEx
XzBfc2V0X3NvZnRfZnJlcV9saW1pdGVkX3JhbmdlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBl
bnVtIHNtdV9jbGtfCiAKIGludCBzbXVfdjExXzBfb3ZlcnJpZGVfcGNpZV9wYXJhbWV0ZXJzKHN0
cnVjdCBzbXVfY29udGV4dCAqc211KTsKIAoraW50IHNtdV92MTFfMF9zZXRfZGVmYXVsdF9vZF9z
ZXR0aW5ncyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgYm9vbCBpbml0aWFsaXplLCBzaXplX3Qg
b3ZlcmRyaXZlX3RhYmxlX3NpemUpOworCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvcG93ZXJwbGF5L25hdmkxMF9wcHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93
ZXJwbGF5L25hdmkxMF9wcHQuYwppbmRleCAzNTRmNzA5NzhmODIuLjM1NGY2MzEwMzMwOCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvbmF2aTEwX3BwdC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L25hdmkxMF9wcHQuYwpAQCAtMTY0OSwxMCAr
MTY0OSwxODggQEAgc3RhdGljIGludCBuYXZpMTBfdXBkYXRlX3BjaWVfcGFyYW1ldGVycyhzdHJ1
Y3Qgc211X2NvbnRleHQgKnNtdSwKIAkJCQkJICBTTVVfTVNHX092ZXJyaWRlUGNpZVBhcmFtZXRl
cnMsCiAJCQkJCSAgc211X3BjaWVfYXJnKTsKIAl9CisJcmV0dXJuIHJldDsKK30KKworc3RhdGlj
IGlubGluZSB2b2lkIG5hdmkxMF9kdW1wX29kX3RhYmxlKE92ZXJEcml2ZVRhYmxlX3QgKm9kX3Rh
YmxlKSB7CisJcHJfZGVidWcoIk9EOiBHZnhjbGs6ICglZCwgJWQpXG4iLCBvZF90YWJsZS0+R2Z4
Y2xrRm1pbiwgb2RfdGFibGUtPkdmeGNsa0ZtYXgpOworCXByX2RlYnVnKCJPRDogR2Z4MTogKCVk
LCAlZClcbiIsIG9kX3RhYmxlLT5HZnhjbGtGcmVxMSwgb2RfdGFibGUtPkdmeGNsa1ZvbHQxKTsK
Kwlwcl9kZWJ1ZygiT0Q6IEdmeDI6ICglZCwgJWQpXG4iLCBvZF90YWJsZS0+R2Z4Y2xrRnJlcTIs
IG9kX3RhYmxlLT5HZnhjbGtWb2x0Mik7CisJcHJfZGVidWcoIk9EOiBHZngzOiAoJWQsICVkKVxu
Iiwgb2RfdGFibGUtPkdmeGNsa0ZyZXEzLCBvZF90YWJsZS0+R2Z4Y2xrVm9sdDMpOworCXByX2Rl
YnVnKCJPRDogVWNsa0ZtYXg6ICVkXG4iLCBvZF90YWJsZS0+VWNsa0ZtYXgpOworCXByX2RlYnVn
KCJPRDogT3ZlckRyaXZlUGN0OiAlZFxuIiwgb2RfdGFibGUtPk92ZXJEcml2ZVBjdCk7Cit9CisK
K3N0YXRpYyBpbmxpbmUgYm9vbCBuYXZpMTBfb2RfZmVhdHVyZV9pc19zdXBwb3J0ZWQoc3RydWN0
IHNtdV8xMV8wX292ZXJkcml2ZV90YWJsZSAqb2RfdGFibGUsIGVudW0gU01VXzExXzBfT0RGRUFU
VVJFX0lEIGZlYXR1cmUpCit7CisJcmV0dXJuIG9kX3RhYmxlLT5jYXBbZmVhdHVyZV07Cit9CisK
K3N0YXRpYyBpbnQgbmF2aTEwX29kX3NldHRpbmdfY2hlY2tfcmFuZ2Uoc3RydWN0IHNtdV8xMV8w
X292ZXJkcml2ZV90YWJsZSAqb2RfdGFibGUsIGVudW0gU01VXzExXzBfT0RTRVRUSU5HX0lEIHNl
dHRpbmcsIHVpbnQzMl90IHZhbHVlKQoreworCWlmICh2YWx1ZSA8IG9kX3RhYmxlLT5taW5bc2V0
dGluZ10pIHsKKwkJcHJfd2FybigiT0Qgc2V0dGluZyAoJWQsICVkKSBpcyBsZXNzIHRoYW4gdGhl
IG1pbmltdW0gYWxsb3dlZCAoJWQpXG4iLCBzZXR0aW5nLCB2YWx1ZSwgb2RfdGFibGUtPm1pbltz
ZXR0aW5nXSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwlpZiAodmFsdWUgPiBvZF90YWJsZS0+
bWF4W3NldHRpbmddKSB7CisJCXByX3dhcm4oIk9EIHNldHRpbmcgKCVkLCAlZCkgaXMgZ3JlYXRl
ciB0aGFuIHRoZSBtYXhpbXVtIGFsbG93ZWQgKCVkKVxuIiwgc2V0dGluZywgdmFsdWUsIG9kX3Rh
YmxlLT5tYXhbc2V0dGluZ10pOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyBpbnQgbmF2aTEwX3NldHVwX29kX2xpbWl0cyhzdHJ1Y3Qgc211X2NvbnRleHQg
KnNtdSkgeworCXN0cnVjdCBzbXVfMTFfMF9vdmVyZHJpdmVfdGFibGUgKm92ZXJkcml2ZV90YWJs
ZSA9IE5VTEw7CisJc3RydWN0IHNtdV8xMV8wX3Bvd2VycGxheV90YWJsZSAqcG93ZXJwbGF5X3Rh
YmxlID0gTlVMTDsKKworCWlmICghc211LT5zbXVfdGFibGUucG93ZXJfcGxheV90YWJsZSkgewor
CQlwcl9lcnIoInBvd2VycGxheSB0YWJsZSB1bmluaXRpYWxpemVkIVxuIik7CisJCXJldHVybiAt
RU5PRU5UOworCX0KKwlwb3dlcnBsYXlfdGFibGUgPSAoc3RydWN0IHNtdV8xMV8wX3Bvd2VycGxh
eV90YWJsZSAqKXNtdS0+c211X3RhYmxlLnBvd2VyX3BsYXlfdGFibGU7CisJb3ZlcmRyaXZlX3Rh
YmxlID0gJnBvd2VycGxheV90YWJsZS0+b3ZlcmRyaXZlX3RhYmxlOworCWlmICghc211LT5vZF9z
ZXR0aW5ncykgeworCQlzbXUtPm9kX3NldHRpbmdzID0ga21lbWR1cChvdmVyZHJpdmVfdGFibGUs
IHNpemVvZihzdHJ1Y3Qgc211XzExXzBfb3ZlcmRyaXZlX3RhYmxlKSwgR0ZQX0tFUk5FTCk7CisJ
fSBlbHNlIHsKKwkJbWVtY3B5KHNtdS0+b2Rfc2V0dGluZ3MsIG92ZXJkcml2ZV90YWJsZSwgc2l6
ZW9mKHN0cnVjdCBzbXVfMTFfMF9vdmVyZHJpdmVfdGFibGUpKTsKKwl9CisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyBpbnQgbmF2aTEwX3NldF9kZWZhdWx0X29kX3NldHRpbmdzKHN0cnVjdCBzbXVf
Y29udGV4dCAqc211LCBib29sIGluaXRpYWxpemUpIHsKKwlPdmVyRHJpdmVUYWJsZV90ICpvZF90
YWJsZTsKKwlpbnQgcmV0ID0gMDsKKworCXJldCA9IHNtdV92MTFfMF9zZXRfZGVmYXVsdF9vZF9z
ZXR0aW5ncyhzbXUsIGluaXRpYWxpemUsIHNpemVvZihPdmVyRHJpdmVUYWJsZV90KSk7CisJaWYg
KHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmIChpbml0aWFsaXplKSB7CisJCXJldCA9IG5hdmkx
MF9zZXR1cF9vZF9saW1pdHMoc211KTsKKwkJaWYgKHJldCkgeworCQkJcHJfZXJyKCJGYWlsZWQg
dG8gcmV0cmlldmUgYm9hcmQgT0QgbGltaXRzXG4iKTsKKwkJCXJldHVybiByZXQ7CisJCX0KKwor
CX0KKworCW9kX3RhYmxlID0gKE92ZXJEcml2ZVRhYmxlX3QgKilzbXUtPnNtdV90YWJsZS5vdmVy
ZHJpdmVfdGFibGU7CisJaWYgKG9kX3RhYmxlKSB7CisJCW5hdmkxMF9kdW1wX29kX3RhYmxlKG9k
X3RhYmxlKTsKKwl9CiAKIAlyZXR1cm4gcmV0OwogfQogCitzdGF0aWMgaW50IG5hdmkxMF9vZF9l
ZGl0X2RwbV90YWJsZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgZW51bSBQUF9PRF9EUE1fVEFC
TEVfQ09NTUFORCB0eXBlLCBsb25nIGlucHV0W10sIHVpbnQzMl90IHNpemUpIHsKKwlpbnQgaTsK
KwlpbnQgcmV0ID0gMDsKKwlzdHJ1Y3Qgc211X3RhYmxlX2NvbnRleHQgKnRhYmxlX2NvbnRleHQg
PSAmc211LT5zbXVfdGFibGU7CisJT3ZlckRyaXZlVGFibGVfdCAqb2RfdGFibGU7CisJc3RydWN0
IHNtdV8xMV8wX292ZXJkcml2ZV90YWJsZSAqb2Rfc2V0dGluZ3M7CisJb2RfdGFibGUgPSAoT3Zl
ckRyaXZlVGFibGVfdCAqKXRhYmxlX2NvbnRleHQtPm92ZXJkcml2ZV90YWJsZTsKKworCWlmICgh
c211LT5vZF9lbmFibGVkKSB7CisJCXByX3dhcm4oIk92ZXJEcml2ZSBpcyBub3QgZW5hYmxlZCFc
biIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAoIXNtdS0+b2Rfc2V0dGluZ3MpIHsK
KwkJcHJfZXJyKCJPRCBib2FyZCBsaW1pdHMgYXJlIG5vdCBzZXQhXG4iKTsKKwkJcmV0dXJuIC1F
Tk9FTlQ7CisJfQorCisJb2Rfc2V0dGluZ3MgPSBzbXUtPm9kX3NldHRpbmdzOworCisJc3dpdGNo
ICh0eXBlKSB7CisJY2FzZSBQUF9PRF9FRElUX1NDTEtfVkREQ19UQUJMRToKKwkJaWYgKCFuYXZp
MTBfb2RfZmVhdHVyZV9pc19zdXBwb3J0ZWQob2Rfc2V0dGluZ3MsIFNNVV8xMV8wX09ERkVBVFVS
RV9HRlhDTEtfTElNSVRTKSkgeworCQkJcHJfd2FybigiR0ZYQ0xLX0xJTUlUUyBub3Qgc3VwcG9y
dGVkIVxuIik7CisJCQlyZXR1cm4gLUVOT1RTVVBQOworCQl9CisJCWlmICghdGFibGVfY29udGV4
dC0+b3ZlcmRyaXZlX3RhYmxlKSB7CisJCQlwcl9lcnIoIk92ZXJkcml2ZSBpcyBub3QgaW5pdGlh
bGl6ZWRcbiIpOworCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKwkJZm9yIChpID0gMDsgaSA8IHNp
emU7IGkgKz0gMikgeworCQkJaWYgKGkgKyAyID4gc2l6ZSkgeworCQkJCXByX2luZm8oImludmFs
aWQgbnVtYmVyIG9mIGlucHV0IHBhcmFtZXRlcnMgJWRcbiIsIHNpemUpOworCQkJCXJldHVybiAt
RUlOVkFMOworCQkJfQorCQkJc3dpdGNoIChpbnB1dFtpXSkgeworCQkJY2FzZSAwOgorCQkJCWZy
ZXFfc2V0dGluZyA9IFNNVV8xMV8wX09EU0VUVElOR19HRlhDTEtGTUlOOworCQkJCWZyZXFfcHRy
ID0gJm9kX3RhYmxlLT5HZnhjbGtGbWluOworCQkJCWlmIChpbnB1dFtpICsgMV0gPiBvZF90YWJs
ZS0+R2Z4Y2xrRm1heCkgeworCQkJCQlwcl9pbmZvKCJHZnhjbGtGbWluICglbGQpIG11c3QgYmUg
PD0gR2Z4Y2xrRm1heCAoJXUpIVxuIiwKKwkJCQkJCWlucHV0W2kgKyAxXSwKKwkJCQkJCW9kX3Rh
YmxlLT5HZnhjbGtGbWluKTsKKwkJCQkJcmV0dXJuIC1FSU5WQUw7CisJCQkJfQorCQkJCWJyZWFr
OworCQkJY2FzZSAxOgorCQkJCWZyZXFfc2V0dGluZyA9IFNNVV8xMV8wX09EU0VUVElOR19HRlhD
TEtGTUFYOworCQkJCWZyZXFfcHRyID0gJm9kX3RhYmxlLT5HZnhjbGtGbWF4OworCQkJCWlmIChp
bnB1dFtpICsgMV0gPCBvZF90YWJsZS0+R2Z4Y2xrRm1pbikgeworCQkJCQlwcl9pbmZvKCJHZnhj
bGtGbWF4ICglbGQpIG11c3QgYmUgPj0gR2Z4Y2xrRm1pbiAoJXUpIVxuIiwKKwkJCQkJCWlucHV0
W2kgKyAxXSwKKwkJCQkJCW9kX3RhYmxlLT5HZnhjbGtGbWF4KTsKKwkJCQkJcmV0dXJuIC1FSU5W
QUw7CisJCQkJfQorCQkJCWJyZWFrOworCQkJZGVmYXVsdDoKKwkJCQlwcl9pbmZvKCJJbnZhbGlk
IFNDTEtfVkREQ19UQUJMRSBpbmRleDogJWxkXG4iLCBpbnB1dFtpXSk7CisJCQkJcHJfaW5mbygi
U3VwcG9ydGVkIGluZGljZXM6IFswOm1pbiwxOm1heF1cbiIpOworCQkJCXJldHVybiAtRUlOVkFM
OworCQkJfQorCQkJcmV0ID0gbmF2aTEwX29kX3NldHRpbmdfY2hlY2tfcmFuZ2Uob2Rfc2V0dGlu
Z3MsIGZyZXFfc2V0dGluZywgaW5wdXRbaSArIDFdKTsKKwkJCWlmIChyZXQpCisJCQkJcmV0dXJu
IHJldDsKKwkJCSpmcmVxX3B0ciA9IGlucHV0W2kgKyAxXTsKKwkJfQorCQlicmVhazsKKwljYXNl
IFBQX09EX0VESVRfTUNMS19WRERDX1RBQkxFOgorCQlpZiAoIW5hdmkxMF9vZF9mZWF0dXJlX2lz
X3N1cHBvcnRlZChvZF9zZXR0aW5ncywgU01VXzExXzBfT0RGRUFUVVJFX1VDTEtfTUFYKSkgewor
CQkJcHJfd2FybigiVUNMS19NQVggbm90IHN1cHBvcnRlZCFcbiIpOworCQkJcmV0dXJuIC1FTk9U
U1VQUDsKKwkJfQorCQlpZiAoc2l6ZSA8IDIpIHsKKwkJCXByX2luZm8oImludmFsaWQgbnVtYmVy
IG9mIHBhcmFtZXRlcnM6ICVkXG4iLCBzaXplKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJ
CWlmIChpbnB1dFswXSAhPSAxKSB7CisJCQlwcl9pbmZvKCJJbnZhbGlkIE1DTEtfVkREQ19UQUJM
RSBpbmRleDogJWxkXG4iLCBpbnB1dFswXSk7CisJCQlwcl9pbmZvKCJTdXBwb3J0ZWQgaW5kaWNl
czogWzE6bWF4XVxuIik7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCQlyZXQgPSBuYXZpMTBf
b2Rfc2V0dGluZ19jaGVja19yYW5nZShvZF9zZXR0aW5ncywgU01VXzExXzBfT0RTRVRUSU5HX1VD
TEtGTUFYLCBpbnB1dFsxXSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCQlvZF90YWJs
ZS0+VWNsa0ZtYXggPSBpbnB1dFsxXTsKKwkJYnJlYWs7CisJY2FzZSBQUF9PRF9DT01NSVRfRFBN
X1RBQkxFOgorCQluYXZpMTBfZHVtcF9vZF90YWJsZShvZF90YWJsZSk7CisJCXJldCA9IHNtdV91
cGRhdGVfdGFibGUoc211LCBTTVVfVEFCTEVfT1ZFUkRSSVZFLCAwLCAodm9pZCAqKW9kX3RhYmxl
LCB0cnVlKTsKKwkJaWYgKHJldCkgeworCQkJcHJfZXJyKCJGYWlsZWQgdG8gaW1wb3J0IG92ZXJk
cml2ZSB0YWJsZSFcbiIpOworCQkJcmV0dXJuIHJldDsKKwkJfQorCQkvLyBubyBsb2NrIG5lZWRl
ZCBiZWNhdXNlIHNtdV9vZF9lZGl0X2RwbV90YWJsZSBoYXMgaXQKKwkJcmV0ID0gc211X2hhbmRs
ZV90YXNrKHNtdSwgc211LT5zbXVfZHBtLmRwbV9sZXZlbCwKKwkJCUFNRF9QUF9UQVNLX1JFQURK
VVNUX1BPV0VSX1NUQVRFLAorCQkJZmFsc2UpOworCQlpZiAocmV0KSB7CisJCQlyZXR1cm4gcmV0
OworCQl9CisJCWJyZWFrOworCWNhc2UgUFBfT0RfRURJVF9WRERDX0NVUlZFOgorCQkvLyBUT0RP
OiBpbXBsZW1lbnQKKwkJcmV0dXJuIC1FTk9TWVM7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FTk9T
WVM7CisJfQorCXJldHVybiByZXQ7Cit9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgcHB0YWJsZV9m
dW5jcyBuYXZpMTBfcHB0X2Z1bmNzID0gewogCS50YWJsZXNfaW5pdCA9IG5hdmkxMF90YWJsZXNf
aW5pdCwKQEAgLTE3NDIsNiArMTkyMCw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgcHB0YWJsZV9m
dW5jcyBuYXZpMTBfcHB0X2Z1bmNzID0gewogCS5nZXRfZHBtX3VsdGltYXRlX2ZyZXEgPSBzbXVf
djExXzBfZ2V0X2RwbV91bHRpbWF0ZV9mcmVxLAogCS5zZXRfc29mdF9mcmVxX2xpbWl0ZWRfcmFu
Z2UgPSBzbXVfdjExXzBfc2V0X3NvZnRfZnJlcV9saW1pdGVkX3JhbmdlLAogCS5vdmVycmlkZV9w
Y2llX3BhcmFtZXRlcnMgPSBzbXVfdjExXzBfb3ZlcnJpZGVfcGNpZV9wYXJhbWV0ZXJzLAorCS5z
ZXRfZGVmYXVsdF9vZF9zZXR0aW5ncyA9IG5hdmkxMF9zZXRfZGVmYXVsdF9vZF9zZXR0aW5ncywK
Kwkub2RfZWRpdF9kcG1fdGFibGUgPSBuYXZpMTBfb2RfZWRpdF9kcG1fdGFibGUsCiB9OwogCiB2
b2lkIG5hdmkxMF9zZXRfcHB0X2Z1bmNzKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211X3YxMV8wLmMgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjExXzAuYwppbmRleCBlODU5YmIxMTMyYWMuLmM0
ZjY3ZWU4ODQwZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211
X3YxMV8wLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211X3YxMV8wLmMK
QEAgLTE3NzksMyArMTc3OSwzMCBAQCBpbnQgc211X3YxMV8wX292ZXJyaWRlX3BjaWVfcGFyYW1l
dGVycyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKIAlyZXR1cm4gcmV0OwogCiB9CisKK2ludCBz
bXVfdjExXzBfc2V0X2RlZmF1bHRfb2Rfc2V0dGluZ3Moc3RydWN0IHNtdV9jb250ZXh0ICpzbXUs
IGJvb2wgaW5pdGlhbGl6ZSwgc2l6ZV90IG92ZXJkcml2ZV90YWJsZV9zaXplKQoreworCXN0cnVj
dCBzbXVfdGFibGVfY29udGV4dCAqdGFibGVfY29udGV4dCA9ICZzbXUtPnNtdV90YWJsZTsKKwlp
bnQgcmV0ID0gMDsKKworCWlmIChpbml0aWFsaXplKSB7CisJCWlmICh0YWJsZV9jb250ZXh0LT5v
dmVyZHJpdmVfdGFibGUpIHsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJCXRhYmxlX2NvbnRl
eHQtPm92ZXJkcml2ZV90YWJsZSA9IGt6YWxsb2Mob3ZlcmRyaXZlX3RhYmxlX3NpemUsIEdGUF9L
RVJORUwpOworCQlpZiAoIXRhYmxlX2NvbnRleHQtPm92ZXJkcml2ZV90YWJsZSkgeworCQkJcmV0
dXJuIC1FTk9NRU07CisJCX0KKwkJcmV0ID0gc211X3VwZGF0ZV90YWJsZShzbXUsIFNNVV9UQUJM
RV9PVkVSRFJJVkUsIDAsIHRhYmxlX2NvbnRleHQtPm92ZXJkcml2ZV90YWJsZSwgZmFsc2UpOwor
CQlpZiAocmV0KSB7CisJCQlwcl9lcnIoIkZhaWxlZCB0byBleHBvcnQgb3ZlcmRyaXZlIHRhYmxl
IVxuIik7CisJCQlyZXR1cm4gcmV0OworCQl9CisJfQorCXJldCA9IHNtdV91cGRhdGVfdGFibGUo
c211LCBTTVVfVEFCTEVfT1ZFUkRSSVZFLCAwLCB0YWJsZV9jb250ZXh0LT5vdmVyZHJpdmVfdGFi
bGUsIHRydWUpOworCWlmIChyZXQpIHsKKwkJcHJfZXJyKCJGYWlsZWQgdG8gaW1wb3J0IG92ZXJk
cml2ZSB0YWJsZSFcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKwlyZXR1cm4gcmV0OworfQotLSAK
Mi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwph
bWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
