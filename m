Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 46EA948EDC
	for <lists+amd-gfx@lfdr.de>; Mon, 17 Jun 2019 21:28:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7DC4A89A4E;
	Mon, 17 Jun 2019 19:28:15 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x844.google.com (mail-qt1-x844.google.com
 [IPv6:2607:f8b0:4864:20::844])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A5FA689A1E
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 19:28:12 +0000 (UTC)
Received: by mail-qt1-x844.google.com with SMTP id a15so12209685qtn.7
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 12:28:12 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=tl4QHwxzQ666yKzQN49AFMY7oFoyO37q76ssBdLtje4=;
 b=MWr5R36juHLBSSbkayqe6RqTcYXyCV/qyHW9GWJlU/tj5Xl3d1X8YlRoK3hE5sdjLq
 WSddF+l8vynlJSWs6a3z0JGY1VP7ihzbYdSzh5Yn6aALbL/6+pZcRZUBJInIYjEmd/0t
 JIJF2UfM063EJHgM2HJlkda9l3RyyasTY5qQSJKbwQB2xPg3xTY7Eb/X+UPRSyEeCM/i
 NgUPjklKOFnajZ+LsQnT72OCsn/IFfrjUp3QZPxjOPIh+LIVJAd/rG/wjcfe8L/86xPK
 AYcAIj2iPZtSBOxKAS96m8U8ECpiSwop40MvImmvZw1aHfUH3iXv9vDXIJTgp0btOAWO
 edLg==
X-Gm-Message-State: APjAAAVDainpfSbne+RmLCREMpjbzpfnY6c9P/8yfT+h1m/Bpnku9UFh
 kpX48ZDRjiB3NsMJnLRnDwhr+pVXxKk=
X-Google-Smtp-Source: APXvYqzO6LhX/YzNX+MA8MqAt3A347qxHqawgr7zzHisB2A0ZNyw8nzfrkdfep0YlB3GXvg7wgXd2Q==
X-Received: by 2002:ac8:96e:: with SMTP id z43mr95857183qth.55.1560799691360; 
 Mon, 17 Jun 2019 12:28:11 -0700 (PDT)
Received: from localhost.localdomain ([71.219.5.136])
 by smtp.gmail.com with ESMTPSA id p37sm7715622qtc.35.2019.06.17.12.28.10
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 17 Jun 2019 12:28:10 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 163/459] drm/amd/powerplay: implement smc firmware v2.1 for
 smu11
Date: Mon, 17 Jun 2019 14:26:28 -0500
Message-Id: <20190617192704.18038-64-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617192704.18038-1-alexander.deucher@amd.com>
References: <20190617192704.18038-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=tl4QHwxzQ666yKzQN49AFMY7oFoyO37q76ssBdLtje4=;
 b=ogttNadO41oOueRozylOIG/FvDEa30Q5IKWTahOqSlPJ4Ltp20B7o+TFm9YwlDcRmk
 5Vz71hhCzfUL64vrX3rJTuy2U+ICAl0uBVOuxsoHa+oM3/3lsMunowrhqn1ecdvd/Yxy
 6nllroASefFYK2PkMBLCpZndTkufBrvz8ARlRK0Ptdes7MT3yKui+yGOEOmIpDiRocGy
 M9Ykws4uHvIf1BqJ8+JzRWs2IK0PigjNusy5bQZdaZhZgRNg8xMZv7qKGJdwCXhslRY7
 gQosMULfrYH4CLCisvZJuuSK0mkNbh9SnRx68YLph0BLAx+VGS+Bj/yEhzB/f0lU6sjo
 34Dw==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Kevin Wang <kevin1.wang@amd.com>,
 Huang Rui <ray.huang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogS2V2aW4gV2FuZyA8a2V2aW4xLndhbmdAYW1kLmNvbT4KCjEuYWRkIHNtY19maXJtd2Fy
ZV9oZWFkZXJfdjJfMSBoZmlybXdhcmUgc3VwcG9ydCwgc3VwcG9ydCBtb3JlIHBwdGFibGUgaW4g
c21jIGZpcm13YXJlLgoyLm9wdGltaXphdGlvbiBjdXJyZW50IHBwdGFibGUgbG9hZCBmcmFtZXdv
cmsuCjMucmVuYW1lIHJlYWRfcHB0YWJsZV9mcm9tX3ZiaW9zIHdpdGggc2V0dXBfcHB0YWJsZS4K
ClNpZ25lZC1vZmYtYnk6IEtldmluIFdhbmcgPGtldmluMS53YW5nQGFtZC5jb20+ClJldmlld2Vk
LWJ5OiBIdWFuZyBSdWkgPHJheS5odWFuZ0BhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBBbGV4IERl
dWNoZXIgPGFsZXhhbmRlci5kZXVjaGVyQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3Vjb2RlLmggICAgIHwgMTMgKysrCiBkcml2ZXJzL2dwdS9kcm0vYW1k
L3Bvd2VycGxheS9hbWRncHVfc211LmMgICAgfCAgMiArLQogLi4uL2dwdS9kcm0vYW1kL3Bvd2Vy
cGxheS9pbmMvYW1kZ3B1X3NtdS5oICAgIHwgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvcG93
ZXJwbGF5L3NtdV92MTFfMC5jICAgICB8IDk0ICsrKysrKysrKysrKysrLS0tLS0KIDQgZmlsZXMg
Y2hhbmdlZCwgODUgaW5zZXJ0aW9ucygrKSwgMzAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Vjb2RlLmggYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfdWNvZGUuaAppbmRleCA5YjA5NjIyOGEwMmYuLmVhYWZlYTg3
YWEzYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Vjb2Rl
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Vjb2RlLmgKQEAgLTU2
LDYgKzU2LDE5IEBAIHN0cnVjdCBzbWNfZmlybXdhcmVfaGVhZGVyX3YyXzAgewogCXVpbnQzMl90
IHBwdF9zaXplX2J5dGVzOyAvKiBzb2Z0IHBwdGFibGUgc2l6ZSAqLwogfTsKIAorc3RydWN0IHNt
Y19zb2Z0X3BwdGFibGVfZW50cnkgeworICAgICAgICB1aW50MzJfdCBpZDsKKyAgICAgICAgdWlu
dDMyX3QgcHB0X29mZnNldF9ieXRlczsKKyAgICAgICAgdWludDMyX3QgcHB0X3NpemVfYnl0ZXM7
Cit9OworCisvKiB2ZXJzaW9uX21ham9yPTIsIHZlcnNpb25fbWlub3I9MSAqLworc3RydWN0IHNt
Y19maXJtd2FyZV9oZWFkZXJfdjJfMSB7CisgICAgICAgIHN0cnVjdCBzbWNfZmlybXdhcmVfaGVh
ZGVyX3YxXzAgdjFfMDsKKyAgICAgICAgdWludDMyX3QgcHB0YWJsZV9jb3VudDsKKyAgICAgICAg
dWludDMyX3QgcHB0YWJsZV9lbnRyeV9vZmZzZXQ7Cit9OworCiAvKiB2ZXJzaW9uX21ham9yPTEs
IHZlcnNpb25fbWlub3I9MCAqLwogc3RydWN0IHBzcF9maXJtd2FyZV9oZWFkZXJfdjFfMCB7CiAJ
c3RydWN0IGNvbW1vbl9maXJtd2FyZV9oZWFkZXIgaGVhZGVyOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jCmluZGV4IGI5YjU2ZWMxYWFjZi4uMmRlNjdlMTZlNWUz
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9hbWRncHVfc211LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jCkBAIC02MzMs
NyArNjMzLDcgQEAgc3RhdGljIGludCBzbXVfc21jX3RhYmxlX2h3X2luaXQoc3RydWN0IHNtdV9j
b250ZXh0ICpzbXUsCiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCi0JCXJldCA9IHNtdV9y
ZWFkX3BwdGFibGVfZnJvbV92YmlvcyhzbXUpOworCQlyZXQgPSBzbXVfc2V0dXBfcHB0YWJsZShz
bXUpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9wb3dlcnBsYXkvaW5jL2FtZGdwdV9zbXUuaCBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvcG93ZXJwbGF5L2luYy9hbWRncHVfc211LmgKaW5kZXggN2IzMTA1NGIzZTVlLi40ZWM2NDM0
MTdiNjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2luYy9hbWRn
cHVfc211LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvaW5jL2FtZGdwdV9z
bXUuaApAQCAtNDg2LDcgKzQ4Niw3IEBAIHN0cnVjdCBzbXVfZnVuY3MKIAlpbnQgKCpmaW5pX3Bv
d2VyKShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSk7CiAJaW50ICgqbG9hZF9taWNyb2NvZGUpKHN0
cnVjdCBzbXVfY29udGV4dCAqc211KTsKIAlpbnQgKCpjaGVja19md19zdGF0dXMpKHN0cnVjdCBz
bXVfY29udGV4dCAqc211KTsKLQlpbnQgKCpyZWFkX3BwdGFibGVfZnJvbV92Ymlvcykoc3RydWN0
IHNtdV9jb250ZXh0ICpzbXUpOworCWludCAoKnNldHVwX3BwdGFibGUpKHN0cnVjdCBzbXVfY29u
dGV4dCAqc211KTsKIAlpbnQgKCpnZXRfdmJpb3NfYm9vdHVwX3ZhbHVlcykoc3RydWN0IHNtdV9j
b250ZXh0ICpzbXUpOwogCWludCAoKmdldF9jbGtfaW5mb19mcm9tX3ZiaW9zKShzdHJ1Y3Qgc211
X2NvbnRleHQgKnNtdSk7CiAJaW50ICgqY2hlY2tfcHB0YWJsZSkoc3RydWN0IHNtdV9jb250ZXh0
ICpzbXUpOwpAQCAtNTcwLDggKzU3MCw4IEBAIHN0cnVjdCBzbXVfZnVuY3MKIAkoKHNtdSktPmZ1
bmNzLT5sb2FkX21pY3JvY29kZSA/IChzbXUpLT5mdW5jcy0+bG9hZF9taWNyb2NvZGUoKHNtdSkp
IDogMCkKICNkZWZpbmUgc211X2NoZWNrX2Z3X3N0YXR1cyhzbXUpIFwKIAkoKHNtdSktPmZ1bmNz
LT5jaGVja19md19zdGF0dXMgPyAoc211KS0+ZnVuY3MtPmNoZWNrX2Z3X3N0YXR1cygoc211KSkg
OiAwKQotI2RlZmluZSBzbXVfcmVhZF9wcHRhYmxlX2Zyb21fdmJpb3Moc211KSBcCi0JKChzbXUp
LT5mdW5jcy0+cmVhZF9wcHRhYmxlX2Zyb21fdmJpb3MgPyAoc211KS0+ZnVuY3MtPnJlYWRfcHB0
YWJsZV9mcm9tX3ZiaW9zKChzbXUpKSA6IDApCisjZGVmaW5lIHNtdV9zZXR1cF9wcHRhYmxlKHNt
dSkgXAorCSgoc211KS0+ZnVuY3MtPnNldHVwX3BwdGFibGUgPyAoc211KS0+ZnVuY3MtPnNldHVw
X3BwdGFibGUoKHNtdSkpIDogMCkKICNkZWZpbmUgc211X2dldF92Ymlvc19ib290dXBfdmFsdWVz
KHNtdSkgXAogCSgoc211KS0+ZnVuY3MtPmdldF92Ymlvc19ib290dXBfdmFsdWVzID8gKHNtdSkt
PmZ1bmNzLT5nZXRfdmJpb3NfYm9vdHVwX3ZhbHVlcygoc211KSkgOiAwKQogI2RlZmluZSBzbXVf
Z2V0X2Nsa19pbmZvX2Zyb21fdmJpb3Moc211KSBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL3Bvd2VycGxheS9zbXVfdjExXzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJw
bGF5L3NtdV92MTFfMC5jCmluZGV4IDhmMjI3MmE0MjBiNi4uYTk1MmQyYTI5N2Y3IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjExXzAuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjExXzAuYwpAQCAtMTQzLDE4ICsxNDMsNiBA
QCBzbXVfdjExXzBfc2VuZF9tc2dfd2l0aF9wYXJhbShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwg
dWludDE2X3QgbXNnLAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyB2b2lkIHNtdV92MTFfMF9p
bml0X3NtdV9leHRfbWljcm9jb2RlKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQotewotCXN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2ID0gc211LT5hZGV2OwotCWNvbnN0IHN0cnVjdCBzbWNfZmly
bXdhcmVfaGVhZGVyX3YyXzAgKnYyOwotCi0JdjIgPSAoY29uc3Qgc3RydWN0IHNtY19maXJtd2Fy
ZV9oZWFkZXJfdjJfMCAqKSBhZGV2LT5wbS5mdy0+ZGF0YTsKLQotCXNtdS0+cHB0X29mZnNldF9i
eXRlcyA9IGxlMzJfdG9fY3B1KHYyLT5wcHRfb2Zmc2V0X2J5dGVzKTsKLQlzbXUtPnBwdF9zaXpl
X2J5dGVzID0gbGUzMl90b19jcHUodjItPnBwdF9zaXplX2J5dGVzKTsKLQlzbXUtPnBwdF9zdGFy
dF9hZGRyID0gKHVpbnQ4X3QgKil2MiArIHNtdS0+cHB0X29mZnNldF9ieXRlczsKLX0KLQogc3Rh
dGljIGludCBzbXVfdjExXzBfaW5pdF9taWNyb2NvZGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUp
CiB7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBzbXUtPmFkZXY7CkBAIC0xNjQsNyAr
MTUyLDYgQEAgc3RhdGljIGludCBzbXVfdjExXzBfaW5pdF9taWNyb2NvZGUoc3RydWN0IHNtdV9j
b250ZXh0ICpzbXUpCiAJY29uc3Qgc3RydWN0IHNtY19maXJtd2FyZV9oZWFkZXJfdjFfMCAqaGRy
OwogCWNvbnN0IHN0cnVjdCBjb21tb25fZmlybXdhcmVfaGVhZGVyICpoZWFkZXI7CiAJc3RydWN0
IGFtZGdwdV9maXJtd2FyZV9pbmZvICp1Y29kZSA9IE5VTEw7Ci0JdWludDMyX3QgdmVyc2lvbl9t
YWpvciwgdmVyc2lvbl9taW5vcjsKIAogCXN3aXRjaCAoYWRldi0+YXNpY190eXBlKSB7CiAJY2Fz
ZSBDSElQX1ZFR0EyMDoKQEAgLTE5MCwxMSArMTc3LDYgQEAgc3RhdGljIGludCBzbXVfdjExXzBf
aW5pdF9taWNyb2NvZGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCiAJYW1kZ3B1X3Vjb2RlX3By
aW50X3NtY19oZHIoJmhkci0+aGVhZGVyKTsKIAlhZGV2LT5wbS5md192ZXJzaW9uID0gbGUzMl90
b19jcHUoaGRyLT5oZWFkZXIudWNvZGVfdmVyc2lvbik7CiAKLQl2ZXJzaW9uX21ham9yID0gbGUx
Nl90b19jcHUoaGRyLT5oZWFkZXIuaGVhZGVyX3ZlcnNpb25fbWFqb3IpOwotCXZlcnNpb25fbWlu
b3IgPSBsZTE2X3RvX2NwdShoZHItPmhlYWRlci5oZWFkZXJfdmVyc2lvbl9taW5vcik7Ci0JaWYg
KHZlcnNpb25fbWFqb3IgPT0gMiAmJiB2ZXJzaW9uX21pbm9yID09IDApCi0JCXNtdV92MTFfMF9p
bml0X3NtdV9leHRfbWljcm9jb2RlKHNtdSk7IC8qIHdpdGggc29mdCBwcHRhYmxlICovCi0KIAlp
ZiAoYWRldi0+ZmlybXdhcmUubG9hZF90eXBlID09IEFNREdQVV9GV19MT0FEX1BTUCkgewogCQl1
Y29kZSA9ICZhZGV2LT5maXJtd2FyZS51Y29kZVtBTURHUFVfVUNPREVfSURfU01DXTsKIAkJdWNv
ZGUtPnVjb2RlX2lkID0gQU1ER1BVX1VDT0RFX0lEX1NNQzsKQEAgLTI5MywyMiArMjc1LDgyIEBA
IHN0YXRpYyBpbnQgc211X3YxMV8wX2NoZWNrX2Z3X3ZlcnNpb24oc3RydWN0IHNtdV9jb250ZXh0
ICpzbXUpCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIGludCBzbXVfdjExXzBfcmVhZF9wcHRh
YmxlX2Zyb21fdmJpb3Moc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCitzdGF0aWMgaW50IHNtdV92
MTFfMF9zZXRfcHB0YWJsZV92Ml8wKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB2b2lkICoqdGFi
bGUsIHVpbnQzMl90ICpzaXplKQoreworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gc211
LT5hZGV2OworCXVpbnQzMl90IHBwdF9vZmZzZXRfYnl0ZXM7CisJY29uc3Qgc3RydWN0IHNtY19m
aXJtd2FyZV9oZWFkZXJfdjJfMCAqdjI7CisKKwl2MiA9IChjb25zdCBzdHJ1Y3Qgc21jX2Zpcm13
YXJlX2hlYWRlcl92Ml8wICopIGFkZXYtPnBtLmZ3LT5kYXRhOworCisJcHB0X29mZnNldF9ieXRl
cyA9IGxlMzJfdG9fY3B1KHYyLT5wcHRfb2Zmc2V0X2J5dGVzKTsKKwkqc2l6ZSA9IGxlMzJfdG9f
Y3B1KHYyLT5wcHRfc2l6ZV9ieXRlcyk7CisJKnRhYmxlID0gKHVpbnQ4X3QgKil2MiArIHBwdF9v
ZmZzZXRfYnl0ZXM7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBzbXVfdjExXzBfc2V0
X3BwdGFibGVfdjJfMShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgdm9pZCAqKnRhYmxlLCB1aW50
MzJfdCAqc2l6ZSwgdWludDMyX3QgcHB0YWJsZV9pZCkKK3sKKwlzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiA9IHNtdS0+YWRldjsKKwljb25zdCBzdHJ1Y3Qgc21jX2Zpcm13YXJlX2hlYWRlcl92
Ml8xICp2Ml8xOworCXN0cnVjdCBzbWNfc29mdF9wcHRhYmxlX2VudHJ5ICplbnRyaWVzOworCXVp
bnQzMl90IHBwdGFibGVfY291bnQgPSAwOworCWludCBpID0gMDsKKworCXYyXzEgPSAoY29uc3Qg
c3RydWN0IHNtY19maXJtd2FyZV9oZWFkZXJfdjJfMSAqKSBhZGV2LT5wbS5mdy0+ZGF0YTsKKwll
bnRyaWVzID0gKHN0cnVjdCBzbWNfc29mdF9wcHRhYmxlX2VudHJ5ICopCisJCSgodWludDhfdCAq
KXYyXzEgKyBsZTMyX3RvX2NwdSh2Ml8xLT5wcHRhYmxlX2VudHJ5X29mZnNldCkpOworCXBwdGFi
bGVfY291bnQgPSBsZTMyX3RvX2NwdSh2Ml8xLT5wcHRhYmxlX2NvdW50KTsKKwlmb3IgKGkgPSAw
OyBpIDwgcHB0YWJsZV9jb3VudDsgaSsrKSB7CisJCWlmIChsZTMyX3RvX2NwdShlbnRyaWVzW2ld
LmlkKSA9PSBwcHRhYmxlX2lkKSB7CisJCQkqdGFibGUgPSAoKHVpbnQ4X3QgKil2Ml8xICsgbGUz
Ml90b19jcHUoZW50cmllc1tpXS5wcHRfb2Zmc2V0X2J5dGVzKSk7CisJCQkqc2l6ZSA9IGxlMzJf
dG9fY3B1KGVudHJpZXNbaV0ucHB0X3NpemVfYnl0ZXMpOworCQkJYnJlYWs7CisJCX0KKwl9CisK
KwlpZiAoaSA9PSBwcHRhYmxlX2NvdW50KQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXJldHVybiAw
OworfQorCitzdGF0aWMgaW50IHNtdV92MTFfMF9zZXR1cF9wcHRhYmxlKHN0cnVjdCBzbXVfY29u
dGV4dCAqc211KQogeworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gc211LT5hZGV2Owor
CWNvbnN0IHN0cnVjdCBzbWNfZmlybXdhcmVfaGVhZGVyX3YxXzAgKmhkcjsKIAlpbnQgcmV0LCBp
bmRleDsKLQl1aW50MTZfdCBzaXplOworCXVpbnQzMl90IHNpemU7CiAJdWludDhfdCBmcmV2LCBj
cmV2OwogCXZvaWQgKnRhYmxlOworCXVpbnQxNl90IHZlcnNpb25fbWFqb3IsIHZlcnNpb25fbWlu
b3I7CisKKwloZHIgPSAoY29uc3Qgc3RydWN0IHNtY19maXJtd2FyZV9oZWFkZXJfdjFfMCAqKSBh
ZGV2LT5wbS5mdy0+ZGF0YTsKKwl2ZXJzaW9uX21ham9yID0gbGUxNl90b19jcHUoaGRyLT5oZWFk
ZXIuaGVhZGVyX3ZlcnNpb25fbWFqb3IpOworCXZlcnNpb25fbWlub3IgPSBsZTE2X3RvX2NwdSho
ZHItPmhlYWRlci5oZWFkZXJfdmVyc2lvbl9taW5vcik7CisKKwlpZiAodmVyc2lvbl9tYWpvciA9
PSAyICYmIHNtdS0+c211X3RhYmxlLmJvb3RfdmFsdWVzLnBwX3RhYmxlX2lkID4gMCkgeworCQlz
d2l0Y2ggKHZlcnNpb25fbWlub3IpIHsKKwkJY2FzZSAwOgorCQkJcmV0ID0gc211X3YxMV8wX3Nl
dF9wcHRhYmxlX3YyXzAoc211LCAmdGFibGUsICZzaXplKTsKKwkJCWJyZWFrOworCQljYXNlIDE6
CisJCQlyZXQgPSBzbXVfdjExXzBfc2V0X3BwdGFibGVfdjJfMShzbXUsICZ0YWJsZSwgJnNpemUs
CisJCQkJCQkJIHNtdS0+c211X3RhYmxlLmJvb3RfdmFsdWVzLnBwX3RhYmxlX2lkKTsKKwkJCWJy
ZWFrOworCQlkZWZhdWx0OgorCQkJcmV0ID0gLUVJTlZBTDsKKwkJCWJyZWFrOworCQl9CisJCWlm
IChyZXQpCisJCQlyZXR1cm4gcmV0OwogCi0JaWYgKHNtdS0+c211X3RhYmxlLmJvb3RfdmFsdWVz
LnBwX3RhYmxlX2lkID4gMCAmJiBzbXUtPnBwdF9zdGFydF9hZGRyKSB7Ci0JCS8qIGxvYWQgc29m
dCBwcHRhYmxlICovCi0JCXRhYmxlID0gKHZvaWQgKilzbXUtPnBwdF9zdGFydF9hZGRyOwotCQlz
aXplPSBzbXUtPnBwdF9zaXplX2J5dGVzOwogCX0gZWxzZSB7CiAJCWluZGV4ID0gZ2V0X2luZGV4
X2ludG9fbWFzdGVyX3RhYmxlKGF0b21fbWFzdGVyX2xpc3Rfb2ZfZGF0YV90YWJsZXNfdjJfMSwK
IAkJCQkJCSAgICBwb3dlcnBsYXlpbmZvKTsKIAotCQlyZXQgPSBzbXVfZ2V0X2F0b21fZGF0YV90
YWJsZShzbXUsIGluZGV4LCAmc2l6ZSwgJmZyZXYsICZjcmV2LAorCQlyZXQgPSBzbXVfZ2V0X2F0
b21fZGF0YV90YWJsZShzbXUsIGluZGV4LCAodWludDE2X3QgKikmc2l6ZSwgJmZyZXYsICZjcmV2
LAogCQkJCQkgICAgICAodWludDhfdCAqKikmdGFibGUpOwogCQlpZiAocmV0KQogCQkJcmV0dXJu
IHJldDsKQEAgLTE4MzYsNyArMTg3OCw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgc211X2Z1bmNz
IHNtdV92MTFfMF9mdW5jcyA9IHsKIAkuc2VuZF9zbWNfbXNnID0gc211X3YxMV8wX3NlbmRfbXNn
LAogCS5zZW5kX3NtY19tc2dfd2l0aF9wYXJhbSA9IHNtdV92MTFfMF9zZW5kX21zZ193aXRoX3Bh
cmFtLAogCS5yZWFkX3NtY19hcmcgPSBzbXVfdjExXzBfcmVhZF9hcmcsCi0JLnJlYWRfcHB0YWJs
ZV9mcm9tX3ZiaW9zID0gc211X3YxMV8wX3JlYWRfcHB0YWJsZV9mcm9tX3ZiaW9zLAorCS5zZXR1
cF9wcHRhYmxlPSBzbXVfdjExXzBfc2V0dXBfcHB0YWJsZSwKIAkuaW5pdF9zbWNfdGFibGVzID0g
c211X3YxMV8wX2luaXRfc21jX3RhYmxlcywKIAkuZmluaV9zbWNfdGFibGVzID0gc211X3YxMV8w
X2Zpbmlfc21jX3RhYmxlcywKIAkuaW5pdF9wb3dlciA9IHNtdV92MTFfMF9pbml0X3Bvd2VyLAot
LSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
