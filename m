Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4863EA85DA
	for <lists+amd-gfx@lfdr.de>; Wed,  4 Sep 2019 17:02:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8EA8589498;
	Wed,  4 Sep 2019 15:02:38 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 547488926B
 for <amd-gfx@lists.freedesktop.org>; Wed,  4 Sep 2019 15:02:36 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id k2so3682880wmj.4
 for <amd-gfx@lists.freedesktop.org>; Wed, 04 Sep 2019 08:02:36 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Veawvf7kR3cDsenCRiw8NcsJvS7Tiz7nDenNedo1dGA=;
 b=YeP0pOkXbBEibLiuXuueONt/2GRBCSj9si5AXbGQmCi3qa7bX1wCe23JXnofhuOnkq
 dz0/JX0+5B3avKriFmSkTETccUNa9YwbbCUZEi0ei7BH7XBnpqc4PJRV8fiTq4O4NTBC
 FtHc6tnhcSE5Zq2wmKAYfYVTyIKjbD7+UTK8y6PMu5AwODa60lSbiWLSlZCCwhp+TBS0
 1QzqmLaEY3cAixAqFMkPy0Y/xPm1dV7rcMhzglFMTznM9tuiWBFi3k6RNEVqHDBiVHM3
 h3yexXkezQsHQxMOE3dFrUvcuGjIZRyvRZYj2mgMN+aPh14X1/Pq+x8EnxP/rx1LMxGW
 V3qA==
X-Gm-Message-State: APjAAAX1Oaawk+1dKQd4hEyff8hyIa2Yc7zkpmsM8v7zjkvXHZ3M2gY+
 O8uE/NxEZGiSGhz5GWk0bywUIQ5K
X-Google-Smtp-Source: APXvYqz2Bp+uw+ZPL9fpCf3jBQ0h9l/rsfBcTaJW85SdFfsJ+CbmoUO4HTyyJhHxOWKs4JOK4fY/aA==
X-Received: by 2002:a1c:be11:: with SMTP id o17mr1837740wmf.1.1567609354694;
 Wed, 04 Sep 2019 08:02:34 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:6124:f264:ed7d:d416])
 by smtp.gmail.com with ESMTPSA id o9sm25928802wrj.17.2019.09.04.08.02.33
 for <amd-gfx@lists.freedesktop.org>
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 04 Sep 2019 08:02:34 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 2/9] drm/amdgpu: split the VM entity into direct and delayed
Date: Wed,  4 Sep 2019 17:02:23 +0200
Message-Id: <20190904150230.13885-3-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190904150230.13885-1-christian.koenig@amd.com>
References: <20190904150230.13885-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=Veawvf7kR3cDsenCRiw8NcsJvS7Tiz7nDenNedo1dGA=;
 b=d4ID4iWDm5TpcKaB8G8JeICbRUKZtoCooriuPS3eY5qvCh8LEAVVoCtLjGXp5oAO01
 dNU7HYTjUcU6x+3jTcvKE1TLMuc0ZuJof5dzzPblDdSEDnL37SAYc8KW/64ZWr3NfMzO
 HXPUUBu2AFE/Ve+41pGCCcy/nH44SNAne4oFalHJFg4EFuXU0FJvJS8uGo+9aE2MuVYX
 Wdmey7iW5eu9NyaM3PKYvheUNO41RjdT6J5aPeoUoupGy2bKp92M2umfU5RaKjRDMU8D
 p374HmqvbTefgUmmUENPgnZsNob2JNxZ03Vp2PGb1Ft7XSs98F4PCtHnlyhiVklGqTFe
 j9jg==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

Rm9yIHBhZ2UgZmF1bHQgaGFuZGxpbmcgd2UgbmVlZCB0byB1c2UgYSBkaXJlY3QgdXBkYXRlIHdo
aWNoIGNhbid0IGJlCmJsb2NrZWQgYnkgb25nb2luZyB1c2VyIENTLgoKU2lnbmVkLW9mZi1ieTog
Q2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pZHMuYyAgICAgfCAgNiArKystLS0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jICAgICAgfCAyMSArKysrKysrKysrKysrKyst
LS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5oICAgICAgfCAgNSAr
KystLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYyB8ICA1ICsr
Ky0tCiA0IGZpbGVzIGNoYW5nZWQsIDI0IGluc2VydGlvbnMoKyksIDEzIGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pZHMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pZHMuYwppbmRleCBjZDE1NTQwYzU2MjIu
LmRmZTE1NTU2NjU3MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2lkcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pZHMuYwpA
QCAtMjgyLDcgKzI4Miw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtaWRfZ3JhYl9yZXNlcnZlZChz
dHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKIAkgICAgIWRtYV9mZW5jZV9pc19sYXRlcih1cGRhdGVzLCAo
KmlkKS0+Zmx1c2hlZF91cGRhdGVzKSkKIAkgICAgdXBkYXRlcyA9IE5VTEw7CiAKLQlpZiAoKCpp
ZCktPm93bmVyICE9IHZtLT5lbnRpdHkuZmVuY2VfY29udGV4dCB8fAorCWlmICgoKmlkKS0+b3du
ZXIgIT0gdm0tPmRpcmVjdC5mZW5jZV9jb250ZXh0IHx8CiAJICAgIGpvYi0+dm1fcGRfYWRkciAh
PSAoKmlkKS0+cGRfZ3B1X2FkZHIgfHwKIAkgICAgdXBkYXRlcyB8fCAhKCppZCktPmxhc3RfZmx1
c2ggfHwKIAkgICAgKCgqaWQpLT5sYXN0X2ZsdXNoLT5jb250ZXh0ICE9IGZlbmNlX2NvbnRleHQg
JiYKQEAgLTM0OSw3ICszNDksNyBAQCBzdGF0aWMgaW50IGFtZGdwdV92bWlkX2dyYWJfdXNlZChz
dHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKIAkJc3RydWN0IGRtYV9mZW5jZSAqZmx1c2hlZDsKIAogCQkv
KiBDaGVjayBhbGwgdGhlIHByZXJlcXVpc2l0ZXMgdG8gdXNpbmcgdGhpcyBWTUlEICovCi0JCWlm
ICgoKmlkKS0+b3duZXIgIT0gdm0tPmVudGl0eS5mZW5jZV9jb250ZXh0KQorCQlpZiAoKCppZCkt
Pm93bmVyICE9IHZtLT5kaXJlY3QuZmVuY2VfY29udGV4dCkKIAkJCWNvbnRpbnVlOwogCiAJCWlm
ICgoKmlkKS0+cGRfZ3B1X2FkZHIgIT0gam9iLT52bV9wZF9hZGRyKQpAQCAtNDQ5LDcgKzQ0OSw3
IEBAIGludCBhbWRncHVfdm1pZF9ncmFiKHN0cnVjdCBhbWRncHVfdm0gKnZtLCBzdHJ1Y3QgYW1k
Z3B1X3JpbmcgKnJpbmcsCiAJfQogCiAJaWQtPnBkX2dwdV9hZGRyID0gam9iLT52bV9wZF9hZGRy
OwotCWlkLT5vd25lciA9IHZtLT5lbnRpdHkuZmVuY2VfY29udGV4dDsKKwlpZC0+b3duZXIgPSB2
bS0+ZGlyZWN0LmZlbmNlX2NvbnRleHQ7CiAKIAlpZiAoam9iLT52bV9uZWVkc19mbHVzaCkgewog
CQlkbWFfZmVuY2VfcHV0KGlkLT5sYXN0X2ZsdXNoKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X3ZtLmMKaW5kZXggNTAxZTEzNDIwNzg2Li5mYzEwM2E5ZjIwYzUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCkBAIC0yNjg3LDEyICsyNjg3LDE3IEBAIGludCBh
bWRncHVfdm1faW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV92
bSAqdm0sCiAJc3Bpbl9sb2NrX2luaXQoJnZtLT5pbnZhbGlkYXRlZF9sb2NrKTsKIAlJTklUX0xJ
U1RfSEVBRCgmdm0tPmZyZWVkKTsKIAotCS8qIGNyZWF0ZSBzY2hlZHVsZXIgZW50aXR5IGZvciBw
YWdlIHRhYmxlIHVwZGF0ZXMgKi8KLQlyID0gZHJtX3NjaGVkX2VudGl0eV9pbml0KCZ2bS0+ZW50
aXR5LCBhZGV2LT52bV9tYW5hZ2VyLnZtX3B0ZV9ycXMsCisJLyogY3JlYXRlIHNjaGVkdWxlciBl
bnRpdGllcyBmb3IgcGFnZSB0YWJsZSB1cGRhdGVzICovCisJciA9IGRybV9zY2hlZF9lbnRpdHlf
aW5pdCgmdm0tPmRpcmVjdCwgYWRldi0+dm1fbWFuYWdlci52bV9wdGVfcnFzLAogCQkJCSAgYWRl
di0+dm1fbWFuYWdlci52bV9wdGVfbnVtX3JxcywgTlVMTCk7CiAJaWYgKHIpCiAJCXJldHVybiBy
OwogCisJciA9IGRybV9zY2hlZF9lbnRpdHlfaW5pdCgmdm0tPmRlbGF5ZWQsIGFkZXYtPnZtX21h
bmFnZXIudm1fcHRlX3JxcywKKwkJCQkgIGFkZXYtPnZtX21hbmFnZXIudm1fcHRlX251bV9ycXMs
IE5VTEwpOworCWlmIChyKQorCQlnb3RvIGVycm9yX2ZyZWVfZGlyZWN0OworCiAJdm0tPnB0ZV9z
dXBwb3J0X2F0cyA9IGZhbHNlOwogCiAJaWYgKHZtX2NvbnRleHQgPT0gQU1ER1BVX1ZNX0NPTlRF
WFRfQ09NUFVURSkgewpAQCAtMjcyMSw3ICsyNzI2LDcgQEAgaW50IGFtZGdwdV92bV9pbml0KHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKIAkJYnAuZmxh
Z3MgJj0gfkFNREdQVV9HRU1fQ1JFQVRFX1NIQURPVzsKIAlyID0gYW1kZ3B1X2JvX2NyZWF0ZShh
ZGV2LCAmYnAsICZyb290KTsKIAlpZiAocikKLQkJZ290byBlcnJvcl9mcmVlX3NjaGVkX2VudGl0
eTsKKwkJZ290byBlcnJvcl9mcmVlX2RlbGF5ZWQ7CiAKIAlyID0gYW1kZ3B1X2JvX3Jlc2VydmUo
cm9vdCwgdHJ1ZSk7CiAJaWYgKHIpCkBAIC0yNzY0LDggKzI3NjksMTEgQEAgaW50IGFtZGdwdV92
bV9pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwK
IAlhbWRncHVfYm9fdW5yZWYoJnZtLT5yb290LmJhc2UuYm8pOwogCXZtLT5yb290LmJhc2UuYm8g
PSBOVUxMOwogCi1lcnJvcl9mcmVlX3NjaGVkX2VudGl0eToKLQlkcm1fc2NoZWRfZW50aXR5X2Rl
c3Ryb3koJnZtLT5lbnRpdHkpOworZXJyb3JfZnJlZV9kZWxheWVkOgorCWRybV9zY2hlZF9lbnRp
dHlfZGVzdHJveSgmdm0tPmRlbGF5ZWQpOworCitlcnJvcl9mcmVlX2RpcmVjdDoKKwlkcm1fc2No
ZWRfZW50aXR5X2Rlc3Ryb3koJnZtLT5kaXJlY3QpOwogCiAJcmV0dXJuIHI7CiB9CkBAIC0yOTU0
LDcgKzI5NjIsOCBAQCB2b2lkIGFtZGdwdV92bV9maW5pKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LCBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSkKIAkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYWRl
di0+dm1fbWFuYWdlci5wYXNpZF9sb2NrLCBmbGFncyk7CiAJfQogCi0JZHJtX3NjaGVkX2VudGl0
eV9kZXN0cm95KCZ2bS0+ZW50aXR5KTsKKwlkcm1fc2NoZWRfZW50aXR5X2Rlc3Ryb3koJnZtLT5k
aXJlY3QpOworCWRybV9zY2hlZF9lbnRpdHlfZGVzdHJveSgmdm0tPmRlbGF5ZWQpOwogCiAJaWYg
KCFSQl9FTVBUWV9ST09UKCZ2bS0+dmEucmJfcm9vdCkpIHsKIAkJZGV2X2VycihhZGV2LT5kZXYs
ICJzdGlsbCBhY3RpdmUgYm8gaW5zaWRlIHZtXG4iKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X3ZtLmgKaW5kZXggMzM1MmE4N2I4MjJlLi43MTM4NzIyZWU1NWYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5oCkBAIC0yNTcsOCArMjU3LDkgQEAgc3RydWN0IGFt
ZGdwdV92bSB7CiAJc3RydWN0IGFtZGdwdV92bV9wdCAgICAgcm9vdDsKIAlzdHJ1Y3QgZG1hX2Zl
bmNlCSpsYXN0X3VwZGF0ZTsKIAotCS8qIFNjaGVkdWxlciBlbnRpdHkgZm9yIHBhZ2UgdGFibGUg
dXBkYXRlcyAqLwotCXN0cnVjdCBkcm1fc2NoZWRfZW50aXR5CWVudGl0eTsKKwkvKiBTY2hlZHVs
ZXIgZW50aXRpZXMgZm9yIHBhZ2UgdGFibGUgdXBkYXRlcyAqLworCXN0cnVjdCBkcm1fc2NoZWRf
ZW50aXR5CWRpcmVjdDsKKwlzdHJ1Y3QgZHJtX3NjaGVkX2VudGl0eQlkZWxheWVkOwogCiAJdW5z
aWduZWQgaW50CQlwYXNpZDsKIAkvKiBkZWRpY2F0ZWQgdG8gdm0gKi8KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1hLmMgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCmluZGV4IGRkZDE4MWY1ZWQzNy4uZDA4N2Q2
NjUwZDc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1f
c2RtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1hLmMK
QEAgLTk5LDEyICs5OSwxMyBAQCBzdGF0aWMgaW50IGFtZGdwdV92bV9zZG1hX2NvbW1pdChzdHJ1
Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9wYXJhbXMgKnAsCiAJc3RydWN0IGRtYV9mZW5jZSAqZjsKIAlp
bnQgcjsKIAotCXJpbmcgPSBjb250YWluZXJfb2YocC0+dm0tPmVudGl0eS5ycS0+c2NoZWQsIHN0
cnVjdCBhbWRncHVfcmluZywgc2NoZWQpOworCXJpbmcgPSBjb250YWluZXJfb2YocC0+dm0tPmRl
bGF5ZWQucnEtPnNjaGVkLCBzdHJ1Y3QgYW1kZ3B1X3JpbmcsCisJCQkgICAgc2NoZWQpOwogCiAJ
V0FSTl9PTihpYi0+bGVuZ3RoX2R3ID09IDApOwogCWFtZGdwdV9yaW5nX3BhZF9pYihyaW5nLCBp
Yik7CiAJV0FSTl9PTihpYi0+bGVuZ3RoX2R3ID4gcC0+bnVtX2R3X2xlZnQpOwotCXIgPSBhbWRn
cHVfam9iX3N1Ym1pdChwLT5qb2IsICZwLT52bS0+ZW50aXR5LAorCXIgPSBhbWRncHVfam9iX3N1
Ym1pdChwLT5qb2IsICZwLT52bS0+ZGVsYXllZCwKIAkJCSAgICAgIEFNREdQVV9GRU5DRV9PV05F
Ul9WTSwgJmYpOwogCWlmIChyKQogCQlnb3RvIGVycm9yOwotLSAKMi4xNy4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlz
dAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
