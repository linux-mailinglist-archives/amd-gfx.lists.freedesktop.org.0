Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3987C222ABB
	for <lists+amd-gfx@lfdr.de>; Thu, 16 Jul 2020 20:17:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C20CE6ECB9;
	Thu, 16 Jul 2020 18:17:36 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr770075.outbound.protection.outlook.com [40.107.77.75])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A33BD6ECB9
 for <amd-gfx@lists.freedesktop.org>; Thu, 16 Jul 2020 18:17:34 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=fNf+SRGQTrm/pNr3mAhv/U+qwQEV2qu6kkgkTkkHwxa+AsCgdC9lgmncrZ3HGQIHqqqmaIG++v2zB50W5DWGYYNgpvOi0oD9wiNbpQgzZgBVvVQpvliKum1rSkdKd5i6RSTPl4AFQ4r3kyWXS9mFvroveRaktWobLcd6cpVHDDoqdigH9KY8S9ROai2FxDbWIXByHA046SNASu9goJR4xsldzHXxPEC/hlAeqAxw6JmKZqPPKjrM4C7N22BqhUbsKj2Fq4HA+ErC6/c0zmCMhR2tVhMFdNvjeaO6ntNXbyiS1pHaZThx1QaOc6kMEqa/e0I4wKUgQxVe/nA1TJu5ow==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=lRNRzPrmjiwzOtCKbcbulAizhMrsg2fIi2BocXhEoC0=;
 b=aLJm8yGjmGVnjaH31rIUnfwzZtyl0QLUh3bSwzGOKf5XSUTK/Bbyoi32USkImLIOlPAMxBGv4r+k4NMzqht8SZNfSdopXYJBw7gJkLBex6Tn7eMyDeEB2HAa7htOaJKlZsmds8nCnHMAWeKEFujnD9DiBWqtKjDItQ77e/vP+dBKhLV7IRJLaSVK6jL2IRmYOsJxcOvgOfhnZg4Zts5CpyZuISWr84mHoxDfu8Vv+42ZXzdtMfJTstnRVwBm6n7OYytBghGl8pVyp1zSyMhGp5hgRV8CWsvjibpyz/lPjHNMlyrewuD7aIwnQNSUmc0QQK8tUrXzJmDgDaJLwLx0bw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=lRNRzPrmjiwzOtCKbcbulAizhMrsg2fIi2BocXhEoC0=;
 b=VU3rorCrE9VcQFMMYY2x5cM9vzkwY/m/9Iok4qJRVvd8TKCU7TDFmy2NxmfDLOq8Bhr/VyueI8qiVN5G6oxy02LnStZVDCIoDV36wjpwTAz7VVcsALc5F406a5kYvuh39GdzI/Z6x9/qtTBu2HuENI86IA1NAiyaJ6BCO1nisnA=
Authentication-Results: amd.com; dkim=none (message not signed)
 header.d=none;amd.com; dmarc=none action=none header.from=amd.com;
Received: from BN8PR12MB3124.namprd12.prod.outlook.com (2603:10b6:408:41::12)
 by BN8PR12MB2930.namprd12.prod.outlook.com (2603:10b6:408:69::13)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3174.23; Thu, 16 Jul
 2020 18:17:31 +0000
Received: from BN8PR12MB3124.namprd12.prod.outlook.com
 ([fe80::d0d4:708e:e217:fa27]) by BN8PR12MB3124.namprd12.prod.outlook.com
 ([fe80::d0d4:708e:e217:fa27%3]) with mapi id 15.20.3174.026; Thu, 16 Jul 2020
 18:17:31 +0000
Subject: Re: [PATCH v4] drm/amdgpu: fix system hang issue during GPU reset
To: Dennis Li <Dennis.Li@amd.com>, amd-gfx@lists.freedesktop.org,
 Alexander.Deucher@amd.com, Tao.Zhou1@amd.com, Hawking.Zhang@amd.com,
 Guchun.Chen@amd.com
References: <20200716060355.11530-1-Dennis.Li@amd.com>
From: Luben Tuikov <luben.tuikov@amd.com>
Message-ID: <7ba6aa10-3eaf-a206-bbcc-fa26c21413d3@amd.com>
Date: Thu, 16 Jul 2020 14:17:29 -0400
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.10.0
In-Reply-To: <20200716060355.11530-1-Dennis.Li@amd.com>
Content-Language: en-CA
X-ClientProxiedBy: YT1PR01CA0111.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b01:2c::20) To BN8PR12MB3124.namprd12.prod.outlook.com
 (2603:10b6:408:41::12)
MIME-Version: 1.0
X-MS-Exchange-MessageSentRepresentingType: 1
Received: from localhost.localdomain (165.204.55.250) by
 YT1PR01CA0111.CANPRD01.PROD.OUTLOOK.COM (2603:10b6:b01:2c::20) with Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.3195.18 via Frontend Transport; Thu, 16 Jul 2020 18:17:30 +0000
X-Originating-IP: [165.204.55.250]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-HT: Tenant
X-MS-Office365-Filtering-Correlation-Id: d2d363e5-40e7-4c50-cd9b-08d829b480f2
X-MS-TrafficTypeDiagnostic: BN8PR12MB2930:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <BN8PR12MB2930FAA9A34D6FD7F20A5677997F0@BN8PR12MB2930.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:663;
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: Pg0I/yVMPyWWfX4zH35aHipMJXd3tozozfWKM9svA405DAoVz4D9Mt+xwI+/MrZWI7d2n1QV7YyyRRkM20X3Cv5WZ+ohLv4bt9xdbL4equZvJHZNrOdcGl8hfsGQZSjH9PSc3qIb76jhBXgi2JiD+KIl8YwNH2mxNavSyBH79yodEhCp/WircU6AOgF97qCOJLeRnsZcmYvI4pWzJVOs9Zxng8KPlkMPP0kP63/WK4NTkUXpjVEWX6ZW3QkUWOCkEXBkai89DsBduSp09KZBdsJznWVzP2hKpxH76mxuwPCLLL+XoEudb4o5vOprsMwBN8JA/R2n6d+r8KBZPwkO8SRRRXr1t4TV/IMvcJw40WbWBGmib9XhVCyuho+73Utu
X-Forefront-Antispam-Report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:BN8PR12MB3124.namprd12.prod.outlook.com; PTR:; CAT:NONE;
 SFTY:;
 SFS:(4636009)(39860400002)(376002)(366004)(396003)(346002)(136003)(8936002)(66476007)(66574015)(66556008)(316002)(86362001)(956004)(36756003)(52116002)(2616005)(30864003)(31696002)(66946007)(8676002)(5660300002)(83380400001)(6486002)(6512007)(26005)(16526019)(53546011)(6636002)(6506007)(478600001)(2906002)(186003)(44832011)(31686004)(43740500002)(559001)(579004);
 DIR:OUT; SFP:1101; 
X-MS-Exchange-AntiSpam-MessageData: 5rWwnnzuFpBKeJTEtb7qCPiYSu6wVwLPUau8870NRVWIbMUxKBHpsgncoNqUNwvS/xXkDvcfqCMNyvp0pylq5/p4BKVo0GGuBXk/jtHMQLB5Pa4nzjQRMQSa6RILmm4agTtiw2C4WZ4TQ/9O98NQXBtVcfbr7fo76y1n7BBsmPh+Uhv9buEzS1bgh9+9/T9RZr+ck0K/VQCHIR0IhVfYpyAZIyyEQItGbctu870mHvazbnVoDhSPEVZf+F4tf5cRLmX3dGc/RcAj5bgpfeUAEcmqefocltaOll1x98o/QdJ0l71+5CgPIys+JRPw77vbNxrpN3PVPaS3ZLei3RA3ThcKvQgyk6XurjwpW7iHnuLSmSYjaRbTXQ4P1mKh9GJL+uqrfaW2E+JVema1FumqXuvRaaHLvsE1CX46m3bxXMdZRLxVUjbC+NDrGx/qdtOUHP2zQDzrczhJgApQaHkbSuX9Oz+Kjakin6hQqpRR2obY8snCOaDG9ChoScDSnCUZ
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: d2d363e5-40e7-4c50-cd9b-08d829b480f2
X-MS-Exchange-CrossTenant-AuthSource: BN8PR12MB3124.namprd12.prod.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 16 Jul 2020 18:17:30.9721 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: OateeYS/2LaNtbTVrDMr+hOOXO+7IJShbD8tPp5fuv7gnkmvJOuKd7Bdkm/l5qDI
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN8PR12MB2930
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

SGksCgpDaGVja3BhdGNoIGNvbXBsYWlucyBhYm91dCB0aGUgZm9sbG93aW5nIChpZ25vcmluZyBs
b25nIGxpbmVzKSwgd2hlbgp5b3VyIHBhdGNoIGlzIGFwcGxpZWQgd2l0aCAiZ2l0IGFtIi4gSSBz
dWdnZXN0IGZpeGluZyAiRVJST1IiIHR5cGVzCmZpcnN0OiAiaWYoIiAtLT4gImlmICgiLCBhcyBp
cyB0aGUga2VybmVsIHN0eWxlLgoKJChHSVRfQ0hFQ0tQQVRDSCs9IiAtLWlnbm9yZSBMT05HX0xJ
TkUsTE9OR19MSU5FX1NUUklORyxMT05HX0xJTkVfQ09NTUVOVCI7IGdpdCBhbSAvdG1wL1xbUEFU
Q0hcIHY0XF1cIGRybV9hbWRncHVcOlwgZml4XCBzeXN0ZW1cIGhhbmdcIGlzc3VlXCBkdXJpbmdc
IEdQVVwgcmVzZXQuZW1sKQpBcHBseWluZzogZHJtL2FtZGdwdTogZml4IHN5c3RlbSBoYW5nIGlz
c3VlIGR1cmluZyBHUFUgcmVzZXQKLTozNTogRVJST1I6U1BBQ0lORzogc3BhY2UgcmVxdWlyZWQg
YmVmb3JlIHRoZSBvcGVuIHBhcmVudGhlc2lzICcoJwojMzU6IEZJTEU6IGRyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmQuYzoyNDc6CisJaWYoIWRvd25fcmVhZF90cnlsb2Nr
KCZhZGV2LT5yZXNldF9zZW0pKQoKLToxMDE6IEVSUk9SOlNQQUNJTkc6IHNwYWNlIHJlcXVpcmVk
IGJlZm9yZSB0aGUgb3BlbiBwYXJlbnRoZXNpcyAnKCcKIzEwMTogRklMRTogZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5jOjYyOToKKwlpZighZG93bl9yZWFkX3RyeWxv
Y2soJmFkZXYtPnJlc2V0X3NlbSkpIHsKCi06MTIxOiBFUlJPUjpTUEFDSU5HOiBzcGFjZSByZXF1
aXJlZCBiZWZvcmUgdGhlIG9wZW4gcGFyZW50aGVzaXMgJygnCiMxMjE6IEZJTEU6IGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmQuYzo2NzI6CisJaWYoIWRvd25fcmVhZF90
cnlsb2NrKCZhZGV2LT5yZXNldF9zZW0pKQoKLToxNDY6IEVSUk9SOlNQQUNJTkc6IHNwYWNlIHJl
cXVpcmVkIGJlZm9yZSB0aGUgb3BlbiBwYXJlbnRoZXNpcyAnKCcKIzE0NjogRklMRTogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5jOjY5OToKKwlpZihkb3duX3JlYWRf
dHJ5bG9jaygmYWRldi0+cmVzZXRfc2VtKSkgewoKLToyMTU6IEVSUk9SOlNQQUNJTkc6IHNwYWNl
IHJlcXVpcmVkIGJlZm9yZSB0aGUgb3BlbiBwYXJlbnRoZXNpcyAnKCcKIzIxNTogRklMRTogZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jOjExOTM6CisJaWYo
IWRvd25fcmVhZF90cnlsb2NrKCZhZGV2LT5yZXNldF9zZW0pKQoKLTo0Mjg6IENIRUNLOlBBUkVO
VEhFU0lTX0FMSUdOTUVOVDogQWxpZ25tZW50IHNob3VsZCBtYXRjaCBvcGVuIHBhcmVudGhlc2lz
CiM0Mjg6IEZJTEU6IGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYzo0
Mjc5OgorCQkJRFJNX0lORk8oIkJhaWxpbmcgb24gVERSIGZvciBzX2pvYjolbGx4LCBoaXZlOiAl
bGx4IGFzIGFub3RoZXIgYWxyZWFkeSBpbiBwcm9ncmVzcyIsCisJCQkJam9iID8gam9iLT5iYXNl
LmlkIDogLTEsIGhpdmUtPmhpdmVfaWQpOwoKLToyMjQzOiBDSEVDSzpVTkNPTU1FTlRFRF9ERUZJ
TklUSU9OOiBzdHJ1Y3QgbXV0ZXggZGVmaW5pdGlvbiB3aXRob3V0IGNvbW1lbnQKIzIyNDM6IEZJ
TEU6IGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV94Z21pLmg6MzM6CisJc3RydWN0
IG11dGV4IGhpdmVfbG9jazsKCnRvdGFsOiA1IGVycm9ycywgMCB3YXJuaW5ncywgMiBjaGVja3Ms
IDIyNDcgbGluZXMgY2hlY2tlZAoKTk9URTogRm9yIHNvbWUgb2YgdGhlIHJlcG9ydGVkIGRlZmVj
dHMsIGNoZWNrcGF0Y2ggbWF5IGJlIGFibGUgdG8KICAgICAgbWVjaGFuaWNhbGx5IGNvbnZlcnQg
dG8gdGhlIHR5cGljYWwgc3R5bGUgdXNpbmcgLS1maXggb3IgLS1maXgtaW5wbGFjZS4KCllvdXIg
cGF0Y2ggaGFzIHN0eWxlIHByb2JsZW1zLCBwbGVhc2UgcmV2aWV3LgoKTk9URTogSWdub3JlZCBt
ZXNzYWdlIHR5cGVzOiBMT05HX0xJTkUgTE9OR19MSU5FX0NPTU1FTlQgTE9OR19MSU5FX1NUUklO
RwoKTk9URTogSWYgYW55IG9mIHRoZSBlcnJvcnMgYXJlIGZhbHNlIHBvc2l0aXZlcywgcGxlYXNl
IHJlcG9ydAogICAgICB0aGVtIHRvIHRoZSBtYWludGFpbmVyLCBzZWUgQ0hFQ0tQQVRDSCBpbiBN
QUlOVEFJTkVSUy4KCnNjcmlwdHMvY2hlY2twYXRjaC5wbCBmb3VuZCBwcm9ibGVtcyB3aXRoIHlv
dXIgcGF0Y2guClRvIGRpc2FibGUgaXRzIGNoZWNrLCBydW4geW91ciBHaXQgY29tbWFuZCBhcwoo
dW5zZXQgR0lUX0NIRUNLUEFUQ0g7IGdpdCAuLi4pCiRfCgpSZWdhcmRzLApMdWJlbgoKCk9uIDIw
MjAtMDctMTYgMjowMyBhLm0uLCBEZW5uaXMgTGkgd3JvdGU6Cj4gd2hlbiBHUFUgaGFuZywgZHJp
dmVyIGhhcyBtdWx0aS1wYXRocyB0byBlbnRlciBhbWRncHVfZGV2aWNlX2dwdV9yZWNvdmVyLAo+
IHRoZSBhdG9taWMgYWRldi0+aW5fZ3B1X3Jlc2V0IGFuZCBoaXZlLT5pbl9yZXNldCBhcmUgdXNl
ZCB0byBhdm9pZAo+IHJlLWVudGVyaW5nIEdQVSByZWNvdmVyeS4KPiAKPiBEdXJpbmcgR1BVIHJl
c2V0IGFuZCByZXN1bWUsIGl0IGlzIHVuc2FmZSB0aGF0IG90aGVyIHRocmVhZHMgYWNjZXNzIEdQ
VSwKPiB3aGljaCBtYXliZSBjYXVzZSBHUFUgcmVzZXQgZmFpbGVkLiBUaGVyZWZvcmUgdGhlIG5l
dyByd19zZW1hcGhvcmUKPiBhZGV2LT5yZXNldF9zZW0gaXMgaW50cm9kdWNlZCwgd2hpY2ggcHJv
dGVjdCBHUFUgZnJvbSBiZWluZyBhY2Nlc3NlZCBieQo+IGV4dGVybmFsIHRocmVhZHMgZHVyaW5n
IHJlY292ZXJ5Lgo+IAo+IHYyOgo+IDEuIGFkZCByd2xvY2sgZm9yIHNvbWUgaW9jdGxzLCBkZWJ1
Z2ZzIGFuZCBmaWxlLWNsb3NlIGZ1bmN0aW9uLgo+IDIuIGNoYW5nZSB0byB1c2UgZHFtLT5pc19y
ZXNldHRpbmcgYW5kIGRxbV9sb2NrIGZvciBwcm90ZWN0aW9uIGluIGtmZAo+IGRyaXZlci4KPiAz
LiByZW1vdmUgdHJ5X2xvY2sgYW5kIGNoYW5nZSBhZGV2LT5pbl9ncHVfcmVzZXQgYXMgYXRvbWlj
LCB0byBhdm9pZAo+IHJlLWVudGVyIEdQVSByZWNvdmVyeSBmb3IgdGhlIHNhbWUgR1BVIGhhbmcu
Cj4gCj4gdjM6Cj4gMS4gY2hhbmdlIGJhY2sgdG8gdXNlIGFkZXYtPnJlc2V0X3NlbSB0byBwcm90
ZWN0IGtmZCBjYWxsYmFjawo+IGZ1bmN0aW9ucywgYmVjYXVzZSBkcW1fbG9jayBjb3VsZG4ndCBw
cm90ZWN0IGFsbCBjb2RlcywgZm9yIGV4YW1wbGU6Cj4gZnJlZV9tcWQgbXVzdCBiZSBjYWxsZWQg
b3V0c2lkZSBvZiBkcW1fbG9jazsKPiAKPiBbIDEyMzAuMTc2MTk5XSBIYXJkd2FyZSBuYW1lOiBT
dXBlcm1pY3JvIFNZUy03MDQ5R1AtVFJUL1gxMURQRy1RVCwgQklPUyAzLjEgMDUvMjMvMjAxOQo+
IFsgMTIzMC4xNzcyMjFdIENhbGwgVHJhY2U6Cj4gWyAxMjMwLjE3ODI0OV0gIGR1bXBfc3RhY2sr
MHg5OC8weGQ1Cj4gWyAxMjMwLjE3OTQ0M10gIGFtZGdwdV92aXJ0X2tpcV9yZWdfd3JpdGVfcmVn
X3dhaXQrMHgxODEvMHgxOTAgW2FtZGdwdV0KPiBbIDEyMzAuMTgwNjczXSAgZ21jX3Y5XzBfZmx1
c2hfZ3B1X3RsYisweGNjLzB4MzEwIFthbWRncHVdCj4gWyAxMjMwLjE4MTg4Ml0gIGFtZGdwdV9n
YXJ0X3VuYmluZCsweGE5LzB4ZTAgW2FtZGdwdV0KPiBbIDEyMzAuMTgzMDk4XSAgYW1kZ3B1X3R0
bV9iYWNrZW5kX3VuYmluZCsweDQ2LzB4MTgwIFthbWRncHVdCj4gWyAxMjMwLjE4NDIzOV0gID8g
dHRtX2JvX3B1dCsweDE3MS8weDVmMCBbdHRtXQo+IFsgMTIzMC4xODUzOTRdICB0dG1fdHRfdW5i
aW5kKzB4MjEvMHg0MCBbdHRtXQo+IFsgMTIzMC4xODY1NThdICB0dG1fdHRfZGVzdHJveS5wYXJ0
LjEyKzB4MTIvMHg2MCBbdHRtXQo+IFsgMTIzMC4xODc3MDddICB0dG1fdHRfZGVzdHJveSsweDEz
LzB4MjAgW3R0bV0KPiBbIDEyMzAuMTg4ODMyXSAgdHRtX2JvX2NsZWFudXBfbWVtdHlwZV91c2Ur
MHgzNi8weDgwIFt0dG1dCj4gWyAxMjMwLjE4OTk3OV0gIHR0bV9ib19wdXQrMHgxYmUvMHg1ZjAg
W3R0bV0KPiBbIDEyMzAuMTkxMjMwXSAgYW1kZ3B1X2JvX3VucmVmKzB4MWUvMHgzMCBbYW1kZ3B1
XQo+IFsgMTIzMC4xOTI1MjJdICBhbWRncHVfYW1ka2ZkX2ZyZWVfZ3R0X21lbSsweGFmLzB4MTQw
IFthbWRncHVdCj4gWyAxMjMwLjE5MzgzM10gIGZyZWVfbXFkKzB4MjUvMHg0MCBbYW1kZ3B1XQo+
IFsgMTIzMC4xOTUxNDNdICBkZXN0cm95X3F1ZXVlX2Nwc2NoKzB4MWE3LzB4MjcwIFthbWRncHVd
Cj4gWyAxMjMwLjE5NjQ3NV0gIHBxbV9kZXN0cm95X3F1ZXVlKzB4MTA1LzB4MjYwIFthbWRncHVd
Cj4gWyAxMjMwLjE5NzgxOV0gIGtmZF9pb2N0bF9kZXN0cm95X3F1ZXVlKzB4MzcvMHg3MCBbYW1k
Z3B1XQo+IFsgMTIzMC4xOTkxNTRdICBrZmRfaW9jdGwrMHgyNzcvMHg1MDAgW2FtZGdwdV0KPiBb
IDEyMzAuMjAwNDU4XSAgPyBrZmRfaW9jdGxfZ2V0X2Nsb2NrX2NvdW50ZXJzKzB4NjAvMHg2MCBb
YW1kZ3B1XQo+IFsgMTIzMC4yMDE2NTZdICA/IHRvbW95b19maWxlX2lvY3RsKzB4MTkvMHgyMAo+
IFsgMTIzMC4yMDI4MzFdICBrc3lzX2lvY3RsKzB4OTgvMHhiMAo+IFsgMTIzMC4yMDQwMDRdICBf
X3g2NF9zeXNfaW9jdGwrMHgxYS8weDIwCj4gWyAxMjMwLjIwNTE3NF0gIGRvX3N5c2NhbGxfNjQr
MHg1Zi8weDI1MAo+IFsgMTIzMC4yMDYzMzldICBlbnRyeV9TWVNDQUxMXzY0X2FmdGVyX2h3ZnJh
bWUrMHg0OS8weGJlCj4gCj4gMi4gcmVtb3ZlIHRyeV9sb2NrIGFuZCBpbnRyb2R1Y2UgYXRvbWlj
IGhpdmUtPmluX3Jlc2V0LCB0byBhdm9pZAo+IHJlLWVudGVyIEdQVSByZWNvdmVyeS4KPiAKPiB2
NDoKPiAxLiByZW1vdmUgYW4gdW5uZWNlc3Nhcnkgd2hpdGVzcGFjZSBjaGFuZ2UgaW4ga2ZkX2No
YXJkZXYuYwo+IDIuIHJlbW92ZSBjb21tZW50IGNvZGVzIGluIGFtZGdwdV9kZXZpY2UuYwo+IDMu
IGFkZCBtb3JlIGRldGFpbGVkIGNvbW1lbnQgaW4gY29tbWl0IG1lc3NhZ2UKPiA0LiBkZWZpbmUg
YSB3cmFwIGZ1bmN0aW9uIGFtZGdwdV9pbl9yZXNldAo+IAo+IFNpZ25lZC1vZmYtYnk6IERlbm5p
cyBMaSA8RGVubmlzLkxpQGFtZC5jb20+Cj4gUmV2aWV3ZWQtYnk6IEFuZHJleSBHcm9kem92c2t5
IDxhbmRyZXkuZ3JvZHpvdnNreUBhbWQuY29tPgo+IFJldmlld2VkLWJ5OiBDaHJpc3RpYW4gS8O2
bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Cj4gUmV2aWV3ZWQtYnk6IEZlbGl4IEt1ZWhs
aW5nIDxGZWxpeC5LdWVobGluZ0BhbWQuY29tPgo+IFJldmlld2VkLWJ5OiBMaWpvIExhemFyIDxM
aWpvLkxhemFyQGFtZC5jb20+Cj4gCj4gQ2hhbmdlLUlkOiBJN2Y3N2E3Mjc5NTQ2MjU4N2VkN2Q1
ZjUxZmU1M2E1OTRhMGYxZjcwOAo+IAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHUuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdS5oCj4g
aW5kZXggODBmMzJiM2JlYjg4Li5iZThiZDNhZTc4M2EgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHUuaAo+IEBAIC05NjMsOSArOTYzLDkgQEAgc3RydWN0IGFtZGdwdV9kZXZpY2Ug
ewo+ICAJYm9vbCAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9zdXNwZW5kOwo+ICAJYm9v
bAkJCQlpbl9oaWJlcm5hdGU7Cj4gIAo+IC0JYm9vbCAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBpbl9ncHVfcmVzZXQ7Cj4gKwlhdG9taWNfdCAgICAgICAgICAgICAgICAgICAgICAgIGluX2dw
dV9yZXNldDsKPiAgCWVudW0gcHBfbXAxX3N0YXRlICAgICAgICAgICAgICAgbXAxX3N0YXRlOwo+
IC0Jc3RydWN0IG11dGV4ICBsb2NrX3Jlc2V0Owo+ICsJc3RydWN0IHJ3X3NlbWFwaG9yZQlyZXNl
dF9zZW07Cj4gIAlzdHJ1Y3QgYW1kZ3B1X2Rvb3JiZWxsX2luZGV4IGRvb3JiZWxsX2luZGV4Owo+
ICAKPiAgCXN0cnVjdCBtdXRleAkJCW5vdGlmaWVyX2xvY2s7Cj4gQEAgLTEyODAsNCArMTI4MCw5
IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBhbWRncHVfaXNfdG16KHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2KQo+ICAgICAgICAgcmV0dXJuIGFkZXYtPmdtYy50bXpfZW5hYmxlZDsKPiAgfQo+ICAK
PiArc3RhdGljIGlubGluZSBib29sIGFtZGdwdV9pbl9yZXNldChzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldikKPiArewo+ICsJcmV0dXJuIGF0b21pY19yZWFkKCZhZGV2LT5pbl9ncHVfcmVzZXQp
ID8gdHJ1ZSA6IGZhbHNlOwo+ICt9Cj4gKwo+ICAjZW5kaWYKPiBkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5jCj4gaW5kZXggMWI4NjVmZWQ3NGNhLi4zZmMyMjI5ZmM1
MzMgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtm
ZC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5jCj4g
QEAgLTI0NCwxMSArMjQ0LDE0IEBAIGludCBhbWRncHVfYW1ka2ZkX2FsbG9jX2d0dF9tZW0oc3Ry
dWN0IGtnZF9kZXYgKmtnZCwgc2l6ZV90IHNpemUsCj4gIAlpZiAoY3BfbXFkX2dmeDkpCj4gIAkJ
YnAuZmxhZ3MgfD0gQU1ER1BVX0dFTV9DUkVBVEVfQ1BfTVFEX0dGWDk7Cj4gIAo+ICsJaWYoIWRv
d25fcmVhZF90cnlsb2NrKCZhZGV2LT5yZXNldF9zZW0pKQo+ICsJCXJldHVybiAtRUlPOwo+ICsK
PiAgCXIgPSBhbWRncHVfYm9fY3JlYXRlKGFkZXYsICZicCwgJmJvKTsKPiAgCWlmIChyKSB7Cj4g
IAkJZGV2X2VycihhZGV2LT5kZXYsCj4gIAkJCSJmYWlsZWQgdG8gYWxsb2NhdGUgQk8gZm9yIGFt
ZGtmZCAoJWQpXG4iLCByKTsKPiAtCQlyZXR1cm4gcjsKPiArCQlnb3RvIGVycjsKPiAgCX0KPiAg
Cj4gIAkvKiBtYXAgdGhlIGJ1ZmZlciAqLwo+IEBAIC0yODMsNiArMjg2LDcgQEAgaW50IGFtZGdw
dV9hbWRrZmRfYWxsb2NfZ3R0X21lbShzdHJ1Y3Qga2dkX2RldiAqa2dkLCBzaXplX3Qgc2l6ZSwK
PiAgCj4gIAlhbWRncHVfYm9fdW5yZXNlcnZlKGJvKTsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5y
ZXNldF9zZW0pOwo+ICAJcmV0dXJuIDA7Cj4gIAo+ICBhbGxvY2F0ZV9tZW1fa21hcF9ib19mYWls
ZWQ6Cj4gQEAgLTI5MSwxOSArMjk1LDI1IEBAIGludCBhbWRncHVfYW1ka2ZkX2FsbG9jX2d0dF9t
ZW0oc3RydWN0IGtnZF9kZXYgKmtnZCwgc2l6ZV90IHNpemUsCj4gIAlhbWRncHVfYm9fdW5yZXNl
cnZlKGJvKTsKPiAgYWxsb2NhdGVfbWVtX3Jlc2VydmVfYm9fZmFpbGVkOgo+ICAJYW1kZ3B1X2Jv
X3VucmVmKCZibyk7Cj4gLQo+ICtlcnI6Cj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
ICAJcmV0dXJuIHI7Cj4gIH0KPiAgCj4gIHZvaWQgYW1kZ3B1X2FtZGtmZF9mcmVlX2d0dF9tZW0o
c3RydWN0IGtnZF9kZXYgKmtnZCwgdm9pZCAqbWVtX29iaikKPiAgewo+ICsJc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKilrZ2Q7Cj4gIAlzdHJ1Y3Qg
YW1kZ3B1X2JvICpibyA9IChzdHJ1Y3QgYW1kZ3B1X2JvICopIG1lbV9vYmo7Cj4gIAo+ICsJZG93
bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWFtZGdwdV9ib19yZXNlcnZlKGJvLCB0
cnVlKTsKPiAgCWFtZGdwdV9ib19rdW5tYXAoYm8pOwo+ICAJYW1kZ3B1X2JvX3VucGluKGJvKTsK
PiAgCWFtZGdwdV9ib191bnJlc2VydmUoYm8pOwo+ICAJYW1kZ3B1X2JvX3VucmVmKCYoYm8pKTsK
PiArCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICB9Cj4gIAo+ICBpbnQgYW1kZ3B1
X2FtZGtmZF9hbGxvY19nd3Moc3RydWN0IGtnZF9kZXYgKmtnZCwgc2l6ZV90IHNpemUsCj4gQEAg
LTMzNSw5ICszNDUsMTQgQEAgaW50IGFtZGdwdV9hbWRrZmRfYWxsb2NfZ3dzKHN0cnVjdCBrZ2Rf
ZGV2ICprZ2QsIHNpemVfdCBzaXplLAo+ICAKPiAgdm9pZCBhbWRncHVfYW1ka2ZkX2ZyZWVfZ3dz
KHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHZvaWQgKm1lbV9vYmopCj4gIHsKPiArCXN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopa2dkOwo+ICAJc3RydWN0
IGFtZGdwdV9ibyAqYm8gPSAoc3RydWN0IGFtZGdwdV9ibyAqKW1lbV9vYmo7Cj4gIAo+ICsJZG93
bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWFtZGdwdV9ib191bnJlZigmYm8pOwo+
ICsKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIH0KPiAgCj4gIHVpbnQzMl90IGFt
ZGdwdV9hbWRrZmRfZ2V0X2Z3X3ZlcnNpb24oc3RydWN0IGtnZF9kZXYgKmtnZCwKPiBAQCAtNjEx
LDEyICs2MjYsMTkgQEAgaW50IGFtZGdwdV9hbWRrZmRfc3VibWl0X2liKHN0cnVjdCBrZ2RfZGV2
ICprZ2QsIGVudW0ga2dkX2VuZ2luZV90eXBlIGVuZ2luZSwKPiAgCS8qIFRoaXMgd29ya3MgZm9y
IE5PX0hXUy4gVE9ETzogbmVlZCB0byBoYW5kbGUgd2l0aG91dCBrbm93aW5nIFZNSUQgKi8KPiAg
CWpvYi0+dm1pZCA9IHZtaWQ7Cj4gIAo+ICsJaWYoIWRvd25fcmVhZF90cnlsb2NrKCZhZGV2LT5y
ZXNldF9zZW0pKSB7Cj4gKwkJcmV0ID0gLUVJTzsKPiArCQlnb3RvIGVycl9pYl9zY2hlZDsKPiAr
CX0KPiArCj4gIAlyZXQgPSBhbWRncHVfaWJfc2NoZWR1bGUocmluZywgMSwgaWIsIGpvYiwgJmYp
Owo+ICAJaWYgKHJldCkgewo+ICAJCURSTV9FUlJPUigiYW1kZ3B1OiBmYWlsZWQgdG8gc2NoZWR1
bGUgSUIuXG4iKTsKPiAgCQlnb3RvIGVycl9pYl9zY2hlZDsKPiAgCX0KPiAgCj4gKwl1cF9yZWFk
KCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXJldCA9IGRtYV9mZW5jZV93YWl0KGYsIGZhbHNl
KTsKPiAgCj4gIGVycl9pYl9zY2hlZDoKPiBAQCAtNjQ3LDYgKzY2OSw5IEBAIGludCBhbWRncHVf
YW1ka2ZkX2ZsdXNoX2dwdV90bGJfdm1pZChzdHJ1Y3Qga2dkX2RldiAqa2dkLCB1aW50MTZfdCB2
bWlkKQo+ICB7Cj4gIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqKWtnZDsKPiAgCj4gKwlpZighZG93bl9yZWFkX3RyeWxvY2soJmFkZXYtPnJlc2V0
X3NlbSkpCj4gKwkJcmV0dXJuIC1FSU87Cj4gKwo+ICAJaWYgKGFkZXYtPmZhbWlseSA9PSBBTURH
UFVfRkFNSUxZX0FJKSB7Cj4gIAkJaW50IGk7Cj4gIAo+IEBAIC02NTYsNiArNjgxLDggQEAgaW50
IGFtZGdwdV9hbWRrZmRfZmx1c2hfZ3B1X3RsYl92bWlkKHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHVp
bnQxNl90IHZtaWQpCj4gIAkJYW1kZ3B1X2dtY19mbHVzaF9ncHVfdGxiKGFkZXYsIHZtaWQsIEFN
REdQVV9HRlhIVUJfMCwgMCk7Cj4gIAl9Cj4gIAo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2Vt
KTsKPiArCj4gIAlyZXR1cm4gMDsKPiAgfQo+ICAKPiBAQCAtNjY0LDExICs2OTEsMTcgQEAgaW50
IGFtZGdwdV9hbWRrZmRfZmx1c2hfZ3B1X3RsYl9wYXNpZChzdHJ1Y3Qga2dkX2RldiAqa2dkLCB1
aW50MTZfdCBwYXNpZCkKPiAgCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBh
bWRncHVfZGV2aWNlICopa2dkOwo+ICAJY29uc3QgdWludDMyX3QgZmx1c2hfdHlwZSA9IDA7Cj4g
IAlib29sIGFsbF9odWIgPSBmYWxzZTsKPiArCWludCByZXQgPSAtRUlPOwo+ICAKPiAgCWlmIChh
ZGV2LT5mYW1pbHkgPT0gQU1ER1BVX0ZBTUlMWV9BSSkKPiAgCQlhbGxfaHViID0gdHJ1ZTsKPiAg
Cj4gLQlyZXR1cm4gYW1kZ3B1X2dtY19mbHVzaF9ncHVfdGxiX3Bhc2lkKGFkZXYsIHBhc2lkLCBm
bHVzaF90eXBlLCBhbGxfaHViKTsKPiArCWlmKGRvd25fcmVhZF90cnlsb2NrKCZhZGV2LT5yZXNl
dF9zZW0pKSB7Cj4gKwkJcmV0ID0gYW1kZ3B1X2dtY19mbHVzaF9ncHVfdGxiX3Bhc2lkKGFkZXYs
IHBhc2lkLCBmbHVzaF90eXBlLCBhbGxfaHViKTsKPiArCQl1cF9yZWFkKCZhZGV2LT5yZXNldF9z
ZW0pOwo+ICsJfQo+ICsKPiArCXJldHVybiByZXQ7Cj4gIH0KPiAgCj4gIGJvb2wgYW1kZ3B1X2Ft
ZGtmZF9oYXZlX2F0b21pY3Nfc3VwcG9ydChzdHJ1Y3Qga2dkX2RldiAqa2dkKQo+IGRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92MTAuYyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3YxMC5jCj4gaW5k
ZXggNjkxYzg5NzA1YmNkLi5iODcyY2RiMGI3MDUgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9nZnhfdjEwLmMKPiArKysgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92MTAuYwo+IEBAIC01NDMsNyArNTQz
LDcgQEAgc3RhdGljIGludCBrZ2RfaHFkX2Rlc3Ryb3koc3RydWN0IGtnZF9kZXYgKmtnZCwgdm9p
ZCAqbXFkLAo+ICAJdWludDMyX3QgdGVtcDsKPiAgCXN0cnVjdCB2MTBfY29tcHV0ZV9tcWQgKm0g
PSBnZXRfbXFkKG1xZCk7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChh
bWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FSU87Cj4gIAo+ICAjaWYgMAo+IGRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92
Ny5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9nZnhfdjcuYwo+
IGluZGV4IDBiN2U3ODc0ODU0MC4uODMyYTIwMGJiNjJmIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3Y3LmMKPiArKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92Ny5jCj4gQEAgLTQyNSw3ICs0
MjUsNyBAQCBzdGF0aWMgaW50IGtnZF9ocWRfZGVzdHJveShzdHJ1Y3Qga2dkX2RldiAqa2dkLCB2
b2lkICptcWQsCj4gIAl1bnNpZ25lZCBsb25nIGZsYWdzLCBlbmRfamlmZmllczsKPiAgCWludCBy
ZXRyeTsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9y
ZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVJTzsKPiAgCj4gIAlhY3F1aXJlX3F1ZXVlKGtnZCwg
cGlwZV9pZCwgcXVldWVfaWQpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92OC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2FtZGtmZF9nZnhfdjguYwo+IGluZGV4IGNjZDYzNWI4MTJiNS4uZDA5NDAxMjFhNmE5
IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRf
Z2Z4X3Y4LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2Zk
X2dmeF92OC5jCj4gQEAgLTQyMSw3ICs0MjEsNyBAQCBzdGF0aWMgaW50IGtnZF9ocWRfZGVzdHJv
eShzdHJ1Y3Qga2dkX2RldiAqa2dkLCB2b2lkICptcWQsCj4gIAlpbnQgcmV0cnk7Cj4gIAlzdHJ1
Y3QgdmlfbXFkICptID0gZ2V0X21xZChtcWQpOwo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVz
ZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRUlPOwo+ICAK
PiAgCWFjcXVpcmVfcXVldWUoa2dkLCBwaXBlX2lkLCBxdWV1ZV9pZCk7Cj4gZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3Y5LmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92OS5jCj4gaW5kZXggZGY4
NDFjMmFjNWU3Li4wMzJkM2M4NjYyODAgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9nZnhfdjkuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3Y5LmMKPiBAQCAtNTQxLDcgKzU0MSw3IEBAIGlu
dCBrZ2RfZ2Z4X3Y5X2hxZF9kZXN0cm95KHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHZvaWQgKm1xZCwK
PiAgCXVpbnQzMl90IHRlbXA7Cj4gIAlzdHJ1Y3QgdjlfbXFkICptID0gZ2V0X21xZChtcWQpOwo+
ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFk
ZXYpKQo+ICAJCXJldHVybiAtRUlPOwo+ICAKPiAgCWFjcXVpcmVfcXVldWUoa2dkLCBwaXBlX2lk
LCBxdWV1ZV9pZCk7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9hbWRrZmRfZ3B1dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9h
bWRrZmRfZ3B1dm0uYwo+IGluZGV4IGM0MDg5MzZlOGY5OC4uMTE2MzBkNTZiYzFmIDEwMDY0NAo+
IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwo+
ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwo+
IEBAIC0xMTkwLDYgKzExOTAsOSBAQCBpbnQgYW1kZ3B1X2FtZGtmZF9ncHV2bV9hbGxvY19tZW1v
cnlfb2ZfZ3B1KAo+ICAJCXJldHVybiAtRUlOVkFMOwo+ICAJfQo+ICAKPiArCWlmKCFkb3duX3Jl
YWRfdHJ5bG9jaygmYWRldi0+cmVzZXRfc2VtKSkKPiArCQlyZXR1cm4gLUVJTzsKPiArCj4gIAkq
bWVtID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGtnZF9tZW0pLCBHRlBfS0VSTkVMKTsKPiAgCWlm
ICghKm1lbSkgewo+ICAJCXJldCA9IC1FTk9NRU07Cj4gQEAgLTEyNTYsNiArMTI1OSw3IEBAIGlu
dCBhbWRncHVfYW1ka2ZkX2dwdXZtX2FsbG9jX21lbW9yeV9vZl9ncHUoCj4gIAlpZiAob2Zmc2V0
KQo+ICAJCSpvZmZzZXQgPSBhbWRncHVfYm9fbW1hcF9vZmZzZXQoYm8pOwo+ICAKPiArCXVwX3Jl
YWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAlyZXR1cm4gMDsKPiAgCj4gIGFsbG9jYXRlX2luaXRf
dXNlcl9wYWdlc19mYWlsZWQ6Cj4gQEAgLTEyNzMsNiArMTI3Nyw5IEBAIGludCBhbWRncHVfYW1k
a2ZkX2dwdXZtX2FsbG9jX21lbW9yeV9vZl9ncHUoCj4gIAkJc2dfZnJlZV90YWJsZShzZyk7Cj4g
IAkJa2ZyZWUoc2cpOwo+ICAJfQo+ICsKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4g
Kwo+ICAJcmV0dXJuIHJldDsKPiAgfQo+ICAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfY3MuYwo+IGluZGV4IGZmYmNhZjRiZmI4Yi4uYTk0YjNmODYyZmMyIDEwMDY0NAo+IC0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCj4gKysrIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMKPiBAQCAtMTI5Miw2ICsxMjkyLDggQEAgaW50
IGFtZGdwdV9jc19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1
Y3QgZHJtX2ZpbGUgKmZpbHApCj4gIAlwYXJzZXIuYWRldiA9IGFkZXY7Cj4gIAlwYXJzZXIuZmls
cCA9IGZpbHA7Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXIg
PSBhbWRncHVfY3NfcGFyc2VyX2luaXQoJnBhcnNlciwgZGF0YSk7Cj4gIAlpZiAocikgewo+ICAJ
CURSTV9FUlJPUigiRmFpbGVkIHRvIGluaXRpYWxpemUgcGFyc2VyICVkIVxuIiwgcik7Cj4gQEAg
LTEzMzEsNiArMTMzMyw4IEBAIGludCBhbWRncHVfY3NfaW9jdGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxwKQo+ICBvdXQ6Cj4gIAlhbWRn
cHVfY3NfcGFyc2VyX2ZpbmkoJnBhcnNlciwgciwgcmVzZXJ2ZWRfYnVmZmVycyk7Cj4gIAo+ICsJ
dXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlyZXR1cm4gcjsKPiAgfQo+ICAKPiBk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2N0eC5jIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2N0eC5jCj4gaW5kZXggODg0MmM1NWQ0NDkw
Li5kODVkMTNmN2EwNDMgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2N0eC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2N0
eC5jCj4gQEAgLTM1OCw2ICszNTgsOCBAQCBzdGF0aWMgaW50IGFtZGdwdV9jdHhfcXVlcnkyKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAJaWYgKGF0b21pY19yZWFkKCZjdHgtPmd1aWx0
eSkpCj4gIAkJb3V0LT5zdGF0ZS5mbGFncyB8PSBBTURHUFVfQ1RYX1FVRVJZMl9GTEFHU19HVUlM
VFk7Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCS8qcXVlcnkg
dWUgY291bnQqLwo+ICAJcmFzX2NvdW50ZXIgPSBhbWRncHVfcmFzX3F1ZXJ5X2Vycm9yX2NvdW50
KGFkZXYsIGZhbHNlKTsKPiAgCS8qcmFzIGNvdW50ZXIgaXMgbW9ub3RvbmljIGluY3JlYXNpbmcq
Lwo+IEBAIC0zNzMsNiArMzc1LDggQEAgc3RhdGljIGludCBhbWRncHVfY3R4X3F1ZXJ5MihzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKPiAgCQljdHgtPnJhc19jb3VudGVyX2NlID0gcmFzX2Nv
dW50ZXI7Cj4gIAl9Cj4gIAo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlt
dXRleF91bmxvY2soJm1nci0+bG9jayk7Cj4gIAlyZXR1cm4gMDsKPiAgfQo+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGVidWdmcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RlYnVnZnMuYwo+IGluZGV4IGFlYWRhN2M5ZmJlYS4u
MWJiNGM4YjZhODY2IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9kZWJ1Z2ZzLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZGVidWdmcy5jCj4gQEAgLTEwMCwxNCArMTAwLDE0IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RlYnVn
ZnNfYXV0b2R1bXBfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkK
PiAgCj4gIAlmaWxlLT5wcml2YXRlX2RhdGEgPSBhZGV2Owo+ICAKPiAtCW11dGV4X2xvY2soJmFk
ZXYtPmxvY2tfcmVzZXQpOwo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAJaWYg
KGFkZXYtPmF1dG9kdW1wLmR1bXBpbmcuZG9uZSkgewo+ICAJCXJlaW5pdF9jb21wbGV0aW9uKCZh
ZGV2LT5hdXRvZHVtcC5kdW1waW5nKTsKPiAgCQlyZXQgPSAwOwo+ICAJfSBlbHNlIHsKPiAgCQly
ZXQgPSAtRUJVU1k7Cj4gIAl9Cj4gLQltdXRleF91bmxvY2soJmFkZXYtPmxvY2tfcmVzZXQpOwo+
ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgCj4gIAlyZXR1cm4gcmV0Owo+ICB9Cj4g
QEAgLTEyNiw3ICsxMjYsNyBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGFtZGdwdV9kZWJ1Z2ZzX2F1
dG9kdW1wX3BvbGwoc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVjdCBwb2xsXwo+ICAKPiAgCXBvbGxf
d2FpdChmaWxlLCAmYWRldi0+YXV0b2R1bXAuZ3B1X2hhbmcsIHBvbGxfdGFibGUpOwo+ICAKPiAt
CWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+
ICAJCXJldHVybiBQT0xMSU4gfCBQT0xMUkROT1JNIHwgUE9MTFdSTk9STTsKPiAgCj4gIAlyZXR1
cm4gMDsKPiBAQCAtMTE4OCw3ICsxMTg4LDcgQEAgc3RhdGljIGludCBhbWRncHVfZGVidWdmc190
ZXN0X2liKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKPiAgCX0KPiAgCj4gIAkvKiBB
dm9pZCBhY2NpZGVudGx5IHVucGFya2luZyB0aGUgc2NoZWQgdGhyZWFkIGR1cmluZyBHUFUgcmVz
ZXQgKi8KPiAtCW11dGV4X2xvY2soJmFkZXYtPmxvY2tfcmVzZXQpOwo+ICsJZG93bl9yZWFkKCZh
ZGV2LT5yZXNldF9zZW0pOwo+ICAKPiAgCS8qIGhvbGQgb24gdGhlIHNjaGVkdWxlciAqLwo+ICAJ
Zm9yIChpID0gMDsgaSA8IEFNREdQVV9NQVhfUklOR1M7IGkrKykgewo+IEBAIC0xMjE1LDcgKzEy
MTUsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX3Rlc3RfaWIoc3RydWN0IHNlcV9maWxl
ICptLCB2b2lkICpkYXRhKQo+ICAJCWt0aHJlYWRfdW5wYXJrKHJpbmctPnNjaGVkLnRocmVhZCk7
Cj4gIAl9Cj4gIAo+IC0JbXV0ZXhfdW5sb2NrKCZhZGV2LT5sb2NrX3Jlc2V0KTsKPiArCXVwX3Jl
YWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShk
ZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZXYtPmRldik7Cj4gQEAg
LTEzOTUsNyArMTM5NSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RlYnVnZnNfaWJfcHJlZW1wdCh2
b2lkICpkYXRhLCB1NjQgdmFsKQo+ICAJCXJldHVybiAtRU5PTUVNOwo+ICAKPiAgCS8qIEF2b2lk
IGFjY2lkZW50bHkgdW5wYXJraW5nIHRoZSBzY2hlZCB0aHJlYWQgZHVyaW5nIEdQVSByZXNldCAq
Lwo+IC0JbXV0ZXhfbG9jaygmYWRldi0+bG9ja19yZXNldCk7Cj4gKwlkb3duX3JlYWQoJmFkZXYt
PnJlc2V0X3NlbSk7Cj4gIAo+ICAJLyogc3RvcCB0aGUgc2NoZWR1bGVyICovCj4gIAlrdGhyZWFk
X3BhcmsocmluZy0+c2NoZWQudGhyZWFkKTsKPiBAQCAtMTQzNiw3ICsxNDM2LDcgQEAgc3RhdGlj
IGludCBhbWRncHVfZGVidWdmc19pYl9wcmVlbXB0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCj4gIAkv
KiByZXN0YXJ0IHRoZSBzY2hlZHVsZXIgKi8KPiAgCWt0aHJlYWRfdW5wYXJrKHJpbmctPnNjaGVk
LnRocmVhZCk7Cj4gIAo+IC0JbXV0ZXhfdW5sb2NrKCZhZGV2LT5sb2NrX3Jlc2V0KTsKPiArCXVw
X3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAo+ICAJdHRtX2JvX3VubG9ja19kZWxheWVkX3dv
cmtxdWV1ZSgmYWRldi0+bW1hbi5iZGV2LCByZXNjaGVkKTsKPiAgCj4gZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYwo+IGluZGV4IDI5MTNlNDFmNjNhNS4uMjdkZDBl
NWY0ZjU4IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9k
ZXZpY2UuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2Uu
Ywo+IEBAIC0xOTI5LDcgKzE5MjksNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZXZpY2VfZndfbG9h
ZGluZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKPiAgCQkJaWYgKGFkZXYtPmlwX2Jsb2Nr
c1tpXS5zdGF0dXMuaHcgPT0gdHJ1ZSkKPiAgCQkJCWJyZWFrOwo+ICAKPiAtCQkJaWYgKGFkZXYt
PmluX2dwdV9yZXNldCB8fCBhZGV2LT5pbl9zdXNwZW5kKSB7Cj4gKwkJCWlmIChhbWRncHVfaW5f
cmVzZXQoYWRldikgfHwgYWRldi0+aW5fc3VzcGVuZCkgewo+ICAJCQkJciA9IGFkZXYtPmlwX2Js
b2Nrc1tpXS52ZXJzaW9uLT5mdW5jcy0+cmVzdW1lKGFkZXYpOwo+ICAJCQkJaWYgKHIpIHsKPiAg
CQkJCQlEUk1fRVJST1IoInJlc3VtZSBvZiBJUCBibG9jayA8JXM+IGZhaWxlZCAlZFxuIiwKPiBA
QCAtMjEwMCw3ICsyMTAwLDcgQEAgc3RhdGljIGJvb2wgYW1kZ3B1X2RldmljZV9jaGVja192cmFt
X2xvc3Qoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCj4gIAkJCUFNREdQVV9SRVNFVF9NQUdJ
Q19OVU0pKQo+ICAJCXJldHVybiB0cnVlOwo+ICAKPiAtCWlmICghYWRldi0+aW5fZ3B1X3Jlc2V0
KQo+ICsJaWYgKCFhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIGZhbHNlOwo+ICAK
PiAgCS8qCj4gQEAgLTMwMjYsNyArMzAyNiw4IEBAIGludCBhbWRncHVfZGV2aWNlX2luaXQoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gIAltdXRleF9pbml0KCZhZGV2LT5tbl9sb2NrKTsK
PiAgCW11dGV4X2luaXQoJmFkZXYtPnZpcnQudmZfZXJyb3JzLmxvY2spOwo+ICAJaGFzaF9pbml0
KGFkZXYtPm1uX2hhc2gpOwo+IC0JbXV0ZXhfaW5pdCgmYWRldi0+bG9ja19yZXNldCk7Cj4gKwlp
bml0X3J3c2VtKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsJYXRvbWljX3NldCgmYWRldi0+aW5fZ3B1
X3Jlc2V0LCAwKTsKPiAgCW11dGV4X2luaXQoJmFkZXYtPnBzcC5tdXRleCk7Cj4gIAltdXRleF9p
bml0KCZhZGV2LT5ub3RpZmllcl9sb2NrKTsKPiAgCj4gQEAgLTQxMzEsMTYgKzQxMzIsMTQgQEAg
c3RhdGljIGludCBhbWRncHVfZG9fYXNpY19yZXNldChzdHJ1Y3QgYW1kZ3B1X2hpdmVfaW5mbyAq
aGl2ZSwKPiAgCXJldHVybiByOwo+ICB9Cj4gIAo+IC1zdGF0aWMgYm9vbCBhbWRncHVfZGV2aWNl
X2xvY2tfYWRldihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgYm9vbCB0cnlsb2NrKQo+ICtz
dGF0aWMgYm9vbCBhbWRncHVfZGV2aWNlX2xvY2tfYWRldihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldikKPiAgewo+IC0JaWYgKHRyeWxvY2spIHsKPiAtCQlpZiAoIW11dGV4X3RyeWxvY2soJmFk
ZXYtPmxvY2tfcmVzZXQpKQo+IC0JCQlyZXR1cm4gZmFsc2U7Cj4gLQl9IGVsc2UKPiAtCQltdXRl
eF9sb2NrKCZhZGV2LT5sb2NrX3Jlc2V0KTsKPiArCWlmIChhdG9taWNfY21weGNoZygmYWRldi0+
aW5fZ3B1X3Jlc2V0LCAwLCAxKSAhPSAwKQo+ICsJCXJldHVybiBmYWxzZTsKPiArCj4gKwlkb3du
X3dyaXRlKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAKPiAgCWF0b21pY19pbmMoJmFkZXYtPmdwdV9y
ZXNldF9jb3VudGVyKTsKPiAtCWFkZXYtPmluX2dwdV9yZXNldCA9IHRydWU7Cj4gIAlzd2l0Y2gg
KGFtZGdwdV9hc2ljX3Jlc2V0X21ldGhvZChhZGV2KSkgewo+ICAJY2FzZSBBTURfUkVTRVRfTUVU
SE9EX01PREUxOgo+ICAJCWFkZXYtPm1wMV9zdGF0ZSA9IFBQX01QMV9TVEFURV9TSFVURE9XTjsK
PiBAQCAtNDE2MCw4ICs0MTU5LDggQEAgc3RhdGljIHZvaWQgYW1kZ3B1X2RldmljZV91bmxvY2tf
YWRldihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKPiAgewo+ICAJYW1kZ3B1X3ZmX2Vycm9y
X3RyYW5zX2FsbChhZGV2KTsKPiAgCWFkZXYtPm1wMV9zdGF0ZSA9IFBQX01QMV9TVEFURV9OT05F
Owo+IC0JYWRldi0+aW5fZ3B1X3Jlc2V0ID0gZmFsc2U7Cj4gLQltdXRleF91bmxvY2soJmFkZXYt
PmxvY2tfcmVzZXQpOwo+ICsJYXRvbWljX3NldCgmYWRldi0+aW5fZ3B1X3Jlc2V0LCAwKTsKPiAr
CXVwX3dyaXRlKCZhZGV2LT5yZXNldF9zZW0pOwo+ICB9Cj4gIAo+ICBzdGF0aWMgdm9pZCBhbWRn
cHVfZGV2aWNlX3Jlc3VtZV9kaXNwbGF5X2F1ZGlvKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KQo+IEBAIC00MjcwLDEyICs0MjY5LDE0IEBAIGludCBhbWRncHVfZGV2aWNlX2dwdV9yZWNvdmVy
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAJICogV2UgYWx3YXlzIHJlc2V0IGFsbCBz
Y2hlZHVsZXJzIGZvciBkZXZpY2UgYW5kIGFsbCBkZXZpY2VzIGZvciBYR01JCj4gIAkgKiBoaXZl
IHNvIHRoYXQgc2hvdWxkIHRha2UgY2FyZSBvZiB0aGVtIHRvby4KPiAgCSAqLwo+IC0JaGl2ZSA9
IGFtZGdwdV9nZXRfeGdtaV9oaXZlKGFkZXYsIHRydWUpOwo+IC0JaWYgKGhpdmUgJiYgIW11dGV4
X3RyeWxvY2soJmhpdmUtPnJlc2V0X2xvY2spKSB7Cj4gLQkJRFJNX0lORk8oIkJhaWxpbmcgb24g
VERSIGZvciBzX2pvYjolbGx4LCBoaXZlOiAlbGx4IGFzIGFub3RoZXIgYWxyZWFkeSBpbiBwcm9n
cmVzcyIsCj4gLQkJCSAgam9iID8gam9iLT5iYXNlLmlkIDogLTEsIGhpdmUtPmhpdmVfaWQpOwo+
IC0JCW11dGV4X3VubG9jaygmaGl2ZS0+aGl2ZV9sb2NrKTsKPiAtCQlyZXR1cm4gMDsKPiArCWhp
dmUgPSBhbWRncHVfZ2V0X3hnbWlfaGl2ZShhZGV2LCBmYWxzZSk7Cj4gKwlpZiAoaGl2ZSkgewo+
ICsJCWlmIChhdG9taWNfY21weGNoZygmaGl2ZS0+aW5fcmVzZXQsIDAsIDEpICE9IDApIHsKPiAr
CQkJRFJNX0lORk8oIkJhaWxpbmcgb24gVERSIGZvciBzX2pvYjolbGx4LCBoaXZlOiAlbGx4IGFz
IGFub3RoZXIgYWxyZWFkeSBpbiBwcm9ncmVzcyIsCj4gKwkJCQlqb2IgPyBqb2ItPmJhc2UuaWQg
OiAtMSwgaGl2ZS0+aGl2ZV9pZCk7Cj4gKwkJCXJldHVybiAwOwo+ICsJCX0KPiArCQltdXRleF9s
b2NrKCZoaXZlLT5oaXZlX2xvY2spOwo+ICAJfQo+ICAKPiAgCS8qCj4gQEAgLTQyOTcsMTEgKzQy
OTgsMTEgQEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1X3JlY292ZXIoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsCj4gIAo+ICAJLyogYmxvY2sgYWxsIHNjaGVkdWxlcnMgYW5kIHJlc2V0IGdpdmVu
IGpvYidzIHJpbmcgKi8KPiAgCWxpc3RfZm9yX2VhY2hfZW50cnkodG1wX2FkZXYsIGRldmljZV9s
aXN0X2hhbmRsZSwgZ21jLnhnbWkuaGVhZCkgewo+IC0JCWlmICghYW1kZ3B1X2RldmljZV9sb2Nr
X2FkZXYodG1wX2FkZXYsICFoaXZlKSkgewo+ICsJCWlmICghYW1kZ3B1X2RldmljZV9sb2NrX2Fk
ZXYodG1wX2FkZXYpKSB7Cj4gIAkJCURSTV9JTkZPKCJCYWlsaW5nIG9uIFREUiBmb3Igc19qb2I6
JWxseCwgYXMgYW5vdGhlciBhbHJlYWR5IGluIHByb2dyZXNzIiwKPiAgCQkJCSAgam9iID8gam9i
LT5iYXNlLmlkIDogLTEpOwo+IC0JCQltdXRleF91bmxvY2soJmhpdmUtPmhpdmVfbG9jayk7Cj4g
LQkJCXJldHVybiAwOwo+ICsJCQlyID0gMDsKPiArCQkJZ290byBza2lwX3JlY292ZXJ5Owo+ICAJ
CX0KPiAgCj4gIAkJLyoKPiBAQCAtNDQzNCw4ICs0NDM1LDkgQEAgaW50IGFtZGdwdV9kZXZpY2Vf
Z3B1X3JlY292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gIAkJYW1kZ3B1X2Rldmlj
ZV91bmxvY2tfYWRldih0bXBfYWRldik7Cj4gIAl9Cj4gIAo+ICtza2lwX3JlY292ZXJ5Ogo+ICAJ
aWYgKGhpdmUpIHsKPiAtCQltdXRleF91bmxvY2soJmhpdmUtPnJlc2V0X2xvY2spOwo+ICsJCWF0
b21pY19zZXQoJmhpdmUtPmluX3Jlc2V0LCAwKTsKPiAgCQltdXRleF91bmxvY2soJmhpdmUtPmhp
dmVfbG9jayk7Cj4gIAl9Cj4gIAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2Vt
LmMKPiBpbmRleCA3N2Q5ODhhMDAzM2YuLjk2ZGYzNjY5YTlkMiAxMDA2NDQKPiAtLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKPiArKysgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKPiBAQCAtNjcwLDYgKzY3MCw4IEBAIGludCBhbWRn
cHVfZ2VtX3ZhX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCj4gIAkJ
Ym9fdmEgPSBOVUxMOwo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsK
PiArCj4gIAlzd2l0Y2ggKGFyZ3MtPm9wZXJhdGlvbikgewo+ICAJY2FzZSBBTURHUFVfVkFfT1Bf
TUFQOgo+ICAJCXZhX2ZsYWdzID0gYW1kZ3B1X2dlbV92YV9tYXBfZmxhZ3MoYWRldiwgYXJncy0+
ZmxhZ3MpOwo+IEBAIC02OTksNiArNzAxLDggQEAgaW50IGFtZGdwdV9nZW1fdmFfaW9jdGwoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKPiAgCQlhbWRncHVfZ2VtX3ZhX3VwZGF0
ZV92bShhZGV2LCAmZnByaXYtPnZtLCBib192YSwKPiAgCQkJCQlhcmdzLT5vcGVyYXRpb24pOwo+
ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICBlcnJvcl9iYWNrb2ZmOgo+
ICAJdHRtX2V1X2JhY2tvZmZfcmVzZXJ2YXRpb24oJnRpY2tldCwgJmxpc3QpOwo+ICAKPiBkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5jCj4gaW5kZXggZDYxMjAzM2EyM2FjLi40
YTNmZTE5MTNiMGEgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2dmeC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5j
Cj4gQEAgLTcxMCw3ICs3MTAsNyBAQCB1aW50MzJfdCBhbWRncHVfa2lxX3JyZWcoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IHJlZykKPiAgCSAqCj4gIAkgKiBhbHNvIGRvbid0
IHdhaXQgYW55bW9yZSBmb3IgSVJRIGNvbnRleHQKPiAgCSAqICovCj4gLQlpZiAociA8IDEgJiYg
KGFkZXYtPmluX2dwdV9yZXNldCB8fCBpbl9pbnRlcnJ1cHQoKSkpCj4gKwlpZiAociA8IDEgJiYg
KGFtZGdwdV9pbl9yZXNldChhZGV2KSB8fCBpbl9pbnRlcnJ1cHQoKSkpCj4gIAkJZ290byBmYWls
ZWRfa2lxX3JlYWQ7Cj4gIAo+ICAJbWlnaHRfc2xlZXAoKTsKPiBAQCAtNzY4LDcgKzc2OCw3IEBA
IHZvaWQgYW1kZ3B1X2tpcV93cmVnKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50MzJf
dCByZWcsIHVpbnQzMl90IHYpCj4gIAkgKgo+ICAJICogYWxzbyBkb24ndCB3YWl0IGFueW1vcmUg
Zm9yIElSUSBjb250ZXh0Cj4gIAkgKiAqLwo+IC0JaWYgKHIgPCAxICYmIChhZGV2LT5pbl9ncHVf
cmVzZXQgfHwgaW5faW50ZXJydXB0KCkpKQo+ICsJaWYgKHIgPCAxICYmIChhbWRncHVfaW5fcmVz
ZXQoYWRldikgfHwgaW5faW50ZXJydXB0KCkpKQo+ICAJCWdvdG8gZmFpbGVkX2tpcV93cml0ZTsK
PiAgCj4gIAltaWdodF9zbGVlcCgpOwo+IEBAIC03ODcsNSArNzg3LDUgQEAgdm9pZCBhbWRncHVf
a2lxX3dyZWcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IHJlZywgdWludDMy
X3QgdikKPiAgCWFtZGdwdV9yaW5nX3VuZG8ocmluZyk7Cj4gIAlzcGluX3VubG9ja19pcnFyZXN0
b3JlKCZraXEtPnJpbmdfbG9jaywgZmxhZ3MpOwo+ICBmYWlsZWRfa2lxX3dyaXRlOgo+IC0JcHJf
ZXJyKCJmYWlsZWQgdG8gd3JpdGUgcmVnOiV4XG4iLCByZWcpOwo+ICsJZGV2X3dhcm4oYWRldi0+
ZGV2LCAiZmFpbGVkIHRvIHdyaXRlIHJlZzoleFxuIiwgcmVnKTsKPiAgfQo+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMKPiBpbmRleCA5MzcwMjlhZDUyNzEuLjllNjhhN2Ri
M2IyNSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9i
LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMKPiBAQCAt
MjIwLDE3ICsyMjAsMTcgQEAgc3RhdGljIHN0cnVjdCBkbWFfZmVuY2UgKmFtZGdwdV9qb2JfcnVu
KHN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2IpCj4gIAo+ICAJdHJhY2VfYW1kZ3B1X3Nj
aGVkX3J1bl9qb2Ioam9iKTsKPiAgCj4gLQlpZiAoam9iLT52cmFtX2xvc3RfY291bnRlciAhPSBh
dG9taWNfcmVhZCgmcmluZy0+YWRldi0+dnJhbV9sb3N0X2NvdW50ZXIpKQo+IC0JCWRtYV9mZW5j
ZV9zZXRfZXJyb3IoZmluaXNoZWQsIC1FQ0FOQ0VMRUQpOy8qIHNraXAgSUIgYXMgd2VsbCBpZiBW
UkFNIGxvc3QgKi8KPiAtCj4gLQlpZiAoZmluaXNoZWQtPmVycm9yIDwgMCkgewo+IC0JCURSTV9J
TkZPKCJTa2lwIHNjaGVkdWxpbmcgSUJzIVxuIik7Cj4gLQl9IGVsc2Ugewo+ICsJaWYgKGRvd25f
cmVhZF90cnlsb2NrKCZyaW5nLT5hZGV2LT5yZXNldF9zZW0pKSB7Cj4gIAkJciA9IGFtZGdwdV9p
Yl9zY2hlZHVsZShyaW5nLCBqb2ItPm51bV9pYnMsIGpvYi0+aWJzLCBqb2IsCj4gLQkJCQkgICAg
ICAgJmZlbmNlKTsKPiArCQkJCQkmZmVuY2UpOwo+ICsJCXVwX3JlYWQoJnJpbmctPmFkZXYtPnJl
c2V0X3NlbSk7Cj4gIAkJaWYgKHIpCj4gIAkJCURSTV9FUlJPUigiRXJyb3Igc2NoZWR1bGluZyBJ
QnMgKCVkKVxuIiwgcik7Cj4gKwl9IGVsc2Ugewo+ICsJCWRtYV9mZW5jZV9zZXRfZXJyb3IoZmlu
aXNoZWQsIC1FQ0FOQ0VMRUQpOyAvKiBza2lwIElCIGluIEdQVSByZXNldCAqLwo+ICsJCURSTV9J
TkZPKCJTa2lwIHNjaGVkdWxpbmcgSUJzIVxuIik7Cj4gIAl9Cj4gKwo+ICAJLyogaWYgZ3B1IHJl
c2V0LCBodyBmZW5jZSB3aWxsIGJlIHJlcGxhY2VkIGhlcmUgKi8KPiAgCWRtYV9mZW5jZV9wdXQo
am9iLT5mZW5jZSk7Cj4gIAlqb2ItPmZlbmNlID0gZG1hX2ZlbmNlX2dldChmZW5jZSk7Cj4gZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwo+IGluZGV4IDljMmM1ZTRlZDFlYi4u
ZWViYmUyMTAzZTMyIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9rbXMuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMu
Ywo+IEBAIC0xMDg0LDYgKzEwODQsOCBAQCB2b2lkIGFtZGdwdV9kcml2ZXJfcG9zdGNsb3NlX2tt
cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAo+ICAJaWYgKCFmcHJpdikKPiAgCQlyZXR1cm47Cj4g
IAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXBtX3J1bnRpbWVfZ2V0
X3N5bmMoZGV2LT5kZXYpOwo+ICAKPiAgCWlmIChhbWRncHVfZGV2aWNlX2lwX2dldF9pcF9ibG9j
ayhhZGV2LCBBTURfSVBfQkxPQ0tfVFlQRV9VVkQpICE9IE5VTEwpCj4gQEAgLTExMjIsNiArMTEy
NCw4IEBAIHZvaWQgYW1kZ3B1X2RyaXZlcl9wb3N0Y2xvc2Vfa21zKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsCj4gIAo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZXYtPmRldik7Cj4gIAlw
bV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZXYtPmRldik7Cj4gKwo+ICsJdXBfcmVhZCgmYWRl
di0+cmVzZXRfc2VtKTsKPiAgfQo+ICAKPiAgLyoKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfcG0uYwo+IGluZGV4IGQyNDAxMzc5YmQzMy4uYTc3ODYyMWVkYzY1IDEwMDY0NAo+IC0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wbS5jCj4gKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3BtLmMKPiBAQCAtMTYzLDcgKzE2Myw3IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcG93ZXJfZHBtX3N0YXRlKHN0cnVjdCBkZXZpY2UgKmRl
diwKPiAgCWVudW0gYW1kX3BtX3N0YXRlX3R5cGUgcG07Cj4gIAlpbnQgcmV0Owo+ICAKPiAtCWlm
IChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJ
CXJldHVybiAtRVBFUk07Cj4gIAo+ICAJcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5k
ZXYpOwo+IEBAIC0xNzIsNiArMTcyLDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wb3dl
cl9kcG1fc3RhdGUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByZXQ7Cj4gIAl9Cj4g
IAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0
X3N3X3NtdShhZGV2KSkgewo+ICAJCWlmIChhZGV2LT5zbXUucHB0X2Z1bmNzLT5nZXRfY3VycmVu
dF9wb3dlcl9zdGF0ZSkKPiAgCQkJcG0gPSBzbXVfZ2V0X2N1cnJlbnRfcG93ZXJfc3RhdGUoJmFk
ZXYtPnNtdSk7Cj4gQEAgLTE4Myw2ICsxODUsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0
X3Bvd2VyX2RwbV9zdGF0ZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAkJcG0gPSBhZGV2LT5wbS5k
cG0udXNlcl9zdGF0ZTsKPiAgCX0KPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRp
bWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0yMDEsNyArMjA1LDcgQEAg
c3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wb3dlcl9kcG1fc3RhdGUoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAJZW51bSBhbWRfcG1fc3RhdGVfdHlwZSAgc3RhdGU7Cj4gIAlpbnQgcmV0Owo+ICAK
PiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYp
KQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJaWYgKHN0cm5jbXAoImJhdHRlcnkiLCBidWYs
IHN0cmxlbigiYmF0dGVyeSIpKSA9PSAwKQo+IEBAIC0yMTksNiArMjIzLDggQEAgc3RhdGljIHNz
aXplX3QgYW1kZ3B1X3NldF9wb3dlcl9kcG1fc3RhdGUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJ
CXJldHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkgewo+ICAJCW11dGV4X2xvY2soJmFk
ZXYtPnBtLm11dGV4KTsKPiAgCQlhZGV2LT5wbS5kcG0udXNlcl9zdGF0ZSA9IHN0YXRlOwo+IEBA
IC0yMzIsNiArMjM4LDkgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wb3dlcl9kcG1fc3Rh
dGUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAKPiAgCQlhbWRncHVfcG1fY29tcHV0ZV9jbG9ja3Mo
YWRldik7Cj4gIAl9Cj4gKwo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlw
bV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9h
dXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+ICAKPiBAQCAtMzA3LDcgKzMxNiw3IEBAIHN0YXRpYyBz
c2l6ZV90IGFtZGdwdV9nZXRfcG93ZXJfZHBtX2ZvcmNlX3BlcmZvcm1hbmNlX2xldmVsKHN0cnVj
dCBkZXZpY2UgKmRldiwKPiAgCWVudW0gYW1kX2RwbV9mb3JjZWRfbGV2ZWwgbGV2ZWwgPSAweGZm
Owo+ICAJaW50IHJldDsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFt
ZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCXJldCA9IHBt
X3J1bnRpbWVfZ2V0X3N5bmMoZGRldi0+ZGV2KTsKPiBAQCAtMzE2LDYgKzMyNSw4IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9nZXRfcG93ZXJfZHBtX2ZvcmNlX3BlcmZvcm1hbmNlX2xldmVsKHN0
cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJfQo+ICAKPiArCWRvd25fcmVh
ZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikp
Cj4gIAkJbGV2ZWwgPSBzbXVfZ2V0X3BlcmZvcm1hbmNlX2xldmVsKCZhZGV2LT5zbXUpOwo+ICAJ
ZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfcGVyZm9ybWFuY2VfbGV2ZWwp
Cj4gQEAgLTMyMyw2ICszMzQsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3Bvd2VyX2Rw
bV9mb3JjZV9wZXJmb3JtYW5jZV9sZXZlbChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4g
IAkJbGV2ZWwgPSBhZGV2LT5wbS5kcG0uZm9yY2VkX2xldmVsOwo+ICAKPiArCXVwX3JlYWQoJmFk
ZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5k
ZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPiAgCj4gQEAg
LTM0OSw3ICszNjIsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3Bvd2VyX2RwbV9mb3Jj
ZV9wZXJmb3JtYW5jZV9sZXZlbChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbnVtIGFtZF9kcG1f
Zm9yY2VkX2xldmVsIGN1cnJlbnRfbGV2ZWwgPSAweGZmOwo+ICAJaW50IHJldCA9IDA7Cj4gIAo+
IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikp
Cj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlpZiAoc3RybmNtcCgibG93IiwgYnVmLCBzdHJs
ZW4oImxvdyIpKSA9PSAwKSB7Cj4gQEAgLTM4MCw2ICszOTMsOCBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfc2V0X3Bvd2VyX2RwbV9mb3JjZV9wZXJmb3JtYW5jZV9sZXZlbChzdHJ1Y3QgZGV2aWNl
ICpkZXYsCj4gIAkJcmV0dXJuIHJldDsKPiAgCX0KPiAgCj4gKwlkb3duX3JlYWQoJmFkZXYtPnJl
c2V0X3NlbSk7Cj4gKwo+ICAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQo+ICAJCWN1cnJl
bnRfbGV2ZWwgPSBzbXVfZ2V0X3BlcmZvcm1hbmNlX2xldmVsKCZhZGV2LT5zbXUpOwo+ICAJZWxz
ZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfcGVyZm9ybWFuY2VfbGV2ZWwpCj4g
QEAgLTM4OCw3ICs0MDMsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3Bvd2VyX2RwbV9m
b3JjZV9wZXJmb3JtYW5jZV9sZXZlbChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAlpZiAoY3VycmVu
dF9sZXZlbCA9PSBsZXZlbCkgewo+ICAJCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+
ZGV2KTsKPiAgCQlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+IC0JCXJl
dHVybiBjb3VudDsKPiArCQlyZXQgPSBjb3VudDsKPiArCQlnb3RvIHByb19lbmQ7Cj4gIAl9Cj4g
IAo+ICAJaWYgKGFkZXYtPmFzaWNfdHlwZSA9PSBDSElQX1JBVkVOKSB7Cj4gQEAgLTQwOSw3ICs0
MjUsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3Bvd2VyX2RwbV9mb3JjZV9wZXJmb3Jt
YW5jZV9sZXZlbChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAkJcHJfZXJyKCJDdXJyZW50bHkgbm90
IGluIGFueSBwcm9maWxlIG1vZGUhXG4iKTsKPiAgCQlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5
KGRkZXYtPmRldik7Cj4gIAkJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsK
PiAtCQlyZXR1cm4gLUVJTlZBTDsKPiArCQlyZXQgPSAtRUlOVkFMOwo+ICsJCWdvdG8gcHJvX2Vu
ZDsKPiAgCX0KPiAgCj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpIHsKPiBAQCAtNDE3
LDcgKzQzNCw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcG93ZXJfZHBtX2ZvcmNlX3Bl
cmZvcm1hbmNlX2xldmVsKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlpZiAocmV0KSB7Cj4gIAkJ
CXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCQkJcG1fcnVudGltZV9w
dXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPiAtCQkJcmV0dXJuIC1FSU5WQUw7Cj4gKwkJCXJl
dCA9IC1FSU5WQUw7Cj4gKwkJCWdvdG8gcHJvX2VuZDsKPiAgCQl9Cj4gIAl9IGVsc2UgaWYgKGFk
ZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Zm9yY2VfcGVyZm9ybWFuY2VfbGV2ZWwpIHsKPiAgCQlt
dXRleF9sb2NrKCZhZGV2LT5wbS5tdXRleCk7Cj4gQEAgLTQyNSwxNCArNDQzLDE2IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9zZXRfcG93ZXJfZHBtX2ZvcmNlX3BlcmZvcm1hbmNlX2xldmVsKHN0
cnVjdCBkZXZpY2UgKmRldiwKPiAgCQkJbXV0ZXhfdW5sb2NrKCZhZGV2LT5wbS5tdXRleCk7Cj4g
IAkJCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCQkJcG1fcnVudGlt
ZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPiAtCQkJcmV0dXJuIC1FSU5WQUw7Cj4gKwkJ
CXJldCA9IC1FSU5WQUw7Cj4gKwkJCWdvdG8gcHJvX2VuZDsKPiAgCQl9Cj4gIAkJcmV0ID0gYW1k
Z3B1X2RwbV9mb3JjZV9wZXJmb3JtYW5jZV9sZXZlbChhZGV2LCBsZXZlbCk7Cj4gIAkJaWYgKHJl
dCkgewo+ICAJCQltdXRleF91bmxvY2soJmFkZXYtPnBtLm11dGV4KTsKPiAgCQkJcG1fcnVudGlt
ZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAJCQlwbV9ydW50aW1lX3B1dF9hdXRvc3Vz
cGVuZChkZGV2LT5kZXYpOwo+IC0JCQlyZXR1cm4gLUVJTlZBTDsKPiArCQkJcmV0ID0gLUVJTlZB
TDsKPiArCQkJZ290byBwcm9fZW5kOwo+ICAJCX0gZWxzZSB7Cj4gIAkJCWFkZXYtPnBtLmRwbS5m
b3JjZWRfbGV2ZWwgPSBsZXZlbDsKPiAgCQl9Cj4gQEAgLTQ0MSw3ICs0NjEsOSBAQCBzdGF0aWMg
c3NpemVfdCBhbWRncHVfc2V0X3Bvd2VyX2RwbV9mb3JjZV9wZXJmb3JtYW5jZV9sZXZlbChzdHJ1
Y3QgZGV2aWNlICpkZXYsCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7
Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+ICAKPiAtCXJldHVy
biBjb3VudDsKPiArcHJvX2VuZDoKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwly
ZXR1cm4gcmV0Owo+ICB9Cj4gIAo+ICBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX251bV9z
dGF0ZXMoc3RydWN0IGRldmljZSAqZGV2LAo+IEBAIC00NTMsNyArNDc1LDcgQEAgc3RhdGljIHNz
aXplX3QgYW1kZ3B1X2dldF9wcF9udW1fc3RhdGVzKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXN0
cnVjdCBwcF9zdGF0ZXNfaW5mbyBkYXRhOwo+ICAJaW50IGksIGJ1Zl9sZW4sIHJldDsKPiAgCj4g
LQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkK
PiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCXJldCA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGRl
di0+ZGV2KTsKPiBAQCAtNDk3LDcgKzUxOSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRf
cHBfY3VyX3N0YXRlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWVudW0gYW1kX3BtX3N0YXRlX3R5
cGUgcG0gPSAwOwo+ICAJaW50IGkgPSAwLCByZXQgPSAwOwo+ICAKPiAtCWlmIChhZGV2LT5pbl9n
cHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRVBF
Uk07Cj4gIAo+ICAJcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5kZXYpOwo+IEBAIC01
MzgsNyArNTYwLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9mb3JjZV9zdGF0ZShz
dHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGRldiA9IGRldl9nZXRf
ZHJ2ZGF0YShkZXYpOwo+ICAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBkZGV2LT5kZXZf
cHJpdmF0ZTsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9p
bl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCWlmIChhZGV2LT5wcF9m
b3JjZV9zdGF0ZV9lbmFibGVkKQo+IEBAIC01NTgsNyArNTgwLDcgQEAgc3RhdGljIHNzaXplX3Qg
YW1kZ3B1X3NldF9wcF9mb3JjZV9zdGF0ZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAl1bnNpZ25l
ZCBsb25nIGlkeDsKPiAgCWludCByZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkK
PiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4g
IAlpZiAoc3RybGVuKGJ1ZikgPT0gMSkKPiBAQCAtNTg0LDYgKzYwNiw3IEBAIHN0YXRpYyBzc2l6
ZV90IGFtZGdwdV9zZXRfcHBfZm9yY2Vfc3RhdGUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCQly
ZXR1cm4gcmV0Owo+ICAJCX0KPiAgCj4gKwkJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
ICAJCS8qIG9ubHkgc2V0IHVzZXIgc2VsZWN0ZWQgcG93ZXIgc3RhdGVzICovCj4gIAkJaWYgKHN0
YXRlICE9IFBPV0VSX1NUQVRFX1RZUEVfSU5URVJOQUxfQk9PVCAmJgo+ICAJCSAgICBzdGF0ZSAh
PSBQT1dFUl9TVEFURV9UWVBFX0RFRkFVTFQpIHsKPiBAQCAtNTkxLDYgKzYxNCw4IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfZm9yY2Vfc3RhdGUoc3RydWN0IGRldmljZSAqZGV2LAo+
ICAJCQkJCUFNRF9QUF9UQVNLX0VOQUJMRV9VU0VSX1NUQVRFLCAmc3RhdGUpOwo+ICAJCQlhZGV2
LT5wcF9mb3JjZV9zdGF0ZV9lbmFibGVkID0gdHJ1ZTsKPiAgCQl9Cj4gKwkJdXBfcmVhZCgmYWRl
di0+cmVzZXRfc2VtKTsKPiArCj4gIAkJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5k
ZXYpOwo+ICAJCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAl9Cj4g
QEAgLTYxOCw3ICs2NDMsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX3RhYmxlKHN0
cnVjdCBkZXZpY2UgKmRldiwKPiAgCWNoYXIgKnRhYmxlID0gTlVMTDsKPiAgCWludCBzaXplLCBy
ZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVz
ZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlyZXQgPSBwbV9ydW50aW1lX2dl
dF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTY2Miw3ICs2ODcsNyBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfc2V0X3BwX3RhYmxlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2ID0gZGRldi0+ZGV2X3ByaXZhdGU7Cj4gIAlpbnQgcmV0ID0gMDsKPiAgCj4g
LQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkK
PiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCXJldCA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGRl
di0+ZGV2KTsKPiBAQCAtNjcxLDE2ICs2OTYsMjEgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3Nl
dF9wcF90YWJsZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAkJcmV0dXJuIHJldDsKPiAgCX0KPiAg
Cj4gKwlkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJaWYgKGlzX3N1cHBvcnRf
c3dfc211KGFkZXYpKSB7Cj4gIAkJcmV0ID0gc211X3N5c19zZXRfcHBfdGFibGUoJmFkZXYtPnNt
dSwgKHZvaWQgKilidWYsIGNvdW50KTsKPiAgCQlpZiAocmV0KSB7Cj4gIAkJCXBtX3J1bnRpbWVf
bWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCQkJcG1fcnVudGltZV9wdXRfYXV0b3N1c3Bl
bmQoZGRldi0+ZGV2KTsKPiArCQkJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgCQkJcmV0
dXJuIHJldDsKPiAgCQl9Cj4gIAl9IGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+
c2V0X3BwX3RhYmxlKQo+ICAJCWFtZGdwdV9kcG1fc2V0X3BwX3RhYmxlKGFkZXYsIGJ1ZiwgY291
bnQpOwo+ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVudGlt
ZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3Bl
bmQoZGRldi0+ZGV2KTsKPiAgCj4gQEAgLTc2OSw3ICs3OTksNyBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfc2V0X3BwX29kX2Nsa192b2x0YWdlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWNvbnN0
IGNoYXIgZGVsaW1pdGVyWzNdID0geycgJywgJ1xuJywgJ1wwJ307Cj4gIAl1aW50MzJfdCB0eXBl
Owo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0
KGFkZXYpKQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJaWYgKGNvdW50ID4gMTI3KQo+IEBA
IC04MTMsNiArODQzLDEwIEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfb2RfY2xrX3Zv
bHRhZ2Uoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJ
cmV0ID0gY291bnQ7Cj4gKwo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAg
CWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkgewo+ICAJCXJldCA9IHNtdV9vZF9lZGl0X2Rw
bV90YWJsZSgmYWRldi0+c211LCB0eXBlLAo+ICAJCQkJCSAgICBwYXJhbWV0ZXIsIHBhcmFtZXRl
cl9zaXplKTsKPiBAQCAtODIwLDcgKzg1NCw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRf
cHBfb2RfY2xrX3ZvbHRhZ2Uoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCWlmIChyZXQpIHsKPiAg
CQkJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAJCQlwbV9ydW50aW1l
X3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+IC0JCQlyZXR1cm4gLUVJTlZBTDsKPiArCQkJ
cmV0ID0gLUVJTlZBTDsKPiArCQkJZ290byBwcm9fZW5kOwo+ICAJCX0KPiAgCX0gZWxzZSB7Cj4g
IAkJaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+b2RuX2VkaXRfZHBtX3RhYmxlKSB7Cj4g
QEAgLTgyOSw3ICs4NjQsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX29kX2Nsa192
b2x0YWdlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQkJaWYgKHJldCkgewo+ICAJCQkJcG1fcnVu
dGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAJCQkJcG1fcnVudGltZV9wdXRfYXV0
b3N1c3BlbmQoZGRldi0+ZGV2KTsKPiAtCQkJCXJldHVybiAtRUlOVkFMOwo+ICsJCQkJcmV0ID0g
LUVJTlZBTDsKPiArCQkJCWdvdG8gcHJvX2VuZDsKPiAgCQkJfQo+ICAJCX0KPiAgCj4gQEAgLTg0
MCwxOCArODc2LDIyIEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfb2RfY2xrX3ZvbHRh
Z2Uoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCQkJCQlOVUxMKTsKPiAgCQkJCXBtX3J1bnRpbWVf
bWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCQkJCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNw
ZW5kKGRkZXYtPmRldik7Cj4gLQkJCQlyZXR1cm4gY291bnQ7Cj4gKwkJCQlyZXQgPSBjb3VudDsK
PiArCQkJCWdvdG8gcHJvX2VuZDsKPiAgCQkJfSBlbHNlIHsKPiAgCQkJCXBtX3J1bnRpbWVfbWFy
a19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCQkJCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5k
KGRkZXYtPmRldik7Cj4gLQkJCQlyZXR1cm4gLUVJTlZBTDsKPiArCQkJCXJldCA9IC1FSU5WQUw7
Cj4gKwkJCQlnb3RvIHByb19lbmQ7Cj4gIAkJCX0KPiAgCQl9Cj4gIAl9Cj4gIAlwbV9ydW50aW1l
X21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVu
ZChkZGV2LT5kZXYpOwo+ICAKPiAtCXJldHVybiBjb3VudDsKPiArcHJvX2VuZDoKPiArCXVwX3Jl
YWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwlyZXR1cm4gcmV0Owo+ICB9Cj4gIAo+ICBzdGF0aWMg
c3NpemVfdCBhbWRncHVfZ2V0X3BwX29kX2Nsa192b2x0YWdlKHN0cnVjdCBkZXZpY2UgKmRldiwK
PiBAQCAtODYzLDcgKzkwMyw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfb2RfY2xr
X3ZvbHRhZ2Uoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJc3NpemVfdCBzaXplOwo+ICAJaW50IHJl
dDsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNl
dChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCXJldCA9IHBtX3J1bnRpbWVfZ2V0
X3N5bmMoZGRldi0+ZGV2KTsKPiBAQCAtOTE3LDcgKzk1Nyw3IEBAIHN0YXRpYyBzc2l6ZV90IGFt
ZGdwdV9zZXRfcHBfZmVhdHVyZXMoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJdWludDY0X3QgZmVh
dHVyZW1hc2s7Cj4gIAlpbnQgcmV0Owo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4g
KwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJ
cmV0ID0ga3N0cnRvdTY0KGJ1ZiwgMCwgJmZlYXR1cmVtYXNrKTsKPiBAQCAtOTMyLDExICs5NzIs
MTMgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9mZWF0dXJlcyhzdHJ1Y3QgZGV2aWNl
ICpkZXYsCj4gIAkJcmV0dXJuIHJldDsKPiAgCX0KPiAgCj4gKwlkb3duX3JlYWQoJmFkZXYtPnJl
c2V0X3NlbSk7Cj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpIHsKPiAgCQlyZXQgPSBz
bXVfc3lzX3NldF9wcF9mZWF0dXJlX21hc2soJmFkZXYtPnNtdSwgZmVhdHVyZW1hc2spOwo+ICAJ
CWlmIChyZXQpIHsKPiAgCQkJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+
ICAJCQlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+ICsJCQl1cF9yZWFk
KCZhZGV2LT5yZXNldF9zZW0pOwo+ICAJCQlyZXR1cm4gLUVJTlZBTDsKPiAgCQl9Cj4gIAl9IGVs
c2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+c2V0X3BwZmVhdHVyZV9zdGF0dXMpIHsK
PiBAQCAtOTQ0LDkgKzk4NiwxMiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2ZlYXR1
cmVzKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlpZiAocmV0KSB7Cj4gIAkJCXBtX3J1bnRpbWVf
bWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCQkJcG1fcnVudGltZV9wdXRfYXV0b3N1c3Bl
bmQoZGRldi0+ZGV2KTsKPiArCQkJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgCQkJcmV0
dXJuIC1FSU5WQUw7Cj4gIAkJfQo+ICAJfQo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsK
PiArCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gIAlwbV9ydW50
aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+ICAKPiBAQCAtOTYyLDcgKzEwMDcsNyBA
QCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX2ZlYXR1cmVzKHN0cnVjdCBkZXZpY2UgKmRl
diwKPiAgCXNzaXplX3Qgc2l6ZTsKPiAgCWludCByZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dw
dV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVS
TTsKPiAgCj4gIAlyZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTk3
MSw2ICsxMDE2LDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9mZWF0dXJlcyhzdHJ1
Y3QgZGV2aWNlICpkZXYsCj4gIAkJcmV0dXJuIHJldDsKPiAgCX0KPiAgCj4gKwlkb3duX3JlYWQo
JmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQo+
ICAJCXNpemUgPSBzbXVfc3lzX2dldF9wcF9mZWF0dXJlX21hc2soJmFkZXYtPnNtdSwgYnVmKTsK
PiAgCWVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Z2V0X3BwZmVhdHVyZV9zdGF0
dXMpCj4gQEAgLTk3OCw2ICsxMDI1LDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9m
ZWF0dXJlcyhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4gIAkJc2l6ZSA9IHNucHJpbnRm
KGJ1ZiwgUEFHRV9TSVpFLCAiXG4iKTsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0p
Owo+ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1
bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xMDIzLDcgKzEwNzIs
NyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX2RwbV9zY2xrKHN0cnVjdCBkZXZpY2Ug
KmRldiwKPiAgCXNzaXplX3Qgc2l6ZTsKPiAgCWludCByZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmlu
X2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1F
UEVSTTsKPiAgCj4gIAlyZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAg
LTEwMzIsNiArMTA4MSw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZHBtX3NjbGso
c3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93bl9y
ZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2
KSkKPiAgCQlzaXplID0gc211X3ByaW50X2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX1NDTEss
IGJ1Zik7Cj4gIAllbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPnByaW50X2Nsb2Nr
X2xldmVscykKPiBAQCAtMTAzOSw2ICsxMDkwLDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dl
dF9wcF9kcG1fc2NsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4gIAkJc2l6ZSA9IHNu
cHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiXG4iKTsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNl
dF9zZW0pOwo+ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAg
CXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xMDkxLDcg
KzExNDQsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9zY2xrKHN0cnVjdCBk
ZXZpY2UgKmRldiwKPiAgCWludCByZXQ7Cj4gIAl1aW50MzJfdCBtYXNrID0gMDsKPiAgCj4gLQlp
ZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAg
CQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCXJldCA9IGFtZGdwdV9yZWFkX21hc2soYnVmLCBjb3Vu
dCwgJm1hc2spOwo+IEBAIC0xMTA0LDExICsxMTU3LDE1IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdw
dV9zZXRfcHBfZHBtX3NjbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByZXQ7Cj4g
IAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19z
dXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgCQlyZXQgPSBzbXVfZm9yY2VfY2xrX2xldmVscygmYWRl
di0+c211LCBTTVVfU0NMSywgbWFzaywgdHJ1ZSk7Cj4gIAllbHNlIGlmIChhZGV2LT5wb3dlcnBs
YXkucHBfZnVuY3MtPmZvcmNlX2Nsb2NrX2xldmVsKQo+ICAJCXJldCA9IGFtZGdwdV9kcG1fZm9y
Y2VfY2xvY2tfbGV2ZWwoYWRldiwgUFBfU0NMSywgbWFzayk7Cj4gIAo+ICsJdXBfcmVhZCgmYWRl
di0+cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRl
dik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+ICAKPiBAQCAt
MTEyNyw3ICsxMTg0LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9kcG1fbWNsayhz
dHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAlzc2l6ZV90IHNpemU7Cj4gIAlpbnQgcmV0Owo+ICAKPiAt
CWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+
ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2
LT5kZXYpOwo+IEBAIC0xMTM2LDYgKzExOTMsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0
X3BwX2RwbV9tY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJfQo+
ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3VwcG9y
dF9zd19zbXUoYWRldikpCj4gIAkJc2l6ZSA9IHNtdV9wcmludF9jbGtfbGV2ZWxzKCZhZGV2LT5z
bXUsIFNNVV9NQ0xLLCBidWYpOwo+ICAJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNz
LT5wcmludF9jbG9ja19sZXZlbHMpCj4gQEAgLTExNDMsNiArMTIwMiw4IEBAIHN0YXRpYyBzc2l6
ZV90IGFtZGdwdV9nZXRfcHBfZHBtX21jbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJZWxzZQo+
ICAJCXNpemUgPSBzbnByaW50ZihidWYsIFBBR0VfU0laRSwgIlxuIik7Cj4gIAo+ICsJdXBfcmVh
ZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRk
ZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+ICAK
PiBAQCAtMTE1OSw3ICsxMjIwLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1f
bWNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAl1aW50MzJfdCBtYXNrID0gMDsKPiAgCWludCBy
ZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVz
ZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlyZXQgPSBhbWRncHVfcmVhZF9t
YXNrKGJ1ZiwgY291bnQsICZtYXNrKTsKPiBAQCAtMTE3MiwxMSArMTIzMywxNSBAQCBzdGF0aWMg
c3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9tY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQly
ZXR1cm4gcmV0Owo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAr
Cj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpCj4gIAkJcmV0ID0gc211X2ZvcmNlX2Ns
a19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX01DTEssIG1hc2ssIHRydWUpOwo+ICAJZWxzZSBpZiAo
YWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5mb3JjZV9jbG9ja19sZXZlbCkKPiAgCQlyZXQgPSBh
bWRncHVfZHBtX2ZvcmNlX2Nsb2NrX2xldmVsKGFkZXYsIFBQX01DTEssIG1hc2spOwo+ICAKPiAr
CXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3Rf
YnVzeShkZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2
KTsKPiAgCj4gQEAgLTExOTUsNyArMTI2MCw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRf
cHBfZHBtX3NvY2NsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAlzc2l6ZV90IHNpemU7Cj4gIAlp
bnQgcmV0Owo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2lu
X3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJcmV0ID0gcG1fcnVudGlt
ZV9nZXRfc3luYyhkZGV2LT5kZXYpOwo+IEBAIC0xMjA0LDYgKzEyNjksOCBAQCBzdGF0aWMgc3Np
emVfdCBhbWRncHVfZ2V0X3BwX2RwbV9zb2NjbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJl
dHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsK
PiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgCQlzaXplID0gc211X3ByaW50X2Ns
a19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX1NPQ0NMSywgYnVmKTsKPiAgCWVsc2UgaWYgKGFkZXYt
PnBvd2VycGxheS5wcF9mdW5jcy0+cHJpbnRfY2xvY2tfbGV2ZWxzKQo+IEBAIC0xMjExLDYgKzEy
NzgsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX2RwbV9zb2NjbGsoc3RydWN0IGRl
dmljZSAqZGV2LAo+ICAJZWxzZQo+ICAJCXNpemUgPSBzbnByaW50ZihidWYsIFBBR0VfU0laRSwg
IlxuIik7Cj4gIAo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50
aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3Vz
cGVuZChkZGV2LT5kZXYpOwo+ICAKPiBAQCAtMTIyNyw3ICsxMjk2LDcgQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X3NldF9wcF9kcG1fc29jY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWludCBy
ZXQ7Cj4gIAl1aW50MzJfdCBtYXNrID0gMDsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0
KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAK
PiAgCXJldCA9IGFtZGdwdV9yZWFkX21hc2soYnVmLCBjb3VudCwgJm1hc2spOwo+IEBAIC0xMjQw
LDYgKzEzMDksOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9zb2NjbGsoc3Ry
dWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFk
KCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkK
PiAgCQlyZXQgPSBzbXVfZm9yY2VfY2xrX2xldmVscygmYWRldi0+c211LCBTTVVfU09DQ0xLLCBt
YXNrLCB0cnVlKTsKPiAgCWVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Zm9yY2Vf
Y2xvY2tfbGV2ZWwpCj4gQEAgLTEyNDcsNiArMTMxOCw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdw
dV9zZXRfcHBfZHBtX3NvY2NsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4gIAkJcmV0
ID0gMDsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXBtX3J1bnRp
bWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNw
ZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xMjY1LDcgKzEzMzgsNyBAQCBzdGF0aWMgc3NpemVf
dCBhbWRncHVfZ2V0X3BwX2RwbV9mY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXNzaXplX3Qg
c2l6ZTsKPiAgCWludCByZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlm
IChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlyZXQg
PSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTEyNzQsNiArMTM0Nyw4IEBA
IHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZHBtX2ZjbGsoc3RydWN0IGRldmljZSAqZGV2
LAo+ICAJCXJldHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9z
ZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgCQlzaXplID0gc211
X3ByaW50X2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX0ZDTEssIGJ1Zik7Cj4gIAllbHNlIGlm
IChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPnByaW50X2Nsb2NrX2xldmVscykKPiBAQCAtMTI4
MSw2ICsxMzU2LDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9kcG1fZmNsayhzdHJ1
Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4gIAkJc2l6ZSA9IHNucHJpbnRmKGJ1ZiwgUEFHRV9T
SVpFLCAiXG4iKTsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXBt
X3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRpbWVfcHV0X2F1
dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xMjk3LDcgKzEzNzQsNyBAQCBzdGF0aWMg
c3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9mY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWlu
dCByZXQ7Cj4gIAl1aW50MzJfdCBtYXNrID0gMDsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jl
c2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+
ICAKPiAgCXJldCA9IGFtZGdwdV9yZWFkX21hc2soYnVmLCBjb3VudCwgJm1hc2spOwo+IEBAIC0x
MzEwLDYgKzEzODcsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9mY2xrKHN0
cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJfQo+ICAKPiArCWRvd25fcmVh
ZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikp
Cj4gIAkJcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX0ZDTEssIG1h
c2ssIHRydWUpOwo+ICAJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5mb3JjZV9j
bG9ja19sZXZlbCkKPiBAQCAtMTMxNyw2ICsxMzk2LDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1
X3NldF9wcF9kcG1fZmNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4gIAkJcmV0ID0g
MDsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXBtX3J1bnRpbWVf
bWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5k
KGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xMzM1LDcgKzE0MTYsNyBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfZ2V0X3BwX2RwbV9kY2VmY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXNzaXplX3Qg
c2l6ZTsKPiAgCWludCByZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlm
IChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlyZXQg
PSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTEzNDQsNiArMTQyNSw4IEBA
IHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZHBtX2RjZWZjbGsoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAJCXJldHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNl
dF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgCQlzaXplID0g
c211X3ByaW50X2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX0RDRUZDTEssIGJ1Zik7Cj4gIAll
bHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPnByaW50X2Nsb2NrX2xldmVscykKPiBA
QCAtMTM1MSw2ICsxNDM0LDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9kcG1fZGNl
ZmNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4gIAkJc2l6ZSA9IHNucHJpbnRmKGJ1
ZiwgUEFHRV9TSVpFLCAiXG4iKTsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRp
bWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xMzY3LDcgKzE0NTIsNyBA
QCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9kY2VmY2xrKHN0cnVjdCBkZXZpY2Ug
KmRldiwKPiAgCWludCByZXQ7Cj4gIAl1aW50MzJfdCBtYXNrID0gMDsKPiAgCj4gLQlpZiAoYWRl
di0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1
cm4gLUVQRVJNOwo+ICAKPiAgCXJldCA9IGFtZGdwdV9yZWFkX21hc2soYnVmLCBjb3VudCwgJm1h
c2spOwo+IEBAIC0xMzgwLDYgKzE0NjUsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3Bw
X2RwbV9kY2VmY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJfQo+
ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3VwcG9y
dF9zd19zbXUoYWRldikpCj4gIAkJcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNt
dSwgU01VX0RDRUZDTEssIG1hc2ssIHRydWUpOwo+ICAJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5
LnBwX2Z1bmNzLT5mb3JjZV9jbG9ja19sZXZlbCkKPiBAQCAtMTM4Nyw2ICsxNDc0LDggQEAgc3Rh
dGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fZGNlZmNsayhzdHJ1Y3QgZGV2aWNlICpkZXYs
Cj4gIAllbHNlCj4gIAkJcmV0ID0gMDsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0p
Owo+ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1
bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xNDA1LDcgKzE0OTQs
NyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX2RwbV9wY2llKHN0cnVjdCBkZXZpY2Ug
KmRldiwKPiAgCXNzaXplX3Qgc2l6ZTsKPiAgCWludCByZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmlu
X2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1F
UEVSTTsKPiAgCj4gIAlyZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAg
LTE0MTQsNiArMTUwMyw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZHBtX3BjaWUo
c3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93bl9y
ZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2
KSkKPiAgCQlzaXplID0gc211X3ByaW50X2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX1BDSUUs
IGJ1Zik7Cj4gIAllbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPnByaW50X2Nsb2Nr
X2xldmVscykKPiBAQCAtMTQyMSw2ICsxNTEyLDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dl
dF9wcF9kcG1fcGNpZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4gIAkJc2l6ZSA9IHNu
cHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiXG4iKTsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNl
dF9zZW0pOwo+ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAg
CXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xNDM3LDcg
KzE1MzAsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9wY2llKHN0cnVjdCBk
ZXZpY2UgKmRldiwKPiAgCWludCByZXQ7Cj4gIAl1aW50MzJfdCBtYXNrID0gMDsKPiAgCj4gLQlp
ZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAg
CQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCXJldCA9IGFtZGdwdV9yZWFkX21hc2soYnVmLCBjb3Vu
dCwgJm1hc2spOwo+IEBAIC0xNDUwLDYgKzE1NDMsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVf
c2V0X3BwX2RwbV9wY2llKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJ
fQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3Vw
cG9ydF9zd19zbXUoYWRldikpCj4gIAkJcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYt
PnNtdSwgU01VX1BDSUUsIG1hc2ssIHRydWUpOwo+ICAJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5
LnBwX2Z1bmNzLT5mb3JjZV9jbG9ja19sZXZlbCkKPiBAQCAtMTQ1Nyw2ICsxNTUyLDggQEAgc3Rh
dGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fcGNpZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4g
IAllbHNlCj4gIAkJcmV0ID0gMDsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRp
bWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xNDc1LDcgKzE1NzIsNyBA
QCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX3NjbGtfb2Qoc3RydWN0IGRldmljZSAqZGV2
LAo+ICAJdWludDMyX3QgdmFsdWUgPSAwOwo+ICAJaW50IHJldDsKPiAgCj4gLQlpZiAoYWRldi0+
aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4g
LUVQRVJNOwo+ICAKPiAgCXJldCA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGRldi0+ZGV2KTsKPiBA
QCAtMTQ4NCwxMSArMTU4MSwxNSBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX3NjbGtf
b2Qoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93
bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShh
ZGV2KSkKPiAgCQl2YWx1ZSA9IHNtdV9nZXRfb2RfcGVyY2VudGFnZSgmKGFkZXYtPnNtdSksIFNN
VV9PRF9TQ0xLKTsKPiAgCWVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Z2V0X3Nj
bGtfb2QpCj4gIAkJdmFsdWUgPSBhbWRncHVfZHBtX2dldF9zY2xrX29kKGFkZXYpOwo+ICAKPiAr
CXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3Rf
YnVzeShkZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2
KTsKPiAgCj4gQEAgLTE1MDUsNyArMTYwNiw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRf
cHBfc2Nsa19vZChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAlpbnQgcmV0Owo+ICAJbG9uZyBpbnQg
dmFsdWU7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5f
cmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlyZXQgPSBrc3RydG9sKGJ1
ZiwgMCwgJnZhbHVlKTsKPiBAQCAtMTUxOSw2ICsxNjIwLDggQEAgc3RhdGljIHNzaXplX3QgYW1k
Z3B1X3NldF9wcF9zY2xrX29kKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+
ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNf
c3VwcG9ydF9zd19zbXUoYWRldikpIHsKPiAgCQl2YWx1ZSA9IHNtdV9zZXRfb2RfcGVyY2VudGFn
ZSgmKGFkZXYtPnNtdSksIFNNVV9PRF9TQ0xLLCAodWludDMyX3QpdmFsdWUpOwo+ICAJfSBlbHNl
IHsKPiBAQCAtMTUzMyw2ICsxNjM2LDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9z
Y2xrX29kKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQl9Cj4gIAl9Cj4gIAo+ICsJdXBfcmVhZCgm
YWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYt
PmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+ICAKPiBA
QCAtMTU0OCw3ICsxNjUzLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9tY2xrX29k
KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXVpbnQzMl90IHZhbHVlID0gMDsKPiAgCWludCByZXQ7
Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQo
YWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlyZXQgPSBwbV9ydW50aW1lX2dldF9z
eW5jKGRkZXYtPmRldik7Cj4gQEAgLTE1NTcsMTEgKzE2NjIsMTUgQEAgc3RhdGljIHNzaXplX3Qg
YW1kZ3B1X2dldF9wcF9tY2xrX29kKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0
Owo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAo
aXNfc3VwcG9ydF9zd19zbXUoYWRldikpCj4gIAkJdmFsdWUgPSBzbXVfZ2V0X29kX3BlcmNlbnRh
Z2UoJihhZGV2LT5zbXUpLCBTTVVfT0RfTUNMSyk7Cj4gIAllbHNlIGlmIChhZGV2LT5wb3dlcnBs
YXkucHBfZnVuY3MtPmdldF9tY2xrX29kKQo+ICAJCXZhbHVlID0gYW1kZ3B1X2RwbV9nZXRfbWNs
a19vZChhZGV2KTsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXBt
X3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRpbWVfcHV0X2F1
dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gIAo+IEBAIC0xNTc4LDcgKzE2ODcsNyBAQCBzdGF0aWMg
c3NpemVfdCBhbWRncHVfc2V0X3BwX21jbGtfb2Qoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJaW50
IHJldDsKPiAgCWxvbmcgaW50IHZhbHVlOwo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQp
Cj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+
ICAJcmV0ID0ga3N0cnRvbChidWYsIDAsICZ2YWx1ZSk7Cj4gQEAgLTE1OTIsNiArMTcwMSw4IEBA
IHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfbWNsa19vZChzdHJ1Y3QgZGV2aWNlICpkZXYs
Cj4gIAkJcmV0dXJuIHJldDsKPiAgCX0KPiAgCj4gKwlkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3Nl
bSk7Cj4gKwo+ICAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKSB7Cj4gIAkJdmFsdWUgPSBz
bXVfc2V0X29kX3BlcmNlbnRhZ2UoJihhZGV2LT5zbXUpLCBTTVVfT0RfTUNMSywgKHVpbnQzMl90
KXZhbHVlKTsKPiAgCX0gZWxzZSB7Cj4gQEAgLTE2MDYsNiArMTcxNyw4IEBAIHN0YXRpYyBzc2l6
ZV90IGFtZGdwdV9zZXRfcHBfbWNsa19vZChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAkJfQo+ICAJ
fQo+ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVudGltZV9t
YXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQo
ZGRldi0+ZGV2KTsKPiAgCj4gQEAgLTE2NDEsNyArMTc1NCw3IEBAIHN0YXRpYyBzc2l6ZV90IGFt
ZGdwdV9nZXRfcHBfcG93ZXJfcHJvZmlsZV9tb2RlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXNz
aXplX3Qgc2l6ZTsKPiAgCWludCByZXQ7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkK
PiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4g
IAlyZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTE2NTAsNiArMTc2
Myw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfcG93ZXJfcHJvZmlsZV9tb2RlKHN0
cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJfQo+ICAKPiArCWRvd25fcmVh
ZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikp
Cj4gIAkJc2l6ZSA9IHNtdV9nZXRfcG93ZXJfcHJvZmlsZV9tb2RlKCZhZGV2LT5zbXUsIGJ1Zik7
Cj4gIAllbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9wb3dlcl9wcm9maWxl
X21vZGUpCj4gQEAgLTE2NTcsNiArMTc3Miw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRf
cHBfcG93ZXJfcHJvZmlsZV9tb2RlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWVsc2UKPiAgCQlz
aXplID0gc25wcmludGYoYnVmLCBQQUdFX1NJWkUsICJcbiIpOwo+ICAKPiArCXVwX3JlYWQoJmFk
ZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5k
ZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPiAgCj4gQEAg
LTE2ODEsNyArMTc5OCw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfcG93ZXJfcHJv
ZmlsZV9tb2RlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWxvbmcgaW50IHByb2ZpbGVfbW9kZSA9
IDA7Cj4gIAljb25zdCBjaGFyIGRlbGltaXRlclszXSA9IHsnICcsICdcbicsICdcMCd9Owo+ICAK
PiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYp
KQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJdG1wWzBdID0gKihidWYpOwo+IEBAIC0xNzE1
LDExICsxODMyLDE1IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfcG93ZXJfcHJvZmls
ZV9tb2RlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJfQo+ICAKPiAr
CWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3VwcG9ydF9zd19z
bXUoYWRldikpCj4gIAkJcmV0ID0gc211X3NldF9wb3dlcl9wcm9maWxlX21vZGUoJmFkZXYtPnNt
dSwgcGFyYW1ldGVyLCBwYXJhbWV0ZXJfc2l6ZSwgdHJ1ZSk7Cj4gIAllbHNlIGlmIChhZGV2LT5w
b3dlcnBsYXkucHBfZnVuY3MtPnNldF9wb3dlcl9wcm9maWxlX21vZGUpCj4gIAkJcmV0ID0gYW1k
Z3B1X2RwbV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKGFkZXYsIHBhcmFtZXRlciwgcGFyYW1ldGVy
X3NpemUpOwo+ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVu
dGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1
c3BlbmQoZGRldi0+ZGV2KTsKPiAgCj4gQEAgLTE3NDUsNyArMTg2Niw3IEBAIHN0YXRpYyBzc2l6
ZV90IGFtZGdwdV9nZXRfZ3B1X2J1c3lfcGVyY2VudChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAlz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRkZXYtPmRldl9wcml2YXRlOwo+ICAJaW50IHIs
IHZhbHVlLCBzaXplID0gc2l6ZW9mKHZhbHVlKTsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jl
c2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+
ICAKPiAgCXIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTE3NTQsOSAr
MTg3NSwxMSBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X2dwdV9idXN5X3BlcmNlbnQoc3Ry
dWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByOwo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgm
YWRldi0+cmVzZXRfc2VtKTsKPiAgCS8qIHJlYWQgdGhlIElQIGJ1c3kgc2Vuc29yICovCj4gIAly
ID0gYW1kZ3B1X2RwbV9yZWFkX3NlbnNvcihhZGV2LCBBTURHUFVfUFBfU0VOU09SX0dQVV9MT0FE
LAo+ICAJCQkJICAgKHZvaWQgKikmdmFsdWUsICZzaXplKTsKPiArCXVwX3JlYWQoJmFkZXYtPnJl
c2V0X3NlbSk7Cj4gIAo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+
ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPiBAQCAtMTc4Myw3ICsx
OTA2LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9tZW1fYnVzeV9wZXJjZW50KHN0cnVj
dCBkZXZpY2UgKmRldiwKPiAgCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gZGRldi0+ZGV2
X3ByaXZhdGU7Cj4gIAlpbnQgciwgdmFsdWUsIHNpemUgPSBzaXplb2YodmFsdWUpOwo+ICAKPiAt
CWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+
ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGRldi0+
ZGV2KTsKPiBAQCAtMTc5MiwxMCArMTkxNSwxNCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0
X21lbV9idXN5X3BlcmNlbnQoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByOwo+ICAJ
fQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAkvKiByZWFkIHRo
ZSBJUCBidXN5IHNlbnNvciAqLwo+ICAJciA9IGFtZGdwdV9kcG1fcmVhZF9zZW5zb3IoYWRldiwg
QU1ER1BVX1BQX1NFTlNPUl9NRU1fTE9BRCwKPiAgCQkJCSAgICh2b2lkICopJnZhbHVlLCAmc2l6
ZSk7Cj4gIAo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50aW1l
X21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVu
ZChkZGV2LT5kZXYpOwo+ICAKPiBAQCAtMTgyNiw3ICsxOTUzLDcgQEAgc3RhdGljIHNzaXplX3Qg
YW1kZ3B1X2dldF9wY2llX2J3KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXVpbnQ2NF90IGNvdW50
MCA9IDAsIGNvdW50MSA9IDA7Cj4gIAlpbnQgcmV0Owo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVf
cmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRVBFUk07
Cj4gIAo+ICAJaWYgKGFkZXYtPmZsYWdzICYgQU1EX0lTX0FQVSkKPiBAQCAtMTg0MSw4ICsxOTY4
LDEyIEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcGNpZV9idyhzdHJ1Y3QgZGV2aWNlICpk
ZXYsCj4gIAkJcmV0dXJuIHJldDsKPiAgCX0KPiAgCj4gKwlkb3duX3JlYWQoJmFkZXYtPnJlc2V0
X3NlbSk7Cj4gKwo+ICAJYW1kZ3B1X2FzaWNfZ2V0X3BjaWVfdXNhZ2UoYWRldiwgJmNvdW50MCwg
JmNvdW50MSk7Cj4gIAo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9y
dW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRv
c3VzcGVuZChkZGV2LT5kZXYpOwo+ICAKPiBAQCAtMTg2Nyw3ICsxOTk4LDcgQEAgc3RhdGljIHNz
aXplX3QgYW1kZ3B1X2dldF91bmlxdWVfaWQoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJc3RydWN0
IGRybV9kZXZpY2UgKmRkZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKPiAgCXN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2ID0gZGRldi0+ZGV2X3ByaXZhdGU7Cj4gIAo+IC0JaWYgKGFkZXYtPmlu
X2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1F
UEVSTTsKPiAgCj4gIAlpZiAoYWRldi0+dW5pcXVlX2lkKQo+IEBAIC0yMTM0LDcgKzIyNjUsNyBA
QCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hvd190ZW1wKHN0cnVjdCBkZXZpY2UgKmRl
diwKPiAgCWludCBjaGFubmVsID0gdG9fc2Vuc29yX2Rldl9hdHRyKGF0dHIpLT5pbmRleDsKPiAg
CWludCByLCB0ZW1wID0gMCwgc2l6ZSA9IHNpemVvZih0ZW1wKTsKPiAgCj4gLQlpZiAoYWRldi0+
aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4g
LUVQRVJNOwo+ICAKPiAgCWlmIChjaGFubmVsID49IFBQX1RFTVBfTUFYKQo+IEBAIC0yMTQ2LDYg
KzIyNzcsOCBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hvd190ZW1wKHN0cnVjdCBk
ZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcjsKPiAgCX0KPiAgCj4gKwlkb3duX3JlYWQoJmFkZXYt
PnJlc2V0X3NlbSk7Cj4gKwo+ICAJc3dpdGNoIChjaGFubmVsKSB7Cj4gIAljYXNlIFBQX1RFTVBf
SlVOQ1RJT046Cj4gIAkJLyogZ2V0IGN1cnJlbnQganVuY3Rpb24gdGVtcGVyYXR1cmUgKi8KPiBA
QCAtMjE2Nyw2ICsyMzAwLDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfdGVt
cChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAkJYnJlYWs7Cj4gIAl9Cj4gIAo+ICsJdXBfcmVhZCgm
YWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYt
PmRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5k
ZXYpOwo+ICAKPiBAQCAtMjI3MCw3ICsyNDA1LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3
bW9uX2dldF9wd20xX2VuYWJsZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAl1MzIgcHdtX21vZGUg
PSAwOwo+ICAJaW50IHJldDsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYg
KGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCXJldCA9
IHBtX3J1bnRpbWVfZ2V0X3N5bmMoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjI3OSwxOCArMjQx
NCwyMyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fZ2V0X3B3bTFfZW5hYmxlKHN0cnVj
dCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgm
YWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpIHsK
PiAgCQlwd21fbW9kZSA9IHNtdV9nZXRfZmFuX2NvbnRyb2xfbW9kZSgmYWRldi0+c211KTsKPiAg
CX0gZWxzZSB7Cj4gIAkJaWYgKCFhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9mYW5fY29u
dHJvbF9tb2RlKSB7Cj4gIAkJCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+
ZGV2KTsKPiAgCQkJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsK
PiArCQkJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgCQkJcmV0dXJuIC1FSU5WQUw7Cj4g
IAkJfQo+ICAKPiAgCQlwd21fbW9kZSA9IGFtZGdwdV9kcG1fZ2V0X2Zhbl9jb250cm9sX21vZGUo
YWRldik7Cj4gIAl9Cj4gIAo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlw
bV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1l
X3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+ICAKPiBAQCAtMjMwNiw3ICsyNDQ2
LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3NldF9wd20xX2VuYWJsZShzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCj4gIAlpbnQgZXJyLCByZXQ7Cj4gIAlpbnQgdmFsdWU7Cj4gIAo+IC0JaWYg
KGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJ
cmV0dXJuIC1FUEVSTTsKPiAgCj4gIAllcnIgPSBrc3RydG9pbnQoYnVmLCAxMCwgJnZhbHVlKTsK
PiBAQCAtMjMxOSwxOCArMjQ1OSwyMyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2V0
X3B3bTFfZW5hYmxlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcmV0Owo+ICAJfQo+
ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNfc3VwcG9y
dF9zd19zbXUoYWRldikpIHsKPiAgCQlzbXVfc2V0X2Zhbl9jb250cm9sX21vZGUoJmFkZXYtPnNt
dSwgdmFsdWUpOwo+ICAJfSBlbHNlIHsKPiAgCQlpZiAoIWFkZXYtPnBvd2VycGxheS5wcF9mdW5j
cy0+c2V0X2Zhbl9jb250cm9sX21vZGUpIHsKPiAgCQkJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVz
eShhZGV2LT5kZGV2LT5kZXYpOwo+ICAJCQlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2
LT5kZGV2LT5kZXYpOwo+ICsJCQl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAJCQlyZXR1
cm4gLUVJTlZBTDsKPiAgCQl9Cj4gIAo+ICAJCWFtZGdwdV9kcG1fc2V0X2Zhbl9jb250cm9sX21v
ZGUoYWRldiwgdmFsdWUpOwo+ICAJfQo+ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7
Cj4gKwo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAJ
cG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsKPiAgCj4gQEAgLTIz
NjAsNyArMjUwNSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zZXRfcHdtMShzdHJ1
Y3QgZGV2aWNlICpkZXYsCj4gIAl1MzIgdmFsdWU7Cj4gIAl1MzIgcHdtX21vZGU7Cj4gIAo+IC0J
aWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4g
IAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAllcnIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGFkZXYt
PmRkZXYtPmRldik7Cj4gQEAgLTIzNjksMTEgKzI1MTQsMTUgQEAgc3RhdGljIHNzaXplX3QgYW1k
Z3B1X2h3bW9uX3NldF9wd20xKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gZXJyOwo+
ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlpZiAoaXNf
c3VwcG9ydF9zd19zbXUoYWRldikpCj4gIAkJcHdtX21vZGUgPSBzbXVfZ2V0X2Zhbl9jb250cm9s
X21vZGUoJmFkZXYtPnNtdSk7Cj4gIAllbHNlCj4gIAkJcHdtX21vZGUgPSBhbWRncHVfZHBtX2dl
dF9mYW5fY29udHJvbF9tb2RlKGFkZXYpOwo+ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3Nl
bSk7Cj4gKwo+ICAJaWYgKHB3bV9tb2RlICE9IEFNRF9GQU5fQ1RSTF9NQU5VQUwpIHsKPiAgCQlw
cl9pbmZvKCJtYW51YWwgZmFuIHNwZWVkIGNvbnRyb2wgc2hvdWxkIGJlIGVuYWJsZWQgZmlyc3Rc
biIpOwo+ICAJCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsKPiBA
QCAtMjQxNCw3ICsyNTYzLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX2dldF9wd20x
KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWludCBlcnI7Cj4gIAl1MzIgc3BlZWQgPSAwOwo+ICAK
PiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYp
KQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJZXJyID0gcG1fcnVudGltZV9nZXRfc3luYyhh
ZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC0yNDIzLDYgKzI1NzIsOCBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfaHdtb25fZ2V0X3B3bTEoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiBlcnI7
Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChp
c19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgCQllcnIgPSBzbXVfZ2V0X2Zhbl9zcGVlZF9wZXJj
ZW50KCZhZGV2LT5zbXUsICZzcGVlZCk7Cj4gIAllbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBf
ZnVuY3MtPmdldF9mYW5fc3BlZWRfcGVyY2VudCkKPiBAQCAtMjQzMCw2ICsyNTgxLDggQEAgc3Rh
dGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX2dldF9wd20xKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAg
CWVsc2UKPiAgCQllcnIgPSAtRUlOVkFMOwo+ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3Nl
bSk7Cj4gKwo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+
ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsKPiAgCj4gQEAg
LTI0NDksNyArMjYwMiw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9nZXRfZmFuMV9p
bnB1dChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAlpbnQgZXJyOwo+ICAJdTMyIHNwZWVkID0gMDsK
PiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChh
ZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCWVyciA9IHBtX3J1bnRpbWVfZ2V0X3N5
bmMoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjQ1OCw2ICsyNjExLDggQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X2h3bW9uX2dldF9mYW4xX2lucHV0KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQly
ZXR1cm4gZXJyOwo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAr
Cj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpCj4gIAkJZXJyID0gc211X2dldF9mYW5f
c3BlZWRfcnBtKCZhZGV2LT5zbXUsICZzcGVlZCk7Cj4gIAllbHNlIGlmIChhZGV2LT5wb3dlcnBs
YXkucHBfZnVuY3MtPmdldF9mYW5fc3BlZWRfcnBtKQo+IEBAIC0yNDY1LDYgKzI2MjAsOCBAQCBz
dGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fZ2V0X2ZhbjFfaW5wdXQoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAJZWxzZQo+ICAJCWVyciA9IC1FSU5WQUw7Cj4gIAo+ICsJdXBfcmVhZCgmYWRldi0+
cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYt
PmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+
ICAKPiBAQCAtMjQ4Myw3ICsyNjQwLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX2dl
dF9mYW4xX21pbihzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAl1MzIgc2l6ZSA9IHNpemVvZihtaW5f
cnBtKTsKPiAgCWludCByOwo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAo
YW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJciA9IHBt
X3J1bnRpbWVfZ2V0X3N5bmMoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjQ5Miw5ICsyNjQ5LDEz
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9nZXRfZmFuMV9taW4oc3RydWN0IGRldmlj
ZSAqZGV2LAo+ICAJCXJldHVybiByOwo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVz
ZXRfc2VtKTsKPiArCj4gIAlyID0gYW1kZ3B1X2RwbV9yZWFkX3NlbnNvcihhZGV2LCBBTURHUFVf
UFBfU0VOU09SX01JTl9GQU5fUlBNLAo+ICAJCQkJICAgKHZvaWQgKikmbWluX3JwbSwgJnNpemUp
Owo+ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVudGltZV9t
YXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1
c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsKPiAgCj4gQEAgLTI1MTMsNyArMjY3NCw3IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9od21vbl9nZXRfZmFuMV9tYXgoc3RydWN0IGRldmljZSAqZGV2LAo+
ICAJdTMyIHNpemUgPSBzaXplb2YobWF4X3JwbSk7Cj4gIAlpbnQgcjsKPiAgCj4gLQlpZiAoYWRl
di0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1
cm4gLUVQRVJNOwo+ICAKPiAgCXIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGFkZXYtPmRkZXYtPmRl
dik7Cj4gQEAgLTI1MjIsOSArMjY4MywxMyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25f
Z2V0X2ZhbjFfbWF4KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcjsKPiAgCX0KPiAg
Cj4gKwlkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJciA9IGFtZGdwdV9kcG1f
cmVhZF9zZW5zb3IoYWRldiwgQU1ER1BVX1BQX1NFTlNPUl9NQVhfRkFOX1JQTSwKPiAgCQkJCSAg
ICh2b2lkICopJm1heF9ycG0sICZzaXplKTsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9z
ZW0pOwo+ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsK
PiAgCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4gIAo+IEBA
IC0yNTQyLDcgKzI3MDcsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fZ2V0X2ZhbjFf
dGFyZ2V0KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWludCBlcnI7Cj4gIAl1MzIgcnBtID0gMDsK
PiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChh
ZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCWVyciA9IHBtX3J1bnRpbWVfZ2V0X3N5
bmMoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjU1MSw2ICsyNzE2LDggQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X2h3bW9uX2dldF9mYW4xX3RhcmdldChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAkJ
cmV0dXJuIGVycjsKPiAgCX0KPiAgCj4gKwlkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4g
Kwo+ICAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQo+ICAJCWVyciA9IHNtdV9nZXRfZmFu
X3NwZWVkX3JwbSgmYWRldi0+c211LCAmcnBtKTsKPiAgCWVsc2UgaWYgKGFkZXYtPnBvd2VycGxh
eS5wcF9mdW5jcy0+Z2V0X2Zhbl9zcGVlZF9ycG0pCj4gQEAgLTI1NTgsNiArMjcyNSw4IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9nZXRfZmFuMV90YXJnZXQoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAJZWxzZQo+ICAJCWVyciA9IC1FSU5WQUw7Cj4gIAo+ICsJdXBfcmVhZCgmYWRldi0+
cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYt
PmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+
ICAKPiBAQCAtMjU3Niw3ICsyNzQ1LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nl
dF9mYW4xX3RhcmdldChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAl1MzIgdmFsdWU7Cj4gIAl1MzIg
cHdtX21vZGU7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVf
aW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAllcnIgPSBwbV9ydW50
aW1lX2dldF9zeW5jKGFkZXYtPmRkZXYtPmRldik7Cj4gQEAgLTI1ODUsMTEgKzI3NTQsMTUgQEAg
c3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3NldF9mYW4xX3RhcmdldChzdHJ1Y3QgZGV2aWNl
ICpkZXYsCj4gIAkJcmV0dXJuIGVycjsKPiAgCX0KPiAgCj4gKwlkb3duX3JlYWQoJmFkZXYtPnJl
c2V0X3NlbSk7Cj4gKwo+ICAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQo+ICAJCXB3bV9t
b2RlID0gc211X2dldF9mYW5fY29udHJvbF9tb2RlKCZhZGV2LT5zbXUpOwo+ICAJZWxzZQo+ICAJ
CXB3bV9tb2RlID0gYW1kZ3B1X2RwbV9nZXRfZmFuX2NvbnRyb2xfbW9kZShhZGV2KTsKPiAgCj4g
Kwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChwd21fbW9kZSAhPSBBTURf
RkFOX0NUUkxfTUFOVUFMKSB7Cj4gIAkJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5k
ZGV2LT5kZXYpOwo+ICAJCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRl
dik7Cj4gQEAgLTI2MDMsNiArMjc3Niw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9z
ZXRfZmFuMV90YXJnZXQoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiBlcnI7Cj4gIAl9
Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBw
b3J0X3N3X3NtdShhZGV2KSkKPiAgCQllcnIgPSBzbXVfc2V0X2Zhbl9zcGVlZF9ycG0oJmFkZXYt
PnNtdSwgdmFsdWUpOwo+ICAJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5zZXRf
ZmFuX3NwZWVkX3JwbSkKPiBAQCAtMjYxMCw2ICsyNzg1LDggQEAgc3RhdGljIHNzaXplX3QgYW1k
Z3B1X2h3bW9uX3NldF9mYW4xX3RhcmdldChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAllbHNlCj4g
IAkJZXJyID0gLUVJTlZBTDsKPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsK
PiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsKPiAgCXBtX3J1
bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4gIAo+IEBAIC0yNjI3LDcg
KzI4MDQsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fZ2V0X2ZhbjFfZW5hYmxlKHN0
cnVjdCBkZXZpY2UgKmRldiwKPiAgCXUzMiBwd21fbW9kZSA9IDA7Cj4gIAlpbnQgcmV0Owo+ICAK
PiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYp
KQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhh
ZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC0yNjM2LDE4ICsyODEzLDIzIEBAIHN0YXRpYyBzc2l6ZV90
IGFtZGdwdV9od21vbl9nZXRfZmFuMV9lbmFibGUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJl
dHVybiByZXQ7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsK
PiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkgewo+ICAJCXB3bV9tb2RlID0gc211X2dl
dF9mYW5fY29udHJvbF9tb2RlKCZhZGV2LT5zbXUpOwo+ICAJfSBlbHNlIHsKPiAgCQlpZiAoIWFk
ZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Z2V0X2Zhbl9jb250cm9sX21vZGUpIHsKPiAgCQkJcG1f
cnVudGltZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAJCQlwbV9ydW50aW1l
X3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+ICsJCQl1cF9yZWFkKCZhZGV2LT5y
ZXNldF9zZW0pOwo+ICAJCQlyZXR1cm4gLUVJTlZBTDsKPiAgCQl9Cj4gIAo+ICAJCXB3bV9tb2Rl
ID0gYW1kZ3B1X2RwbV9nZXRfZmFuX2NvbnRyb2xfbW9kZShhZGV2KTsKPiAgCX0KPiAgCj4gKwl1
cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1
c3koYWRldi0+ZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYt
PmRkZXYtPmRldik7Cj4gIAo+IEBAIC0yNjY0LDcgKzI4NDYsNyBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfaHdtb25fc2V0X2ZhbjFfZW5hYmxlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWludCB2
YWx1ZTsKPiAgCXUzMiBwd21fbW9kZTsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+
ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAg
CWVyciA9IGtzdHJ0b2ludChidWYsIDEwLCAmdmFsdWUpOwo+IEBAIC0yNjg0LDE3ICsyODY2LDIy
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zZXRfZmFuMV9lbmFibGUoc3RydWN0IGRl
dmljZSAqZGV2LAo+ICAJCXJldHVybiBlcnI7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2
LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkgewo+ICAJ
CXNtdV9zZXRfZmFuX2NvbnRyb2xfbW9kZSgmYWRldi0+c211LCBwd21fbW9kZSk7Cj4gIAl9IGVs
c2Ugewo+ICAJCWlmICghYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5zZXRfZmFuX2NvbnRyb2xf
bW9kZSkgewo+ICAJCQlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7
Cj4gIAkJCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4gKwkJ
CXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAkJCXJldHVybiAtRUlOVkFMOwo+ICAJCX0K
PiAgCQlhbWRncHVfZHBtX3NldF9mYW5fY29udHJvbF9tb2RlKGFkZXYsIHB3bV9tb2RlKTsKPiAg
CX0KPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCXBtX3J1bnRpbWVf
bWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRpbWVfcHV0X2F1dG9z
dXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4gIAo+IEBAIC0yNzA5LDcgKzI4OTYsNyBAQCBzdGF0
aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hvd192ZGRnZngoc3RydWN0IGRldmljZSAqZGV2LAo+
ICAJdTMyIHZkZGdmeDsKPiAgCWludCByLCBzaXplID0gc2l6ZW9mKHZkZGdmeCk7Cj4gIAo+IC0J
aWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4g
IAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlyID0gcG1fcnVudGltZV9nZXRfc3luYyhhZGV2LT5k
ZGV2LT5kZXYpOwo+IEBAIC0yNzE4LDkgKzI5MDUsMTEgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1
X2h3bW9uX3Nob3dfdmRkZ2Z4KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCQlyZXR1cm4gcjsKPiAg
CX0KPiAgCj4gKwlkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAkvKiBnZXQgdGhlIHZv
bHRhZ2UgKi8KPiAgCXIgPSBhbWRncHVfZHBtX3JlYWRfc2Vuc29yKGFkZXYsIEFNREdQVV9QUF9T
RU5TT1JfVkRER0ZYLAo+ICAJCQkJICAgKHZvaWQgKikmdmRkZ2Z4LCAmc2l6ZSk7Cj4gKwl1cF9y
ZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3ko
YWRldi0+ZGRldi0+ZGV2KTsKPiAgCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRk
ZXYtPmRldik7Cj4gQEAgLTI3NDYsNyArMjkzNSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9o
d21vbl9zaG93X3ZkZG5iKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXUzMiB2ZGRuYjsKPiAgCWlu
dCByLCBzaXplID0gc2l6ZW9mKHZkZG5iKTsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0
KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAK
PiAgCS8qIG9ubHkgQVBVcyBoYXZlIHZkZG5iICovCj4gQEAgLTI3NTksOSArMjk0OCwxMSBAQCBz
dGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hvd192ZGRuYihzdHJ1Y3QgZGV2aWNlICpkZXYs
Cj4gIAkJcmV0dXJuIHI7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0p
Owo+ICAJLyogZ2V0IHRoZSB2b2x0YWdlICovCj4gIAlyID0gYW1kZ3B1X2RwbV9yZWFkX3NlbnNv
cihhZGV2LCBBTURHUFVfUFBfU0VOU09SX1ZERE5CLAo+ICAJCQkJICAgKHZvaWQgKikmdmRkbmIs
ICZzaXplKTsKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAo+ICAJcG1fcnVudGlt
ZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0
b3N1c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjc4OCw3ICsyOTc5LDcgQEAgc3RhdGlj
IHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfcG93ZXJfYXZnKHN0cnVjdCBkZXZpY2UgKmRldiwK
PiAgCWludCByLCBzaXplID0gc2l6ZW9mKHUzMik7Cj4gIAl1bnNpZ25lZCB1dzsKPiAgCj4gLQlp
ZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAg
CQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAgCXIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGFkZXYtPmRk
ZXYtPmRldik7Cj4gQEAgLTI3OTcsOSArMjk4OCwxMSBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVf
aHdtb25fc2hvd19wb3dlcl9hdmcoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByOwo+
ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgCS8qIGdldCB0aGUg
dm9sdGFnZSAqLwo+ICAJciA9IGFtZGdwdV9kcG1fcmVhZF9zZW5zb3IoYWRldiwgQU1ER1BVX1BQ
X1NFTlNPUl9HUFVfUE9XRVIsCj4gIAkJCQkgICAodm9pZCAqKSZxdWVyeSwgJnNpemUpOwo+ICsJ
dXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgCj4gIAlwbV9ydW50aW1lX21hcmtfbGFzdF9i
dXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2
LT5kZGV2LT5kZXYpOwo+IEBAIC0yODI5LDcgKzMwMjIsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRn
cHVfaHdtb25fc2hvd19wb3dlcl9jYXBfbWF4KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCXNzaXpl
X3Qgc2l6ZTsKPiAgCWludCByOwo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlp
ZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJciA9
IHBtX3J1bnRpbWVfZ2V0X3N5bmMoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjgzOCw2ICszMDMx
LDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfcG93ZXJfY2FwX21heChzdHJ1
Y3QgZGV2aWNlICpkZXYsCj4gIAkJcmV0dXJuIHI7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZh
ZGV2LT5yZXNldF9zZW0pOwo+ICsKPiAgCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkgewo+
ICAJCXNtdV9nZXRfcG93ZXJfbGltaXQoJmFkZXYtPnNtdSwgJmxpbWl0LCB0cnVlKTsKPiAgCQlz
aXplID0gc25wcmludGYoYnVmLCBQQUdFX1NJWkUsICIldVxuIiwgbGltaXQgKiAxMDAwMDAwKTsK
PiBAQCAtMjg0OCw2ICszMDQzLDggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3df
cG93ZXJfY2FwX21heChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAkJc2l6ZSA9IHNucHJpbnRmKGJ1
ZiwgUEFHRV9TSVpFLCAiXG4iKTsKPiAgCX0KPiAgCj4gKwl1cF9yZWFkKCZhZGV2LT5yZXNldF9z
ZW0pOwo+ICsKPiAgCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsK
PiAgCXBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4gIAo+IEBA
IC0yODYzLDcgKzMwNjAsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hvd19wb3dl
cl9jYXAoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJc3NpemVfdCBzaXplOwo+ICAJaW50IHI7Cj4g
IAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRl
dikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4gIAlyID0gcG1fcnVudGltZV9nZXRfc3luYyhh
ZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC0yODcyLDYgKzMwNjksOCBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfaHdtb25fc2hvd19wb3dlcl9jYXAoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVy
biByOwo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlp
ZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpIHsKPiAgCQlzbXVfZ2V0X3Bvd2VyX2xpbWl0KCZh
ZGV2LT5zbXUsICZsaW1pdCwgZmFsc2UpOwo+ICAJCXNpemUgPSBzbnByaW50ZihidWYsIFBBR0Vf
U0laRSwgIiV1XG4iLCBsaW1pdCAqIDEwMDAwMDApOwo+IEBAIC0yODgyLDYgKzMwODEsOCBAQCBz
dGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hvd19wb3dlcl9jYXAoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAJCXNpemUgPSBzbnByaW50ZihidWYsIFBBR0VfU0laRSwgIlxuIik7Cj4gIAl9Cj4g
IAo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArCj4gIAlwbV9ydW50aW1lX21hcmtf
bGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVu
ZChhZGV2LT5kZGV2LT5kZXYpOwo+ICAKPiBAQCAtMjg5OCw3ICszMDk5LDcgQEAgc3RhdGljIHNz
aXplX3QgYW1kZ3B1X2h3bW9uX3NldF9wb3dlcl9jYXAoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJ
aW50IGVycjsKPiAgCXUzMiB2YWx1ZTsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+
ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4gLUVQRVJNOwo+ICAKPiAg
CWlmIChhbWRncHVfc3Jpb3ZfdmYoYWRldikpCj4gQEAgLTI5MTcsNiArMzExOCw4IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9od21vbl9zZXRfcG93ZXJfY2FwKHN0cnVjdCBkZXZpY2UgKmRldiwK
PiAgCQlyZXR1cm4gZXJyOwo+ICAJfQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2Vt
KTsKPiArCj4gIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpCj4gIAkJZXJyID0gc211X3Nl
dF9wb3dlcl9saW1pdCgmYWRldi0+c211LCB2YWx1ZSk7Cj4gIAllbHNlIGlmIChhZGV2LT5wb3dl
cnBsYXkucHBfZnVuY3MgJiYgYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5zZXRfcG93ZXJfbGlt
aXQpCj4gQEAgLTI5MjQsNiArMzEyNyw4IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9z
ZXRfcG93ZXJfY2FwKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgCWVsc2UKPiAgCQllcnIgPSAtRUlO
VkFMOwo+ICAKPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAJcG1fcnVudGlt
ZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0
b3N1c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsKPiAgCj4gQEAgLTI5NDEsNyArMzE0Niw3IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3NjbGsoc3RydWN0IGRldmljZSAqZGV2LAo+
ICAJdWludDMyX3Qgc2NsazsKPiAgCWludCByLCBzaXplID0gc2l6ZW9mKHNjbGspOwo+ICAKPiAt
CWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+
ICAJCXJldHVybiAtRVBFUk07Cj4gIAo+ICAJciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoYWRldi0+
ZGRldi0+ZGV2KTsKPiBAQCAtMjk1MCw5ICszMTU1LDExIEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdw
dV9od21vbl9zaG93X3NjbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAJCXJldHVybiByOwo+ICAJ
fQo+ICAKPiArCWRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgCS8qIGdldCB0aGUgc2Ns
ayAqLwo+ICAJciA9IGFtZGdwdV9kcG1fcmVhZF9zZW5zb3IoYWRldiwgQU1ER1BVX1BQX1NFTlNP
Ul9HRlhfU0NMSywKPiAgCQkJCSAgICh2b2lkICopJnNjbGssICZzaXplKTsKPiArCXVwX3JlYWQo
JmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAo+ICAJcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShhZGV2
LT5kZGV2LT5kZXYpOwo+ICAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoYWRldi0+ZGRldi0+
ZGV2KTsKPiBAQCAtMjk3OCw3ICszMTg1LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9u
X3Nob3dfbWNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gIAl1aW50MzJfdCBtY2xrOwo+ICAJaW50
IHIsIHNpemUgPSBzaXplb2YobWNsayk7Cj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCkK
PiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gIAkJcmV0dXJuIC1FUEVSTTsKPiAgCj4g
IAlyID0gcG1fcnVudGltZV9nZXRfc3luYyhhZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC0yOTg3LDkg
KzMxOTQsMTEgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfbWNsayhzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCj4gIAkJcmV0dXJuIHI7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2
LT5yZXNldF9zZW0pOwo+ICAJLyogZ2V0IHRoZSBzY2xrICovCj4gIAlyID0gYW1kZ3B1X2RwbV9y
ZWFkX3NlbnNvcihhZGV2LCBBTURHUFVfUFBfU0VOU09SX0dGWF9NQ0xLLAo+ICAJCQkJICAgKHZv
aWQgKikmbWNsaywgJnNpemUpOwo+ICsJdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgCj4g
IAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gIAlwbV9ydW50
aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC0zODcwLDcgKzQwNzks
NyBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX3BtX2luZm8oc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICpkYXRhKQo+ICAJdTMyIGZsYWdzID0gMDsKPiAgCWludCByOwo+ICAKPiAtCWlmIChh
ZGV2LT5pbl9ncHVfcmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJl
dHVybiAtRVBFUk07Cj4gIAo+ICAJciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGV2LT5kZXYpOwo+
IEBAIC0zODc5LDcgKzQwODgsMTAgQEAgc3RhdGljIGludCBhbWRncHVfZGVidWdmc19wbV9pbmZv
KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKPiAgCQlyZXR1cm4gcjsKPiAgCX0KPiAg
Cj4gKwlkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAlhbWRncHVfZGV2aWNlX2lwX2dl
dF9jbG9ja2dhdGluZ19zdGF0ZShhZGV2LCAmZmxhZ3MpOwo+ICsJdXBfcmVhZCgmYWRldi0+cmVz
ZXRfc2VtKTsKPiArCj4gIAlzZXFfcHJpbnRmKG0sICJDbG9jayBHYXRpbmcgRmxhZ3MgTWFzazog
MHgleFxuIiwgZmxhZ3MpOwo+ICAJYW1kZ3B1X3BhcnNlX2NnX3N0YXRlKG0sIGZsYWdzKTsKPiAg
CXNlcV9wcmludGYobSwgIlxuIik7Cj4gQEAgLTM4OTEsNiArNDEwMyw3IEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X2RlYnVnZnNfcG1faW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCj4g
IAkJcmV0dXJuIDA7Cj4gIAl9Cj4gIAo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
ICAJaWYgKCFpc19zdXBwb3J0X3N3X3NtdShhZGV2KSAmJgo+ICAJICAgIGFkZXYtPnBvd2VycGxh
eS5wcF9mdW5jcy0+ZGVidWdmc19wcmludF9jdXJyZW50X3BlcmZvcm1hbmNlX2xldmVsKSB7Cj4g
IAkJbXV0ZXhfbG9jaygmYWRldi0+cG0ubXV0ZXgpOwo+IEBAIC0zOTAzLDYgKzQxMTYsNyBAQCBz
dGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX3BtX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lk
ICpkYXRhKQo+ICAJfSBlbHNlIHsKPiAgCQlyID0gYW1kZ3B1X2RlYnVnZnNfcG1faW5mb19wcCht
LCBhZGV2KTsKPiAgCX0KPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAo+ICAJcG1f
cnVudGltZV9tYXJrX2xhc3RfYnVzeShkZXYtPmRldik7Cj4gIAlwbV9ydW50aW1lX3B1dF9hdXRv
c3VzcGVuZChkZXYtPmRldik7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9wc3AuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3Au
Ywo+IGluZGV4IGUyMDY5NWI0NGRiZS4uOWY0MWRlODBjYTdmIDEwMDY0NAo+IC0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYwo+IEBAIC0xNjgyLDcgKzE2ODIsNyBAQCBzdGF0aWMg
aW50IHBzcF9sb2FkX3NtdV9mdyhzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKPiAgCQlyZXR1cm4g
MDsKPiAgCj4gIAo+IC0JaWYgKGFkZXYtPmluX2dwdV9yZXNldCAmJiByYXMgJiYgcmFzLT5zdXBw
b3J0ZWQpIHsKPiArCWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikgJiYgcmFzICYmIHJhcy0+c3Vw
cG9ydGVkKSB7Cj4gIAkJcmV0ID0gYW1kZ3B1X2RwbV9zZXRfbXAxX3N0YXRlKGFkZXYsIFBQX01Q
MV9TVEFURV9VTkxPQUQpOwo+ICAJCWlmIChyZXQpIHsKPiAgCQkJRFJNX1dBUk4oIkZhaWxlZCB0
byBzZXQgTVAxIHN0YXRlIHByZXBhcmUgZm9yIHJlbG9hZFxuIik7Cj4gQEAgLTE3OTYsNyArMTc5
Niw3IEBAIHN0YXRpYyBpbnQgcHNwX2xvYWRfZncoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYp
Cj4gIAlpbnQgcmV0Owo+ICAJc3RydWN0IHBzcF9jb250ZXh0ICpwc3AgPSAmYWRldi0+cHNwOwo+
ICAKPiAtCWlmIChhbWRncHVfc3Jpb3ZfdmYoYWRldikgJiYgYWRldi0+aW5fZ3B1X3Jlc2V0KSB7
Cj4gKwlpZiAoYW1kZ3B1X3NyaW92X3ZmKGFkZXYpICYmIGFtZGdwdV9pbl9yZXNldChhZGV2KSkg
ewo+ICAJCXBzcF9yaW5nX3N0b3AocHNwLCBQU1BfUklOR19UWVBFX19LTSk7IC8qIHNob3VsZCBu
b3QgZGVzdHJveSByaW5nLCBvbmx5IHN0b3AgKi8KPiAgCQlnb3RvIHNraXBfbWVtYWxsb2M7Cj4g
IAl9Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMuYwo+IGluZGV4IGFiOGU3
YzkxYzY0NS4uMTAwOGZkM2VmNWYwIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9yYXMuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9yYXMuYwo+IEBAIC0xOTc1LDcgKzE5NzUsNyBAQCBpbnQgYW1kZ3B1X3Jhc19sYXRlX2lu
aXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gIAkJCWFtZGdwdV9yYXNfcmVxdWVzdF9y
ZXNldF9vbl9ib290KGFkZXYsCj4gIAkJCQkJcmFzX2Jsb2NrLT5ibG9jayk7Cj4gIAkJCXJldHVy
biAwOwo+IC0JCX0gZWxzZSBpZiAoYWRldi0+aW5fc3VzcGVuZCB8fCBhZGV2LT5pbl9ncHVfcmVz
ZXQpIHsKPiArCQl9IGVsc2UgaWYgKGFkZXYtPmluX3N1c3BlbmQgfHwgYW1kZ3B1X2luX3Jlc2V0
KGFkZXYpKSB7Cj4gIAkJCS8qIGluIHJlc3VtZSBwaGFzZSwgaWYgZmFpbCB0byBlbmFibGUgcmFz
LAo+ICAJCQkgKiBjbGVhbiB1cCBhbGwgcmFzIGZzIG5vZGVzLCBhbmQgZGlzYWJsZSByYXMgKi8K
PiAgCQkJZ290byBjbGVhbnVwOwo+IEBAIC0xOTg0LDcgKzE5ODQsNyBAQCBpbnQgYW1kZ3B1X3Jh
c19sYXRlX2luaXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gIAl9Cj4gIAo+ICAJLyog
aW4gcmVzdW1lIHBoYXNlLCBubyBuZWVkIHRvIGNyZWF0ZSByYXMgZnMgbm9kZSAqLwo+IC0JaWYg
KGFkZXYtPmluX3N1c3BlbmQgfHwgYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFkZXYtPmlu
X3N1c3BlbmQgfHwgYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAwOwo+ICAKPiAg
CWlmIChpaF9pbmZvLT5jYikgewo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRt
LmMKPiBpbmRleCA1NmJlYWZiZDNhYjkuLjhiYzMyNmFjMDkzOCAxMDA2NDQKPiAtLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKPiArKysgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKPiBAQCAtMjA5Myw3ICsyMDkzLDcgQEAgdm9pZCBh
bWRncHVfdHRtX3NldF9idWZmZXJfZnVuY3Nfc3RhdHVzKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LCBib29sIGVuYWJsZSkKPiAgCXVpbnQ2NF90IHNpemU7Cj4gIAlpbnQgcjsKPiAgCj4gLQlp
ZiAoIWFkZXYtPm1tYW4uaW5pdGlhbGl6ZWQgfHwgYWRldi0+aW5fZ3B1X3Jlc2V0IHx8Cj4gKwlp
ZiAoIWFkZXYtPm1tYW4uaW5pdGlhbGl6ZWQgfHwgYW1kZ3B1X2luX3Jlc2V0KGFkZXYpIHx8Cj4g
IAkgICAgYWRldi0+bW1hbi5idWZmZXJfZnVuY3NfZW5hYmxlZCA9PSBlbmFibGUpCj4gIAkJcmV0
dXJuOwo+ICAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3Vjb2RlLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdWNvZGUuYwo+IGlu
ZGV4IDc0NDQwNGEwNWZlZS4uZGNiNTA5Y2IzOGM0IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91Y29kZS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3Vjb2RlLmMKPiBAQCAtNjI4LDcgKzYyOCw3IEBAIGludCBhbWRncHVf
dWNvZGVfaW5pdF9ibyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKPiAgCXN0cnVjdCBhbWRn
cHVfZmlybXdhcmVfaW5mbyAqdWNvZGUgPSBOVUxMOwo+ICAKPiAgIC8qIGZvciBiYXJlbWV0YWws
IHRoZSB1Y29kZSBpcyBhbGxvY2F0ZWQgaW4gZ3R0LCBzbyBkb24ndCBuZWVkIHRvIGZpbGwgdGhl
IGJvIHdoZW4gcmVzZXQvc3VzcGVuZCAqLwo+IC0JaWYgKCFhbWRncHVfc3Jpb3ZfdmYoYWRldikg
JiYgKGFkZXYtPmluX2dwdV9yZXNldCB8fCBhZGV2LT5pbl9zdXNwZW5kKSkKPiArCWlmICghYW1k
Z3B1X3NyaW92X3ZmKGFkZXYpICYmIChhbWRncHVfaW5fcmVzZXQoYWRldikgfHwgYWRldi0+aW5f
c3VzcGVuZCkpCj4gIAkJcmV0dXJuIDA7Cj4gIAkvKgo+ICAJICogaWYgU01VIGxvYWRlZCBmaXJt
d2FyZSwgaXQgbmVlZG4ndCBhZGQgU01DLCBVVkQsIGFuZCBWQ0UKPiBkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQuYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV92aXJ0LmMKPiBpbmRleCAxMjAzYzIwNDkxZTYuLjVjYWUzOWQzNWMw
NCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmlydC5j
Cj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQuYwo+IEBAIC05
Myw3ICs5Myw3IEBAIHZvaWQgYW1kZ3B1X3ZpcnRfa2lxX3JlZ193cml0ZV9yZWdfd2FpdChzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKPiAgCWFtZGdwdV9yaW5nX3VuZG8ocmluZyk7Cj4gIAlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZraXEtPnJpbmdfbG9jaywgZmxhZ3MpOwo+ICBmYWlsZWRf
a2lxOgo+IC0JcHJfZXJyKCJmYWlsZWQgdG8gd3JpdGUgcmVnICV4IHdhaXQgcmVnICV4XG4iLCBy
ZWcwLCByZWcxKTsKPiArCWRldl93YXJuKGFkZXYtPmRldiwgImZhaWxlZCB0byB3cml0ZSByZWcg
JXggd2FpdCByZWcgJXhcbiIsIHJlZzAsIHJlZzEpOwo+ICB9Cj4gIAo+ICAvKioKPiBkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQuaCBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92aXJ0LmgKPiBpbmRleCBmODI2OTQ1OTg5YzcuLmIy
MDQ2YzNhNDA0ZCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdmlydC5oCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQu
aAo+IEBAIC0zMjUsOSArMzI1LDkgQEAgc3RhdGljIGlubGluZSBib29sIGlzX3ZpcnR1YWxfbWFj
aGluZSh2b2lkKQo+ICAjZGVmaW5lIGFtZGdwdV9zcmlvdl9pc19wcF9vbmVfdmYoYWRldikgXAo+
ICAJKChhZGV2KS0+dmlydC5naW1fZmVhdHVyZSAmIEFNREdJTV9GRUFUVVJFX1BQX09ORV9WRikK
PiAgI2RlZmluZSBhbWRncHVfc3Jpb3ZfaXNfZGVidWcoYWRldikgXAo+IC0JKCghYWRldi0+aW5f
Z3B1X3Jlc2V0KSAmJiBhZGV2LT52aXJ0LnRkcl9kZWJ1ZykKPiArCSgoIWFtZGdwdV9pbl9yZXNl
dChhZGV2KSkgJiYgYWRldi0+dmlydC50ZHJfZGVidWcpCj4gICNkZWZpbmUgYW1kZ3B1X3NyaW92
X2lzX25vcm1hbChhZGV2KSBcCj4gLQkoKCFhZGV2LT5pbl9ncHVfcmVzZXQpICYmICghYWRldi0+
dmlydC50ZHJfZGVidWcpKQo+ICsJKCghYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKSAmJiAoIWFkZXYt
PnZpcnQudGRyX2RlYnVnKSkKPiAgCj4gIGJvb2wgYW1kZ3B1X3ZpcnRfbW1pb19ibG9ja2VkKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KTsKPiAgdm9pZCBhbWRncHVfdmlydF9pbml0X3NldHRp
bmcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfeGdtaS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X3hnbWkuYwo+IGluZGV4IGUzYTM3NTVjYjk5OS4uNGUwMTdmMzc5ZWI2IDEwMDY0
NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV94Z21pLmMKPiArKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfeGdtaS5jCj4gQEAgLTM3Miw3ICsz
NzIsNyBAQCBzdHJ1Y3QgYW1kZ3B1X2hpdmVfaW5mbyAqYW1kZ3B1X2dldF94Z21pX2hpdmUoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGludCBsbwo+ICAJdG1wLT5oaXZlX2lkID0gYWRldi0+
Z21jLnhnbWkuaGl2ZV9pZDsKPiAgCUlOSVRfTElTVF9IRUFEKCZ0bXAtPmRldmljZV9saXN0KTsK
PiAgCW11dGV4X2luaXQoJnRtcC0+aGl2ZV9sb2NrKTsKPiAtCW11dGV4X2luaXQoJnRtcC0+cmVz
ZXRfbG9jayk7Cj4gKwlhdG9taWNfc2V0KCZ0bXAtPmluX3Jlc2V0LCAwKTsKPiAgCXRhc2tfYmFy
cmllcl9pbml0KCZ0bXAtPnRiKTsKPiAgCj4gIAlpZiAobG9jaykKPiBAQCAtMzk3LDYgKzM5Nyw3
IEBAIGludCBhbWRncHVfeGdtaV9zZXRfcHN0YXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
LCBpbnQgcHN0YXRlKQo+ICAJCQkJCQloaXZlLT5oaV9yZXFfZ3B1IDogYWRldjsKPiAgCWJvb2wg
aXNfaGlfcmVxID0gcHN0YXRlID09IEFNREdQVV9YR01JX1BTVEFURV9NQVhfVkVHQTIwOwo+ICAJ
Ym9vbCBpbml0X2xvdyA9IGhpdmUtPnBzdGF0ZSA9PSBBTURHUFVfWEdNSV9QU1RBVEVfVU5LTk9X
TjsKPiArCWJvb2wgbG9ja2VkOwo+ICAKPiAgCS8qIGZ3IGJ1ZyBzbyB0ZW1wb3JhcmlseSBkaXNh
YmxlIHBzdGF0ZSBzd2l0Y2hpbmcgKi8KPiAgCXJldHVybiAwOwo+IEBAIC00MDQsNyArNDA1LDkg
QEAgaW50IGFtZGdwdV94Z21pX3NldF9wc3RhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYs
IGludCBwc3RhdGUpCj4gIAlpZiAoIWhpdmUgfHwgYWRldi0+YXNpY190eXBlICE9IENISVBfVkVH
QTIwKQo+ICAJCXJldHVybiAwOwo+ICAKPiAtCW11dGV4X2xvY2soJmhpdmUtPmhpdmVfbG9jayk7
Cj4gKwlsb2NrZWQgPSBhdG9taWNfcmVhZCgmaGl2ZS0+aW5fcmVzZXQpID8gZmFsc2UgOiB0cnVl
Owo+ICsJaWYgKGxvY2tlZCkKPiArCQltdXRleF9sb2NrKCZoaXZlLT5oaXZlX2xvY2spOwo+ICAK
PiAgCWlmIChpc19oaV9yZXEpCj4gIAkJaGl2ZS0+aGlfcmVxX2NvdW50Kys7Cj4gQEAgLTQzOSw3
ICs0NDIsOCBAQCBpbnQgYW1kZ3B1X3hnbWlfc2V0X3BzdGF0ZShzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwgaW50IHBzdGF0ZSkKPiAgCQkJCQkJCWFkZXYgOiBOVUxMOwo+ICAJfQo+ICBvdXQ6
Cj4gLQltdXRleF91bmxvY2soJmhpdmUtPmhpdmVfbG9jayk7Cj4gKwlpZiAobG9ja2VkKQo+ICsJ
CW11dGV4X3VubG9jaygmaGl2ZS0+aGl2ZV9sb2NrKTsKPiAgCXJldHVybiByZXQ7Cj4gIH0KPiAg
Cj4gQEAgLTU5NCw3ICs1OTgsNiBAQCBpbnQgYW1kZ3B1X3hnbWlfcmVtb3ZlX2RldmljZShzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKPiAgCWlmKCEoLS1oaXZlLT5udW1iZXJfZGV2aWNlcykp
ewo+ICAJCWFtZGdwdV94Z21pX3N5c2ZzX2Rlc3Ryb3koYWRldiwgaGl2ZSk7Cj4gIAkJbXV0ZXhf
ZGVzdHJveSgmaGl2ZS0+aGl2ZV9sb2NrKTsKPiAtCQltdXRleF9kZXN0cm95KCZoaXZlLT5yZXNl
dF9sb2NrKTsKPiAgCX0KPiAgCj4gIAlyZXR1cm4gcHNwX3hnbWlfdGVybWluYXRlKCZhZGV2LT5w
c3ApOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfeGdt
aS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3hnbWkuaAo+IGluZGV4IDY5
OTllYWIxNmE3Mi4uNjE3MjBjZDRhMWVlIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV94Z21pLmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfeGdtaS5oCj4gQEAgLTMwLDcgKzMwLDggQEAgc3RydWN0IGFtZGdwdV9oaXZlX2lu
Zm8gewo+ICAJdWludDY0X3QJCWhpdmVfaWQ7Cj4gIAlzdHJ1Y3QgbGlzdF9oZWFkCWRldmljZV9s
aXN0Owo+ICAJaW50IG51bWJlcl9kZXZpY2VzOwo+IC0Jc3RydWN0IG11dGV4IGhpdmVfbG9jaywg
cmVzZXRfbG9jazsKPiArCXN0cnVjdCBtdXRleCBoaXZlX2xvY2s7Cj4gKwlhdG9taWNfdCBpbl9y
ZXNldDsKPiAgCXN0cnVjdCBrb2JqZWN0ICprb2JqOwo+ICAJc3RydWN0IGRldmljZV9hdHRyaWJ1
dGUgZGV2X2F0dHI7Cj4gIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldjsKPiBkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYXRvbS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYXRvbS5jCj4gaW5kZXggNGNmYzc4NjY5OWM3Li44MzQxYmQ5NjUyMDIgMTAwNjQ0
Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYXRvbS5jCj4gKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYXRvbS5jCj4gQEAgLTc1NSw2ICs3NTUsNyBAQCBzdGF0aWMg
dm9pZCBhdG9tX29wX2p1bXAoYXRvbV9leGVjX2NvbnRleHQgKmN0eCwgaW50ICpwdHIsIGludCBh
cmcpCj4gIAkJCQkvKiBqaWZmaWVzIHdyYXAgYXJvdW5kIHdlIHdpbGwganVzdCB3YWl0IGEgbGl0
dGxlIGxvbmdlciAqLwo+ICAJCQkJY3R4LT5sYXN0X2p1bXBfamlmZmllcyA9IGppZmZpZXM7Cj4g
IAkJCX0KPiArCQkJc2NoZWR1bGUoKTsKPiAgCQl9IGVsc2Ugewo+ICAJCQljdHgtPmxhc3RfanVt
cCA9IGN0eC0+c3RhcnQgKyB0YXJnZXQ7Cj4gIAkJCWN0eC0+bGFzdF9qdW1wX2ppZmZpZXMgPSBq
aWZmaWVzOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjEw
XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92MTBfMC5jCj4gaW5kZXggYTYx
NzBhMzQ2YjM5Li5kNWVmZWZjODBkYWQgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvZ2Z4X3YxMF8wLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9n
ZnhfdjEwXzAuYwo+IEBAIC02MTAyLDcgKzYxMDIsNyBAQCBzdGF0aWMgaW50IGdmeF92MTBfMF9n
ZnhfaW5pdF9xdWV1ZShzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCj4gIAlzdHJ1Y3QgdjEwX2dm
eF9tcWQgKm1xZCA9IHJpbmctPm1xZF9wdHI7Cj4gIAlpbnQgbXFkX2lkeCA9IHJpbmcgLSAmYWRl
di0+Z2Z4LmdmeF9yaW5nWzBdOwo+ICAKPiAtCWlmICghYWRldi0+aW5fZ3B1X3Jlc2V0ICYmICFh
ZGV2LT5pbl9zdXNwZW5kKSB7Cj4gKwlpZiAoIWFtZGdwdV9pbl9yZXNldChhZGV2KSAmJiAhYWRl
di0+aW5fc3VzcGVuZCkgewo+ICAJCW1lbXNldCgodm9pZCAqKW1xZCwgMCwgc2l6ZW9mKCptcWQp
KTsKPiAgCQltdXRleF9sb2NrKCZhZGV2LT5zcmJtX211dGV4KTsKPiAgCQludl9ncmJtX3NlbGVj
dChhZGV2LCByaW5nLT5tZSwgcmluZy0+cGlwZSwgcmluZy0+cXVldWUsIDApOwo+IEBAIC02MTE0
LDcgKzYxMTQsNyBAQCBzdGF0aWMgaW50IGdmeF92MTBfMF9nZnhfaW5pdF9xdWV1ZShzdHJ1Y3Qg
YW1kZ3B1X3JpbmcgKnJpbmcpCj4gIAkJbXV0ZXhfdW5sb2NrKCZhZGV2LT5zcmJtX211dGV4KTsK
PiAgCQlpZiAoYWRldi0+Z2Z4Lm1lLm1xZF9iYWNrdXBbbXFkX2lkeF0pCj4gIAkJCW1lbWNweShh
ZGV2LT5nZngubWUubXFkX2JhY2t1cFttcWRfaWR4XSwgbXFkLCBzaXplb2YoKm1xZCkpOwo+IC0J
fSBlbHNlIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpIHsKPiArCX0gZWxzZSBpZiAoYW1kZ3B1X2lu
X3Jlc2V0KGFkZXYpKSB7Cj4gIAkJLyogcmVzZXQgbXFkIHdpdGggdGhlIGJhY2t1cCBjb3B5ICov
Cj4gIAkJaWYgKGFkZXYtPmdmeC5tZS5tcWRfYmFja3VwW21xZF9pZHhdKQo+ICAJCQltZW1jcHko
bXFkLCBhZGV2LT5nZngubWUubXFkX2JhY2t1cFttcWRfaWR4XSwgc2l6ZW9mKCptcWQpKTsKPiBA
QCAtNjQ2Myw3ICs2NDYzLDcgQEAgc3RhdGljIGludCBnZnhfdjEwXzBfa2lxX2luaXRfcXVldWUo
c3RydWN0IGFtZGdwdV9yaW5nICpyaW5nKQo+ICAKPiAgCWdmeF92MTBfMF9raXFfc2V0dGluZyhy
aW5nKTsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KSB7IC8qIGZvciBHUFVfUkVTRVQg
Y2FzZSAqLwo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkgeyAvKiBmb3IgR1BVX1JFU0VU
IGNhc2UgKi8KPiAgCQkvKiByZXNldCBNUUQgdG8gYSBjbGVhbiBzdGF0dXMgKi8KPiAgCQlpZiAo
YWRldi0+Z2Z4Lm1lYy5tcWRfYmFja3VwW21xZF9pZHhdKQo+ICAJCQltZW1jcHkobXFkLCBhZGV2
LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0sIHNpemVvZigqbXFkKSk7Cj4gQEAgLTY0OTks
NyArNjQ5OSw3IEBAIHN0YXRpYyBpbnQgZ2Z4X3YxMF8wX2tjcV9pbml0X3F1ZXVlKHN0cnVjdCBh
bWRncHVfcmluZyAqcmluZykKPiAgCXN0cnVjdCB2MTBfY29tcHV0ZV9tcWQgKm1xZCA9IHJpbmct
Pm1xZF9wdHI7Cj4gIAlpbnQgbXFkX2lkeCA9IHJpbmcgLSAmYWRldi0+Z2Z4LmNvbXB1dGVfcmlu
Z1swXTsKPiAgCj4gLQlpZiAoIWFkZXYtPmluX2dwdV9yZXNldCAmJiAhYWRldi0+aW5fc3VzcGVu
ZCkgewo+ICsJaWYgKCFhbWRncHVfaW5fcmVzZXQoYWRldikgJiYgIWFkZXYtPmluX3N1c3BlbmQp
IHsKPiAgCQltZW1zZXQoKHZvaWQgKiltcWQsIDAsIHNpemVvZigqbXFkKSk7Cj4gIAkJbXV0ZXhf
bG9jaygmYWRldi0+c3JibV9tdXRleCk7Cj4gIAkJbnZfZ3JibV9zZWxlY3QoYWRldiwgcmluZy0+
bWUsIHJpbmctPnBpcGUsIHJpbmctPnF1ZXVlLCAwKTsKPiBAQCAtNjUwOSw3ICs2NTA5LDcgQEAg
c3RhdGljIGludCBnZnhfdjEwXzBfa2NxX2luaXRfcXVldWUoc3RydWN0IGFtZGdwdV9yaW5nICpy
aW5nKQo+ICAKPiAgCQlpZiAoYWRldi0+Z2Z4Lm1lYy5tcWRfYmFja3VwW21xZF9pZHhdKQo+ICAJ
CQltZW1jcHkoYWRldi0+Z2Z4Lm1lYy5tcWRfYmFja3VwW21xZF9pZHhdLCBtcWQsIHNpemVvZigq
bXFkKSk7Cj4gLQl9IGVsc2UgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkgeyAvKiBmb3IgR1BVX1JF
U0VUIGNhc2UgKi8KPiArCX0gZWxzZSBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKSB7IC8qIGZv
ciBHUFVfUkVTRVQgY2FzZSAqLwo+ICAJCS8qIHJlc2V0IE1RRCB0byBhIGNsZWFuIHN0YXR1cyAq
Lwo+ICAJCWlmIChhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0pCj4gIAkJCW1lbWNw
eShtcWQsIGFkZXYtPmdmeC5tZWMubXFkX2JhY2t1cFttcWRfaWR4XSwgc2l6ZW9mKCptcWQpKTsK
PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y4XzAuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OF8wLmMKPiBpbmRleCAzM2YxYzRhNDZlYmUu
LjhkNzIwODk1OWM5NSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9n
ZnhfdjhfMC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y4XzAuYwo+
IEBAIC00NjMyLDcgKzQ2MzIsNyBAQCBzdGF0aWMgaW50IGdmeF92OF8wX2tpcV9pbml0X3F1ZXVl
KHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykKPiAgCj4gIAlnZnhfdjhfMF9raXFfc2V0dGluZyhy
aW5nKTsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KSB7IC8qIGZvciBHUFVfUkVTRVQg
Y2FzZSAqLwo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkgeyAvKiBmb3IgR1BVX1JFU0VU
IGNhc2UgKi8KPiAgCQkvKiByZXNldCBNUUQgdG8gYSBjbGVhbiBzdGF0dXMgKi8KPiAgCQlpZiAo
YWRldi0+Z2Z4Lm1lYy5tcWRfYmFja3VwW21xZF9pZHhdKQo+ICAJCQltZW1jcHkobXFkLCBhZGV2
LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0sIHNpemVvZihzdHJ1Y3QgdmlfbXFkX2FsbG9j
YXRpb24pKTsKPiBAQCAtNDY2OSw3ICs0NjY5LDcgQEAgc3RhdGljIGludCBnZnhfdjhfMF9rY3Ff
aW5pdF9xdWV1ZShzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCj4gIAlzdHJ1Y3QgdmlfbXFkICpt
cWQgPSByaW5nLT5tcWRfcHRyOwo+ICAJaW50IG1xZF9pZHggPSByaW5nIC0gJmFkZXYtPmdmeC5j
b21wdXRlX3JpbmdbMF07Cj4gIAo+IC0JaWYgKCFhZGV2LT5pbl9ncHVfcmVzZXQgJiYgIWFkZXYt
PmluX3N1c3BlbmQpIHsKPiArCWlmICghYW1kZ3B1X2luX3Jlc2V0KGFkZXYpICYmICFhZGV2LT5p
bl9zdXNwZW5kKSB7Cj4gIAkJbWVtc2V0KCh2b2lkICopbXFkLCAwLCBzaXplb2Yoc3RydWN0IHZp
X21xZF9hbGxvY2F0aW9uKSk7Cj4gIAkJKChzdHJ1Y3QgdmlfbXFkX2FsbG9jYXRpb24gKiltcWQp
LT5keW5hbWljX2N1X21hc2sgPSAweEZGRkZGRkZGOwo+ICAJCSgoc3RydWN0IHZpX21xZF9hbGxv
Y2F0aW9uICopbXFkKS0+ZHluYW1pY19yYl9tYXNrID0gMHhGRkZGRkZGRjsKPiBAQCAtNDY4MSw3
ICs0NjgxLDcgQEAgc3RhdGljIGludCBnZnhfdjhfMF9rY3FfaW5pdF9xdWV1ZShzdHJ1Y3QgYW1k
Z3B1X3JpbmcgKnJpbmcpCj4gIAo+ICAJCWlmIChhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFk
X2lkeF0pCj4gIAkJCW1lbWNweShhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0sIG1x
ZCwgc2l6ZW9mKHN0cnVjdCB2aV9tcWRfYWxsb2NhdGlvbikpOwo+IC0JfSBlbHNlIGlmIChhZGV2
LT5pbl9ncHVfcmVzZXQpIHsgLyogZm9yIEdQVV9SRVNFVCBjYXNlICovCj4gKwl9IGVsc2UgaWYg
KGFtZGdwdV9pbl9yZXNldChhZGV2KSkgeyAvKiBmb3IgR1BVX1JFU0VUIGNhc2UgKi8KPiAgCQkv
KiByZXNldCBNUUQgdG8gYSBjbGVhbiBzdGF0dXMgKi8KPiAgCQlpZiAoYWRldi0+Z2Z4Lm1lYy5t
cWRfYmFja3VwW21xZF9pZHhdKQo+ICAJCQltZW1jcHkobXFkLCBhZGV2LT5nZngubWVjLm1xZF9i
YWNrdXBbbXFkX2lkeF0sIHNpemVvZihzdHJ1Y3QgdmlfbXFkX2FsbG9jYXRpb24pKTsKPiBkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKPiBpbmRleCBjYjlkNjBhNGUwNWUuLmU0ZTc1
MWY4NzA5MiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjlf
MC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYwo+IEBAIC0z
Njg0LDcgKzM2ODQsNyBAQCBzdGF0aWMgaW50IGdmeF92OV8wX2tpcV9pbml0X3F1ZXVlKHN0cnVj
dCBhbWRncHVfcmluZyAqcmluZykKPiAgCj4gIAlnZnhfdjlfMF9raXFfc2V0dGluZyhyaW5nKTsK
PiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KSB7IC8qIGZvciBHUFVfUkVTRVQgY2FzZSAq
Lwo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkgeyAvKiBmb3IgR1BVX1JFU0VUIGNhc2Ug
Ki8KPiAgCQkvKiByZXNldCBNUUQgdG8gYSBjbGVhbiBzdGF0dXMgKi8KPiAgCQlpZiAoYWRldi0+
Z2Z4Lm1lYy5tcWRfYmFja3VwW21xZF9pZHhdKQo+ICAJCQltZW1jcHkobXFkLCBhZGV2LT5nZngu
bWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0sIHNpemVvZihzdHJ1Y3QgdjlfbXFkX2FsbG9jYXRpb24p
KTsKPiBAQCAtMzcyMiw3ICszNzIyLDcgQEAgc3RhdGljIGludCBnZnhfdjlfMF9rY3FfaW5pdF9x
dWV1ZShzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCj4gIAlzdHJ1Y3QgdjlfbXFkICptcWQgPSBy
aW5nLT5tcWRfcHRyOwo+ICAJaW50IG1xZF9pZHggPSByaW5nIC0gJmFkZXYtPmdmeC5jb21wdXRl
X3JpbmdbMF07Cj4gIAo+IC0JaWYgKCFhZGV2LT5pbl9ncHVfcmVzZXQgJiYgIWFkZXYtPmluX3N1
c3BlbmQpIHsKPiArCWlmICghYW1kZ3B1X2luX3Jlc2V0KGFkZXYpICYmICFhZGV2LT5pbl9zdXNw
ZW5kKSB7Cj4gIAkJbWVtc2V0KCh2b2lkICopbXFkLCAwLCBzaXplb2Yoc3RydWN0IHY5X21xZF9h
bGxvY2F0aW9uKSk7Cj4gIAkJKChzdHJ1Y3QgdjlfbXFkX2FsbG9jYXRpb24gKiltcWQpLT5keW5h
bWljX2N1X21hc2sgPSAweEZGRkZGRkZGOwo+ICAJCSgoc3RydWN0IHY5X21xZF9hbGxvY2F0aW9u
ICopbXFkKS0+ZHluYW1pY19yYl9tYXNrID0gMHhGRkZGRkZGRjsKPiBAQCAtMzczNCw3ICszNzM0
LDcgQEAgc3RhdGljIGludCBnZnhfdjlfMF9rY3FfaW5pdF9xdWV1ZShzdHJ1Y3QgYW1kZ3B1X3Jp
bmcgKnJpbmcpCj4gIAo+ICAJCWlmIChhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0p
Cj4gIAkJCW1lbWNweShhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0sIG1xZCwgc2l6
ZW9mKHN0cnVjdCB2OV9tcWRfYWxsb2NhdGlvbikpOwo+IC0JfSBlbHNlIGlmIChhZGV2LT5pbl9n
cHVfcmVzZXQpIHsgLyogZm9yIEdQVV9SRVNFVCBjYXNlICovCj4gKwl9IGVsc2UgaWYgKGFtZGdw
dV9pbl9yZXNldChhZGV2KSkgeyAvKiBmb3IgR1BVX1JFU0VUIGNhc2UgKi8KPiAgCQkvKiByZXNl
dCBNUUQgdG8gYSBjbGVhbiBzdGF0dXMgKi8KPiAgCQlpZiAoYWRldi0+Z2Z4Lm1lYy5tcWRfYmFj
a3VwW21xZF9pZHhdKQo+ICAJCQltZW1jcHkobXFkLCBhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBb
bXFkX2lkeF0sIHNpemVvZihzdHJ1Y3QgdjlfbXFkX2FsbG9jYXRpb24pKTsKPiBAQCAtMzkyOCw3
ICszOTI4LDcgQEAgc3RhdGljIGludCBnZnhfdjlfMF9od19maW5pKHZvaWQgKmhhbmRsZSkKPiAg
CS8qIFVzZSBkZWluaXRpYWxpemUgc2VxdWVuY2UgZnJvbSBDQUlMIHdoZW4gdW5iaW5kaW5nIGRl
dmljZSBmcm9tIGRyaXZlciwKPiAgCSAqIG90aGVyd2lzZSBLSVEgaXMgaGFuZ2luZyB3aGVuIGJp
bmRpbmcgYmFjawo+ICAJICovCj4gLQlpZiAoIWFkZXYtPmluX2dwdV9yZXNldCAmJiAhYWRldi0+
aW5fc3VzcGVuZCkgewo+ICsJaWYgKCFhbWRncHVfaW5fcmVzZXQoYWRldikgJiYgIWFkZXYtPmlu
X3N1c3BlbmQpIHsKPiAgCQltdXRleF9sb2NrKCZhZGV2LT5zcmJtX211dGV4KTsKPiAgCQlzb2Mx
NV9ncmJtX3NlbGVjdChhZGV2LCBhZGV2LT5nZngua2lxLnJpbmcubWUsCj4gIAkJCQlhZGV2LT5n
Zngua2lxLnJpbmcucGlwZSwKPiBAQCAtNDA4Niw3ICs0MDg2LDcgQEAgc3RhdGljIHVpbnQ2NF90
IGdmeF92OV8wX2tpcV9yZWFkX2Nsb2NrKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQo+ICAJ
ICoKPiAgCSAqIGFsc28gZG9uJ3Qgd2FpdCBhbnltb3JlIGZvciBJUlEgY29udGV4dAo+ICAJICog
Ki8KPiAtCWlmIChyIDwgMSAmJiAoYWRldi0+aW5fZ3B1X3Jlc2V0IHx8IGluX2ludGVycnVwdCgp
KSkKPiArCWlmIChyIDwgMSAmJiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpIHx8IGluX2ludGVycnVw
dCgpKSkKPiAgCQlnb3RvIGZhaWxlZF9raXFfcmVhZDsKPiAgCj4gIAltaWdodF9zbGVlcCgpOwo+
IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjEwXzAuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192MTBfMC5jCj4gaW5kZXggOGYyOWY3OWY4MjBk
Li4wM2I5M2U2Mjg1ODAgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
Z21jX3YxMF8wLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjEwXzAu
Ywo+IEBAIC0zNTYsNyArMzU2LDcgQEAgc3RhdGljIHZvaWQgZ21jX3YxMF8wX2ZsdXNoX2dwdV90
bGIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IHZtaWQsCj4gIAkgKi8KPiAg
CWlmIChhZGV2LT5nZngua2lxLnJpbmcuc2NoZWQucmVhZHkgJiYKPiAgCSAgICAoYW1kZ3B1X3Ny
aW92X3J1bnRpbWUoYWRldikgfHwgIWFtZGdwdV9zcmlvdl92ZihhZGV2KSkgJiYKPiAtCSAgICAh
YWRldi0+aW5fZ3B1X3Jlc2V0KSB7Cj4gKwkgICAgIWFtZGdwdV9pbl9yZXNldChhZGV2KSkgewo+
ICAKPiAgCQlzdHJ1Y3QgYW1kZ3B1X3ZtaHViICpodWIgPSAmYWRldi0+dm1odWJbdm1odWJdOwo+
ICAJCWNvbnN0IHVuc2lnbmVkIGVuZyA9IDE3Owo+IEBAIC0zODEsNyArMzgxLDcgQEAgc3RhdGlj
IHZvaWQgZ21jX3YxMF8wX2ZsdXNoX2dwdV90bGIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYs
IHVpbnQzMl90IHZtaWQsCj4gIAo+ICAJaWYgKCFhZGV2LT5tbWFuLmJ1ZmZlcl9mdW5jc19lbmFi
bGVkIHx8Cj4gIAkgICAgIWFkZXYtPmliX3Bvb2xfcmVhZHkgfHwKPiAtCSAgICBhZGV2LT5pbl9n
cHVfcmVzZXQgfHwKPiArCSAgICBhbWRncHVfaW5fcmVzZXQoYWRldikgfHwKPiAgCSAgICByaW5n
LT5zY2hlZC5yZWFkeSA9PSBmYWxzZSkgewo+ICAJCWdtY192MTBfMF9mbHVzaF92bV9odWIoYWRl
diwgdm1pZCwgQU1ER1BVX0dGWEhVQl8wLCAwKTsKPiAgCQltdXRleF91bmxvY2soJmFkZXYtPm1t
YW4uZ3R0X3dpbmRvd19sb2NrKTsKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvZ21jX3Y3XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192N18wLmMK
PiBpbmRleCBlMTgyOTZkYzEzODYuLjBmOGU4YWZmOTExNCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjdfMC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvZ21jX3Y3XzAuYwo+IEBAIC00MzQsNyArNDM0LDcgQEAgc3RhdGljIGludCBnbWNf
djdfMF9mbHVzaF9ncHVfdGxiX3Bhc2lkKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAJ
aW50IHZtaWQ7Cj4gIAl1bnNpZ25lZCBpbnQgdG1wOwo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVf
cmVzZXQpCj4gKwlpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICAJCXJldHVybiAtRUlPOwo+
ICAKPiAgCWZvciAodm1pZCA9IDE7IHZtaWQgPCAxNjsgdm1pZCsrKSB7Cj4gZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OF8wLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9nbWNfdjhfMC5jCj4gaW5kZXggYTllNzIyYjhhNDU4Li5hYmU2NDAxMGYwZDUg
MTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y4XzAuYwo+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OF8wLmMKPiBAQCAtNjM1LDcgKzYz
NSw3IEBAIHN0YXRpYyBpbnQgZ21jX3Y4XzBfZmx1c2hfZ3B1X3RsYl9wYXNpZChzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKPiAgCWludCB2bWlkOwo+ICAJdW5zaWduZWQgaW50IHRtcDsKPiAg
Cj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2
KSkKPiAgCQlyZXR1cm4gLUVJTzsKPiAgCj4gIAlmb3IgKHZtaWQgPSAxOyB2bWlkIDwgMTY7IHZt
aWQrKykgewo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjlf
MC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYwo+IGluZGV4IDZlNGYz
ZmY0ODEwZi4uMDc5NDQ3NThkMTgyIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2dtY192OV8wLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNf
djlfMC5jCj4gQEAgLTUwMSw3ICs1MDEsNyBAQCBzdGF0aWMgdm9pZCBnbWNfdjlfMF9mbHVzaF9n
cHVfdGxiKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50MzJfdCB2bWlkLAo+ICAJICov
Cj4gIAlpZiAoYWRldi0+Z2Z4LmtpcS5yaW5nLnNjaGVkLnJlYWR5ICYmCj4gIAkJCShhbWRncHVf
c3Jpb3ZfcnVudGltZShhZGV2KSB8fCAhYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKSAmJgo+IC0JCQkh
YWRldi0+aW5fZ3B1X3Jlc2V0KSB7Cj4gKwkJCSFhbWRncHVfaW5fcmVzZXQoYWRldikpIHsKPiAg
CQl1aW50MzJfdCByZXEgPSBodWItPnZtX2ludl9lbmcwX3JlcSArIGh1Yi0+ZW5nX2Rpc3RhbmNl
ICogZW5nOwo+ICAJCXVpbnQzMl90IGFjayA9IGh1Yi0+dm1faW52X2VuZzBfYWNrICsgaHViLT5l
bmdfZGlzdGFuY2UgKiBlbmc7Cj4gIAo+IEBAIC01OTYsNyArNTk2LDcgQEAgc3RhdGljIGludCBn
bWNfdjlfMF9mbHVzaF9ncHVfdGxiX3Bhc2lkKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+
ICAJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nID0gJmFkZXYtPmdmeC5raXEucmluZzsKPiAgCXN0
cnVjdCBhbWRncHVfa2lxICpraXEgPSAmYWRldi0+Z2Z4LmtpcTsKPiAgCj4gLQlpZiAoYWRldi0+
aW5fZ3B1X3Jlc2V0KQo+ICsJaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAgCQlyZXR1cm4g
LUVJTzsKPiAgCj4gIAlpZiAocmluZy0+c2NoZWQucmVhZHkpIHsKPiBAQCAtNjMzLDcgKzYzMyw3
IEBAIHN0YXRpYyBpbnQgZ21jX3Y5XzBfZmx1c2hfZ3B1X3RsYl9wYXNpZChzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiwKPiAgCQlzcGluX3VubG9jaygmYWRldi0+Z2Z4LmtpcS5yaW5nX2xvY2sp
Owo+ICAJCXIgPSBhbWRncHVfZmVuY2Vfd2FpdF9wb2xsaW5nKHJpbmcsIHNlcSwgYWRldi0+dXNl
Y190aW1lb3V0KTsKPiAgCQlpZiAociA8IDEpIHsKPiAtCQkJRFJNX0VSUk9SKCJ3YWl0IGZvciBr
aXEgZmVuY2UgZXJyb3I6ICVsZC5cbiIsIHIpOwo+ICsJCQlkZXZfaW5mbyhhZGV2LT5kZXYsICJ3
YWl0IGZvciBraXEgZmVuY2UgZXJyb3I6ICVsZFxuIiwgcik7Cj4gIAkJCXJldHVybiAtRVRJTUU7
Cj4gIAkJfQo+ICAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvbXhn
cHVfYWkuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L214Z3B1X2FpLmMKPiBpbmRleCA1
ZmQ2N2UxY2MyYTAuLmZlMzFjYmVjY2ZlOSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9teGdwdV9haS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
bXhncHVfYWkuYwo+IEBAIC0yMzgsMjAgKzIzOCwxNiBAQCBzdGF0aWMgdm9pZCB4Z3B1X2FpX21h
aWxib3hfZmxyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAJc3RydWN0IGFtZGdw
dV92aXJ0ICp2aXJ0ID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBhbWRncHVfdmlydCwgZmxy
X3dvcmspOwo+ICAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBjb250YWluZXJfb2Yodmly
dCwgc3RydWN0IGFtZGdwdV9kZXZpY2UsIHZpcnQpOwo+ICAJaW50IHRpbWVvdXQgPSBBSV9NQUlM
Qk9YX1BPTExfRkxSX1RJTUVET1VUOwo+IC0JaW50IGxvY2tlZDsKPiAgCj4gIAkvKiBibG9jayBh
bWRncHVfZ3B1X3JlY292ZXIgdGlsbCBtc2cgRkxSIENPTVBMRVRFIHJlY2VpdmVkLAo+ICAJICog
b3RoZXJ3aXNlIHRoZSBtYWlsYm94IG1zZyB3aWxsIGJlIHJ1aW5lZC9yZXNldGVkIGJ5Cj4gIAkg
KiB0aGUgVkYgRkxSLgo+ICAJICoKPiAtCSAqIHdlIGNhbiB1bmxvY2sgdGhlIGxvY2tfcmVzZXQg
dG8gYWxsb3cgImFtZGdwdV9qb2JfdGltZWRvdXQiCj4gKwkgKiB3ZSBjYW4gdW5sb2NrIHRoZSBy
ZXNldF9zZW0gdG8gYWxsb3cgImFtZGdwdV9qb2JfdGltZWRvdXQiCj4gIAkgKiB0byBydW4gZ3B1
X3JlY292ZXIoKSBhZnRlciBGTFJfTk9USUZJQ0FUSU9OX0NNUEwgcmVjZWl2ZWQKPiAgCSAqIHdo
aWNoIG1lYW5zIGhvc3Qgc2lkZSBoYWQgZmluaXNoZWQgdGhpcyBWRidzIEZMUi4KPiAgCSAqLwo+
IC0JbG9ja2VkID0gbXV0ZXhfdHJ5bG9jaygmYWRldi0+bG9ja19yZXNldCk7Cj4gLQlpZiAobG9j
a2VkKQo+IC0JCWFkZXYtPmluX2dwdV9yZXNldCA9IHRydWU7Cj4gLQo+ICsJZG93bl9yZWFkKCZh
ZGV2LT5yZXNldF9zZW0pOwo+ICAJZG8gewo+ICAJCWlmICh4Z3B1X2FpX21haWxib3hfcGVla19t
c2coYWRldikgPT0gSURIX0ZMUl9OT1RJRklDQVRJT05fQ01QTCkKPiAgCQkJZ290byBmbHJfZG9u
ZTsKPiBAQCAtMjYxLDEwICsyNTcsNyBAQCBzdGF0aWMgdm9pZCB4Z3B1X2FpX21haWxib3hfZmxy
X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAJfSB3aGlsZSAodGltZW91dCA+IDEp
Owo+ICAKPiAgZmxyX2RvbmU6Cj4gLQlpZiAobG9ja2VkKSB7Cj4gLQkJYWRldi0+aW5fZ3B1X3Jl
c2V0ID0gZmFsc2U7Cj4gLQkJbXV0ZXhfdW5sb2NrKCZhZGV2LT5sb2NrX3Jlc2V0KTsKPiAtCX0K
PiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAo+ICAJLyogVHJpZ2dlciByZWNvdmVy
eSBmb3Igd29ybGQgc3dpdGNoIGZhaWx1cmUgaWYgbm8gVERSICovCj4gIAlpZiAoYW1kZ3B1X2Rl
dmljZV9zaG91bGRfcmVjb3Zlcl9ncHUoYWRldikKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvbXhncHVfbnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L214
Z3B1X252LmMKPiBpbmRleCBjZTJiZjFmYjc5ZWQuLjZmNTUxNzJlODMzNyAxMDA2NDQKPiAtLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9teGdwdV9udi5jCj4gKysrIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvbXhncHVfbnYuYwo+IEBAIC0yNTksMjAgKzI1OSwxNiBAQCBzdGF0
aWMgdm9pZCB4Z3B1X252X21haWxib3hfZmxyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQo+ICAJc3RydWN0IGFtZGdwdV92aXJ0ICp2aXJ0ID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVj
dCBhbWRncHVfdmlydCwgZmxyX3dvcmspOwo+ICAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYg
PSBjb250YWluZXJfb2YodmlydCwgc3RydWN0IGFtZGdwdV9kZXZpY2UsIHZpcnQpOwo+ICAJaW50
IHRpbWVvdXQgPSBOVl9NQUlMQk9YX1BPTExfRkxSX1RJTUVET1VUOwo+IC0JaW50IGxvY2tlZDsK
PiAgCj4gIAkvKiBibG9jayBhbWRncHVfZ3B1X3JlY292ZXIgdGlsbCBtc2cgRkxSIENPTVBMRVRF
IHJlY2VpdmVkLAo+ICAJICogb3RoZXJ3aXNlIHRoZSBtYWlsYm94IG1zZyB3aWxsIGJlIHJ1aW5l
ZC9yZXNldGVkIGJ5Cj4gIAkgKiB0aGUgVkYgRkxSLgo+ICAJICoKPiAtCSAqIHdlIGNhbiB1bmxv
Y2sgdGhlIGxvY2tfcmVzZXQgdG8gYWxsb3cgImFtZGdwdV9qb2JfdGltZWRvdXQiCj4gKwkgKiB3
ZSBjYW4gdW5sb2NrIHRoZSByZXNldF9zZW0gdG8gYWxsb3cgImFtZGdwdV9qb2JfdGltZWRvdXQi
Cj4gIAkgKiB0byBydW4gZ3B1X3JlY292ZXIoKSBhZnRlciBGTFJfTk9USUZJQ0FUSU9OX0NNUEwg
cmVjZWl2ZWQKPiAgCSAqIHdoaWNoIG1lYW5zIGhvc3Qgc2lkZSBoYWQgZmluaXNoZWQgdGhpcyBW
RidzIEZMUi4KPiAgCSAqLwo+IC0JbG9ja2VkID0gbXV0ZXhfdHJ5bG9jaygmYWRldi0+bG9ja19y
ZXNldCk7Cj4gLQlpZiAobG9ja2VkKQo+IC0JCWFkZXYtPmluX2dwdV9yZXNldCA9IHRydWU7Cj4g
LQo+ICsJZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAJZG8gewo+ICAJCWlmICh4Z3B1
X252X21haWxib3hfcGVla19tc2coYWRldikgPT0gSURIX0ZMUl9OT1RJRklDQVRJT05fQ01QTCkK
PiAgCQkJZ290byBmbHJfZG9uZTsKPiBAQCAtMjgyLDEwICsyNzgsNyBAQCBzdGF0aWMgdm9pZCB4
Z3B1X252X21haWxib3hfZmxyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAJfSB3
aGlsZSAodGltZW91dCA+IDEpOwo+ICAKPiAgZmxyX2RvbmU6Cj4gLQlpZiAobG9ja2VkKSB7Cj4g
LQkJYWRldi0+aW5fZ3B1X3Jlc2V0ID0gZmFsc2U7Cj4gLQkJbXV0ZXhfdW5sb2NrKCZhZGV2LT5s
b2NrX3Jlc2V0KTsKPiAtCX0KPiArCXVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIAo+ICAJ
LyogVHJpZ2dlciByZWNvdmVyeSBmb3Igd29ybGQgc3dpdGNoIGZhaWx1cmUgaWYgbm8gVERSICov
Cj4gIAlpZiAoYW1kZ3B1X2RldmljZV9zaG91bGRfcmVjb3Zlcl9ncHUoYWRldikKPiBkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2Vy
LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIu
Ywo+IGluZGV4IGRkNTUwMDI1ZDFjMS4uMGI1NDA5Y2VkZTUyIDEwMDY0NAo+IC0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5jCj4gKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2VyLmMKPiBA
QCAtMzA0LDE1ICszMDQsMTcgQEAgc3RhdGljIHZvaWQgZGVhbGxvY2F0ZV92bWlkKHN0cnVjdCBk
ZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLAo+ICAJCQkJc3RydWN0IHFjbV9wcm9jZXNzX2Rldmlj
ZSAqcXBkLAo+ICAJCQkJc3RydWN0IHF1ZXVlICpxKQo+ICB7Cj4gLQkvKiBPbiBHRlggdjcsIENQ
IGRvZXNuJ3QgZmx1c2ggVEMgYXQgZGVxdWV1ZSAqLwo+IC0JaWYgKHEtPmRldmljZS0+ZGV2aWNl
X2luZm8tPmFzaWNfZmFtaWx5ID09IENISVBfSEFXQUlJKQo+IC0JCWlmIChmbHVzaF90ZXh0dXJl
X2NhY2hlX25vY3BzY2gocS0+ZGV2aWNlLCBxcGQpKQo+IC0JCQlwcl9lcnIoIkZhaWxlZCB0byBm
bHVzaCBUQ1xuIik7Cj4gKwlpZiAoIWRxbS0+aXNfcmVzZXR0aW5nKSB7Cj4gKwkJLyogT24gR0ZY
IHY3LCBDUCBkb2Vzbid0IGZsdXNoIFRDIGF0IGRlcXVldWUgKi8KPiArCQlpZiAocS0+ZGV2aWNl
LT5kZXZpY2VfaW5mby0+YXNpY19mYW1pbHkgPT0gQ0hJUF9IQVdBSUkpCj4gKwkJCWlmIChmbHVz
aF90ZXh0dXJlX2NhY2hlX25vY3BzY2gocS0+ZGV2aWNlLCBxcGQpKQo+ICsJCQkJcHJfZXJyKCJG
YWlsZWQgdG8gZmx1c2ggVENcbiIpOwo+ICAKPiAtCWtmZF9mbHVzaF90bGIocXBkX3RvX3BkZChx
cGQpKTsKPiArCQlrZmRfZmx1c2hfdGxiKHFwZF90b19wZGQocXBkKSk7Cj4gIAo+IC0JLyogUmVs
ZWFzZSB0aGUgdm1pZCBtYXBwaW5nICovCj4gLQlzZXRfcGFzaWRfdm1pZF9tYXBwaW5nKGRxbSwg
MCwgcXBkLT52bWlkKTsKPiArCQkvKiBSZWxlYXNlIHRoZSB2bWlkIG1hcHBpbmcgKi8KPiArCQlz
ZXRfcGFzaWRfdm1pZF9tYXBwaW5nKGRxbSwgMCwgcXBkLT52bWlkKTsKPiArCX0KPiAgCWRxbS0+
dm1pZF9wYXNpZFtxcGQtPnZtaWRdID0gMDsKPiAgCj4gIAlxcGQtPnZtaWQgPSAwOwo+IGRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfcHJvY2Vzcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX3Byb2Nlc3MuYwo+IGluZGV4IDAxM2MyYjAxOGVkYy4u
NzFiZTg5N2Q0YzJhIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tm
ZF9wcm9jZXNzLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfcHJvY2Vz
cy5jCj4gQEAgLTE1NTEsNiArMTU1MSwxMCBAQCBpbnQga2ZkX3Jlc2VydmVkX21lbV9tbWFwKHN0
cnVjdCBrZmRfZGV2ICpkZXYsIHN0cnVjdCBrZmRfcHJvY2VzcyAqcHJvY2VzcywKPiAgdm9pZCBr
ZmRfZmx1c2hfdGxiKHN0cnVjdCBrZmRfcHJvY2Vzc19kZXZpY2UgKnBkZCkKPiAgewo+ICAJc3Ry
dWN0IGtmZF9kZXYgKmRldiA9IHBkZC0+ZGV2Owo+ICsJc3RydWN0IGRldmljZV9xdWV1ZV9tYW5h
Z2VyICpkcW0gPSBkZXYtPmRxbTsKPiArCj4gKwlpZiAoZHFtLT5pc19yZXNldHRpbmcpCj4gKwkJ
cmV0dXJuOwo+ICAKPiAgCWlmIChkZXYtPmRxbS0+c2NoZWRfcG9saWN5ID09IEtGRF9TQ0hFRF9Q
T0xJQ1lfTk9fSFdTKSB7Cj4gIAkJLyogTm90aGluZyB0byBmbHVzaCB1bnRpbCBhIFZNSUQgaXMg
YXNzaWduZWQsIHdoaWNoCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxh
eS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1k
Z3B1X2RtL2FtZGdwdV9kbS5jCj4gaW5kZXggYjRlMTIwZTk1NDM4Li40MjYzNGZmYjljNjIgMTAw
NjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVf
ZG0uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1
X2RtLmMKPiBAQCAtMTY0MCw3ICsxNjQwLDcgQEAgc3RhdGljIGludCBkbV9zdXNwZW5kKHZvaWQg
KmhhbmRsZSkKPiAgCXN0cnVjdCBhbWRncHVfZGlzcGxheV9tYW5hZ2VyICpkbSA9ICZhZGV2LT5k
bTsKPiAgCWludCByZXQgPSAwOwo+ICAKPiAtCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQpIHsKPiAr
CWlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpIHsKPiAgCQltdXRleF9sb2NrKCZkbS0+ZGNfbG9j
ayk7Cj4gIAkJZG0tPmNhY2hlZF9kY19zdGF0ZSA9IGRjX2NvcHlfc3RhdGUoZG0tPmRjLT5jdXJy
ZW50X3N0YXRlKTsKPiAgCj4gQEAgLTE4MjYsNyArMTgyNiw3IEBAIHN0YXRpYyBpbnQgZG1fcmVz
dW1lKHZvaWQgKmhhbmRsZSkKPiAgCXN0cnVjdCBkY19zdGF0ZSAqZGNfc3RhdGU7Cj4gIAlpbnQg
aSwgciwgajsKPiAgCj4gLQlpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KSB7Cj4gKwlpZiAoYW1kZ3B1
X2luX3Jlc2V0KGFkZXYpKSB7Cj4gIAkJZGNfc3RhdGUgPSBkbS0+Y2FjaGVkX2RjX3N0YXRlOwo+
ICAKPiAgCQlyID0gZG1fZG11Yl9od19pbml0KGFkZXYpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL3Bvd2VycGxheS9hbWRncHVfc211LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L3Bvd2VycGxheS9hbWRncHVfc211LmMKPiBpbmRleCBmZTQ5NDhhYTY2MmYuLmRkMDgyMGVmMGY1
ZiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9hbWRncHVfc211
LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9hbWRncHVfc211LmMKPiBA
QCAtMTM0MSw3ICsxMzQxLDcgQEAgc3RhdGljIGludCBzbXVfZGlzYWJsZV9kcG1zKHN0cnVjdCBz
bXVfY29udGV4dCAqc211KQo+ICAJdWludDY0X3QgZmVhdHVyZXNfdG9fZGlzYWJsZTsKPiAgCWlu
dCByZXQgPSAwOwo+ICAJYm9vbCB1c2VfYmFjbyA9ICFzbXUtPmlzX2FwdSAmJgo+IC0JCSgoYWRl
di0+aW5fZ3B1X3Jlc2V0ICYmCj4gKwkJKChhbWRncHVfaW5fcmVzZXQoYWRldikgJiYKPiAgCQkg
IChhbWRncHVfYXNpY19yZXNldF9tZXRob2QoYWRldikgPT0gQU1EX1JFU0VUX01FVEhPRF9CQUNP
KSkgfHwKPiAgCQkgKChhZGV2LT5pbl9ydW5wbSB8fCBhZGV2LT5pbl9oaWJlcm5hdGUpICYmIGFt
ZGdwdV9hc2ljX3N1cHBvcnRzX2JhY28oYWRldikpKTsKPiAgCj4gZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2h3bWdyL3ZlZ2EyMF9od21nci5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9wb3dlcnBsYXkvaHdtZ3IvdmVnYTIwX2h3bWdyLmMKPiBpbmRleCAzYjg4Mzk2
NDE3NzAuLmJhY2JlMmZhMWY5YSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bv
d2VycGxheS9od21nci92ZWdhMjBfaHdtZ3IuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
cG93ZXJwbGF5L2h3bWdyL3ZlZ2EyMF9od21nci5jCj4gQEAgLTQ4NCw3ICs0ODQsNyBAQCBzdGF0
aWMgaW50IHZlZ2EyMF9zZXR1cF9hc2ljX3Rhc2soc3RydWN0IHBwX2h3bWdyICpod21ncikKPiAg
ewo+ICAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KikoaHdtZ3ItPmFkZXYpOwo+ICAJaW50IHJldCA9IDA7Cj4gLQlib29sIHVzZV9iYWNvID0gKGFk
ZXYtPmluX2dwdV9yZXNldCAmJgo+ICsJYm9vbCB1c2VfYmFjbyA9IChhbWRncHVfaW5fcmVzZXQo
YWRldikgJiYKPiAgCQkJIChhbWRncHVfYXNpY19yZXNldF9tZXRob2QoYWRldikgPT0gQU1EX1JF
U0VUX01FVEhPRF9CQUNPKSkgfHwKPiAgCQkoYWRldi0+aW5fcnVucG0gJiYgYW1kZ3B1X2FzaWNf
c3VwcG9ydHNfYmFjbyhhZGV2KSk7Cj4gIAo+IAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9hbWQtZ2Z4Cg==
