Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 300FA1A0F1B
	for <lists+amd-gfx@lfdr.de>; Tue,  7 Apr 2020 16:27:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 77F636E87F;
	Tue,  7 Apr 2020 14:27:31 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wr1-x441.google.com (mail-wr1-x441.google.com
 [IPv6:2a00:1450:4864:20::441])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C6A656E0DC
 for <amd-gfx@lists.freedesktop.org>; Tue,  7 Apr 2020 14:27:29 +0000 (UTC)
Received: by mail-wr1-x441.google.com with SMTP id w10so4152854wrm.4
 for <amd-gfx@lists.freedesktop.org>; Tue, 07 Apr 2020 07:27:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=/zHokF+5YLtp336jvNMK/qmk6Wh12XTlhco+RD+oAro=;
 b=sWdIlZ4MDiov1nBflbf6wleO6jF+sCiqdSDAIOW1rJogSJnc92pvdTR/VyUPNHx7xt
 mt8TXl5py+mpzXruM9UDdsN7SAqnZNlhW/a34OE3Vq9nLRRfo0uhZxiLzxrypLm8U1rX
 VL8Y1S1yiXicP9vl8CYpOTmwi+2RbJyQvO9mh9eRiLIWfDb9wiB+C82PHJwsV9nvZA8N
 k1vDzFATYE3CCP48HPp9U4M/8eU3p0gQLrogmpsRNTGVjkqLEcalhzKYOuTGBeyKFq1K
 RlV5vNf1/wKh5lQNqf2xUc3Ks43z1qhvSNr10HqL5QfEbtONNlX2iGt2CQvezsGGLewm
 ievg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=/zHokF+5YLtp336jvNMK/qmk6Wh12XTlhco+RD+oAro=;
 b=MRNXhUaAqXHdhDVJUGbgR5SrvRSYY5Onf6+4zK/sII3/YhAqpZTDn4yO1GfBQ1LQv5
 4KSbBsTFuyFXShnv0mY4JJqI4Xwpv1954NpEUBwjeXxXGtun9zNBqkdU+uAfv3UewkfE
 81zYjIiMYB5EIYzNG+sY19iLXOT84kK/xzgJPJFJN2RKTILMJiY2dcdcWU3JXsbLEiBB
 Cjwat7ZH6oqyX65xweNF6f0FOnATbTNKN3n/3L80YjB7u+25XS7NOUhtWwtXAyKOGbu7
 etj8iWjOxi0wnNaIl0XCTwBP7rWfDMuJdSwO97407rCRkw+kRvv8onsFR16HyHQ+CMx4
 CqDQ==
X-Gm-Message-State: AGi0PuatoiYhsJ3Dmtk+/9scQA1hZjRsPkfmo6mXbPHWtDRoN1XPqrXq
 1Bv8C1Rh/9n7OaUDdHsclyUyXrYO
X-Google-Smtp-Source: APiQypKM25H+kJJa1l77oYuWQebTWTFo5wO85OJNPDGNnY5yxiCdBASbDbwLT9Nw11SzdLoZKqOWkA==
X-Received: by 2002:adf:9e08:: with SMTP id u8mr3025625wre.155.1586269647826; 
 Tue, 07 Apr 2020 07:27:27 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:cb4:6800:b8cb:179f])
 by smtp.gmail.com with ESMTPSA id r4sm2733782wrj.57.2020.04.07.07.27.27
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 07 Apr 2020 07:27:27 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org, Felix.Kuehling@amd.com, Alex.Sierra@amd.com
Subject: [PATCH 2/4] drm/amdgpu: cleanup IB pool handling a bit
Date: Tue,  7 Apr 2020 16:27:23 +0200
Message-Id: <20200407142725.17668-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200407142725.17668-1-christian.koenig@amd.com>
References: <20200407142725.17668-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

Rml4IHRoZSBjb2Rpbmcgc3R5bGUsIG1vdmUgYW5kIHJlbmFtZSB0aGUgZGVmaW5pdGlvbnMgdG8K
YmV0dGVyIG1hdGNoIHdoYXQgdGhleSBhcmUgc3VwcG9zZWQgdG8gYmUgZG9pbmcuCgpTaWduZWQt
b2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmggICAgICAgICB8IDExICstLS0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jICAgICAgfCAgMyArLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2liLmMgICAgICB8IDY1ICsrKysrKysrKysrLS0t
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3JpbmcuaCAgICB8IDEz
ICsrKysrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdGVzdC5jICAgIHwgIDIg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyAgICAgfCAxMCArKy0t
CiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdXZkLmMgICAgIHwgIDQgKy0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92Y2UuYyAgICAgfCAgNSArLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYyB8IDExICsrLS0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2dtY192MTBfMC5jICAgICAgfCAgMyArLQogMTAgZmlsZXMgY2hh
bmdlZCwgNzEgaW5zZXJ0aW9ucygrKSwgNTYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHUuaAppbmRleCAzMmJjMmE4ODJmZDIuLjkxMjY3MWY1YTY2NSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmgKQEAgLTE5Miw4ICsxOTIsNiBAQCBleHRlcm4gaW50IGFt
ZGdwdV9jaWtfc3VwcG9ydDsKICNkZWZpbmUgQU1ER1BVX1dBSVRfSURMRV9USU1FT1VUX0lOX01T
CSAgICAgICAgMzAwMAogI2RlZmluZSBBTURHUFVfTUFYX1VTRUNfVElNRU9VVAkJCTEwMDAwMAkv
KiAxMDAgbXMgKi8KICNkZWZpbmUgQU1ER1BVX0ZFTkNFX0pJRkZJRVNfVElNRU9VVAkJKEhaIC8g
MikKLS8qIEFNREdQVV9JQl9QT09MX1NJWkUgbXVzdCBiZSBhIHBvd2VyIG9mIDIgKi8KLSNkZWZp
bmUgQU1ER1BVX0lCX1BPT0xfU0laRQkJCTE2CiAjZGVmaW5lIEFNREdQVV9ERUJVR0ZTX01BWF9D
T01QT05FTlRTCQkzMgogI2RlZmluZSBBTURHUFVGQl9DT05OX0xJTUlUCQkJNAogI2RlZmluZSBB
TURHUFVfQklPU19OVU1fU0NSQVRDSAkJCTE2CkBAIC0zOTAsMTMgKzM4OCw2IEBAIHN0cnVjdCBh
bWRncHVfc2FfYm8gewogaW50IGFtZGdwdV9mZW5jZV9zbGFiX2luaXQodm9pZCk7CiB2b2lkIGFt
ZGdwdV9mZW5jZV9zbGFiX2Zpbmkodm9pZCk7CiAKLWVudW0gYW1kZ3B1X2liX3Bvb2xfdHlwZSB7
Ci0JQU1ER1BVX0lCX1BPT0xfTk9STUFMID0gMCwKLQlBTURHUFVfSUJfUE9PTF9WTSwKLQlBTURH
UFVfSUJfUE9PTF9ESVJFQ1QsCi0KLQlBTURHUFVfSUJfUE9PTF9NQVgKLX07CiAvKgogICogSVJR
Uy4KICAqLwpAQCAtODU3LDcgKzg0OCw3IEBAIHN0cnVjdCBhbWRncHVfZGV2aWNlIHsKIAl1bnNp
Z25lZAkJCW51bV9yaW5nczsKIAlzdHJ1Y3QgYW1kZ3B1X3JpbmcJCSpyaW5nc1tBTURHUFVfTUFY
X1JJTkdTXTsKIAlib29sCQkJCWliX3Bvb2xfcmVhZHk7Ci0Jc3RydWN0IGFtZGdwdV9zYV9tYW5h
Z2VyCXJpbmdfdG1wX2JvW0FNREdQVV9JQl9QT09MX01BWF07CisJc3RydWN0IGFtZGdwdV9zYV9t
YW5hZ2VyCWliX3Bvb2xzW0FNREdQVV9JQl9QT09MX01BWF07CiAJc3RydWN0IGFtZGdwdV9zY2hl
ZAkJZ3B1X3NjaGVkW0FNREdQVV9IV19JUF9OVU1dW0FNREdQVV9SSU5HX1BSSU9fTUFYXTsKIAog
CS8qIGludGVycnVwdHMgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMKaW5k
ZXggNzlkZDRlZDgxNDZiLi4xZjE2YjBmZjM5NTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9jcy5jCkBAIC05MjEsNyArOTIxLDggQEAgc3RhdGljIGludCBhbWRncHVfY3NfaWJf
ZmlsbChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAogCQlyaW5nID0gdG9fYW1kZ3B1X3Jp
bmcoZW50aXR5LT5ycS0+c2NoZWQpOwogCQlyID0gIGFtZGdwdV9pYl9nZXQoYWRldiwgdm0sIHJp
bmctPmZ1bmNzLT5wYXJzZV9jcyA/Ci0JCQkJICAgY2h1bmtfaWItPmliX2J5dGVzIDogMCwgQU1E
R1BVX0lCX1BPT0xfTk9STUFMLCBpYik7CisJCQkJICAgY2h1bmtfaWItPmliX2J5dGVzIDogMCwK
KwkJCQkgICBBTURHUFVfSUJfUE9PTF9ERUxBWUVELCBpYik7CiAJCWlmIChyKSB7CiAJCQlEUk1f
RVJST1IoIkZhaWxlZCB0byBnZXQgaWIgIVxuIik7CiAJCQlyZXR1cm4gcjsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pYi5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2liLmMKaW5kZXggNzdlYWFiYTkyN2VlLi5lYzJjNWUxNjRjZDMg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pYi5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9pYi5jCkBAIC02MSwxNCArNjEsMTMg
QEAKICAqIFJldHVybnMgMCBvbiBzdWNjZXNzLCBlcnJvciBvbiBmYWlsdXJlLgogICovCiBpbnQg
YW1kZ3B1X2liX2dldChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV92
bSAqdm0sCi0JCXVuc2lnbmVkIHNpemUsCi0JCWVudW0gYW1kZ3B1X2liX3Bvb2xfdHlwZSBwb29s
X3R5cGUsCi0JCXN0cnVjdCBhbWRncHVfaWIgKmliKQorCQkgIHVuc2lnbmVkIHNpemUsIGVudW0g
YW1kZ3B1X2liX3Bvb2xfdHlwZSBwb29sX3R5cGUsCisJCSAgc3RydWN0IGFtZGdwdV9pYiAqaWIp
CiB7CiAJaW50IHI7CiAKIAlpZiAoc2l6ZSkgewotCQlyID0gYW1kZ3B1X3NhX2JvX25ldygmYWRl
di0+cmluZ190bXBfYm9bcG9vbF90eXBlXSwKKwkJciA9IGFtZGdwdV9zYV9ib19uZXcoJmFkZXYt
PmliX3Bvb2xzW3Bvb2xfdHlwZV0sCiAJCQkJICAgICAgJmliLT5zYV9ibywgc2l6ZSwgMjU2KTsK
IAkJaWYgKHIpIHsKIAkJCWRldl9lcnIoYWRldi0+ZGV2LCAiZmFpbGVkIHRvIGdldCBhIG5ldyBJ
QiAoJWQpXG4iLCByKTsKQEAgLTMwMiwzMCArMzAxLDMyIEBAIGludCBhbWRncHVfaWJfc2NoZWR1
bGUoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCB1bnNpZ25lZCBudW1faWJzLAogICovCiBpbnQg
YW1kZ3B1X2liX3Bvb2xfaW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKLQlpbnQg
ciwgaTsKIAl1bnNpZ25lZCBzaXplOworCWludCByLCBpOwogCi0JaWYgKGFkZXYtPmliX3Bvb2xf
cmVhZHkpIHsKKwlpZiAoYWRldi0+aWJfcG9vbF9yZWFkeSkKIAkJcmV0dXJuIDA7Ci0JfQorCiAJ
Zm9yIChpID0gMDsgaSA8IEFNREdQVV9JQl9QT09MX01BWDsgaSsrKSB7CiAJCWlmIChpID09IEFN
REdQVV9JQl9QT09MX0RJUkVDVCkKIAkJCXNpemUgPSBQQUdFX1NJWkUgKiAyOwogCQllbHNlCi0J
CQlzaXplID0gQU1ER1BVX0lCX1BPT0xfU0laRSo2NCoxMDI0OwotCQlyID0gYW1kZ3B1X3NhX2Jv
X21hbmFnZXJfaW5pdChhZGV2LCAmYWRldi0+cmluZ190bXBfYm9baV0sCi0JCQkJc2l6ZSwKLQkJ
CQlBTURHUFVfR1BVX1BBR0VfU0laRSwKLQkJCQlBTURHUFVfR0VNX0RPTUFJTl9HVFQpOwotCQlp
ZiAocikgewotCQkJZm9yIChpLS07IGkgPj0gMDsgaS0tKQotCQkJCWFtZGdwdV9zYV9ib19tYW5h
Z2VyX2ZpbmkoYWRldiwgJmFkZXYtPnJpbmdfdG1wX2JvW2ldKTsKLQkJCXJldHVybiByOwotCQl9
CisJCQlzaXplID0gQU1ER1BVX0lCX1BPT0xfU0laRTsKKworCQlyID0gYW1kZ3B1X3NhX2JvX21h
bmFnZXJfaW5pdChhZGV2LCAmYWRldi0+aWJfcG9vbHNbaV0sCisJCQkJCSAgICAgIHNpemUsIEFN
REdQVV9HUFVfUEFHRV9TSVpFLAorCQkJCQkgICAgICBBTURHUFVfR0VNX0RPTUFJTl9HVFQpOwor
CQlpZiAocikKKwkJCWdvdG8gZXJyb3I7CiAJfQogCWFkZXYtPmliX3Bvb2xfcmVhZHkgPSB0cnVl
OwogCiAJcmV0dXJuIDA7CisKK2Vycm9yOgorCXdoaWxlIChpLS0pCisJCWFtZGdwdV9zYV9ib19t
YW5hZ2VyX2ZpbmkoYWRldiwgJmFkZXYtPmliX3Bvb2xzW2ldKTsKKwlyZXR1cm4gcjsKIH0KIAog
LyoqCkBAIC0zNDAsMTEgKzM0MSwxMiBAQCB2b2lkIGFtZGdwdV9pYl9wb29sX2Zpbmkoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiB7CiAJaW50IGk7CiAKLQlpZiAoYWRldi0+aWJfcG9vbF9y
ZWFkeSkgewotCQlmb3IgKGkgPSAwOyBpIDwgQU1ER1BVX0lCX1BPT0xfTUFYOyBpKyspCi0JCQlh
bWRncHVfc2FfYm9fbWFuYWdlcl9maW5pKGFkZXYsICZhZGV2LT5yaW5nX3RtcF9ib1tpXSk7Ci0J
CWFkZXYtPmliX3Bvb2xfcmVhZHkgPSBmYWxzZTsKLQl9CisJaWYgKCFhZGV2LT5pYl9wb29sX3Jl
YWR5KQorCQlyZXR1cm47CisKKwlmb3IgKGkgPSAwOyBpIDwgQU1ER1BVX0lCX1BPT0xfTUFYOyBp
KyspCisJCWFtZGdwdV9zYV9ib19tYW5hZ2VyX2ZpbmkoYWRldiwgJmFkZXYtPmliX3Bvb2xzW2ld
KTsKKwlhZGV2LT5pYl9wb29sX3JlYWR5ID0gZmFsc2U7CiB9CiAKIC8qKgpAQCAtMzU5LDkgKzM2
MSw5IEBAIHZvaWQgYW1kZ3B1X2liX3Bvb2xfZmluaShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
dikKICAqLwogaW50IGFtZGdwdV9pYl9yaW5nX3Rlc3RzKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2KQogewotCXVuc2lnbmVkIGk7Ci0JaW50IHIsIHJldCA9IDA7CiAJbG9uZyB0bW9fZ2Z4LCB0
bW9fbW07CisJaW50IHIsIHJldCA9IDA7CisJdW5zaWduZWQgaTsKIAogCXRtb19tbSA9IHRtb19n
ZnggPSBBTURHUFVfSUJfVEVTVF9USU1FT1VUOwogCWlmIChhbWRncHVfc3Jpb3ZfdmYoYWRldikp
IHsKQEAgLTQzOSwxNSArNDQxLDE2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RlYnVnZnNfc2FfaW5m
byhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IG5vZGUtPm1pbm9yLT5kZXY7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBkZXYt
PmRldl9wcml2YXRlOwogCi0Jc2VxX3ByaW50ZihtLCAiLS0tLS0tLS0tLS0tLS0tLS0tLS0gTk9S
TUFMIC0tLS0tLS0tLS0tLS0tLS0tLS0tIFxuIik7Ci0JYW1kZ3B1X3NhX2JvX2R1bXBfZGVidWdf
aW5mbygmYWRldi0+cmluZ190bXBfYm9bQU1ER1BVX0lCX1BPT0xfTk9STUFMXSwgbSk7Ci0Jc2Vx
X3ByaW50ZihtLCAiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBWTSAtLS0tLS0tLS0tLS0tLS0tLS0t
LS0tIFxuIik7Ci0JYW1kZ3B1X3NhX2JvX2R1bXBfZGVidWdfaW5mbygmYWRldi0+cmluZ190bXBf
Ym9bQU1ER1BVX0lCX1BPT0xfVk1dLCBtKTsKLQlzZXFfcHJpbnRmKG0sICItLS0tLS0tLS0tLS0t
LS0tLS0tLSBESVJFQ1QtLS0tLS0tLS0tLS0tLS0tLS0tLS0gXG4iKTsKLQlhbWRncHVfc2FfYm9f
ZHVtcF9kZWJ1Z19pbmZvKCZhZGV2LT5yaW5nX3RtcF9ib1tBTURHUFVfSUJfUE9PTF9ESVJFQ1Rd
LCBtKTsKKwlzZXFfcHJpbnRmKG0sICItLS0tLS0tLS0tLS0tLS0tLS0tLS0gREVMQVlFRCAtLS0t
LS0tLS0tLS0tLS0tLS0tLS0gXG4iKTsKKwlhbWRncHVfc2FfYm9fZHVtcF9kZWJ1Z19pbmZvKCZh
ZGV2LT5pYl9wb29sc1tBTURHUFVfSUJfUE9PTF9ERUxBWUVEXSwKKwkJCQkgICAgIG0pOworCXNl
cV9wcmludGYobSwgIi0tLS0tLS0tLS0tLS0tLS0tLS0tIElNTUVESUFURSAtLS0tLS0tLS0tLS0t
LS0tLS0tLSBcbiIpOworCWFtZGdwdV9zYV9ib19kdW1wX2RlYnVnX2luZm8oJmFkZXYtPmliX3Bv
b2xzW0FNREdQVV9JQl9QT09MX0lNTUVESUFURV0sCisJCQkJICAgICBtKTsKKwlzZXFfcHJpbnRm
KG0sICItLS0tLS0tLS0tLS0tLS0tLS0tLS0gRElSRUNUIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0g
XG4iKTsKKwlhbWRncHVfc2FfYm9fZHVtcF9kZWJ1Z19pbmZvKCZhZGV2LT5pYl9wb29sc1tBTURH
UFVfSUJfUE9PTF9ESVJFQ1RdLCBtKTsKIAogCXJldHVybiAwOwotCiB9CiAKIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgZHJtX2luZm9fbGlzdCBhbWRncHVfZGVidWdmc19zYV9saXN0W10gPSB7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmluZy5oIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3JpbmcuaAppbmRleCBiZmQ2MzRhZWRmMjYuLmVm
ZDc2MjdiM2Y2OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3JpbmcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmluZy5oCkBA
IC01MCw2ICs1MCw4IEBACiAKICNkZWZpbmUgdG9fYW1kZ3B1X3JpbmcocykgY29udGFpbmVyX29m
KChzKSwgc3RydWN0IGFtZGdwdV9yaW5nLCBzY2hlZCkKIAorI2RlZmluZSBBTURHUFVfSUJfUE9P
TF9TSVpFCSgxMDI0ICogMTAyNCkKKwogZW51bSBhbWRncHVfcmluZ190eXBlIHsKIAlBTURHUFVf
UklOR19UWVBFX0dGWAkJPSBBTURHUFVfSFdfSVBfR0ZYLAogCUFNREdQVV9SSU5HX1RZUEVfQ09N
UFVURQk9IEFNREdQVV9IV19JUF9DT01QVVRFLApAQCAtNjMsNiArNjUsMTcgQEAgZW51bSBhbWRn
cHVfcmluZ190eXBlIHsKIAlBTURHUFVfUklOR19UWVBFX0tJUQogfTsKIAorZW51bSBhbWRncHVf
aWJfcG9vbF90eXBlIHsKKwkvKiBOb3JtYWwgc3VibWlzc2lvbnMgdG8gdGhlIHRvcCBvZiB0aGUg
cGlwZWxpbmUuICovCisJQU1ER1BVX0lCX1BPT0xfREVMQVlFRCwKKwkvKiBJbW1lZGlhdGUgc3Vi
bWlzc2lvbnMgdG8gdGhlIGJvdHRvbSBvZiB0aGUgcGlwZWxpbmUuICovCisJQU1ER1BVX0lCX1BP
T0xfSU1NRURJQVRFLAorCS8qIERpcmVjdCBzdWJtaXNzaW9uIHRvIHRoZSByaW5nIGJ1ZmZlciBk
dXJpbmcgaW5pdCBhbmQgcmVzZXQuICovCisJQU1ER1BVX0lCX1BPT0xfRElSRUNULAorCisJQU1E
R1BVX0lCX1BPT0xfTUFYCit9OworCiBzdHJ1Y3QgYW1kZ3B1X2RldmljZTsKIHN0cnVjdCBhbWRn
cHVfcmluZzsKIHN0cnVjdCBhbWRncHVfaWI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3Rlc3QuYwppbmRleCA0NzZmMWY4OWFhYWQuLjJmNGQ1Y2E5ODk0ZiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Rlc3QuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdGVzdC5jCkBAIC00NCw3ICs0NCw3IEBAIHN0YXRpYyB2
b2lkIGFtZGdwdV9kb190ZXN0X21vdmVzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCS8q
IE51bWJlciBvZiB0ZXN0cyA9CiAJICogKFRvdGFsIEdUVCAtIElCIHBvb2wgLSB3cml0ZWJhY2sg
cGFnZSAtIHJpbmcgYnVmZmVycykgLyB0ZXN0IHNpemUKIAkgKi8KLQluID0gYWRldi0+Z21jLmdh
cnRfc2l6ZSAtIEFNREdQVV9JQl9QT09MX1NJWkUqNjQqMTAyNDsKKwluID0gYWRldi0+Z21jLmdh
cnRfc2l6ZSAtIEFNREdQVV9JQl9QT09MX1NJWkU7CiAJZm9yIChpID0gMDsgaSA8IEFNREdQVV9N
QVhfUklOR1M7ICsraSkKIAkJaWYgKGFkZXYtPnJpbmdzW2ldKQogCQkJbiAtPSBhZGV2LT5yaW5n
c1tpXS0+cmluZ19zaXplOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCmlu
ZGV4IDFiNjU4ZTkwNTYyMC4uMTUzYWY1YmRiZWMxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X3R0bS5jCkBAIC0zMzcsNyArMzM3LDcgQEAgc3RhdGljIGludCBhbWRncHVfdHRt
X21hcF9idWZmZXIoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAludW1fYnl0ZXMgPSBu
dW1fcGFnZXMgKiA4OwogCiAJciA9IGFtZGdwdV9qb2JfYWxsb2Nfd2l0aF9pYihhZGV2LCBudW1f
ZHcgKiA0ICsgbnVtX2J5dGVzLAotCQkJCSAgICAgQU1ER1BVX0lCX1BPT0xfTk9STUFMLCAmam9i
KTsKKwkJCQkgICAgIEFNREdQVV9JQl9QT09MX0RFTEFZRUQsICZqb2IpOwogCWlmIChyKQogCQly
ZXR1cm4gcjsKIApAQCAtMjEyNyw2ICsyMTI3LDggQEAgaW50IGFtZGdwdV9jb3B5X2J1ZmZlcihz
dHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQ2NF90IHNyY19vZmZzZXQsCiAJCSAgICAgICBz
dHJ1Y3QgZG1hX2ZlbmNlICoqZmVuY2UsIGJvb2wgZGlyZWN0X3N1Ym1pdCwKIAkJICAgICAgIGJv
b2wgdm1fbmVlZHNfZmx1c2gsIGJvb2wgdG16KQogeworCWVudW0gYW1kZ3B1X2liX3Bvb2xfdHlw
ZSBwb29sID0gZGlyZWN0X3N1Ym1pdCA/IEFNREdQVV9JQl9QT09MX0RJUkVDVCA6CisJCUFNREdQ
VV9JQl9QT09MX0RFTEFZRUQ7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5nLT5h
ZGV2OwogCXN0cnVjdCBhbWRncHVfam9iICpqb2I7CiAKQEAgLTIxNDQsOCArMjE0Niw3IEBAIGlu
dCBhbWRncHVfY29weV9idWZmZXIoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCB1aW50NjRfdCBz
cmNfb2Zmc2V0LAogCW51bV9sb29wcyA9IERJVl9ST1VORF9VUChieXRlX2NvdW50LCBtYXhfYnl0
ZXMpOwogCW51bV9kdyA9IEFMSUdOKG51bV9sb29wcyAqIGFkZXYtPm1tYW4uYnVmZmVyX2Z1bmNz
LT5jb3B5X251bV9kdywgOCk7CiAKLQlyID0gYW1kZ3B1X2pvYl9hbGxvY193aXRoX2liKGFkZXYs
IG51bV9kdyAqIDQsCi0JCQlkaXJlY3Rfc3VibWl0ID8gQU1ER1BVX0lCX1BPT0xfRElSRUNUIDog
QU1ER1BVX0lCX1BPT0xfTk9STUFMLCAmam9iKTsKKwlyID0gYW1kZ3B1X2pvYl9hbGxvY193aXRo
X2liKGFkZXYsIG51bV9kdyAqIDQsIHBvb2wsICZqb2IpOwogCWlmIChyKQogCQlyZXR1cm4gcjsK
IApAQCAtMjIzNCw3ICsyMjM1LDggQEAgaW50IGFtZGdwdV9maWxsX2J1ZmZlcihzdHJ1Y3QgYW1k
Z3B1X2JvICpibywKIAkvKiBmb3IgSUIgcGFkZGluZyAqLwogCW51bV9kdyArPSA2NDsKIAotCXIg
PSBhbWRncHVfam9iX2FsbG9jX3dpdGhfaWIoYWRldiwgbnVtX2R3ICogNCwgQU1ER1BVX0lCX1BP
T0xfTk9STUFMLCAmam9iKTsKKwlyID0gYW1kZ3B1X2pvYl9hbGxvY193aXRoX2liKGFkZXYsIG51
bV9kdyAqIDQsIEFNREdQVV9JQl9QT09MX0RFTEFZRUQsCisJCQkJICAgICAmam9iKTsKIAlpZiAo
cikKIAkJcmV0dXJuIHI7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV91dmQuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91dmQuYwpp
bmRleCA1NTAyODJkOWMxZmMuLjUxMDBlYmU4ODU4ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV91dmQuYwpAQCAtMTA1Niw4ICsxMDU2LDggQEAgc3RhdGljIGludCBhbWRncHVf
dXZkX3NlbmRfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgc3RydWN0IGFtZGdwdV9ibyAq
Ym8sCiAJCQlnb3RvIGVycjsKIAl9CiAKLQlyID0gYW1kZ3B1X2pvYl9hbGxvY193aXRoX2liKGFk
ZXYsIDY0LAotCQkJZGlyZWN0ID8gQU1ER1BVX0lCX1BPT0xfRElSRUNUIDogQU1ER1BVX0lCX1BP
T0xfTk9STUFMLCAmam9iKTsKKwlyID0gYW1kZ3B1X2pvYl9hbGxvY193aXRoX2liKGFkZXYsIDY0
LCBkaXJlY3QgPyBBTURHUFVfSUJfUE9PTF9ESVJFQ1QgOgorCQkJCSAgICAgQU1ER1BVX0lCX1BP
T0xfREVMQVlFRCwgJmpvYik7CiAJaWYgKHIpCiAJCWdvdG8gZXJyOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfdmNlLmMKaW5kZXggZDA5MDQ1NTI4MmU1Li5lY2FhMmQ3NDgzYjIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92Y2UuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmNlLmMKQEAgLTQ0Nyw3ICs0NDcs
NyBAQCBzdGF0aWMgaW50IGFtZGdwdV92Y2VfZ2V0X2NyZWF0ZV9tc2coc3RydWN0IGFtZGdwdV9y
aW5nICpyaW5nLCB1aW50MzJfdCBoYW5kbGUsCiAJaW50IGksIHI7CiAKIAlyID0gYW1kZ3B1X2pv
Yl9hbGxvY193aXRoX2liKHJpbmctPmFkZXYsIGliX3NpemVfZHcgKiA0LAotCQkJCQlBTURHUFVf
SUJfUE9PTF9ESVJFQ1QsICZqb2IpOworCQkJCSAgICAgQU1ER1BVX0lCX1BPT0xfRElSRUNULCAm
am9iKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKQEAgLTUyNiw3ICs1MjYsOCBAQCBzdGF0aWMg
aW50IGFtZGdwdV92Y2VfZ2V0X2Rlc3Ryb3lfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywg
dWludDMyX3QgaGFuZGxlLAogCWludCBpLCByOwogCiAJciA9IGFtZGdwdV9qb2JfYWxsb2Nfd2l0
aF9pYihyaW5nLT5hZGV2LCBpYl9zaXplX2R3ICogNCwKLQkJCWRpcmVjdCA/IEFNREdQVV9JQl9Q
T09MX0RJUkVDVCA6IEFNREdQVV9JQl9QT09MX05PUk1BTCwgJmpvYik7CisJCQkJICAgICBkaXJl
Y3QgPyBBTURHUFVfSUJfUE9PTF9ESVJFQ1QgOgorCQkJCSAgICAgQU1ER1BVX0lCX1BPT0xfREVM
QVlFRCwgJmpvYik7CiAJaWYgKHIpCiAJCXJldHVybiByOwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYwppbmRleCBmYmQ0NTFmMzU1OWEuLmI5NmM4ZDlhMTk0
NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCkBAIC02
MSwxMSArNjEsMTIgQEAgc3RhdGljIGludCBhbWRncHVfdm1fc2RtYV9wcmVwYXJlKHN0cnVjdCBh
bWRncHVfdm1fdXBkYXRlX3BhcmFtcyAqcCwKIAkJCQkgIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwK
IAkJCQkgIGVudW0gYW1kZ3B1X3N5bmNfbW9kZSBzeW5jX21vZGUpCiB7CisJZW51bSBhbWRncHVf
aWJfcG9vbF90eXBlIHBvb2wgPSBwLT5kaXJlY3QgPyBBTURHUFVfSUJfUE9PTF9JTU1FRElBVEUg
OgorCQlBTURHUFVfSUJfUE9PTF9ERUxBWUVEOwogCXVuc2lnbmVkIGludCBuZHcgPSBBTURHUFVf
Vk1fU0RNQV9NSU5fTlVNX0RXOwogCWludCByOwogCi0JciA9IGFtZGdwdV9qb2JfYWxsb2Nfd2l0
aF9pYihwLT5hZGV2LCBuZHcgKiA0LAotCQkJcC0+ZGlyZWN0ID8gQU1ER1BVX0lCX1BPT0xfVk0g
OiBBTURHUFVfSUJfUE9PTF9OT1JNQUwsICZwLT5qb2IpOworCXIgPSBhbWRncHVfam9iX2FsbG9j
X3dpdGhfaWIocC0+YWRldiwgbmR3ICogNCwgcG9vbCwgJnAtPmpvYik7CiAJaWYgKHIpCiAJCXJl
dHVybiByOwogCkBAIC0xOTksNiArMjAwLDggQEAgc3RhdGljIGludCBhbWRncHVfdm1fc2RtYV91
cGRhdGUoc3RydWN0IGFtZGdwdV92bV91cGRhdGVfcGFyYW1zICpwLAogCQkJCSB1aW50NjRfdCBh
ZGRyLCB1bnNpZ25lZCBjb3VudCwgdWludDMyX3QgaW5jciwKIAkJCQkgdWludDY0X3QgZmxhZ3Mp
CiB7CisJZW51bSBhbWRncHVfaWJfcG9vbF90eXBlIHBvb2wgPSBwLT5kaXJlY3QgPyBBTURHUFVf
SUJfUE9PTF9JTU1FRElBVEUgOgorCQlBTURHUFVfSUJfUE9PTF9ERUxBWUVEOwogCXVuc2lnbmVk
IGludCBpLCBuZHcsIG5wdGVzOwogCXVpbnQ2NF90ICpwdGU7CiAJaW50IHI7CkBAIC0yMjQsOCAr
MjI3LDggQEAgc3RhdGljIGludCBhbWRncHVfdm1fc2RtYV91cGRhdGUoc3RydWN0IGFtZGdwdV92
bV91cGRhdGVfcGFyYW1zICpwLAogCQkJbmR3ID0gbWF4KG5kdywgQU1ER1BVX1ZNX1NETUFfTUlO
X05VTV9EVyk7CiAJCQluZHcgPSBtaW4obmR3LCBBTURHUFVfVk1fU0RNQV9NQVhfTlVNX0RXKTsK
IAotCQkJciA9IGFtZGdwdV9qb2JfYWxsb2Nfd2l0aF9pYihwLT5hZGV2LCBuZHcgKiA0LAotCQkJ
CQlwLT5kaXJlY3QgPyBBTURHUFVfSUJfUE9PTF9WTSA6IEFNREdQVV9JQl9QT09MX05PUk1BTCwg
JnAtPmpvYik7CisJCQlyID0gYW1kZ3B1X2pvYl9hbGxvY193aXRoX2liKHAtPmFkZXYsIG5kdyAq
IDQsIHBvb2wsCisJCQkJCQkgICAgICZwLT5qb2IpOwogCQkJaWYgKHIpCiAJCQkJcmV0dXJuIHI7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192MTBfMC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3YxMF8wLmMKaW5kZXggNzhkNzY5ZTEzNjQz
Li4wNjU1Y2Q0Zjc3YTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dt
Y192MTBfMC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192MTBfMC5jCkBA
IC0zNjksNyArMzY5LDggQEAgc3RhdGljIHZvaWQgZ21jX3YxMF8wX2ZsdXNoX2dwdV90bGIoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IHZtaWQsCiAJICogdHJhbnNsYXRpb24u
IEF2b2lkIHRoaXMgYnkgZG9pbmcgdGhlIGludmFsaWRhdGlvbiBmcm9tIHRoZSBTRE1BCiAJICog
aXRzZWxmLgogCSAqLwotCXIgPSBhbWRncHVfam9iX2FsbG9jX3dpdGhfaWIoYWRldiwgMTYgKiA0
LCBBTURHUFVfSUJfUE9PTF9WTSwgJmpvYik7CisJciA9IGFtZGdwdV9qb2JfYWxsb2Nfd2l0aF9p
YihhZGV2LCAxNiAqIDQsIEFNREdQVV9JQl9QT09MX0lNTUVESUFURSwKKwkJCQkgICAgICZqb2Ip
OwogCWlmIChyKQogCQlnb3RvIGVycm9yX2FsbG9jOwogCi0tIAoyLjE3LjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBsaXN0
CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeAo=
