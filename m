Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D2504233989
	for <lists+amd-gfx@lfdr.de>; Thu, 30 Jul 2020 22:04:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 728E56E966;
	Thu, 30 Jul 2020 20:04:46 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x842.google.com (mail-qt1-x842.google.com
 [IPv6:2607:f8b0:4864:20::842])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6FD8B6E96A
 for <amd-gfx@lists.freedesktop.org>; Thu, 30 Jul 2020 20:04:41 +0000 (UTC)
Received: by mail-qt1-x842.google.com with SMTP id w9so21312541qts.6
 for <amd-gfx@lists.freedesktop.org>; Thu, 30 Jul 2020 13:04:41 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=DOqIZh6vnFY9luubhyTq1HLfdPTJm2Uuorq1rT/F/K4=;
 b=eoGPzSu5ocJuEJLnOAFh9IrcPApwmElRe5ogy10h1aUEUts2L+F+q9VjAXYRv8RcmY
 NQLQlHm+lgVivu7lG6Tr3OhlktN0Zigfa6O1K4/JtKgKjDW8BkJEpjnK5FnONVda9Yzx
 DaTj5Pt3Wj5LhKrW0f0K8W+Wb5k5Y93OXalhmgUKhRIqJVqFafX1bMdo8edLwPYHV1S5
 HUI4Q3SPjPl7HS92/0Vvue/1y36KOMNkadcBIWG28ULysVHvZfD+y90YTTWa5/6qIzcp
 yxI1V914Pu62x2VGw83gvkfC6uNDHfTUPjZL4ERajUcpgxGopWevNu3+BR3NOdbTAiwR
 qmUA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=DOqIZh6vnFY9luubhyTq1HLfdPTJm2Uuorq1rT/F/K4=;
 b=rma7LJFzGeZKtUdp1rHAglyteVbthQXCXHQw+37M3h/3875UBCcLt+k7ppYZxZOoe9
 bDzeH5pvvx+drJ/ZV+vvh/bu/SBoadn1DQ5a4jryV2R7sqB8Hxxi/RNGElnCOTKOmNKM
 amrVh8upA+DSn/JJ5jhX17obh1/b3IwoojNNf6XmlYcL5l2jSWL5UYwxQl0X/5eYlqWb
 iZK6S2An6+7jAb+tDWjXT+KgKxd5NiTETNqvl5aEX8O+3KOnDinJ0eJ8mWoUd+ymWVxW
 vTYSnE86otQEm8yoW6Ewj5xtliBHJKgSmpsk1YpQiCi3f2jzTsm9bIfvR0rcBG+xR2+g
 Bk1A==
X-Gm-Message-State: AOAM533C8ZHVazxvsXIujGZJ/7m4UAaqstfi99m+kRuTM4/YUEj3e7zb
 lCCI3+86MzW3yFu5sasnXN6FUp9v
X-Google-Smtp-Source: ABdhPJx8nS+vG2N27RihpwkExxfd1pdIgGblUHNoW6jvLk9/rG+zNe3bA2I+kHjmpboths1H0NHbtw==
X-Received: by 2002:ac8:428f:: with SMTP id o15mr315761qtl.213.1596139479214; 
 Thu, 30 Jul 2020 13:04:39 -0700 (PDT)
Received: from localhost.localdomain ([71.219.66.138])
 by smtp.gmail.com with ESMTPSA id d8sm5652757qtr.12.2020.07.30.13.04.38
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 30 Jul 2020 13:04:38 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 15/17] drm/amdgpu: move stolen memory from gmc to mman
Date: Thu, 30 Jul 2020 16:04:12 -0400
Message-Id: <20200730200414.40485-16-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.25.4
In-Reply-To: <20200730200414.40485-1-alexander.deucher@amd.com>
References: <20200730200414.40485-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

SXQncyBtb3JlIHJlbGF0ZWQgdG8gbWVtb3J5IG1hbmFnZW1lbnQgdGhhbiBtZW1vcnkKY29udHJv
bGxlci4KClJldmlld2VkLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFt
ZC5jb20+ClNpZ25lZC1vZmYtYnk6IEFsZXggRGV1Y2hlciA8YWxleGFuZGVyLmRldWNoZXJAYW1k
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ21jLmMgfCAxMiAr
KysrKystLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuaCB8ICA1
IC0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgfCAyMCArKysr
KysrKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5o
IHwgIDYgKysrKysrCiA0IGZpbGVzIGNoYW5nZWQsIDIyIGluc2VydGlvbnMoKyksIDIxIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9n
bWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuYwppbmRleCAwYmQ3
YjM3OTc1MzQuLjIxM2VmMDkwYmIwZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2dtYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9nbWMuYwpAQCAtNDQ5LDEwICs0NDksMTAgQEAgdm9pZCBhbWRncHVfZ21jX2dldF92Ymlvc19h
bGxvY2F0aW9ucyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAljYXNlIENISVBfVkVHQTEw
OgogCWNhc2UgQ0hJUF9SQVZFTjoKIAljYXNlIENISVBfUkVOT0lSOgotCQlhZGV2LT5nbWMua2Vl
cF9zdG9sZW5fdmdhX21lbW9yeSA9IHRydWU7CisJCWFkZXYtPm1tYW4ua2VlcF9zdG9sZW5fdmdh
X21lbW9yeSA9IHRydWU7CiAJCWJyZWFrOwogCWRlZmF1bHQ6Ci0JCWFkZXYtPmdtYy5rZWVwX3N0
b2xlbl92Z2FfbWVtb3J5ID0gZmFsc2U7CisJCWFkZXYtPm1tYW4ua2VlcF9zdG9sZW5fdmdhX21l
bW9yeSA9IGZhbHNlOwogCQlicmVhazsKIAl9CiAKQEAgLTQ2NiwxMCArNDY2LDEwIEBAIHZvaWQg
YW1kZ3B1X2dtY19nZXRfdmJpb3NfYWxsb2NhdGlvbnMoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYpCiAJCXNpemUgPSAwOwogCiAJaWYgKHNpemUgPiBBTURHUFVfVkJJT1NfVkdBX0FMTE9DQVRJ
T04pIHsKLQkJYWRldi0+Z21jLnN0b2xlbl92Z2Ffc2l6ZSA9IEFNREdQVV9WQklPU19WR0FfQUxM
T0NBVElPTjsKLQkJYWRldi0+Z21jLnN0b2xlbl9leHRlbmRlZF9zaXplID0gc2l6ZSAtIGFkZXYt
PmdtYy5zdG9sZW5fdmdhX3NpemU7CisJCWFkZXYtPm1tYW4uc3RvbGVuX3ZnYV9zaXplID0gQU1E
R1BVX1ZCSU9TX1ZHQV9BTExPQ0FUSU9OOworCQlhZGV2LT5tbWFuLnN0b2xlbl9leHRlbmRlZF9z
aXplID0gc2l6ZSAtIGFkZXYtPm1tYW4uc3RvbGVuX3ZnYV9zaXplOwogCX0gZWxzZSB7Ci0JCWFk
ZXYtPmdtYy5zdG9sZW5fdmdhX3NpemUgPSBzaXplOwotCQlhZGV2LT5nbWMuc3RvbGVuX2V4dGVu
ZGVkX3NpemUgPSAwOworCQlhZGV2LT5tbWFuLnN0b2xlbl92Z2Ffc2l6ZSA9IHNpemU7CisJCWFk
ZXYtPm1tYW4uc3RvbGVuX2V4dGVuZGVkX3NpemUgPSAwOwogCX0KIH0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuaCBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9nbWMuaAppbmRleCBjMmE4NWQwYjE1NDYuLmQ2MWJiZGU0YzdkMiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dtYy5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuaApAQCAtMjE1LDExICsyMTUs
NiBAQCBzdHJ1Y3QgYW1kZ3B1X2dtYyB7CiAJdWludDhfdAkJCXZyYW1fdmVuZG9yOwogCXVpbnQz
Ml90ICAgICAgICAgICAgICAgIHNyYm1fc29mdF9yZXNldDsKIAlib29sCQkJcHJ0X3dhcm5pbmc7
Ci0JdWludDY0X3QJCXN0b2xlbl92Z2Ffc2l6ZTsKLQlzdHJ1Y3QgYW1kZ3B1X2JvCSpzdG9sZW5f
dmdhX21lbW9yeTsKLQl1aW50NjRfdAkJc3RvbGVuX2V4dGVuZGVkX3NpemU7Ci0Jc3RydWN0IGFt
ZGdwdV9ibwkqc3RvbGVuX2V4dGVuZGVkX21lbW9yeTsKLQlib29sCQkJa2VlcF9zdG9sZW5fdmdh
X21lbW9yeTsKIAl1aW50MzJfdAkJc2RwaWZfcmVnaXN0ZXI7CiAJLyogYXBlcnR1cmVzICovCiAJ
dTY0CQkJc2hhcmVkX2FwZXJ0dXJlX3N0YXJ0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3R0bS5jCmluZGV4IDNkZjlkNWE1Mzc0MS4uY2MxYTViMjg3NmI2IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCkBAIC0xOTc4LDE2ICsxOTc4LDE2IEBAIGludCBh
bWRncHVfdHRtX2luaXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJICogVGhpcyBpcyB1
c2VkIGZvciBWR0EgZW11bGF0aW9uIGFuZCBwcmUtT1Mgc2Nhbm91dCBidWZmZXJzIHRvCiAJICog
YXZvaWQgZGlzcGxheSBhcnRpZmFjdHMgd2hpbGUgdHJhbnNpdGlvbmluZyBiZXR3ZWVuIHByZS1P
UwogCSAqIGFuZCBkcml2ZXIuICAqLwotCXIgPSBhbWRncHVfYm9fY3JlYXRlX2tlcm5lbF9hdChh
ZGV2LCAwLCBhZGV2LT5nbWMuc3RvbGVuX3ZnYV9zaXplLAorCXIgPSBhbWRncHVfYm9fY3JlYXRl
X2tlcm5lbF9hdChhZGV2LCAwLCBhZGV2LT5tbWFuLnN0b2xlbl92Z2Ffc2l6ZSwKIAkJCQkgICAg
ICAgQU1ER1BVX0dFTV9ET01BSU5fVlJBTSwKLQkJCQkgICAgICAgJmFkZXYtPmdtYy5zdG9sZW5f
dmdhX21lbW9yeSwKKwkJCQkgICAgICAgJmFkZXYtPm1tYW4uc3RvbGVuX3ZnYV9tZW1vcnksCiAJ
CQkJICAgICAgIE5VTEwpOwogCWlmIChyKQogCQlyZXR1cm4gcjsKLQlyID0gYW1kZ3B1X2JvX2Ny
ZWF0ZV9rZXJuZWxfYXQoYWRldiwgYWRldi0+Z21jLnN0b2xlbl92Z2Ffc2l6ZSwKLQkJCQkgICAg
ICAgYWRldi0+Z21jLnN0b2xlbl9leHRlbmRlZF9zaXplLAorCXIgPSBhbWRncHVfYm9fY3JlYXRl
X2tlcm5lbF9hdChhZGV2LCBhZGV2LT5tbWFuLnN0b2xlbl92Z2Ffc2l6ZSwKKwkJCQkgICAgICAg
YWRldi0+bW1hbi5zdG9sZW5fZXh0ZW5kZWRfc2l6ZSwKIAkJCQkgICAgICAgQU1ER1BVX0dFTV9E
T01BSU5fVlJBTSwKLQkJCQkgICAgICAgJmFkZXYtPmdtYy5zdG9sZW5fZXh0ZW5kZWRfbWVtb3J5
LAorCQkJCSAgICAgICAmYWRldi0+bW1hbi5zdG9sZW5fZXh0ZW5kZWRfbWVtb3J5LAogCQkJCSAg
ICAgICBOVUxMKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CkBAIC0yMDQ4LDkgKzIwNDgsOSBAQCBp
bnQgYW1kZ3B1X3R0bV9pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogdm9pZCBhbWRn
cHVfdHRtX2xhdGVfaW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKIAkvKiByZXR1
cm4gdGhlIFZHQSBzdG9sZW4gbWVtb3J5IChpZiBhbnkpIGJhY2sgdG8gVlJBTSAqLwotCWlmICgh
YWRldi0+Z21jLmtlZXBfc3RvbGVuX3ZnYV9tZW1vcnkpCi0JCWFtZGdwdV9ib19mcmVlX2tlcm5l
bCgmYWRldi0+Z21jLnN0b2xlbl92Z2FfbWVtb3J5LCBOVUxMLCBOVUxMKTsKLQlhbWRncHVfYm9f
ZnJlZV9rZXJuZWwoJmFkZXYtPmdtYy5zdG9sZW5fZXh0ZW5kZWRfbWVtb3J5LCBOVUxMLCBOVUxM
KTsKKwlpZiAoIWFkZXYtPm1tYW4ua2VlcF9zdG9sZW5fdmdhX21lbW9yeSkKKwkJYW1kZ3B1X2Jv
X2ZyZWVfa2VybmVsKCZhZGV2LT5tbWFuLnN0b2xlbl92Z2FfbWVtb3J5LCBOVUxMLCBOVUxMKTsK
KwlhbWRncHVfYm9fZnJlZV9rZXJuZWwoJmFkZXYtPm1tYW4uc3RvbGVuX2V4dGVuZGVkX21lbW9y
eSwgTlVMTCwgTlVMTCk7CiB9CiAKIC8qKgpAQCAtMjA2Myw4ICsyMDYzLDggQEAgdm9pZCBhbWRn
cHVfdHRtX2Zpbmkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAKIAlhbWRncHVfdHRtX3Ry
YWluaW5nX3Jlc2VydmVfdnJhbV9maW5pKGFkZXYpOwogCS8qIHJldHVybiB0aGUgc3RvbGVuIHZn
YSBtZW1vcnkgYmFjayB0byBWUkFNICovCi0JaWYgKGFkZXYtPmdtYy5rZWVwX3N0b2xlbl92Z2Ff
bWVtb3J5KQotCQlhbWRncHVfYm9fZnJlZV9rZXJuZWwoJmFkZXYtPmdtYy5zdG9sZW5fdmdhX21l
bW9yeSwgTlVMTCwgTlVMTCk7CisJaWYgKGFkZXYtPm1tYW4ua2VlcF9zdG9sZW5fdmdhX21lbW9y
eSkKKwkJYW1kZ3B1X2JvX2ZyZWVfa2VybmVsKCZhZGV2LT5tbWFuLnN0b2xlbl92Z2FfbWVtb3J5
LCBOVUxMLCBOVUxMKTsKIAkvKiByZXR1cm4gdGhlIElQIERpc2NvdmVyeSBUTVIgbWVtb3J5IGJh
Y2sgdG8gVlJBTSAqLwogCWFtZGdwdV9ib19mcmVlX2tlcm5lbCgmYWRldi0+ZGlzY292ZXJ5X21l
bW9yeSwgTlVMTCwgTlVMTCk7CiAJYW1kZ3B1X3R0bV9md19yZXNlcnZlX3ZyYW1fZmluaShhZGV2
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uaCBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uaAppbmRleCAxN2M4ZDBkN2Jj
YzMuLjk4YWY4N2YzOGYzZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X3R0bS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0u
aApAQCAtNTksNiArNTksMTIgQEAgc3RydWN0IGFtZGdwdV9tbWFuIHsKIAlzdHJ1Y3QgbXV0ZXgJ
CQkJZ3R0X3dpbmRvd19sb2NrOwogCS8qIFNjaGVkdWxlciBlbnRpdHkgZm9yIGJ1ZmZlciBtb3Zl
cyAqLwogCXN0cnVjdCBkcm1fc2NoZWRfZW50aXR5CQkJZW50aXR5OworCisJdWludDY0X3QJCXN0
b2xlbl92Z2Ffc2l6ZTsKKwlzdHJ1Y3QgYW1kZ3B1X2JvCSpzdG9sZW5fdmdhX21lbW9yeTsKKwl1
aW50NjRfdAkJc3RvbGVuX2V4dGVuZGVkX3NpemU7CisJc3RydWN0IGFtZGdwdV9ibwkqc3RvbGVu
X2V4dGVuZGVkX21lbW9yeTsKKwlib29sCQkJa2VlcF9zdG9sZW5fdmdhX21lbW9yeTsKIH07CiAK
IHN0cnVjdCBhbWRncHVfY29weV9tZW0gewotLSAKMi4yNS40CgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2FtZC1nZngK
