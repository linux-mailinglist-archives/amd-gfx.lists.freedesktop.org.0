Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BE8CE37D3D3
	for <lists+amd-gfx@lfdr.de>; Wed, 12 May 2021 21:23:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4938A89C03;
	Wed, 12 May 2021 19:23:32 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-DM3-obe.outbound.protection.outlook.com
 (mail-dm3nam07on2048.outbound.protection.outlook.com [40.107.95.48])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6575989EA3
 for <amd-gfx@lists.freedesktop.org>; Wed, 12 May 2021 19:23:30 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=WX7lbxKiKPEGN28oLNo2x/1iC9/awkEsLa0brYdNN625eHT7boL+SHhXMUTkbDhfF6M/XplyQg+iLpCKkxkDI8Ot+kw9HuZxZZ9M1NuFMj0zm5PadAXPa0LrIp1oOEdbgnElOeuaAJXsAC1Cv3p96Vv4I2Buk+MUe4zQ4VxDBSaT340hEPAjG6ULS2lPNyM4kgFSZAJj07A6axx+GcTvBiLukY3f5lYht4p2R4yxOfCVWaAUO6AGjcw43a69sBkbIVueuGF3wasF5QowbkeTbxaR6GWLUFafQkNzfomPR5ElXNQ4nwwue2iG2ndajauT8l+3hATJA77raAdR4FH5cQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=uYz4ETkE8IxCa/A2+HyyL10wHEPgDfkYhgSbAHpBbjQ=;
 b=Xnos/4h3T56LwXKTWXUYqqq3J6OpGWIDsS/ZcI/un9Jj7M+R477LnVANx7idnAd8KjDc0LRu/e1boYkRcTZyHKzeRNE2fNNnS8dGxn/Zx78oeE1nlbEGy2S8oUAgBHQVoLIfGQX0RYxIEweKpfzcwqV1vNwFoQnPtSsZjZCW9QntsrBxjK68qxeKVWbzCZcpARzClOe6kPjcRpVhl4RPbHB880WSlChzvbR1L6hQQ3EtSlqiSnyWwdUyl24Z4loOIqSNqYL222XycLGxJngojSCrOaTqztPLVFfmAnny3xRWKfKC/avGCVQkL8EwOfjVh/yjPOYAaRibMA4Is9zCcg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=amd.com; s=selector1; 
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=uYz4ETkE8IxCa/A2+HyyL10wHEPgDfkYhgSbAHpBbjQ=;
 b=3YWKBXpPdvdCZoT/KAk4Fd2rCy0Vjxgd/DlzCmePU4ngibntIY4fH8ENwMsuyy/QLcx6fyX0yXT8vJxYpOLOUbuG12gr+sk0wXtMU7X1GQmkuvqA6UBAUkBdyKGZjtnU7q0W9pqKeZVdTlukBAHcIua00xScxVk8QoPQfUI/+KY=
Authentication-Results: lists.freedesktop.org; dkim=none (message not signed)
 header.d=none; lists.freedesktop.org;
 dmarc=none action=none header.from=amd.com;
Received: from BN9PR12MB5129.namprd12.prod.outlook.com (2603:10b6:408:136::12)
 by BN9PR12MB5067.namprd12.prod.outlook.com (2603:10b6:408:134::16)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4108.24; Wed, 12 May
 2021 19:23:29 +0000
Received: from BN9PR12MB5129.namprd12.prod.outlook.com
 ([fe80::3c78:e58b:fba7:b8dd]) by BN9PR12MB5129.namprd12.prod.outlook.com
 ([fe80::3c78:e58b:fba7:b8dd%6]) with mapi id 15.20.4129.025; Wed, 12 May 2021
 19:23:29 +0000
Subject: Re: [PATCH v2] drm/amdgpu: flush TLB if valid PDE turns into PTE
To: Philip Yang <Philip.Yang@amd.com>, amd-gfx@lists.freedesktop.org
References: <20210512123451.25900-1-Philip.Yang@amd.com>
 <20210512184342.13149-1-Philip.Yang@amd.com>
From: Felix Kuehling <felix.kuehling@amd.com>
Message-ID: <f399bcef-9910-1a7f-91eb-c2f82e6d9d54@amd.com>
Date: Wed, 12 May 2021 15:23:27 -0400
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101
 Thunderbird/78.8.1
In-Reply-To: <20210512184342.13149-1-Philip.Yang@amd.com>
Content-Language: en-US
X-Originating-IP: [142.116.138.207]
X-ClientProxiedBy: YTOPR0101CA0044.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b00:14::21) To BN9PR12MB5129.namprd12.prod.outlook.com
 (2603:10b6:408:136::12)
MIME-Version: 1.0
X-MS-Exchange-MessageSentRepresentingType: 1
Received: from [192.168.2.100] (142.116.138.207) by
 YTOPR0101CA0044.CANPRD01.PROD.OUTLOOK.COM (2603:10b6:b00:14::21) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.4108.30 via Frontend
 Transport; Wed, 12 May 2021 19:23:28 +0000
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: ecc36a4f-f421-4f93-92ce-08d9157b6c10
X-MS-TrafficTypeDiagnostic: BN9PR12MB5067:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <BN9PR12MB50674982605451D94A70E72B92529@BN9PR12MB5067.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:9508;
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: dYc3VToxTAWkBjOHF8ydG+92Vp9Q+OyY5bGD9qFcybPFAI7NnaAhF9V2GaYpU85kSugAsX7L4ZRYjrw+3tlvzmrmUFeCCCdShMS8bugSOF6cCB+D6nhBCvYtioHayFl/JbIbQbB3ryNHOIyr+xKQckKMGtqaD5DGc3R6/nne9E2sCA9+Lvb45rH24FiCSPL4WrI2Hu2fAPZfOgBRSu3RU7tEh2of1KX7ul7U5GjibA88t0ilbCS3hJywUMwcGED8gw7TQvHReiDk0UZMthpbAa2ngqgF6Qbkr3FYdDHJNPiDmmN2MS2zgtUUtEA9xfOL4h6c8zZlD4vdIaI0nF2UOhJ7Ti2GLWO/+E2AI/fWiJhPL7XKtenUtWK9G2jstKeJ79vsiwYL1cI/OVibPe8Y4Giu/fgDPGUAT+WthG++2gXjcUSp72Th8Crny+HNuNMdaKW44J5KDQc0QniizJuLTfkA8pNMVJ1t8l+LvPlr4wRx+dVJZT+YKH7ubquDhCUXRcK03tbYCjqn8avEPN/WTgxvqPx5za9yjFNT4ca69m1h/8mPCCQpqvJ3A3ICXbuNYGzNktGqdROGpM3JR5ZaJOrGWbZlFkkddpUx/qAIA0z1i1AK4H1MsNh/1ebv6dyKMNTnB7hlgDh4kcBAj7wioJja+arAsAQizGKiZToSeaDTtEMzVivXTV0j2LJMbOxq
X-Forefront-Antispam-Report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:BN9PR12MB5129.namprd12.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(4636009)(376002)(396003)(346002)(136003)(366004)(39850400004)(2906002)(8676002)(66946007)(83380400001)(66476007)(66556008)(6486002)(8936002)(44832011)(478600001)(26005)(2616005)(956004)(16526019)(316002)(5660300002)(86362001)(31696002)(38100700002)(16576012)(31686004)(186003)(36756003)(45980500001)(43740500002);
 DIR:OUT; SFP:1101; 
X-MS-Exchange-AntiSpam-MessageData: =?utf-8?B?ekwrU0U1UTB3Uzk1a0RRdE41V1R6YU9pclJqRXRnWkQ1QzFIZ1NuWVZtV2tt?=
 =?utf-8?B?WnlrZEplejV2T3k3SnhoODZrdGdYY0pSOUVQRHI0RFRmbUU5SmxDTFFWeWlF?=
 =?utf-8?B?alRqS2huQTVhSE9jMzViN0RrNjlvQzA1ZFEvVE5scjNpNjh3YzJPQUxxVVZ1?=
 =?utf-8?B?czZ0dWFvejh1aHRncDdDZ3VnNnl0U1hUVUhlQUtPY0JQYkZSeEl4TDBLMkZq?=
 =?utf-8?B?RHVWRDZIWlJqRS9ZREV2UDJza1JQS2d5MmRNUDQ1UG4vSDdIVEpMRXhjRm0r?=
 =?utf-8?B?RDhCK3hpbURaV1hmcUR0TzBuV1IxWWJFYkI3UmVXWGtWaTY4SHNsRE1tTnkx?=
 =?utf-8?B?Z3h2Y2cxakVEUWdCOTJoUGU4VlhwNForL3kybGpkdUxlVDAwZ0xSVFZFQjdQ?=
 =?utf-8?B?eTkvTldYWWtuK0pEbytVbVNVNk5McS9meEs0THYvKytLd0JuaEQ4Z3RxN0RU?=
 =?utf-8?B?ZzVmMC9oRU1GYmJFMTYrMlpEL05RYWl1QXVsc3FxZ1N5WFVwR0FVQjFVWWJE?=
 =?utf-8?B?V29PeWpkWjVjMEl5Y3JISi9PMlMzZDhpTE9Bc0xCNXdBU1dzVjdhT0NrRjZV?=
 =?utf-8?B?Y0thNUxUbk5BUnNDRTlqSTlnMzJBWXk1dzZJVHRTZTlZMVNSV3ZqZEVwY2tM?=
 =?utf-8?B?SjhoSm8wMXNBbGVmdVBhWjFIc25EbGZNSVRJamM1bHVtYllUbUo3YzhuWUdH?=
 =?utf-8?B?OE03NUYwaDAvWWNudnNHdmdhVGRlb0U0WXh0NEM0Wlk4TU5GZ0k5a3FyOVJZ?=
 =?utf-8?B?dGc5UUlzenlWWkp4S2VaYjNNV1dCRXQ2cDBoSzIvazRhRmRCR3c3NzE4eEg1?=
 =?utf-8?B?eTlCdFVGazNsOG83N2F6a3NFU1dNc25sdEw5ZDVpb3ZDU0IrOHFyQ2ZqQjI2?=
 =?utf-8?B?T1crK3pMWjZaMjdneFhTOS9aSGN5bW95Y2szcDc0YlRCYmhPUXpONElNUzE0?=
 =?utf-8?B?Q2MxditTRUJLcTdwTGdVTXIyMW94L1l4VG5ja3RtNnorcjNpRG9JQ29Kb1Bl?=
 =?utf-8?B?alN1VXFVaVhmSmFUOGk3ZWgxMmF4YkcwZUxzaFd6UTV1ZC9wcGh2cTJ4RmZY?=
 =?utf-8?B?TVM4QndsS1pGdWNzYlRxU0M4dXhpSS92SUZuM3gwU00wUVo3TkJCQ0J0TDRp?=
 =?utf-8?B?b0lxNTVFeDdBVC9SWkpSZGUxOUo4dmllUkxpeVRlV2FHbjdKV3ZRLzY2S0Ux?=
 =?utf-8?B?bHJ3dzZ1T0FFaU5OTGI4NSt0dGJDOFZLV2ZWNnhPYVFsME51bnJRTHMyUXpP?=
 =?utf-8?B?REF0Z2xWM2ZkVEVPUGV5VjVFNnh6SmdPMHNaLzVHRFluVXEzNXBwYXN1WlNZ?=
 =?utf-8?B?U3duS0tzWFFQV2V0Zkdaek1kQUFyMWFyWjRZeVgzMmJJc3RXWTJIMFlvVXpp?=
 =?utf-8?B?S1M5ZzBXUExrSkd4OUdXcFlKeDcrK1NRU1g1RTBZTHNDcm5rUnNSSEdjeWZM?=
 =?utf-8?B?MUJqaVdmUmgzS0QwaTRPZHIydUNRQndmSUxSajJmWkI1VVBnSDFtU280NFRi?=
 =?utf-8?B?d0dCL2g2eXM1R3hXWXczU2N3bTlaTFlZd2xTZEo0VjBjK3RMZytrOTVEUzJE?=
 =?utf-8?B?SFpTWmJoMUF4ck9IWVRybnFDTElqd1BJNTBHYkZUYTRJZitlRTU3Wm5IeHo4?=
 =?utf-8?B?Tnd0eFNBaVF2RmY1WERReWdhMXlKcGdqeHFFT3N4MTEvYXlGZUhVN0FOZFc0?=
 =?utf-8?B?SEhGWFh2THZzTUdzcEc3ejhlR3FkVWE1Y25KNVZBNXk2WGJqM1AyQ0hwZXpY?=
 =?utf-8?Q?DrqoXiBYN+VQ0aLXfUxjOYE1aiCNZ0yotIRbfID?=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: ecc36a4f-f421-4f93-92ce-08d9157b6c10
X-MS-Exchange-CrossTenant-AuthSource: BN9PR12MB5129.namprd12.prod.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 12 May 2021 19:23:28.9205 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: JfJzg8MK/497jMZ0ibT7jecfhxfTcmbClYZy91NIkjS0TFsaPFI4DJeI5eQdWEUX0rNmL5OQ4IRFLiQlTRWQlw==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN9PR12MB5067
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

QW0gMjAyMS0wNS0xMiB1bSAyOjQzIHAubS4gc2NocmllYiBQaGlsaXAgWWFuZzoKPiBNYXBwaW5n
IGh1Z2UgcGFnZSwgMk1CIGFsaWduZWQgYWRkcmVzcyB3aXRoIDJNQiBzaXplLCB1c2VzIFBERTAg
YXMgUFRFLgo+IElmIHByZXZpb3VzbHkgdmFsaWQgUERFMCwgUERFMC5WPTEgYW5kIFBERTAuUD0w
IHR1cm5zIGludG8gUFRFLCB0aGlzCj4gcmVxdWlyZXMgVExCIGZsdXNoLCBvdGhlcndpc2UgcGFn
ZSB0YWJsZSB3YWxrZXIgd2lsbCBub3QgcmVhZCB1cGRhdGVkCj4gUERFMC4KPgo+IENoYW5nZSBw
YWdlIHRhYmxlIHVwZGF0ZSBtYXBwaW5nIHRvIHJldHVybiBmcmVlX3RhYmxlIGZsYWcgdG8gaW5k
aWNhdGUKPiB0aGUgcHJldmlvdXNseSB2YWxpZCBQREUgbWF5IGhhdmUgdHVybmVkIGludG8gYSBQ
VEUgaWYgcGFnZSB0YWJsZSBpcwo+IGZyZWVkLgo+Cj4gU2lnbmVkLW9mZi1ieTogUGhpbGlwIFlh
bmcgPFBoaWxpcC5ZYW5nQGFtZC5jb20+Cj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV92bS5jIHwgMTMgKysrKysrKysrLS0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdm0uaCB8ICA3ICsrKysrKy0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRrZmQva2ZkX3N2bS5jICAgfCAxMiArKysrKysrKysrLS0KPiAgMyBmaWxlcyBjaGFuZ2VkLCAy
NSBpbnNlcnRpb25zKCspLCA3IGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X3ZtLmMKPiBpbmRleCAzZGNkY2M5ZmY1MjIuLmY5YzAwYjQ1MWEzZCAxMDA2NDQK
PiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYwo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCj4gQEAgLTE1ODMsNiArMTU4Myw4
IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX3VwZGF0ZV9wdGVzKHN0cnVjdCBhbWRncHVfdm1fdXBk
YXRlX3BhcmFtcyAqcGFyYW1zLAo+ICAJCQl3aGlsZSAoY3Vyc29yLnBmbiA8IGZyYWdfc3RhcnQp
IHsKPiAgCQkJCWFtZGdwdV92bV9mcmVlX3B0cyhhZGV2LCBwYXJhbXMtPnZtLCAmY3Vyc29yKTsK
PiAgCQkJCWFtZGdwdV92bV9wdF9uZXh0KGFkZXYsICZjdXJzb3IpOwo+ICsJCQkJaWYgKHBhcmFt
cy0+ZnJlZV90YWJsZSkKPiArCQkJCQkqcGFyYW1zLT5mcmVlX3RhYmxlID0gdHJ1ZTsKPiAgCQkJ
fQo+ICAKPiAgCQl9IGVsc2UgaWYgKGZyYWcgPj0gc2hpZnQpIHsKPiBAQCAtMTYxMCw2ICsxNjEy
LDcgQEAgc3RhdGljIGludCBhbWRncHVfdm1fdXBkYXRlX3B0ZXMoc3RydWN0IGFtZGdwdV92bV91
cGRhdGVfcGFyYW1zICpwYXJhbXMsCj4gICAqIEBub2RlczogYXJyYXkgb2YgZHJtX21tX25vZGVz
IHdpdGggdGhlIE1DIGFkZHJlc3Nlcwo+ICAgKiBAcGFnZXNfYWRkcjogRE1BIGFkZHJlc3NlcyB0
byB1c2UgZm9yIG1hcHBpbmcKPiAgICogQGZlbmNlOiBvcHRpb25hbCByZXN1bHRpbmcgZmVuY2UK
PiArICogQGZyZWVfdGFibGU6IHJldHVybiB0cnVlIGlmIHBhZ2UgdGFibGUgaXMgZnJlZWQKPiAg
ICoKPiAgICogRmlsbCBpbiB0aGUgcGFnZSB0YWJsZSBlbnRyaWVzIGJldHdlZW4gQHN0YXJ0IGFu
ZCBAbGFzdC4KPiAgICoKPiBAQCAtMTYyNCw3ICsxNjI3LDggQEAgaW50IGFtZGdwdV92bV9ib191
cGRhdGVfbWFwcGluZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKPiAgCQkJCXVpbnQ2NF90
IGZsYWdzLCB1aW50NjRfdCBvZmZzZXQsCj4gIAkJCQlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGVz
LAo+ICAJCQkJZG1hX2FkZHJfdCAqcGFnZXNfYWRkciwKPiAtCQkJCXN0cnVjdCBkbWFfZmVuY2Ug
KipmZW5jZSkKPiArCQkJCXN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZSwKPiArCQkJCWJvb2wgKmZy
ZWVfdGFibGUpCj4gIHsKPiAgCXN0cnVjdCBhbWRncHVfdm1fdXBkYXRlX3BhcmFtcyBwYXJhbXM7
Cj4gIAllbnVtIGFtZGdwdV9zeW5jX21vZGUgc3luY19tb2RlOwo+IEBAIC0xNjM3LDYgKzE2NDEs
NyBAQCBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0ZV9tYXBwaW5nKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LAo+ICAJcGFyYW1zLmltbWVkaWF0ZSA9IGltbWVkaWF0ZTsKPiAgCXBhcmFtcy5wYWdl
c19hZGRyID0gcGFnZXNfYWRkcjsKPiAgCXBhcmFtcy51bmxvY2tlZCA9IHVubG9ja2VkOwo+ICsJ
cGFyYW1zLmZyZWVfdGFibGUgPSBmcmVlX3RhYmxlOwo+ICAKPiAgCS8qIEltcGxpY2l0bHkgc3lu
YyB0byBjb21tYW5kIHN1Ym1pc3Npb25zIGluIHRoZSBzYW1lIFZNIGJlZm9yZQo+ICAJICogdW5t
YXBwaW5nLiBTeW5jIHRvIG1vdmluZyBmZW5jZXMgYmVmb3JlIG1hcHBpbmcuCj4gQEAgLTE4Nzks
NyArMTg4NCw3IEBAIGludCBhbWRncHVfdm1fYm9fdXBkYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LCBzdHJ1Y3QgYW1kZ3B1X2JvX3ZhICpib192YSwKPiAgCQkJCQkJcmVzdiwgbWFwcGlu
Zy0+c3RhcnQsCj4gIAkJCQkJCW1hcHBpbmctPmxhc3QsIHVwZGF0ZV9mbGFncywKPiAgCQkJCQkJ
bWFwcGluZy0+b2Zmc2V0LCBub2RlcywKPiAtCQkJCQkJcGFnZXNfYWRkciwgbGFzdF91cGRhdGUp
Owo+ICsJCQkJCQlwYWdlc19hZGRyLCBsYXN0X3VwZGF0ZSwgTlVMTCk7Cj4gIAkJaWYgKHIpCj4g
IAkJCXJldHVybiByOwo+ICAJfQo+IEBAIC0yMDkwLDcgKzIwOTUsNyBAQCBpbnQgYW1kZ3B1X3Zt
X2NsZWFyX2ZyZWVkKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAJCXIgPSBhbWRncHVf
dm1fYm9fdXBkYXRlX21hcHBpbmcoYWRldiwgYWRldiwgdm0sIGZhbHNlLCBmYWxzZSwKPiAgCQkJ
CQkJcmVzdiwgbWFwcGluZy0+c3RhcnQsCj4gIAkJCQkJCW1hcHBpbmctPmxhc3QsIGluaXRfcHRl
X3ZhbHVlLAo+IC0JCQkJCQkwLCBOVUxMLCBOVUxMLCAmZik7Cj4gKwkJCQkJCTAsIE5VTEwsIE5V
TEwsICZmLCBOVUxMKTsKPiAgCQlhbWRncHVfdm1fZnJlZV9tYXBwaW5nKGFkZXYsIHZtLCBtYXBw
aW5nLCBmKTsKPiAgCQlpZiAocikgewo+ICAJCQlkbWFfZmVuY2VfcHV0KGYpOwo+IEBAIC0zNDI4
LDcgKzM0MzMsNyBAQCBib29sIGFtZGdwdV92bV9oYW5kbGVfZmF1bHQoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsIHUzMiBwYXNpZCwKPiAgCX0KPiAgCj4gIAlyID0gYW1kZ3B1X3ZtX2JvX3Vw
ZGF0ZV9tYXBwaW5nKGFkZXYsIGFkZXYsIHZtLCB0cnVlLCBmYWxzZSwgTlVMTCwgYWRkciwKPiAt
CQkJCQlhZGRyLCBmbGFncywgdmFsdWUsIE5VTEwsIE5VTEwsCj4gKwkJCQkJYWRkciwgZmxhZ3Ms
IHZhbHVlLCBOVUxMLCBOVUxMLCBOVUxMLAo+ICAJCQkJCU5VTEwpOwo+ICAJaWYgKHIpCj4gIAkJ
Z290byBlcnJvcl91bmxvY2s7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV92bS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmgK
PiBpbmRleCBlYTYwZWMxMjJiNTEuLjQxYTU1YjAzNWNkYSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV92bS5oCj4gQEAgLTIzMSw2ICsyMzEsMTEgQEAgc3RydWN0IGFtZGdw
dV92bV91cGRhdGVfcGFyYW1zIHsKPiAgCSAqIEBudW1fZHdfbGVmdDogbnVtYmVyIG9mIGR3IGxl
ZnQgZm9yIHRoZSBJQgo+ICAJICovCj4gIAl1bnNpZ25lZCBpbnQgbnVtX2R3X2xlZnQ7Cj4gKwo+
ICsJLyoqCj4gKwkgKiBAZnJlZV90YWJsZTogcmV0dXJuIHRydWUgaWYgcGFnZSB0YWJsZSBpcyBm
cmVlZCB3aGVuIHVwZGF0aW5nCj4gKwkgKi8KPiArCWJvb2wgKmZyZWVfdGFibGU7Cj4gIH07Cj4g
IAo+ICBzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9mdW5jcyB7Cj4gQEAgLTQwNCw3ICs0MDksNyBA
QCBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0ZV9tYXBwaW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LAo+ICAJCQkJdWludDY0X3QgZmxhZ3MsIHVpbnQ2NF90IG9mZnNldCwKPiAgCQkJCXN0cnVj
dCBkcm1fbW1fbm9kZSAqbm9kZXMsCj4gIAkJCQlkbWFfYWRkcl90ICpwYWdlc19hZGRyLAo+IC0J
CQkJc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKTsKPiArCQkJCXN0cnVjdCBkbWFfZmVuY2UgKipm
ZW5jZSwgYm9vbCAqZnJlZV90YWJsZSk7Cj4gIGludCBhbWRncHVfdm1fYm9fdXBkYXRlKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAJCQlzdHJ1Y3QgYW1kZ3B1X2JvX3ZhICpib192YSwK
PiAgCQkJYm9vbCBjbGVhcik7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
a2ZkL2tmZF9zdm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9zdm0uYwo+IGlu
ZGV4IGI2NjVlOWZmNzdlMy4uNGYyODA1MmQ0NGJmIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1ka2ZkL2tmZF9zdm0uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
a2ZkL2tmZF9zdm0uYwo+IEBAIC0xMDg0LDcgKzEwODQsNyBAQCBzdm1fcmFuZ2VfdW5tYXBfZnJv
bV9ncHUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtLAo+
ICAKPiAgCXJldHVybiBhbWRncHVfdm1fYm9fdXBkYXRlX21hcHBpbmcoYWRldiwgYWRldiwgdm0s
IGZhbHNlLCB0cnVlLCBOVUxMLAo+ICAJCQkJCSAgIHN0YXJ0LCBsYXN0LCBpbml0X3B0ZV92YWx1
ZSwgMCwKPiAtCQkJCQkgICBOVUxMLCBOVUxMLCBmZW5jZSk7Cj4gKwkJCQkJICAgTlVMTCwgTlVM
TCwgZmVuY2UsIE5VTEwpOwo+ICB9Cj4gIAo+ICBzdGF0aWMgaW50Cj4gQEAgLTExMzcsMTIgKzEx
MzcsMTUgQEAgc3ZtX3JhbmdlX21hcF90b19ncHUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYs
IHN0cnVjdCBhbWRncHVfdm0gKnZtLAo+ICAJCSAgICAgc3RydWN0IGFtZGdwdV9kZXZpY2UgKmJv
X2FkZXYsIHN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZSkKPiAgewo+ICAJc3RydWN0IGFtZGdwdV9i
b192YSBib192YTsKPiArCWJvb2wgZnJlZV90YWJsZSA9IGZhbHNlOwo+ICsJc3RydWN0IGtmZF9w
cm9jZXNzICpwOwo+ICAJdWludDY0X3QgcHRlX2ZsYWdzOwo+ICAJaW50IHIgPSAwOwo+ICAKPiAg
CXByX2RlYnVnKCJzdm1zIDB4JXAgWzB4JWx4IDB4JWx4XVxuIiwgcHJhbmdlLT5zdm1zLCBwcmFu
Z2UtPnN0YXJ0LAo+ICAJCSBwcmFuZ2UtPmxhc3QpOwo+ICAKPiArCXAgPSBjb250YWluZXJfb2Yo
cHJhbmdlLT5zdm1zLCBzdHJ1Y3Qga2ZkX3Byb2Nlc3MsIHN2bXMpOwoKWW91IGNhbiBtb3ZlIHRo
aXMgYW5kIHRoZSBkZWNsYXJhdGlvbiBvZiAicCIgaW50byB0aGUgaWYgKGZyZWVfdGFibGUpCmJl
bG93LiBXaXRoIHRoYXQgZml4ZWQgdGhlIHBhdGNoIGlzCgpSZXZpZXdlZC1ieTogRmVsaXggS3Vl
aGxpbmcgPEZlbGl4Lkt1ZWhsaW5nQGFtZC5jb20+CgpQbGVhc2UgYWxzbyBnaXZlIENocmlzdGlh
biB0aW1lIHRvIHJldmlldyB0aGlzIGJlZm9yZSB5b3Ugc3VibWl0LgoKVGhhbmtzLArCoCBGZWxp
eAoKCj4gIAlpZiAocHJhbmdlLT5zdm1fYm8gJiYgcHJhbmdlLT50dG1fcmVzKSB7Cj4gIAkJYm9f
dmEuaXNfeGdtaSA9IGFtZGdwdV94Z21pX3NhbWVfaGl2ZShhZGV2LCBib19hZGV2KTsKPiAgCQlw
cmFuZ2UtPm1hcHBpbmcuYm9fdmEgPSAmYm9fdmE7Cj4gQEAgLTExNTksNyArMTE2Miw4IEBAIHN2
bV9yYW5nZV9tYXBfdG9fZ3B1KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1Y3QgYW1k
Z3B1X3ZtICp2bSwKPiAgCQkJCQlwcmFuZ2UtPm1hcHBpbmcub2Zmc2V0LAo+ICAJCQkJCXByYW5n
ZS0+dHRtX3JlcyA/Cj4gIAkJCQkJCXByYW5nZS0+dHRtX3Jlcy0+bW1fbm9kZSA6IE5VTEwsCj4g
LQkJCQkJZG1hX2FkZHIsICZ2bS0+bGFzdF91cGRhdGUpOwo+ICsJCQkJCWRtYV9hZGRyLCAmdm0t
Pmxhc3RfdXBkYXRlLAo+ICsJCQkJCSZmcmVlX3RhYmxlKTsKPiAgCWlmIChyKSB7Cj4gIAkJcHJf
ZGVidWcoImZhaWxlZCAlZCB0byBtYXAgdG8gZ3B1IDB4JWx4XG4iLCByLCBwcmFuZ2UtPnN0YXJ0
KTsKPiAgCQlnb3RvIG91dDsKPiBAQCAtMTE3NSw2ICsxMTc5LDEwIEBAIHN2bV9yYW5nZV9tYXBf
dG9fZ3B1KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwK
PiAgCWlmIChmZW5jZSkKPiAgCQkqZmVuY2UgPSBkbWFfZmVuY2VfZ2V0KHZtLT5sYXN0X3VwZGF0
ZSk7Cj4gIAo+ICsJaWYgKGZyZWVfdGFibGUpCj4gKwkJYW1kZ3B1X2FtZGtmZF9mbHVzaF9ncHVf
dGxiX3Bhc2lkKChzdHJ1Y3Qga2dkX2RldiAqKWFkZXYsCj4gKwkJCQkJCSAgcC0+cGFzaWQpOwo+
ICsKPiAgb3V0Ogo+ICAJcHJhbmdlLT5tYXBwaW5nLmJvX3ZhID0gTlVMTDsKPiAgCXJldHVybiBy
OwpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4
IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZngK
