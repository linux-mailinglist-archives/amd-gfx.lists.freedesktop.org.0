Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5BCDE33484
	for <lists+amd-gfx@lfdr.de>; Mon,  3 Jun 2019 18:05:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F05CF89261;
	Mon,  3 Jun 2019 16:05:27 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr820085.outbound.protection.outlook.com [40.107.82.85])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E1C3489261
 for <amd-gfx@lists.freedesktop.org>; Mon,  3 Jun 2019 16:05:25 +0000 (UTC)
Received: from BL0PR12MB2580.namprd12.prod.outlook.com (52.132.27.147) by
 BL0PR12MB2418.namprd12.prod.outlook.com (52.132.11.24) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1943.22; Mon, 3 Jun 2019 16:05:23 +0000
Received: from BL0PR12MB2580.namprd12.prod.outlook.com
 ([fe80::24a0:610c:5b5c:9b9b]) by BL0PR12MB2580.namprd12.prod.outlook.com
 ([fe80::24a0:610c:5b5c:9b9b%5]) with mapi id 15.20.1943.018; Mon, 3 Jun 2019
 16:05:23 +0000
From: "Zeng, Oak" <Oak.Zeng@amd.com>
To: "Kuehling, Felix" <Felix.Kuehling@amd.com>,
 "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: RE: [PATCH 1/4] drm/amdkfd: Fix sdma queue allocate race condition
Thread-Topic: [PATCH 1/4] drm/amdkfd: Fix sdma queue allocate race condition
Thread-Index: AQHVF/Z5wIEQUNIpkk2JnggOjC7mU6aFwHAAgAAFOICABEeNcA==
Date: Mon, 3 Jun 2019 16:05:23 +0000
Message-ID: <BL0PR12MB2580665D8AA12D0EB659637280140@BL0PR12MB2580.namprd12.prod.outlook.com>
References: <1559337538-14249-1-git-send-email-Oak.Zeng@amd.com>
 <f0e92b32-bd0a-aca4-c7dd-83f8e97b9a6f@amd.com>
 <d00bae2c-8c2f-b8b7-a69a-7205fd01a55a@amd.com>
In-Reply-To: <d00bae2c-8c2f-b8b7-a69a-7205fd01a55a@amd.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [2607:fea8:3ca0:a5f:6500:aea6:af0c:334]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: e7b751d7-0d1c-4ca1-1a45-08d6e83d492c
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(5600148)(711020)(4605104)(1401327)(4618075)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(2017052603328)(7193020);
 SRVR:BL0PR12MB2418; 
x-ms-traffictypediagnostic: BL0PR12MB2418:
x-ms-exchange-purlcount: 1
x-microsoft-antispam-prvs: <BL0PR12MB24183D36268E821EA1D6B93C80140@BL0PR12MB2418.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:5797;
x-forefront-prvs: 0057EE387C
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(376002)(39860400002)(396003)(366004)(136003)(346002)(51234002)(13464003)(189003)(199004)(8936002)(8676002)(110136005)(6116002)(316002)(81156014)(5660300002)(52536014)(99286004)(76116006)(186003)(54906003)(66476007)(66946007)(73956011)(102836004)(229853002)(74316002)(33656002)(86362001)(76176011)(2906002)(6246003)(7696005)(81166006)(53936002)(68736007)(11346002)(2501003)(6436002)(256004)(14444005)(446003)(71200400001)(6306002)(53546011)(476003)(6506007)(14454004)(71190400001)(46003)(9686003)(7736002)(66446008)(72206003)(305945005)(486006)(66556008)(64756008)(55016002)(4326008)(966005)(478600001)(25786009);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BL0PR12MB2418;
 H:BL0PR12MB2580.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: Z7ZgTFAyBReQ7VtGMeAuXAnwxYOCm9GMZ8Zq4LXTk8z14yY1UJETzQMro8FX1EcJHbwg7uhI+fqWsbiY5qr0BbQrimyHHrdgYJ7UMsgew8WLY9vr7fT07WJ3sCD6AmavWra+ArUAx7fYlBQyt/IZjYC6WPY9hbaHy/jokKPM4m3KczJXBdwsaLvT6El+jHbPi9DFCaskRt3f6KBhSWTY2+eeHDEhbr57rpHtMwpw1THpFTLsn6aaWsWRBg8dPQQr+RaftN9jDLC0Iz2BVXe/yr2cEnhoiUpf/ZoWzD17QfpV3gRfCgtwvQEuXRPrY1QAR1Z9Tj3P6qRxAhA4PGJQ0sWsEQtJdNQlzD7TwuNLXEvj2D2KNJbskMoKc9tc3Chg6OrmbrXly1xPJhGHJ2tztke7eGXxc1lSgSaMSrXfM9M=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: e7b751d7-0d1c-4ca1-1a45-08d6e83d492c
X-MS-Exchange-CrossTenant-originalarrivaltime: 03 Jun 2019 16:05:23.5841 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: ozeng@amd.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BL0PR12MB2418
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=6gvZx0D3yHdMukcjspQwPK61GYy3zJ6OVGFaIy6S3Cc=;
 b=P0iH5+VEtTl2LJoJERv7G0fsanNPFZdclSJo5QkjAaShCCU1soTjZ8mejoDwUm4dyDaS7CCpRjQ9wqquMPXq279+CxNevIxRnH/pzjpWYytTiWVByya/VOserwznw0ZMLiawz4viqk+ZKzDB0qdHBKid7B7cQKjR2xrnPEhG/K0=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Oak.Zeng@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Zhao, Yong" <Yong.Zhao@amd.com>, "Liu, Alex" <Alex.Liu@amd.com>, "Freehill,
 Chris" <Chris.Freehill@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

SGkgRmVsaXgsDQoNClNlZSBjb21tZW50IGlubGluZSBbT2FrXQ0KDQpSZWdhcmRzLA0KT2FrDQoN
Ci0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tDQpGcm9tOiBLdWVobGluZywgRmVsaXggPEZlbGl4
Lkt1ZWhsaW5nQGFtZC5jb20+IA0KU2VudDogRnJpZGF5LCBNYXkgMzEsIDIwMTkgNTo1MCBQTQ0K
VG86IFplbmcsIE9hayA8T2FrLlplbmdAYW1kLmNvbT47IGFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnDQpDYzogWmhhbywgWW9uZyA8WW9uZy5aaGFvQGFtZC5jb20+OyBGcmVlaGlsbCwgQ2hy
aXMgPENocmlzLkZyZWVoaWxsQGFtZC5jb20+OyBMaXUsIEFsZXggPEFsZXguTGl1QGFtZC5jb20+
DQpTdWJqZWN0OiBSZTogW1BBVENIIDEvNF0gZHJtL2FtZGtmZDogRml4IHNkbWEgcXVldWUgYWxs
b2NhdGUgcmFjZSBjb25kaXRpb24NCg0KT24gMjAxOS0wNS0zMSA1OjMxIHAubS4sIEt1ZWhsaW5n
LCBGZWxpeCB3cm90ZToNCj4gT24gMjAxOS0wNS0zMSA1OjE5IHAubS4sIFplbmcsIE9hayB3cm90
ZToNCj4+IFNETUEgcXVldWUgYWxsb2NhdGlvbiByZXF1aXJlcyB0aGUgZHFtIGxvY2sgYXMgaXQg
bW9kaWZ5IHRoZSBnbG9iYWwgDQo+PiBkcW0gbWVtYmVycy4gSW50cm9kdWNlIGZ1bmN0aW9ucyB0
byBhbGxvY2F0ZS9kZWFsbG9jYXRlIGluIA0KPj4gbG9ja2VkL3VubG9ja2VkIGNpcmN1bXN0YW5j
ZS4NCj4+DQo+PiBDaGFuZ2UtSWQ6IElkMzA4NDUyNGM1ZjY1ZDk2MjliMTJjZjZiNDg2MmE3NTE2
OTQ1Y2IxDQo+PiBTaWduZWQtb2ZmLWJ5OiBPYWsgWmVuZyA8T2FrLlplbmdAYW1kLmNvbT4NCj4+
IC0tLQ0KPj4gICAgLi4uL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFn
ZXIuYyAgfCA0NiArKysrKysrKysrKysrKysrLS0tLS0tDQo+PiAgICAxIGZpbGUgY2hhbmdlZCwg
MzUgaW5zZXJ0aW9ucygrKSwgMTEgZGVsZXRpb25zKC0pDQo+Pg0KPj4gZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5jIA0KPj4g
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuYw0K
Pj4gaW5kZXggZWNlMzVjNy4uMWY3MDdiYiAxMDA2NDQNCj4+IC0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5jDQo+PiArKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuYw0KPj4gQEAgLTYx
LDYgKzYxLDggQEAgc3RhdGljIGludCBjcmVhdGVfc2RtYV9xdWV1ZV9ub2Nwc2NoKHN0cnVjdCAN
Cj4+IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sDQo+PiAgICANCj4+ICAgIHN0YXRpYyB2b2lk
IGRlYWxsb2NhdGVfc2RtYV9xdWV1ZShzdHJ1Y3QgZGV2aWNlX3F1ZXVlX21hbmFnZXIgKmRxbSwN
Cj4+ICAgIAkJCQlzdHJ1Y3QgcXVldWUgKnEpOw0KPj4gK3N0YXRpYyB2b2lkIGRlYWxsb2NhdGVf
c2RtYV9xdWV1ZV9sb2NrZWQoc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sDQo+PiAr
CQkJCXN0cnVjdCBxdWV1ZSAqcSk7DQo+PiAgICANCj4+ICAgIHN0YXRpYyB2b2lkIGtmZF9wcm9j
ZXNzX2h3X2V4Y2VwdGlvbihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspOw0KPj4gICAgDQo+PiBA
QCAtNDQ2LDEwICs0NDgsMTAgQEAgc3RhdGljIGludCBkZXN0cm95X3F1ZXVlX25vY3BzY2hfbG9j
a2VkKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLA0KPj4gICAgCQlkZWFsbG9jYXRl
X2hxZChkcW0sIHEpOw0KPj4gICAgCX0gZWxzZSBpZiAocS0+cHJvcGVydGllcy50eXBlID09IEtG
RF9RVUVVRV9UWVBFX1NETUEpIHsNCj4+ICAgIAkJZHFtLT5zZG1hX3F1ZXVlX2NvdW50LS07DQo+
PiAtCQlkZWFsbG9jYXRlX3NkbWFfcXVldWUoZHFtLCBxKTsNCj4+ICsJCWRlYWxsb2NhdGVfc2Rt
YV9xdWV1ZV9sb2NrZWQoZHFtLCBxKTsNCj4+ICAgIAl9IGVsc2UgaWYgKHEtPnByb3BlcnRpZXMu
dHlwZSA9PSBLRkRfUVVFVUVfVFlQRV9TRE1BX1hHTUkpIHsNCj4+ICAgIAkJZHFtLT54Z21pX3Nk
bWFfcXVldWVfY291bnQtLTsNCj4+IC0JCWRlYWxsb2NhdGVfc2RtYV9xdWV1ZShkcW0sIHEpOw0K
Pj4gKwkJZGVhbGxvY2F0ZV9zZG1hX3F1ZXVlX2xvY2tlZChkcW0sIHEpOw0KPj4gICAgCX0gZWxz
ZSB7DQo+PiAgICAJCXByX2RlYnVnKCJxLT5wcm9wZXJ0aWVzLnR5cGUgJWQgaXMgaW52YWxpZFxu
IiwNCj4+ICAgIAkJCQlxLT5wcm9wZXJ0aWVzLnR5cGUpOw0KPj4gQEAgLTkyMiw4ICs5MjQsMTAg
QEAgc3RhdGljIGludCBhbGxvY2F0ZV9zZG1hX3F1ZXVlKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFu
YWdlciAqZHFtLA0KPj4gICAgCWlmIChxLT5wcm9wZXJ0aWVzLnR5cGUgPT0gS0ZEX1FVRVVFX1RZ
UEVfU0RNQSkgew0KPj4gICAgCQlpZiAoZHFtLT5zZG1hX2JpdG1hcCA9PSAwKQ0KPj4gICAgCQkJ
cmV0dXJuIC1FTk9NRU07DQo+PiArCQlkcW1fbG9jayhkcW0pOw0KPiBEb2Vzbid0IHRoaXMgY2F1
c2UgYSBsb2NraW5nIGVycm9yIHdoZXJlIHlvdSB0cnkgdG8gdGFrZSB0aGUgc2FtZSBsb2NrIA0K
PiB0d2ljZSBpbiB0aGlzIGNhbGwgdHJlZToNCj4NCj4gY3JlYXRlX3F1ZXVlX25vY3BzY2ggKHRh
a2VzIERRTSBsb2NrKQ0KPiAgIMKgwqDCoCAtPiBjcmVhdGVfc2RtYV9xdWV1ZV9ub2Nwc2NoDQo+
ICAgwqDCoMKgwqDCoMKgwqAgLT4gYWxsb2NhdGVfc2RtYV9xdWV1ZSAodGFrZXMgRFFNIGxvY2sg
YWdhaW4pDQo+DQpCVFcsIEkgdGhpbmsgeW91IGFjdHVhbGx5IGNhdWdodCBhIGJ1ZyBoZXJlLiBJ
biB0aGUgY3JlYXRlX3F1ZXVlX2Nwc2NoIHBhdGggd2UgZmFpbGVkIHRvIGxvY2sgdGhlIERRTSBm
b3IgU0RNQSBxdWV1ZSBhbGxvY2F0aW9uLiBJbiBjcmVhdGVfcXVldWVfbm9jcHNjaCBpdCB3YXMg
bm90IGEgcHJvYmxlbSBiZWNhdXNlIHdlIHRvb2sgdGhlIERRTSBsb2NrIGVhcmxpZXIgKHdoaWNo
IGlzIGl0c2VsZiBhIHByb2JsZW0geW91J3JlIHdvcmtpbmcgb24gZml4aW5nKS4NCg0KSG93ZXZl
ciwgbm93IHlvdSdyZSBtYWtpbmcgdGhlIHByb2JsZW0gd29yc2UgZm9yIHRoZSBub2Nwc2NoIGNh
c2UsIGF0IGxlYXN0IHVudGlsIHBhdGNoIDQsIHdoaWNoIG1vdmVzIHRoZSBEUU0gbG9ja2luZyBp
biBjcmVhdGVfcXVldWVfbm9jcHNjaC4gTWF5YmUgdGhpcyBjaGFuZ2Ugc2hvdWxkIGNvbWUgYWZ0
ZXIgcGF0Y2ggNCBzbyB5b3UgZG9uJ3QgZW5kIHVwIHdpdGggYSB3b3JzZSBwcm9ibGVtIGluIHRo
ZSBtaWRkbGUgb2YgeW91ciBwYXRjaCBzZXJpZXMuDQpbT2FrXTogSSByZWFsaXplZCB0aGUgc2Ft
ZSBpc3N1ZSB3aGVuIEkgd3JvdGUgdGhpcyBwYXRjaC4uLkkgd2lsbCBoYXZlIHRvIGNyZWF0ZSBm
dW5jdGlvbiBhbGxvY2F0ZV9zZG1hX3F1ZXVlX2xvY2tlZC91bmxvY2tlZCB0byBmaXggdGhlIGlz
c3VlIHByb3Blcmx5LiBCdXQgSSB3aWxsIGhhdmUgdG8gZGVsZXRlIGFsbG9jYXRlX3NkbWFfcXVl
dWVfdW5sb2NrZWQgYWZ0ZXIgcGF0Y2ggNCBiZWNhdXNlIGl0IHdvbid0IGJlIHVzZWQgYW55IG1v
cmUgYWZ0ZXIgcGF0Y2ggNC4NCg0KSXQgaXMgYSBnb29kIGlkZWEgdG8gZG8gdGhpcyBwYXRjaCBh
ZnRlciBwYXRjaCA0LiBJIHdpbGwgcmUtc3VibWl0IHRoZSBwYXRjaGVzIHNlcmllcywgYWxzbyBm
aXhpbmcgb3RoZXIgaXNzdWVzIHlvdSBtZW50aW9uZWQuDQoNCkFsc28sIEkgdGhpbmsgeW91J3Jl
IGRvaW5nIHRoZSBsb2NraW5nIHVubmVjZXNzYXJpbHkgZmluZSBncmFpbmVkLiBJdCdzIHByb2Jh
Ymx5IGVub3VnaCB0byB0YWtlIHRoZSBEUU0gbG9jayBvbmNlIGF0IHRoZSBzdGFydCBvZiBhbGxv
Y2F0ZV9zZG1hX3F1ZXVlLCBhbmQgZHJvcCBpdCBvbmNlIGluIHRoZSBlbmQuIE5vIG5lZWQgdG8g
ZHVwbGljYXRlIHRoaXMgaW4gdGhlIHR3byBpZiBicmFuY2hlcy4NCltPYWtdIEFncmVlZC4NCg0K
UmVnYXJkcywNCiDCoCBGZWxpeA0KDQo+PiAgICAJCWJpdCA9IF9fZmZzNjQoZHFtLT5zZG1hX2Jp
dG1hcCk7DQo+PiAgICAJCWRxbS0+c2RtYV9iaXRtYXAgJj0gfigxVUxMIDw8IGJpdCk7DQo+PiAr
CQlkcW1fdW5sb2NrKGRxbSk7DQo+PiAgICAJCXEtPnNkbWFfaWQgPSBiaXQ7DQo+PiAgICAJCXEt
PnByb3BlcnRpZXMuc2RtYV9lbmdpbmVfaWQgPSBxLT5zZG1hX2lkICUNCj4+ICAgIAkJCQlnZXRf
bnVtX3NkbWFfZW5naW5lcyhkcW0pOw0KPj4gQEAgLTkzMiw4ICs5MzYsMTAgQEAgc3RhdGljIGlu
dCBhbGxvY2F0ZV9zZG1hX3F1ZXVlKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLA0K
Pj4gICAgCX0gZWxzZSBpZiAocS0+cHJvcGVydGllcy50eXBlID09IEtGRF9RVUVVRV9UWVBFX1NE
TUFfWEdNSSkgew0KPj4gICAgCQlpZiAoZHFtLT54Z21pX3NkbWFfYml0bWFwID09IDApDQo+PiAg
ICAJCQlyZXR1cm4gLUVOT01FTTsNCj4+ICsJCWRxbV9sb2NrKGRxbSk7DQo+PiAgICAJCWJpdCA9
IF9fZmZzNjQoZHFtLT54Z21pX3NkbWFfYml0bWFwKTsNCj4+ICAgIAkJZHFtLT54Z21pX3NkbWFf
Yml0bWFwICY9IH4oMVVMTCA8PCBiaXQpOw0KPj4gKwkJZHFtX3VubG9jayhkcW0pOw0KPj4gICAg
CQlxLT5zZG1hX2lkID0gYml0Ow0KPj4gICAgCQkvKiBzZG1hX2VuZ2luZV9pZCBpcyBzZG1hIGlk
IGluY2x1ZGluZw0KPj4gICAgCQkgKiBib3RoIFBDSWUtb3B0aW1pemVkIFNETUFzIGFuZCBYR01J
LSBAQCAtOTUzLDE3ICs5NTksMzUgQEAgDQo+PiBzdGF0aWMgaW50IGFsbG9jYXRlX3NkbWFfcXVl
dWUoc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sDQo+PiAgICAJcmV0dXJuIDA7DQo+
PiAgICB9DQo+PiAgICANCj4+ICtzdGF0aWMgdm9pZCBkZWFsbG9jYXRlX3NkbWFfcXVldWVfbG9j
a2VkKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLA0KPj4gKwkJCQlzdHJ1Y3QgcXVl
dWUgKnEpDQo+PiArew0KPj4gKwlpZiAocS0+cHJvcGVydGllcy50eXBlID09IEtGRF9RVUVVRV9U
WVBFX1NETUEpIHsNCj4+ICsJCWlmIChxLT5zZG1hX2lkID49IGdldF9udW1fc2RtYV9xdWV1ZXMo
ZHFtKSkNCj4+ICsJCQlyZXR1cm47DQo+PiArCQlkcW0tPnNkbWFfYml0bWFwIHw9ICgxVUxMIDw8
IHEtPnNkbWFfaWQpOw0KPj4gKwl9IGVsc2UgaWYgKHEtPnByb3BlcnRpZXMudHlwZSA9PSBLRkRf
UVVFVUVfVFlQRV9TRE1BX1hHTUkpIHsNCj4+ICsJCWlmIChxLT5zZG1hX2lkID49IGdldF9udW1f
eGdtaV9zZG1hX3F1ZXVlcyhkcW0pKQ0KPj4gKwkJCXJldHVybjsNCj4+ICsJCWRxbS0+eGdtaV9z
ZG1hX2JpdG1hcCB8PSAoMVVMTCA8PCBxLT5zZG1hX2lkKTsNCj4+ICsJfQ0KPj4gK30NCj4+ICsN
Cj4+ICAgIHN0YXRpYyB2b2lkIGRlYWxsb2NhdGVfc2RtYV9xdWV1ZShzdHJ1Y3QgZGV2aWNlX3F1
ZXVlX21hbmFnZXIgKmRxbSwNCj4+ICAgIAkJCQlzdHJ1Y3QgcXVldWUgKnEpDQo+PiAgICB7DQo+
PiAgICAJaWYgKHEtPnByb3BlcnRpZXMudHlwZSA9PSBLRkRfUVVFVUVfVFlQRV9TRE1BKSB7DQo+
PiAgICAJCWlmIChxLT5zZG1hX2lkID49IGdldF9udW1fc2RtYV9xdWV1ZXMoZHFtKSkNCj4+ICAg
IAkJCXJldHVybjsNCj4+ICsJCWRxbV9sb2NrKGRxbSk7DQo+PiAgICAJCWRxbS0+c2RtYV9iaXRt
YXAgfD0gKDFVTEwgPDwgcS0+c2RtYV9pZCk7DQo+PiArCQlkcW1fdW5sb2NrKGRxbSk7DQo+PiAg
ICAJfSBlbHNlIGlmIChxLT5wcm9wZXJ0aWVzLnR5cGUgPT0gS0ZEX1FVRVVFX1RZUEVfU0RNQV9Y
R01JKSB7DQo+PiAgICAJCWlmIChxLT5zZG1hX2lkID49IGdldF9udW1feGdtaV9zZG1hX3F1ZXVl
cyhkcW0pKQ0KPj4gICAgCQkJcmV0dXJuOw0KPj4gKwkJZHFtX2xvY2soZHFtKTsNCj4+ICAgIAkJ
ZHFtLT54Z21pX3NkbWFfYml0bWFwIHw9ICgxVUxMIDw8IHEtPnNkbWFfaWQpOw0KPj4gKwkJZHFt
X3VubG9jayhkcW0pOw0KPj4gICAgCX0NCj4+ICAgIH0NCj4gWW91IGNvdWxkIG1pbmltaXplIGNv
ZGUgZHVwbGljYXRpb24gYnkgZGVmaW5pbmcgZGVhbGxvY2F0ZV9zZG1hX3F1ZXVlIA0KPiBhcyBh
IHNpbXBsZSB3cmFwcGVyOg0KPg0KPiBzdGF0aWMgdm9pZCBkZWFsbG9jYXRlX3NkbWFfcXVldWUo
c3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sIA0KPiBzdHJ1Y3QgcXVldWUgKnEpIHsN
Cj4gICDCoMKgwqAgwqDCoMKgIGRxbV9sb2NrKGRxbSk7DQo+ICAgwqDCoMKgIMKgwqDCoCBkZWFs
bG9jYXRlX3NkbWFfcXVldWVfbG9ja2VkKGRxbSwgcSk7DQo+ICAgwqDCoMKgIMKgwqDCoCBkcW1f
dW5sb2NrKGRxbSk7DQo+IH0NCj4NCj4NCj4+ICAgIA0KPj4gQEAgLTk4Miw3ICsxMDA2LDcgQEAg
c3RhdGljIGludCBjcmVhdGVfc2RtYV9xdWV1ZV9ub2Nwc2NoKHN0cnVjdCANCj4+IGRldmljZV9x
dWV1ZV9tYW5hZ2VyICpkcW0sDQo+PiAgICANCj4+ICAgIAlyZXR2YWwgPSBhbGxvY2F0ZV9kb29y
YmVsbChxcGQsIHEpOw0KPj4gICAgCWlmIChyZXR2YWwpDQo+PiAtCQlnb3RvIG91dF9kZWFsbG9j
YXRlX3NkbWFfcXVldWU7DQo+PiArCQlnb3RvIG91dF9kZWFsbG9jYXRlX3NkbWFfcXVldWVfbG9j
a2VkOw0KPj4gICAgDQo+PiAgICAJZHFtLT5hc2ljX29wcy5pbml0X3NkbWFfdm0oZHFtLCBxLCBx
cGQpOw0KPj4gICAgCXJldHZhbCA9IG1xZF9tZ3ItPmluaXRfbXFkKG1xZF9tZ3IsICZxLT5tcWQs
ICZxLT5tcWRfbWVtX29iaiwgQEAgDQo+PiAtMTAwMSw4ICsxMDI1LDggQEAgc3RhdGljIGludCBj
cmVhdGVfc2RtYV9xdWV1ZV9ub2Nwc2NoKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFt
LA0KPj4gICAgCW1xZF9tZ3ItPnVuaW5pdF9tcWQobXFkX21nciwgcS0+bXFkLCBxLT5tcWRfbWVt
X29iaik7DQo+PiAgICBvdXRfZGVhbGxvY2F0ZV9kb29yYmVsbDoNCj4+ICAgIAlkZWFsbG9jYXRl
X2Rvb3JiZWxsKHFwZCwgcSk7DQo+PiAtb3V0X2RlYWxsb2NhdGVfc2RtYV9xdWV1ZToNCj4+IC0J
ZGVhbGxvY2F0ZV9zZG1hX3F1ZXVlKGRxbSwgcSk7DQo+PiArb3V0X2RlYWxsb2NhdGVfc2RtYV9x
dWV1ZV9sb2NrZWQ6DQo+PiArCWRlYWxsb2NhdGVfc2RtYV9xdWV1ZV9sb2NrZWQoZHFtLCBxKTsN
Cj4+ICAgIA0KPj4gICAgCXJldHVybiByZXR2YWw7DQo+PiAgICB9DQo+PiBAQCAtMTE5NCw3ICsx
MjE4LDcgQEAgc3RhdGljIGludCBjcmVhdGVfcXVldWVfY3BzY2goc3RydWN0IA0KPj4gZGV2aWNl
X3F1ZXVlX21hbmFnZXIgKmRxbSwgc3RydWN0IHF1ZXVlICpxLA0KPj4gICAgDQo+PiAgICAJcmV0
dmFsID0gYWxsb2NhdGVfZG9vcmJlbGwocXBkLCBxKTsNCj4+ICAgIAlpZiAocmV0dmFsKQ0KPj4g
LQkJZ290byBvdXRfZGVhbGxvY2F0ZV9zZG1hX3F1ZXVlOw0KPj4gKwkJZ290byBvdXRfZGVhbGxv
Y2F0ZV9zZG1hX3F1ZXVlX2xvY2tlZDsNCj4+ICAgIA0KPj4gICAgCW1xZF9tZ3IgPSBkcW0tPm1x
ZF9tZ3JzW2dldF9tcWRfdHlwZV9mcm9tX3F1ZXVlX3R5cGUoDQo+PiAgICAJCQlxLT5wcm9wZXJ0
aWVzLnR5cGUpXTsNCj4+IEBAIC0xMjQyLDcgKzEyNjYsNyBAQCBzdGF0aWMgaW50IGNyZWF0ZV9x
dWV1ZV9jcHNjaChzdHJ1Y3QgDQo+PiBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLCBzdHJ1Y3Qg
cXVldWUgKnEsDQo+PiAgICANCj4+ICAgIG91dF9kZWFsbG9jYXRlX2Rvb3JiZWxsOg0KPj4gICAg
CWRlYWxsb2NhdGVfZG9vcmJlbGwocXBkLCBxKTsNCj4+IC1vdXRfZGVhbGxvY2F0ZV9zZG1hX3F1
ZXVlOg0KPj4gK291dF9kZWFsbG9jYXRlX3NkbWFfcXVldWVfbG9ja2VkOg0KPiBXaHkgYXJlIHlv
dSByZW5hbWluZyB0aGlzIGxhYmVsPyBZb3UgZG9uJ3QgaG9sZCB0aGUgRFFNIGxvY2sgd2hlbiB5
b3UgDQo+IGdldCBoZXJlLg0KPg0KPg0KPj4gICAgCWlmIChxLT5wcm9wZXJ0aWVzLnR5cGUgPT0g
S0ZEX1FVRVVFX1RZUEVfU0RNQSB8fA0KPj4gICAgCQlxLT5wcm9wZXJ0aWVzLnR5cGUgPT0gS0ZE
X1FVRVVFX1RZUEVfU0RNQV9YR01JKQ0KPj4gICAgCQlkZWFsbG9jYXRlX3NkbWFfcXVldWUoZHFt
LCBxKTsNCj4+IEBAIC0xMzk2LDEwICsxNDIwLDEwIEBAIHN0YXRpYyBpbnQgZGVzdHJveV9xdWV1
ZV9jcHNjaChzdHJ1Y3QgDQo+PiBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtLA0KPj4gICAgDQo+
PiAgICAJaWYgKHEtPnByb3BlcnRpZXMudHlwZSA9PSBLRkRfUVVFVUVfVFlQRV9TRE1BKSB7DQo+
PiAgICAJCWRxbS0+c2RtYV9xdWV1ZV9jb3VudC0tOw0KPj4gLQkJZGVhbGxvY2F0ZV9zZG1hX3F1
ZXVlKGRxbSwgcSk7DQo+PiArCQlkZWFsbG9jYXRlX3NkbWFfcXVldWVfbG9ja2VkKGRxbSwgcSk7
DQo+PiAgICAJfSBlbHNlIGlmIChxLT5wcm9wZXJ0aWVzLnR5cGUgPT0gS0ZEX1FVRVVFX1RZUEVf
U0RNQV9YR01JKSB7DQo+PiAgICAJCWRxbS0+eGdtaV9zZG1hX3F1ZXVlX2NvdW50LS07DQo+PiAt
CQlkZWFsbG9jYXRlX3NkbWFfcXVldWUoZHFtLCBxKTsNCj4+ICsJCWRlYWxsb2NhdGVfc2RtYV9x
dWV1ZV9sb2NrZWQoZHFtLCBxKTsNCj4+ICAgIAl9DQo+PiAgICANCj4+ICAgIAlsaXN0X2RlbCgm
cS0+bGlzdCk7DQo+PiBAQCAtMTYyNSwxMCArMTY0OSwxMCBAQCBzdGF0aWMgaW50IHByb2Nlc3Nf
dGVybWluYXRpb25fY3BzY2goc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sDQo+PiAg
ICAJbGlzdF9mb3JfZWFjaF9lbnRyeShxLCAmcXBkLT5xdWV1ZXNfbGlzdCwgbGlzdCkgew0KPj4g
ICAgCQlpZiAocS0+cHJvcGVydGllcy50eXBlID09IEtGRF9RVUVVRV9UWVBFX1NETUEpIHsNCj4+
ICAgIAkJCWRxbS0+c2RtYV9xdWV1ZV9jb3VudC0tOw0KPj4gLQkJCWRlYWxsb2NhdGVfc2RtYV9x
dWV1ZShkcW0sIHEpOw0KPj4gKwkJCWRlYWxsb2NhdGVfc2RtYV9xdWV1ZV9sb2NrZWQoZHFtLCBx
KTsNCj4+ICAgIAkJfSBlbHNlIGlmIChxLT5wcm9wZXJ0aWVzLnR5cGUgPT0gS0ZEX1FVRVVFX1RZ
UEVfU0RNQV9YR01JKSB7DQo+PiAgICAJCQlkcW0tPnhnbWlfc2RtYV9xdWV1ZV9jb3VudC0tOw0K
Pj4gLQkJCWRlYWxsb2NhdGVfc2RtYV9xdWV1ZShkcW0sIHEpOw0KPj4gKwkJCWRlYWxsb2NhdGVf
c2RtYV9xdWV1ZV9sb2NrZWQoZHFtLCBxKTsNCj4+ICAgIAkJfQ0KPj4gICAgDQo+PiAgICAJCWlm
IChxLT5wcm9wZXJ0aWVzLmlzX2FjdGl2ZSkNCj4gX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18NCj4gYW1kLWdmeCBtYWlsaW5nIGxpc3QNCj4gYW1kLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcNCj4gaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9hbWQtZ2Z4DQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ft
ZC1nZng=
