Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E4DF148EB7
	for <lists+amd-gfx@lfdr.de>; Mon, 17 Jun 2019 21:27:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C390F898F1;
	Mon, 17 Jun 2019 19:27:43 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qk1-x743.google.com (mail-qk1-x743.google.com
 [IPv6:2607:f8b0:4864:20::743])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EFFAB898F1
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 19:27:39 +0000 (UTC)
Received: by mail-qk1-x743.google.com with SMTP id c11so6937125qkk.8
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 12:27:39 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=kyPRA8yEFcdGKZVezXxiSoRmpEteaD0oAomNUrE4xzk=;
 b=BRSlS9q1/68Q3Yn47XCnPUncMav33Y9Yx+p+Kn98ihf/uwOLo5vk2MM8moJp5rShiP
 kAkZY7PlwetWft/RvW71eA8uChEgrLvJAwyZNnYla+1+kJOTiG/da+Bjqx5XPfBmpy04
 3VRFIViQDDZWf7ZOoawxWGx4Ku+fwU2m1XgFD6v3AsmX1GZl1UrZ7aicy537P1nsKV4T
 qpGpeVSgylz33EGSXLsdsaIZNAkVaJyIvx70lqpQgotMHZeW6l24SjJO/HGmjHvirRjX
 4D0XD5LIqYRbfys4gfJc3Jf1I5d+5Wx1oGEqqDh+bDivuQzgCiamLc235gg/VYXxdkaJ
 ihdQ==
X-Gm-Message-State: APjAAAVceTwyRLhhminejtYwod8LfaQZesmvSyXbaN+NVrUTViGAEXrE
 mobmT2Xawk0iasGRV9u+ITm06mzJaW4=
X-Google-Smtp-Source: APXvYqzz8UDtPXQvN2cPZeUs2Fx3AJHDEPnBSKY2sKNXz5AmUXhIHO2FUVwZEy3BDfFdw3We0PwVBw==
X-Received: by 2002:a37:a24f:: with SMTP id l76mr50292763qke.252.1560799658492; 
 Mon, 17 Jun 2019 12:27:38 -0700 (PDT)
Received: from localhost.localdomain ([71.219.5.136])
 by smtp.gmail.com with ESMTPSA id p37sm7715622qtc.35.2019.06.17.12.27.37
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 17 Jun 2019 12:27:37 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 126/459] drm/amdgpu: Add navi10 kfd support for amdgpu (v3)
Date: Mon, 17 Jun 2019 14:25:51 -0500
Message-Id: <20190617192704.18038-27-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617192704.18038-1-alexander.deucher@amd.com>
References: <20190617192704.18038-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=kyPRA8yEFcdGKZVezXxiSoRmpEteaD0oAomNUrE4xzk=;
 b=dTEsuWpo5O0HdNt8QR1jJK9W/a8HajqMNE2lSHehk8PDrHxPCpYeHqSi6IPNsAaAJB
 ALB6zCJFeyWFUFulu5tFo4FLe2KpwSSTkMmVux4xsTyAJVyKS1QT71Y7Bn2/2d5Th5en
 kmomPy4zTvZUSKP2spMcsbFcVKmtkwaAOpVY8eV/IoLlC9riXzkYrTPaUzS36phalK37
 sPbFnRBJFByLQMBfNxdwzN8EsHPuiY5MBlQB8Ihn072xiYFCJk3+Np/QlnLy3FCP6+iS
 DgqrVNRODheOKZ8NSilw5vkb5HmWsx1CefTQQz2c3Y/uZKWDYrgvdBTefYOFymQREyYx
 utGQ==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Philip Cox <Philip.Cox@amd.com>,
 Oak Zeng <Oak.Zeng@amd.com>, Hawking Zhang <Hawking.Zhang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogSGF3a2luZyBaaGFuZyA8SGF3a2luZy5aaGFuZ0BhbWQuY29tPgoKS0ZEIChLZXJuZWwg
RnVzaW9uIERyaXZlcikgaXMgdGhlIGNvbXB1dGUgYmFja2VuZCBkcml2ZXIKZm9yIEFNRCBHUFVz
LgoKdjI6IHNxdWFzaCBpbiB1cGRhdGVzIChBbGV4KQp2MzogZml4IHdhcm5pbmdzIChBbGV4KQoK
U2lnbmVkLW9mZi1ieTogT2FrIFplbmcgPE9hay5aZW5nQGFtZC5jb20+ClNpZ25lZC1vZmYtYnk6
IFBoaWxpcCBDb3ggPFBoaWxpcC5Db3hAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogSGF3a2luZyBa
aGFuZyA8SGF3a2luZy5aaGFuZ0BhbWQuY29tPgpBY2tlZC1ieTogQWxleCBEZXVjaGVyIDxhbGV4
YW5kZXIuZGV1Y2hlckBhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBBbGV4IERldWNoZXIgPGFsZXhh
bmRlci5kZXVjaGVyQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvTWFr
ZWZpbGUgICAgICAgICAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfYW1ka2ZkLmMgICAgfCAgMTcgKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9hbWRrZmQuaCAgICB8ICAgMSArCiAuLi4vZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9n
ZnhfdjEwLmMgICAgfCA5NzUgKysrKysrKysrKysrKysrKysrCiA0IGZpbGVzIGNoYW5nZWQsIDk5
MiBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3YxMC5jCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9NYWtlZmlsZQppbmRleCAyMDVlYTZhMWQ4OTMuLjE3MTI5MzdhZTA3YSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvTWFrZWZpbGUKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvTWFrZWZpbGUKQEAgLTE1OSw3ICsxNTksOCBAQCBhbWRncHUt
eSArPSBcCiAJIGFtZGdwdV9hbWRrZmRfZmVuY2UubyBcCiAJIGFtZGdwdV9hbWRrZmRfZ3B1dm0u
byBcCiAJIGFtZGdwdV9hbWRrZmRfZ2Z4X3Y4Lm8gXAotCSBhbWRncHVfYW1ka2ZkX2dmeF92OS5v
CisJIGFtZGdwdV9hbWRrZmRfZ2Z4X3Y5Lm8gXAorCSBhbWRncHVfYW1ka2ZkX2dmeF92MTAubwog
CiBpZm5lcSAoJChDT05GSUdfRFJNX0FNREdQVV9DSUspLCkKIGFtZGdwdS15ICs9IGFtZGdwdV9h
bWRrZmRfZ2Z4X3Y3Lm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9hbWRrZmQuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmQu
YwppbmRleCAwNTc4YmViNDI5N2EuLmFiMDUzMjVkNjc0MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmQuYwpAQCAtODcsNiArODcsOSBAQCB2b2lkIGFtZGdwdV9h
bWRrZmRfZGV2aWNlX3Byb2JlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCWNhc2UgQ0hJ
UF9SQVZFTjoKIAkJa2ZkMmtnZCA9IGFtZGdwdV9hbWRrZmRfZ2Z4XzlfMF9nZXRfZnVuY3Rpb25z
KCk7CiAJCWJyZWFrOworCWNhc2UgQ0hJUF9OQVZJMTA6CisJCWtmZDJrZ2QgPSBhbWRncHVfYW1k
a2ZkX2dmeF8xMF8wX2dldF9mdW5jdGlvbnMoKTsKKwkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJZGV2
X2luZm8oYWRldi0+ZGV2LCAia2ZkIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBBU0lDXG4iKTsKIAkJ
cmV0dXJuOwpAQCAtNDM3LDkgKzQ0MCwxMiBAQCB2b2lkIGFtZGdwdV9hbWRrZmRfZ2V0X2xvY2Fs
X21lbV9pbmZvKHN0cnVjdCBrZ2RfZGV2ICprZ2QsCiAKIAlpZiAoYW1kZ3B1X3NyaW92X3ZmKGFk
ZXYpKQogCQltZW1faW5mby0+bWVtX2Nsa19tYXggPSBhZGV2LT5jbG9jay5kZWZhdWx0X21jbGsg
LyAxMDA7Ci0JZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzKQotCQltZW1faW5mby0+
bWVtX2Nsa19tYXggPSBhbWRncHVfZHBtX2dldF9tY2xrKGFkZXYsIGZhbHNlKSAvIDEwMDsKLQll
bHNlCisJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzKSB7CisJCWlmIChhbWRncHVf
ZW11X21vZGUgPT0gMSkKKwkJCW1lbV9pbmZvLT5tZW1fY2xrX21heCA9IDA7CisJCWVsc2UKKwkJ
CW1lbV9pbmZvLT5tZW1fY2xrX21heCA9IGFtZGdwdV9kcG1fZ2V0X21jbGsoYWRldiwgZmFsc2Up
IC8gMTAwOworCX0gZWxzZQogCQltZW1faW5mby0+bWVtX2Nsa19tYXggPSAxMDA7CiB9CiAKQEAg
LTcwMiw2ICs3MDgsMTEgQEAgc3RydWN0IGtmZDJrZ2RfY2FsbHMgKmFtZGdwdV9hbWRrZmRfZ2Z4
XzlfMF9nZXRfZnVuY3Rpb25zKHZvaWQpCiAJcmV0dXJuIE5VTEw7CiB9CiAKK3N0cnVjdCBrZmQy
a2dkX2NhbGxzICphbWRncHVfYW1ka2ZkX2dmeF8xMF8wX2dldF9mdW5jdGlvbnModm9pZCkKK3sK
KwlyZXR1cm4gTlVMTDsKK30KKwogc3RydWN0IGtmZF9kZXYgKmtnZDJrZmRfcHJvYmUoc3RydWN0
IGtnZF9kZXYgKmtnZCwgc3RydWN0IHBjaV9kZXYgKnBkZXYsCiAJCQkgICAgICBjb25zdCBzdHJ1
Y3Qga2ZkMmtnZF9jYWxscyAqZjJnKQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2FtZGtmZC5oCmluZGV4IGY5NjhiZjE0N2M1ZS4uOTNhMjVjNzk5ZDc1IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5oCkBAIC0xMzksNiArMTM5LDcgQEAg
dm9pZCBhbWRncHVfYW1ka2ZkX3NldF9jb21wdXRlX2lkbGUoc3RydWN0IGtnZF9kZXYgKmtnZCwg
Ym9vbCBpZGxlKTsKIHN0cnVjdCBrZmQya2dkX2NhbGxzICphbWRncHVfYW1ka2ZkX2dmeF83X2dl
dF9mdW5jdGlvbnModm9pZCk7CiBzdHJ1Y3Qga2ZkMmtnZF9jYWxscyAqYW1kZ3B1X2FtZGtmZF9n
ZnhfOF8wX2dldF9mdW5jdGlvbnModm9pZCk7CiBzdHJ1Y3Qga2ZkMmtnZF9jYWxscyAqYW1kZ3B1
X2FtZGtmZF9nZnhfOV8wX2dldF9mdW5jdGlvbnModm9pZCk7CitzdHJ1Y3Qga2ZkMmtnZF9jYWxs
cyAqYW1kZ3B1X2FtZGtmZF9nZnhfMTBfMF9nZXRfZnVuY3Rpb25zKHZvaWQpOwogCiBib29sIGFt
ZGdwdV9hbWRrZmRfaXNfa2ZkX3ZtaWQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiB2
bWlkKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Ft
ZGtmZF9nZnhfdjEwLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2Zk
X2dmeF92MTAuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjM5ZmZi
MDc4YmViNAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9hbWRrZmRfZ2Z4X3YxMC5jCkBAIC0wLDAgKzEsOTc1IEBACisvKgorICogQ29weXJpZ2h0
IDIwMTkgQWR2YW5jZWQgTWljcm8gRGV2aWNlcywgSW5jLgorICoKKyAqIFBlcm1pc3Npb24gaXMg
aGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBh
CisgKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBm
aWxlcyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91
dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICogdGhlIHJpZ2h0
cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1Ymxp
Y2Vuc2UsCisgKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVy
bWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBz
bywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3Zl
IGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5j
bHVkZWQgaW4KKyAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNv
ZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VU
IFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisgKiBJTVBMSUVELCBJTkNMVURJTkcg
QlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKyAq
IEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJ
TiBOTyBFVkVOVCBTSEFMTAorICogVEhFIENPUFlSSUdIVCBIT0xERVIoUykgT1IgQVVUSE9SKFMp
IEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SCisgKiBPVEhFUiBMSUFCSUxJVFks
IFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwKKyAq
IEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUg
T1IgVEhFIFVTRSBPUgorICogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgorICovCisj
dW5kZWYgcHJfZm10CisjZGVmaW5lIHByX2ZtdChmbXQpICJrZmQya2dkOiAiIGZtdAorCisjaW5j
bHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvZmR0YWJsZS5oPgorI2luY2x1
ZGUgPGxpbnV4L3VhY2Nlc3MuaD4KKyNpbmNsdWRlIDxsaW51eC9maXJtd2FyZS5oPgorI2luY2x1
ZGUgPGxpbnV4L21tdV9jb250ZXh0Lmg+CisjaW5jbHVkZSA8ZHJtL2RybVAuaD4KKyNpbmNsdWRl
ICJhbWRncHUuaCIKKyNpbmNsdWRlICJhbWRncHVfYW1ka2ZkLmgiCisjaW5jbHVkZSAiYW1kZ3B1
X3Vjb2RlLmgiCisjaW5jbHVkZSAic29jMTVfaHdfaXAuaCIKKyNpbmNsdWRlICJnYy9nY18xMF8x
XzBfb2Zmc2V0LmgiCisjaW5jbHVkZSAiZ2MvZ2NfMTBfMV8wX3NoX21hc2suaCIKKyNpbmNsdWRl
ICJuYXZpMTBfZW51bS5oIgorI2luY2x1ZGUgImF0aHViL2F0aHViXzJfMF8wX29mZnNldC5oIgor
I2luY2x1ZGUgImF0aHViL2F0aHViXzJfMF8wX3NoX21hc2suaCIKKyNpbmNsdWRlICJvc3Mvb3Nz
c3lzXzVfMF8wX29mZnNldC5oIgorI2luY2x1ZGUgIm9zcy9vc3NzeXNfNV8wXzBfc2hfbWFzay5o
IgorI2luY2x1ZGUgInNvYzE1X2NvbW1vbi5oIgorI2luY2x1ZGUgInYxMF9zdHJ1Y3RzLmgiCisj
aW5jbHVkZSAibnYuaCIKKyNpbmNsdWRlICJudmQuaCIKKworZW51bSBocWRfZGVxdWV1ZV9yZXF1
ZXN0X3R5cGUgeworCU5PX0FDVElPTiA9IDAsCisJRFJBSU5fUElQRSwKKwlSRVNFVF9XQVZFUywK
KwlTQVZFX1dBVkVTCit9OworCisvKgorICogUmVnaXN0ZXIgYWNjZXNzIGZ1bmN0aW9ucworICov
CisKK3N0YXRpYyB2b2lkIGtnZF9wcm9ncmFtX3NoX21lbV9zZXR0aW5ncyhzdHJ1Y3Qga2dkX2Rl
diAqa2dkLCB1aW50MzJfdCB2bWlkLAorCQl1aW50MzJfdCBzaF9tZW1fY29uZmlnLAorCQl1aW50
MzJfdCBzaF9tZW1fYXBlMV9iYXNlLCB1aW50MzJfdCBzaF9tZW1fYXBlMV9saW1pdCwKKwkJdWlu
dDMyX3Qgc2hfbWVtX2Jhc2VzKTsKK3N0YXRpYyBpbnQga2dkX3NldF9wYXNpZF92bWlkX21hcHBp
bmcoc3RydWN0IGtnZF9kZXYgKmtnZCwgdW5zaWduZWQgaW50IHBhc2lkLAorCQl1bnNpZ25lZCBp
bnQgdm1pZCk7CitzdGF0aWMgaW50IGtnZF9pbml0X2ludGVycnVwdHMoc3RydWN0IGtnZF9kZXYg
KmtnZCwgdWludDMyX3QgcGlwZV9pZCk7CitzdGF0aWMgaW50IGtnZF9ocWRfbG9hZChzdHJ1Y3Qg
a2dkX2RldiAqa2dkLCB2b2lkICptcWQsIHVpbnQzMl90IHBpcGVfaWQsCisJCQl1aW50MzJfdCBx
dWV1ZV9pZCwgdWludDMyX3QgX191c2VyICp3cHRyLAorCQkJdWludDMyX3Qgd3B0cl9zaGlmdCwg
dWludDMyX3Qgd3B0cl9tYXNrLAorCQkJc3RydWN0IG1tX3N0cnVjdCAqbW0pOworc3RhdGljIGlu
dCBrZ2RfaHFkX2R1bXAoc3RydWN0IGtnZF9kZXYgKmtnZCwKKwkJCXVpbnQzMl90IHBpcGVfaWQs
IHVpbnQzMl90IHF1ZXVlX2lkLAorCQkJdWludDMyX3QgKCoqZHVtcClbMl0sIHVpbnQzMl90ICpu
X3JlZ3MpOworc3RhdGljIGludCBrZ2RfaHFkX3NkbWFfbG9hZChzdHJ1Y3Qga2dkX2RldiAqa2dk
LCB2b2lkICptcWQsCisJCQkgICAgIHVpbnQzMl90IF9fdXNlciAqd3B0ciwgc3RydWN0IG1tX3N0
cnVjdCAqbW0pOworc3RhdGljIGludCBrZ2RfaHFkX3NkbWFfZHVtcChzdHJ1Y3Qga2dkX2RldiAq
a2dkLAorCQkJICAgICB1aW50MzJfdCBlbmdpbmVfaWQsIHVpbnQzMl90IHF1ZXVlX2lkLAorCQkJ
ICAgICB1aW50MzJfdCAoKipkdW1wKVsyXSwgdWludDMyX3QgKm5fcmVncyk7CitzdGF0aWMgYm9v
bCBrZ2RfaHFkX2lzX29jY3VwaWVkKHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHVpbnQ2NF90IHF1ZXVl
X2FkZHJlc3MsCisJCXVpbnQzMl90IHBpcGVfaWQsIHVpbnQzMl90IHF1ZXVlX2lkKTsKK3N0YXRp
YyBib29sIGtnZF9ocWRfc2RtYV9pc19vY2N1cGllZChzdHJ1Y3Qga2dkX2RldiAqa2dkLCB2b2lk
ICptcWQpOworc3RhdGljIGludCBrZ2RfaHFkX2Rlc3Ryb3koc3RydWN0IGtnZF9kZXYgKmtnZCwg
dm9pZCAqbXFkLAorCQkJCWVudW0ga2ZkX3ByZWVtcHRfdHlwZSByZXNldF90eXBlLAorCQkJCXVu
c2lnbmVkIGludCB1dGltZW91dCwgdWludDMyX3QgcGlwZV9pZCwKKwkJCQl1aW50MzJfdCBxdWV1
ZV9pZCk7CitzdGF0aWMgaW50IGtnZF9ocWRfc2RtYV9kZXN0cm95KHN0cnVjdCBrZ2RfZGV2ICpr
Z2QsIHZvaWQgKm1xZCwKKwkJCQl1bnNpZ25lZCBpbnQgdXRpbWVvdXQpOworI2lmIDAKK3N0YXRp
YyB1aW50MzJfdCBnZXRfd2F0Y2hfYmFzZV9hZGRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KTsKKyNlbmRpZgorc3RhdGljIGludCBrZ2RfYWRkcmVzc193YXRjaF9kaXNhYmxlKHN0cnVjdCBr
Z2RfZGV2ICprZ2QpOworc3RhdGljIGludCBrZ2RfYWRkcmVzc193YXRjaF9leGVjdXRlKHN0cnVj
dCBrZ2RfZGV2ICprZ2QsCisJCQkJCXVuc2lnbmVkIGludCB3YXRjaF9wb2ludF9pZCwKKwkJCQkJ
dWludDMyX3QgY250bF92YWwsCisJCQkJCXVpbnQzMl90IGFkZHJfaGksCisJCQkJCXVpbnQzMl90
IGFkZHJfbG8pOworc3RhdGljIGludCBrZ2Rfd2F2ZV9jb250cm9sX2V4ZWN1dGUoc3RydWN0IGtn
ZF9kZXYgKmtnZCwKKwkJCQkJdWludDMyX3QgZ2Z4X2luZGV4X3ZhbCwKKwkJCQkJdWludDMyX3Qg
c3FfY21kKTsKK3N0YXRpYyB1aW50MzJfdCBrZ2RfYWRkcmVzc193YXRjaF9nZXRfb2Zmc2V0KHN0
cnVjdCBrZ2RfZGV2ICprZ2QsCisJCQkJCXVuc2lnbmVkIGludCB3YXRjaF9wb2ludF9pZCwKKwkJ
CQkJdW5zaWduZWQgaW50IHJlZ19vZmZzZXQpOworCitzdGF0aWMgYm9vbCBnZXRfYXRjX3ZtaWRf
cGFzaWRfbWFwcGluZ192YWxpZChzdHJ1Y3Qga2dkX2RldiAqa2dkLAorCQl1aW50OF90IHZtaWQp
Oworc3RhdGljIHVpbnQxNl90IGdldF9hdGNfdm1pZF9wYXNpZF9tYXBwaW5nX3Bhc2lkKHN0cnVj
dCBrZ2RfZGV2ICprZ2QsCisJCXVpbnQ4X3Qgdm1pZCk7CitzdGF0aWMgdm9pZCBzZXRfdm1fY29u
dGV4dF9wYWdlX3RhYmxlX2Jhc2Uoc3RydWN0IGtnZF9kZXYgKmtnZCwgdWludDMyX3Qgdm1pZCwK
KwkJdWludDY0X3QgcGFnZV90YWJsZV9iYXNlKTsKK3N0YXRpYyBpbnQgaW52YWxpZGF0ZV90bGJz
KHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHVpbnQxNl90IHBhc2lkKTsKK3N0YXRpYyBpbnQgaW52YWxp
ZGF0ZV90bGJzX3ZtaWQoc3RydWN0IGtnZF9kZXYgKmtnZCwgdWludDE2X3Qgdm1pZCk7CisKKy8q
IEJlY2F1c2Ugb2YgUkVHX0dFVF9GSUVMRCgpIGJlaW5nIHVzZWQsIHdlIHB1dCB0aGlzIGZ1bmN0
aW9uIGluIHRoZQorICogYXNpYyBzcGVjaWZpYyBmaWxlLgorICovCitzdGF0aWMgaW50IGFtZGdw
dV9hbWRrZmRfZ2V0X3RpbGVfY29uZmlnKHN0cnVjdCBrZ2RfZGV2ICprZ2QsCisJCXN0cnVjdCB0
aWxlX2NvbmZpZyAqY29uZmlnKQoreworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0
cnVjdCBhbWRncHVfZGV2aWNlICopa2dkOworCisJY29uZmlnLT5nYl9hZGRyX2NvbmZpZyA9IGFk
ZXYtPmdmeC5jb25maWcuZ2JfYWRkcl9jb25maWc7CisjaWYgMAorLyogVE9ETyAtIGNvbmZpcm0g
UkVHX0dFVF9GSUVMRCB4Miwgc2hvdWxkIGJlIE9LIGFzIGlzLi4uIGJ1dAorICogTUNfQVJCX1JB
TUNGRyByZWdpc3RlciBkb2Vzbid0IGV4aXN0IG9uIFZlZ2ExMCAtIGluaXRpYWwgYW1kZ3B1Cisg
KiBjaGFuZ2VzIGNvbW1lbnRlZCBvdXQgcmVsYXRlZCBjb2RlLCBkb2luZyB0aGUgc2FtZSBoZXJl
IGZvciBub3cgYnV0CisgKiBuZWVkIHRvIHN5bmMgd2l0aCBLZW4gZXQgYWwKKyAqLworCWNvbmZp
Zy0+bnVtX2JhbmtzID0gUkVHX0dFVF9GSUVMRChhZGV2LT5nZnguY29uZmlnLm1jX2FyYl9yYW1j
ZmcsCisJCQkJTUNfQVJCX1JBTUNGRywgTk9PRkJBTkspOworCWNvbmZpZy0+bnVtX3JhbmtzID0g
UkVHX0dFVF9GSUVMRChhZGV2LT5nZnguY29uZmlnLm1jX2FyYl9yYW1jZmcsCisJCQkJTUNfQVJC
X1JBTUNGRywgTk9PRlJBTktTKTsKKyNlbmRpZgorCisJY29uZmlnLT50aWxlX2NvbmZpZ19wdHIg
PSBhZGV2LT5nZnguY29uZmlnLnRpbGVfbW9kZV9hcnJheTsKKwljb25maWctPm51bV90aWxlX2Nv
bmZpZ3MgPQorCQkJQVJSQVlfU0laRShhZGV2LT5nZnguY29uZmlnLnRpbGVfbW9kZV9hcnJheSk7
CisJY29uZmlnLT5tYWNyb190aWxlX2NvbmZpZ19wdHIgPQorCQkJYWRldi0+Z2Z4LmNvbmZpZy5t
YWNyb3RpbGVfbW9kZV9hcnJheTsKKwljb25maWctPm51bV9tYWNyb190aWxlX2NvbmZpZ3MgPQor
CQkJQVJSQVlfU0laRShhZGV2LT5nZnguY29uZmlnLm1hY3JvdGlsZV9tb2RlX2FycmF5KTsKKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGtmZDJrZ2RfY2FsbHMga2ZkMmtn
ZCA9IHsKKwkucHJvZ3JhbV9zaF9tZW1fc2V0dGluZ3MgPSBrZ2RfcHJvZ3JhbV9zaF9tZW1fc2V0
dGluZ3MsCisJLnNldF9wYXNpZF92bWlkX21hcHBpbmcgPSBrZ2Rfc2V0X3Bhc2lkX3ZtaWRfbWFw
cGluZywKKwkuaW5pdF9pbnRlcnJ1cHRzID0ga2dkX2luaXRfaW50ZXJydXB0cywKKwkuaHFkX2xv
YWQgPSBrZ2RfaHFkX2xvYWQsCisJLmhxZF9zZG1hX2xvYWQgPSBrZ2RfaHFkX3NkbWFfbG9hZCwK
KwkuaHFkX2R1bXAgPSBrZ2RfaHFkX2R1bXAsCisJLmhxZF9zZG1hX2R1bXAgPSBrZ2RfaHFkX3Nk
bWFfZHVtcCwKKwkuaHFkX2lzX29jY3VwaWVkID0ga2dkX2hxZF9pc19vY2N1cGllZCwKKwkuaHFk
X3NkbWFfaXNfb2NjdXBpZWQgPSBrZ2RfaHFkX3NkbWFfaXNfb2NjdXBpZWQsCisJLmhxZF9kZXN0
cm95ID0ga2dkX2hxZF9kZXN0cm95LAorCS5ocWRfc2RtYV9kZXN0cm95ID0ga2dkX2hxZF9zZG1h
X2Rlc3Ryb3ksCisJLmFkZHJlc3Nfd2F0Y2hfZGlzYWJsZSA9IGtnZF9hZGRyZXNzX3dhdGNoX2Rp
c2FibGUsCisJLmFkZHJlc3Nfd2F0Y2hfZXhlY3V0ZSA9IGtnZF9hZGRyZXNzX3dhdGNoX2V4ZWN1
dGUsCisJLndhdmVfY29udHJvbF9leGVjdXRlID0ga2dkX3dhdmVfY29udHJvbF9leGVjdXRlLAor
CS5hZGRyZXNzX3dhdGNoX2dldF9vZmZzZXQgPSBrZ2RfYWRkcmVzc193YXRjaF9nZXRfb2Zmc2V0
LAorCS5nZXRfYXRjX3ZtaWRfcGFzaWRfbWFwcGluZ19wYXNpZCA9CisJCQlnZXRfYXRjX3ZtaWRf
cGFzaWRfbWFwcGluZ19wYXNpZCwKKwkuZ2V0X2F0Y192bWlkX3Bhc2lkX21hcHBpbmdfdmFsaWQg
PQorCQkJZ2V0X2F0Y192bWlkX3Bhc2lkX21hcHBpbmdfdmFsaWQsCisJLmludmFsaWRhdGVfdGxi
cyA9IGludmFsaWRhdGVfdGxicywKKwkuaW52YWxpZGF0ZV90bGJzX3ZtaWQgPSBpbnZhbGlkYXRl
X3RsYnNfdm1pZCwKKwkuc2V0X3ZtX2NvbnRleHRfcGFnZV90YWJsZV9iYXNlID0gc2V0X3ZtX2Nv
bnRleHRfcGFnZV90YWJsZV9iYXNlLAorCS5nZXRfdGlsZV9jb25maWcgPSBhbWRncHVfYW1ka2Zk
X2dldF90aWxlX2NvbmZpZywKK307CisKK3N0cnVjdCBrZmQya2dkX2NhbGxzICphbWRncHVfYW1k
a2ZkX2dmeF8xMF8wX2dldF9mdW5jdGlvbnMoKQoreworCXJldHVybiAoc3RydWN0IGtmZDJrZ2Rf
Y2FsbHMgKikma2ZkMmtnZDsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqZ2V0X2FtZGdwdV9kZXZpY2Uoc3RydWN0IGtnZF9kZXYgKmtnZCkKK3sKKwlyZXR1cm4gKHN0
cnVjdCBhbWRncHVfZGV2aWNlICopa2dkOworfQorCitzdGF0aWMgdm9pZCBsb2NrX3NyYm0oc3Ry
dWN0IGtnZF9kZXYgKmtnZCwgdWludDMyX3QgbWVjLCB1aW50MzJfdCBwaXBlLAorCQkJdWludDMy
X3QgcXVldWUsIHVpbnQzMl90IHZtaWQpCit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYg
PSBnZXRfYW1kZ3B1X2RldmljZShrZ2QpOworCisJbXV0ZXhfbG9jaygmYWRldi0+c3JibV9tdXRl
eCk7CisJbnZfZ3JibV9zZWxlY3QoYWRldiwgbWVjLCBwaXBlLCBxdWV1ZSwgdm1pZCk7Cit9CisK
K3N0YXRpYyB2b2lkIHVubG9ja19zcmJtKHN0cnVjdCBrZ2RfZGV2ICprZ2QpCit7CisJc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBnZXRfYW1kZ3B1X2RldmljZShrZ2QpOworCisJbnZfZ3Ji
bV9zZWxlY3QoYWRldiwgMCwgMCwgMCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZhZGV2LT5zcmJtX211
dGV4KTsKK30KKworc3RhdGljIHZvaWQgYWNxdWlyZV9xdWV1ZShzdHJ1Y3Qga2dkX2RldiAqa2dk
LCB1aW50MzJfdCBwaXBlX2lkLAorCQkJCXVpbnQzMl90IHF1ZXVlX2lkKQoreworCXN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2ID0gZ2V0X2FtZGdwdV9kZXZpY2Uoa2dkKTsKKworCXVpbnQzMl90
IG1lYyA9IChwaXBlX2lkIC8gYWRldi0+Z2Z4Lm1lYy5udW1fcGlwZV9wZXJfbWVjKSArIDE7CisJ
dWludDMyX3QgcGlwZSA9IChwaXBlX2lkICUgYWRldi0+Z2Z4Lm1lYy5udW1fcGlwZV9wZXJfbWVj
KTsKKworCWxvY2tfc3JibShrZ2QsIG1lYywgcGlwZSwgcXVldWVfaWQsIDApOworfQorCitzdGF0
aWMgdWludDMyX3QgZ2V0X3F1ZXVlX21hc2soc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJ
CQkgICAgICAgdWludDMyX3QgcGlwZV9pZCwgdWludDMyX3QgcXVldWVfaWQpCit7CisJdW5zaWdu
ZWQgaW50IGJpdCA9IChwaXBlX2lkICogYWRldi0+Z2Z4Lm1lYy5udW1fcXVldWVfcGVyX3BpcGUg
KworCQkJICAgIHF1ZXVlX2lkKSAmIDMxOworCisJcmV0dXJuICgodWludDMyX3QpMSkgPDwgYml0
OworfQorCitzdGF0aWMgdm9pZCByZWxlYXNlX3F1ZXVlKHN0cnVjdCBrZ2RfZGV2ICprZ2QpCit7
CisJdW5sb2NrX3NyYm0oa2dkKTsKK30KKworc3RhdGljIHZvaWQga2dkX3Byb2dyYW1fc2hfbWVt
X3NldHRpbmdzKHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHVpbnQzMl90IHZtaWQsCisJCQkJCXVpbnQz
Ml90IHNoX21lbV9jb25maWcsCisJCQkJCXVpbnQzMl90IHNoX21lbV9hcGUxX2Jhc2UsCisJCQkJ
CXVpbnQzMl90IHNoX21lbV9hcGUxX2xpbWl0LAorCQkJCQl1aW50MzJfdCBzaF9tZW1fYmFzZXMp
Cit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBnZXRfYW1kZ3B1X2RldmljZShrZ2Qp
OworCisJbG9ja19zcmJtKGtnZCwgMCwgMCwgMCwgdm1pZCk7CisKKwlXUkVHMzIoU09DMTVfUkVH
X09GRlNFVChHQywgMCwgbW1TSF9NRU1fQ09ORklHKSwgc2hfbWVtX2NvbmZpZyk7CisJV1JFRzMy
KFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tU0hfTUVNX0JBU0VTKSwgc2hfbWVtX2Jhc2VzKTsK
KwkvKiBBUEUxIG5vIGxvbmdlciBleGlzdHMgb24gR0ZYOSAqLworCisJdW5sb2NrX3NyYm0oa2dk
KTsKK30KKworc3RhdGljIGludCBrZ2Rfc2V0X3Bhc2lkX3ZtaWRfbWFwcGluZyhzdHJ1Y3Qga2dk
X2RldiAqa2dkLCB1bnNpZ25lZCBpbnQgcGFzaWQsCisJCQkJCXVuc2lnbmVkIGludCB2bWlkKQor
eworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gZ2V0X2FtZGdwdV9kZXZpY2Uoa2dkKTsK
KworCS8qCisJICogV2UgaGF2ZSB0byBhc3N1bWUgdGhhdCB0aGVyZSBpcyBubyBvdXRzdGFuZGlu
ZyBtYXBwaW5nLgorCSAqIFRoZSBBVENfVk1JRF9QQVNJRF9NQVBQSU5HX1VQREFURV9TVEFUVVMg
Yml0IGNvdWxkIGJlIDAgYmVjYXVzZQorCSAqIGEgbWFwcGluZyBpcyBpbiBwcm9ncmVzcyBvciBi
ZWNhdXNlIGEgbWFwcGluZyBmaW5pc2hlZAorCSAqIGFuZCB0aGUgU1cgY2xlYXJlZCBpdC4KKwkg
KiBTbyB0aGUgcHJvdG9jb2wgaXMgdG8gYWx3YXlzIHdhaXQgJiBjbGVhci4KKwkgKi8KKwl1aW50
MzJfdCBwYXNpZF9tYXBwaW5nID0gKHBhc2lkID09IDApID8gMCA6ICh1aW50MzJfdClwYXNpZCB8
CisJCQlBVENfVk1JRDBfUEFTSURfTUFQUElOR19fVkFMSURfTUFTSzsKKworCXByX2RlYnVnKCJw
YXNpZCAweCV4IHZtaWQgJWQsIHJlZyB2YWx1ZSAleFxuIiwgcGFzaWQsIHZtaWQsIHBhc2lkX21h
cHBpbmcpOworCS8qCisJICogbmVlZCB0byBkbyB0aGlzIHR3aWNlLCBvbmNlIGZvciBnZnggYW5k
IG9uY2UgZm9yIG1taHViCisJICogZm9yIEFUQyBhZGQgMTYgdG8gVk1JRCBmb3IgbW1odWIsIGZv
ciBJSCBkaWZmZXJlbnQgcmVnaXN0ZXJzLgorCSAqIEFUQ19WTUlEMC4uMTUgcmVnaXN0ZXJzIGFy
ZSBzZXBhcmF0ZSBmcm9tIEFUQ19WTUlEMTYuLjMxLgorCSAqLworCisJcHJfZGVidWcoIkFUSFVC
LCByZWcgJXhcbiIsU09DMTVfUkVHX09GRlNFVChBVEhVQiwgMCwgbW1BVENfVk1JRDBfUEFTSURf
TUFQUElORykgKyB2bWlkKTsKKwlXUkVHMzIoU09DMTVfUkVHX09GRlNFVChBVEhVQiwgMCwgbW1B
VENfVk1JRDBfUEFTSURfTUFQUElORykgKyB2bWlkLAorCSAgICAgICBwYXNpZF9tYXBwaW5nKTsK
KworI2lmIDAKKwkvKiBUT0RPOiB1bmNvbW1lbnQgdGhpcyBjb2RlIHdoZW4gdGhlIGhhcmR3YXJl
IHN1cHBvcnQgaXMgcmVhZHkuICovCisJd2hpbGUgKCEoUlJFRzMyKFNPQzE1X1JFR19PRkZTRVQo
CisJCQkJQVRIVUIsIDAsCisJCQkJbW1BVENfVk1JRF9QQVNJRF9NQVBQSU5HX1VQREFURV9TVEFU
VVMpKSAmCisJCSAoMVUgPDwgdm1pZCkpKQorCQljcHVfcmVsYXgoKTsKKworCXByX2RlYnVnKCJB
VEhVQiBtYXBwaW5nIHVwZGF0ZSBmaW5pc2hlZFxuIik7CisJV1JFRzMyKFNPQzE1X1JFR19PRkZT
RVQoQVRIVUIsIDAsCisJCQkJbW1BVENfVk1JRF9QQVNJRF9NQVBQSU5HX1VQREFURV9TVEFUVVMp
LAorCSAgICAgICAxVSA8PCB2bWlkKTsKKyNlbmRpZgorCisJLyogTWFwcGluZyB2bWlkIHRvIHBh
c2lkIGFsc28gZm9yIElIIGJsb2NrICovCisJcHJfZGVidWcoInVwZGF0ZSBtYXBwaW5nIGZvciBJ
SCBibG9jayBhbmQgbW1odWIiKTsKKwlXUkVHMzIoU09DMTVfUkVHX09GRlNFVChPU1NTWVMsIDAs
IG1tSUhfVk1JRF8wX0xVVCkgKyB2bWlkLAorCSAgICAgICBwYXNpZF9tYXBwaW5nKTsKKworCXJl
dHVybiAwOworfQorCisvKiBUT0RPIC0gUklORzAgZm9ybSBvZiBmaWVsZCBpcyBvYnNvbGV0ZSwg
c2VlbXMgdG8gZGF0ZSBiYWNrIHRvIFNJCisgKiBidXQgc3RpbGwgd29ya3MKKyAqLworCitzdGF0
aWMgaW50IGtnZF9pbml0X2ludGVycnVwdHMoc3RydWN0IGtnZF9kZXYgKmtnZCwgdWludDMyX3Qg
cGlwZV9pZCkKK3sKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGdldF9hbWRncHVfZGV2
aWNlKGtnZCk7CisJdWludDMyX3QgbWVjOworCXVpbnQzMl90IHBpcGU7CisKKwltZWMgPSAocGlw
ZV9pZCAvIGFkZXYtPmdmeC5tZWMubnVtX3BpcGVfcGVyX21lYykgKyAxOworCXBpcGUgPSAocGlw
ZV9pZCAlIGFkZXYtPmdmeC5tZWMubnVtX3BpcGVfcGVyX21lYyk7CisKKwlsb2NrX3NyYm0oa2dk
LCBtZWMsIHBpcGUsIDAsIDApOworCisJV1JFRzMyKFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1t
Q1BDX0lOVF9DTlRMKSwKKwkJQ1BfSU5UX0NOVExfUklORzBfX1RJTUVfU1RBTVBfSU5UX0VOQUJM
RV9NQVNLIHwKKwkJQ1BfSU5UX0NOVExfUklORzBfX09QQ09ERV9FUlJPUl9JTlRfRU5BQkxFX01B
U0spOworCisJdW5sb2NrX3NyYm0oa2dkKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdWlu
dDMyX3QgZ2V0X3NkbWFfYmFzZV9hZGRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJ
CXVuc2lnbmVkIGludCBlbmdpbmVfaWQsCisJCQkJdW5zaWduZWQgaW50IHF1ZXVlX2lkKQorewor
CXVpbnQzMl90IGJhc2VbMl0gPSB7CisJCVNPQzE1X1JFR19PRkZTRVQoU0RNQTAsIDAsCisJCQkJ
IG1tU0RNQTBfUkxDMF9SQl9DTlRMKSAtIG1tU0RNQTBfUkxDMF9SQl9DTlRMLAorCQkvKiBPbiBn
ZngxMCwgbW1TRE1BMV94eHggcmVnaXN0ZXJzIGFyZSBkZWZpbmVkIE5PVCBiYXNlZAorCQkgKiBv
biBTRE1BMSBiYXNlIGFkZHJlc3MgKGR3IDB4MTg2MCkgYnV0IGJhc2VkIG9uIFNETUEwCisJCSAq
IGJhc2UgYWRkcmVzcyAoZHcgMHgxMjYwKS4gVGhlcmVmb3JlIHVzZSBtbVNETUEwX1JMQzBfUkJf
Q05UTAorCQkgKiBpbnN0ZWFkIG9mIG1tU0RNQTFfUkxDMF9SQl9DTlRMIGZvciB0aGUgYmFzZSBh
ZGRyZXNzIGNhbGMKKwkJICogYmVsb3cKKwkJICovCisJCVNPQzE1X1JFR19PRkZTRVQoU0RNQTEs
IDAsCisJCQkJIG1tU0RNQTFfUkxDMF9SQl9DTlRMKSAtIG1tU0RNQTBfUkxDMF9SQl9DTlRMCisJ
fTsKKwl1aW50MzJfdCByZXR2YWw7CisKKwlyZXR2YWwgPSBiYXNlW2VuZ2luZV9pZF0gKyBxdWV1
ZV9pZCAqIChtbVNETUEwX1JMQzFfUkJfQ05UTCAtCisJCQkJCSAgICAgICBtbVNETUEwX1JMQzBf
UkJfQ05UTCk7CisKKwlwcl9kZWJ1Zygic2RtYSBiYXNlIGFkZHJlc3M6IDB4JXhcbiIsIHJldHZh
bCk7CisKKwlyZXR1cm4gcmV0dmFsOworfQorCisjaWYgMAorc3RhdGljIHVpbnQzMl90IGdldF93
YXRjaF9iYXNlX2FkZHIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCit7CisJdWludDMyX3Qg
cmV0dmFsID0gU09DMTVfUkVHX09GRlNFVChHQywgMCwgbW1UQ1BfV0FUQ0gwX0FERFJfSCkgLQor
CQkJbW1UQ1BfV0FUQ0gwX0FERFJfSDsKKworCXByX2RlYnVnKCJrZmQ6IHJlZyB3YXRjaCBiYXNl
IGFkZHJlc3M6IDB4JXhcbiIsIHJldHZhbCk7CisKKwlyZXR1cm4gcmV0dmFsOworfQorI2VuZGlm
CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IHYxMF9jb21wdXRlX21xZCAqZ2V0X21xZCh2b2lkICpt
cWQpCit7CisJcmV0dXJuIChzdHJ1Y3QgdjEwX2NvbXB1dGVfbXFkICopbXFkOworfQorCitzdGF0
aWMgaW5saW5lIHN0cnVjdCB2MTBfc2RtYV9tcWQgKmdldF9zZG1hX21xZCh2b2lkICptcWQpCit7
CisJcmV0dXJuIChzdHJ1Y3QgdjEwX3NkbWFfbXFkICopbXFkOworfQorCitzdGF0aWMgaW50IGtn
ZF9ocWRfbG9hZChzdHJ1Y3Qga2dkX2RldiAqa2dkLCB2b2lkICptcWQsIHVpbnQzMl90IHBpcGVf
aWQsCisJCQl1aW50MzJfdCBxdWV1ZV9pZCwgdWludDMyX3QgX191c2VyICp3cHRyLAorCQkJdWlu
dDMyX3Qgd3B0cl9zaGlmdCwgdWludDMyX3Qgd3B0cl9tYXNrLAorCQkJc3RydWN0IG1tX3N0cnVj
dCAqbW0pCit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBnZXRfYW1kZ3B1X2Rldmlj
ZShrZ2QpOworCXN0cnVjdCB2MTBfY29tcHV0ZV9tcWQgKm07CisJdWludDMyX3QgKm1xZF9ocWQ7
CisJdWludDMyX3QgcmVnLCBocWRfYmFzZSwgZGF0YTsKKworCW0gPSBnZXRfbXFkKG1xZCk7CisK
Kwlwcl9kZWJ1ZygiTG9hZCBocWQgb2YgcGlwZSAlZCBxdWV1ZSAlZFxuIiwgcGlwZV9pZCwgcXVl
dWVfaWQpOworCWFjcXVpcmVfcXVldWUoa2dkLCBwaXBlX2lkLCBxdWV1ZV9pZCk7CisKKwkvKiBI
SVEgaXMgc2V0IGR1cmluZyBkcml2ZXIgaW5pdCBwZXJpb2Qgd2l0aCB2bWlkIHNldCB0byAwKi8K
KwlpZiAobS0+Y3BfaHFkX3ZtaWQgPT0gMCkgeworCQl1aW50MzJfdCB2YWx1ZSwgbWVjLCBwaXBl
OworCisJCW1lYyA9IChwaXBlX2lkIC8gYWRldi0+Z2Z4Lm1lYy5udW1fcGlwZV9wZXJfbWVjKSAr
IDE7CisJCXBpcGUgPSAocGlwZV9pZCAlIGFkZXYtPmdmeC5tZWMubnVtX3BpcGVfcGVyX21lYyk7
CisKKwkJcHJfZGVidWcoImtmZDogc2V0IEhJUSwgbWVjOiVkLCBwaXBlOiVkLCBxdWV1ZTolZC5c
biIsCisJCQltZWMsIHBpcGUsIHF1ZXVlX2lkKTsKKwkJdmFsdWUgPSBSUkVHMzIoU09DMTVfUkVH
X09GRlNFVChHQywgMCwgbW1STENfQ1BfU0NIRURVTEVSUykpOworCQl2YWx1ZSA9IFJFR19TRVRf
RklFTEQodmFsdWUsIFJMQ19DUF9TQ0hFRFVMRVJTLCBzY2hlZHVsZXIxLAorCQkJKChtZWMgPDwg
NSkgfCAocGlwZSA8PCAzKSB8IHF1ZXVlX2lkIHwgMHg4MCkpOworCQlXUkVHMzIoU09DMTVfUkVH
X09GRlNFVChHQywgMCwgbW1STENfQ1BfU0NIRURVTEVSUyksIHZhbHVlKTsKKwl9CisKKwkvKiBI
UUQgcmVnaXN0ZXJzIGV4dGVuZCBmcm9tIENQX01RRF9CQVNFX0FERFIgdG8gQ1BfSFFEX0VPUF9X
UFRSX01FTS4gKi8KKwltcWRfaHFkID0gJm0tPmNwX21xZF9iYXNlX2FkZHJfbG87CisJaHFkX2Jh
c2UgPSBTT0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUNQX01RRF9CQVNFX0FERFIpOworCisJZm9y
IChyZWcgPSBocWRfYmFzZTsKKwkgICAgIHJlZyA8PSBTT0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBt
bUNQX0hRRF9QUV9XUFRSX0hJKTsgcmVnKyspCisJCVdSRUczMihyZWcsIG1xZF9ocWRbcmVnIC0g
aHFkX2Jhc2VdKTsKKworCisJLyogQWN0aXZhdGUgZG9vcmJlbGwgbG9naWMgYmVmb3JlIHRyaWdn
ZXJpbmcgV1BUUiBwb2xsLiAqLworCWRhdGEgPSBSRUdfU0VUX0ZJRUxEKG0tPmNwX2hxZF9wcV9k
b29yYmVsbF9jb250cm9sLAorCQkJICAgICBDUF9IUURfUFFfRE9PUkJFTExfQ09OVFJPTCwgRE9P
UkJFTExfRU4sIDEpOworCVdSRUczMihTT0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUNQX0hRRF9Q
UV9ET09SQkVMTF9DT05UUk9MKSwgZGF0YSk7CisKKwlpZiAod3B0cikgeworCQkvKiBEb24ndCBy
ZWFkIHdwdHIgd2l0aCBnZXRfdXNlciBiZWNhdXNlIHRoZSB1c2VyCisJCSAqIGNvbnRleHQgbWF5
IG5vdCBiZSBhY2Nlc3NpYmxlIChpZiB0aGlzIGZ1bmN0aW9uCisJCSAqIHJ1bnMgaW4gYSB3b3Jr
IHF1ZXVlKS4gSW5zdGVhZCB0cmlnZ2VyIGEgb25lLXNob3QKKwkJICogcG9sbGluZyByZWFkIGZy
b20gbWVtb3J5IGluIHRoZSBDUC4gVGhpcyBhc3N1bWVzCisJCSAqIHRoYXQgd3B0ciBpcyBHUFUt
YWNjZXNzaWJsZSBpbiB0aGUgcXVldWUncyBWTUlEIHZpYQorCQkgKiBBVEMgb3IgU1ZNLiBXUFRS
PT1SUFRSIGJlZm9yZSBzdGFydGluZyB0aGUgcG9sbCBzbworCQkgKiB0aGUgQ1Agc3RhcnRzIGZl
dGNoaW5nIG5ldyBjb21tYW5kcyBmcm9tIHRoZSByaWdodAorCQkgKiBwbGFjZS4KKwkJICoKKwkJ
ICogR3Vlc3NpbmcgYSA2NC1iaXQgV1BUUiBmcm9tIGEgMzItYml0IFJQVFIgaXMgYSBiaXQKKwkJ
ICogdHJpY2t5LiBBc3N1bWUgdGhhdCB0aGUgcXVldWUgZGlkbid0IG92ZXJmbG93LiBUaGUKKwkJ
ICogbnVtYmVyIG9mIHZhbGlkIGJpdHMgaW4gdGhlIDMyLWJpdCBSUFRSIGRlcGVuZHMgb24KKwkJ
ICogdGhlIHF1ZXVlIHNpemUuIFRoZSByZW1haW5pbmcgYml0cyBhcmUgdGFrZW4gZnJvbQorCQkg
KiB0aGUgc2F2ZWQgNjQtYml0IFdQVFIuIElmIHRoZSBXUFRSIHdyYXBwZWQsIGFkZCB0aGUKKwkJ
ICogcXVldWUgc2l6ZS4KKwkJICovCisJCXVpbnQzMl90IHF1ZXVlX3NpemUgPQorCQkJMiA8PCBS
RUdfR0VUX0ZJRUxEKG0tPmNwX2hxZF9wcV9jb250cm9sLAorCQkJCQkgICBDUF9IUURfUFFfQ09O
VFJPTCwgUVVFVUVfU0laRSk7CisJCXVpbnQ2NF90IGd1ZXNzZWRfd3B0ciA9IG0tPmNwX2hxZF9w
cV9ycHRyICYgKHF1ZXVlX3NpemUgLSAxKTsKKworCQlpZiAoKG0tPmNwX2hxZF9wcV93cHRyX2xv
ICYgKHF1ZXVlX3NpemUgLSAxKSkgPCBndWVzc2VkX3dwdHIpCisJCQlndWVzc2VkX3dwdHIgKz0g
cXVldWVfc2l6ZTsKKwkJZ3Vlc3NlZF93cHRyICs9IG0tPmNwX2hxZF9wcV93cHRyX2xvICYgfihx
dWV1ZV9zaXplIC0gMSk7CisJCWd1ZXNzZWRfd3B0ciArPSAodWludDY0X3QpbS0+Y3BfaHFkX3Bx
X3dwdHJfaGkgPDwgMzI7CisKKwkJV1JFRzMyKFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tQ1Bf
SFFEX1BRX1dQVFJfTE8pLAorCQkgICAgICAgbG93ZXJfMzJfYml0cyhndWVzc2VkX3dwdHIpKTsK
KwkJV1JFRzMyKFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tQ1BfSFFEX1BRX1dQVFJfSEkpLAor
CQkgICAgICAgdXBwZXJfMzJfYml0cyhndWVzc2VkX3dwdHIpKTsKKwkJV1JFRzMyKFNPQzE1X1JF
R19PRkZTRVQoR0MsIDAsIG1tQ1BfSFFEX1BRX1dQVFJfUE9MTF9BRERSKSwKKwkJICAgICAgIGxv
d2VyXzMyX2JpdHMoKHVpbnQ2NF90KXdwdHIpKTsKKwkJV1JFRzMyKFNPQzE1X1JFR19PRkZTRVQo
R0MsIDAsIG1tQ1BfSFFEX1BRX1dQVFJfUE9MTF9BRERSX0hJKSwKKwkJICAgICAgIHVwcGVyXzMy
X2JpdHMoKHVpbnQ2NF90KXdwdHIpKTsKKwkJcHJfZGVidWcoIiVzIHNldHRpbmcgQ1BfUFFfV1BU
Ul9QT0xMX0NOVEwxIHRvICV4XG4iLCBfX2Z1bmNfXywgZ2V0X3F1ZXVlX21hc2soYWRldiwgcGlw
ZV9pZCwgcXVldWVfaWQpKTsKKwkJV1JFRzMyKFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tQ1Bf
UFFfV1BUUl9QT0xMX0NOVEwxKSwKKwkJICAgICAgIGdldF9xdWV1ZV9tYXNrKGFkZXYsIHBpcGVf
aWQsIHF1ZXVlX2lkKSk7CisJfQorCisJLyogU3RhcnQgdGhlIEVPUCBmZXRjaGVyICovCisJV1JF
RzMyKFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tQ1BfSFFEX0VPUF9SUFRSKSwKKwkgICAgICAg
UkVHX1NFVF9GSUVMRChtLT5jcF9ocWRfZW9wX3JwdHIsCisJCQkgICAgIENQX0hRRF9FT1BfUlBU
UiwgSU5JVF9GRVRDSEVSLCAxKSk7CisKKwlkYXRhID0gUkVHX1NFVF9GSUVMRChtLT5jcF9ocWRf
YWN0aXZlLCBDUF9IUURfQUNUSVZFLCBBQ1RJVkUsIDEpOworCVdSRUczMihTT0MxNV9SRUdfT0ZG
U0VUKEdDLCAwLCBtbUNQX0hRRF9BQ1RJVkUpLCBkYXRhKTsKKworCXJlbGVhc2VfcXVldWUoa2dk
KTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGtnZF9ocWRfZHVtcChzdHJ1Y3Qga2dk
X2RldiAqa2dkLAorCQkJdWludDMyX3QgcGlwZV9pZCwgdWludDMyX3QgcXVldWVfaWQsCisJCQl1
aW50MzJfdCAoKipkdW1wKVsyXSwgdWludDMyX3QgKm5fcmVncykKK3sKKwlzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiA9IGdldF9hbWRncHVfZGV2aWNlKGtnZCk7CisJdWludDMyX3QgaSA9IDAs
IHJlZzsKKyNkZWZpbmUgSFFEX05fUkVHUyA1NgorI2RlZmluZSBEVU1QX1JFRyhhZGRyKSBkbyB7
CQkJCVwKKwkJaWYgKFdBUk5fT05fT05DRShpID49IEhRRF9OX1JFR1MpKQlcCisJCQlicmVhazsJ
CQkJXAorCQkoKmR1bXApW2ldWzBdID0gKGFkZHIpIDw8IDI7CQlcCisJCSgqZHVtcClbaSsrXVsx
XSA9IFJSRUczMihhZGRyKTsJCVwKKwl9IHdoaWxlICgwKQorCisJKmR1bXAgPSBrbWFsbG9jKEhR
RF9OX1JFR1MqMipzaXplb2YodWludDMyX3QpLCBHRlBfS0VSTkVMKTsKKwlpZiAoKmR1bXAgPT0g
TlVMTCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlhY3F1aXJlX3F1ZXVlKGtnZCwgcGlwZV9pZCwg
cXVldWVfaWQpOworCisJZm9yIChyZWcgPSBTT0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUNQX01R
RF9CQVNFX0FERFIpOworCSAgICAgcmVnIDw9IFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tQ1Bf
SFFEX1BRX1dQVFJfSEkpOyByZWcrKykKKwkJRFVNUF9SRUcocmVnKTsKKworCXJlbGVhc2VfcXVl
dWUoa2dkKTsKKworCVdBUk5fT05fT05DRShpICE9IEhRRF9OX1JFR1MpOworCSpuX3JlZ3MgPSBp
OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQga2dkX2hxZF9zZG1hX2xvYWQoc3RydWN0
IGtnZF9kZXYgKmtnZCwgdm9pZCAqbXFkLAorCQkJICAgICB1aW50MzJfdCBfX3VzZXIgKndwdHIs
IHN0cnVjdCBtbV9zdHJ1Y3QgKm1tKQoreworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0g
Z2V0X2FtZGdwdV9kZXZpY2Uoa2dkKTsKKwlzdHJ1Y3QgdjEwX3NkbWFfbXFkICptOworCXVpbnQz
Ml90IHNkbWFfYmFzZV9hZGRyLCBzZG1heF9nZnhfY29udGV4dF9jbnRsOworCXVuc2lnbmVkIGxv
bmcgZW5kX2ppZmZpZXM7CisJdWludDMyX3QgZGF0YTsKKwl1aW50NjRfdCBkYXRhNjQ7CisJdWlu
dDY0X3QgX191c2VyICp3cHRyNjQgPSAodWludDY0X3QgX191c2VyICopd3B0cjsKKworCW0gPSBn
ZXRfc2RtYV9tcWQobXFkKTsKKwlzZG1hX2Jhc2VfYWRkciA9IGdldF9zZG1hX2Jhc2VfYWRkcihh
ZGV2LCBtLT5zZG1hX2VuZ2luZV9pZCwKKwkJCQkJICAgIG0tPnNkbWFfcXVldWVfaWQpOworCXBy
X2RlYnVnKCJzZG1hIGxvYWQgYmFzZSBhZGRyICV4IGZvciBlbmdpbmUgJWQsIHF1ZXVlICVkXG4i
LCBzZG1hX2Jhc2VfYWRkciwgbS0+c2RtYV9lbmdpbmVfaWQsIG0tPnNkbWFfcXVldWVfaWQpOwor
CXNkbWF4X2dmeF9jb250ZXh0X2NudGwgPSBtLT5zZG1hX2VuZ2luZV9pZCA/CisJCVNPQzE1X1JF
R19PRkZTRVQoU0RNQTEsIDAsIG1tU0RNQTFfR0ZYX0NPTlRFWFRfQ05UTCkgOgorCQlTT0MxNV9S
RUdfT0ZGU0VUKFNETUEwLCAwLCBtbVNETUEwX0dGWF9DT05URVhUX0NOVEwpOworCisJV1JFRzMy
KHNkbWFfYmFzZV9hZGRyICsgbW1TRE1BMF9STEMwX1JCX0NOVEwsCisJCW0tPnNkbWF4X3JsY3hf
cmJfY250bCAmICh+U0RNQTBfUkxDMF9SQl9DTlRMX19SQl9FTkFCTEVfTUFTSykpOworCisJZW5k
X2ppZmZpZXMgPSBtc2Vjc190b19qaWZmaWVzKDIwMDApICsgamlmZmllczsKKwl3aGlsZSAodHJ1
ZSkgeworCQlkYXRhID0gUlJFRzMyKHNkbWFfYmFzZV9hZGRyICsgbW1TRE1BMF9STEMwX0NPTlRF
WFRfU1RBVFVTKTsKKwkJaWYgKGRhdGEgJiBTRE1BMF9STEMwX0NPTlRFWFRfU1RBVFVTX19JRExF
X01BU0spCisJCQlicmVhazsKKwkJaWYgKHRpbWVfYWZ0ZXIoamlmZmllcywgZW5kX2ppZmZpZXMp
KQorCQkJcmV0dXJuIC1FVElNRTsKKwkJdXNsZWVwX3JhbmdlKDUwMCwgMTAwMCk7CisJfQorCWRh
dGEgPSBSUkVHMzIoc2RtYXhfZ2Z4X2NvbnRleHRfY250bCk7CisJZGF0YSA9IFJFR19TRVRfRklF
TEQoZGF0YSwgU0RNQTBfR0ZYX0NPTlRFWFRfQ05UTCwKKwkJCSAgICAgUkVTVU1FX0NUWCwgMCk7
CisJV1JFRzMyKHNkbWF4X2dmeF9jb250ZXh0X2NudGwsIGRhdGEpOworCisJV1JFRzMyKHNkbWFf
YmFzZV9hZGRyICsgbW1TRE1BMF9STEMwX0RPT1JCRUxMX09GRlNFVCwKKwkgICAgICAgbS0+c2Rt
YXhfcmxjeF9kb29yYmVsbF9vZmZzZXQpOworCisJZGF0YSA9IFJFR19TRVRfRklFTEQobS0+c2Rt
YXhfcmxjeF9kb29yYmVsbCwgU0RNQTBfUkxDMF9ET09SQkVMTCwKKwkJCSAgICAgRU5BQkxFLCAx
KTsKKwlXUkVHMzIoc2RtYV9iYXNlX2FkZHIgKyBtbVNETUEwX1JMQzBfRE9PUkJFTEwsIGRhdGEp
OworCVdSRUczMihzZG1hX2Jhc2VfYWRkciArIG1tU0RNQTBfUkxDMF9SQl9SUFRSLCBtLT5zZG1h
eF9ybGN4X3JiX3JwdHIpOworCVdSRUczMihzZG1hX2Jhc2VfYWRkciArIG1tU0RNQTBfUkxDMF9S
Ql9SUFRSX0hJLAorCQkJCW0tPnNkbWF4X3JsY3hfcmJfcnB0cl9oaSk7CisKKwlXUkVHMzIoc2Rt
YV9iYXNlX2FkZHIgKyBtbVNETUEwX1JMQzBfTUlOT1JfUFRSX1VQREFURSwgMSk7CisJaWYgKHJl
YWRfdXNlcl93cHRyKG1tLCB3cHRyNjQsIGRhdGE2NCkpIHsKKwkJV1JFRzMyKHNkbWFfYmFzZV9h
ZGRyICsgbW1TRE1BMF9STEMwX1JCX1dQVFIsCisJCSAgICAgICBsb3dlcl8zMl9iaXRzKGRhdGE2
NCkpOworCQlXUkVHMzIoc2RtYV9iYXNlX2FkZHIgKyBtbVNETUEwX1JMQzBfUkJfV1BUUl9ISSwK
KwkJICAgICAgIHVwcGVyXzMyX2JpdHMoZGF0YTY0KSk7CisJfSBlbHNlIHsKKwkJV1JFRzMyKHNk
bWFfYmFzZV9hZGRyICsgbW1TRE1BMF9STEMwX1JCX1dQVFIsCisJCSAgICAgICBtLT5zZG1heF9y
bGN4X3JiX3JwdHIpOworCQlXUkVHMzIoc2RtYV9iYXNlX2FkZHIgKyBtbVNETUEwX1JMQzBfUkJf
V1BUUl9ISSwKKwkJICAgICAgIG0tPnNkbWF4X3JsY3hfcmJfcnB0cl9oaSk7CisJfQorCVdSRUcz
MihzZG1hX2Jhc2VfYWRkciArIG1tU0RNQTBfUkxDMF9NSU5PUl9QVFJfVVBEQVRFLCAwKTsKKwor
CVdSRUczMihzZG1hX2Jhc2VfYWRkciArIG1tU0RNQTBfUkxDMF9SQl9CQVNFLCBtLT5zZG1heF9y
bGN4X3JiX2Jhc2UpOworCVdSRUczMihzZG1hX2Jhc2VfYWRkciArIG1tU0RNQTBfUkxDMF9SQl9C
QVNFX0hJLAorCQkJbS0+c2RtYXhfcmxjeF9yYl9iYXNlX2hpKTsKKwlXUkVHMzIoc2RtYV9iYXNl
X2FkZHIgKyBtbVNETUEwX1JMQzBfUkJfUlBUUl9BRERSX0xPLAorCQkJbS0+c2RtYXhfcmxjeF9y
Yl9ycHRyX2FkZHJfbG8pOworCVdSRUczMihzZG1hX2Jhc2VfYWRkciArIG1tU0RNQTBfUkxDMF9S
Ql9SUFRSX0FERFJfSEksCisJCQltLT5zZG1heF9ybGN4X3JiX3JwdHJfYWRkcl9oaSk7CisKKwlk
YXRhID0gUkVHX1NFVF9GSUVMRChtLT5zZG1heF9ybGN4X3JiX2NudGwsIFNETUEwX1JMQzBfUkJf
Q05UTCwKKwkJCSAgICAgUkJfRU5BQkxFLCAxKTsKKwlXUkVHMzIoc2RtYV9iYXNlX2FkZHIgKyBt
bVNETUEwX1JMQzBfUkJfQ05UTCwgZGF0YSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlu
dCBrZ2RfaHFkX3NkbWFfZHVtcChzdHJ1Y3Qga2dkX2RldiAqa2dkLAorCQkJICAgICB1aW50MzJf
dCBlbmdpbmVfaWQsIHVpbnQzMl90IHF1ZXVlX2lkLAorCQkJICAgICB1aW50MzJfdCAoKipkdW1w
KVsyXSwgdWludDMyX3QgKm5fcmVncykKK3sKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9
IGdldF9hbWRncHVfZGV2aWNlKGtnZCk7CisJdWludDMyX3Qgc2RtYV9iYXNlX2FkZHIgPSBnZXRf
c2RtYV9iYXNlX2FkZHIoYWRldiwgZW5naW5lX2lkLCBxdWV1ZV9pZCk7CisJdWludDMyX3QgaSA9
IDAsIHJlZzsKKyN1bmRlZiBIUURfTl9SRUdTCisjZGVmaW5lIEhRRF9OX1JFR1MgKDE5KzYrNysx
MCkKKworCXByX2RlYnVnKCJzZG1hIGR1bXAgZW5naW5lIGlkICVkIHF1ZXVlX2lkICVkXG4iLCBl
bmdpbmVfaWQsIHF1ZXVlX2lkKTsKKwlwcl9kZWJ1Zygic2RtYSBiYXNlIGFkZHIgJXhcbiIsIHNk
bWFfYmFzZV9hZGRyKTsKKworCSpkdW1wID0ga21hbGxvYyhIUURfTl9SRUdTKjIqc2l6ZW9mKHVp
bnQzMl90KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCpkdW1wID09IE5VTEwpCisJCXJldHVybiAtRU5P
TUVNOworCisJZm9yIChyZWcgPSBtbVNETUEwX1JMQzBfUkJfQ05UTDsgcmVnIDw9IG1tU0RNQTBf
UkxDMF9ET09SQkVMTDsgcmVnKyspCisJCURVTVBfUkVHKHNkbWFfYmFzZV9hZGRyICsgcmVnKTsK
Kwlmb3IgKHJlZyA9IG1tU0RNQTBfUkxDMF9TVEFUVVM7IHJlZyA8PSBtbVNETUEwX1JMQzBfQ1NB
X0FERFJfSEk7IHJlZysrKQorCQlEVU1QX1JFRyhzZG1hX2Jhc2VfYWRkciArIHJlZyk7CisJZm9y
IChyZWcgPSBtbVNETUEwX1JMQzBfSUJfU1VCX1JFTUFJTjsKKwkgICAgIHJlZyA8PSBtbVNETUEw
X1JMQzBfTUlOT1JfUFRSX1VQREFURTsgcmVnKyspCisJCURVTVBfUkVHKHNkbWFfYmFzZV9hZGRy
ICsgcmVnKTsKKwlmb3IgKHJlZyA9IG1tU0RNQTBfUkxDMF9NSURDTURfREFUQTA7CisJICAgICBy
ZWcgPD0gbW1TRE1BMF9STEMwX01JRENNRF9DTlRMOyByZWcrKykKKwkJRFVNUF9SRUcoc2RtYV9i
YXNlX2FkZHIgKyByZWcpOworCisJV0FSTl9PTl9PTkNFKGkgIT0gSFFEX05fUkVHUyk7CisJKm5f
cmVncyA9IGk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGJvb2wga2dkX2hxZF9pc19vY2N1
cGllZChzdHJ1Y3Qga2dkX2RldiAqa2dkLCB1aW50NjRfdCBxdWV1ZV9hZGRyZXNzLAorCQkJCXVp
bnQzMl90IHBpcGVfaWQsIHVpbnQzMl90IHF1ZXVlX2lkKQoreworCXN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2ID0gZ2V0X2FtZGdwdV9kZXZpY2Uoa2dkKTsKKwl1aW50MzJfdCBhY3Q7CisJYm9v
bCByZXR2YWwgPSBmYWxzZTsKKwl1aW50MzJfdCBsb3csIGhpZ2g7CisKKwlhY3F1aXJlX3F1ZXVl
KGtnZCwgcGlwZV9pZCwgcXVldWVfaWQpOworCWFjdCA9IFJSRUczMihTT0MxNV9SRUdfT0ZGU0VU
KEdDLCAwLCBtbUNQX0hRRF9BQ1RJVkUpKTsKKwlpZiAoYWN0KSB7CisJCWxvdyA9IGxvd2VyXzMy
X2JpdHMocXVldWVfYWRkcmVzcyA+PiA4KTsKKwkJaGlnaCA9IHVwcGVyXzMyX2JpdHMocXVldWVf
YWRkcmVzcyA+PiA4KTsKKworCQlpZiAobG93ID09IFJSRUczMihTT0MxNV9SRUdfT0ZGU0VUKEdD
LCAwLCBtbUNQX0hRRF9QUV9CQVNFKSkgJiYKKwkJICAgaGlnaCA9PSBSUkVHMzIoU09DMTVfUkVH
X09GRlNFVChHQywgMCwgbW1DUF9IUURfUFFfQkFTRV9ISSkpKQorCQkJcmV0dmFsID0gdHJ1ZTsK
Kwl9CisJcmVsZWFzZV9xdWV1ZShrZ2QpOworCXJldHVybiByZXR2YWw7Cit9CisKK3N0YXRpYyBi
b29sIGtnZF9ocWRfc2RtYV9pc19vY2N1cGllZChzdHJ1Y3Qga2dkX2RldiAqa2dkLCB2b2lkICpt
cWQpCit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBnZXRfYW1kZ3B1X2RldmljZShr
Z2QpOworCXN0cnVjdCB2MTBfc2RtYV9tcWQgKm07CisJdWludDMyX3Qgc2RtYV9iYXNlX2FkZHI7
CisJdWludDMyX3Qgc2RtYV9ybGNfcmJfY250bDsKKworCW0gPSBnZXRfc2RtYV9tcWQobXFkKTsK
KwlzZG1hX2Jhc2VfYWRkciA9IGdldF9zZG1hX2Jhc2VfYWRkcihhZGV2LCBtLT5zZG1hX2VuZ2lu
ZV9pZCwKKwkJCQkJICAgIG0tPnNkbWFfcXVldWVfaWQpOworCisJc2RtYV9ybGNfcmJfY250bCA9
IFJSRUczMihzZG1hX2Jhc2VfYWRkciArIG1tU0RNQTBfUkxDMF9SQl9DTlRMKTsKKworCWlmIChz
ZG1hX3JsY19yYl9jbnRsICYgU0RNQTBfUkxDMF9SQl9DTlRMX19SQl9FTkFCTEVfTUFTSykKKwkJ
cmV0dXJuIHRydWU7CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKK3N0YXRpYyBpbnQga2dkX2hxZF9k
ZXN0cm95KHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHZvaWQgKm1xZCwKKwkJCQllbnVtIGtmZF9wcmVl
bXB0X3R5cGUgcmVzZXRfdHlwZSwKKwkJCQl1bnNpZ25lZCBpbnQgdXRpbWVvdXQsIHVpbnQzMl90
IHBpcGVfaWQsCisJCQkJdWludDMyX3QgcXVldWVfaWQpCit7CisJc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYgPSBnZXRfYW1kZ3B1X2RldmljZShrZ2QpOworCWVudW0gaHFkX2RlcXVldWVfcmVx
dWVzdF90eXBlIHR5cGU7CisJdW5zaWduZWQgbG9uZyBlbmRfamlmZmllczsKKwl1aW50MzJfdCB0
ZW1wOworCXN0cnVjdCB2MTBfY29tcHV0ZV9tcWQgKm0gPSBnZXRfbXFkKG1xZCk7CisKKyNpZiAw
CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKwlpbnQgcmV0cnk7CisjZW5kaWYKKworCWFjcXVpcmVf
cXVldWUoa2dkLCBwaXBlX2lkLCBxdWV1ZV9pZCk7CisKKwlpZiAobS0+Y3BfaHFkX3ZtaWQgPT0g
MCkKKwkJV1JFRzMyX0ZJRUxEMTUoR0MsIDAsIFJMQ19DUF9TQ0hFRFVMRVJTLCBzY2hlZHVsZXIx
LCAwKTsKKworCXN3aXRjaCAocmVzZXRfdHlwZSkgeworCWNhc2UgS0ZEX1BSRUVNUFRfVFlQRV9X
QVZFRlJPTlRfRFJBSU46CisJCXR5cGUgPSBEUkFJTl9QSVBFOworCQlicmVhazsKKwljYXNlIEtG
RF9QUkVFTVBUX1RZUEVfV0FWRUZST05UX1JFU0VUOgorCQl0eXBlID0gUkVTRVRfV0FWRVM7CisJ
CWJyZWFrOworCWRlZmF1bHQ6CisJCXR5cGUgPSBEUkFJTl9QSVBFOworCQlicmVhazsKKwl9CisK
KyNpZiAwIC8qIElzIHRoaXMgc3RpbGwgbmVlZGVkPyAqLworCS8qIFdvcmthcm91bmQ6IElmIElR
IHRpbWVyIGlzIGFjdGl2ZSBhbmQgdGhlIHdhaXQgdGltZSBpcyBjbG9zZSB0byBvcgorCSAqIGVx
dWFsIHRvIDAsIGRlcXVldWVpbmcgaXMgbm90IHNhZmUuIFdhaXQgdW50aWwgZWl0aGVyIHRoZSB3
YWl0IHRpbWUKKwkgKiBpcyBsYXJnZXIgb3IgdGltZXIgaXMgY2xlYXJlZC4gQWxzbywgZW5zdXJl
IHRoYXQgSVFfUkVRX1BFTkQgaXMKKwkgKiBjbGVhcmVkIGJlZm9yZSBjb250aW51aW5nLiBBbHNv
LCBlbnN1cmUgd2FpdCB0aW1lcyBhcmUgc2V0IHRvIGF0CisJICogbGVhc3QgMHgzLgorCSAqLwor
CWxvY2FsX2lycV9zYXZlKGZsYWdzKTsKKwlwcmVlbXB0X2Rpc2FibGUoKTsKKwlyZXRyeSA9IDUw
MDA7IC8qIHdhaXQgZm9yIDUwMCB1c2VjcyBhdCBtYXhpbXVtICovCisJd2hpbGUgKHRydWUpIHsK
KwkJdGVtcCA9IFJSRUczMihtbUNQX0hRRF9JUV9USU1FUik7CisJCWlmIChSRUdfR0VUX0ZJRUxE
KHRlbXAsIENQX0hRRF9JUV9USU1FUiwgUFJPQ0VTU0lOR19JUSkpIHsKKwkJCXByX2RlYnVnKCJI
VyBpcyBwcm9jZXNzaW5nIElRXG4iKTsKKwkJCWdvdG8gbG9vcDsKKwkJfQorCQlpZiAoUkVHX0dF
VF9GSUVMRCh0ZW1wLCBDUF9IUURfSVFfVElNRVIsIEFDVElWRSkpIHsKKwkJCWlmIChSRUdfR0VU
X0ZJRUxEKHRlbXAsIENQX0hRRF9JUV9USU1FUiwgUkVUUllfVFlQRSkKKwkJCQkJPT0gMykgLyog
U0VNLXJlYXJtIGlzIHNhZmUgKi8KKwkJCQlicmVhazsKKwkJCS8qIFdhaXQgdGltZSAzIGlzIHNh
ZmUgZm9yIENQLCBidXQgb3VyIE1NSU8gcmVhZC93cml0ZQorCQkJICogdGltZSBpcyBjbG9zZSB0
byAxIG1pY3Jvc2Vjb25kLCBzbyBjaGVjayBmb3IgMTAgdG8KKwkJCSAqIGxlYXZlIG1vcmUgYnVm
ZmVyIHJvb20KKwkJCSAqLworCQkJaWYgKFJFR19HRVRfRklFTEQodGVtcCwgQ1BfSFFEX0lRX1RJ
TUVSLCBXQUlUX1RJTUUpCisJCQkJCT49IDEwKQorCQkJCWJyZWFrOworCQkJcHJfZGVidWcoIklR
IHRpbWVyIGlzIGFjdGl2ZVxuIik7CisJCX0gZWxzZQorCQkJYnJlYWs7Citsb29wOgorCQlpZiAo
IXJldHJ5KSB7CisJCQlwcl9lcnIoIkNQIEhRRCBJUSB0aW1lciBzdGF0dXMgdGltZSBvdXRcbiIp
OworCQkJYnJlYWs7CisJCX0KKwkJbmRlbGF5KDEwMCk7CisJCS0tcmV0cnk7CisJfQorCXJldHJ5
ID0gMTAwMDsKKwl3aGlsZSAodHJ1ZSkgeworCQl0ZW1wID0gUlJFRzMyKG1tQ1BfSFFEX0RFUVVF
VUVfUkVRVUVTVCk7CisJCWlmICghKHRlbXAgJiBDUF9IUURfREVRVUVVRV9SRVFVRVNUX19JUV9S
RVFfUEVORF9NQVNLKSkKKwkJCWJyZWFrOworCQlwcl9kZWJ1ZygiRGVxdWV1ZSByZXF1ZXN0IGlz
IHBlbmRpbmdcbiIpOworCisJCWlmICghcmV0cnkpIHsKKwkJCXByX2VycigiQ1AgSFFEIGRlcXVl
dWUgcmVxdWVzdCB0aW1lIG91dFxuIik7CisJCQlicmVhazsKKwkJfQorCQluZGVsYXkoMTAwKTsK
KwkJLS1yZXRyeTsKKwl9CisJbG9jYWxfaXJxX3Jlc3RvcmUoZmxhZ3MpOworCXByZWVtcHRfZW5h
YmxlKCk7CisjZW5kaWYKKworCVdSRUczMihTT0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUNQX0hR
RF9ERVFVRVVFX1JFUVVFU1QpLCB0eXBlKTsKKworCWVuZF9qaWZmaWVzID0gKHV0aW1lb3V0ICog
SFogLyAxMDAwKSArIGppZmZpZXM7CisJd2hpbGUgKHRydWUpIHsKKwkJdGVtcCA9IFJSRUczMihT
T0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUNQX0hRRF9BQ1RJVkUpKTsKKwkJaWYgKCEodGVtcCAm
IENQX0hRRF9BQ1RJVkVfX0FDVElWRV9NQVNLKSkKKwkJCWJyZWFrOworCQlpZiAodGltZV9hZnRl
cihqaWZmaWVzLCBlbmRfamlmZmllcykpIHsKKwkJCXByX2VycigiY3AgcXVldWUgcHJlZW1wdGlv
biB0aW1lIG91dC5cbiIpOworCQkJcmVsZWFzZV9xdWV1ZShrZ2QpOworCQkJcmV0dXJuIC1FVElN
RTsKKwkJfQorCQl1c2xlZXBfcmFuZ2UoNTAwLCAxMDAwKTsKKwl9CisKKwlyZWxlYXNlX3F1ZXVl
KGtnZCk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQga2dkX2hxZF9zZG1hX2Rlc3Ryb3ko
c3RydWN0IGtnZF9kZXYgKmtnZCwgdm9pZCAqbXFkLAorCQkJCXVuc2lnbmVkIGludCB1dGltZW91
dCkKK3sKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGdldF9hbWRncHVfZGV2aWNlKGtn
ZCk7CisJc3RydWN0IHYxMF9zZG1hX21xZCAqbTsKKwl1aW50MzJfdCBzZG1hX2Jhc2VfYWRkcjsK
Kwl1aW50MzJfdCB0ZW1wOworCXVuc2lnbmVkIGxvbmcgZW5kX2ppZmZpZXMgPSAodXRpbWVvdXQg
KiBIWiAvIDEwMDApICsgamlmZmllczsKKworCW0gPSBnZXRfc2RtYV9tcWQobXFkKTsKKwlzZG1h
X2Jhc2VfYWRkciA9IGdldF9zZG1hX2Jhc2VfYWRkcihhZGV2LCBtLT5zZG1hX2VuZ2luZV9pZCwK
KwkJCQkJICAgIG0tPnNkbWFfcXVldWVfaWQpOworCisJdGVtcCA9IFJSRUczMihzZG1hX2Jhc2Vf
YWRkciArIG1tU0RNQTBfUkxDMF9SQl9DTlRMKTsKKwl0ZW1wID0gdGVtcCAmIH5TRE1BMF9STEMw
X1JCX0NOVExfX1JCX0VOQUJMRV9NQVNLOworCVdSRUczMihzZG1hX2Jhc2VfYWRkciArIG1tU0RN
QTBfUkxDMF9SQl9DTlRMLCB0ZW1wKTsKKworCXdoaWxlICh0cnVlKSB7CisJCXRlbXAgPSBSUkVH
MzIoc2RtYV9iYXNlX2FkZHIgKyBtbVNETUEwX1JMQzBfQ09OVEVYVF9TVEFUVVMpOworCQlpZiAo
dGVtcCAmIFNETUEwX1JMQzBfQ09OVEVYVF9TVEFUVVNfX0lETEVfTUFTSykKKwkJCWJyZWFrOwor
CQlpZiAodGltZV9hZnRlcihqaWZmaWVzLCBlbmRfamlmZmllcykpCisJCQlyZXR1cm4gLUVUSU1F
OworCQl1c2xlZXBfcmFuZ2UoNTAwLCAxMDAwKTsKKwl9CisKKwlXUkVHMzIoc2RtYV9iYXNlX2Fk
ZHIgKyBtbVNETUEwX1JMQzBfRE9PUkJFTEwsIDApOworCVdSRUczMihzZG1hX2Jhc2VfYWRkciAr
IG1tU0RNQTBfUkxDMF9SQl9DTlRMLAorCQlSUkVHMzIoc2RtYV9iYXNlX2FkZHIgKyBtbVNETUEw
X1JMQzBfUkJfQ05UTCkgfAorCQlTRE1BMF9STEMwX1JCX0NOVExfX1JCX0VOQUJMRV9NQVNLKTsK
KworCW0tPnNkbWF4X3JsY3hfcmJfcnB0ciA9IFJSRUczMihzZG1hX2Jhc2VfYWRkciArIG1tU0RN
QTBfUkxDMF9SQl9SUFRSKTsKKwltLT5zZG1heF9ybGN4X3JiX3JwdHJfaGkgPQorCQlSUkVHMzIo
c2RtYV9iYXNlX2FkZHIgKyBtbVNETUEwX1JMQzBfUkJfUlBUUl9ISSk7CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGJvb2wgZ2V0X2F0Y192bWlkX3Bhc2lkX21hcHBpbmdfdmFsaWQoc3RydWN0
IGtnZF9kZXYgKmtnZCwKKwkJCQkJCQl1aW50OF90IHZtaWQpCit7CisJdWludDMyX3QgcmVnOwor
CXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopIGtn
ZDsKKworCXJlZyA9IFJSRUczMihTT0MxNV9SRUdfT0ZGU0VUKEFUSFVCLCAwLCBtbUFUQ19WTUlE
MF9QQVNJRF9NQVBQSU5HKQorCQkgICAgICsgdm1pZCk7CisJcmV0dXJuIHJlZyAmIEFUQ19WTUlE
MF9QQVNJRF9NQVBQSU5HX19WQUxJRF9NQVNLOworfQorCitzdGF0aWMgdWludDE2X3QgZ2V0X2F0
Y192bWlkX3Bhc2lkX21hcHBpbmdfcGFzaWQoc3RydWN0IGtnZF9kZXYgKmtnZCwKKwkJCQkJCQkJ
dWludDhfdCB2bWlkKQoreworCXVpbnQzMl90IHJlZzsKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKSBrZ2Q7CisKKwlyZWcgPSBSUkVHMzIoU09D
MTVfUkVHX09GRlNFVChBVEhVQiwgMCwgbW1BVENfVk1JRDBfUEFTSURfTUFQUElORykKKwkJICAg
ICArIHZtaWQpOworCXJldHVybiByZWcgJiBBVENfVk1JRDBfUEFTSURfTUFQUElOR19fUEFTSURf
TUFTSzsKK30KKworc3RhdGljIHZvaWQgd3JpdGVfdm1pZF9pbnZhbGlkYXRlX3JlcXVlc3Qoc3Ry
dWN0IGtnZF9kZXYgKmtnZCwgdWludDhfdCB2bWlkKQoreworCXN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopIGtnZDsKKwl1aW50MzJfdCByZXEgPSAo
MSA8PCB2bWlkKSB8CisJCSgwIDw8IEdDVk1fSU5WQUxJREFURV9FTkcwX1JFUV9fRkxVU0hfVFlQ
RV9fU0hJRlQpIHwvKiBsZWdhY3kgKi8KKwkJR0NWTV9JTlZBTElEQVRFX0VORzBfUkVRX19JTlZB
TElEQVRFX0wyX1BURVNfTUFTSyB8CisJCUdDVk1fSU5WQUxJREFURV9FTkcwX1JFUV9fSU5WQUxJ
REFURV9MMl9QREUwX01BU0sgfAorCQlHQ1ZNX0lOVkFMSURBVEVfRU5HMF9SRVFfX0lOVkFMSURB
VEVfTDJfUERFMV9NQVNLIHwKKwkJR0NWTV9JTlZBTElEQVRFX0VORzBfUkVRX19JTlZBTElEQVRF
X0wyX1BERTJfTUFTSyB8CisJCUdDVk1fSU5WQUxJREFURV9FTkcwX1JFUV9fSU5WQUxJREFURV9M
MV9QVEVTX01BU0s7CisKKwltdXRleF9sb2NrKCZhZGV2LT5zcmJtX211dGV4KTsKKworCS8qIFVz
ZSBsaWdodCB3ZWlnaHQgaW52YWxpZGF0aW9uLgorCSAqCisJICogVE9ETyAxOiBhZ3JlZSBvbiB0
aGUgcmlnaHQgc2V0IG9mIGludmFsaWRhdGlvbiByZWdpc3RlcnMgZm9yCisJICogS0ZEIHVzZS4g
VXNlIHRoZSBsYXN0IG9uZSBmb3Igbm93LiBJbnZhbGlkYXRlIG9ubHkgR0NIVUIgYXMKKwkgKiBT
RE1BIGlzIG5vdyBtb3ZlZCB0byBHQ0hVQgorCSAqCisJICogVE9ETyAyOiBzdXBwb3J0IHJhbmdl
LWJhc2VkIGludmFsaWRhdGlvbiwgcmVxdWlyZXMga2ZnMmtnZAorCSAqIGludGVyZmFjZSBjaGFu
Z2UKKwkgKi8KKwlXUkVHMzIoU09DMTVfUkVHX09GRlNFVChHQywgMCwgbW1HQ1ZNX0lOVkFMSURB
VEVfRU5HMF9BRERSX1JBTkdFX0xPMzIpLAorCQkJCTB4ZmZmZmZmZmYpOworCVdSRUczMihTT0Mx
NV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUdDVk1fSU5WQUxJREFURV9FTkcwX0FERFJfUkFOR0VfSEkz
MiksCisJCQkJMHgwMDAwMDAxZik7CisKKwlXUkVHMzIoU09DMTVfUkVHX09GRlNFVChHQywgMCwg
bW1HQ1ZNX0lOVkFMSURBVEVfRU5HMF9SRVEpLCByZXEpOworCisJd2hpbGUgKCEoUlJFRzMyKFNP
QzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tR0NWTV9JTlZBTElEQVRFX0VORzBfQUNLKSkgJgorCQkJ
CQkoMSA8PCB2bWlkKSkpCisJCWNwdV9yZWxheCgpOworCisJbXV0ZXhfdW5sb2NrKCZhZGV2LT5z
cmJtX211dGV4KTsKK30KKworc3RhdGljIGludCBpbnZhbGlkYXRlX3RsYnNfd2l0aF9raXEoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQxNl90IHBhc2lkKQoreworCXNpZ25lZCBsb25n
IHI7CisJdWludDMyX3Qgc2VxOworCXN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT5n
Zngua2lxLnJpbmc7CisKKwlzcGluX2xvY2soJmFkZXYtPmdmeC5raXEucmluZ19sb2NrKTsKKwlh
bWRncHVfcmluZ19hbGxvYyhyaW5nLCAxMik7IC8qIGZlbmNlICsgaW52YWxpZGF0ZV90bGJzIHBh
Y2thZ2UqLworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIFBBQ0tFVDMoUEFDS0VUM19JTlZBTElE
QVRFX1RMQlMsIDApKTsKKwlhbWRncHVfcmluZ193cml0ZShyaW5nLAorCQkJUEFDS0VUM19JTlZB
TElEQVRFX1RMQlNfRFNUX1NFTCgxKSB8CisJCQlQQUNLRVQzX0lOVkFMSURBVEVfVExCU19QQVNJ
RChwYXNpZCkpOworCWFtZGdwdV9mZW5jZV9lbWl0X3BvbGxpbmcocmluZywgJnNlcSk7CisJYW1k
Z3B1X3JpbmdfY29tbWl0KHJpbmcpOworCXNwaW5fdW5sb2NrKCZhZGV2LT5nZngua2lxLnJpbmdf
bG9jayk7CisKKwlyID0gYW1kZ3B1X2ZlbmNlX3dhaXRfcG9sbGluZyhyaW5nLCBzZXEsIGFkZXYt
PnVzZWNfdGltZW91dCk7CisJaWYgKHIgPCAxKSB7CisJCURSTV9FUlJPUigid2FpdCBmb3Iga2lx
IGZlbmNlIGVycm9yOiAlbGQuXG4iLCByKTsKKwkJcmV0dXJuIC1FVElNRTsKKwl9CisKKwlyZXR1
cm4gMDsKK30KKworc3RhdGljIGludCBpbnZhbGlkYXRlX3RsYnMoc3RydWN0IGtnZF9kZXYgKmtn
ZCwgdWludDE2X3QgcGFzaWQpCit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKikga2dkOworCWludCB2bWlkOworCXN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZyA9ICZhZGV2LT5nZngua2lxLnJpbmc7CisKKwlpZiAoYW1kZ3B1X2VtdV9tb2RlID09
IDAgJiYgcmluZy0+c2NoZWQucmVhZHkpCisJCXJldHVybiBpbnZhbGlkYXRlX3RsYnNfd2l0aF9r
aXEoYWRldiwgcGFzaWQpOworCisJZm9yICh2bWlkID0gMDsgdm1pZCA8IDE2OyB2bWlkKyspIHsK
KwkJaWYgKCFhbWRncHVfYW1ka2ZkX2lzX2tmZF92bWlkKGFkZXYsIHZtaWQpKQorCQkJY29udGlu
dWU7CisJCWlmIChnZXRfYXRjX3ZtaWRfcGFzaWRfbWFwcGluZ192YWxpZChrZ2QsIHZtaWQpKSB7
CisJCQlpZiAoZ2V0X2F0Y192bWlkX3Bhc2lkX21hcHBpbmdfcGFzaWQoa2dkLCB2bWlkKQorCQkJ
CT09IHBhc2lkKSB7CisJCQkJd3JpdGVfdm1pZF9pbnZhbGlkYXRlX3JlcXVlc3Qoa2dkLCB2bWlk
KTsKKwkJCQlicmVhazsKKwkJCX0KKwkJfQorCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IGludmFsaWRhdGVfdGxic192bWlkKHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHVpbnQxNl90IHZt
aWQpCit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKikga2dkOworCisJaWYgKCFhbWRncHVfYW1ka2ZkX2lzX2tmZF92bWlkKGFkZXYsIHZtaWQp
KSB7CisJCXByX2Vycigibm9uIGtmZCB2bWlkICVkXG4iLCB2bWlkKTsKKwkJcmV0dXJuIDA7CisJ
fQorCisJd3JpdGVfdm1pZF9pbnZhbGlkYXRlX3JlcXVlc3Qoa2dkLCB2bWlkKTsKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIGludCBrZ2RfYWRkcmVzc193YXRjaF9kaXNhYmxlKHN0cnVjdCBrZ2Rf
ZGV2ICprZ2QpCit7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQga2dkX2FkZHJlc3Nfd2F0
Y2hfZXhlY3V0ZShzdHJ1Y3Qga2dkX2RldiAqa2dkLAorCQkJCQl1bnNpZ25lZCBpbnQgd2F0Y2hf
cG9pbnRfaWQsCisJCQkJCXVpbnQzMl90IGNudGxfdmFsLAorCQkJCQl1aW50MzJfdCBhZGRyX2hp
LAorCQkJCQl1aW50MzJfdCBhZGRyX2xvKQoreworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50
IGtnZF93YXZlX2NvbnRyb2xfZXhlY3V0ZShzdHJ1Y3Qga2dkX2RldiAqa2dkLAorCQkJCQl1aW50
MzJfdCBnZnhfaW5kZXhfdmFsLAorCQkJCQl1aW50MzJfdCBzcV9jbWQpCit7CisJc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYgPSBnZXRfYW1kZ3B1X2RldmljZShrZ2QpOworCXVpbnQzMl90IGRh
dGEgPSAwOworCisJbXV0ZXhfbG9jaygmYWRldi0+Z3JibV9pZHhfbXV0ZXgpOworCisJV1JFRzMy
KFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tR1JCTV9HRlhfSU5ERVgpLCBnZnhfaW5kZXhfdmFs
KTsKKwlXUkVHMzIoU09DMTVfUkVHX09GRlNFVChHQywgMCwgbW1TUV9DTUQpLCBzcV9jbWQpOwor
CisJZGF0YSA9IFJFR19TRVRfRklFTEQoZGF0YSwgR1JCTV9HRlhfSU5ERVgsCisJCUlOU1RBTkNF
X0JST0FEQ0FTVF9XUklURVMsIDEpOworCWRhdGEgPSBSRUdfU0VUX0ZJRUxEKGRhdGEsIEdSQk1f
R0ZYX0lOREVYLAorCQlTQV9CUk9BRENBU1RfV1JJVEVTLCAxKTsKKwlkYXRhID0gUkVHX1NFVF9G
SUVMRChkYXRhLCBHUkJNX0dGWF9JTkRFWCwKKwkJU0VfQlJPQURDQVNUX1dSSVRFUywgMSk7CisK
KwlXUkVHMzIoU09DMTVfUkVHX09GRlNFVChHQywgMCwgbW1HUkJNX0dGWF9JTkRFWCksIGRhdGEp
OworCW11dGV4X3VubG9jaygmYWRldi0+Z3JibV9pZHhfbXV0ZXgpOworCisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyB1aW50MzJfdCBrZ2RfYWRkcmVzc193YXRjaF9nZXRfb2Zmc2V0KHN0cnVjdCBr
Z2RfZGV2ICprZ2QsCisJCQkJCXVuc2lnbmVkIGludCB3YXRjaF9wb2ludF9pZCwKKwkJCQkJdW5z
aWduZWQgaW50IHJlZ19vZmZzZXQpCit7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHNl
dF92bV9jb250ZXh0X3BhZ2VfdGFibGVfYmFzZShzdHJ1Y3Qga2dkX2RldiAqa2dkLCB1aW50MzJf
dCB2bWlkLAorCQl1aW50NjRfdCBwYWdlX3RhYmxlX2Jhc2UpCit7CisJc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYgPSBnZXRfYW1kZ3B1X2RldmljZShrZ2QpOworCXVpbnQ2NF90IGJhc2UgPSBw
YWdlX3RhYmxlX2Jhc2UgfCBBTURHUFVfUFRFX1ZBTElEOworCisJaWYgKCFhbWRncHVfYW1ka2Zk
X2lzX2tmZF92bWlkKGFkZXYsIHZtaWQpKSB7CisJCXByX2VycigidHJ5aW5nIHRvIHNldCBwYWdl
IHRhYmxlIGJhc2UgZm9yIHdyb25nIFZNSUQgJXVcbiIsCisJCSAgICAgICB2bWlkKTsKKwkJcmV0
dXJuOworCX0KKworCS8qIFRPRE86IHRha2UgYWR2YW50YWdlIG9mIHBlci1wcm9jZXNzIGFkZHJl
c3Mgc3BhY2Ugc2l6ZS4gRm9yCisJICogbm93LCBhbGwgcHJvY2Vzc2VzIHNoYXJlIHRoZSBzYW1l
IGFkZHJlc3Mgc3BhY2Ugc2l6ZSwgbGlrZQorCSAqIG9uIEdGWDggYW5kIG9sZGVyLgorCSAqLwor
CVdSRUczMihTT0MxNV9SRUdfT0ZGU0VUKEdDLCAwLCBtbUdDVk1fQ09OVEVYVDBfUEFHRV9UQUJM
RV9TVEFSVF9BRERSX0xPMzIpICsgKHZtaWQqMiksIDApOworCVdSRUczMihTT0MxNV9SRUdfT0ZG
U0VUKEdDLCAwLCBtbUdDVk1fQ09OVEVYVDBfUEFHRV9UQUJMRV9TVEFSVF9BRERSX0hJMzIpICsg
KHZtaWQqMiksIDApOworCisJV1JFRzMyKFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tR0NWTV9D
T05URVhUMF9QQUdFX1RBQkxFX0VORF9BRERSX0xPMzIpICsgKHZtaWQqMiksCisJCQlsb3dlcl8z
Ml9iaXRzKGFkZXYtPnZtX21hbmFnZXIubWF4X3BmbiAtIDEpKTsKKwlXUkVHMzIoU09DMTVfUkVH
X09GRlNFVChHQywgMCwgbW1HQ1ZNX0NPTlRFWFQwX1BBR0VfVEFCTEVfRU5EX0FERFJfSEkzMikg
KyAodm1pZCoyKSwKKwkJCXVwcGVyXzMyX2JpdHMoYWRldi0+dm1fbWFuYWdlci5tYXhfcGZuIC0g
MSkpOworCisJV1JFRzMyKFNPQzE1X1JFR19PRkZTRVQoR0MsIDAsIG1tR0NWTV9DT05URVhUMF9Q
QUdFX1RBQkxFX0JBU0VfQUREUl9MTzMyKSArICh2bWlkKjIpLCBsb3dlcl8zMl9iaXRzKGJhc2Up
KTsKKwlXUkVHMzIoU09DMTVfUkVHX09GRlNFVChHQywgMCwgbW1HQ1ZNX0NPTlRFWFQwX1BBR0Vf
VEFCTEVfQkFTRV9BRERSX0hJMzIpICsgKHZtaWQqMiksIHVwcGVyXzMyX2JpdHMoYmFzZSkpOwor
fQotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
