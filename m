Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 17F64382A56
	for <lists+amd-gfx@lfdr.de>; Mon, 17 May 2021 12:55:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E90B86E924;
	Mon, 17 May 2021 10:55:27 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-ed1-x536.google.com (mail-ed1-x536.google.com
 [IPv6:2a00:1450:4864:20::536])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 90C066E924
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 May 2021 10:55:26 +0000 (UTC)
Received: by mail-ed1-x536.google.com with SMTP id r11so6268830edt.13
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 May 2021 03:55:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=subject:to:cc:references:from:message-id:date:user-agent
 :mime-version:in-reply-to:content-transfer-encoding:content-language;
 bh=c/TDVYaUqi5uTw3MVpuvsx65kkL1j0uT3Wu2IdrncxY=;
 b=Okf8gLkxqsv9Cx0OJvAxH0GxOa+zJ1gOF7iruOUO2gzGWqSrM0tzJYwDjVmKClIgM7
 KXdcU1vevoWw9Q70d5elPsZDfHuSWoHyXrzWuML7KkiQeBx0xZpBPz0I/uwcGxeMRx6H
 4JyOGgqg7r/k83SHLYEEdeRi8CZ86zMIPfw5gNRVpsLhwc+8lHVlpUsvcDL6XDKNuOSo
 CzNTyePnal5FQWMwwyQ8ir75HUG16TRCrnHg0np6KSGPpeHZR3alGCzxPE51Ry1uOiG3
 0pmSe3TSKOcsKqAhe3dxeL/m9n96ossZvQLJjUxW14YFhxi7AxS2pSiFLJQ4IGTTVaAg
 81VQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:subject:to:cc:references:from:message-id:date
 :user-agent:mime-version:in-reply-to:content-transfer-encoding
 :content-language;
 bh=c/TDVYaUqi5uTw3MVpuvsx65kkL1j0uT3Wu2IdrncxY=;
 b=BeiMaSal7ydPyEwEmfu/KDuLQi9bee0PYpqQOeI5LKJh0UZaBKXUbF0YC0dbkq0jb8
 P6vdPDt/uQA0UWl9cuq3ebk0LE9vWCDGCh7kU/AEGkU8McU9nWiW2Kvzkc2bWfYGWDGQ
 BZ4NrcHyBKej1bOHn80xwbNYbIl8I6CwByHx2HScH5bEY7IhcJuW8L1exemoXq0mZ+60
 +u/VGiZbDSKeJ2HDfmQfBqGCIxc/Oegz1vBYV0YpgjyAddYo+Ipl984hT7DPM2KudRAr
 K047Lm7JjjSoxzCJob0hECTWvLYsp/6XHn1REfFMjL3k6k4z/2Ae71PI26oBgY0ABp7N
 VM7w==
X-Gm-Message-State: AOAM53185DiYAnLqIwz4maw2Lg6jASYkmc7P5eCVIRLLpjUlalF9D26P
 FROMXzZFqmKMqq/f0LMhMB3dujNxyeA=
X-Google-Smtp-Source: ABdhPJwSIovYRc9wvH3j/IdZohlQzt1f2YOz3xtmP4e2yFFbKQoKtTN9Qn7lIJ832GeCka2olrtuhg==
X-Received: by 2002:a05:6402:312a:: with SMTP id
 dd10mr70008599edb.384.1621248925170; 
 Mon, 17 May 2021 03:55:25 -0700 (PDT)
Received: from ?IPv6:2a02:908:1252:fb60:6bbe:b48c:2de1:422d?
 ([2a02:908:1252:fb60:6bbe:b48c:2de1:422d])
 by smtp.gmail.com with ESMTPSA id b16sm8612522edu.53.2021.05.17.03.55.24
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Mon, 17 May 2021 03:55:24 -0700 (PDT)
Subject: Re: [PATCH] drm/amd/amdgpu: fix a potential deadlock in gpu reset
To: Lang Yu <Lang.Yu@amd.com>, amd-gfx@lists.freedesktop.org,
 Grodzovsky Andrey <andrey.grodzovsky@amd.com>
References: <20210517105232.7776-1-Lang.Yu@amd.com>
From: =?UTF-8?Q?Christian_K=c3=b6nig?= <ckoenig.leichtzumerken@gmail.com>
Message-ID: <cc8aedad-cca1-f486-651b-ed85e267aa95@gmail.com>
Date: Mon, 17 May 2021 12:55:23 +0200
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101
 Thunderbird/78.8.1
MIME-Version: 1.0
In-Reply-To: <20210517105232.7776-1-Lang.Yu@amd.com>
Content-Language: en-US
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Huang Rui <ray.huang@amd.com>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

QW0gMTcuMDUuMjEgdW0gMTI6NTIgc2NocmllYiBMYW5nIFl1Ogo+IFdoZW4gYW1kZ3B1X2liX3Jp
bmdfdGVzdHMgZmFpbGVkLCB0aGUgcmVzZXQgbG9naWMgY2FsbGVkCj4gYW1kZ3B1X2RldmljZV9p
cF9zdXNwZW5kIHR3aWNlLCB0aGVuIGRlYWRsb2NrIG9jY3VycmVkLgo+Cj4gRGVhZGxvY2sgbG9n
Ogo+IFsgIDgwNS42NTUxOTJdIGFtZGdwdSAwMDAwOjA0OjAwLjA6IGFtZGdwdTogaWIgcmluZyB0
ZXN0IGZhaWxlZCAoLTExMCkuCj4gWyAgODA2LjAxMTU3MV0gW2RybV0gUmVnaXN0ZXIoMCkgW21t
VVZEX1BPV0VSX1NUQVRVU10gZmFpbGVkIHRvIHJlYWNoIHZhbHVlIDB4MDAwMDAwMDEgIT0gMHgw
MDAwMDAwMgo+IFsgIDgwNi4yODAxMzldIFtkcm1dIFJlZ2lzdGVyKDApIFttbVVWRF9QT1dFUl9T
VEFUVVNdIGZhaWxlZCB0byByZWFjaCB2YWx1ZSAweDAwMDAwMDAxICE9IDB4MDAwMDAwMDIKPiBb
ICA4MDYuMjkwOTUyXSBbZHJtXSBmcmVlIFBTUCBUTVIgYnVmZmVyCj4KPiBbICA4MDYuMzE5NDA2
XSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQo+IFsgIDgwNi4z
MjAzMTVdIFdBUk5JTkc6IHBvc3NpYmxlIHJlY3Vyc2l2ZSBsb2NraW5nIGRldGVjdGVkCj4gWyAg
ODA2LjMyMTIyNV0gNS4xMS4wLWN1c3RvbSAjMSBUYWludGVkOiBHICAgICAgICBXICBPRUwKPiBb
ICA4MDYuMzIyMTM1XSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LQo+IFsgIDgwNi4zMjMwNDNdIGNhdC8yNTkzIGlzIHRyeWluZyB0byBhY3F1aXJlIGxvY2s6Cj4g
WyAgODA2LjMyMzgyNV0gZmZmZjg4ODEzNmIxY2RjOCAoJmFkZXYtPmRtLmRjX2xvY2speysuKy59
LXszOjN9LCBhdDogZG1fc3VzcGVuZCsweGI4LzB4MWQwIFthbWRncHVdCj4gWyAgODA2LjMyNTY2
OF0KPiAgICAgICAgICAgICAgICAgYnV0IHRhc2sgaXMgYWxyZWFkeSBob2xkaW5nIGxvY2s6Cj4g
WyAgODA2LjMyNjY2NF0gZmZmZjg4ODEzNmIxY2RjOCAoJmFkZXYtPmRtLmRjX2xvY2speysuKy59
LXszOjN9LCBhdDogZG1fc3VzcGVuZCsweGI4LzB4MWQwIFthbWRncHVdCj4gWyAgODA2LjMyODQz
MF0KPiAgICAgICAgICAgICAgICAgb3RoZXIgaW5mbyB0aGF0IG1pZ2h0IGhlbHAgdXMgZGVidWcg
dGhpczoKPiBbICA4MDYuMzI5NTM5XSAgUG9zc2libGUgdW5zYWZlIGxvY2tpbmcgc2NlbmFyaW86
Cj4KPiBbICA4MDYuMzMwNTQ5XSAgICAgICAgQ1BVMAo+IFsgIDgwNi4zMzA5ODNdICAgICAgICAt
LS0tCj4gWyAgODA2LjMzMTQxNl0gICBsb2NrKCZhZGV2LT5kbS5kY19sb2NrKTsKPiBbICA4MDYu
MzMyMDg2XSAgIGxvY2soJmFkZXYtPmRtLmRjX2xvY2spOwo+IFsgIDgwNi4zMzI3MzhdCj4gICAg
ICAgICAgICAgICAgICAqKiogREVBRExPQ0sgKioqCj4KPiBbICA4MDYuMzMzNzQ3XSAgTWF5IGJl
IGR1ZSB0byBtaXNzaW5nIGxvY2sgbmVzdGluZyBub3RhdGlvbgo+Cj4gWyAgODA2LjMzNDg5OV0g
MyBsb2NrcyBoZWxkIGJ5IGNhdC8yNTkzOgo+IFsgIDgwNi4zMzU1MzddICAjMDogZmZmZjg4ODEw
MGQzZjFiOCAoJmF0dHItPm11dGV4KXsrLisufS17MzozfSwgYXQ6IHNpbXBsZV9hdHRyX3JlYWQr
MHg0ZS8weDExMAo+IFsgIDgwNi4zMzcwMDldICAjMTogZmZmZjg4ODEzNmIxZmQ3OCAoJmFkZXYt
PnJlc2V0X3NlbSl7KysrK30tezM6M30sIGF0OiBhbWRncHVfZGV2aWNlX2xvY2tfYWRldisweDQy
LzB4OTQgW2FtZGdwdV0KPiBbICA4MDYuMzM5MDE4XSAgIzI6IGZmZmY4ODgxMzZiMWNkYzggKCZh
ZGV2LT5kbS5kY19sb2NrKXsrLisufS17MzozfSwgYXQ6IGRtX3N1c3BlbmQrMHhiOC8weDFkMCBb
YW1kZ3B1XQo+IFsgIDgwNi4zNDA4NjldCj4gICAgICAgICAgICAgICAgIHN0YWNrIGJhY2t0cmFj
ZToKPiBbICA4MDYuMzQxNjIxXSBDUFU6IDYgUElEOiAyNTkzIENvbW06IGNhdCBUYWludGVkOiBH
ICAgICAgICBXICBPRUwgICAgNS4xMS4wLWN1c3RvbSAjMQo+IFsgIDgwNi4zNDI5MjFdIEhhcmR3
YXJlIG5hbWU6IEFNRCBDZWxhZG9uLUNaTi9DZWxhZG9uLUNaTiwgQklPUyBXTEQwQzIzTl9XZWVr
bHlfMjBfMTJfMiAxMi8yMy8yMDIwCj4gWyAgODA2LjM0NDQxM10gQ2FsbCBUcmFjZToKPiBbICA4
MDYuMzQ0ODQ5XSAgZHVtcF9zdGFjaysweDkzLzB4YmQKPiBbICA4MDYuMzQ1NDM1XSAgX19sb2Nr
X2FjcXVpcmUuY29sZCsweDE4YS8weDJjZgo+IFsgIDgwNi4zNDYxNzldICBsb2NrX2FjcXVpcmUr
MHhjYS8weDM5MAo+IFsgIDgwNi4zNDY4MDddICA/IGRtX3N1c3BlbmQrMHhiOC8weDFkMCBbYW1k
Z3B1XQo+IFsgIDgwNi4zNDc4MTNdICBfX211dGV4X2xvY2srMHg5Yi8weDkzMAo+IFsgIDgwNi4z
NDg0NTRdICA/IGRtX3N1c3BlbmQrMHhiOC8weDFkMCBbYW1kZ3B1XQo+IFsgIDgwNi4zNDk0MzRd
ICA/IGFtZGdwdV9kZXZpY2VfaW5kaXJlY3RfcnJlZysweDU4LzB4NzAgW2FtZGdwdV0KPiBbICA4
MDYuMzUwNTgxXSAgPyBfcmF3X3NwaW5fdW5sb2NrX2lycXJlc3RvcmUrMHg0Ny8weDUwCj4gWyAg
ODA2LjM1MTQzN10gID8gZG1fc3VzcGVuZCsweGI4LzB4MWQwIFthbWRncHVdCj4gWyAgODA2LjM1
MjQzN10gID8gcmN1X3JlYWRfbG9ja19zY2hlZF9oZWxkKzB4NGYvMHg4MAo+IFsgIDgwNi4zNTMy
NTJdICA/IHJjdV9yZWFkX2xvY2tfc2NoZWRfaGVsZCsweDRmLzB4ODAKPiBbICA4MDYuMzU0MDY0
XSAgbXV0ZXhfbG9ja19uZXN0ZWQrMHgxYi8weDIwCj4gWyAgODA2LjM1NDc0N10gID8gbXV0ZXhf
bG9ja19uZXN0ZWQrMHgxYi8weDIwCj4gWyAgODA2LjM1NTQ1N10gIGRtX3N1c3BlbmQrMHhiOC8w
eDFkMCBbYW1kZ3B1XQo+IFsgIDgwNi4zNTY0MjddICA/IHNvYzE1X2NvbW1vbl9zZXRfY2xvY2tn
YXRpbmdfc3RhdGUrMHgxN2QvMHgxOSBbYW1kZ3B1XQo+IFsgIDgwNi4zNTc3MzZdICBhbWRncHVf
ZGV2aWNlX2lwX3N1c3BlbmRfcGhhc2UxKzB4NzgvMHhkMCBbYW1kZ3B1XQo+IFsgIDgwNi4zNjAz
OTRdICBhbWRncHVfZGV2aWNlX2lwX3N1c3BlbmQrMHgyMS8weDcwIFthbWRncHVdCj4gWyAgODA2
LjM2MjkyNl0gIGFtZGdwdV9kZXZpY2VfcHJlX2FzaWNfcmVzZXQrMHhiMy8weDI3MCBbYW1kZ3B1
XQo+IFsgIDgwNi4zNjU1NjBdICBhbWRncHVfZGV2aWNlX2dwdV9yZWNvdmVyLmNvbGQrMHg2Nzkv
MHg4ZWIgW2FtZGdwdV0KPiBbICA4MDYuMzY4MzMxXSAgPyBfX3BtX3J1bnRpbWVfcmVzdW1lKzB4
NjAvMHg4MAo+IFsgIDgwNi4zNzA1MDldICBncHVfcmVjb3Zlcl9nZXQrMHgyZS8weDYwIFthbWRn
cHVdCj4gWyAgODA2LjM3Mjg4N10gIHNpbXBsZV9hdHRyX3JlYWQrMHg2ZC8weDExMAo+IFsgIDgw
Ni4zNzQ5NjZdICBkZWJ1Z2ZzX2F0dHJfcmVhZCsweDQ5LzB4NzAKPiBbICA4MDYuMzc3MDQ2XSAg
ZnVsbF9wcm94eV9yZWFkKzB4NWYvMHg5MAo+IFsgIDgwNi4zNzkwNTRdICB2ZnNfcmVhZCsweGEz
LzB4MTkwCj4gWyAgODA2LjM4MDk2OV0gIGtzeXNfcmVhZCsweDcwLzB4ZjAKPiBbICA4MDYuMzgy
ODMzXSAgX194NjRfc3lzX3JlYWQrMHgxYS8weDIwCj4gWyAgODA2LjM4NDgwM10gIGRvX3N5c2Nh
bGxfNjQrMHgzOC8weDkwCj4gWyAgODA2LjM4Njc0M10gIGVudHJ5X1NZU0NBTExfNjRfYWZ0ZXJf
aHdmcmFtZSsweDQ0LzB4YTkKPiBbICA4MDYuMzg4OTQ2XSBSSVA6IDAwMzM6MHg3ZmIwODRlYTEx
NDIKPiBbICA4MDYuMzkwOTE0XSBDb2RlOiBjMCBlOSBjMiBmZSBmZiBmZiA1MCA0OCA4ZCAzZCAz
YSBjYSAwYSAwMCBlOCBmNSAxOSAwMiAwMCAwZiAxZiA0NCAwMCAwMCBmMyAwZiAxZSBmYSA2NCA4
YiAwNCAyNSAxOCAwMCAwMCAwMCA4NSBjMCA3NSAxMCAwZiAwNSA8NDg+IDNkIDAwIGYwIGZmIGZm
IDc3IDU2IGMzIDBmIDFmIDQ0IDAwIDAwIDQ4IDgzIGVjIDI4IDQ4IDg5IDU0IDI0Cj4gWyAgODA2
LjM5NTQ5Nl0gUlNQOiAwMDJiOjAwMDA3ZmZmZGU1MGVlMDggRUZMQUdTOiAwMDAwMDI0NiBPUklH
X1JBWDogMDAwMDAwMDAwMDAwMDAwMAo+IFsgIDgwNi4zOTgyOThdIFJBWDogZmZmZmZmZmZmZmZm
ZmZkYSBSQlg6IDAwMDAwMDAwMDAwMjAwMDAgUkNYOiAwMDAwN2ZiMDg0ZWExMTQyCj4gWyAgODA2
LjQwMTA2M10gUkRYOiAwMDAwMDAwMDAwMDIwMDAwIFJTSTogMDAwMDdmYjA4NDRmZjAwMCBSREk6
IDAwMDAwMDAwMDAwMDAwMDMKPiBbICA4MDYuNDAzNzkzXSBSQlA6IDAwMDA3ZmIwODQ0ZmYwMDAg
UjA4OiAwMDAwN2ZiMDg0NGZlMDEwIFIwOTogMDAwMDAwMDAwMDAwMDAwMAo+IFsgIDgwNi40MDY1
MTZdIFIxMDogMDAwMDAwMDAwMDAwMDAyMiBSMTE6IDAwMDAwMDAwMDAwMDAyNDYgUjEyOiAwMDAw
NTU1ZDNkM2I1MWYwCj4gWyAgODA2LjQwOTI0Nl0gUjEzOiAwMDAwMDAwMDAwMDAwMDAzIFIxNDog
MDAwMDAwMDAwMDAyMDAwMCBSMTU6IDAwMDAwMDAwMDAwMjAwMDAKCkkgdGhpbmsgd2Ugc2hvdWxk
IHNob3J0ZW4gdGhlIGJhY2t0cmFjZSBoZXJlIGEgYml0LgoKPgo+IFNpZ25lZC1vZmYtYnk6IExh
bmcgWXUgPExhbmcuWXVAYW1kLmNvbT4KCkxvb2tzIHNhbmUgdG8gbWUsIGJ1dCBBbmRyZXkgc2hv
dWxkIHByb2JhYmx5IGFsc28gdGFrZSBhIGxvb2suCgpBY2tlZC1ieTogQ2hyaXN0aWFuIEvDtm5p
ZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgoKPiAtLS0KPiAgIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyB8IDEgLQo+ICAgMSBmaWxlIGNoYW5nZWQsIDEgZGVs
ZXRpb24oLSkKPgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMK
PiBpbmRleCA3YzZjNDM1ZTVkMDIuLmZmMzQxMTU0Mzk0ZSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKPiArKysgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKPiBAQCAtNDQ3Niw3ICs0NDc2LDYgQEAgaW50
IGFtZGdwdV9kb19hc2ljX3Jlc2V0KHN0cnVjdCBsaXN0X2hlYWQgKmRldmljZV9saXN0X2hhbmRs
ZSwKPiAgIAkJCXIgPSBhbWRncHVfaWJfcmluZ190ZXN0cyh0bXBfYWRldik7Cj4gICAJCQlpZiAo
cikgewo+ICAgCQkJCWRldl9lcnIodG1wX2FkZXYtPmRldiwgImliIHJpbmcgdGVzdCBmYWlsZWQg
KCVkKS5cbiIsIHIpOwo+IC0JCQkJciA9IGFtZGdwdV9kZXZpY2VfaXBfc3VzcGVuZCh0bXBfYWRl
dik7Cj4gICAJCQkJbmVlZF9mdWxsX3Jlc2V0ID0gdHJ1ZTsKPiAgIAkJCQlyID0gLUVBR0FJTjsK
PiAgIAkJCQlnb3RvIGVuZDsKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdm
eAo=
