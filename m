Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3D99948EE7
	for <lists+amd-gfx@lfdr.de>; Mon, 17 Jun 2019 21:28:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1E46689A9B;
	Mon, 17 Jun 2019 19:28:24 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x842.google.com (mail-qt1-x842.google.com
 [IPv6:2607:f8b0:4864:20::842])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D680E89A5D
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 19:28:15 +0000 (UTC)
Received: by mail-qt1-x842.google.com with SMTP id d17so7262294qtj.8
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 12:28:15 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=fnEk0znSGjJx8N5mprT+3H2VUN3AOJNvPnaAMV2cwlY=;
 b=OSTrC3awUTGp8GR+mAnmg+ZUlnC2fN/C8dKc4R1MUGDHUmVzzlTufGxlLblWECwdQp
 EshzMPEdo4C9EVUY7NMAa8401wLMJLcya07WqBVtdQT7cUpcw9G4H3WcrWjgwvD5O35Y
 6t9G1ok2qVwXLdLdQ3DLvBVQIJ0ByS+9kg9x+SaKYKJ1jkhZuUluEGhQkG5H/8X2+yEW
 29qD4Cpit9Us8eCOqFwFMylCEo+1WuorO5WwokuoEO47N1HFFt3wAi8R6skk2bUm33gP
 gtdUMuEz8DKg+S/K5AF7yi5lp1FJki7fYl8UXXEQ4D++jZz5NXeX2JMcD2Oj3xT1Gqjj
 XJow==
X-Gm-Message-State: APjAAAVz71EL0ljmCQJRk5wY1hpRxGEv8D1+6t60pNr2sB+WNzv+rAgH
 ilhY/uOkZQ6zbNZn/SFYX+gLbixSahI=
X-Google-Smtp-Source: APXvYqzlNH86Uvy4iMym5650Nvec92ZB6aqvg4T4TXwefzlLGs3y+cPsYFI55MCzWb1KBJlxyFB/JQ==
X-Received: by 2002:a0c:8a69:: with SMTP id 38mr23420940qvu.116.1560799694746; 
 Mon, 17 Jun 2019 12:28:14 -0700 (PDT)
Received: from localhost.localdomain ([71.219.5.136])
 by smtp.gmail.com with ESMTPSA id p37sm7715622qtc.35.2019.06.17.12.28.13
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 17 Jun 2019 12:28:14 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 167/459] drm/amd: add gfxoff support on navi10
Date: Mon, 17 Jun 2019 14:26:32 -0500
Message-Id: <20190617192704.18038-68-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617192704.18038-1-alexander.deucher@amd.com>
References: <20190617192704.18038-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=fnEk0znSGjJx8N5mprT+3H2VUN3AOJNvPnaAMV2cwlY=;
 b=SZIoY/Up4UCZEK7WFqQA6PXdyMDb6JOUFd73f5bS1Pk3faUp8640LACTQ5PDCdMoYL
 XKWRMv5ly5nfoXgXOB9qhkiGnwJdKkH29bXy4LCMGZmSnig+gIkNjVx7Rmn9HEOMoStL
 2nFDOj+8TYPcTOXlQTeVc8hsav6wHzrnBMt+B4+KrKgosFWEh0O7h00vsq4QCW8GONsm
 t0lmtciH7ZAVmPdsZYsB9A3xqgplmwuYaq4+9tTbo4fNiEfvUBj+Zp5RCnjo4IVMMyxv
 SdUyrtbeqj4zUWbM9wb0kzQaG0abLVamRz/eWY+qdEzaacBvMVNVvtYkph4UMsaKM4Y0
 fDbw==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>,
 Kenneth Feng <kenneth.feng@amd.com>, Hawking Zhang <Hawking.Zhang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogS2VubmV0aCBGZW5nIDxrZW5uZXRoLmZlbmdAYW1kLmNvbT4KCmFkZCB0aGUgZ2Z4b2Zm
IGludGVyZmFjZSB0byBuYXZpMTAsaXQncyBkaXNhYmxlZCBieSBkZWZhdWx0LgoKU2lnbmVkLW9m
Zi1ieTogS2VubmV0aCBGZW5nIDxrZW5uZXRoLmZlbmdAYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IEhh
d2tpbmcgWmhhbmcgPEhhd2tpbmcuWmhhbmdAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogQWxleCBE
ZXVjaGVyIDxhbGV4YW5kZXIuZGV1Y2hlckBhbWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9kcG0uYyAgICAgICB8IDIwICsrKysrKysrKysrKysrKysrKysKIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcG0uaCAgICAgICB8ICA3ICsrKy0tLS0K
IGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nZnguYyAgICAgICB8ICA0ICsrKy0K
IC4uLi9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvaW5jL2FtZGdwdV9zbXUuaCAgICB8ICA1ICsrKyst
CiBkcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjExXzAuYyAgICAgfCAxNiArKysr
KysrKysrKysrKysKIDUgZmlsZXMgY2hhbmdlZCwgNDYgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHBt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHBtLmMKaW5kZXggNTIzYjhh
YjZiMDRlLi5iNTM5NzEzNWM0MTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZHBtLmMKQEAgLTkyMCwzICs5MjAsMjMgQEAgaW50IGFtZGdwdV9kcG1fZ2V0X21jbGsoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGJvb2wgbG93KQogCWVsc2UKIAkJcmV0dXJuIChhZGV2KS0+
cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfbWNsaygoYWRldiktPnBvd2VycGxheS5wcF9oYW5kbGUs
IChsb3cpKTsKIH0KKworaW50IGFtZGdwdV9kcG1fc2V0X3Bvd2VyZ2F0aW5nX2J5X3NtdShzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdWludDMyX3QgYmxvY2tfdHlwZSwgYm9vbCBnYXRlKQor
eworCWludCByZXQgPSAwOworCWJvb2wgc3dzbXUgPSBpc19zdXBwb3J0X3N3X3NtdShhZGV2KTsK
KworCXN3aXRjaCAoYmxvY2tfdHlwZSkgeworCWNhc2UgQU1EX0lQX0JMT0NLX1RZUEVfR0ZYOgor
CQlpZiAoc3dzbXUpCisJCQlyZXQgPSBzbXVfZ2Z4X29mZl9jb250cm9sKCZhZGV2LT5zbXUsIGdh
dGUpOworCQllbHNlCisJCQlyZXQgPSAoKGFkZXYpLT5wb3dlcnBsYXkucHBfZnVuY3MtPnNldF9w
b3dlcmdhdGluZ19ieV9zbXUoCisJCQkJKGFkZXYpLT5wb3dlcnBsYXkucHBfaGFuZGxlLCBibG9j
a190eXBlLCBnYXRlKSk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCWJyZWFrOworCX0KKworCXJl
dHVybiByZXQ7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZHBtLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHBtLmgKaW5kZXgg
NTIxZGJkMGQ5YWY4Li4xYzVjMGZkNzZkYmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9kcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZHBtLmgKQEAgLTM1NSwxMCArMzU1LDYgQEAgZW51bSBhbWRncHVfcGNpZV9nZW4gewog
CQkoKGFkZXYpLT5wb3dlcnBsYXkucHBfZnVuY3MtPnNldF9jbG9ja2dhdGluZ19ieV9zbXUoXAog
CQkJKGFkZXYpLT5wb3dlcnBsYXkucHBfaGFuZGxlLCBtc2dfaWQpKQogCi0jZGVmaW5lIGFtZGdw
dV9kcG1fc2V0X3Bvd2VyZ2F0aW5nX2J5X3NtdShhZGV2LCBibG9ja190eXBlLCBnYXRlKSBcCi0J
CSgoYWRldiktPnBvd2VycGxheS5wcF9mdW5jcy0+c2V0X3Bvd2VyZ2F0aW5nX2J5X3NtdShcCi0J
CQkoYWRldiktPnBvd2VycGxheS5wcF9oYW5kbGUsIGJsb2NrX3R5cGUsIGdhdGUpKQotCiAjZGVm
aW5lIGFtZGdwdV9kcG1fZ2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZShhZGV2LCBidWYpIFwKIAkJKChh
ZGV2KS0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfcG93ZXJfcHJvZmlsZV9tb2RlKFwKIAkJCShh
ZGV2KS0+cG93ZXJwbGF5LnBwX2hhbmRsZSwgYnVmKSkKQEAgLTUyMCw2ICs1MTYsOSBAQCBlbnVt
IGFtZGdwdV9wY2llX2dlbiBhbWRncHVfZ2V0X3BjaWVfZ2VuX3N1cHBvcnQoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsCiBzdHJ1Y3QgYW1kX3ZjZV9zdGF0ZSoKIGFtZGdwdV9nZXRfdmNlX2Ns
b2NrX3N0YXRlKHZvaWQgKmhhbmRsZSwgdTMyIGlkeCk7CiAKK2ludCBhbWRncHVfZHBtX3NldF9w
b3dlcmdhdGluZ19ieV9zbXUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJCQkJICAgICAg
dWludDMyX3QgYmxvY2tfdHlwZSwgYm9vbCBnYXRlKTsKKwogZXh0ZXJuIGludCBhbWRncHVfZHBt
X2dldF9zY2xrKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBib29sIGxvdyk7CiAKIGV4dGVy
biBpbnQgYW1kZ3B1X2RwbV9nZXRfbWNsayhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgYm9v
bCBsb3cpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dm
eC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5jCmluZGV4IDhjMmI4
NTQzZDdiZC4uNjMzZjY4NzZiMjBkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZ2Z4LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2dmeC5jCkBAIC01NDcsNyArNTQ3LDkgQEAgdm9pZCBhbWRncHVfZ2Z4X29mZl9jdHJsKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2LCBib29sIGVuYWJsZSkKIAlpZiAoIShhZGV2LT5wbS5wcF9m
ZWF0dXJlICYgUFBfR0ZYT0ZGX01BU0spKQogCQlyZXR1cm47CiAKLQlpZiAoIWFkZXYtPnBvd2Vy
cGxheS5wcF9mdW5jcyB8fCAhYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5zZXRfcG93ZXJnYXRp
bmdfYnlfc211KQorCWlmICghaXNfc3VwcG9ydF9zd19zbXUoYWRldikgJiYKKwkgICAgKCFhZGV2
LT5wb3dlcnBsYXkucHBfZnVuY3MgfHwKKwkgICAgICFhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3Mt
PnNldF9wb3dlcmdhdGluZ19ieV9zbXUpKQogCQlyZXR1cm47CiAKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvaW5jL2FtZGdwdV9zbXUuaCBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvcG93ZXJwbGF5L2luYy9hbWRncHVfc211LmgKaW5kZXggMjMzMjRiOWZiMzFiLi4y
MzM2NTk3YzA5ZTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2lu
Yy9hbWRncHVfc211LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvaW5jL2Ft
ZGdwdV9zbXUuaApAQCAtNTUzLDcgKzU1Myw3IEBAIHN0cnVjdCBzbXVfZnVuY3MKIAlpbnQgKCpz
ZXRfZmFuX3NwZWVkX3BlcmNlbnQpKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB1aW50MzJfdCBz
cGVlZCk7CiAJaW50ICgqc2V0X2Zhbl9zcGVlZF9ycG0pKHN0cnVjdCBzbXVfY29udGV4dCAqc211
LCB1aW50MzJfdCBzcGVlZCk7CiAJaW50ICgqc2V0X3hnbWlfcHN0YXRlKShzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwgdWludDMyX3QgcHN0YXRlKTsKLQorCWludCAoKmdmeF9vZmZfY29udHJvbCko
c3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGJvb2wgZW5hYmxlKTsKIH07CiAKICNkZWZpbmUgc211
X2luaXRfbWljcm9jb2RlKHNtdSkgXApAQCAtNTkyLDYgKzU5Miw5IEBAIHN0cnVjdCBzbXVfZnVu
Y3MKIAkoKHNtdSktPmZ1bmNzLT5zZXRfdG9vbF90YWJsZV9sb2NhdGlvbiA/IChzbXUpLT5mdW5j
cy0+c2V0X3Rvb2xfdGFibGVfbG9jYXRpb24oKHNtdSkpIDogMCkKICNkZWZpbmUgc211X25vdGlm
eV9tZW1vcnlfcG9vbF9sb2NhdGlvbihzbXUpIFwKIAkoKHNtdSktPmZ1bmNzLT5ub3RpZnlfbWVt
b3J5X3Bvb2xfbG9jYXRpb24gPyAoc211KS0+ZnVuY3MtPm5vdGlmeV9tZW1vcnlfcG9vbF9sb2Nh
dGlvbigoc211KSkgOiAwKQorI2RlZmluZSBzbXVfZ2Z4X29mZl9jb250cm9sKHNtdSwgZW5hYmxl
KSBcCisJKChzbXUpLT5mdW5jcy0+Z2Z4X29mZl9jb250cm9sID8gKHNtdSktPmZ1bmNzLT5nZnhf
b2ZmX2NvbnRyb2woKHNtdSksIChlbmFibGUpKSA6IDApCisKICNkZWZpbmUgc211X3dyaXRlX3dh
dGVybWFya3NfdGFibGUoc211KSBcCiAJKChzbXUpLT5mdW5jcy0+d3JpdGVfd2F0ZXJtYXJrc190
YWJsZSA/IChzbXUpLT5mdW5jcy0+d3JpdGVfd2F0ZXJtYXJrc190YWJsZSgoc211KSkgOiAwKQog
I2RlZmluZSBzbXVfc2V0X2xhc3RfZGNlZl9taW5fZGVlcF9zbGVlcF9jbGsoc211KSBcCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjExXzAuYyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTFfMC5jCmluZGV4IGE5NTJkMmEyOTdmNy4u
ZTE4NDE2NTE2OTNhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9z
bXVfdjExXzAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjExXzAu
YwpAQCAtMTU0Nyw2ICsxNTQ3LDIxIEBAIHNtdV92MTFfMF9zZXRfd2F0ZXJtYXJrc19mb3JfY2xv
Y2tfcmFuZ2VzKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBzdHJ1Y3QKIAlyZXR1cm4gcmV0Owog
fQogCitzdGF0aWMgaW50IHNtdV92MTFfMF9nZnhfb2ZmX2NvbnRyb2woc3RydWN0IHNtdV9jb250
ZXh0ICpzbXUsIGJvb2wgZW5hYmxlKQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygm
c211LT5tdXRleCk7CisJaWYgKGVuYWJsZSkKKwkJcmV0ID0gc211X3NlbmRfc21jX21zZyhzbXUs
IFNNVV9NU0dfQWxsb3dHZnhPZmYpOworCWVsc2UKKwkJcmV0ID0gc211X3NlbmRfc21jX21zZyhz
bXUsIFNNVV9NU0dfRGlzYWxsb3dHZnhPZmYpOworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7
CisKKwlyZXR1cm4gcmV0OworfQorCisKIHN0YXRpYyBpbnQgc211X3YxMV8wX2dldF9jbG9ja19y
YW5nZXMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJCQkJICAgICAgdWludDMyX3QgKmNsb2Nr
LAogCQkJCSAgICAgIFBQQ0xLX2UgY2xvY2tfc2VsZWN0LApAQCAtMTkxOSw2ICsxOTM0LDcgQEAg
c3RhdGljIGNvbnN0IHN0cnVjdCBzbXVfZnVuY3Mgc211X3YxMV8wX2Z1bmNzID0gewogCS5zZXRf
ZmFuX3NwZWVkX3BlcmNlbnQgPSBzbXVfdjExXzBfc2V0X2Zhbl9zcGVlZF9wZXJjZW50LAogCS5z
ZXRfZmFuX3NwZWVkX3JwbSA9IHNtdV92MTFfMF9zZXRfZmFuX3NwZWVkX3JwbSwKIAkuc2V0X3hn
bWlfcHN0YXRlID0gc211X3YxMV8wX3NldF94Z21pX3BzdGF0ZSwKKwkuZ2Z4X29mZl9jb250cm9s
ID0gc211X3YxMV8wX2dmeF9vZmZfY29udHJvbCwKIH07CiAKIHZvaWQgc211X3YxMV8wX3NldF9z
bXVfZnVuY3Moc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCi0tIAoyLjIwLjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBsaXN0
CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
