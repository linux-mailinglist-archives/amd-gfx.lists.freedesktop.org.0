Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6309F131455
	for <lists+amd-gfx@lfdr.de>; Mon,  6 Jan 2020 16:03:50 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D347B6E487;
	Mon,  6 Jan 2020 15:03:47 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E24656E487
 for <amd-gfx@lists.freedesktop.org>; Mon,  6 Jan 2020 15:03:46 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id b19so15236511wmj.4
 for <amd-gfx@lists.freedesktop.org>; Mon, 06 Jan 2020 07:03:46 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=cqSl5b+PkKIiQGUF8n+oS0a2n61FthJ8qge2QwPbgPM=;
 b=C5egdD4QS+WsmDD38BA9I6JedEja/eZUvvYHUAg8Ku5NiYOwHe6/xEPReZKPnQz8Lt
 W6vqUft7snCyr/CAnN73ZEnBQsloJVPdozqyzuet18yawJSYlQxTbz1F0P/bzZ6OnxtV
 OFvuh2YtOEFb6SwdMNAykjMdihd2YGSu8xe7g3xN2y8bQQ/n224aAsL8FYA7wjV+P1cn
 8szltVTnO9rOjQt+9kxgpLS2d8TvbPM+u0u7iHAsE5r23byV+oBkvfGp8VHYxj9btCG+
 hRYXMYIzmt1eQ0Q19qZSif2KK9WIxbHWXRd+EhYk8iL8CumWP3kc/ci5ms/iFmHjRC4f
 Whjg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=cqSl5b+PkKIiQGUF8n+oS0a2n61FthJ8qge2QwPbgPM=;
 b=PCDHD+RVX7ZNubiH90C/K6ecAz5uhtdjMvDp/q3QP2MVKvYs07QHC8fUIXseTLYwN5
 KcChNw2d7kNVtypQhfy60TNhZNJJ+EzgG3UPGDb1bzuhWZG7WipCn6TjJY9b8kJrihxS
 2QzhraosIuBRMgCy/x8I4e1i2a+nVUxtIEBEw5jHT2XWALAlKyaQa8Fcegv5sPTtL3Ng
 N4fj+MXa4w458yzsG8MB2+a4teoxUJ/GeXYKd+tWm1M+1jRCcFUr97BTKxYhEov1Xxhz
 NgRqRsMrOzKeX/pTE8/t79K27gOEpdgKWfLzFMsGrgO/21b8iawWvMM3gTpW01hvFFpX
 Cl/A==
X-Gm-Message-State: APjAAAVH2Ki1Hd+AYQA1TLXwvlamp40kjeJ2aGA4qaZY9qt2nivlx2eN
 bxcZnEP6n++Q7yz9RXHW0zk=
X-Google-Smtp-Source: APXvYqxGseG3PRwiUJDKFnLKo3IBxHODYYjGqfMCZ8+NsrtN7837NjNBS5bzGkYQaN0PlqUqqhjD4w==
X-Received: by 2002:a7b:c8cd:: with SMTP id f13mr33968405wml.18.1578323025459; 
 Mon, 06 Jan 2020 07:03:45 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:ece2:ff95:11ee:3e72])
 by smtp.gmail.com with ESMTPSA id b17sm70307444wrp.49.2020.01.06.07.03.44
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 06 Jan 2020 07:03:44 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: Alex.Sierra@amd.com, Philip.Yang@amd.com, Felix.Kuehling@amd.com,
 amd-gfx@lists.freedesktop.org
Subject: [PATCH 07/12] drm/amdgpu: rework job synchronization
Date: Mon,  6 Jan 2020 16:03:30 +0100
Message-Id: <20200106150335.1738-8-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200106150335.1738-1-christian.koenig@amd.com>
References: <20200106150335.1738-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

Rm9yIHVubG9ja2VkIHBhZ2UgdGFibGUgdXBkYXRlcyB3ZSBuZWVkIHRvIGJlIGFibGUKdG8gc3lu
YyB0byBmZW5jZXMgb2YgYSBzcGVjaWZpYyBWTS4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBL
w7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyAgfCAgNiArLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9jcy5jICAgICAgICB8ICA4ICstLQogZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X29iamVjdC5jICAgIHwgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9zeW5jLmMgICAgICB8IDQ5ICsrKysrKysrKysrKy0tLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmggICAgICB8IDE1ICsrKystLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jICAgICAgIHwgIDcgKy0tCiBkcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdXZkLmMgICAgICAgfCAgMyArLQogZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYyAgIHwgIDIgKy0KIDggZmlsZXMgY2hh
bmdlZCwgNTkgaW5zZXJ0aW9ucygrKSwgMzQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCmluZGV4IGQ4ZGI1ZWNkZjlj
MS4uOWU3ODg5YzI4ZjNlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfYW1ka2ZkX2dwdXZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2FtZGtmZF9ncHV2bS5jCkBAIC04NDgsOSArODQ4LDkgQEAgc3RhdGljIGludCBwcm9jZXNz
X3N5bmNfcGRzX3Jlc3Yoc3RydWN0IGFtZGtmZF9wcm9jZXNzX2luZm8gKnByb2Nlc3NfaW5mbywK
IAkJCSAgICB2bV9saXN0X25vZGUpIHsKIAkJc3RydWN0IGFtZGdwdV9ibyAqcGQgPSBwZWVyX3Zt
LT5yb290LmJhc2UuYm87CiAKLQkJcmV0ID0gYW1kZ3B1X3N5bmNfcmVzdihOVUxMLAotCQkJCQlz
eW5jLCBwZC0+dGJvLmJhc2UucmVzdiwKLQkJCQkJQU1ER1BVX0ZFTkNFX09XTkVSX0tGRCwgZmFs
c2UpOworCQlyZXQgPSBhbWRncHVfc3luY19yZXN2KE5VTEwsIHN5bmMsIHBkLT50Ym8uYmFzZS5y
ZXN2LAorCQkJCSAgICAgICBBTURHUFVfU1lOQ19ORV9PV05FUiwKKwkJCQkgICAgICAgQU1ER1BV
X0ZFTkNFX09XTkVSX0tGRCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMKaW5kZXggY2Y3OWYzMGMwYWY2Li5kN2I1ZWZh
YTA5MWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCkBAIC02NjIsMTAg
KzY2MiwxMiBAQCBzdGF0aWMgaW50IGFtZGdwdV9jc19zeW5jX3JpbmdzKHN0cnVjdCBhbWRncHVf
Y3NfcGFyc2VyICpwKQogCWxpc3RfZm9yX2VhY2hfZW50cnkoZSwgJnAtPnZhbGlkYXRlZCwgdHYu
aGVhZCkgewogCQlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IHR0bV90b19hbWRncHVfYm8oZS0+dHYu
Ym8pOwogCQlzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKKwkJZW51
bSBhbWRncHVfc3luY19tb2RlIHN5bmNfbW9kZTsKIAotCQlyID0gYW1kZ3B1X3N5bmNfcmVzdihw
LT5hZGV2LCAmcC0+am9iLT5zeW5jLCByZXN2LCAmZnByaXYtPnZtLAotCQkJCSAgICAgYW1kZ3B1
X2JvX2V4cGxpY2l0X3N5bmMoYm8pKTsKLQorCQlzeW5jX21vZGUgPSBhbWRncHVfYm9fZXhwbGlj
aXRfc3luYyhibykgPworCQkJQU1ER1BVX1NZTkNfRVhQTElDSVQgOiBBTURHUFVfU1lOQ19ORV9P
V05FUjsKKwkJciA9IGFtZGdwdV9zeW5jX3Jlc3YocC0+YWRldiwgJnAtPmpvYi0+c3luYywgcmVz
diwgc3luY19tb2RlLAorCQkJCSAgICAgJmZwcml2LT52bSk7CiAJCWlmIChyKQogCQkJcmV0dXJu
IHI7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29i
amVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCmluZGV4
IGNhOWY3NDU4NTg5MC4uNDZjNzZlMmUxMjgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X29iamVjdC5jCkBAIC0xNDE5LDcgKzE0MTksOCBAQCBpbnQgYW1kZ3B1X2JvX3N5
bmNfd2FpdChzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdm9pZCAqb3duZXIsIGJvb2wgaW50cikKIAlp
bnQgcjsKIAogCWFtZGdwdV9zeW5jX2NyZWF0ZSgmc3luYyk7Ci0JYW1kZ3B1X3N5bmNfcmVzdihh
ZGV2LCAmc3luYywgYm8tPnRiby5iYXNlLnJlc3YsIG93bmVyLCBmYWxzZSk7CisJYW1kZ3B1X3N5
bmNfcmVzdihhZGV2LCAmc3luYywgYm8tPnRiby5iYXNlLnJlc3YsCisJCQkgQU1ER1BVX1NZTkNf
TkVfT1dORVIsIG93bmVyKTsKIAlyID0gYW1kZ3B1X3N5bmNfd2FpdCgmc3luYywgaW50cik7CiAJ
YW1kZ3B1X3N5bmNfZnJlZSgmc3luYyk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfc3luYy5jCmluZGV4IGEwOWI2YjljMjdkMS4uYzEyNGY2NGU3YWFlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMKQEAgLTIwMiwxOCArMjAyLDE3IEBAIGludCBh
bWRncHVfc3luY192bV9mZW5jZShzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsIHN0cnVjdCBkbWFf
ZmVuY2UgKmZlbmNlKQogICoKICAqIEBzeW5jOiBzeW5jIG9iamVjdCB0byBhZGQgZmVuY2VzIGZy
b20gcmVzZXJ2YXRpb24gb2JqZWN0IHRvCiAgKiBAcmVzdjogcmVzZXJ2YXRpb24gb2JqZWN0IHdp
dGggZW1iZWRkZWQgZmVuY2UKLSAqIEBleHBsaWNpdF9zeW5jOiB0cnVlIGlmIHdlIHNob3VsZCBv
bmx5IHN5bmMgdG8gdGhlIGV4Y2x1c2l2ZSBmZW5jZQorICogQG1vZGU6IGhvdyBvd25lciBhZmZl
Y3RzIHdoaWNoIGZlbmNlcyB3ZSBzeW5jIHRvCisgKiBAb3duZXI6IG93bmVyIG9mIHRoZSBwbGFu
bmVkIGpvYiBzdWJtaXNzaW9uCiAgKgogICogU3luYyB0byB0aGUgZmVuY2UKICAqLwotaW50IGFt
ZGdwdV9zeW5jX3Jlc3Yoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCi0JCSAgICAgc3RydWN0
IGFtZGdwdV9zeW5jICpzeW5jLAotCQkgICAgIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwKLQkJICAg
ICB2b2lkICpvd25lciwgYm9vbCBleHBsaWNpdF9zeW5jKQoraW50IGFtZGdwdV9zeW5jX3Jlc3Yo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfc3luYyAqc3luYywKKwkJ
ICAgICBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsIGVudW0gYW1kZ3B1X3N5bmNfbW9kZSBtb2RlLAor
CQkgICAgIHZvaWQgKm93bmVyKQogewogCXN0cnVjdCBkbWFfcmVzdl9saXN0ICpmbGlzdDsKIAlz
dHJ1Y3QgZG1hX2ZlbmNlICpmOwotCXZvaWQgKmZlbmNlX293bmVyOwogCXVuc2lnbmVkIGk7CiAJ
aW50IHIgPSAwOwogCkBAIC0yMjksNiArMjI4LDggQEAgaW50IGFtZGdwdV9zeW5jX3Jlc3Yoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCXJldHVybiByOwogCiAJZm9yIChpID0gMDsgaSA8
IGZsaXN0LT5zaGFyZWRfY291bnQ7ICsraSkgeworCQl2b2lkICpmZW5jZV9vd25lcjsKKwogCQlm
ID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChmbGlzdC0+c2hhcmVkW2ldLAogCQkJCQkgICAg
ICBkbWFfcmVzdl9oZWxkKHJlc3YpKTsKIAkJLyogV2Ugb25seSB3YW50IHRvIHRyaWdnZXIgS0ZE
IGV2aWN0aW9uIGZlbmNlcyBvbgpAQCAtMjM5LDIwICsyNDAsMzQgQEAgaW50IGFtZGdwdV9zeW5j
X3Jlc3Yoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCSAgICBvd25lciAhPSBBTURHUFVf
RkVOQ0VfT1dORVJfVU5ERUZJTkVEKQogCQkJY29udGludWU7CiAKLQkJaWYgKGFtZGdwdV9zeW5j
X3NhbWVfZGV2KGFkZXYsIGYpKSB7Ci0JCQkvKiBWTSB1cGRhdGVzIG9ubHkgc3luYyB3aXRoIG1v
dmVzIGJ1dCBub3Qgd2l0aCB1c2VyCi0JCQkgKiBjb21tYW5kIHN1Ym1pc3Npb25zIG9yIEtGRCBl
dmljdGlvbnMgZmVuY2VzCi0JCQkgKi8KLQkJCWlmIChvd25lciA9PSBBTURHUFVfRkVOQ0VfT1dO
RVJfVk0gJiYKLQkJCSAgICBmZW5jZV9vd25lciAhPSBBTURHUFVfRkVOQ0VfT1dORVJfVU5ERUZJ
TkVEKQorCQkvKiBWTSB1cGRhdGVzIG9ubHkgc3luYyB3aXRoIG1vdmVzIGJ1dCBub3Qgd2l0aCB1
c2VyCisJCSAqIGNvbW1hbmQgc3VibWlzc2lvbnMgb3IgS0ZEIGV2aWN0aW9ucyBmZW5jZXMKKwkJ
ICovCisJCWlmIChmZW5jZV9vd25lciAhPSBBTURHUFVfRkVOQ0VfT1dORVJfVU5ERUZJTkVEICYm
CisJCSAgICBvd25lciA9PSBBTURHUFVfRkVOQ0VfT1dORVJfVk0pCisJCQljb250aW51ZTsKKwor
CQkvKiBJZ25vcmUgZmVuY2VzIGRlcGVuZGluZyBvbiB0aGUgc3luYyBtb2RlICovCisJCXN3aXRj
aCAobW9kZSkgeworCQljYXNlIEFNREdQVV9TWU5DX0FMV0FZUzoKKwkJCWJyZWFrOworCisJCWNh
c2UgQU1ER1BVX1NZTkNfTkVfT1dORVI6CisJCQlpZiAoYW1kZ3B1X3N5bmNfc2FtZV9kZXYoYWRl
diwgZikgJiYKKwkJCSAgICBmZW5jZV9vd25lciA9PSBvd25lcikKIAkJCQljb250aW51ZTsKKwkJ
CWJyZWFrOwogCi0JCQkvKiBJZ25vcmUgZmVuY2UgZnJvbSB0aGUgc2FtZSBvd25lciBhbmQgZXhw
bGljaXQgb25lIGFzCi0JCQkgKiBsb25nIGFzIGl0IGlzbid0IHVuZGVmaW5lZC4KLQkJCSAqLwot
CQkJaWYgKG93bmVyICE9IEFNREdQVV9GRU5DRV9PV05FUl9VTkRFRklORUQgJiYKLQkJCSAgICAo
ZmVuY2Vfb3duZXIgPT0gb3duZXIgfHwgZXhwbGljaXRfc3luYykpCisJCWNhc2UgQU1ER1BVX1NZ
TkNfRVFfT1dORVI6CisJCQlpZiAoYW1kZ3B1X3N5bmNfc2FtZV9kZXYoYWRldiwgZikgJiYKKwkJ
CSAgICBmZW5jZV9vd25lciAhPSBvd25lcikKKwkJCQljb250aW51ZTsKKwkJCWJyZWFrOworCisJ
CWNhc2UgQU1ER1BVX1NZTkNfRVhQTElDSVQ6CisJCQlpZiAob3duZXIgIT0gQU1ER1BVX0ZFTkNF
X09XTkVSX1VOREVGSU5FRCkKIAkJCQljb250aW51ZTsKKwkJCWJyZWFrOwogCQl9CiAKIAkJciA9
IGFtZGdwdV9zeW5jX2ZlbmNlKHN5bmMsIGYsIGZhbHNlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfc3luYy5oCmluZGV4IGQ2MmMyYjgxZDkyYi4uY2ZiZTU3ODhiOGI5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmgKQEAgLTMxLDYgKzMxLDEzIEBA
IHN0cnVjdCBkbWFfcmVzdjsKIHN0cnVjdCBhbWRncHVfZGV2aWNlOwogc3RydWN0IGFtZGdwdV9y
aW5nOwogCitlbnVtIGFtZGdwdV9zeW5jX21vZGUgeworCUFNREdQVV9TWU5DX0FMV0FZUywKKwlB
TURHUFVfU1lOQ19ORV9PV05FUiwKKwlBTURHUFVfU1lOQ19FUV9PV05FUiwKKwlBTURHUFVfU1lO
Q19FWFBMSUNJVAorfTsKKwogLyoKICAqIENvbnRhaW5lciBmb3IgZmVuY2VzIHVzZWQgdG8gc3lu
YyBjb21tYW5kIHN1Ym1pc3Npb25zLgogICovCkBAIC00MywxMSArNTAsOSBAQCB2b2lkIGFtZGdw
dV9zeW5jX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMpOwogaW50IGFtZGdwdV9zeW5j
X2ZlbmNlKHN0cnVjdCBhbWRncHVfc3luYyAqc3luYywgc3RydWN0IGRtYV9mZW5jZSAqZiwKIAkJ
ICAgICAgYm9vbCBleHBsaWNpdCk7CiBpbnQgYW1kZ3B1X3N5bmNfdm1fZmVuY2Uoc3RydWN0IGFt
ZGdwdV9zeW5jICpzeW5jLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7Ci1pbnQgYW1kZ3B1X3N5
bmNfcmVzdihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKLQkJICAgICBzdHJ1Y3QgYW1kZ3B1
X3N5bmMgKnN5bmMsCi0JCSAgICAgc3RydWN0IGRtYV9yZXN2ICpyZXN2LAotCQkgICAgIHZvaWQg
Km93bmVyLAotCQkgICAgIGJvb2wgZXhwbGljaXRfc3luYyk7CitpbnQgYW1kZ3B1X3N5bmNfcmVz
dihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV9zeW5jICpzeW5jLAor
CQkgICAgIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwgZW51bSBhbWRncHVfc3luY19tb2RlIG1vZGUs
CisJCSAgICAgdm9pZCAqb3duZXIpOwogc3RydWN0IGRtYV9mZW5jZSAqYW1kZ3B1X3N5bmNfcGVl
a19mZW5jZShzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsCiAJCQkJICAgICBzdHJ1Y3QgYW1kZ3B1
X3JpbmcgKnJpbmcpOwogc3RydWN0IGRtYV9mZW5jZSAqYW1kZ3B1X3N5bmNfZ2V0X2ZlbmNlKHN0
cnVjdCBhbWRncHVfc3luYyAqc3luYywKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90
dG0uYwppbmRleCA4MWY2NzY0ZjFiYTYuLjA1YWViNTUwMzlmNCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV90dG0uYwpAQCAtMjA4Niw4ICsyMDg2LDggQEAgaW50IGFtZGdwdV9j
b3B5X2J1ZmZlcihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQ2NF90IHNyY19vZmZzZXQs
CiAJfQogCWlmIChyZXN2KSB7CiAJCXIgPSBhbWRncHVfc3luY19yZXN2KGFkZXYsICZqb2ItPnN5
bmMsIHJlc3YsCi0JCQkJICAgICBBTURHUFVfRkVOQ0VfT1dORVJfVU5ERUZJTkVELAotCQkJCSAg
ICAgZmFsc2UpOworCQkJCSAgICAgQU1ER1BVX1NZTkNfQUxXQVlTLAorCQkJCSAgICAgQU1ER1BV
X0ZFTkNFX09XTkVSX1VOREVGSU5FRCk7CiAJCWlmIChyKSB7CiAJCQlEUk1fRVJST1IoInN5bmMg
ZmFpbGVkICglZCkuXG4iLCByKTsKIAkJCWdvdG8gZXJyb3JfZnJlZTsKQEAgLTIxNzEsNyArMjE3
MSw4IEBAIGludCBhbWRncHVfZmlsbF9idWZmZXIoc3RydWN0IGFtZGdwdV9ibyAqYm8sCiAKIAlp
ZiAocmVzdikgewogCQlyID0gYW1kZ3B1X3N5bmNfcmVzdihhZGV2LCAmam9iLT5zeW5jLCByZXN2
LAotCQkJCSAgICAgQU1ER1BVX0ZFTkNFX09XTkVSX1VOREVGSU5FRCwgZmFsc2UpOworCQkJCSAg
ICAgQU1ER1BVX1NZTkNfQUxXQVlTLAorCQkJCSAgICAgQU1ER1BVX0ZFTkNFX09XTkVSX1VOREVG
SU5FRCk7CiAJCWlmIChyKSB7CiAJCQlEUk1fRVJST1IoInN5bmMgZmFpbGVkICglZCkuXG4iLCBy
KTsKIAkJCWdvdG8gZXJyb3JfZnJlZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV91dmQuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91
dmQuYwppbmRleCBkNTg3ZmZlMmFmOGUuLjA5OWFkOGQ3ZmMxNSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV91dmQuYwpAQCAtMTA5OCw3ICsxMDk4LDggQEAgc3RhdGljIGludCBh
bWRncHVfdXZkX3NlbmRfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgc3RydWN0IGFtZGdw
dV9ibyAqYm8sCiAJCQlnb3RvIGVycl9mcmVlOwogCX0gZWxzZSB7CiAJCXIgPSBhbWRncHVfc3lu
Y19yZXN2KGFkZXYsICZqb2ItPnN5bmMsIGJvLT50Ym8uYmFzZS5yZXN2LAotCQkJCSAgICAgQU1E
R1BVX0ZFTkNFX09XTkVSX1VOREVGSU5FRCwgZmFsc2UpOworCQkJCSAgICAgQU1ER1BVX1NZTkNf
TkVfT1dORVIsCisJCQkJICAgICBBTURHUFVfRkVOQ0VfT1dORVJfVU5ERUZJTkVEKTsKIAkJaWYg
KHIpCiAJCQlnb3RvIGVycl9mcmVlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3ZtX3NkbWEuYwppbmRleCA0YmJkOGZmNzc4ZWEuLjNiNjEzMTdjMGYwOCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCkBAIC04MCw3ICs4MCw3IEBA
IHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX3NkbWFfcHJlcGFyZShzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0
ZV9wYXJhbXMgKnAsCiAJCXJldHVybiAwOwogCiAJcmV0dXJuIGFtZGdwdV9zeW5jX3Jlc3YocC0+
YWRldiwgJnAtPmpvYi0+c3luYywgcm9vdC0+dGJvLmJhc2UucmVzdiwKLQkJCQlvd25lciwgZmFs
c2UpOworCQkJCUFNREdQVV9TWU5DX05FX09XTkVSLCBvd25lcik7CiB9CiAKIC8qKgotLSAKMi4x
Ny4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQt
Z2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZngK
