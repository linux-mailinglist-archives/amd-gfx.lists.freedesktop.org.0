Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2D06313C61E
	for <lists+amd-gfx@lfdr.de>; Wed, 15 Jan 2020 15:34:10 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5D8F26EAB8;
	Wed, 15 Jan 2020 14:34:08 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E85D86EAB8
 for <amd-gfx@lists.freedesktop.org>; Wed, 15 Jan 2020 14:34:07 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id b6so16005917wrq.0
 for <amd-gfx@lists.freedesktop.org>; Wed, 15 Jan 2020 06:34:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=Z3w3xnhmcG4aUPPanKeZAiVxdmP0SPNGvFcoZ8LKEIQ=;
 b=ER9S7gN0Gx5/zjHpyBojy3h5/EaQCk4nIDE1lHEWgVWOrfFvEdQSo2gMyQAItBPU2P
 8wAMc+z0USEhLjQX4A0qd8tXts/zAHbBB+uU3WPKu8MVaxGdPJvBOmjKz1GF/V/5noYR
 y38CAUr8lzamLN3QR3obdCfPNjf8QvdZU7rYpKv2gqCF3EPLDkW4I2vrSFcKOuIN5Luz
 w7MP6LuedEFE40XFgUKSGF/tpdE+HT0txBiVikUYGkU+14GwvqrF3pk2bWLZGMiB6hfl
 tihTrVRtxqHWZXFzFoArrQAxuqiemeXPQfpTVyieZWh1H2J3ZPowu5d6FTzIFZCBPSbv
 8FgA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=Z3w3xnhmcG4aUPPanKeZAiVxdmP0SPNGvFcoZ8LKEIQ=;
 b=jQMwyJQmxhlWZOAeT3o1j5D4fZZ9WZRQJF4RP4EcuNQUfEgtUu8K7ARRi2vVGeOl8b
 BtrxyAMtgSc1fxFP2U8qpESnBKPJ2PuUO3DzqGW6q3hjIBAKxoH4XWynyxiXNPiaXJ+r
 yX/VN3foA7hPaXubuCCr98flRb0lVYt+FEBwIKsmBIiJl+fUpWunzc9Ed3pcWbk1tXHE
 5t5YLKegSBDAlUrJexZ4h0/MTS7bZZT/nu2BFFNMZTrL+s02hSrXxPCneoEJF4wJ8L11
 gkseyrbKlfiBXiEbyRwwwNAYH1pqAhaMkmSdloCZHsETu3tDAWZj5gHp81tNYAIXCOYr
 h4Uw==
X-Gm-Message-State: APjAAAURgYoELyP5KLvkDXbdpj2Lyut1yQHpb8WNrCMKohd1wa+vh8uJ
 2E6AHV8FRt51HiaEiHAvG9Q=
X-Google-Smtp-Source: APXvYqwoscjzsiWghyVgGPF/Y/QtGuuLXyQOj/4BOoCnPUCUmBfzbzpVFy5khsAJw8Esl/qa7kTvjA==
X-Received: by 2002:adf:fa43:: with SMTP id y3mr7798824wrr.65.1579098846012;
 Wed, 15 Jan 2020 06:34:06 -0800 (PST)
Received: from baker.fritz.box ([2a02:908:1252:fb60:8c34:ccc1:ec64:e717])
 by smtp.gmail.com with ESMTPSA id q3sm25711830wrn.33.2020.01.15.06.34.05
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Wed, 15 Jan 2020 06:34:05 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: tom.stdenis@amd.com,
	amd-gfx@lists.freedesktop.org
Subject: [PATCH] drm/amdgpu: revert "rework synchronization of VM updates v2"
Date: Wed, 15 Jan 2020 15:34:04 +0100
Message-Id: <20200115143404.3989-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.14.1
MIME-Version: 1.0
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhpcyByZXZlcnRzIGNvbW1pdCA3NWEwZDNmNWU0YThkYzcwYzIyODQyZWMxZmRlMjg2NmYyN2Y0
OGI5LgoKSXQncyBjYXVzaW5nIFZNIHBhZ2UgZmF1bHRzLCByZXZlcnQgdW50aWwgZnVydGhlciBp
bnZlc3RpZ2F0ZWQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4u
a29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29i
amVjdC5jICB8IDM3ICsrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuaCAgfCAgMyAtLS0KIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMgICAgfCAgNyArKysrKysKIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV92bS5jICAgICAgfCAzOCArKysrKysrKysrKystLS0tLS0tLS0tLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmggICAgICB8ICA0ICst
LQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX2NwdS5jICB8IDIyICsrKysr
KysrKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5j
IHwgMTUgKysrKysrKysrLS0tCiA3IGZpbGVzIGNoYW5nZWQsIDYxIGluc2VydGlvbnMoKyksIDY1
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3Qu
YwppbmRleCBjNzBiYmRkYTA3OGMuLjQ2Yzc2ZTJlMTI4MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwpAQCAtMTQwMyw0OSArMTQwMywyOCBAQCB2b2lkIGFt
ZGdwdV9ib19mZW5jZShzdHJ1Y3QgYW1kZ3B1X2JvICpibywgc3RydWN0IGRtYV9mZW5jZSAqZmVu
Y2UsCiB9CiAKIC8qKgotICogYW1kZ3B1X2JvX3N5bmNfd2FpdF9yZXN2IC0gV2FpdCBmb3IgQk8g
cmVzZXJ2YXRpb24gZmVuY2VzCisgKiBhbWRncHVfc3luY193YWl0X3Jlc3YgLSBXYWl0IGZvciBC
TyByZXNlcnZhdGlvbiBmZW5jZXMKICAqCi0gKiBAYWRldjogYW1kZ3B1IGRldmljZSBwb2ludGVy
Ci0gKiBAcmVzdjogcmVzZXJ2YXRpb24gb2JqZWN0IHRvIHN5bmMgdG8KLSAqIEBzeW5jX21vZGU6
IHN5bmNocm9uaXphdGlvbiBtb2RlCisgKiBAYm86IGJ1ZmZlciBvYmplY3QKICAqIEBvd25lcjog
ZmVuY2Ugb3duZXIKICAqIEBpbnRyOiBXaGV0aGVyIHRoZSB3YWl0IGlzIGludGVycnVwdGlibGUK
ICAqCi0gKiBFeHRyYWN0IHRoZSBmZW5jZXMgZnJvbSB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0IGFu
ZCB3YWl0cyBmb3IgdGhlbSB0byBmaW5pc2guCi0gKgogICogUmV0dXJuczoKICAqIDAgb24gc3Vj
Y2VzcywgZXJybm8gb3RoZXJ3aXNlLgogICovCi1pbnQgYW1kZ3B1X2JvX3N5bmNfd2FpdF9yZXN2
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsCi0JCQkg
ICAgIGVudW0gYW1kZ3B1X3N5bmNfbW9kZSBzeW5jX21vZGUsIHZvaWQgKm93bmVyLAotCQkJICAg
ICBib29sIGludHIpCitpbnQgYW1kZ3B1X2JvX3N5bmNfd2FpdChzdHJ1Y3QgYW1kZ3B1X2JvICpi
bywgdm9pZCAqb3duZXIsIGJvb2wgaW50cikKIHsKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
diA9IGFtZGdwdV90dG1fYWRldihiby0+dGJvLmJkZXYpOwogCXN0cnVjdCBhbWRncHVfc3luYyBz
eW5jOwogCWludCByOwogCiAJYW1kZ3B1X3N5bmNfY3JlYXRlKCZzeW5jKTsKLQlhbWRncHVfc3lu
Y19yZXN2KGFkZXYsICZzeW5jLCByZXN2LCBzeW5jX21vZGUsIG93bmVyKTsKLQlyID0gYW1kZ3B1
X3N5bmNfd2FpdCgmc3luYywgdHJ1ZSk7CisJYW1kZ3B1X3N5bmNfcmVzdihhZGV2LCAmc3luYywg
Ym8tPnRiby5iYXNlLnJlc3YsCisJCQkgQU1ER1BVX1NZTkNfTkVfT1dORVIsIG93bmVyKTsKKwly
ID0gYW1kZ3B1X3N5bmNfd2FpdCgmc3luYywgaW50cik7CiAJYW1kZ3B1X3N5bmNfZnJlZSgmc3lu
Yyk7Ci0JcmV0dXJuIHI7Ci19CiAKLS8qKgotICogYW1kZ3B1X2JvX3N5bmNfd2FpdCAtIFdyYXBw
ZXIgZm9yIGFtZGdwdV9ib19zeW5jX3dhaXRfcmVzdgotICogQGJvOiBidWZmZXIgb2JqZWN0IHRv
IHdhaXQgZm9yCi0gKiBAb3duZXI6IGZlbmNlIG93bmVyCi0gKiBAaW50cjogV2hldGhlciB0aGUg
d2FpdCBpcyBpbnRlcnJ1cHRpYmxlCi0gKgotICogV3JhcHBlciB0byB3YWl0IGZvciBmZW5jZXMg
aW4gYSBCTy4KLSAqIFJldHVybnM6Ci0gKiAwIG9uIHN1Y2Nlc3MsIGVycm5vIG90aGVyd2lzZS4K
LSAqLwotaW50IGFtZGdwdV9ib19zeW5jX3dhaXQoc3RydWN0IGFtZGdwdV9ibyAqYm8sIHZvaWQg
Km93bmVyLCBib29sIGludHIpCi17Ci0Jc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBhbWRn
cHVfdHRtX2FkZXYoYm8tPnRiby5iZGV2KTsKLQotCXJldHVybiBhbWRncHVfYm9fc3luY193YWl0
X3Jlc3YoYWRldiwgYm8tPnRiby5iYXNlLnJlc3YsCi0JCQkJCUFNREdQVV9TWU5DX05FX09XTkVS
LCBvd25lciwgaW50cik7CisJcmV0dXJuIHI7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oCmluZGV4IDk2ZDgwNTg4OWU4ZC4uMmVlYWZjNzdjOWMx
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oCkBAIC0yODMs
OSArMjgzLDYgQEAgdm9pZCBhbWRncHVfYm9fcmVsZWFzZV9ub3RpZnkoc3RydWN0IHR0bV9idWZm
ZXJfb2JqZWN0ICpibyk7CiBpbnQgYW1kZ3B1X2JvX2ZhdWx0X3Jlc2VydmVfbm90aWZ5KHN0cnVj
dCB0dG1fYnVmZmVyX29iamVjdCAqYm8pOwogdm9pZCBhbWRncHVfYm9fZmVuY2Uoc3RydWN0IGFt
ZGdwdV9ibyAqYm8sIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAogCQkgICAgIGJvb2wgc2hhcmVk
KTsKLWludCBhbWRncHVfYm9fc3luY193YWl0X3Jlc3Yoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwKLQkJCSAgICAgZW51bSBhbWRncHVfc3luY19tb2Rl
IHN5bmNfbW9kZSwgdm9pZCAqb3duZXIsCi0JCQkgICAgIGJvb2wgaW50cik7CiBpbnQgYW1kZ3B1
X2JvX3N5bmNfd2FpdChzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdm9pZCAqb3duZXIsIGJvb2wgaW50
cik7CiB1NjQgYW1kZ3B1X2JvX2dwdV9vZmZzZXQoc3RydWN0IGFtZGdwdV9ibyAqYm8pOwogaW50
IGFtZGdwdV9ib192YWxpZGF0ZShzdHJ1Y3QgYW1kZ3B1X2JvICpibyk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3N5bmMuYwppbmRleCA1ODE2ZGY5Zjg1MzEuLmMxMjRmNjRlN2Fh
ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3N5bmMuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5jCkBAIC0yNDAsNiAr
MjQwLDEzIEBAIGludCBhbWRncHVfc3luY19yZXN2KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
LCBzdHJ1Y3QgYW1kZ3B1X3N5bmMgKnN5bmMsCiAJCSAgICBvd25lciAhPSBBTURHUFVfRkVOQ0Vf
T1dORVJfVU5ERUZJTkVEKQogCQkJY29udGludWU7CiAKKwkJLyogVk0gdXBkYXRlcyBvbmx5IHN5
bmMgd2l0aCBtb3ZlcyBidXQgbm90IHdpdGggdXNlcgorCQkgKiBjb21tYW5kIHN1Ym1pc3Npb25z
IG9yIEtGRCBldmljdGlvbnMgZmVuY2VzCisJCSAqLworCQlpZiAoZmVuY2Vfb3duZXIgIT0gQU1E
R1BVX0ZFTkNFX09XTkVSX1VOREVGSU5FRCAmJgorCQkgICAgb3duZXIgPT0gQU1ER1BVX0ZFTkNF
X09XTkVSX1ZNKQorCQkJY29udGludWU7CisKIAkJLyogSWdub3JlIGZlbmNlcyBkZXBlbmRpbmcg
b24gdGhlIHN5bmMgbW9kZSAqLwogCQlzd2l0Y2ggKG1vZGUpIHsKIAkJY2FzZSBBTURHUFVfU1lO
Q19BTFdBWVM6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCmluZGV4IGE3NGNh
ZmEwZTA5ZS4uNWNiMTgyMjMxZjVkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfdm0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dm0uYwpAQCAtNzk3LDcgKzc5Nyw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX2NsZWFyX2JvKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCXBhcmFtcy52bSA9IHZtOwogCXBhcmFtcy5kaXJl
Y3QgPSBkaXJlY3Q7CiAKLQlyID0gdm0tPnVwZGF0ZV9mdW5jcy0+cHJlcGFyZSgmcGFyYW1zLCBO
VUxMLCBBTURHUFVfU1lOQ19FWFBMSUNJVCk7CisJciA9IHZtLT51cGRhdGVfZnVuY3MtPnByZXBh
cmUoJnBhcmFtcywgQU1ER1BVX0ZFTkNFX09XTkVSX0tGRCwgTlVMTCk7CiAJaWYgKHIpCiAJCXJl
dHVybiByOwogCkBAIC0xMjkzLDcgKzEyOTMsNyBAQCBpbnQgYW1kZ3B1X3ZtX3VwZGF0ZV9wZGVz
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCXBhcmFtcy52bSA9IHZtOwogCXBhcmFtcy5k
aXJlY3QgPSBkaXJlY3Q7CiAKLQlyID0gdm0tPnVwZGF0ZV9mdW5jcy0+cHJlcGFyZSgmcGFyYW1z
LCBOVUxMLCBBTURHUFVfU1lOQ19FWFBMSUNJVCk7CisJciA9IHZtLT51cGRhdGVfZnVuY3MtPnBy
ZXBhcmUoJnBhcmFtcywgQU1ER1BVX0ZFTkNFX09XTkVSX1ZNLCBOVUxMKTsKIAlpZiAocikKIAkJ
cmV0dXJuIHI7CiAKQEAgLTE1MzksNyArMTUzOSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX3Vw
ZGF0ZV9wdGVzKHN0cnVjdCBhbWRncHVfdm1fdXBkYXRlX3BhcmFtcyAqcGFyYW1zLAogICogQGFk
ZXY6IGFtZGdwdV9kZXZpY2UgcG9pbnRlcgogICogQHZtOiByZXF1ZXN0ZWQgdm0KICAqIEBkaXJl
Y3Q6IGRpcmVjdCBzdWJtaXNzaW9uIGluIGEgcGFnZSBmYXVsdAotICogQHJlc3Y6IGZlbmNlcyB3
ZSBuZWVkIHRvIHN5bmMgdG8KKyAqIEBleGNsdXNpdmU6IGZlbmNlIHdlIG5lZWQgdG8gc3luYyB0
bwogICogQHN0YXJ0OiBzdGFydCBvZiBtYXBwZWQgcmFuZ2UKICAqIEBsYXN0OiBsYXN0IG1hcHBl
ZCBlbnRyeQogICogQGZsYWdzOiBmbGFncyBmb3IgdGhlIGVudHJpZXMKQEAgLTE1NTQsMTQgKzE1
NTQsMTQgQEAgc3RhdGljIGludCBhbWRncHVfdm1fdXBkYXRlX3B0ZXMoc3RydWN0IGFtZGdwdV92
bV91cGRhdGVfcGFyYW1zICpwYXJhbXMsCiAgKi8KIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX2JvX3Vw
ZGF0ZV9tYXBwaW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkJCSAgICAgICBzdHJ1
Y3QgYW1kZ3B1X3ZtICp2bSwgYm9vbCBkaXJlY3QsCi0JCQkJICAgICAgIHN0cnVjdCBkbWFfcmVz
diAqcmVzdiwKKwkJCQkgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZXhjbHVzaXZlLAogCQkJCSAg
ICAgICB1aW50NjRfdCBzdGFydCwgdWludDY0X3QgbGFzdCwKIAkJCQkgICAgICAgdWludDY0X3Qg
ZmxhZ3MsIHVpbnQ2NF90IGFkZHIsCiAJCQkJICAgICAgIGRtYV9hZGRyX3QgKnBhZ2VzX2FkZHIs
CiAJCQkJICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZSkKIHsKIAlzdHJ1Y3QgYW1kZ3B1
X3ZtX3VwZGF0ZV9wYXJhbXMgcGFyYW1zOwotCWVudW0gYW1kZ3B1X3N5bmNfbW9kZSBzeW5jX21v
ZGU7CisJdm9pZCAqb3duZXIgPSBBTURHUFVfRkVOQ0VfT1dORVJfVk07CiAJaW50IHI7CiAKIAlt
ZW1zZXQoJnBhcmFtcywgMCwgc2l6ZW9mKHBhcmFtcykpOwpAQCAtMTU3MCwxMyArMTU3MCw5IEBA
IHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0ZV9tYXBwaW5nKHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LAogCXBhcmFtcy5kaXJlY3QgPSBkaXJlY3Q7CiAJcGFyYW1zLnBhZ2VzX2FkZHIg
PSBwYWdlc19hZGRyOwogCi0JLyogSW1wbGljaXRseSBzeW5jIHRvIGNvbW1hbmQgc3VibWlzc2lv
bnMgaW4gdGhlIHNhbWUgVk0gYmVmb3JlCi0JICogdW5tYXBwaW5nLiBTeW5jIHRvIG1vdmluZyBm
ZW5jZXMgYmVmb3JlIG1hcHBpbmcuCi0JICovCisJLyogc3luYyB0byBldmVyeXRoaW5nIGV4Y2Vw
dCBldmljdGlvbiBmZW5jZXMgb24gdW5tYXBwaW5nICovCiAJaWYgKCEoZmxhZ3MgJiBBTURHUFVf
UFRFX1ZBTElEKSkKLQkJc3luY19tb2RlID0gQU1ER1BVX1NZTkNfRVFfT1dORVI7Ci0JZWxzZQot
CQlzeW5jX21vZGUgPSBBTURHUFVfU1lOQ19FWFBMSUNJVDsKKwkJb3duZXIgPSBBTURHUFVfRkVO
Q0VfT1dORVJfS0ZEOwogCiAJYW1kZ3B1X3ZtX2V2aWN0aW9uX2xvY2sodm0pOwogCWlmICh2bS0+
ZXZpY3RpbmcpIHsKQEAgLTE1ODQsNyArMTU4MCw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX2Jv
X3VwZGF0ZV9tYXBwaW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQlnb3RvIGVycm9y
X3VubG9jazsKIAl9CiAKLQlyID0gdm0tPnVwZGF0ZV9mdW5jcy0+cHJlcGFyZSgmcGFyYW1zLCBy
ZXN2LCBzeW5jX21vZGUpOworCXIgPSB2bS0+dXBkYXRlX2Z1bmNzLT5wcmVwYXJlKCZwYXJhbXMs
IG93bmVyLCBleGNsdXNpdmUpOwogCWlmIChyKQogCQlnb3RvIGVycm9yX3VubG9jazsKIApAQCAt
MTYwMyw3ICsxNTk5LDcgQEAgc3RhdGljIGludCBhbWRncHVfdm1fYm9fdXBkYXRlX21hcHBpbmco
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAgKiBhbWRncHVfdm1fYm9fc3BsaXRfbWFwcGlu
ZyAtIHNwbGl0IGEgbWFwcGluZyBpbnRvIHNtYWxsZXIgY2h1bmtzCiAgKgogICogQGFkZXY6IGFt
ZGdwdV9kZXZpY2UgcG9pbnRlcgotICogQHJlc3Y6IGZlbmNlcyB3ZSBuZWVkIHRvIHN5bmMgdG8K
KyAqIEBleGNsdXNpdmU6IGZlbmNlIHdlIG5lZWQgdG8gc3luYyB0bwogICogQHBhZ2VzX2FkZHI6
IERNQSBhZGRyZXNzZXMgdG8gdXNlIGZvciBtYXBwaW5nCiAgKiBAdm06IHJlcXVlc3RlZCB2bQog
ICogQG1hcHBpbmc6IG1hcHBlZCByYW5nZSBhbmQgZmxhZ3MgdG8gdXNlIGZvciB0aGUgdXBkYXRl
CkBAIC0xNjE5LDcgKzE2MTUsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV92bV9ib191cGRhdGVfbWFw
cGluZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKICAqIDAgZm9yIHN1Y2Nlc3MsIC1FSU5W
QUwgZm9yIGZhaWx1cmUuCiAgKi8KIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX2JvX3NwbGl0X21hcHBp
bmcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCi0JCQkJICAgICAgc3RydWN0IGRtYV9yZXN2
ICpyZXN2LAorCQkJCSAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmV4Y2x1c2l2ZSwKIAkJCQkgICAg
ICBkbWFfYWRkcl90ICpwYWdlc19hZGRyLAogCQkJCSAgICAgIHN0cnVjdCBhbWRncHVfdm0gKnZt
LAogCQkJCSAgICAgIHN0cnVjdCBhbWRncHVfYm9fdmFfbWFwcGluZyAqbWFwcGluZywKQEAgLTE2
OTUsNyArMTY5MSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX2JvX3NwbGl0X21hcHBpbmcoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCX0KIAogCQlsYXN0ID0gbWluKCh1aW50NjRfdClt
YXBwaW5nLT5sYXN0LCBzdGFydCArIG1heF9lbnRyaWVzIC0gMSk7Ci0JCXIgPSBhbWRncHVfdm1f
Ym9fdXBkYXRlX21hcHBpbmcoYWRldiwgdm0sIGZhbHNlLCByZXN2LAorCQlyID0gYW1kZ3B1X3Zt
X2JvX3VwZGF0ZV9tYXBwaW5nKGFkZXYsIHZtLCBmYWxzZSwgZXhjbHVzaXZlLAogCQkJCQkJc3Rh
cnQsIGxhc3QsIGZsYWdzLCBhZGRyLAogCQkJCQkJZG1hX2FkZHIsIGZlbmNlKTsKIAkJaWYgKHIp
CkBAIC0xNzM0LDggKzE3MzAsNyBAQCBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0ZShzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV9ib192YSAqYm9fdmEsCiAJZG1hX2FkZHJf
dCAqcGFnZXNfYWRkciA9IE5VTEw7CiAJc3RydWN0IHR0bV9tZW1fcmVnICptZW07CiAJc3RydWN0
IGRybV9tbV9ub2RlICpub2RlczsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICoqbGFzdF91cGRhdGU7Ci0J
c3RydWN0IGRtYV9yZXN2ICpyZXN2OworCXN0cnVjdCBkbWFfZmVuY2UgKmV4Y2x1c2l2ZSwgKips
YXN0X3VwZGF0ZTsKIAl1aW50NjRfdCBmbGFnczsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYm9f
YWRldiA9IGFkZXY7CiAJaW50IHI7CkBAIC0xNzQzLDYgKzE3MzgsNyBAQCBpbnQgYW1kZ3B1X3Zt
X2JvX3VwZGF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV9ib192
YSAqYm9fdmEsCiAJaWYgKGNsZWFyIHx8ICFibykgewogCQltZW0gPSBOVUxMOwogCQlub2RlcyA9
IE5VTEw7CisJCWV4Y2x1c2l2ZSA9IE5VTEw7CiAJfSBlbHNlIHsKIAkJc3RydWN0IHR0bV9kbWFf
dHQgKnR0bTsKIApAQCAtMTc1Miw2ICsxNzQ4LDcgQEAgaW50IGFtZGdwdV92bV9ib191cGRhdGUo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfYm9fdmEgKmJvX3ZhLAog
CQkJdHRtID0gY29udGFpbmVyX29mKGJvLT50Ym8udHRtLCBzdHJ1Y3QgdHRtX2RtYV90dCwgdHRt
KTsKIAkJCXBhZ2VzX2FkZHIgPSB0dG0tPmRtYV9hZGRyZXNzOwogCQl9CisJCWV4Y2x1c2l2ZSA9
IGJvLT50Ym8ubW92aW5nOwogCX0KIAogCWlmIChibykgewpAQCAtMTc2MSwxNCArMTc1OCwxMSBA
QCBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3Ry
dWN0IGFtZGdwdV9ib192YSAqYm9fdmEsCiAJCQlmbGFncyB8PSBBTURHUFVfUFRFX1RNWjsKIAog
CQlib19hZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KGJvLT50Ym8uYmRldik7Ci0JCXJlc3YgPSBiby0+
dGJvLmJhc2UucmVzdjsKIAl9IGVsc2UgewogCQlmbGFncyA9IDB4MDsKLQkJcmVzdiA9IE5VTEw7
CiAJfQogCi0JaWYgKGNsZWFyIHx8IChibyAmJiBiby0+dGJvLmJhc2UucmVzdiA9PQotCQkgICAg
ICB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KSkKKwlpZiAoY2xlYXIgfHwgKGJvICYm
IGJvLT50Ym8uYmFzZS5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpKQog
CQlsYXN0X3VwZGF0ZSA9ICZ2bS0+bGFzdF91cGRhdGU7CiAJZWxzZQogCQlsYXN0X3VwZGF0ZSA9
ICZib192YS0+bGFzdF9wdF91cGRhdGU7CkBAIC0xNzgyLDcgKzE3NzYsNyBAQCBpbnQgYW1kZ3B1
X3ZtX2JvX3VwZGF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV9i
b192YSAqYm9fdmEsCiAJfQogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShtYXBwaW5nLCAmYm9fdmEt
PmludmFsaWRzLCBsaXN0KSB7Ci0JCXIgPSBhbWRncHVfdm1fYm9fc3BsaXRfbWFwcGluZyhhZGV2
LCByZXN2LCBwYWdlc19hZGRyLCB2bSwKKwkJciA9IGFtZGdwdV92bV9ib19zcGxpdF9tYXBwaW5n
KGFkZXYsIGV4Y2x1c2l2ZSwgcGFnZXNfYWRkciwgdm0sCiAJCQkJCSAgICAgICBtYXBwaW5nLCBm
bGFncywgYm9fYWRldiwgbm9kZXMsCiAJCQkJCSAgICAgICBsYXN0X3VwZGF0ZSk7CiAJCWlmIChy
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmggYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uaAppbmRleCBiNTcwNWZjZmM5MzUu
LmMyMWEzNmJlYmMwYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3ZtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmgKQEAg
LTIzMCw4ICsyMzAsOCBAQCBzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9wYXJhbXMgewogCiBzdHJ1
Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9mdW5jcyB7CiAJaW50ICgqbWFwX3RhYmxlKShzdHJ1Y3QgYW1k
Z3B1X2JvICpibyk7Ci0JaW50ICgqcHJlcGFyZSkoc3RydWN0IGFtZGdwdV92bV91cGRhdGVfcGFy
YW1zICpwLCBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsCi0JCSAgICAgICBlbnVtIGFtZGdwdV9zeW5j
X21vZGUgc3luY19tb2RlKTsKKwlpbnQgKCpwcmVwYXJlKShzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0
ZV9wYXJhbXMgKnAsIHZvaWQgKiBvd25lciwKKwkJICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmV4
Y2x1c2l2ZSk7CiAJaW50ICgqdXBkYXRlKShzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9wYXJhbXMg
KnAsCiAJCSAgICAgIHN0cnVjdCBhbWRncHVfYm8gKmJvLCB1aW50NjRfdCBwZSwgdWludDY0X3Qg
YWRkciwKIAkJICAgICAgdW5zaWduZWQgY291bnQsIHVpbnQzMl90IGluY3IsIHVpbnQ2NF90IGZs
YWdzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9j
cHUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9jcHUuYwppbmRleCBl
Mzg1MTYzMDQwNzAuLjY4YjAxM2JlMzgzNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3ZtX2NwdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV92bV9jcHUuYwpAQCAtNDQsMTQgKzQ0LDI2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Zt
X2NwdV9tYXBfdGFibGUoc3RydWN0IGFtZGdwdV9ibyAqdGFibGUpCiAgKiBSZXR1cm5zOgogICog
TmVnYXRpdiBlcnJubywgMCBmb3Igc3VjY2Vzcy4KICAqLwotc3RhdGljIGludCBhbWRncHVfdm1f
Y3B1X3ByZXBhcmUoc3RydWN0IGFtZGdwdV92bV91cGRhdGVfcGFyYW1zICpwLAotCQkJCSBzdHJ1
Y3QgZG1hX3Jlc3YgKnJlc3YsCi0JCQkJIGVudW0gYW1kZ3B1X3N5bmNfbW9kZSBzeW5jX21vZGUp
CitzdGF0aWMgaW50IGFtZGdwdV92bV9jcHVfcHJlcGFyZShzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0
ZV9wYXJhbXMgKnAsIHZvaWQgKm93bmVyLAorCQkJCSBzdHJ1Y3QgZG1hX2ZlbmNlICpleGNsdXNp
dmUpCiB7Ci0JaWYgKCFyZXN2KQorCWludCByOworCisJLyogV2FpdCBmb3IgYW55IEJPIG1vdmUg
dG8gYmUgY29tcGxldGVkICovCisJaWYgKGV4Y2x1c2l2ZSkgeworCQlyID0gZG1hX2ZlbmNlX3dh
aXQoZXhjbHVzaXZlLCB0cnVlKTsKKwkJaWYgKHVubGlrZWx5KHIpKQorCQkJcmV0dXJuIHI7CisJ
fQorCisJLyogRG9uJ3Qgd2FpdCBmb3Igc3VibWlzc2lvbnMgZHVyaW5nIHBhZ2UgZmF1bHQgKi8K
KwlpZiAocC0+ZGlyZWN0KQogCQlyZXR1cm4gMDsKIAotCXJldHVybiBhbWRncHVfYm9fc3luY193
YWl0X3Jlc3YocC0+YWRldiwgcmVzdiwgc3luY19tb2RlLCBwLT52bSwgdHJ1ZSk7CisJLyogV2Fp
dCBmb3IgUFQgQk9zIHRvIGJlIGlkbGUuIFBUcyBzaGFyZSB0aGUgc2FtZSByZXN2LiBvYmplY3QK
KwkgKiBhcyB0aGUgcm9vdCBQRCBCTworCSAqLworCXJldHVybiBhbWRncHVfYm9fc3luY193YWl0
KHAtPnZtLT5yb290LmJhc2UuYm8sIG93bmVyLCB0cnVlKTsKIH0KIAogLyoqCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYwppbmRleCA0Y2M3ODgxZjQzOGMuLmFi
NjQ4MTc1MTc2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3ZtX3NkbWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2Rt
YS5jCkBAIC01OCw5ICs1OCw5IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX3NkbWFfbWFwX3RhYmxl
KHN0cnVjdCBhbWRncHVfYm8gKnRhYmxlKQogICogTmVnYXRpdiBlcnJubywgMCBmb3Igc3VjY2Vz
cy4KICAqLwogc3RhdGljIGludCBhbWRncHVfdm1fc2RtYV9wcmVwYXJlKHN0cnVjdCBhbWRncHVf
dm1fdXBkYXRlX3BhcmFtcyAqcCwKLQkJCQkgIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwKLQkJCQkg
IGVudW0gYW1kZ3B1X3N5bmNfbW9kZSBzeW5jX21vZGUpCisJCQkJICB2b2lkICpvd25lciwgc3Ry
dWN0IGRtYV9mZW5jZSAqZXhjbHVzaXZlKQogeworCXN0cnVjdCBhbWRncHVfYm8gKnJvb3QgPSBw
LT52bS0+cm9vdC5iYXNlLmJvOwogCXVuc2lnbmVkIGludCBuZHcgPSBBTURHUFVfVk1fU0RNQV9N
SU5fTlVNX0RXOwogCWludCByOwogCkBAIC03MCwxMCArNzAsMTcgQEAgc3RhdGljIGludCBhbWRn
cHVfdm1fc2RtYV9wcmVwYXJlKHN0cnVjdCBhbWRncHVfdm1fdXBkYXRlX3BhcmFtcyAqcCwKIAog
CXAtPm51bV9kd19sZWZ0ID0gbmR3OwogCi0JaWYgKCFyZXN2KQorCS8qIFdhaXQgZm9yIG1vdmVz
IHRvIGJlIGNvbXBsZXRlZCAqLworCXIgPSBhbWRncHVfc3luY19mZW5jZSgmcC0+am9iLT5zeW5j
LCBleGNsdXNpdmUsIGZhbHNlKTsKKwlpZiAocikKKwkJcmV0dXJuIHI7CisKKwkvKiBEb24ndCB3
YWl0IGZvciBhbnkgc3VibWlzc2lvbnMgZHVyaW5nIHBhZ2UgZmF1bHQgaGFuZGxpbmcgKi8KKwlp
ZiAocC0+ZGlyZWN0KQogCQlyZXR1cm4gMDsKIAotCXJldHVybiBhbWRncHVfc3luY19yZXN2KHAt
PmFkZXYsICZwLT5qb2ItPnN5bmMsIHJlc3YsIHN5bmNfbW9kZSwgcC0+dm0pOworCXJldHVybiBh
bWRncHVfc3luY19yZXN2KHAtPmFkZXYsICZwLT5qb2ItPnN5bmMsIHJvb3QtPnRiby5iYXNlLnJl
c3YsCisJCQkJQU1ER1BVX1NZTkNfTkVfT1dORVIsIG93bmVyKTsKIH0KIAogLyoqCi0tIAoyLjE0
LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1n
ZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeAo=
