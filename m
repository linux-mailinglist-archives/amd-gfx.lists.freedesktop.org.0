Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9A81048DE4
	for <lists+amd-gfx@lfdr.de>; Mon, 17 Jun 2019 21:17:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6E3BB8937C;
	Mon, 17 Jun 2019 19:17:44 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x843.google.com (mail-qt1-x843.google.com
 [IPv6:2607:f8b0:4864:20::843])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8D2DD89308
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 19:17:42 +0000 (UTC)
Received: by mail-qt1-x843.google.com with SMTP id w17so5769719qto.10
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 12:17:42 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=pxFRu+bsTCvhpPOJyTra7Q8NvZUcMrhdegGFvOVeB10=;
 b=KDLszCt4hQ94hdcSQBJDjw6XjXCIGMjG97wVU1Ffe7bF93WIJNPMje13i1mvApsi0W
 4YvnJ2uwz7NQmt4dKj6Dd3VfoBDXI6EZbYHCnrJ/oSmLF7k2bLouOXbkNUa+9YLKaaRX
 dDYtLMW3kYYix07PKYVW5m7wDLMwl69XHOQSWVFxIVF2Jw0Kt6j7zktB4D9azllrqIX4
 4AQXKGztkVm8UNC2jLIW/Kf1nXexsluvDHLVQq5Qdx8s5hQXtF1+EAAGD5CJlwNtb6mv
 tI/1GYY8lckUNgdo0kpQLZGsxNQCedHSgrmXnMrTIZ5cfOtPueyhHVyy3xORQenT/WG7
 wQww==
X-Gm-Message-State: APjAAAXSlVW3FHNIPyA2MEjmQFLaG2YYXQqmCsXvL6B4J3CaeT+dvEYj
 kgidU0t3sdIU6ZVtRoexAZLutmHPONE=
X-Google-Smtp-Source: APXvYqzDzQonSiunJaFWIXgSBW5cSA/hJaxj2oSWZsZF8rImTek5zLjV2K1c+mrGdYN0NTyTYSWeuA==
X-Received: by 2002:ac8:28bc:: with SMTP id i57mr64167275qti.288.1560799061483; 
 Mon, 17 Jun 2019 12:17:41 -0700 (PDT)
Received: from localhost.localdomain ([71.219.5.136])
 by smtp.gmail.com with ESMTPSA id s35sm7754876qth.79.2019.06.17.12.17.40
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 17 Jun 2019 12:17:40 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 038/459] drm/amdgpu: add helper function for gfx queue/bitmap
 transition
Date: Mon, 17 Jun 2019 14:09:59 -0500
Message-Id: <20190617191700.17899-27-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617191700.17899-1-alexander.deucher@amd.com>
References: <20190617191700.17899-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=pxFRu+bsTCvhpPOJyTra7Q8NvZUcMrhdegGFvOVeB10=;
 b=KOHTGD0kqcINFBCO1BT+FXvsWR695yrdnz6dygM10iU7rFIaKnxCnzAs8WKQLRQNoP
 kuKK5p/NrCLJ7JTsmFpSO+UfooUtxrxmplWdq4OLA80n3qsn3kmVQjhRCucyxaNr9M96
 ftmuvlJrAIIqgC/y64pC8vnEhwuXPa5X7R6YkgrEqa6Ncy5nVYiGFMr4wsor4qaR+A+9
 Vh/h5XV8mzjZAziGza78Jh3Av6Ru7R5BNNbG8JdKEAbEekhl5XM2awVyHCN/QhRbopMx
 0MCPKTGOScByA5N8TPq8HdyJi9pFxQnBHrdBhMOXhi97IBV1Dh37pMH3mY1DjJakels6
 OZ9Q==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Jack Xiao <jack.xiao@amd.com>,
 Felix Kuehling <Felix.Kuehling@amd.com>, Hawking Zhang <Hawking.Zhang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogSGF3a2luZyBaaGFuZyA8SGF3a2luZy5aaGFuZ0BhbWQuY29tPgoKU2lnbmVkLW9mZi1i
eTogSGF3a2luZyBaaGFuZyA8SGF3a2luZy5aaGFuZ0BhbWQuY29tPgpSZXZpZXdlZC1ieTogSmFj
ayBYaWFvIDxqYWNrLnhpYW9AYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IEFsZXggRGV1Y2hlciA8YWxl
eGFuZGVyLmRldWNoZXJAYW1kLmNvbT4KQWNrZWQtYnk6IEZlbGl4IEt1ZWhsaW5nIDxGZWxpeC5L
dWVobGluZ0BhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBBbGV4IERldWNoZXIgPGFsZXhhbmRlci5k
ZXVjaGVyQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Ft
ZGtmZC5jIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nZnguYyAg
ICB8IDQyICsrKysrKysrKysrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9nZnguaCAgICB8IDE0ICsrKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9nZnhfdjhfMC5jICAgICAgfCAxOCArKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9nZnhfdjlfMC5jICAgICAgfCAxOCArKysrKy0tLS0tCiA1IGZpbGVzIGNoYW5nZWQsIDY1
IGluc2VydGlvbnMoKyksIDI5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmQuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9hbWRrZmQuYwppbmRleCBiNzU4MmI5YWExY2QuLjA1NzhiZWI0Mjk3YSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmQuYwpAQCAtMTU5LDcgKzE1
OSw3IEBAIHZvaWQgYW1kZ3B1X2FtZGtmZF9kZXZpY2VfaW5pdChzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldikKIAogCQkvKiByZW1vdmUgdGhlIEtJUSBiaXQgYXMgd2VsbCAqLwogCQlpZiAoYWRl
di0+Z2Z4LmtpcS5yaW5nLnNjaGVkLnJlYWR5KQotCQkJY2xlYXJfYml0KGFtZGdwdV9nZnhfcXVl
dWVfdG9fYml0KGFkZXYsCisJCQljbGVhcl9iaXQoYW1kZ3B1X2dmeF9tZWNfcXVldWVfdG9fYml0
KGFkZXYsCiAJCQkJCQkJICBhZGV2LT5nZngua2lxLnJpbmcubWUgLSAxLAogCQkJCQkJCSAgYWRl
di0+Z2Z4LmtpcS5yaW5nLnBpcGUsCiAJCQkJCQkJICBhZGV2LT5nZngua2lxLnJpbmcucXVldWUp
LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5jCmluZGV4IDg1NWVmZjgzNGUy
YS4uODI3ZWI1M2M5NjQ5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZ2Z4LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5j
CkBAIC0zNCw4ICszNCw4IEBACiAgKiBHUFUgR0ZYIElQIGJsb2NrIGhlbHBlcnMgZnVuY3Rpb24u
CiAgKi8KIAotaW50IGFtZGdwdV9nZnhfcXVldWVfdG9fYml0KHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LCBpbnQgbWVjLAotCQkJICAgIGludCBwaXBlLCBpbnQgcXVldWUpCitpbnQgYW1kZ3B1
X2dmeF9tZWNfcXVldWVfdG9fYml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBpbnQgbWVj
LAorCQkJCWludCBwaXBlLCBpbnQgcXVldWUpCiB7CiAJaW50IGJpdCA9IDA7CiAKQEAgLTQ3LDgg
KzQ3LDggQEAgaW50IGFtZGdwdV9nZnhfcXVldWVfdG9fYml0KHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LCBpbnQgbWVjLAogCXJldHVybiBiaXQ7CiB9CiAKLXZvaWQgYW1kZ3B1X2dmeF9iaXRf
dG9fcXVldWUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGludCBiaXQsCi0JCQkgICAgIGlu
dCAqbWVjLCBpbnQgKnBpcGUsIGludCAqcXVldWUpCit2b2lkIGFtZGdwdV9nZnhfYml0X3RvX21l
Y19xdWV1ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgaW50IGJpdCwKKwkJCQkgaW50ICpt
ZWMsIGludCAqcGlwZSwgaW50ICpxdWV1ZSkKIHsKIAkqcXVldWUgPSBiaXQgJSBhZGV2LT5nZngu
bWVjLm51bV9xdWV1ZV9wZXJfcGlwZTsKIAkqcGlwZSA9IChiaXQgLyBhZGV2LT5nZngubWVjLm51
bV9xdWV1ZV9wZXJfcGlwZSkKQEAgLTYxLDEwICs2MSw0MCBAQCB2b2lkIGFtZGdwdV9nZnhfYml0
X3RvX3F1ZXVlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBpbnQgYml0LAogYm9vbCBhbWRn
cHVfZ2Z4X2lzX21lY19xdWV1ZV9lbmFibGVkKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAog
CQkJCSAgICAgaW50IG1lYywgaW50IHBpcGUsIGludCBxdWV1ZSkKIHsKLQlyZXR1cm4gdGVzdF9i
aXQoYW1kZ3B1X2dmeF9xdWV1ZV90b19iaXQoYWRldiwgbWVjLCBwaXBlLCBxdWV1ZSksCisJcmV0
dXJuIHRlc3RfYml0KGFtZGdwdV9nZnhfbWVjX3F1ZXVlX3RvX2JpdChhZGV2LCBtZWMsIHBpcGUs
IHF1ZXVlKSwKIAkJCWFkZXYtPmdmeC5tZWMucXVldWVfYml0bWFwKTsKIH0KIAoraW50IGFtZGdw
dV9nZnhfbWVfcXVldWVfdG9fYml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJICAg
ICAgIGludCBtZSwgaW50IHBpcGUsIGludCBxdWV1ZSkKK3sKKwlpbnQgYml0ID0gMDsKKworCWJp
dCArPSBtZSAqIGFkZXYtPmdmeC5tZS5udW1fcGlwZV9wZXJfbWUKKwkJKiBhZGV2LT5nZngubWUu
bnVtX3F1ZXVlX3Blcl9waXBlOworCWJpdCArPSBwaXBlICogYWRldi0+Z2Z4Lm1lLm51bV9xdWV1
ZV9wZXJfcGlwZTsKKwliaXQgKz0gcXVldWU7CisKKwlyZXR1cm4gYml0OworfQorCit2b2lkIGFt
ZGdwdV9nZnhfYml0X3RvX21lX3F1ZXVlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBpbnQg
Yml0LAorCQkJCWludCAqbWUsIGludCAqcGlwZSwgaW50ICpxdWV1ZSkKK3sKKwkqcXVldWUgPSBi
aXQgJSBhZGV2LT5nZngubWUubnVtX3F1ZXVlX3Blcl9waXBlOworCSpwaXBlID0gKGJpdCAvIGFk
ZXYtPmdmeC5tZS5udW1fcXVldWVfcGVyX3BpcGUpCisJCSUgYWRldi0+Z2Z4Lm1lLm51bV9waXBl
X3Blcl9tZTsKKwkqbWUgPSAoYml0IC8gYWRldi0+Z2Z4Lm1lLm51bV9xdWV1ZV9wZXJfcGlwZSkK
KwkJLyBhZGV2LT5nZngubWUubnVtX3BpcGVfcGVyX21lOworfQorCitib29sIGFtZGdwdV9nZnhf
aXNfbWVfcXVldWVfZW5hYmxlZChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKKwkJCQkgICAg
aW50IG1lLCBpbnQgcGlwZSwgaW50IHF1ZXVlKQoreworCXJldHVybiB0ZXN0X2JpdChhbWRncHVf
Z2Z4X21lX3F1ZXVlX3RvX2JpdChhZGV2LCBtZSwgcGlwZSwgcXVldWUpLAorCQkJYWRldi0+Z2Z4
Lm1lLnF1ZXVlX2JpdG1hcCk7Cit9CisKIC8qKgogICogYW1kZ3B1X2dmeF9zY3JhdGNoX2dldCAt
IEFsbG9jYXRlIGEgc2NyYXRjaCByZWdpc3RlcgogICoKQEAgLTIzNyw3ICsyNjcsNyBAQCBzdGF0
aWMgaW50IGFtZGdwdV9nZnhfa2lxX2FjcXVpcmUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYs
CiAJCWlmICh0ZXN0X2JpdChxdWV1ZV9iaXQsIGFkZXYtPmdmeC5tZWMucXVldWVfYml0bWFwKSkK
IAkJCWNvbnRpbnVlOwogCi0JCWFtZGdwdV9nZnhfYml0X3RvX3F1ZXVlKGFkZXYsIHF1ZXVlX2Jp
dCwgJm1lYywgJnBpcGUsICZxdWV1ZSk7CisJCWFtZGdwdV9nZnhfYml0X3RvX21lY19xdWV1ZShh
ZGV2LCBxdWV1ZV9iaXQsICZtZWMsICZwaXBlLCAmcXVldWUpOwogCiAJCS8qCiAJCSAqIDEuIFVz
aW5nIHBpcGVzIDIvMyBmcm9tIE1FQyAyIHNlZW1zIGNhdXNlIHByb2JsZW1zLgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5oIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5oCmluZGV4IDFjNWQxMmVhZTVhNi4uY2U1NDNiYjk2
OWFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2Z4LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dmeC5oCkBAIC0zMzcsMTIg
KzMzNywxOCBAQCB2b2lkIGFtZGdwdV9nZnhfY29tcHV0ZV9tcWRfc3dfZmluaShzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldik7CiB2b2lkIGFtZGdwdV9nZnhfY29tcHV0ZV9xdWV1ZV9hY3F1aXJl
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KTsKIHZvaWQgYW1kZ3B1X2dmeF9ncmFwaGljc19x
dWV1ZV9hY3F1aXJlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KTsKIAotaW50IGFtZGdwdV9n
ZnhfcXVldWVfdG9fYml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBpbnQgbWVjLAotCQkJ
ICAgIGludCBwaXBlLCBpbnQgcXVldWUpOwotdm9pZCBhbWRncHVfZ2Z4X2JpdF90b19xdWV1ZShz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgaW50IGJpdCwKLQkJCSAgICAgaW50ICptZWMsIGlu
dCAqcGlwZSwgaW50ICpxdWV1ZSk7CitpbnQgYW1kZ3B1X2dmeF9tZWNfcXVldWVfdG9fYml0KHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBpbnQgbWVjLAorCQkJCWludCBwaXBlLCBpbnQgcXVl
dWUpOwordm9pZCBhbWRncHVfZ2Z4X2JpdF90b19tZWNfcXVldWUoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsIGludCBiaXQsCisJCQkJIGludCAqbWVjLCBpbnQgKnBpcGUsIGludCAqcXVldWUp
OwogYm9vbCBhbWRncHVfZ2Z4X2lzX21lY19xdWV1ZV9lbmFibGVkKHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LCBpbnQgbWVjLAogCQkJCSAgICAgaW50IHBpcGUsIGludCBxdWV1ZSk7CitpbnQg
YW1kZ3B1X2dmeF9tZV9xdWV1ZV90b19iaXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGlu
dCBtZSwKKwkJCSAgICAgICBpbnQgcGlwZSwgaW50IHF1ZXVlKTsKK3ZvaWQgYW1kZ3B1X2dmeF9i
aXRfdG9fbWVfcXVldWUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGludCBiaXQsCisJCQkJ
aW50ICptZSwgaW50ICpwaXBlLCBpbnQgKnF1ZXVlKTsKK2Jvb2wgYW1kZ3B1X2dmeF9pc19tZV9x
dWV1ZV9lbmFibGVkKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBpbnQgbWUsCisJCQkJICAg
IGludCBwaXBlLCBpbnQgcXVldWUpOwogdm9pZCBhbWRncHVfZ2Z4X29mZl9jdHJsKHN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2LCBib29sIGVuYWJsZSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y4XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2dmeF92OF8wLmMKaW5kZXggMjU0MDBiNzA4NzIyLi4xNzNjM2QwNzBlZjUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OF8wLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y4XzAuYwpAQCAtNjIxMyw3ICs2MjEzLDcgQEAg
c3RhdGljIHZvaWQgZ2Z4X3Y4XzBfcGlwZV9yZXNlcnZlX3Jlc291cmNlcyhzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiwKIAlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKmlyaW5nOwogCiAJbXV0ZXhfbG9j
aygmYWRldi0+Z2Z4LnBpcGVfcmVzZXJ2ZV9tdXRleCk7Ci0JcGlwZSA9IGFtZGdwdV9nZnhfcXVl
dWVfdG9fYml0KGFkZXYsIHJpbmctPm1lLCByaW5nLT5waXBlLCAwKTsKKwlwaXBlID0gYW1kZ3B1
X2dmeF9tZWNfcXVldWVfdG9fYml0KGFkZXYsIHJpbmctPm1lLCByaW5nLT5waXBlLCAwKTsKIAlp
ZiAoYWNxdWlyZSkKIAkJc2V0X2JpdChwaXBlLCBhZGV2LT5nZngucGlwZV9yZXNlcnZlX2JpdG1h
cCk7CiAJZWxzZQpAQCAtNjIzMiwyMCArNjIzMiwyMCBAQCBzdGF0aWMgdm9pZCBnZnhfdjhfMF9w
aXBlX3Jlc2VydmVfcmVzb3VyY2VzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkvKiBM
b3dlciBhbGwgcGlwZXMgd2l0aG91dCBhIGN1cnJlbnQgcmVzZXJ2YXRpb24gKi8KIAkJZm9yIChp
ID0gMDsgaSA8IGFkZXYtPmdmeC5udW1fZ2Z4X3JpbmdzOyArK2kpIHsKIAkJCWlyaW5nID0gJmFk
ZXYtPmdmeC5nZnhfcmluZ1tpXTsKLQkJCXBpcGUgPSBhbWRncHVfZ2Z4X3F1ZXVlX3RvX2JpdChh
ZGV2LAotCQkJCQkJICAgICAgIGlyaW5nLT5tZSwKLQkJCQkJCSAgICAgICBpcmluZy0+cGlwZSwK
LQkJCQkJCSAgICAgICAwKTsKKwkJCXBpcGUgPSBhbWRncHVfZ2Z4X21lY19xdWV1ZV90b19iaXQo
YWRldiwKKwkJCQkJCQkgICBpcmluZy0+bWUsCisJCQkJCQkJICAgaXJpbmctPnBpcGUsCisJCQkJ
CQkJICAgMCk7CiAJCQlyZXNlcnZlID0gdGVzdF9iaXQocGlwZSwgYWRldi0+Z2Z4LnBpcGVfcmVz
ZXJ2ZV9iaXRtYXApOwogCQkJZ2Z4X3Y4XzBfcmluZ19zZXRfcGlwZV9wZXJjZW50KGlyaW5nLCBy
ZXNlcnZlKTsKIAkJfQogCiAJCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5nZngubnVtX2NvbXB1dGVf
cmluZ3M7ICsraSkgewogCQkJaXJpbmcgPSAmYWRldi0+Z2Z4LmNvbXB1dGVfcmluZ1tpXTsKLQkJ
CXBpcGUgPSBhbWRncHVfZ2Z4X3F1ZXVlX3RvX2JpdChhZGV2LAotCQkJCQkJICAgICAgIGlyaW5n
LT5tZSwKLQkJCQkJCSAgICAgICBpcmluZy0+cGlwZSwKLQkJCQkJCSAgICAgICAwKTsKKwkJCXBp
cGUgPSBhbWRncHVfZ2Z4X21lY19xdWV1ZV90b19iaXQoYWRldiwKKwkJCQkJCQkgICBpcmluZy0+
bWUsCisJCQkJCQkJICAgaXJpbmctPnBpcGUsCisJCQkJCQkJICAgMCk7CiAJCQlyZXNlcnZlID0g
dGVzdF9iaXQocGlwZSwgYWRldi0+Z2Z4LnBpcGVfcmVzZXJ2ZV9iaXRtYXApOwogCQkJZ2Z4X3Y4
XzBfcmluZ19zZXRfcGlwZV9wZXJjZW50KGlyaW5nLCByZXNlcnZlKTsKIAkJfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKaW5kZXggNGNjNjJmNzFhYWYwLi5lNzFlMDk3MGZhZWIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYwpAQCAtNDU3OCw3ICs0NTc4LDcg
QEAgc3RhdGljIHZvaWQgZ2Z4X3Y5XzBfcGlwZV9yZXNlcnZlX3Jlc291cmNlcyhzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKIAlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKmlyaW5nOwogCiAJbXV0ZXhf
bG9jaygmYWRldi0+Z2Z4LnBpcGVfcmVzZXJ2ZV9tdXRleCk7Ci0JcGlwZSA9IGFtZGdwdV9nZnhf
cXVldWVfdG9fYml0KGFkZXYsIHJpbmctPm1lLCByaW5nLT5waXBlLCAwKTsKKwlwaXBlID0gYW1k
Z3B1X2dmeF9tZWNfcXVldWVfdG9fYml0KGFkZXYsIHJpbmctPm1lLCByaW5nLT5waXBlLCAwKTsK
IAlpZiAoYWNxdWlyZSkKIAkJc2V0X2JpdChwaXBlLCBhZGV2LT5nZngucGlwZV9yZXNlcnZlX2Jp
dG1hcCk7CiAJZWxzZQpAQCAtNDU5NywyMCArNDU5NywyMCBAQCBzdGF0aWMgdm9pZCBnZnhfdjlf
MF9waXBlX3Jlc2VydmVfcmVzb3VyY2VzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkv
KiBMb3dlciBhbGwgcGlwZXMgd2l0aG91dCBhIGN1cnJlbnQgcmVzZXJ2YXRpb24gKi8KIAkJZm9y
IChpID0gMDsgaSA8IGFkZXYtPmdmeC5udW1fZ2Z4X3JpbmdzOyArK2kpIHsKIAkJCWlyaW5nID0g
JmFkZXYtPmdmeC5nZnhfcmluZ1tpXTsKLQkJCXBpcGUgPSBhbWRncHVfZ2Z4X3F1ZXVlX3RvX2Jp
dChhZGV2LAotCQkJCQkJICAgICAgIGlyaW5nLT5tZSwKLQkJCQkJCSAgICAgICBpcmluZy0+cGlw
ZSwKLQkJCQkJCSAgICAgICAwKTsKKwkJCXBpcGUgPSBhbWRncHVfZ2Z4X21lY19xdWV1ZV90b19i
aXQoYWRldiwKKwkJCQkJCQkgICBpcmluZy0+bWUsCisJCQkJCQkJICAgaXJpbmctPnBpcGUsCisJ
CQkJCQkJICAgMCk7CiAJCQlyZXNlcnZlID0gdGVzdF9iaXQocGlwZSwgYWRldi0+Z2Z4LnBpcGVf
cmVzZXJ2ZV9iaXRtYXApOwogCQkJZ2Z4X3Y5XzBfcmluZ19zZXRfcGlwZV9wZXJjZW50KGlyaW5n
LCByZXNlcnZlKTsKIAkJfQogCiAJCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5nZngubnVtX2NvbXB1
dGVfcmluZ3M7ICsraSkgewogCQkJaXJpbmcgPSAmYWRldi0+Z2Z4LmNvbXB1dGVfcmluZ1tpXTsK
LQkJCXBpcGUgPSBhbWRncHVfZ2Z4X3F1ZXVlX3RvX2JpdChhZGV2LAotCQkJCQkJICAgICAgIGly
aW5nLT5tZSwKLQkJCQkJCSAgICAgICBpcmluZy0+cGlwZSwKLQkJCQkJCSAgICAgICAwKTsKKwkJ
CXBpcGUgPSBhbWRncHVfZ2Z4X21lY19xdWV1ZV90b19iaXQoYWRldiwKKwkJCQkJCQkgICBpcmlu
Zy0+bWUsCisJCQkJCQkJICAgaXJpbmctPnBpcGUsCisJCQkJCQkJICAgMCk7CiAJCQlyZXNlcnZl
ID0gdGVzdF9iaXQocGlwZSwgYWRldi0+Z2Z4LnBpcGVfcmVzZXJ2ZV9iaXRtYXApOwogCQkJZ2Z4
X3Y5XzBfcmluZ19zZXRfcGlwZV9wZXJjZW50KGlyaW5nLCByZXNlcnZlKTsKIAkJfQotLSAKMi4y
MC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQt
Z2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
