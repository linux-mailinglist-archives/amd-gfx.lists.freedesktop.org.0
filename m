Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2707248EB8
	for <lists+amd-gfx@lfdr.de>; Mon, 17 Jun 2019 21:27:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F2D1D89907;
	Mon, 17 Jun 2019 19:27:43 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x82f.google.com (mail-qt1-x82f.google.com
 [IPv6:2607:f8b0:4864:20::82f])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3156B898C8
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 19:27:42 +0000 (UTC)
Received: by mail-qt1-x82f.google.com with SMTP id h21so12168160qtn.13
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 12:27:42 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=0TgdoBFPMpPksTMRiCm/rxKFAZXCU+9aBg1ogZ5bWcc=;
 b=fiVtrJ0ppb0z1onJFNO2VFcgryTlmLfDAHz2BMULX9ZX0XSzZxMRG/RXOmWBrKMnHd
 CDhfWIYUwc81BVABdyEjNeussKl9arjaGv7GhmYKcHteYy/wwXL79vgRI1cPMQeQdT+9
 +DAaXiiHphhNlgcYgBGtEpDVm0LgcWZ2RQ5+UxCUlU9we1gsMB6XtzQVng9XlIU06ajA
 IzUnXCS9QeaclkfJWfGQb6nlFftLjmemzauFgEA4AF9n6jFSNJdy+aiHCqdi7mmYkOqv
 CbQQQ9mUvN39hV+LxhhImDjwwqlV1B9vWBfPpCp1ZFR8Ci/1NkzZV8CYQfY2k44jFgwe
 HaNg==
X-Gm-Message-State: APjAAAU0doxh2HmIGoAxQX5S19B3CsTj6x8RHTDKCpD0C0nmKR79OjMi
 zPDbVjnOvfa5cUB4l/2RgmfG9gcl4Rk=
X-Google-Smtp-Source: APXvYqxOTuo6fix0qcmCbW+d2gOpUiuA/jo9O17nZ7DtivUnzZNdxV0KQ2jjzCUq8WsEz56eVRseqw==
X-Received: by 2002:ac8:2d19:: with SMTP id n25mr57857386qta.180.1560799660575; 
 Mon, 17 Jun 2019 12:27:40 -0700 (PDT)
Received: from localhost.localdomain ([71.219.5.136])
 by smtp.gmail.com with ESMTPSA id p37sm7715622qtc.35.2019.06.17.12.27.39
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 17 Jun 2019 12:27:40 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 128/459] drm/amdkfd: Add navi10 support to amdkfd. (v2)
Date: Mon, 17 Jun 2019 14:25:53 -0500
Message-Id: <20190617192704.18038-29-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617192704.18038-1-alexander.deucher@amd.com>
References: <20190617192704.18038-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=0TgdoBFPMpPksTMRiCm/rxKFAZXCU+9aBg1ogZ5bWcc=;
 b=Q8slhrnI9qLMvD1CS26P8FAzw1dSKVj2moQOBI+pleIBhB1shm5ZZJr27nspI89LIs
 V7/q7hQnVdpm9ckQkIPEAqYATBh5j0TvktfqImSLimAE0bsC+2kmZvg7VSS/rrMvCr+W
 3BukfwKoQrddmG0PdPVy5QC9JKUovoeg//gXeHTUIzi5idJCDA9Uqef6RKx1fuiATC1y
 zKQ7nckLqcqJdK27oEmCVDFJy8Nt27U/z56G+52TOjKlPPDapRGNWAUNWapgcZzhnTOg
 kY99IVkJUAwYSc+7LPVcYwk8EzegXx9RjVsaKrK0hUeFTHjztNeuM/3I4UgRmBtZIh46
 i1PQ==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Philip Cox <Philip.Cox@amd.com>,
 Oak Zeng <Oak.Zeng@amd.com>, Hawking Zhang <Hawking.Zhang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogUGhpbGlwIENveCA8UGhpbGlwLkNveEBhbWQuY29tPgoKS0ZEIChrZXJuZWwgZnVzaW9u
IGRyaXZlcikgaXMgdGhlIGtlcm5lbCBkcml2ZXIKZm9yIHRoZSBjb21wdXRlIGJhY2tlbmQgZm9y
IHVzZXJtb2RlIGNvbXB1dGUKc3RhY2suCgp2Mjogc3F1YXNoIGluIHVwZGF0ZXMgKEFsZXgpCgpT
aWduZWQtb2ZmLWJ5OiBPYWsgWmVuZyA8T2FrLlplbmdAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTog
UGhpbGlwIENveCA8UGhpbGlwLkNveEBhbWQuY29tPgpBY2tlZC1ieTogQWxleCBEZXVjaGVyIDxh
bGV4YW5kZXIuZGV1Y2hlckBhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBIYXdraW5nIFpoYW5nIDxI
YXdraW5nLlpoYW5nQGFtZC5jb20+ClNpZ25lZC1vZmYtYnk6IEFsZXggRGV1Y2hlciA8YWxleGFu
ZGVyLmRldWNoZXJAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9NYWtl
ZmlsZSAgICAgICAgICAgfCAgIDMgKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2Ny
YXQuYyAgICAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZp
Y2UuYyAgICAgICB8ICAyMSArLQogLi4uL2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVf
bWFuYWdlci5jIHwgIDI2ICstCiAuLi4vZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1ZV9t
YW5hZ2VyLmggfCAgIDIgKwogLi4uL2FtZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2Vy
X3YxMC5jIHwgIDg3ICsrKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2ZsYXRfbWVt
b3J5LmMgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9rZXJuZWxfcXVl
dWUuYyB8ICAgMyArCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfa2VybmVsX3F1ZXVl
LmggfCAgIDEgKwogLi4uL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfa2VybmVsX3F1ZXVlX3YxMC5j
IHwgMzQ4ICsrKysrKysrKysrKwogLi4uL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFkX21hbmFn
ZXJfdjEwLmMgIHwgNTE5ICsrKysrKysrKysrKysrKysrKwogLi4uL2dwdS9kcm0vYW1kL2FtZGtm
ZC9rZmRfcGFja2V0X21hbmFnZXIuYyAgIHwgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
a2ZkL2tmZF9wcml2LmggICAgICAgICB8ICAxMSArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRr
ZmQva2ZkX3Byb2Nlc3MuYyAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2Zk
L2tmZF90b3BvbG9neS5jICAgICB8ICAgMSArCiAxNSBmaWxlcyBjaGFuZ2VkLCAxMDE5IGluc2Vy
dGlvbnMoKyksIDEzIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1
L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlcl92MTAuYwogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9rZXJuZWxfcXVldWVfdjEw
LmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFk
X21hbmFnZXJfdjEwLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9N
YWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL01ha2VmaWxlCmluZGV4IDY5ZWM5
Njk5OGJiOS4uNDgxNTUwNjBhNTdjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGtmZC9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9NYWtlZmlsZQpA
QCAtMzYsMTYgKzM2LDE5IEBAIEFNREtGRF9GSUxFUwk6PSAkKEFNREtGRF9QQVRIKS9rZmRfbW9k
dWxlLm8gXAogCQkkKEFNREtGRF9QQVRIKS9rZmRfbXFkX21hbmFnZXJfY2lrLm8gXAogCQkkKEFN
REtGRF9QQVRIKS9rZmRfbXFkX21hbmFnZXJfdmkubyBcCiAJCSQoQU1ES0ZEX1BBVEgpL2tmZF9t
cWRfbWFuYWdlcl92OS5vIFwKKwkJJChBTURLRkRfUEFUSCkva2ZkX21xZF9tYW5hZ2VyX3YxMC5v
IFwKIAkJJChBTURLRkRfUEFUSCkva2ZkX2tlcm5lbF9xdWV1ZS5vIFwKIAkJJChBTURLRkRfUEFU
SCkva2ZkX2tlcm5lbF9xdWV1ZV9jaWsubyBcCiAJCSQoQU1ES0ZEX1BBVEgpL2tmZF9rZXJuZWxf
cXVldWVfdmkubyBcCiAJCSQoQU1ES0ZEX1BBVEgpL2tmZF9rZXJuZWxfcXVldWVfdjkubyBcCisJ
CSQoQU1ES0ZEX1BBVEgpL2tmZF9rZXJuZWxfcXVldWVfdjEwLm8gXAogCQkkKEFNREtGRF9QQVRI
KS9rZmRfcGFja2V0X21hbmFnZXIubyBcCiAJCSQoQU1ES0ZEX1BBVEgpL2tmZF9wcm9jZXNzX3F1
ZXVlX21hbmFnZXIubyBcCiAJCSQoQU1ES0ZEX1BBVEgpL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdl
ci5vIFwKIAkJJChBTURLRkRfUEFUSCkva2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2VyX2Npay5vIFwK
IAkJJChBTURLRkRfUEFUSCkva2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2VyX3ZpLm8gXAogCQkkKEFN
REtGRF9QQVRIKS9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXJfdjkubyBcCisJCSQoQU1ES0ZEX1BB
VEgpL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlcl92MTAubyBcCiAJCSQoQU1ES0ZEX1BBVEgpL2tm
ZF9pbnRlcnJ1cHQubyBcCiAJCSQoQU1ES0ZEX1BBVEgpL2tmZF9ldmVudHMubyBcCiAJCSQoQU1E
S0ZEX1BBVEgpL2Npa19ldmVudF9pbnRlcnJ1cHQubyBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGtmZC9rZmRfY3JhdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQv
a2ZkX2NyYXQuYwppbmRleCA1OWY4Y2E0Mjk3ZGIuLjc5MjM3MTQ0MjE5NSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2NyYXQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGtmZC9rZmRfY3JhdC5jCkBAIC0xMzgsNiArMTM4LDggQEAgc3RhdGljIHN0cnVj
dCBrZmRfZ3B1X2NhY2hlX2luZm8gY2Fycml6b19jYWNoZV9pbmZvW10gPSB7CiAvKiBUT0RPIC0g
Y2hlY2sgJiB1cGRhdGUgVmVnYTEwIGNhY2hlIGRldGFpbHMgKi8KICNkZWZpbmUgdmVnYTEwX2Nh
Y2hlX2luZm8gY2Fycml6b19jYWNoZV9pbmZvCiAjZGVmaW5lIHJhdmVuX2NhY2hlX2luZm8gY2Fy
cml6b19jYWNoZV9pbmZvCisvKiBUT0RPIC0gY2hlY2sgJiB1cGRhdGUgTmF2aTEwIGNhY2hlIGRl
dGFpbHMgKi8KKyNkZWZpbmUgbmF2aTEwX2NhY2hlX2luZm8gY2Fycml6b19jYWNoZV9pbmZvCiAK
IHN0YXRpYyB2b2lkIGtmZF9wb3B1bGF0ZWRfY3VfaW5mb19jcHUoc3RydWN0IGtmZF90b3BvbG9n
eV9kZXZpY2UgKmRldiwKIAkJc3RydWN0IGNyYXRfc3VidHlwZV9jb21wdXRldW5pdCAqY3UpCkBA
IC02NjYsNiArNjY4LDkgQEAgc3RhdGljIGludCBrZmRfZmlsbF9ncHVfY2FjaGVfaW5mbyhzdHJ1
Y3Qga2ZkX2RldiAqa2RldiwKIAljYXNlIENISVBfUkFWRU46CiAJCXBjYWNoZV9pbmZvID0gcmF2
ZW5fY2FjaGVfaW5mbzsKIAkJbnVtX29mX2NhY2hlX3R5cGVzID0gQVJSQVlfU0laRShyYXZlbl9j
YWNoZV9pbmZvKTsKKwljYXNlIENISVBfTkFWSTEwOgorCQlwY2FjaGVfaW5mbyA9IG5hdmkxMF9j
YWNoZV9pbmZvOworCQludW1fb2ZfY2FjaGVfdHlwZXMgPSBBUlJBWV9TSVpFKG5hdmkxMF9jYWNo
ZV9pbmZvKTsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJcmV0dXJuIC1FSU5WQUw7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlLmMKaW5kZXggZWJhYzdkN2Y5OTU2Li45NTVkNzIx
NzlkYTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2Uu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlLmMKQEAgLTMxNyw2
ICszMTcsMjIgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBrZmRfZGV2aWNlX2luZm8gdmVnYTIwX2Rl
dmljZV9pbmZvID0gewogCS5udW1fc2RtYV9xdWV1ZXNfcGVyX2VuZ2luZSA9IDgsCiB9OwogCitz
dGF0aWMgY29uc3Qgc3RydWN0IGtmZF9kZXZpY2VfaW5mbyBuYXZpMTBfZGV2aWNlX2luZm8gPSB7
CisJLmFzaWNfZmFtaWx5ID0gQ0hJUF9OQVZJMTAsCisJLm1heF9wYXNpZF9iaXRzID0gMTYsCisJ
Lm1heF9ub19vZl9ocWQgID0gMjQsCisJLmRvb3JiZWxsX3NpemUgID0gOCwKKwkuaWhfcmluZ19l
bnRyeV9zaXplID0gOCAqIHNpemVvZih1aW50MzJfdCksCisJLmV2ZW50X2ludGVycnVwdF9jbGFz
cyA9ICZldmVudF9pbnRlcnJ1cHRfY2xhc3NfdjksCisJLm51bV9vZl93YXRjaF9wb2ludHMgPSA0
LAorCS5tcWRfc2l6ZV9hbGlnbmVkID0gTVFEX1NJWkVfQUxJR05FRCwKKwkubmVlZHNfaW9tbXVf
ZGV2aWNlID0gZmFsc2UsCisJLnN1cHBvcnRzX2N3c3IgPSBmYWxzZSwKKwkubmVlZHNfcGNpX2F0
b21pY3MgPSBmYWxzZSwKKwkubnVtX3NkbWFfZW5naW5lcyA9IDIsCisJLm51bV9zZG1hX3F1ZXVl
c19wZXJfZW5naW5lID0gOCwKK307CisKIHN0cnVjdCBrZmRfZGV2aWNlaWQgewogCXVuc2lnbmVk
IHNob3J0IGRpZDsKIAljb25zdCBzdHJ1Y3Qga2ZkX2RldmljZV9pbmZvICpkZXZpY2VfaW5mbzsK
QEAgLTQzNCw3ICs0NTAsOSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGtmZF9kZXZpY2VpZCBzdXBw
b3J0ZWRfZGV2aWNlc1tdID0gewogCXsgMHg2NmEzLCAmdmVnYTIwX2RldmljZV9pbmZvIH0sCS8q
IFZlZ2EyMCAqLwogCXsgMHg2NmE0LCAmdmVnYTIwX2RldmljZV9pbmZvIH0sCS8qIFZlZ2EyMCAq
LwogCXsgMHg2NmE3LCAmdmVnYTIwX2RldmljZV9pbmZvIH0sCS8qIFZlZ2EyMCAqLwotCXsgMHg2
NmFmLCAmdmVnYTIwX2RldmljZV9pbmZvIH0JCS8qIFZlZ2EyMCAqLworCXsgMHg2NmFmLCAmdmVn
YTIwX2RldmljZV9pbmZvIH0sCS8qIFZlZ2EyMCAqLworCS8qIE5hdmkxMCAqLworCXsgMHg3MzEw
LCAmbmF2aTEwX2RldmljZV9pbmZvIH0sCS8qIE5hdmkxMCAqLwogfTsKIAogc3RhdGljIGludCBr
ZmRfZ3R0X3NhX2luaXQoc3RydWN0IGtmZF9kZXYgKmtmZCwgdW5zaWduZWQgaW50IGJ1Zl9zaXpl
LApAQCAtNTE3LDYgKzUzNSw3IEBAIHN0YXRpYyB2b2lkIGtmZF9jd3NyX2luaXQoc3RydWN0IGtm
ZF9kZXYgKmtmZCkKIAkJCWtmZC0+Y3dzcl9pc2EgPSBjd3NyX3RyYXBfZ2Z4OF9oZXg7CiAJCQlr
ZmQtPmN3c3JfaXNhX3NpemUgPSBzaXplb2YoY3dzcl90cmFwX2dmeDhfaGV4KTsKIAkJfSBlbHNl
IHsKKwkJCS8qIFRPRE86IERvIHdlIG5lZWQgYW5vdGhlciB0cmFwIGhhbmRsZXIgZm9yIG5hdmkx
MD8gKi8KIAkJCUJVSUxEX0JVR19PTihzaXplb2YoY3dzcl90cmFwX2dmeDlfaGV4KSA+IFBBR0Vf
U0laRSk7CiAJCQlrZmQtPmN3c3JfaXNhID0gY3dzcl90cmFwX2dmeDlfaGV4OwogCQkJa2ZkLT5j
d3NyX2lzYV9zaXplID0gc2l6ZW9mKGN3c3JfdHJhcF9nZng5X2hleCk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5jCmluZGV4
IDM1Mjg1OTBhZTkwYi4uNjMyZTUxMGI1Mzk2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuYwpAQCAtMTI2NCw2ICsxMjY0
LDcgQEAgc3RhdGljIGludCBtYXBfcXVldWVzX2Nwc2NoKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFu
YWdlciAqZHFtKQogCQlyZXR1cm4gMDsKIAogCXJldHZhbCA9IHBtX3NlbmRfcnVubGlzdCgmZHFt
LT5wYWNrZXRzLCAmZHFtLT5xdWV1ZXMpOworCXByX2RlYnVnKCIlcyBzZW50IHJ1bmxpc3RcbiIs
IF9fZnVuY19fKTsKIAlpZiAocmV0dmFsKSB7CiAJCXByX2VycigiZmFpbGVkIHRvIGV4ZWN1dGUg
cnVubGlzdFxuIik7CiAJCXJldHVybiByZXR2YWw7CkBAIC0xNzg1LDYgKzE3ODYsOSBAQCBzdHJ1
Y3QgZGV2aWNlX3F1ZXVlX21hbmFnZXIgKmRldmljZV9xdWV1ZV9tYW5hZ2VyX2luaXQoc3RydWN0
IGtmZF9kZXYgKmRldikKIAljYXNlIENISVBfUkFWRU46CiAJCWRldmljZV9xdWV1ZV9tYW5hZ2Vy
X2luaXRfdjkoJmRxbS0+YXNpY19vcHMpOwogCQlicmVhazsKKwljYXNlIENISVBfTkFWSTEwOgor
CQlkZXZpY2VfcXVldWVfbWFuYWdlcl9pbml0X3YxMF9uYXZpMTAoJmRxbS0+YXNpY19vcHMpOwor
CQlicmVhazsKIAlkZWZhdWx0OgogCQlXQVJOKDEsICJVbmV4cGVjdGVkIEFTSUMgZmFtaWx5ICV1
IiwKIAkJICAgICBkZXYtPmRldmljZV9pbmZvLT5hc2ljX2ZhbWlseSk7CkBAIC0xODc1LDE3ICsx
ODc5LDE3IEBAIGludCBkcW1fZGVidWdmc19ocWRzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAq
ZGF0YSkKIAlpbnQgcGlwZSwgcXVldWU7CiAJaW50IHIgPSAwOwogCi0JciA9IGRxbS0+ZGV2LT5r
ZmQya2dkLT5ocWRfZHVtcChkcW0tPmRldi0+a2dkLAotCQlLRkRfQ0lLX0hJUV9QSVBFLCBLRkRf
Q0lLX0hJUV9RVUVVRSwgJmR1bXAsICZuX3JlZ3MpOwotCWlmICghcikgewotCQlzZXFfcHJpbnRm
KG0sICIgIEhJUSBvbiBNRUMgJWQgUGlwZSAlZCBRdWV1ZSAlZFxuIiwKLQkJCQlLRkRfQ0lLX0hJ
UV9QSVBFL2dldF9waXBlc19wZXJfbWVjKGRxbSkrMSwKLQkJCQlLRkRfQ0lLX0hJUV9QSVBFJWdl
dF9waXBlc19wZXJfbWVjKGRxbSksCi0JCQkJS0ZEX0NJS19ISVFfUVVFVUUpOwotCQlzZXFfcmVn
X2R1bXAobSwgZHVtcCwgbl9yZWdzKTsKLQotCQlrZnJlZShkdW1wKTsKLQl9CisgICAgICAgIHIg
PSBkcW0tPmRldi0+a2ZkMmtnZC0+aHFkX2R1bXAoZHFtLT5kZXYtPmtnZCwKKyAgICAgICAgICAg
ICAgICBLRkRfQ0lLX0hJUV9QSVBFLCBLRkRfQ0lLX0hJUV9RVUVVRSwgJmR1bXAsICZuX3JlZ3Mp
OworICAgICAgICBpZiAoIXIpIHsKKyAgICAgICAgICAgICAgICBzZXFfcHJpbnRmKG0sICIgIEhJ
USBvbiBNRUMgJWQgUGlwZSAlZCBRdWV1ZSAlZFxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgS0ZEX0NJS19ISVFfUElQRS9nZXRfcGlwZXNfcGVyX21lYyhkcW0pKzEsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtGRF9DSUtfSElRX1BJUEUlZ2V0X3BpcGVzX3Bl
cl9tZWMoZHFtKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS0ZEX0NJS19ISVFf
UVVFVUUpOworICAgICAgICAgICAgICAgIHNlcV9yZWdfZHVtcChtLCBkdW1wLCBuX3JlZ3MpOwor
CisgICAgICAgICAgICAgICAga2ZyZWUoZHVtcCk7CisgICAgICAgIH0KIAogCWZvciAocGlwZSA9
IDA7IHBpcGUgPCBnZXRfcGlwZXNfcGVyX21lYyhkcW0pOyBwaXBlKyspIHsKIAkJaW50IHBpcGVf
b2Zmc2V0ID0gcGlwZSAqIGdldF9xdWV1ZXNfcGVyX3BpcGUoZHFtKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5oIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2VyLmgKaW5kZXgg
ODhiNGMwMDc2OTZlLi5mZjljZGM1ODQxMjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5oCkBAIC0yMTIsNiArMjEyLDgg
QEAgdm9pZCBkZXZpY2VfcXVldWVfbWFuYWdlcl9pbml0X3ZpX3RvbmdhKAogCQlzdHJ1Y3QgZGV2
aWNlX3F1ZXVlX21hbmFnZXJfYXNpY19vcHMgKmFzaWNfb3BzKTsKIHZvaWQgZGV2aWNlX3F1ZXVl
X21hbmFnZXJfaW5pdF92OSgKIAkJc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyX2FzaWNfb3Bz
ICphc2ljX29wcyk7Cit2b2lkIGRldmljZV9xdWV1ZV9tYW5hZ2VyX2luaXRfdjEwX25hdmkxMCgK
KwkJc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyX2FzaWNfb3BzICphc2ljX29wcyk7CiB2b2lk
IHByb2dyYW1fc2hfbWVtX3NldHRpbmdzKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFt
LAogCQkJCQlzdHJ1Y3QgcWNtX3Byb2Nlc3NfZGV2aWNlICpxcGQpOwogdW5zaWduZWQgaW50IGdl
dF9xdWV1ZXNfbnVtKHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAqZHFtKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlcl92
MTAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdl
cl92MTAuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmFkYjM4ODUw
MzY2YwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9k
ZXZpY2VfcXVldWVfbWFuYWdlcl92MTAuYwpAQCAtMCwwICsxLDg3IEBACisvKgorICogQ29weXJp
Z2h0IDIwMTggQWR2YW5jZWQgTWljcm8gRGV2aWNlcywgSW5jLgorICoKKyAqIFBlcm1pc3Npb24g
aXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmlu
ZyBhCisgKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlv
biBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0
aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICogdGhlIHJp
Z2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1
YmxpY2Vuc2UsCisgKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8g
cGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBk
byBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFi
b3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUg
aW5jbHVkZWQgaW4KKyAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhl
IFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRI
T1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisgKiBJTVBMSUVELCBJTkNMVURJ
TkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwK
KyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQu
ICBJTiBOTyBFVkVOVCBTSEFMTAorICogVEhFIENPUFlSSUdIVCBIT0xERVIoUykgT1IgQVVUSE9S
KFMpIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SCisgKiBPVEhFUiBMSUFCSUxJ
VFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwK
KyAqIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdB
UkUgT1IgVEhFIFVTRSBPUgorICogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgorICoK
KyAqLworCisjaW5jbHVkZSAia2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2VyLmgiCisjaW5jbHVkZSAi
bmF2aTEwX2VudW0uaCIKKyNpbmNsdWRlICJnYy9nY18xMF8xXzBfb2Zmc2V0LmgiCisjaW5jbHVk
ZSAiZ2MvZ2NfMTBfMV8wX3NoX21hc2suaCIKKworc3RhdGljIGludCB1cGRhdGVfcXBkX3YxMChz
dHJ1Y3QgZGV2aWNlX3F1ZXVlX21hbmFnZXIgKmRxbSwKKwkJCSBzdHJ1Y3QgcWNtX3Byb2Nlc3Nf
ZGV2aWNlICpxcGQpOworc3RhdGljIHZvaWQgaW5pdF9zZG1hX3ZtX3YxMChzdHJ1Y3QgZGV2aWNl
X3F1ZXVlX21hbmFnZXIgKmRxbSwgc3RydWN0IHF1ZXVlICpxLAorCQkJICAgIHN0cnVjdCBxY21f
cHJvY2Vzc19kZXZpY2UgKnFwZCk7CisKK3ZvaWQgZGV2aWNlX3F1ZXVlX21hbmFnZXJfaW5pdF92
MTBfbmF2aTEwKAorCXN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlcl9hc2ljX29wcyAqYXNpY19v
cHMpCit7CisJYXNpY19vcHMtPnVwZGF0ZV9xcGQgPSB1cGRhdGVfcXBkX3YxMDsKKwlhc2ljX29w
cy0+aW5pdF9zZG1hX3ZtID0gaW5pdF9zZG1hX3ZtX3YxMDsKK30KKworc3RhdGljIHVpbnQzMl90
IGNvbXB1dGVfc2hfbWVtX2Jhc2VzXzY0Yml0KHN0cnVjdCBrZmRfcHJvY2Vzc19kZXZpY2UgKnBk
ZCkKK3sKKwl1aW50MzJfdCBzaGFyZWRfYmFzZSA9IHBkZC0+bGRzX2Jhc2UgPj4gNDg7CisJdWlu
dDMyX3QgcHJpdmF0ZV9iYXNlID0gcGRkLT5zY3JhdGNoX2Jhc2UgPj4gNDg7CisKKwlyZXR1cm4g
KHNoYXJlZF9iYXNlIDw8IFNIX01FTV9CQVNFU19fU0hBUkVEX0JBU0VfX1NISUZUKSB8CisJCXBy
aXZhdGVfYmFzZTsKK30KKworc3RhdGljIGludCB1cGRhdGVfcXBkX3YxMChzdHJ1Y3QgZGV2aWNl
X3F1ZXVlX21hbmFnZXIgKmRxbSwKKwkJCSBzdHJ1Y3QgcWNtX3Byb2Nlc3NfZGV2aWNlICpxcGQp
Cit7CisJc3RydWN0IGtmZF9wcm9jZXNzX2RldmljZSAqcGRkOworCisJcGRkID0gcXBkX3RvX3Bk
ZChxcGQpOworCisJLyogY2hlY2sgaWYgc2hfbWVtX2NvbmZpZyByZWdpc3RlciBhbHJlYWR5IGNv
bmZpZ3VyZWQgKi8KKwlpZiAocXBkLT5zaF9tZW1fY29uZmlnID09IDApIHsKKwkJcXBkLT5zaF9t
ZW1fY29uZmlnID0KKwkJCQlTSF9NRU1fQUxJR05NRU5UX01PREVfVU5BTElHTkVEIDw8CisJCQkJ
CVNIX01FTV9DT05GSUdfX0FMSUdOTUVOVF9NT0RFX19TSElGVDsKKyNpZiAwCisJCS8qIFRPRE86
CisJCSAqICAgIFRoaXMgc2hvdWxkbid0IGJlIGFuIGlzc3VlIHdpdGggTmF2aTEwLiAgVmVyaWZ5
LgorCQkgKi8KKwkJaWYgKHZlZ2ExMF9ub3JldHJ5KQorCQkJcXBkLT5zaF9tZW1fY29uZmlnIHw9
CisJCQkJMSA8PCBTSF9NRU1fQ09ORklHX19SRVRSWV9ESVNBQkxFX19TSElGVDsKKyNlbmRpZgor
CisJCXFwZC0+c2hfbWVtX2FwZTFfbGltaXQgPSAwOworCQlxcGQtPnNoX21lbV9hcGUxX2Jhc2Ug
PSAwOworCX0KKworCXFwZC0+c2hfbWVtX2Jhc2VzID0gY29tcHV0ZV9zaF9tZW1fYmFzZXNfNjRi
aXQocGRkKTsKKworCXByX2RlYnVnKCJzaF9tZW1fYmFzZXMgMHglWFxuIiwgcXBkLT5zaF9tZW1f
YmFzZXMpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGluaXRfc2RtYV92bV92MTAo
c3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0sIHN0cnVjdCBxdWV1ZSAqcSwKKwkJCSAg
ICBzdHJ1Y3QgcWNtX3Byb2Nlc3NfZGV2aWNlICpxcGQpCit7CisJLyogTm90IG5lZWRlZCBvbiBT
RE1BdjQgb253YXJkcyBhbnkgbW9yZSAqLworCXEtPnByb3BlcnRpZXMuc2RtYV92bV9hZGRyID0g
MDsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9mbGF0X21l
bW9yeS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2ZsYXRfbWVtb3J5LmMKaW5k
ZXggMjJhOGU4OGI2YTY3Li42MDUyMTM2NmRkMzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1ka2ZkL2tmZF9mbGF0X21lbW9yeS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1ka2ZkL2tmZF9mbGF0X21lbW9yeS5jCkBAIC00MDUsNiArNDA1LDcgQEAgaW50IGtmZF9pbml0
X2FwZXJ0dXJlcyhzdHJ1Y3Qga2ZkX3Byb2Nlc3MgKnByb2Nlc3MpCiAJCQljYXNlIENISVBfVkVH
QTEyOgogCQkJY2FzZSBDSElQX1ZFR0EyMDoKIAkJCWNhc2UgQ0hJUF9SQVZFTjoKKwkJCWNhc2Ug
Q0hJUF9OQVZJMTA6CiAJCQkJa2ZkX2luaXRfYXBlcnR1cmVzX3Y5KHBkZCwgaWQpOwogCQkJCWJy
ZWFrOwogCQkJZGVmYXVsdDoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2Zk
L2tmZF9rZXJuZWxfcXVldWUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9rZXJu
ZWxfcXVldWUuYwppbmRleCAyMjk1MDBjOGM5NTguLjI5YzBiZDJkN2E1YyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2tlcm5lbF9xdWV1ZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9rZXJuZWxfcXVldWUuYwpAQCAtMzMyLDYgKzMzMiw5
IEBAIHN0cnVjdCBrZXJuZWxfcXVldWUgKmtlcm5lbF9xdWV1ZV9pbml0KHN0cnVjdCBrZmRfZGV2
ICpkZXYsCiAJY2FzZSBDSElQX1JBVkVOOgogCQlrZXJuZWxfcXVldWVfaW5pdF92OSgma3EtPm9w
c19hc2ljX3NwZWNpZmljKTsKIAkJYnJlYWs7CisJY2FzZSBDSElQX05BVkkxMDoKKwkJa2VybmVs
X3F1ZXVlX2luaXRfdjEwKCZrcS0+b3BzX2FzaWNfc3BlY2lmaWMpOworCQlicmVhazsKIAlkZWZh
dWx0OgogCQlXQVJOKDEsICJVbmV4cGVjdGVkIEFTSUMgZmFtaWx5ICV1IiwKIAkJICAgICBkZXYt
PmRldmljZV9pbmZvLT5hc2ljX2ZhbWlseSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGtmZC9rZmRfa2VybmVsX3F1ZXVlLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtm
ZC9rZmRfa2VybmVsX3F1ZXVlLmgKaW5kZXggYTcxMTZhOTM5MDI5Li4zNjVmYzY3NGZlYTQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9rZXJuZWxfcXVldWUuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfa2VybmVsX3F1ZXVlLmgKQEAgLTEw
Miw1ICsxMDIsNiBAQCBzdHJ1Y3Qga2VybmVsX3F1ZXVlIHsKIHZvaWQga2VybmVsX3F1ZXVlX2lu
aXRfY2lrKHN0cnVjdCBrZXJuZWxfcXVldWVfb3BzICpvcHMpOwogdm9pZCBrZXJuZWxfcXVldWVf
aW5pdF92aShzdHJ1Y3Qga2VybmVsX3F1ZXVlX29wcyAqb3BzKTsKIHZvaWQga2VybmVsX3F1ZXVl
X2luaXRfdjkoc3RydWN0IGtlcm5lbF9xdWV1ZV9vcHMgKm9wcyk7Cit2b2lkIGtlcm5lbF9xdWV1
ZV9pbml0X3YxMChzdHJ1Y3Qga2VybmVsX3F1ZXVlX29wcyAqb3BzKTsKIAogI2VuZGlmIC8qIEtG
RF9LRVJORUxfUVVFVUVfSF8gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
a2ZkL2tmZF9rZXJuZWxfcXVldWVfdjEwLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9r
ZmRfa2VybmVsX3F1ZXVlX3YxMC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uMjA5YWQ1MThmYmExCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRrZmQva2ZkX2tlcm5lbF9xdWV1ZV92MTAuYwpAQCAtMCwwICsxLDM0OCBAQAorLyoKKyAq
IENvcHlyaWdodCAyMDE4IEFkdmFuY2VkIE1pY3JvIERldmljZXMsIEluYy4KKyAqCisgKiBQZXJt
aXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBv
YnRhaW5pbmcgYQorICogY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3Vt
ZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3
YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAq
IHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmli
dXRlLCBzdWJsaWNlbnNlLAorICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwg
YW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCisgKiBTb2Z0d2FyZSBpcyBmdXJuaXNo
ZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgorICoKKyAq
IFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNo
YWxsIGJlIGluY2x1ZGVkIGluCisgKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25z
IG9mIHRoZSBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElT
IiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgorICogSU1QTElFRCwg
SU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFC
SUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklO
R0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBDT1BZUklHSFQgSE9MREVSKFMpIE9S
IEFVVEhPUihTKSBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUgorICogT1RIRVIg
TElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhF
UldJU0UsCisgKiBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhF
IFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IKKyAqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FS
RS4KKyAqCisgKi8KKworI2luY2x1ZGUgImtmZF9rZXJuZWxfcXVldWUuaCIKKyNpbmNsdWRlICJr
ZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuaCIKKyNpbmNsdWRlICJrZmRfcG00X2hlYWRlcnNfYWku
aCIKKyNpbmNsdWRlICJrZmRfcG00X29wY29kZXMuaCIKKyNpbmNsdWRlICJnYy9nY18xMF8xXzBf
c2hfbWFzay5oIgorCitzdGF0aWMgYm9vbCBpbml0aWFsaXplX3YxMChzdHJ1Y3Qga2VybmVsX3F1
ZXVlICprcSwgc3RydWN0IGtmZF9kZXYgKmRldiwKKwkJCWVudW0ga2ZkX3F1ZXVlX3R5cGUgdHlw
ZSwgdW5zaWduZWQgaW50IHF1ZXVlX3NpemUpOworc3RhdGljIHZvaWQgdW5pbml0aWFsaXplX3Yx
MChzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSk7CitzdGF0aWMgdm9pZCBzdWJtaXRfcGFja2V0X3Yx
MChzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSk7CisKK3ZvaWQga2VybmVsX3F1ZXVlX2luaXRfdjEw
KHN0cnVjdCBrZXJuZWxfcXVldWVfb3BzICpvcHMpCit7CisJb3BzLT5pbml0aWFsaXplID0gaW5p
dGlhbGl6ZV92MTA7CisJb3BzLT51bmluaXRpYWxpemUgPSB1bmluaXRpYWxpemVfdjEwOworCW9w
cy0+c3VibWl0X3BhY2tldCA9IHN1Ym1pdF9wYWNrZXRfdjEwOworfQorCitzdGF0aWMgYm9vbCBp
bml0aWFsaXplX3YxMChzdHJ1Y3Qga2VybmVsX3F1ZXVlICprcSwgc3RydWN0IGtmZF9kZXYgKmRl
diwKKwkJCWVudW0ga2ZkX3F1ZXVlX3R5cGUgdHlwZSwgdW5zaWduZWQgaW50IHF1ZXVlX3NpemUp
Cit7CisJaW50IHJldHZhbDsKKworCXJldHZhbCA9IGtmZF9ndHRfc2FfYWxsb2NhdGUoZGV2LCBQ
QUdFX1NJWkUsICZrcS0+ZW9wX21lbSk7CisJaWYgKHJldHZhbCAhPSAwKQorCQlyZXR1cm4gZmFs
c2U7CisKKwlrcS0+ZW9wX2dwdV9hZGRyID0ga3EtPmVvcF9tZW0tPmdwdV9hZGRyOworCWtxLT5l
b3Bfa2VybmVsX2FkZHIgPSBrcS0+ZW9wX21lbS0+Y3B1X3B0cjsKKworCW1lbXNldChrcS0+ZW9w
X2tlcm5lbF9hZGRyLCAwLCBQQUdFX1NJWkUpOworCisJcmV0dXJuIHRydWU7Cit9CisKK3N0YXRp
YyB2b2lkIHVuaW5pdGlhbGl6ZV92MTAoc3RydWN0IGtlcm5lbF9xdWV1ZSAqa3EpCit7CisJa2Zk
X2d0dF9zYV9mcmVlKGtxLT5kZXYsIGtxLT5lb3BfbWVtKTsKK30KKworc3RhdGljIHZvaWQgc3Vi
bWl0X3BhY2tldF92MTAoc3RydWN0IGtlcm5lbF9xdWV1ZSAqa3EpCit7CisJKmtxLT53cHRyNjRf
a2VybmVsID0ga3EtPnBlbmRpbmdfd3B0cjY0OworCXdyaXRlX2tlcm5lbF9kb29yYmVsbDY0KGtx
LT5xdWV1ZS0+cHJvcGVydGllcy5kb29yYmVsbF9wdHIsCisJCQkJa3EtPnBlbmRpbmdfd3B0cjY0
KTsKK30KKworc3RhdGljIGludCBwbV9tYXBfcHJvY2Vzc192MTAoc3RydWN0IHBhY2tldF9tYW5h
Z2VyICpwbSwKKwkJdWludDMyX3QgKmJ1ZmZlciwgc3RydWN0IHFjbV9wcm9jZXNzX2RldmljZSAq
cXBkKQoreworCXN0cnVjdCBwbTRfbWVzX21hcF9wcm9jZXNzICpwYWNrZXQ7CisJdWludDY0X3Qg
dm1fcGFnZV90YWJsZV9iYXNlX2FkZHIgPSBxcGQtPnBhZ2VfdGFibGVfYmFzZTsKKworCXBhY2tl
dCA9IChzdHJ1Y3QgcG00X21lc19tYXBfcHJvY2VzcyAqKWJ1ZmZlcjsKKwltZW1zZXQoYnVmZmVy
LCAwLCBzaXplb2Yoc3RydWN0IHBtNF9tZXNfbWFwX3Byb2Nlc3MpKTsKKworCXBhY2tldC0+aGVh
ZGVyLnUzMkFsbCA9IHBtX2J1aWxkX3BtNF9oZWFkZXIoSVRfTUFQX1BST0NFU1MsCisJCQkJCXNp
emVvZihzdHJ1Y3QgcG00X21lc19tYXBfcHJvY2VzcykpOworCXBhY2tldC0+Yml0ZmllbGRzMi5k
aXFfZW5hYmxlID0gKHFwZC0+aXNfZGVidWcpID8gMSA6IDA7CisJcGFja2V0LT5iaXRmaWVsZHMy
LnByb2Nlc3NfcXVhbnR1bSA9IDE7CisJcGFja2V0LT5iaXRmaWVsZHMyLnBhc2lkID0gcXBkLT5w
cW0tPnByb2Nlc3MtPnBhc2lkOworCXBhY2tldC0+Yml0ZmllbGRzMTQuZ2RzX3NpemUgPSBxcGQt
Pmdkc19zaXplOworCXBhY2tldC0+Yml0ZmllbGRzMTQubnVtX2d3cyA9IHFwZC0+bnVtX2d3czsK
KwlwYWNrZXQtPmJpdGZpZWxkczE0Lm51bV9vYWMgPSBxcGQtPm51bV9vYWM7CisJcGFja2V0LT5i
aXRmaWVsZHMxNC5zZG1hX2VuYWJsZSA9IDE7CisKKwlwYWNrZXQtPmJpdGZpZWxkczE0Lm51bV9x
dWV1ZXMgPSAocXBkLT5pc19kZWJ1ZykgPyAwIDogcXBkLT5xdWV1ZV9jb3VudDsKKworCXBhY2tl
dC0+c2hfbWVtX2NvbmZpZyA9IHFwZC0+c2hfbWVtX2NvbmZpZzsKKwlwYWNrZXQtPnNoX21lbV9i
YXNlcyA9IHFwZC0+c2hfbWVtX2Jhc2VzOworCWlmIChxcGQtPnRiYV9hZGRyKSB7CisJCXBhY2tl
dC0+c3Ffc2hhZGVyX3RiYV9sbyA9IGxvd2VyXzMyX2JpdHMocXBkLT50YmFfYWRkciA+PiA4KTsK
KwkJcGFja2V0LT5zcV9zaGFkZXJfdGJhX2hpID0gKDEgPDwgU1FfU0hBREVSX1RCQV9ISV9fVFJB
UF9FTl9fU0hJRlQpIHwKKwkJCXVwcGVyXzMyX2JpdHMocXBkLT50YmFfYWRkciA+PiA4KTsKKwkJ
cGFja2V0LT5zcV9zaGFkZXJfdG1hX2xvID0gbG93ZXJfMzJfYml0cyhxcGQtPnRtYV9hZGRyID4+
IDgpOworCQlwYWNrZXQtPnNxX3NoYWRlcl90bWFfaGkgPSB1cHBlcl8zMl9iaXRzKHFwZC0+dG1h
X2FkZHIgPj4gOCk7CisJfQorCisJcGFja2V0LT5nZHNfYWRkcl9sbyA9IGxvd2VyXzMyX2JpdHMo
cXBkLT5nZHNfY29udGV4dF9hcmVhKTsKKwlwYWNrZXQtPmdkc19hZGRyX2hpID0gdXBwZXJfMzJf
Yml0cyhxcGQtPmdkc19jb250ZXh0X2FyZWEpOworCisJcGFja2V0LT52bV9jb250ZXh0X3BhZ2Vf
dGFibGVfYmFzZV9hZGRyX2xvMzIgPQorCQkJbG93ZXJfMzJfYml0cyh2bV9wYWdlX3RhYmxlX2Jh
c2VfYWRkcik7CisJcGFja2V0LT52bV9jb250ZXh0X3BhZ2VfdGFibGVfYmFzZV9hZGRyX2hpMzIg
PQorCQkJdXBwZXJfMzJfYml0cyh2bV9wYWdlX3RhYmxlX2Jhc2VfYWRkcik7CisKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIGludCBwbV9ydW5saXN0X3YxMChzdHJ1Y3QgcGFja2V0X21hbmFnZXIg
KnBtLCB1aW50MzJfdCAqYnVmZmVyLAorCQkJdWludDY0X3QgaWIsIHNpemVfdCBpYl9zaXplX2lu
X2R3b3JkcywgYm9vbCBjaGFpbikKK3sKKwlzdHJ1Y3QgcG00X21lc19ydW5saXN0ICpwYWNrZXQ7
CisKKwlpbnQgY29uY3VycmVudF9wcm9jX2NudCA9IDA7CisJc3RydWN0IGtmZF9kZXYgKmtmZCA9
IHBtLT5kcW0tPmRldjsKKworCS8qIERldGVybWluZSB0aGUgbnVtYmVyIG9mIHByb2Nlc3NlcyB0
byBtYXAgdG9nZXRoZXIgdG8gSFc6CisJICogaXQgY2FuIG5vdCBleGNlZWQgdGhlIG51bWJlciBv
ZiBWTUlEcyBhdmFpbGFibGUgdG8gdGhlCisJICogc2NoZWR1bGVyLCBhbmQgaXQgaXMgZGV0ZXJt
aW5lZCBieSB0aGUgc21hbGxlciBvZiB0aGUgbnVtYmVyCisJICogb2YgcHJvY2Vzc2VzIGluIHRo
ZSBydW5saXN0IGFuZCBrZmQgbW9kdWxlIHBhcmFtZXRlcgorCSAqIGh3c19tYXhfY29uY19wcm9j
LgorCSAqIE5vdGU6IHRoZSBhcmJpdHJhdGlvbiBiZXR3ZWVuIHRoZSBudW1iZXIgb2YgVk1JRHMg
YW5kCisJICogaHdzX21heF9jb25jX3Byb2MgaGFzIGJlZW4gZG9uZSBpbgorCSAqIGtnZDJrZmRf
ZGV2aWNlX2luaXQoKS4KKwkgKi8KKwljb25jdXJyZW50X3Byb2NfY250ID0gbWluKHBtLT5kcW0t
PnByb2Nlc3Nlc19jb3VudCwKKwkJCWtmZC0+bWF4X3Byb2NfcGVyX3F1YW50dW0pOworCisKKwlw
YWNrZXQgPSAoc3RydWN0IHBtNF9tZXNfcnVubGlzdCAqKWJ1ZmZlcjsKKworCW1lbXNldChidWZm
ZXIsIDAsIHNpemVvZihzdHJ1Y3QgcG00X21lc19ydW5saXN0KSk7CisJcGFja2V0LT5oZWFkZXIu
dTMyQWxsID0gcG1fYnVpbGRfcG00X2hlYWRlcihJVF9SVU5fTElTVCwKKwkJCQkJCXNpemVvZihz
dHJ1Y3QgcG00X21lc19ydW5saXN0KSk7CisKKwlwYWNrZXQtPmJpdGZpZWxkczQuaWJfc2l6ZSA9
IGliX3NpemVfaW5fZHdvcmRzOworCXBhY2tldC0+Yml0ZmllbGRzNC5jaGFpbiA9IGNoYWluID8g
MSA6IDA7CisJcGFja2V0LT5iaXRmaWVsZHM0Lm9mZmxvYWRfcG9sbGluZyA9IDA7CisJcGFja2V0
LT5iaXRmaWVsZHM0LnZhbGlkID0gMTsKKwlwYWNrZXQtPmJpdGZpZWxkczQucHJvY2Vzc19jbnQg
PSBjb25jdXJyZW50X3Byb2NfY250OworCXBhY2tldC0+b3JkaW5hbDIgPSBsb3dlcl8zMl9iaXRz
KGliKTsKKwlwYWNrZXQtPmliX2Jhc2VfaGkgPSB1cHBlcl8zMl9iaXRzKGliKTsKKworCXJldHVy
biAwOworfQorCitzdGF0aWMgaW50IHBtX21hcF9xdWV1ZXNfdjEwKHN0cnVjdCBwYWNrZXRfbWFu
YWdlciAqcG0sIHVpbnQzMl90ICpidWZmZXIsCisJCXN0cnVjdCBxdWV1ZSAqcSwgYm9vbCBpc19z
dGF0aWMpCit7CisJc3RydWN0IHBtNF9tZXNfbWFwX3F1ZXVlcyAqcGFja2V0OworCWJvb2wgdXNl
X3N0YXRpYyA9IGlzX3N0YXRpYzsKKworCXBhY2tldCA9IChzdHJ1Y3QgcG00X21lc19tYXBfcXVl
dWVzICopYnVmZmVyOworCW1lbXNldChidWZmZXIsIDAsIHNpemVvZihzdHJ1Y3QgcG00X21lc19t
YXBfcXVldWVzKSk7CisKKwlwYWNrZXQtPmhlYWRlci51MzJBbGwgPSBwbV9idWlsZF9wbTRfaGVh
ZGVyKElUX01BUF9RVUVVRVMsCisJCQkJCXNpemVvZihzdHJ1Y3QgcG00X21lc19tYXBfcXVldWVz
KSk7CisJcGFja2V0LT5iaXRmaWVsZHMyLmFsbG9jX2Zvcm1hdCA9CisJCWFsbG9jX2Zvcm1hdF9f
bWVzX21hcF9xdWV1ZXNfX29uZV9wZXJfcGlwZV92aTsKKwlwYWNrZXQtPmJpdGZpZWxkczIubnVt
X3F1ZXVlcyA9IDE7CisJcGFja2V0LT5iaXRmaWVsZHMyLnF1ZXVlX3NlbCA9CisJCXF1ZXVlX3Nl
bF9fbWVzX21hcF9xdWV1ZXNfX21hcF90b19od3NfZGV0ZXJtaW5lZF9xdWV1ZV9zbG90c192aTsK
KworCXBhY2tldC0+Yml0ZmllbGRzMi5lbmdpbmVfc2VsID0KKwkJZW5naW5lX3NlbF9fbWVzX21h
cF9xdWV1ZXNfX2NvbXB1dGVfdmk7CisJcGFja2V0LT5iaXRmaWVsZHMyLnF1ZXVlX3R5cGUgPQor
CQlxdWV1ZV90eXBlX19tZXNfbWFwX3F1ZXVlc19fbm9ybWFsX2NvbXB1dGVfdmk7CisKKwlzd2l0
Y2ggKHEtPnByb3BlcnRpZXMudHlwZSkgeworCWNhc2UgS0ZEX1FVRVVFX1RZUEVfQ09NUFVURToK
KwkJaWYgKHVzZV9zdGF0aWMpCisJCQlwYWNrZXQtPmJpdGZpZWxkczIucXVldWVfdHlwZSA9CisJ
CXF1ZXVlX3R5cGVfX21lc19tYXBfcXVldWVzX19ub3JtYWxfbGF0ZW5jeV9zdGF0aWNfcXVldWVf
dmk7CisJCWJyZWFrOworCWNhc2UgS0ZEX1FVRVVFX1RZUEVfRElROgorCQlwYWNrZXQtPmJpdGZp
ZWxkczIucXVldWVfdHlwZSA9CisJCQlxdWV1ZV90eXBlX19tZXNfbWFwX3F1ZXVlc19fZGVidWdf
aW50ZXJmYWNlX3F1ZXVlX3ZpOworCQlicmVhazsKKwljYXNlIEtGRF9RVUVVRV9UWVBFX1NETUE6
CisJCXBhY2tldC0+Yml0ZmllbGRzMi5lbmdpbmVfc2VsID0gcS0+cHJvcGVydGllcy5zZG1hX2Vu
Z2luZV9pZCArCisJCQkJZW5naW5lX3NlbF9fbWVzX21hcF9xdWV1ZXNfX3NkbWEwX3ZpOworCQl1
c2Vfc3RhdGljID0gZmFsc2U7IC8qIG5vIHN0YXRpYyBxdWV1ZXMgdW5kZXIgU0RNQSAqLworCQli
cmVhazsKKwlkZWZhdWx0OgorCQlXQVJOKDEsICJxdWV1ZSB0eXBlICVkXG4iLCBxLT5wcm9wZXJ0
aWVzLnR5cGUpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJcGFja2V0LT5iaXRmaWVsZHMzLmRv
b3JiZWxsX29mZnNldCA9CisJCQlxLT5wcm9wZXJ0aWVzLmRvb3JiZWxsX29mZjsKKworCXBhY2tl
dC0+bXFkX2FkZHJfbG8gPQorCQkJbG93ZXJfMzJfYml0cyhxLT5nYXJ0X21xZF9hZGRyKTsKKwor
CXBhY2tldC0+bXFkX2FkZHJfaGkgPQorCQkJdXBwZXJfMzJfYml0cyhxLT5nYXJ0X21xZF9hZGRy
KTsKKworCXBhY2tldC0+d3B0cl9hZGRyX2xvID0KKwkJCWxvd2VyXzMyX2JpdHMoKHVpbnQ2NF90
KXEtPnByb3BlcnRpZXMud3JpdGVfcHRyKTsKKworCXBhY2tldC0+d3B0cl9hZGRyX2hpID0KKwkJ
CXVwcGVyXzMyX2JpdHMoKHVpbnQ2NF90KXEtPnByb3BlcnRpZXMud3JpdGVfcHRyKTsKKworCXJl
dHVybiAwOworfQorCitzdGF0aWMgaW50IHBtX3VubWFwX3F1ZXVlc192MTAoc3RydWN0IHBhY2tl
dF9tYW5hZ2VyICpwbSwgdWludDMyX3QgKmJ1ZmZlciwKKwkJCWVudW0ga2ZkX3F1ZXVlX3R5cGUg
dHlwZSwKKwkJCWVudW0ga2ZkX3VubWFwX3F1ZXVlc19maWx0ZXIgZmlsdGVyLAorCQkJdWludDMy
X3QgZmlsdGVyX3BhcmFtLCBib29sIHJlc2V0LAorCQkJdW5zaWduZWQgaW50IHNkbWFfZW5naW5l
KQoreworCXN0cnVjdCBwbTRfbWVzX3VubWFwX3F1ZXVlcyAqcGFja2V0OworCisJcGFja2V0ID0g
KHN0cnVjdCBwbTRfbWVzX3VubWFwX3F1ZXVlcyAqKWJ1ZmZlcjsKKwltZW1zZXQoYnVmZmVyLCAw
LCBzaXplb2Yoc3RydWN0IHBtNF9tZXNfdW5tYXBfcXVldWVzKSk7CisKKwlwYWNrZXQtPmhlYWRl
ci51MzJBbGwgPSBwbV9idWlsZF9wbTRfaGVhZGVyKElUX1VOTUFQX1FVRVVFUywKKwkJCQkJc2l6
ZW9mKHN0cnVjdCBwbTRfbWVzX3VubWFwX3F1ZXVlcykpOworCXN3aXRjaCAodHlwZSkgeworCWNh
c2UgS0ZEX1FVRVVFX1RZUEVfQ09NUFVURToKKwljYXNlIEtGRF9RVUVVRV9UWVBFX0RJUToKKwkJ
cGFja2V0LT5iaXRmaWVsZHMyLmVuZ2luZV9zZWwgPQorCQkJZW5naW5lX3NlbF9fbWVzX3VubWFw
X3F1ZXVlc19fY29tcHV0ZTsKKwkJYnJlYWs7CisJY2FzZSBLRkRfUVVFVUVfVFlQRV9TRE1BOgor
CQlwYWNrZXQtPmJpdGZpZWxkczIuZW5naW5lX3NlbCA9CisJCQllbmdpbmVfc2VsX19tZXNfdW5t
YXBfcXVldWVzX19zZG1hMCArIHNkbWFfZW5naW5lOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlX
QVJOKDEsICJxdWV1ZSB0eXBlICVkXG4iLCB0eXBlKTsKKwkJYnJlYWs7CisJfQorCisJaWYgKHJl
c2V0KQorCQlwYWNrZXQtPmJpdGZpZWxkczIuYWN0aW9uID0KKwkJCWFjdGlvbl9fbWVzX3VubWFw
X3F1ZXVlc19fcmVzZXRfcXVldWVzOworCWVsc2UKKwkJcGFja2V0LT5iaXRmaWVsZHMyLmFjdGlv
biA9CisJCQlhY3Rpb25fX21lc191bm1hcF9xdWV1ZXNfX3ByZWVtcHRfcXVldWVzOworCisJc3dp
dGNoIChmaWx0ZXIpIHsKKwljYXNlIEtGRF9VTk1BUF9RVUVVRVNfRklMVEVSX1NJTkdMRV9RVUVV
RToKKwkJcGFja2V0LT5iaXRmaWVsZHMyLnF1ZXVlX3NlbCA9CisJCQlxdWV1ZV9zZWxfX21lc191
bm1hcF9xdWV1ZXNfX3BlcmZvcm1fcmVxdWVzdF9vbl9zcGVjaWZpZWRfcXVldWVzOworCQlwYWNr
ZXQtPmJpdGZpZWxkczIubnVtX3F1ZXVlcyA9IDE7CisJCXBhY2tldC0+Yml0ZmllbGRzM2IuZG9v
cmJlbGxfb2Zmc2V0MCA9IGZpbHRlcl9wYXJhbTsKKwkJYnJlYWs7CisJY2FzZSBLRkRfVU5NQVBf
UVVFVUVTX0ZJTFRFUl9CWV9QQVNJRDoKKwkJcGFja2V0LT5iaXRmaWVsZHMyLnF1ZXVlX3NlbCA9
CisJCQlxdWV1ZV9zZWxfX21lc191bm1hcF9xdWV1ZXNfX3BlcmZvcm1fcmVxdWVzdF9vbl9wYXNp
ZF9xdWV1ZXM7CisJCXBhY2tldC0+Yml0ZmllbGRzM2EucGFzaWQgPSBmaWx0ZXJfcGFyYW07CisJ
CWJyZWFrOworCWNhc2UgS0ZEX1VOTUFQX1FVRVVFU19GSUxURVJfQUxMX1FVRVVFUzoKKwkJcGFj
a2V0LT5iaXRmaWVsZHMyLnF1ZXVlX3NlbCA9CisJCQlxdWV1ZV9zZWxfX21lc191bm1hcF9xdWV1
ZXNfX3VubWFwX2FsbF9xdWV1ZXM7CisJCWJyZWFrOworCWNhc2UgS0ZEX1VOTUFQX1FVRVVFU19G
SUxURVJfRFlOQU1JQ19RVUVVRVM6CisJCS8qIGluIHRoaXMgY2FzZSwgd2UgZG8gbm90IHByZWVt
cHQgc3RhdGljIHF1ZXVlcyAqLworCQlwYWNrZXQtPmJpdGZpZWxkczIucXVldWVfc2VsID0KKwkJ
CXF1ZXVlX3NlbF9fbWVzX3VubWFwX3F1ZXVlc19fdW5tYXBfYWxsX25vbl9zdGF0aWNfcXVldWVz
OworCQlicmVhazsKKwlkZWZhdWx0OgorCQlXQVJOKDEsICJmaWx0ZXIgJWRcbiIsIGZpbHRlcik7
CisJCWJyZWFrOworCX0KKworCXJldHVybiAwOworCit9CisKK3N0YXRpYyBpbnQgcG1fcXVlcnlf
c3RhdHVzX3YxMChzdHJ1Y3QgcGFja2V0X21hbmFnZXIgKnBtLCB1aW50MzJfdCAqYnVmZmVyLAor
CQkJdWludDY0X3QgZmVuY2VfYWRkcmVzcywJdWludDMyX3QgZmVuY2VfdmFsdWUpCit7CisJc3Ry
dWN0IHBtNF9tZXNfcXVlcnlfc3RhdHVzICpwYWNrZXQ7CisKKwlwYWNrZXQgPSAoc3RydWN0IHBt
NF9tZXNfcXVlcnlfc3RhdHVzICopYnVmZmVyOworCW1lbXNldChidWZmZXIsIDAsIHNpemVvZihz
dHJ1Y3QgcG00X21lc19xdWVyeV9zdGF0dXMpKTsKKworCisJcGFja2V0LT5oZWFkZXIudTMyQWxs
ID0gcG1fYnVpbGRfcG00X2hlYWRlcihJVF9RVUVSWV9TVEFUVVMsCisJCQkJCXNpemVvZihzdHJ1
Y3QgcG00X21lc19xdWVyeV9zdGF0dXMpKTsKKworCXBhY2tldC0+Yml0ZmllbGRzMi5jb250ZXh0
X2lkID0gMDsKKwlwYWNrZXQtPmJpdGZpZWxkczIuaW50ZXJydXB0X3NlbCA9CisJCQlpbnRlcnJ1
cHRfc2VsX19tZXNfcXVlcnlfc3RhdHVzX19jb21wbGV0aW9uX3N0YXR1czsKKwlwYWNrZXQtPmJp
dGZpZWxkczIuY29tbWFuZCA9CisJCQljb21tYW5kX19tZXNfcXVlcnlfc3RhdHVzX19mZW5jZV9v
bmx5X2FmdGVyX3dyaXRlX2FjazsKKworCXBhY2tldC0+YWRkcl9oaSA9IHVwcGVyXzMyX2JpdHMo
KHVpbnQ2NF90KWZlbmNlX2FkZHJlc3MpOworCXBhY2tldC0+YWRkcl9sbyA9IGxvd2VyXzMyX2Jp
dHMoKHVpbnQ2NF90KWZlbmNlX2FkZHJlc3MpOworCXBhY2tldC0+ZGF0YV9oaSA9IHVwcGVyXzMy
X2JpdHMoKHVpbnQ2NF90KWZlbmNlX3ZhbHVlKTsKKwlwYWNrZXQtPmRhdGFfbG8gPSBsb3dlcl8z
Ml9iaXRzKCh1aW50NjRfdClmZW5jZV92YWx1ZSk7CisKKwlyZXR1cm4gMDsKK30KKworCitzdGF0
aWMgaW50IHBtX3JlbGVhc2VfbWVtX3YxMCh1aW50NjRfdCBncHVfYWRkciwgdWludDMyX3QgKmJ1
ZmZlcikKK3sKKwlzdHJ1Y3QgcG00X21lY19yZWxlYXNlX21lbSAqcGFja2V0OworCisJV0FSTl9P
TighYnVmZmVyKTsKKworCXBhY2tldCA9IChzdHJ1Y3QgcG00X21lY19yZWxlYXNlX21lbSAqKWJ1
ZmZlcjsKKwltZW1zZXQoYnVmZmVyLCAwLCBzaXplb2Yoc3RydWN0IHBtNF9tZWNfcmVsZWFzZV9t
ZW0pKTsKKworCXBhY2tldC0+aGVhZGVyLnUzMkFsbCA9IHBtX2J1aWxkX3BtNF9oZWFkZXIoSVRf
UkVMRUFTRV9NRU0sCisJCQkJCXNpemVvZihzdHJ1Y3QgcG00X21lY19yZWxlYXNlX21lbSkpOwor
CisJcGFja2V0LT5iaXRmaWVsZHMyLmV2ZW50X3R5cGUgPSBDQUNIRV9GTFVTSF9BTkRfSU5WX1RT
X0VWRU5UOworCXBhY2tldC0+Yml0ZmllbGRzMi5ldmVudF9pbmRleCA9IGV2ZW50X2luZGV4X19t
ZWNfcmVsZWFzZV9tZW1fX2VuZF9vZl9waXBlOworCXBhY2tldC0+Yml0ZmllbGRzMi50Y2wxX2Fj
dGlvbl9lbmEgPSAxOworCXBhY2tldC0+Yml0ZmllbGRzMi50Y19hY3Rpb25fZW5hID0gMTsKKwlw
YWNrZXQtPmJpdGZpZWxkczIuY2FjaGVfcG9saWN5ID0gY2FjaGVfcG9saWN5X19tZWNfcmVsZWFz
ZV9tZW1fX2xydTsKKworCXBhY2tldC0+Yml0ZmllbGRzMy5kYXRhX3NlbCA9IGRhdGFfc2VsX19t
ZWNfcmVsZWFzZV9tZW1fX3NlbmRfMzJfYml0X2xvdzsKKwlwYWNrZXQtPmJpdGZpZWxkczMuaW50
X3NlbCA9CisJCWludF9zZWxfX21lY19yZWxlYXNlX21lbV9fc2VuZF9pbnRlcnJ1cHRfYWZ0ZXJf
d3JpdGVfY29uZmlybTsKKworCXBhY2tldC0+Yml0ZmllbGRzNC5hZGRyZXNzX2xvXzMyYiA9IChn
cHVfYWRkciAmIDB4ZmZmZmZmZmYpID4+IDI7CisJcGFja2V0LT5hZGRyZXNzX2hpID0gdXBwZXJf
MzJfYml0cyhncHVfYWRkcik7CisKKwlwYWNrZXQtPmRhdGFfbG8gPSAwOworCisJcmV0dXJuIHNp
emVvZihzdHJ1Y3QgcG00X21lY19yZWxlYXNlX21lbSkgLyBzaXplb2YodW5zaWduZWQgaW50KTsK
K30KKworY29uc3Qgc3RydWN0IHBhY2tldF9tYW5hZ2VyX2Z1bmNzIGtmZF92MTBfcG1fZnVuY3Mg
PSB7CisJLm1hcF9wcm9jZXNzCQkJPSBwbV9tYXBfcHJvY2Vzc192MTAsCisJLnJ1bmxpc3QJCQk9
IHBtX3J1bmxpc3RfdjEwLAorCS5zZXRfcmVzb3VyY2VzCQkJPSBwbV9zZXRfcmVzb3VyY2VzX3Zp
LAorCS5tYXBfcXVldWVzCQkJPSBwbV9tYXBfcXVldWVzX3YxMCwKKwkudW5tYXBfcXVldWVzCQkJ
PSBwbV91bm1hcF9xdWV1ZXNfdjEwLAorCS5xdWVyeV9zdGF0dXMJCQk9IHBtX3F1ZXJ5X3N0YXR1
c192MTAsCisJLnJlbGVhc2VfbWVtCQkJPSBwbV9yZWxlYXNlX21lbV92MTAsCisJLm1hcF9wcm9j
ZXNzX3NpemUJCT0gc2l6ZW9mKHN0cnVjdCBwbTRfbWVzX21hcF9wcm9jZXNzKSwKKwkucnVubGlz
dF9zaXplCQkJPSBzaXplb2Yoc3RydWN0IHBtNF9tZXNfcnVubGlzdCksCisJLnNldF9yZXNvdXJj
ZXNfc2l6ZQkJPSBzaXplb2Yoc3RydWN0IHBtNF9tZXNfc2V0X3Jlc291cmNlcyksCisJLm1hcF9x
dWV1ZXNfc2l6ZQkJPSBzaXplb2Yoc3RydWN0IHBtNF9tZXNfbWFwX3F1ZXVlcyksCisJLnVubWFw
X3F1ZXVlc19zaXplCQk9IHNpemVvZihzdHJ1Y3QgcG00X21lc191bm1hcF9xdWV1ZXMpLAorCS5x
dWVyeV9zdGF0dXNfc2l6ZQkJPSBzaXplb2Yoc3RydWN0IHBtNF9tZXNfcXVlcnlfc3RhdHVzKSwK
KwkucmVsZWFzZV9tZW1fc2l6ZQkJPSBzaXplb2Yoc3RydWN0IHBtNF9tZWNfcmVsZWFzZV9tZW0p
Cit9OworCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFkX21h
bmFnZXJfdjEwLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFkX21hbmFnZXJf
djEwLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi42NjYzYjcyMzcw
ZjYKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfbXFk
X21hbmFnZXJfdjEwLmMKQEAgLTAsMCArMSw1MTkgQEAKKy8qCisgKiBDb3B5cmlnaHQgMjAxOCBB
ZHZhbmNlZCBNaWNybyBEZXZpY2VzLCBJbmMuCisgKgorICogUGVybWlzc2lvbiBpcyBoZXJlYnkg
Z3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKKyAqIGNv
cHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0
aGUgIlNvZnR3YXJlIiksCisgKiB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3Ry
aWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uCisgKiB0aGUgcmlnaHRzIHRvIHVz
ZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwK
KyAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVy
c29ucyB0byB3aG9tIHRoZQorICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJq
ZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisgKiBUaGUgYWJvdmUgY29weXJp
Z2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBp
bgorICogYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUu
CisgKgorICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFO
VFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKKyAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9U
IExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAorICogRklUTkVT
UyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVW
RU5UIFNIQUxMCisgKiBUSEUgQ09QWVJJR0hUIEhPTERFUihTKSBPUiBBVVRIT1IoUykgQkUgTElB
QkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IKKyAqIE9USEVSIExJQUJJTElUWSwgV0hFVEhF
UiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLAorICogQVJJU0lO
RyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUg
VVNFIE9SCisgKiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCisgKgorICovCisKKyNp
bmNsdWRlIDxsaW51eC9wcmludGsuaD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CisjaW5jbHVk
ZSA8bGludXgvdWFjY2Vzcy5oPgorI2luY2x1ZGUgImtmZF9wcml2LmgiCisjaW5jbHVkZSAia2Zk
X21xZF9tYW5hZ2VyLmgiCisjaW5jbHVkZSAidjEwX3N0cnVjdHMuaCIKKyNpbmNsdWRlICJnYy9n
Y18xMF8xXzBfb2Zmc2V0LmgiCisjaW5jbHVkZSAiZ2MvZ2NfMTBfMV8wX3NoX21hc2suaCIKKyNp
bmNsdWRlICJhbWRncHVfYW1ka2ZkLmgiCisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IHYxMF9jb21w
dXRlX21xZCAqZ2V0X21xZCh2b2lkICptcWQpCit7CisJcmV0dXJuIChzdHJ1Y3QgdjEwX2NvbXB1
dGVfbXFkICopbXFkOworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCB2MTBfc2RtYV9tcWQgKmdl
dF9zZG1hX21xZCh2b2lkICptcWQpCit7CisJcmV0dXJuIChzdHJ1Y3QgdjEwX3NkbWFfbXFkICop
bXFkOworfQorCitzdGF0aWMgdm9pZCB1cGRhdGVfY3VfbWFzayhzdHJ1Y3QgbXFkX21hbmFnZXIg
Km1tLCB2b2lkICptcWQsCisJCQlzdHJ1Y3QgcXVldWVfcHJvcGVydGllcyAqcSkKK3sKKwlzdHJ1
Y3QgdjEwX2NvbXB1dGVfbXFkICptOworCXVpbnQzMl90IHNlX21hc2tbNF0gPSB7MH07IC8qIDQg
aXMgdGhlIG1heCAjIG9mIFNFcyAqLworCisJaWYgKHEtPmN1X21hc2tfY291bnQgPT0gMCkKKwkJ
cmV0dXJuOworCisJbXFkX3N5bW1ldHJpY2FsbHlfbWFwX2N1X21hc2sobW0sCisJCXEtPmN1X21h
c2ssIHEtPmN1X21hc2tfY291bnQsIHNlX21hc2spOworCisJbSA9IGdldF9tcWQobXFkKTsKKwlt
LT5jb21wdXRlX3N0YXRpY190aHJlYWRfbWdtdF9zZTAgPSBzZV9tYXNrWzBdOworCW0tPmNvbXB1
dGVfc3RhdGljX3RocmVhZF9tZ210X3NlMSA9IHNlX21hc2tbMV07CisJbS0+Y29tcHV0ZV9zdGF0
aWNfdGhyZWFkX21nbXRfc2UyID0gc2VfbWFza1syXTsKKwltLT5jb21wdXRlX3N0YXRpY190aHJl
YWRfbWdtdF9zZTMgPSBzZV9tYXNrWzNdOworCisJcHJfZGVidWcoInVwZGF0ZSBjdSBtYXNrIHRv
ICUjeCAlI3ggJSN4ICUjeFxuIiwKKwkJbS0+Y29tcHV0ZV9zdGF0aWNfdGhyZWFkX21nbXRfc2Uw
LAorCQltLT5jb21wdXRlX3N0YXRpY190aHJlYWRfbWdtdF9zZTEsCisJCW0tPmNvbXB1dGVfc3Rh
dGljX3RocmVhZF9tZ210X3NlMiwKKwkJbS0+Y29tcHV0ZV9zdGF0aWNfdGhyZWFkX21nbXRfc2Uz
KTsKK30KKworc3RhdGljIHN0cnVjdCBrZmRfbWVtX29iaiAqYWxsb2NhdGVfbXFkKHN0cnVjdCBr
ZmRfZGV2ICprZmQsCisJCXN0cnVjdCBxdWV1ZV9wcm9wZXJ0aWVzICpxKQoreworCWludCByZXR2
YWw7CisJc3RydWN0IGtmZF9tZW1fb2JqICptcWRfbWVtX29iaiA9IE5VTEw7CisKKwkvKiBGcm9t
IFY5LCAgZm9yIENXU1IsIHRoZSBjb250cm9sIHN0YWNrIGlzIGxvY2F0ZWQgb24gdGhlIG5leHQg
cGFnZQorCSAqIGJvdW5kYXJ5IGFmdGVyIHRoZSBtcWQsIHdlIHdpbGwgdXNlIHRoZSBndHQgYWxs
b2NhdGlvbiBmdW5jdGlvbgorCSAqIGluc3RlYWQgb2Ygc3ViLWFsbG9jYXRpb24gZnVuY3Rpb24u
CisJICovCisJaWYgKGtmZC0+Y3dzcl9lbmFibGVkICYmIChxLT50eXBlID09IEtGRF9RVUVVRV9U
WVBFX0NPTVBVVEUpKSB7CisJCW1xZF9tZW1fb2JqID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGtm
ZF9tZW1fb2JqKSwgR0ZQX05PSU8pOworCQlpZiAoIW1xZF9tZW1fb2JqKQorCQkJcmV0dXJuIE5V
TEw7CisJCXJldHZhbCA9IGFtZGdwdV9hbWRrZmRfYWxsb2NfZ3R0X21lbShrZmQtPmtnZCwKKwkJ
CUFMSUdOKHEtPmN0bF9zdGFja19zaXplLCBQQUdFX1NJWkUpICsKKwkJCQlBTElHTihzaXplb2Yo
c3RydWN0IHYxMF9jb21wdXRlX21xZCksIFBBR0VfU0laRSksCisJCQkmKG1xZF9tZW1fb2JqLT5n
dHRfbWVtKSwKKwkJCSYobXFkX21lbV9vYmotPmdwdV9hZGRyKSwKKwkJCSh2b2lkICopJihtcWRf
bWVtX29iai0+Y3B1X3B0ciksIHRydWUpOworCX0gZWxzZSB7CisJCXJldHZhbCA9IGtmZF9ndHRf
c2FfYWxsb2NhdGUoa2ZkLCBzaXplb2Yoc3RydWN0IHYxMF9jb21wdXRlX21xZCksCisJCQkJJm1x
ZF9tZW1fb2JqKTsKKwl9CisKKwlpZiAocmV0dmFsKSB7CisJCWtmcmVlKG1xZF9tZW1fb2JqKTsK
KwkJcmV0dXJuIE5VTEw7CisJfQorCisJcmV0dXJuIG1xZF9tZW1fb2JqOworCit9CisKK3N0YXRp
YyBpbnQgaW5pdF9tcWQoc3RydWN0IG1xZF9tYW5hZ2VyICptbSwgdm9pZCAqKm1xZCwKKwkJCXN0
cnVjdCBrZmRfbWVtX29iaiAqKm1xZF9tZW1fb2JqLCB1aW50NjRfdCAqZ2FydF9hZGRyLAorCQkJ
c3RydWN0IHF1ZXVlX3Byb3BlcnRpZXMgKnEpCit7CisJaW50IHJldHZhbDsKKwl1aW50NjRfdCBh
ZGRyOworCXN0cnVjdCB2MTBfY29tcHV0ZV9tcWQgKm07CisJc3RydWN0IGtmZF9kZXYgKmtmZCA9
IG1tLT5kZXY7CisKKwkqbXFkX21lbV9vYmogPSBhbGxvY2F0ZV9tcWQoa2ZkLCBxKTsKKwlpZiAo
ISptcWRfbWVtX29iaikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwltID0gKHN0cnVjdCB2MTBfY29t
cHV0ZV9tcWQgKikgKCptcWRfbWVtX29iaiktPmNwdV9wdHI7CisJYWRkciA9ICgqbXFkX21lbV9v
YmopLT5ncHVfYWRkcjsKKworCW1lbXNldChtLCAwLCBzaXplb2Yoc3RydWN0IHYxMF9jb21wdXRl
X21xZCkpOworCisJbS0+aGVhZGVyID0gMHhDMDMxMDgwMDsKKwltLT5jb21wdXRlX3BpcGVsaW5l
c3RhdF9lbmFibGUgPSAxOworCW0tPmNvbXB1dGVfc3RhdGljX3RocmVhZF9tZ210X3NlMCA9IDB4
RkZGRkZGRkY7CisJbS0+Y29tcHV0ZV9zdGF0aWNfdGhyZWFkX21nbXRfc2UxID0gMHhGRkZGRkZG
RjsKKwltLT5jb21wdXRlX3N0YXRpY190aHJlYWRfbWdtdF9zZTIgPSAweEZGRkZGRkZGOworCW0t
PmNvbXB1dGVfc3RhdGljX3RocmVhZF9tZ210X3NlMyA9IDB4RkZGRkZGRkY7CisKKwltLT5jcF9o
cWRfcGVyc2lzdGVudF9zdGF0ZSA9IENQX0hRRF9QRVJTSVNURU5UX1NUQVRFX19QUkVMT0FEX1JF
UV9NQVNLIHwKKwkJCTB4NTMgPDwgQ1BfSFFEX1BFUlNJU1RFTlRfU1RBVEVfX1BSRUxPQURfU0la
RV9fU0hJRlQ7CisKKwltLT5jcF9tcWRfY29udHJvbCA9IDEgPDwgQ1BfTVFEX0NPTlRST0xfX1BS
SVZfU1RBVEVfX1NISUZUOworCisJbS0+Y3BfbXFkX2Jhc2VfYWRkcl9sbyAgICAgICAgPSBsb3dl
cl8zMl9iaXRzKGFkZHIpOworCW0tPmNwX21xZF9iYXNlX2FkZHJfaGkgICAgICAgID0gdXBwZXJf
MzJfYml0cyhhZGRyKTsKKworCW0tPmNwX2hxZF9xdWFudHVtID0gMSA8PCBDUF9IUURfUVVBTlRV
TV9fUVVBTlRVTV9FTl9fU0hJRlQgfAorCQkJMSA8PCBDUF9IUURfUVVBTlRVTV9fUVVBTlRVTV9T
Q0FMRV9fU0hJRlQgfAorCQkJMTAgPDwgQ1BfSFFEX1FVQU5UVU1fX1FVQU5UVU1fRFVSQVRJT05f
X1NISUZUOworCisJbS0+Y3BfaHFkX3BpcGVfcHJpb3JpdHkgPSAxOworCW0tPmNwX2hxZF9xdWV1
ZV9wcmlvcml0eSA9IDE1OworCisJaWYgKHEtPmZvcm1hdCA9PSBLRkRfUVVFVUVfRk9STUFUX0FR
TCkgeworCQltLT5jcF9ocWRfYXFsX2NvbnRyb2wgPQorCQkJMSA8PCBDUF9IUURfQVFMX0NPTlRS
T0xfX0NPTlRST0wwX19TSElGVDsKKwl9CisKKwlpZiAobW0tPmRldi0+Y3dzcl9lbmFibGVkKSB7
CisJCW0tPmNwX2hxZF9wZXJzaXN0ZW50X3N0YXRlIHw9CisJCQkoMSA8PCBDUF9IUURfUEVSU0lT
VEVOVF9TVEFURV9fUVNXSVRDSF9NT0RFX19TSElGVCk7CisJCW0tPmNwX2hxZF9jdHhfc2F2ZV9i
YXNlX2FkZHJfbG8gPQorCQkJbG93ZXJfMzJfYml0cyhxLT5jdHhfc2F2ZV9yZXN0b3JlX2FyZWFf
YWRkcmVzcyk7CisJCW0tPmNwX2hxZF9jdHhfc2F2ZV9iYXNlX2FkZHJfaGkgPQorCQkJdXBwZXJf
MzJfYml0cyhxLT5jdHhfc2F2ZV9yZXN0b3JlX2FyZWFfYWRkcmVzcyk7CisJCW0tPmNwX2hxZF9j
dHhfc2F2ZV9zaXplID0gcS0+Y3R4X3NhdmVfcmVzdG9yZV9hcmVhX3NpemU7CisJCW0tPmNwX2hx
ZF9jbnRsX3N0YWNrX3NpemUgPSBxLT5jdGxfc3RhY2tfc2l6ZTsKKwkJbS0+Y3BfaHFkX2NudGxf
c3RhY2tfb2Zmc2V0ID0gcS0+Y3RsX3N0YWNrX3NpemU7CisJCW0tPmNwX2hxZF93Z19zdGF0ZV9v
ZmZzZXQgPSBxLT5jdGxfc3RhY2tfc2l6ZTsKKwl9CisKKwkqbXFkID0gbTsKKwlpZiAoZ2FydF9h
ZGRyKQorCQkqZ2FydF9hZGRyID0gYWRkcjsKKwlyZXR2YWwgPSBtbS0+dXBkYXRlX21xZChtbSwg
bSwgcSk7CisKKwlyZXR1cm4gcmV0dmFsOworfQorCitzdGF0aWMgaW50IGxvYWRfbXFkKHN0cnVj
dCBtcWRfbWFuYWdlciAqbW0sIHZvaWQgKm1xZCwKKwkJCXVpbnQzMl90IHBpcGVfaWQsIHVpbnQz
Ml90IHF1ZXVlX2lkLAorCQkJc3RydWN0IHF1ZXVlX3Byb3BlcnRpZXMgKnAsIHN0cnVjdCBtbV9z
dHJ1Y3QgKm1tcykKK3sKKwlpbnQgciA9IDA7CisJLyogQVFMIHdyaXRlIHBvaW50ZXIgY291bnRz
IGluIDY0QiBwYWNrZXRzLCBQTTQvQ1AgY291bnRzIGluIGR3b3Jkcy4gKi8KKwl1aW50MzJfdCB3
cHRyX3NoaWZ0ID0gKHAtPmZvcm1hdCA9PSBLRkRfUVVFVUVfRk9STUFUX0FRTCA/IDQgOiAwKTsK
KworCXIgPSBtbS0+ZGV2LT5rZmQya2dkLT5ocWRfbG9hZChtbS0+ZGV2LT5rZ2QsIG1xZCwgcGlw
ZV9pZCwgcXVldWVfaWQsCisJCQkJCSAgKHVpbnQzMl90IF9fdXNlciAqKXAtPndyaXRlX3B0ciwK
KwkJCQkJICB3cHRyX3NoaWZ0LCAwLCBtbXMpOworCXJldHVybiByOworfQorCitzdGF0aWMgaW50
IHVwZGF0ZV9tcWQoc3RydWN0IG1xZF9tYW5hZ2VyICptbSwgdm9pZCAqbXFkLAorCQkgICAgICBz
dHJ1Y3QgcXVldWVfcHJvcGVydGllcyAqcSkKK3sKKwlzdHJ1Y3QgdjEwX2NvbXB1dGVfbXFkICpt
OworCisJbSA9IGdldF9tcWQobXFkKTsKKworCW0tPmNwX2hxZF9wcV9jb250cm9sID0gNSA8PCBD
UF9IUURfUFFfQ09OVFJPTF9fUlBUUl9CTE9DS19TSVpFX19TSElGVDsKKwltLT5jcF9ocWRfcHFf
Y29udHJvbCB8PQorCQkJZmZzKHEtPnF1ZXVlX3NpemUgLyBzaXplb2YodW5zaWduZWQgaW50KSkg
LSAxIC0gMTsKKwlwcl9kZWJ1ZygiY3BfaHFkX3BxX2NvbnRyb2wgMHgleFxuIiwgbS0+Y3BfaHFk
X3BxX2NvbnRyb2wpOworCisJbS0+Y3BfaHFkX3BxX2Jhc2VfbG8gPSBsb3dlcl8zMl9iaXRzKCh1
aW50NjRfdClxLT5xdWV1ZV9hZGRyZXNzID4+IDgpOworCW0tPmNwX2hxZF9wcV9iYXNlX2hpID0g
dXBwZXJfMzJfYml0cygodWludDY0X3QpcS0+cXVldWVfYWRkcmVzcyA+PiA4KTsKKworCW0tPmNw
X2hxZF9wcV9ycHRyX3JlcG9ydF9hZGRyX2xvID0gbG93ZXJfMzJfYml0cygodWludDY0X3QpcS0+
cmVhZF9wdHIpOworCW0tPmNwX2hxZF9wcV9ycHRyX3JlcG9ydF9hZGRyX2hpID0gdXBwZXJfMzJf
Yml0cygodWludDY0X3QpcS0+cmVhZF9wdHIpOworCW0tPmNwX2hxZF9wcV93cHRyX3BvbGxfYWRk
cl9sbyA9IGxvd2VyXzMyX2JpdHMoKHVpbnQ2NF90KXEtPndyaXRlX3B0cik7CisJbS0+Y3BfaHFk
X3BxX3dwdHJfcG9sbF9hZGRyX2hpID0gdXBwZXJfMzJfYml0cygodWludDY0X3QpcS0+d3JpdGVf
cHRyKTsKKworCW0tPmNwX2hxZF9wcV9kb29yYmVsbF9jb250cm9sID0KKwkJcS0+ZG9vcmJlbGxf
b2ZmIDw8CisJCQlDUF9IUURfUFFfRE9PUkJFTExfQ09OVFJPTF9fRE9PUkJFTExfT0ZGU0VUX19T
SElGVDsKKwlwcl9kZWJ1ZygiY3BfaHFkX3BxX2Rvb3JiZWxsX2NvbnRyb2wgMHgleFxuIiwKKwkJ
CW0tPmNwX2hxZF9wcV9kb29yYmVsbF9jb250cm9sKTsKKworCW0tPmNwX2hxZF9pYl9jb250cm9s
ID0gMyA8PCBDUF9IUURfSUJfQ09OVFJPTF9fTUlOX0lCX0FWQUlMX1NJWkVfX1NISUZUOworCisJ
LyoKKwkgKiBIVyBkb2VzIG5vdCBjbGFtcCB0aGlzIGZpZWxkIGNvcnJlY3RseS4gTWF4aW11bSBF
T1AgcXVldWUgc2l6ZQorCSAqIGlzIGNvbnN0cmFpbmVkIGJ5IHBlci1TRSBFT1AgZG9uZSBzaWdu
YWwgY291bnQsIHdoaWNoIGlzIDgtYml0LgorCSAqIExpbWl0IGlzIDB4RkYgRU9QIGVudHJpZXMg
KD0gMHg3RjggZHdvcmRzKS4gQ1Agd2lsbCBub3Qgc3VibWl0CisJICogbW9yZSB0aGFuIChFT1Ag
ZW50cnkgY291bnQgLSAxKSBzbyBhIHF1ZXVlIHNpemUgb2YgMHg4MDAgZHdvcmRzCisJICogaXMg
c2FmZSwgZ2l2aW5nIGEgbWF4aW11bSBmaWVsZCB2YWx1ZSBvZiAweEEuCisJICovCisJbS0+Y3Bf
aHFkX2VvcF9jb250cm9sID0gbWluKDB4QSwKKwkJZmZzKHEtPmVvcF9yaW5nX2J1ZmZlcl9zaXpl
IC8gc2l6ZW9mKHVuc2lnbmVkIGludCkpIC0gMSAtIDEpOworCW0tPmNwX2hxZF9lb3BfYmFzZV9h
ZGRyX2xvID0KKwkJCWxvd2VyXzMyX2JpdHMocS0+ZW9wX3JpbmdfYnVmZmVyX2FkZHJlc3MgPj4g
OCk7CisJbS0+Y3BfaHFkX2VvcF9iYXNlX2FkZHJfaGkgPQorCQkJdXBwZXJfMzJfYml0cyhxLT5l
b3BfcmluZ19idWZmZXJfYWRkcmVzcyA+PiA4KTsKKworCW0tPmNwX2hxZF9pcV90aW1lciA9IDA7
CisKKwltLT5jcF9ocWRfdm1pZCA9IHEtPnZtaWQ7CisKKwlpZiAocS0+Zm9ybWF0ID09IEtGRF9R
VUVVRV9GT1JNQVRfQVFMKSB7CisJCS8qIEdDIDEwIHJlbW92ZWQgV1BQX0NMQU1QIGZyb20gUFEg
Q29udHJvbCAqLworCQltLT5jcF9ocWRfcHFfY29udHJvbCB8PSBDUF9IUURfUFFfQ09OVFJPTF9f
Tk9fVVBEQVRFX1JQVFJfTUFTSyB8CisJCQkJMiA8PCBDUF9IUURfUFFfQ09OVFJPTF9fU0xPVF9C
QVNFRF9XUFRSX19TSElGVCB8CisJCQkJMSA8PCBDUF9IUURfUFFfQ09OVFJPTF9fUVVFVUVfRlVM
TF9FTl9fU0hJRlQgOworCQltLT5jcF9ocWRfcHFfZG9vcmJlbGxfY29udHJvbCB8PQorCQkJMSA8
PCBDUF9IUURfUFFfRE9PUkJFTExfQ09OVFJPTF9fRE9PUkJFTExfQklGX0RST1BfX1NISUZUOwor
CX0KKwlpZiAobW0tPmRldi0+Y3dzcl9lbmFibGVkKQorCQltLT5jcF9ocWRfY3R4X3NhdmVfY29u
dHJvbCA9IDA7CisKKwl1cGRhdGVfY3VfbWFzayhtbSwgbXFkLCBxKTsKKworCXEtPmlzX2FjdGl2
ZSA9IChxLT5xdWV1ZV9zaXplID4gMCAmJgorCQkJcS0+cXVldWVfYWRkcmVzcyAhPSAwICYmCisJ
CQlxLT5xdWV1ZV9wZXJjZW50ID4gMCAmJgorCQkJIXEtPmlzX2V2aWN0ZWQpOworCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQgZGVzdHJveV9tcWQoc3RydWN0IG1xZF9tYW5hZ2VyICptbSwg
dm9pZCAqbXFkLAorICAgICAgICAgICAgICAgICAgICAgICAgZW51bSBrZmRfcHJlZW1wdF90eXBl
IHR5cGUsCisgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpbnQgdGltZW91dCwgdWlu
dDMyX3QgcGlwZV9pZCwKKyAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IHF1ZXVlX2lk
KQoreworCXJldHVybiBtbS0+ZGV2LT5rZmQya2dkLT5ocWRfZGVzdHJveQorCQkobW0tPmRldi0+
a2dkLCBtcWQsIHR5cGUsIHRpbWVvdXQsCisJCXBpcGVfaWQsIHF1ZXVlX2lkKTsKK30KKworc3Rh
dGljIHZvaWQgdW5pbml0X21xZChzdHJ1Y3QgbXFkX21hbmFnZXIgKm1tLCB2b2lkICptcWQsCisJ
CQlzdHJ1Y3Qga2ZkX21lbV9vYmogKm1xZF9tZW1fb2JqKQoreworCXN0cnVjdCBrZmRfZGV2ICpr
ZmQgPSBtbS0+ZGV2OworCisJaWYgKG1xZF9tZW1fb2JqLT5ndHRfbWVtKSB7CisJCWFtZGdwdV9h
bWRrZmRfZnJlZV9ndHRfbWVtKGtmZC0+a2dkLCBtcWRfbWVtX29iai0+Z3R0X21lbSk7CisJCWtm
cmVlKG1xZF9tZW1fb2JqKTsKKwl9IGVsc2UgeworCQlrZmRfZ3R0X3NhX2ZyZWUobW0tPmRldiwg
bXFkX21lbV9vYmopOworCX0KK30KKworc3RhdGljIGJvb2wgaXNfb2NjdXBpZWQoc3RydWN0IG1x
ZF9tYW5hZ2VyICptbSwgdm9pZCAqbXFkLAorCQkJdWludDY0X3QgcXVldWVfYWRkcmVzcywJdWlu
dDMyX3QgcGlwZV9pZCwKKwkJCXVpbnQzMl90IHF1ZXVlX2lkKQoreworCXJldHVybiBtbS0+ZGV2
LT5rZmQya2dkLT5ocWRfaXNfb2NjdXBpZWQoCisJCW1tLT5kZXYtPmtnZCwgcXVldWVfYWRkcmVz
cywKKwkJcGlwZV9pZCwgcXVldWVfaWQpOworfQorCitzdGF0aWMgaW50IGdldF93YXZlX3N0YXRl
KHN0cnVjdCBtcWRfbWFuYWdlciAqbW0sIHZvaWQgKm1xZCwKKwkJCSAgdm9pZCBfX3VzZXIgKmN0
bF9zdGFjaywKKwkJCSAgdTMyICpjdGxfc3RhY2tfdXNlZF9zaXplLAorCQkJICB1MzIgKnNhdmVf
YXJlYV91c2VkX3NpemUpCit7CisJc3RydWN0IHYxMF9jb21wdXRlX21xZCAqbTsKKworCS8qIENv
bnRyb2wgc3RhY2sgaXMgbG9jYXRlZCBvbmUgcGFnZSBhZnRlciBNUUQuICovCisJdm9pZCAqbXFk
X2N0bF9zdGFjayA9ICh2b2lkICopKCh1aW50cHRyX3QpbXFkICsgUEFHRV9TSVpFKTsKKworCW0g
PSBnZXRfbXFkKG1xZCk7CisKKwkqY3RsX3N0YWNrX3VzZWRfc2l6ZSA9IG0tPmNwX2hxZF9jbnRs
X3N0YWNrX3NpemUgLQorCQltLT5jcF9ocWRfY250bF9zdGFja19vZmZzZXQ7CisJKnNhdmVfYXJl
YV91c2VkX3NpemUgPSBtLT5jcF9ocWRfd2dfc3RhdGVfb2Zmc2V0IC0KKwkJbS0+Y3BfaHFkX2Nu
dGxfc3RhY2tfc2l6ZTsKKworCWlmIChjb3B5X3RvX3VzZXIoY3RsX3N0YWNrLCBtcWRfY3RsX3N0
YWNrLCBtLT5jcF9ocWRfY250bF9zdGFja19zaXplKSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIGludCBpbml0X21xZF9oaXEoc3RydWN0IG1xZF9tYW5hZ2Vy
ICptbSwgdm9pZCAqKm1xZCwKKwkJCXN0cnVjdCBrZmRfbWVtX29iaiAqKm1xZF9tZW1fb2JqLCB1
aW50NjRfdCAqZ2FydF9hZGRyLAorCQkJc3RydWN0IHF1ZXVlX3Byb3BlcnRpZXMgKnEpCit7CisJ
c3RydWN0IHYxMF9jb21wdXRlX21xZCAqbTsKKwlpbnQgcmV0dmFsOworCisKKwlyZXR2YWwgPSBp
bml0X21xZChtbSwgbXFkLCBtcWRfbWVtX29iaiwgZ2FydF9hZGRyLCBxKTsKKworCWlmIChyZXR2
YWwgIT0gMCkKKwkJcmV0dXJuIHJldHZhbDsKKworCW0gPSBnZXRfbXFkKCptcWQpOworCisJbS0+
Y3BfaHFkX3BxX2NvbnRyb2wgfD0gMSA8PCBDUF9IUURfUFFfQ09OVFJPTF9fUFJJVl9TVEFURV9f
U0hJRlQgfAorCQkJMSA8PCBDUF9IUURfUFFfQ09OVFJPTF9fS01EX1FVRVVFX19TSElGVDsKKwor
CXJldHVybiByZXR2YWw7Cit9CisKK3N0YXRpYyBpbnQgdXBkYXRlX21xZF9oaXEoc3RydWN0IG1x
ZF9tYW5hZ2VyICptbSwgdm9pZCAqbXFkLAorCQkJc3RydWN0IHF1ZXVlX3Byb3BlcnRpZXMgKnEp
Cit7CisJc3RydWN0IHYxMF9jb21wdXRlX21xZCAqbTsKKwlpbnQgcmV0dmFsOworCisJcmV0dmFs
ID0gdXBkYXRlX21xZChtbSwgbXFkLCBxKTsKKworCWlmIChyZXR2YWwgIT0gMCkKKwkJcmV0dXJu
IHJldHZhbDsKKworCS8qIFRPRE86IHdoYXQncyB0aGUgcG9pbnQ/IHVwZGF0ZV9tcWQgYWxyZWFk
eSBkb2VzIHRoaXMuICovCisJbSA9IGdldF9tcWQobXFkKTsKKwltLT5jcF9ocWRfdm1pZCA9IHEt
PnZtaWQ7CisJcmV0dXJuIHJldHZhbDsKK30KKworc3RhdGljIGludCBpbml0X21xZF9zZG1hKHN0
cnVjdCBtcWRfbWFuYWdlciAqbW0sIHZvaWQgKiptcWQsCisJCXN0cnVjdCBrZmRfbWVtX29iaiAq
Km1xZF9tZW1fb2JqLCB1aW50NjRfdCAqZ2FydF9hZGRyLAorCQlzdHJ1Y3QgcXVldWVfcHJvcGVy
dGllcyAqcSkKK3sKKwlpbnQgcmV0dmFsOworCXN0cnVjdCB2MTBfc2RtYV9tcWQgKm07CisKKwor
CXJldHZhbCA9IGtmZF9ndHRfc2FfYWxsb2NhdGUobW0tPmRldiwKKwkJCXNpemVvZihzdHJ1Y3Qg
djEwX3NkbWFfbXFkKSwKKwkJCW1xZF9tZW1fb2JqKTsKKworCWlmIChyZXR2YWwgIT0gMCkKKwkJ
cmV0dXJuIC1FTk9NRU07CisKKwltID0gKHN0cnVjdCB2MTBfc2RtYV9tcWQgKikgKCptcWRfbWVt
X29iaiktPmNwdV9wdHI7CisKKwltZW1zZXQobSwgMCwgc2l6ZW9mKHN0cnVjdCB2MTBfc2RtYV9t
cWQpKTsKKworCSptcWQgPSBtOworCWlmIChnYXJ0X2FkZHIpCisJCSpnYXJ0X2FkZHIgPSAoKm1x
ZF9tZW1fb2JqKS0+Z3B1X2FkZHI7CisKKwlyZXR2YWwgPSBtbS0+dXBkYXRlX21xZChtbSwgbSwg
cSk7CisKKwlyZXR1cm4gcmV0dmFsOworfQorCitzdGF0aWMgdm9pZCB1bmluaXRfbXFkX3NkbWEo
c3RydWN0IG1xZF9tYW5hZ2VyICptbSwgdm9pZCAqbXFkLAorCQlzdHJ1Y3Qga2ZkX21lbV9vYmog
Km1xZF9tZW1fb2JqKQoreworCWtmZF9ndHRfc2FfZnJlZShtbS0+ZGV2LCBtcWRfbWVtX29iaik7
Cit9CisKK3N0YXRpYyBpbnQgbG9hZF9tcWRfc2RtYShzdHJ1Y3QgbXFkX21hbmFnZXIgKm1tLCB2
b2lkICptcWQsCisJCXVpbnQzMl90IHBpcGVfaWQsIHVpbnQzMl90IHF1ZXVlX2lkLAorCQlzdHJ1
Y3QgcXVldWVfcHJvcGVydGllcyAqcCwgc3RydWN0IG1tX3N0cnVjdCAqbW1zKQoreworCXJldHVy
biBtbS0+ZGV2LT5rZmQya2dkLT5ocWRfc2RtYV9sb2FkKG1tLT5kZXYtPmtnZCwgbXFkLAorCQkJ
CQkgICAgICAgKHVpbnQzMl90IF9fdXNlciAqKXAtPndyaXRlX3B0ciwKKwkJCQkJICAgICAgIG1t
cyk7Cit9CisKKyNkZWZpbmUgU0RNQV9STENfRFVNTVlfREVGQVVMVCAweGYKKworc3RhdGljIGlu
dCB1cGRhdGVfbXFkX3NkbWEoc3RydWN0IG1xZF9tYW5hZ2VyICptbSwgdm9pZCAqbXFkLAorCQlz
dHJ1Y3QgcXVldWVfcHJvcGVydGllcyAqcSkKK3sKKwlzdHJ1Y3QgdjEwX3NkbWFfbXFkICptOwor
CisJbSA9IGdldF9zZG1hX21xZChtcWQpOworCW0tPnNkbWF4X3JsY3hfcmJfY250bCA9IChmZnMo
cS0+cXVldWVfc2l6ZSAvIHNpemVvZih1bnNpZ25lZCBpbnQpKSAtIDEpCisJCTw8IFNETUEwX1JM
QzBfUkJfQ05UTF9fUkJfU0laRV9fU0hJRlQgfAorCQlxLT52bWlkIDw8IFNETUEwX1JMQzBfUkJf
Q05UTF9fUkJfVk1JRF9fU0hJRlQgfAorCQkxIDw8IFNETUEwX1JMQzBfUkJfQ05UTF9fUlBUUl9X
UklURUJBQ0tfRU5BQkxFX19TSElGVCB8CisJCTYgPDwgU0RNQTBfUkxDMF9SQl9DTlRMX19SUFRS
X1dSSVRFQkFDS19USU1FUl9fU0hJRlQ7CisKKwltLT5zZG1heF9ybGN4X3JiX2Jhc2UgPSBsb3dl
cl8zMl9iaXRzKHEtPnF1ZXVlX2FkZHJlc3MgPj4gOCk7CisJbS0+c2RtYXhfcmxjeF9yYl9iYXNl
X2hpID0gdXBwZXJfMzJfYml0cyhxLT5xdWV1ZV9hZGRyZXNzID4+IDgpOworCW0tPnNkbWF4X3Js
Y3hfcmJfcnB0cl9hZGRyX2xvID0gbG93ZXJfMzJfYml0cygodWludDY0X3QpcS0+cmVhZF9wdHIp
OworCW0tPnNkbWF4X3JsY3hfcmJfcnB0cl9hZGRyX2hpID0gdXBwZXJfMzJfYml0cygodWludDY0
X3QpcS0+cmVhZF9wdHIpOworCW0tPnNkbWF4X3JsY3hfZG9vcmJlbGxfb2Zmc2V0ID0KKwkJcS0+
ZG9vcmJlbGxfb2ZmIDw8IFNETUEwX1JMQzBfRE9PUkJFTExfT0ZGU0VUX19PRkZTRVRfX1NISUZU
OworCisJbS0+c2RtYV9lbmdpbmVfaWQgPSBxLT5zZG1hX2VuZ2luZV9pZDsKKwltLT5zZG1hX3F1
ZXVlX2lkID0gcS0+c2RtYV9xdWV1ZV9pZDsKKwltLT5zZG1heF9ybGN4X2R1bW15X3JlZyA9IFNE
TUFfUkxDX0RVTU1ZX0RFRkFVTFQ7CisKKworCXEtPmlzX2FjdGl2ZSA9IChxLT5xdWV1ZV9zaXpl
ID4gMCAmJgorCQkJcS0+cXVldWVfYWRkcmVzcyAhPSAwICYmCisJCQlxLT5xdWV1ZV9wZXJjZW50
ID4gMCAmJgorCQkJIXEtPmlzX2V2aWN0ZWQpOworCXJldHVybiAwOworfQorCisvKgorICogICog
cHJlZW1wdCB0eXBlIGhlcmUgaXMgaWdub3JlZCBiZWNhdXNlIHRoZXJlIGlzIG9ubHkgb25lIHdh
eQorICogICogdG8gcHJlZW1wdCBzZG1hIHF1ZXVlCisgKi8KK3N0YXRpYyBpbnQgZGVzdHJveV9t
cWRfc2RtYShzdHJ1Y3QgbXFkX21hbmFnZXIgKm1tLCB2b2lkICptcWQsCisJCWVudW0ga2ZkX3By
ZWVtcHRfdHlwZSB0eXBlLAorCQl1bnNpZ25lZCBpbnQgdGltZW91dCwgdWludDMyX3QgcGlwZV9p
ZCwKKwkJdWludDMyX3QgcXVldWVfaWQpCit7CisJcmV0dXJuIG1tLT5kZXYtPmtmZDJrZ2QtPmhx
ZF9zZG1hX2Rlc3Ryb3kobW0tPmRldi0+a2dkLCBtcWQsIHRpbWVvdXQpOworfQorCitzdGF0aWMg
Ym9vbCBpc19vY2N1cGllZF9zZG1hKHN0cnVjdCBtcWRfbWFuYWdlciAqbW0sIHZvaWQgKm1xZCwK
KwkJdWludDY0X3QgcXVldWVfYWRkcmVzcywgdWludDMyX3QgcGlwZV9pZCwKKwkJdWludDMyX3Qg
cXVldWVfaWQpCit7CisJcmV0dXJuIG1tLT5kZXYtPmtmZDJrZ2QtPmhxZF9zZG1hX2lzX29jY3Vw
aWVkKG1tLT5kZXYtPmtnZCwgbXFkKTsKK30KKworI2lmIGRlZmluZWQoQ09ORklHX0RFQlVHX0ZT
KQorCitzdGF0aWMgaW50IGRlYnVnZnNfc2hvd19tcWQoc3RydWN0IHNlcV9maWxlICptLCB2b2lk
ICpkYXRhKQoreworCXNlcV9oZXhfZHVtcChtLCAiICAgICIsIERVTVBfUFJFRklYX09GRlNFVCwg
MzIsIDQsCisJCSAgICAgZGF0YSwgc2l6ZW9mKHN0cnVjdCB2MTBfY29tcHV0ZV9tcWQpLCBmYWxz
ZSk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZGVidWdmc19zaG93X21xZF9zZG1hKHN0
cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzZXFfaGV4X2R1bXAobSwgIiAgICAi
LCBEVU1QX1BSRUZJWF9PRkZTRVQsIDMyLCA0LAorCQkgICAgIGRhdGEsIHNpemVvZihzdHJ1Y3Qg
djEwX3NkbWFfbXFkKSwgZmFsc2UpOworCXJldHVybiAwOworfQorCisjZW5kaWYKKworc3RydWN0
IG1xZF9tYW5hZ2VyICptcWRfbWFuYWdlcl9pbml0X3YxMChlbnVtIEtGRF9NUURfVFlQRSB0eXBl
LAorCQlzdHJ1Y3Qga2ZkX2RldiAqZGV2KQoreworCXN0cnVjdCBtcWRfbWFuYWdlciAqbXFkOwor
CisJaWYgKFdBUk5fT04odHlwZSA+PSBLRkRfTVFEX1RZUEVfTUFYKSkKKwkJcmV0dXJuIE5VTEw7
CisKKwltcWQgPSBremFsbG9jKHNpemVvZigqbXFkKSwgR0ZQX05PSU8pOworCWlmICghbXFkKQor
CQlyZXR1cm4gTlVMTDsKKworCW1xZC0+ZGV2ID0gZGV2OworCisJc3dpdGNoICh0eXBlKSB7CisJ
Y2FzZSBLRkRfTVFEX1RZUEVfQ1A6CisJCXByX2RlYnVnKCIlc0AlaVxuIiwgX19mdW5jX18sIF9f
TElORV9fKTsKKwljYXNlIEtGRF9NUURfVFlQRV9DT01QVVRFOgorCQlwcl9kZWJ1ZygiJXNAJWlc
biIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CisJCW1xZC0+aW5pdF9tcWQgPSBpbml0X21xZDsKKwkJ
bXFkLT51bmluaXRfbXFkID0gdW5pbml0X21xZDsKKwkJbXFkLT5sb2FkX21xZCA9IGxvYWRfbXFk
OworCQltcWQtPnVwZGF0ZV9tcWQgPSB1cGRhdGVfbXFkOworCQltcWQtPmRlc3Ryb3lfbXFkID0g
ZGVzdHJveV9tcWQ7CisJCW1xZC0+aXNfb2NjdXBpZWQgPSBpc19vY2N1cGllZDsKKwkJbXFkLT5n
ZXRfd2F2ZV9zdGF0ZSA9IGdldF93YXZlX3N0YXRlOworI2lmIGRlZmluZWQoQ09ORklHX0RFQlVH
X0ZTKQorCQltcWQtPmRlYnVnZnNfc2hvd19tcWQgPSBkZWJ1Z2ZzX3Nob3dfbXFkOworI2VuZGlm
CisJCXByX2RlYnVnKCIlc0AlaVxuIiwgX19mdW5jX18sIF9fTElORV9fKTsKKwkJYnJlYWs7CisJ
Y2FzZSBLRkRfTVFEX1RZUEVfSElROgorCQlwcl9kZWJ1ZygiJXNAJWlcbiIsIF9fZnVuY19fLCBf
X0xJTkVfXyk7CisJCW1xZC0+aW5pdF9tcWQgPSBpbml0X21xZF9oaXE7CisJCW1xZC0+dW5pbml0
X21xZCA9IHVuaW5pdF9tcWQ7CisJCW1xZC0+bG9hZF9tcWQgPSBsb2FkX21xZDsKKwkJbXFkLT51
cGRhdGVfbXFkID0gdXBkYXRlX21xZF9oaXE7CisJCW1xZC0+ZGVzdHJveV9tcWQgPSBkZXN0cm95
X21xZDsKKwkJbXFkLT5pc19vY2N1cGllZCA9IGlzX29jY3VwaWVkOworI2lmIGRlZmluZWQoQ09O
RklHX0RFQlVHX0ZTKQorCQltcWQtPmRlYnVnZnNfc2hvd19tcWQgPSBkZWJ1Z2ZzX3Nob3dfbXFk
OworI2VuZGlmCisJCXByX2RlYnVnKCIlc0AlaVxuIiwgX19mdW5jX18sIF9fTElORV9fKTsKKwkJ
YnJlYWs7CisJY2FzZSBLRkRfTVFEX1RZUEVfU0RNQToKKwkJcHJfZGVidWcoIiVzQCVpXG4iLCBf
X2Z1bmNfXywgX19MSU5FX18pOworCQltcWQtPmluaXRfbXFkID0gaW5pdF9tcWRfc2RtYTsKKwkJ
bXFkLT51bmluaXRfbXFkID0gdW5pbml0X21xZF9zZG1hOworCQltcWQtPmxvYWRfbXFkID0gbG9h
ZF9tcWRfc2RtYTsKKwkJbXFkLT51cGRhdGVfbXFkID0gdXBkYXRlX21xZF9zZG1hOworCQltcWQt
PmRlc3Ryb3lfbXFkID0gZGVzdHJveV9tcWRfc2RtYTsKKwkJbXFkLT5pc19vY2N1cGllZCA9IGlz
X29jY3VwaWVkX3NkbWE7CisjaWYgZGVmaW5lZChDT05GSUdfREVCVUdfRlMpCisJCW1xZC0+ZGVi
dWdmc19zaG93X21xZCA9IGRlYnVnZnNfc2hvd19tcWRfc2RtYTsKKyNlbmRpZgorCQlwcl9kZWJ1
ZygiJXNAJWlcbiIsIF9fZnVuY19fLCBfX0xJTkVfXyk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJ
CWtmcmVlKG1xZCk7CisJCXJldHVybiBOVUxMOworCX0KKworCXJldHVybiBtcWQ7Cit9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfcGFja2V0X21hbmFnZXIuYyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wYWNrZXRfbWFuYWdlci5jCmluZGV4IDgw
ODE5NDY2M2E3ZC4uYzcyYzhmNWZkNTRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGtmZC9rZmRfcGFja2V0X21hbmFnZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGtmZC9rZmRfcGFja2V0X21hbmFnZXIuYwpAQCAtMjM3LDYgKzIzNyw5IEBAIGludCBwbV9pbml0
KHN0cnVjdCBwYWNrZXRfbWFuYWdlciAqcG0sIHN0cnVjdCBkZXZpY2VfcXVldWVfbWFuYWdlciAq
ZHFtKQogCWNhc2UgQ0hJUF9SQVZFTjoKIAkJcG0tPnBtZiA9ICZrZmRfdjlfcG1fZnVuY3M7CiAJ
CWJyZWFrOworCWNhc2UgQ0hJUF9OQVZJMTA6CisJCXBtLT5wbWYgPSAma2ZkX3YxMF9wbV9mdW5j
czsKKwkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJV0FSTigxLCAiVW5leHBlY3RlZCBBU0lDIGZhbWls
eSAldSIsCiAJCSAgICAgZHFtLT5kZXYtPmRldmljZV9pbmZvLT5hc2ljX2ZhbWlseSk7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfcHJpdi5oIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRrZmQva2ZkX3ByaXYuaAppbmRleCBkYTU4OWVlMTM2NmMuLjQwZTQwZDFl
NGRkMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX3ByaXYuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfcHJpdi5oCkBAIC0xNzEsNiArMTcx
LDEwIEBAIGVudW0gY2FjaGVfcG9saWN5IHsKIAljYWNoZV9wb2xpY3lfbm9uY29oZXJlbnQKIH07
CiAKKyNkZWZpbmUgS0ZEX0lTX1ZJKGNoaXApICgoY2hpcCkgPj0gQ0hJUF9DQVJSSVpPICYmIChj
aGlwKSA8PSBDSElQX1BPTEFSSVMxMSkKKyNkZWZpbmUgS0ZEX0lTX0RHUFUoY2hpcCkgKCgoY2hp
cCkgPj0gQ0hJUF9UT05HQSAmJiBcCisJCQkgICAoY2hpcCkgPD0gQ0hJUF9OQVZJMTApIHx8IFwK
KwkJCSAgIChjaGlwKSA9PSBDSElQX0hBV0FJSSkKICNkZWZpbmUgS0ZEX0lTX1NPQzE1KGNoaXAp
ICgoY2hpcCkgPj0gQ0hJUF9WRUdBMTApCiAKIHN0cnVjdCBrZmRfZXZlbnRfaW50ZXJydXB0X2Ns
YXNzIHsKQEAgLTg2MSw2ICs4NjUsOCBAQCBzdHJ1Y3QgbXFkX21hbmFnZXIgKm1xZF9tYW5hZ2Vy
X2luaXRfdmlfdG9uZ2EoZW51bSBLRkRfTVFEX1RZUEUgdHlwZSwKIAkJc3RydWN0IGtmZF9kZXYg
KmRldik7CiBzdHJ1Y3QgbXFkX21hbmFnZXIgKm1xZF9tYW5hZ2VyX2luaXRfdjkoZW51bSBLRkRf
TVFEX1RZUEUgdHlwZSwKIAkJc3RydWN0IGtmZF9kZXYgKmRldik7CitzdHJ1Y3QgbXFkX21hbmFn
ZXIgKm1xZF9tYW5hZ2VyX2luaXRfdjEwKGVudW0gS0ZEX01RRF9UWVBFIHR5cGUsCisJCXN0cnVj
dCBrZmRfZGV2ICpkZXYpOwogc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkZXZpY2VfcXVl
dWVfbWFuYWdlcl9pbml0KHN0cnVjdCBrZmRfZGV2ICpkZXYpOwogdm9pZCBkZXZpY2VfcXVldWVf
bWFuYWdlcl91bmluaXQoc3RydWN0IGRldmljZV9xdWV1ZV9tYW5hZ2VyICpkcW0pOwogc3RydWN0
IGtlcm5lbF9xdWV1ZSAqa2VybmVsX3F1ZXVlX2luaXQoc3RydWN0IGtmZF9kZXYgKmRldiwKQEAg
LTk1MCw2ICs5NTYsNyBAQCBzdHJ1Y3QgcGFja2V0X21hbmFnZXJfZnVuY3MgewogCiBleHRlcm4g
Y29uc3Qgc3RydWN0IHBhY2tldF9tYW5hZ2VyX2Z1bmNzIGtmZF92aV9wbV9mdW5jczsKIGV4dGVy
biBjb25zdCBzdHJ1Y3QgcGFja2V0X21hbmFnZXJfZnVuY3Mga2ZkX3Y5X3BtX2Z1bmNzOworZXh0
ZXJuIGNvbnN0IHN0cnVjdCBwYWNrZXRfbWFuYWdlcl9mdW5jcyBrZmRfdjEwX3BtX2Z1bmNzOwog
CiBpbnQgcG1faW5pdChzdHJ1Y3QgcGFja2V0X21hbmFnZXIgKnBtLCBzdHJ1Y3QgZGV2aWNlX3F1
ZXVlX21hbmFnZXIgKmRxbSk7CiB2b2lkIHBtX3VuaW5pdChzdHJ1Y3QgcGFja2V0X21hbmFnZXIg
KnBtKTsKQEAgLTk2OSw3ICs5NzYsOSBAQCB2b2lkIHBtX3JlbGVhc2VfaWIoc3RydWN0IHBhY2tl
dF9tYW5hZ2VyICpwbSk7CiAvKiBGb2xsb3dpbmcgUE0gZnVuY3MgY2FuIGJlIHNoYXJlZCBhbW9u
ZyBWSSBhbmQgQUkgKi8KIHVuc2lnbmVkIGludCBwbV9idWlsZF9wbTRfaGVhZGVyKHVuc2lnbmVk
IGludCBvcGNvZGUsIHNpemVfdCBwYWNrZXRfc2l6ZSk7CiBpbnQgcG1fc2V0X3Jlc291cmNlc192
aShzdHJ1Y3QgcGFja2V0X21hbmFnZXIgKnBtLCB1aW50MzJfdCAqYnVmZmVyLAotCQkJCXN0cnVj
dCBzY2hlZHVsaW5nX3Jlc291cmNlcyAqcmVzKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzdHJ1Y3Qgc2NoZWR1bGluZ19yZXNvdXJjZXMgKnJlcyk7Cit2b2lkIGtmZF9wbV9mdW5j
X2luaXRfdjEwKHN0cnVjdCBwYWNrZXRfbWFuYWdlciAqcG0sIHVpbnQxNl90IGZ3X3Zlcik7CisK
IAogdWludDY0X3Qga2ZkX2dldF9udW1iZXJfZWxlbXMoc3RydWN0IGtmZF9kZXYgKmtmZCk7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wcm9jZXNzLmMgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfcHJvY2Vzcy5jCmluZGV4IDRiZGFlNzhiYWI4
ZS4uODM4Mjc0MmUyOTZhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9r
ZmRfcHJvY2Vzcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wcm9jZXNz
LmMKQEAgLTExMDcsMyArMTEwNyw0IEBAIGludCBrZmRfZGVidWdmc19tcWRzX2J5X3Byb2Nlc3Mo
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogfQogCiAjZW5kaWYKKwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX3RvcG9sb2d5LmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGtmZC9rZmRfdG9wb2xvZ3kuYwppbmRleCAyYzQwYWI0ZmU4ZGUuLmMyZTZl
NDdhYmFmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX3RvcG9s
b2d5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX3RvcG9sb2d5LmMKQEAg
LTEzMjEsNiArMTMyMSw3IEBAIGludCBrZmRfdG9wb2xvZ3lfYWRkX2RldmljZShzdHJ1Y3Qga2Zk
X2RldiAqZ3B1KQogCWNhc2UgQ0hJUF9WRUdBMTI6CiAJY2FzZSBDSElQX1ZFR0EyMDoKIAljYXNl
IENISVBfUkFWRU46CisJY2FzZSBDSElQX05BVkkxMDoKIAkJZGV2LT5ub2RlX3Byb3BzLmNhcGFi
aWxpdHkgfD0gKChIU0FfQ0FQX0RPT1JCRUxMX1RZUEVfMl8wIDw8CiAJCQlIU0FfQ0FQX0RPT1JC
RUxMX1RZUEVfVE9UQUxCSVRTX1NISUZUKSAmCiAJCQlIU0FfQ0FQX0RPT1JCRUxMX1RZUEVfVE9U
QUxCSVRTX01BU0spOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2FtZC1nZng=
