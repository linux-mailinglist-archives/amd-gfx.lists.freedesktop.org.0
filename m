Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 71C883BBDB
	for <lists+amd-gfx@lfdr.de>; Mon, 10 Jun 2019 20:33:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B895F8915A;
	Mon, 10 Jun 2019 18:33:14 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 8A8D48916A;
 Mon, 10 Jun 2019 17:53:34 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id ED62C337;
 Mon, 10 Jun 2019 10:53:33 -0700 (PDT)
Received: from arrakis.emea.arm.com (arrakis.cambridge.arm.com [10.1.196.78])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id
 4ABC63F246; Mon, 10 Jun 2019 10:53:29 -0700 (PDT)
Date: Mon, 10 Jun 2019 18:53:27 +0100
From: Catalin Marinas <catalin.marinas@arm.com>
To: Andrey Konovalov <andreyknvl@google.com>
Subject: Re: [PATCH v16 02/16] arm64: untag user pointers in access_ok and
 __uaccess_mask_ptr
Message-ID: <20190610175326.GC25803@arrakis.emea.arm.com>
References: <cover.1559580831.git.andreyknvl@google.com>
 <4327b260fb17c4776a1e3c844f388e4948cfb747.1559580831.git.andreyknvl@google.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <4327b260fb17c4776a1e3c844f388e4948cfb747.1559580831.git.andreyknvl@google.com>
User-Agent: Mutt/1.10.1 (2018-07-13)
X-Mailman-Approved-At: Mon, 10 Jun 2019 18:33:14 +0000
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>, kvm@vger.kernel.org,
 Szabolcs Nagy <Szabolcs.Nagy@arm.com>, Will Deacon <will.deacon@arm.com>,
 dri-devel@lists.freedesktop.org, linux-mm@kvack.org,
 Khalid Aziz <khalid.aziz@oracle.com>, linux-kselftest@vger.kernel.org,
 Felix Kuehling <Felix.Kuehling@amd.com>,
 Vincenzo Frascino <vincenzo.frascino@arm.com>,
 Jacob Bramley <Jacob.Bramley@arm.com>, Leon Romanovsky <leon@kernel.org>,
 linux-rdma@vger.kernel.org, amd-gfx@lists.freedesktop.org,
 Christoph Hellwig <hch@infradead.org>, Jason Gunthorpe <jgg@ziepe.ca>,
 Dmitry Vyukov <dvyukov@google.com>, Dave Martin <Dave.Martin@arm.com>,
 Evgeniy Stepanov <eugenis@google.com>, linux-media@vger.kernel.org,
 Kevin Brodsky <kevin.brodsky@arm.com>, Kees Cook <keescook@chromium.org>,
 Ruben Ayrapetyan <Ruben.Ayrapetyan@arm.com>,
 Ramana Radhakrishnan <Ramana.Radhakrishnan@arm.com>,
 Alex Williamson <alex.williamson@redhat.com>,
 Mauro Carvalho Chehab <mchehab@kernel.org>,
 linux-arm-kernel@lists.infradead.org, Kostya Serebryany <kcc@google.com>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Yishai Hadas <yishaih@mellanox.com>, linux-kernel@vger.kernel.org,
 Jens Wiklander <jens.wiklander@linaro.org>, Lee Smith <Lee.Smith@arm.com>,
 Alexander Deucher <Alexander.Deucher@amd.com>,
 Andrew Morton <akpm@linux-foundation.org>, enh <enh@google.com>,
 Robin Murphy <robin.murphy@arm.com>,
 Christian Koenig <Christian.Koenig@amd.com>,
 Luc Van Oostenryck <luc.vanoostenryck@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

T24gTW9uLCBKdW4gMDMsIDIwMTkgYXQgMDY6NTU6MDRQTSArMDIwMCwgQW5kcmV5IEtvbm92YWxv
diB3cm90ZToKPiBkaWZmIC0tZ2l0IGEvYXJjaC9hcm02NC9pbmNsdWRlL2FzbS91YWNjZXNzLmgg
Yi9hcmNoL2FybTY0L2luY2x1ZGUvYXNtL3VhY2Nlc3MuaAo+IGluZGV4IGU1ZDVmMzFjNmQzNi4u
OTE2NGVjYjVmZWNhIDEwMDY0NAo+IC0tLSBhL2FyY2gvYXJtNjQvaW5jbHVkZS9hc20vdWFjY2Vz
cy5oCj4gKysrIGIvYXJjaC9hcm02NC9pbmNsdWRlL2FzbS91YWNjZXNzLmgKPiBAQCAtOTQsNyAr
OTQsNyBAQCBzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGxvbmcgX19yYW5nZV9vayhjb25zdCB2b2lk
IF9fdXNlciAqYWRkciwgdW5zaWduZWQgbG9uZyBzaQo+ICAJcmV0dXJuIHJldDsKPiAgfQo+ICAK
PiAtI2RlZmluZSBhY2Nlc3Nfb2soYWRkciwgc2l6ZSkJX19yYW5nZV9vayhhZGRyLCBzaXplKQo+
ICsjZGVmaW5lIGFjY2Vzc19vayhhZGRyLCBzaXplKQlfX3JhbmdlX29rKHVudGFnZ2VkX2FkZHIo
YWRkciksIHNpemUpCgpJJ20gZ29pbmcgdG8gcHJvcG9zZSBhbiBvcHQtaW4gbWV0aG9kIGhlcmUg
KFJGQyBmb3Igbm93KS4gV2UgY2FuJ3QgaGF2ZQphIGNoZWNrIGluIHVudGFnZ2VkX2FkZHIoKSBz
aW5jZSB0aGlzIGlzIGFscmVhZHkgdXNlZCB0aHJvdWdob3V0IHRoZQprZXJuZWwgZm9yIGJvdGgg
dXNlciBhbmQga2VybmVsIGFkZHJlc3NlcyAoa2h3YXNhbikgYnV0IHdlIGNhbiBhZGQgb25lCmlu
IF9fcmFuZ2Vfb2soKS4gVGhlIHNhbWUgcHJjdGwoKSBvcHRpb24gd2lsbCBiZSB1c2VkIGZvciBj
b250cm9sbGluZwp0aGUgcHJlY2lzZS9pbXByZWNpc2UgbW9kZSBvZiBNVEUgbGF0ZXIgb24uIFdl
IGNhbiB1c2UgYSBUSUZfIGZsYWcgaGVyZQphc3N1bWluZyB0aGF0IHRoaXMgd2lsbCBiZSBjYWxs
ZWQgZWFybHkgb24gYW5kIGFueSBjbG9uZWQgdGhyZWFkIHdpbGwKaW5oZXJpdCB0aGlzLgoKQW55
d2F5LCBpdCdzIGVhc2llciB0byBwYXN0ZSBzb21lIGRpZmYgdGhhbiBleHBsYWluIGJ1dCBWaW5j
ZW56byBjYW4KZm9sZCB0aGVtIGludG8gaGlzIEFCSSBwYXRjaGVzIHRoYXQgc2hvdWxkIHJlYWxs
eSBnbyB0b2dldGhlciB3aXRoCnRoZXNlLiBJIGFkZGVkIGEgY291cGxlIG9mIE1URSBkZWZpbml0
aW9ucyBmb3IgcHJjdGwoKSBhcyBhbiBleGFtcGxlLApub3QgdXNlZCBjdXJyZW50bHk6CgotLS0t
LS0tLS0tLS0tLS0tLS04PC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQpkaWZmIC0tZ2l0IGEvYXJjaC9hcm02NC9pbmNsdWRlL2FzbS9wcm9jZXNzb3IuaCBiL2Fy
Y2gvYXJtNjQvaW5jbHVkZS9hc20vcHJvY2Vzc29yLmgKaW5kZXggZmNkMGU2OTFiMWVhLi4yZDRj
YjdlNGVkYWIgMTAwNjQ0Ci0tLSBhL2FyY2gvYXJtNjQvaW5jbHVkZS9hc20vcHJvY2Vzc29yLmgK
KysrIGIvYXJjaC9hcm02NC9pbmNsdWRlL2FzbS9wcm9jZXNzb3IuaApAQCAtMzA3LDYgKzMwNywx
MCBAQCBleHRlcm4gdm9pZCBfX2luaXQgbWluc2lnc3Rrc3pfc2V0dXAodm9pZCk7CiAvKiBQUl9Q
QUNfUkVTRVRfS0VZUyBwcmN0bCAqLwogI2RlZmluZSBQQUNfUkVTRVRfS0VZUyh0c2ssIGFyZykJ
cHRyYXV0aF9wcmN0bF9yZXNldF9rZXlzKHRzaywgYXJnKQogCisvKiBQUl9VTlRBR0dFRF9VQURE
UiBwcmN0bCAqLworaW50IHVudGFnZ2VkX3VhZGRyX3NldF9tb2RlKHVuc2lnbmVkIGxvbmcgYXJn
KTsKKyNkZWZpbmUgU0VUX1VOVEFHR0VEX1VBRERSX01PREUoYXJnKQl1bnRhZ2dlZF91YWRkcl9z
ZXRfbW9kZShhcmcpCisKIC8qCiAgKiBGb3IgQ09ORklHX0dDQ19QTFVHSU5fU1RBQ0tMRUFLCiAg
KgpkaWZmIC0tZ2l0IGEvYXJjaC9hcm02NC9pbmNsdWRlL2FzbS90aHJlYWRfaW5mby5oIGIvYXJj
aC9hcm02NC9pbmNsdWRlL2FzbS90aHJlYWRfaW5mby5oCmluZGV4IGMyODVkMWNlNzE4Ni4uODlj
ZTc3NzczYzQ5IDEwMDY0NAotLS0gYS9hcmNoL2FybTY0L2luY2x1ZGUvYXNtL3RocmVhZF9pbmZv
LmgKKysrIGIvYXJjaC9hcm02NC9pbmNsdWRlL2FzbS90aHJlYWRfaW5mby5oCkBAIC0xMDEsNiAr
MTAxLDcgQEAgdm9pZCBhcmNoX3JlbGVhc2VfdGFza19zdHJ1Y3Qoc3RydWN0IHRhc2tfc3RydWN0
ICp0c2spOwogI2RlZmluZSBUSUZfU1ZFCQkJMjMJLyogU2NhbGFibGUgVmVjdG9yIEV4dGVuc2lv
biBpbiB1c2UgKi8KICNkZWZpbmUgVElGX1NWRV9WTF9JTkhFUklUCTI0CS8qIEluaGVyaXQgc3Zl
X3ZsX29uZXhlYyBhY3Jvc3MgZXhlYyAqLwogI2RlZmluZSBUSUZfU1NCRAkJMjUJLyogV2FudHMg
U1NCIG1pdGlnYXRpb24gKi8KKyNkZWZpbmUgVElGX1VOVEFHR0VEX1VBRERSCTI2CiAKICNkZWZp
bmUgX1RJRl9TSUdQRU5ESU5HCQkoMSA8PCBUSUZfU0lHUEVORElORykKICNkZWZpbmUgX1RJRl9O
RUVEX1JFU0NIRUQJKDEgPDwgVElGX05FRURfUkVTQ0hFRCkKQEAgLTExNiw2ICsxMTcsNyBAQCB2
b2lkIGFyY2hfcmVsZWFzZV90YXNrX3N0cnVjdChzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRzayk7CiAj
ZGVmaW5lIF9USUZfRlNDSEVDSwkJKDEgPDwgVElGX0ZTQ0hFQ0spCiAjZGVmaW5lIF9USUZfMzJC
SVQJCSgxIDw8IFRJRl8zMkJJVCkKICNkZWZpbmUgX1RJRl9TVkUJCSgxIDw8IFRJRl9TVkUpCisj
ZGVmaW5lIF9USUZfVU5UQUdHRURfVUFERFIJKDEgPDwgVElGX1VOVEFHR0VEX1VBRERSKQogCiAj
ZGVmaW5lIF9USUZfV09SS19NQVNLCQkoX1RJRl9ORUVEX1JFU0NIRUQgfCBfVElGX1NJR1BFTkRJ
TkcgfCBcCiAJCQkJIF9USUZfTk9USUZZX1JFU1VNRSB8IF9USUZfRk9SRUlHTl9GUFNUQVRFIHwg
XApkaWZmIC0tZ2l0IGEvYXJjaC9hcm02NC9pbmNsdWRlL2FzbS91YWNjZXNzLmggYi9hcmNoL2Fy
bTY0L2luY2x1ZGUvYXNtL3VhY2Nlc3MuaAppbmRleCA5MTY0ZWNiNWZlY2EuLjU0ZjViYmFlYmJj
NCAxMDA2NDQKLS0tIGEvYXJjaC9hcm02NC9pbmNsdWRlL2FzbS91YWNjZXNzLmgKKysrIGIvYXJj
aC9hcm02NC9pbmNsdWRlL2FzbS91YWNjZXNzLmgKQEAgLTczLDYgKzczLDkgQEAgc3RhdGljIGlu
bGluZSB1bnNpZ25lZCBsb25nIF9fcmFuZ2Vfb2soY29uc3Qgdm9pZCBfX3VzZXIgKmFkZHIsIHVu
c2lnbmVkIGxvbmcgc2kKIHsKIAl1bnNpZ25lZCBsb25nIHJldCwgbGltaXQgPSBjdXJyZW50X3Ro
cmVhZF9pbmZvKCktPmFkZHJfbGltaXQ7CiAKKwlpZiAodGVzdF90aHJlYWRfZmxhZyhUSUZfVU5U
QUdHRURfVUFERFIpKQorCQlhZGRyID0gdW50YWdnZWRfYWRkcihhZGRyKTsKKwogCV9fY2hrX3Vz
ZXJfcHRyKGFkZHIpOwogCWFzbSB2b2xhdGlsZSgKIAkvLyBBICsgQiA8PSBDICsgMSBmb3IgYWxs
IEEsQixDLCBpbiBmb3VyIGVhc3kgc3RlcHM6CkBAIC05NCw3ICs5Nyw3IEBAIHN0YXRpYyBpbmxp
bmUgdW5zaWduZWQgbG9uZyBfX3JhbmdlX29rKGNvbnN0IHZvaWQgX191c2VyICphZGRyLCB1bnNp
Z25lZCBsb25nIHNpCiAJcmV0dXJuIHJldDsKIH0KIAotI2RlZmluZSBhY2Nlc3Nfb2soYWRkciwg
c2l6ZSkJX19yYW5nZV9vayh1bnRhZ2dlZF9hZGRyKGFkZHIpLCBzaXplKQorI2RlZmluZSBhY2Nl
c3Nfb2soYWRkciwgc2l6ZSkJX19yYW5nZV9vayhhZGRyLCBzaXplKQogI2RlZmluZSB1c2VyX2Fk
ZHJfbWF4CQkJZ2V0X2ZzCiAKICNkZWZpbmUgX0FTTV9FWFRBQkxFKGZyb20sIHRvKQkJCQkJCVwK
ZGlmZiAtLWdpdCBhL2FyY2gvYXJtNjQva2VybmVsL3Byb2Nlc3MuYyBiL2FyY2gvYXJtNjQva2Vy
bmVsL3Byb2Nlc3MuYwppbmRleCAzNzY3ZmIyMWE1YjguLmZkMTkxYzViOTJhYSAxMDA2NDQKLS0t
IGEvYXJjaC9hcm02NC9rZXJuZWwvcHJvY2Vzcy5jCisrKyBiL2FyY2gvYXJtNjQva2VybmVsL3By
b2Nlc3MuYwpAQCAtNTUyLDMgKzU1MiwxOCBAQCB2b2lkIGFyY2hfc2V0dXBfbmV3X2V4ZWModm9p
ZCkKIAogCXB0cmF1dGhfdGhyZWFkX2luaXRfdXNlcihjdXJyZW50KTsKIH0KKworLyoKKyAqIEVu
YWJsZSB0aGUgcmVsYXhlZCBBQkkgYWxsb3dpbmcgdGFnZ2VkIHVzZXIgYWRkcmVzc2VzIGludG8g
dGhlIGtlcm5lbC4KKyAqLworaW50IHVudGFnZ2VkX3VhZGRyX3NldF9tb2RlKHVuc2lnbmVkIGxv
bmcgYXJnKQoreworCWlmIChpc19jb21wYXRfdGFzaygpKQorCQlyZXR1cm4gLUVOT1RTVVBQOwor
CWlmIChhcmcpCisJCXJldHVybiAtRUlOVkFMOworCisJc2V0X3RocmVhZF9mbGFnKFRJRl9VTlRB
R0dFRF9VQUREUik7CisKKwlyZXR1cm4gMDsKK30KZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9s
aW51eC9wcmN0bC5oIGIvaW5jbHVkZS91YXBpL2xpbnV4L3ByY3RsLmgKaW5kZXggMDk0YmIwM2I5
Y2MyLi40YWZkNWUyOTgwZWUgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFwaS9saW51eC9wcmN0bC5o
CisrKyBiL2luY2x1ZGUvdWFwaS9saW51eC9wcmN0bC5oCkBAIC0yMjksNCArMjI5LDkgQEAgc3Ry
dWN0IHByY3RsX21tX21hcCB7CiAjIGRlZmluZSBQUl9QQUNfQVBEQktFWQkJCSgxVUwgPDwgMykK
ICMgZGVmaW5lIFBSX1BBQ19BUEdBS0VZCQkJKDFVTCA8PCA0KQogCisvKiBVbnRhZ2dlZCB1c2Vy
IGFkZHJlc3NlcyBmb3IgYXJtNjQgKi8KKyNkZWZpbmUgUFJfVU5UQUdHRURfVUFERFIJCTU1Cisj
IGRlZmluZSBQUl9NVEVfSU1QUkVDSVNFX0NIRUNLCQkwCisjIGRlZmluZSBQUl9NVEVfUFJFQ0lT
RV9DSEVDSwkJMQorCiAjZW5kaWYgLyogX0xJTlVYX1BSQ1RMX0ggKi8KZGlmZiAtLWdpdCBhL2tl
cm5lbC9zeXMuYyBiL2tlcm5lbC9zeXMuYwppbmRleCAyOTY5MzA0YzI5ZmUuLmIxZjY3YThjZmZj
NCAxMDA2NDQKLS0tIGEva2VybmVsL3N5cy5jCisrKyBiL2tlcm5lbC9zeXMuYwpAQCAtMTI0LDYg
KzEyNCw5IEBACiAjaWZuZGVmIFBBQ19SRVNFVF9LRVlTCiAjIGRlZmluZSBQQUNfUkVTRVRfS0VZ
UyhhLCBiKQkoLUVJTlZBTCkKICNlbmRpZgorI2lmbmRlZiBTRVRfVU5UQUdHRURfVUFERFJfTU9E
RQorIyBkZWZpbmUgU0VUX1VOVEFHR0VEX1VBRERSX01PREUJKC1FSU5WQUwpCisjZW5kaWYKIAog
LyoKICAqIHRoaXMgaXMgd2hlcmUgdGhlIHN5c3RlbS13aWRlIG92ZXJmbG93IFVJRCBhbmQgR0lE
IGFyZSBkZWZpbmVkLCBmb3IKQEAgLTI0OTIsNiArMjQ5NSwxMSBAQCBTWVNDQUxMX0RFRklORTUo
cHJjdGwsIGludCwgb3B0aW9uLCB1bnNpZ25lZCBsb25nLCBhcmcyLCB1bnNpZ25lZCBsb25nLCBh
cmczLAogCQkJcmV0dXJuIC1FSU5WQUw7CiAJCWVycm9yID0gUEFDX1JFU0VUX0tFWVMobWUsIGFy
ZzIpOwogCQlicmVhazsKKwljYXNlIFBSX1VOVEFHR0VEX1VBRERSOgorCQlpZiAoYXJnMyB8fCBh
cmc0IHx8IGFyZzUpCisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJZXJyb3IgPSBTRVRfVU5UQUdHRURf
VUFERFJfTU9ERShhcmcyKTsKKwkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJZXJyb3IgPSAtRUlOVkFM
OwogCQlicmVhazsKLS0tLS0tLS0tLS0tLS0tLS0tODwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0KClRoZSB0YWdfcHRyKCkgZnVuY3Rpb24gaW4gdGhlIHRlc3Qg
bGlicmFyeSB3b3VsZCBiZWNvbWU6CgpzdGF0aWMgdm9pZCAqdGFnX3B0cih2b2lkICpwdHIpCnsK
CXN0YXRpYyBpbnQgdGJpX2VuYWJsZWQgPSAwOwoJdW5zaWduZWQgbG9uZyB0YWcgPSAwOwoKCWlm
ICghdGJpX2VuYWJsZWQpIHsKCQlpZiAocHJjdGwoUFJfVU5UQUdHRURfVUFERFIsIDAsIDAsIDAs
IDApID09IDApCgkJCXRiaV9lbmFibGVkID0gMTsKCX0KCglpZiAoIXB0cikKCQlyZXR1cm4gcHRy
OwoJaWYgKHRiaV9lbmFibGVkKQoJCXRhZyA9IHJhbmQoKSAmIDB4ZmY7CgoJcmV0dXJuICh2b2lk
ICopKCh1bnNpZ25lZCBsb25nKXB0ciB8ICh0YWcgPDwgVEFHX1NISUZUKSk7Cn0KCi0tIApDYXRh
bGluCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1n
ZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
