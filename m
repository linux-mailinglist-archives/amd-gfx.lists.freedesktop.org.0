Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C3286242C67
	for <lists+amd-gfx@lfdr.de>; Wed, 12 Aug 2020 17:56:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 41B2A89DE6;
	Wed, 12 Aug 2020 15:56:01 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wr1-x444.google.com (mail-wr1-x444.google.com
 [IPv6:2a00:1450:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E2C1F89DE6
 for <amd-gfx@lists.freedesktop.org>; Wed, 12 Aug 2020 15:55:58 +0000 (UTC)
Received: by mail-wr1-x444.google.com with SMTP id a15so2503870wrh.10
 for <amd-gfx@lists.freedesktop.org>; Wed, 12 Aug 2020 08:55:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc:content-transfer-encoding;
 bh=HkZoqCFCekDx7IgkAmPlhKdtPWEvZzEp+Fi8geVVf18=;
 b=SqXqRdh6Q+bvmkotUv0HNPnb4pktM29xSGbJRUyLiB287I0FYZrkh0XzvJiDP/Px05
 q1mWhCy4kJiwRGBQSBVpVv2xVAU0xdyY3tWCNEHqgit3vzWAcw0sAfxHgM1xPPfSVcYM
 yaHO2zKP6WasIhc1gUbT8Vw1s+n/CTOueFMBd3BvdYEK5/IBI+E+MBY4OWPMgAho9OyP
 /cWlvMSVHxAORgXvaN/Weshd/OgjqfoOuJfwQsqP//dwUE2YbJRKUAzbIkhPloOfcl5T
 vYYRgU0/jdsKeQuMMuW59DbX0tJC028ZU6uVb3J3t5JgQASvPMmeQoFwVSfezGucIO2N
 iAYQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=HkZoqCFCekDx7IgkAmPlhKdtPWEvZzEp+Fi8geVVf18=;
 b=WAarfKlOW/1wrgQrbMo9c8eHuujKgGZzWfJ8XzpIyjD+EQVpQ3KHJnFkRUzlO41R4G
 YutHSOixebe+Sq3m7yYgYeBKOX0+BS/7LfnqfDRDVxLr+a8R4gbrDjsN3qgQrKxbbBRL
 b8TlbocYQ0sY5adI9KjPOZbyaGdUcniUVgONvGJwgacXhXu6zALYRcIm5fkvqGrGKkvK
 TZ9G1HwijpQTXFAieR/vs2oZNaQiWrEgonEzMa30+ecgGqCNLkJY3IH2bEBLDyU2rq3G
 E02YjRDvH7jLlbJFasFWqEih+oqiMWylq/P2o61UwV6d86RqENhzLLBIXIBaJa6ro1IV
 MZ3Q==
X-Gm-Message-State: AOAM532S0b8i4syFvFk4i0waG+KVmE+CTrnRw5+BxR4cGVq3r0ltZBM2
 QR4PcUUcRulmJDG7fpT2smolww8GWj3jrfAKSG8=
X-Google-Smtp-Source: ABdhPJye3AdwZlpNcYF1aS/x7oSbGQiFBlUWQmlT2/Dqm9TkAzZdn1hnx8my1vVNyjU2q0Q0vdxy+su8bVV7Bs6pTAY=
X-Received: by 2002:a5d:494b:: with SMTP id r11mr247000wrs.419.1597247754960; 
 Wed, 12 Aug 2020 08:55:54 -0700 (PDT)
MIME-Version: 1.0
References: <20200812155353.105959-1-christian.koenig@amd.com>
In-Reply-To: <20200812155353.105959-1-christian.koenig@amd.com>
From: Alex Deucher <alexdeucher@gmail.com>
Date: Wed, 12 Aug 2020 11:55:42 -0400
Message-ID: <CADnq5_OeVF-YZu=dcFWa-GYexJ744AQGxd6D3owihrZftjc4Ew@mail.gmail.com>
Subject: Re: [PATCH] drm/amdgpu: revert "fix system hang issue during GPU
 reset"
To: =?UTF-8?Q?Christian_K=C3=B6nig?= <ckoenig.leichtzumerken@gmail.com>
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: amd-gfx list <amd-gfx@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

T24gV2VkLCBBdWcgMTIsIDIwMjAgYXQgMTE6NTQgQU0gQ2hyaXN0aWFuIEvDtm5pZwo8Y2tvZW5p
Zy5sZWljaHR6dW1lcmtlbkBnbWFpbC5jb20+IHdyb3RlOgo+Cj4gVGhlIHdob2xlIGFwcHJvYWNo
IHdhc24ndCB0aG91Z2h0IHRocm91Z2ggdGlsbCB0aGUgZW5kLgo+Cj4gV2UgYWxyZWFkeSBoYWQg
YSByZXNldCBsb2NrIGxpa2UgdGhpcyBpbiB0aGUgcGFzdCBhbmQgaXQgY2F1c2VkIHRoZSBzYW1l
IHByb2JsZW1zIGxpa2UgdGhpcyBvbmUuCj4KPiBDb21wbGV0ZWx5IHJldmVydCB0aGUgcGF0Y2gg
Zm9yIG5vdyBhbmQgYWRkIGluZGl2aWR1YWwgdHJ5bG9jayBwcm90ZWN0aW9uIHRvIHRoZSBoYXJk
d2FyZSBhY2Nlc3MgZnVuY3Rpb25zIGFzIG5lY2Vzc2FyeS4KPgo+IFRoaXMgcmV2ZXJ0cyBjb21t
aXQgZWRhZDgzMTJjYmJmOWEzM2M4Njg3M2ZjNDA5MzY2NGYxNTBkZDVjMS4KPgo+IFNpZ25lZC1v
ZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KClRoaXMg
YWxzbyBicm9rZSBHUFUgb3ZlcmNsb2NraW5nLgoKQWNrZWQtYnk6IEFsZXggRGV1Y2hlciA8YWxl
eGFuZGVyLmRldWNoZXJAYW1kLmNvbT4KCj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdS5oICAgICAgICAgICB8ICAgOSArLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfYW1ka2ZkLmMgICAgfCAgNDAgKy0KPiAgLi4uL2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9hbWRrZmRfZ2Z4X3YxMC5jICAgIHwgICAyICstCj4gIC4uLi9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2FtZGtmZF9nZnhfdjcuYyB8ICAgMiArLQo+ICAuLi4vZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3Y4LmMgfCAgIDIgKy0KPiAgLi4uL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92OS5jIHwgICAyICstCj4gIC4uLi9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jICB8ICAgNyAtCj4gIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9jcy5jICAgICAgICB8ICAgNCAtCj4gIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9jdHguYyAgICAgICB8ICAgNCAtCj4gIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9kZWJ1Z2ZzLmMgICB8ICAxNCArLQo+ICBkcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMgICAgfCAgNTcgKystCj4gIGRyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9nZW0uYyAgICAgICB8ICAgNCAtCj4gIGRyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9nZnguYyAgICAgICB8ICAgNiArLQo+ICBkcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMgICAgICAgfCAgMTQgKy0KPiAgZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jICAgICAgIHwgICA0IC0KPiAgZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3BtLmMgICAgICAgIHwgMzUzICsrKystLS0tLS0tLS0tLS0t
LQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcHNwLmMgICAgICAgfCAgIDQg
Ky0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Jhcy5jICAgICAgIHwgICA0
ICstCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyAgICAgICB8ICAg
MiArLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdWNvZGUuYyAgICAgfCAg
IDMgKy0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQuYyAgICAgIHwg
ICAyICstCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92aXJ0LmggICAgICB8
ICAgNCArLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfeGdtaS5jICAgICAg
fCAgMTEgKy0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3hnbWkuaCAgICAg
IHwgICAzICstCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2F0b20uYyAgICAgICAgICAg
ICB8ICAgMSAtCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92MTBfMC5jICAgICAg
ICB8ICAxMCArLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjhfMC5jICAgICAg
ICAgfCAgIDYgKy0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYyAgICAg
ICAgIHwgIDEwICstCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192MTBfMC5jICAg
ICAgICB8ICAgNCArLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjdfMC5jICAg
ICAgICAgfCAgIDIgKy0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y4XzAuYyAg
ICAgICAgIHwgICAyICstCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8wLmMg
ICAgICAgICB8ICAgNyArLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9teGdwdV9haS5j
ICAgICAgICAgfCAgMTMgKy0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvbXhncHVfbnYu
YyAgICAgICAgIHwgIDEzICstCj4gIC4uLi9kcm0vYW1kL2FtZGtmZC9rZmRfZGV2aWNlX3F1ZXVl
X21hbmFnZXIuYyB8ICAxNiArLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfcHJv
Y2Vzcy5jICAgICAgfCAgIDQgLQo+ICAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0v
YW1kZ3B1X2RtLmMgfCAgIDQgKy0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1k
Z3B1X3NtdS5jICAgIHwgICAyICstCj4gIC4uLi9kcm0vYW1kL3Bvd2VycGxheS9od21nci92ZWdh
MjBfaHdtZ3IuYyAgICB8ICAgMiArLQo+ICAzOSBmaWxlcyBjaGFuZ2VkLCAxODQgaW5zZXJ0aW9u
cygrKSwgNDY5IGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmgK
PiBpbmRleCAxZjlkOTdmNjFhYTUuLjljNmZiMzhjZTU5ZCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdS5oCj4gQEAgLTk1Miw5ICs5NTIsOSBAQCBzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSB7Cj4gICAgICAgICBib29sICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX3N1c3BlbmQ7
Cj4gICAgICAgICBib29sICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2hpYmVybmF0ZTsK
Pgo+IC0gICAgICAgYXRvbWljX3QgICAgICAgICAgICAgICAgICAgICAgICBpbl9ncHVfcmVzZXQ7
Cj4gKyAgICAgICBib29sICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX2dwdV9yZXNldDsK
PiAgICAgICAgIGVudW0gcHBfbXAxX3N0YXRlICAgICAgICAgICAgICAgbXAxX3N0YXRlOwo+IC0g
ICAgICAgc3RydWN0IHJ3X3NlbWFwaG9yZSAgICAgcmVzZXRfc2VtOwo+ICsgICAgICAgc3RydWN0
IG11dGV4ICBsb2NrX3Jlc2V0Owo+ICAgICAgICAgc3RydWN0IGFtZGdwdV9kb29yYmVsbF9pbmRl
eCBkb29yYmVsbF9pbmRleDsKPgo+ICAgICAgICAgc3RydWN0IG11dGV4ICAgICAgICAgICAgICAg
ICAgICBub3RpZmllcl9sb2NrOwo+IEBAIC0xMjY5LDkgKzEyNjksNCBAQCBzdGF0aWMgaW5saW5l
IGJvb2wgYW1kZ3B1X2lzX3RteihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKPiAgICAgICAg
IHJldHVybiBhZGV2LT5nbWMudG16X2VuYWJsZWQ7Cj4gIH0KPgo+IC1zdGF0aWMgaW5saW5lIGJv
b2wgYW1kZ3B1X2luX3Jlc2V0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQo+IC17Cj4gLSAg
ICAgICByZXR1cm4gYXRvbWljX3JlYWQoJmFkZXYtPmluX2dwdV9yZXNldCkgPyB0cnVlIDogZmFs
c2U7Cj4gLX0KPiAtCj4gICNlbmRpZgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfYW1ka2ZkLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfYW1ka2ZkLmMKPiBpbmRleCA5NzM4ZGNjYjFjMmMuLjBlZmZjMWQ0NjgyNCAxMDA2NDQKPiAt
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkLmMKPiArKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkLmMKPiBAQCAtMjQ0LDE0ICsy
NDQsMTEgQEAgaW50IGFtZGdwdV9hbWRrZmRfYWxsb2NfZ3R0X21lbShzdHJ1Y3Qga2dkX2RldiAq
a2dkLCBzaXplX3Qgc2l6ZSwKPiAgICAgICAgIGlmIChjcF9tcWRfZ2Z4OSkKPiAgICAgICAgICAg
ICAgICAgYnAuZmxhZ3MgfD0gQU1ER1BVX0dFTV9DUkVBVEVfQ1BfTVFEX0dGWDk7Cj4KPiAtICAg
ICAgIGlmICghZG93bl9yZWFkX3RyeWxvY2soJmFkZXYtPnJlc2V0X3NlbSkpCj4gLSAgICAgICAg
ICAgICAgIHJldHVybiAtRUlPOwo+IC0KPiAgICAgICAgIHIgPSBhbWRncHVfYm9fY3JlYXRlKGFk
ZXYsICZicCwgJmJvKTsKPiAgICAgICAgIGlmIChyKSB7Cj4gICAgICAgICAgICAgICAgIGRldl9l
cnIoYWRldi0+ZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICJmYWlsZWQgdG8gYWxsb2Nh
dGUgQk8gZm9yIGFtZGtmZCAoJWQpXG4iLCByKTsKPiAtICAgICAgICAgICAgICAgZ290byBlcnI7
Cj4gKyAgICAgICAgICAgICAgIHJldHVybiByOwo+ICAgICAgICAgfQo+Cj4gICAgICAgICAvKiBt
YXAgdGhlIGJ1ZmZlciAqLwo+IEBAIC0yODYsNyArMjgzLDYgQEAgaW50IGFtZGdwdV9hbWRrZmRf
YWxsb2NfZ3R0X21lbShzdHJ1Y3Qga2dkX2RldiAqa2dkLCBzaXplX3Qgc2l6ZSwKPgo+ICAgICAg
ICAgYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7Cj4KPiAtICAgICAgIHVwX3JlYWQoJmFkZXYtPnJl
c2V0X3NlbSk7Cj4gICAgICAgICByZXR1cm4gMDsKPgo+ICBhbGxvY2F0ZV9tZW1fa21hcF9ib19m
YWlsZWQ6Cj4gQEAgLTI5NSwyNSArMjkxLDE5IEBAIGludCBhbWRncHVfYW1ka2ZkX2FsbG9jX2d0
dF9tZW0oc3RydWN0IGtnZF9kZXYgKmtnZCwgc2l6ZV90IHNpemUsCj4gICAgICAgICBhbWRncHVf
Ym9fdW5yZXNlcnZlKGJvKTsKPiAgYWxsb2NhdGVfbWVtX3Jlc2VydmVfYm9fZmFpbGVkOgo+ICAg
ICAgICAgYW1kZ3B1X2JvX3VucmVmKCZibyk7Cj4gLWVycjoKPiAtICAgICAgIHVwX3JlYWQoJmFk
ZXYtPnJlc2V0X3NlbSk7Cj4gKwo+ICAgICAgICAgcmV0dXJuIHI7Cj4gIH0KPgo+ICB2b2lkIGFt
ZGdwdV9hbWRrZmRfZnJlZV9ndHRfbWVtKHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHZvaWQgKm1lbV9v
YmopCj4gIHsKPiAtICAgICAgIHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBh
bWRncHVfZGV2aWNlICopa2dkOwo+ICAgICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8gPSAoc3Ry
dWN0IGFtZGdwdV9ibyAqKSBtZW1fb2JqOwo+Cj4gLSAgICAgICBkb3duX3JlYWQoJmFkZXYtPnJl
c2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgYW1kZ3B1X2JvX3Jlc2VydmUoYm8sIHRydWUpOwo+ICAg
ICAgICAgYW1kZ3B1X2JvX2t1bm1hcChibyk7Cj4gICAgICAgICBhbWRncHVfYm9fdW5waW4oYm8p
Owo+ICAgICAgICAgYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7Cj4gICAgICAgICBhbWRncHVfYm9f
dW5yZWYoJihibykpOwo+IC0KPiAtICAgICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4g
IH0KPgo+ICBpbnQgYW1kZ3B1X2FtZGtmZF9hbGxvY19nd3Moc3RydWN0IGtnZF9kZXYgKmtnZCwg
c2l6ZV90IHNpemUsCj4gQEAgLTM0NSwxNCArMzM1LDkgQEAgaW50IGFtZGdwdV9hbWRrZmRfYWxs
b2NfZ3dzKHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHNpemVfdCBzaXplLAo+Cj4gIHZvaWQgYW1kZ3B1
X2FtZGtmZF9mcmVlX2d3cyhzdHJ1Y3Qga2dkX2RldiAqa2dkLCB2b2lkICptZW1fb2JqKQo+ICB7
Cj4gLSAgICAgICBzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqKWtnZDsKPiAgICAgICAgIHN0cnVjdCBhbWRncHVfYm8gKmJvID0gKHN0cnVjdCBhbWRn
cHVfYm8gKiltZW1fb2JqOwo+Cj4gLSAgICAgICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7
Cj4gLQo+ICAgICAgICAgYW1kZ3B1X2JvX3VucmVmKCZibyk7Cj4gLQo+IC0gICAgICAgdXBfcmVh
ZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgfQo+Cj4gIHVpbnQzMl90IGFtZGdwdV9hbWRrZmRfZ2V0
X2Z3X3ZlcnNpb24oc3RydWN0IGtnZF9kZXYgKmtnZCwKPiBAQCAtNjI2LDE1ICs2MTEsOCBAQCBp
bnQgYW1kZ3B1X2FtZGtmZF9zdWJtaXRfaWIoc3RydWN0IGtnZF9kZXYgKmtnZCwgZW51bSBrZ2Rf
ZW5naW5lX3R5cGUgZW5naW5lLAo+ICAgICAgICAgLyogVGhpcyB3b3JrcyBmb3IgTk9fSFdTLiBU
T0RPOiBuZWVkIHRvIGhhbmRsZSB3aXRob3V0IGtub3dpbmcgVk1JRCAqLwo+ICAgICAgICAgam9i
LT52bWlkID0gdm1pZDsKPgo+IC0gICAgICAgaWYgKCFkb3duX3JlYWRfdHJ5bG9jaygmYWRldi0+
cmVzZXRfc2VtKSkgewo+IC0gICAgICAgICAgICAgICByZXQgPSAtRUlPOwo+IC0gICAgICAgICAg
ICAgICBnb3RvIGVycl9pYl9zY2hlZDsKPiAtICAgICAgIH0KPiAtCj4gICAgICAgICByZXQgPSBh
bWRncHVfaWJfc2NoZWR1bGUocmluZywgMSwgaWIsIGpvYiwgJmYpOwo+Cj4gLSAgICAgICB1cF9y
ZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChyZXQpIHsKPiAgICAgICAg
ICAgICAgICAgRFJNX0VSUk9SKCJhbWRncHU6IGZhaWxlZCB0byBzY2hlZHVsZSBJQi5cbiIpOwo+
ICAgICAgICAgICAgICAgICBnb3RvIGVycl9pYl9zY2hlZDsKPiBAQCAtNjcwLDkgKzY0OCw2IEBA
IGludCBhbWRncHVfYW1ka2ZkX2ZsdXNoX2dwdV90bGJfdm1pZChzdHJ1Y3Qga2dkX2RldiAqa2dk
LCB1aW50MTZfdCB2bWlkKQo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
diA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWtnZDsKPgo+IC0gICAgICAgaWYgKCFkb3duX3Jl
YWRfdHJ5bG9jaygmYWRldi0+cmVzZXRfc2VtKSkKPiAtICAgICAgICAgICAgICAgcmV0dXJuIC1F
SU87Cj4gLQo+ICAgICAgICAgaWYgKGFkZXYtPmZhbWlseSA9PSBBTURHUFVfRkFNSUxZX0FJKSB7
Cj4gICAgICAgICAgICAgICAgIGludCBpOwo+Cj4gQEAgLTY4Miw4ICs2NTcsNiBAQCBpbnQgYW1k
Z3B1X2FtZGtmZF9mbHVzaF9ncHVfdGxiX3ZtaWQoc3RydWN0IGtnZF9kZXYgKmtnZCwgdWludDE2
X3Qgdm1pZCkKPiAgICAgICAgICAgICAgICAgYW1kZ3B1X2dtY19mbHVzaF9ncHVfdGxiKGFkZXYs
IHZtaWQsIEFNREdQVV9HRlhIVUJfMCwgMCk7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIHVwX3Jl
YWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcmV0dXJuIDA7Cj4gIH0KPgo+IEBA
IC02OTIsMTggKzY2NSwxMSBAQCBpbnQgYW1kZ3B1X2FtZGtmZF9mbHVzaF9ncHVfdGxiX3Bhc2lk
KHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHVpbnQxNl90IHBhc2lkKQo+ICAgICAgICAgc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKilrZ2Q7Cj4gICAgICAg
ICBjb25zdCB1aW50MzJfdCBmbHVzaF90eXBlID0gMDsKPiAgICAgICAgIGJvb2wgYWxsX2h1YiA9
IGZhbHNlOwo+IC0gICAgICAgaW50IHJldCA9IC1FSU87Cj4KPiAgICAgICAgIGlmIChhZGV2LT5m
YW1pbHkgPT0gQU1ER1BVX0ZBTUlMWV9BSSkKPiAgICAgICAgICAgICAgICAgYWxsX2h1YiA9IHRy
dWU7Cj4KPiAtICAgICAgIGlmIChkb3duX3JlYWRfdHJ5bG9jaygmYWRldi0+cmVzZXRfc2VtKSkg
ewo+IC0gICAgICAgICAgICAgICByZXQgPSBhbWRncHVfZ21jX2ZsdXNoX2dwdV90bGJfcGFzaWQo
YWRldiwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzaWQsIGZs
dXNoX3R5cGUsIGFsbF9odWIpOwo+IC0gICAgICAgICAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNl
dF9zZW0pOwo+IC0gICAgICAgfQo+IC0KPiAtICAgICAgIHJldHVybiByZXQ7Cj4gKyAgICAgICBy
ZXR1cm4gYW1kZ3B1X2dtY19mbHVzaF9ncHVfdGxiX3Bhc2lkKGFkZXYsIHBhc2lkLCBmbHVzaF90
eXBlLCBhbGxfaHViKTsKPiAgfQo+Cj4gIGJvb2wgYW1kZ3B1X2FtZGtmZF9oYXZlX2F0b21pY3Nf
c3VwcG9ydChzdHJ1Y3Qga2dkX2RldiAqa2dkKQo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92MTAuYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3YxMC5jCj4gaW5kZXggYjg3MmNkYjBiNzA1Li42
OTFjODk3MDViY2QgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2FtZGtmZF9nZnhfdjEwLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfYW1ka2ZkX2dmeF92MTAuYwo+IEBAIC01NDMsNyArNTQzLDcgQEAgc3RhdGljIGludCBr
Z2RfaHFkX2Rlc3Ryb3koc3RydWN0IGtnZF9kZXYgKmtnZCwgdm9pZCAqbXFkLAo+ICAgICAgICAg
dWludDMyX3QgdGVtcDsKPiAgICAgICAgIHN0cnVjdCB2MTBfY29tcHV0ZV9tcWQgKm0gPSBnZXRf
bXFkKG1xZCk7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAg
ICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVJTzsK
Pgo+ICAjaWYgMAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfYW1ka2ZkX2dmeF92Ny5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Ft
ZGtmZF9nZnhfdjcuYwo+IGluZGV4IDgzMmEyMDBiYjYyZi4uMGI3ZTc4NzQ4NTQwIDEwMDY0NAo+
IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3Y3LmMK
PiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dmeF92Ny5j
Cj4gQEAgLTQyNSw3ICs0MjUsNyBAQCBzdGF0aWMgaW50IGtnZF9ocWRfZGVzdHJveShzdHJ1Y3Qg
a2dkX2RldiAqa2dkLCB2b2lkICptcWQsCj4gICAgICAgICB1bnNpZ25lZCBsb25nIGZsYWdzLCBl
bmRfamlmZmllczsKPiAgICAgICAgIGludCByZXRyeTsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9p
bl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAg
ICAgICAgICAgIHJldHVybiAtRUlPOwo+Cj4gICAgICAgICBhY3F1aXJlX3F1ZXVlKGtnZCwgcGlw
ZV9pZCwgcXVldWVfaWQpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfYW1ka2ZkX2dmeF92OC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2FtZGtmZF9nZnhfdjguYwo+IGluZGV4IGQwOTQwMTIxYTZhOS4uY2NkNjM1YjgxMmI1IDEw
MDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4
X3Y4LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dm
eF92OC5jCj4gQEAgLTQyMSw3ICs0MjEsNyBAQCBzdGF0aWMgaW50IGtnZF9ocWRfZGVzdHJveShz
dHJ1Y3Qga2dkX2RldiAqa2dkLCB2b2lkICptcWQsCj4gICAgICAgICBpbnQgcmV0cnk7Cj4gICAg
ICAgICBzdHJ1Y3QgdmlfbXFkICptID0gZ2V0X21xZChtcWQpOwo+Cj4gLSAgICAgICBpZiAoYW1k
Z3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAg
ICAgICAgICAgICAgICAgcmV0dXJuIC1FSU87Cj4KPiAgICAgICAgIGFjcXVpcmVfcXVldWUoa2dk
LCBwaXBlX2lkLCBxdWV1ZV9pZCk7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ2Z4X3Y5LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfYW1ka2ZkX2dmeF92OS5jCj4gaW5kZXggN2UxMTYyNWI0MTllLi45NjE0MjRiYzdh
MWYgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtm
ZF9nZnhfdjkuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRr
ZmRfZ2Z4X3Y5LmMKPiBAQCAtNTQxLDcgKzU0MSw3IEBAIGludCBrZ2RfZ2Z4X3Y5X2hxZF9kZXN0
cm95KHN0cnVjdCBrZ2RfZGV2ICprZ2QsIHZvaWQgKm1xZCwKPiAgICAgICAgIHVpbnQzMl90IHRl
bXA7Cj4gICAgICAgICBzdHJ1Y3QgdjlfbXFkICptID0gZ2V0X21xZChtcWQpOwo+Cj4gLSAgICAg
ICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9y
ZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FSU87Cj4KPiAgICAgICAgIGFjcXVpcmVf
cXVldWUoa2dkLCBwaXBlX2lkLCBxdWV1ZV9pZCk7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwo+IGluZGV4IDBkNzU3MjZiZDIyOC4uN2Uy
Mzk0YjUwZmJmIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9hbWRrZmRfZ3B1dm0uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9hbWRrZmRfZ3B1dm0uYwo+IEBAIC0xMTk0LDkgKzExOTQsNiBAQCBpbnQgYW1kZ3B1X2FtZGtm
ZF9ncHV2bV9hbGxvY19tZW1vcnlfb2ZfZ3B1KAo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVJ
TlZBTDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgaWYgKCFkb3duX3JlYWRfdHJ5bG9jaygmYWRl
di0+cmVzZXRfc2VtKSkKPiAtICAgICAgICAgICAgICAgcmV0dXJuIC1FSU87Cj4gLQo+ICAgICAg
ICAgKm1lbSA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBrZ2RfbWVtKSwgR0ZQX0tFUk5FTCk7Cj4g
ICAgICAgICBpZiAoISptZW0pIHsKPiAgICAgICAgICAgICAgICAgcmV0ID0gLUVOT01FTTsKPiBA
QCAtMTI2Myw3ICsxMjYwLDYgQEAgaW50IGFtZGdwdV9hbWRrZmRfZ3B1dm1fYWxsb2NfbWVtb3J5
X29mX2dwdSgKPiAgICAgICAgIGlmIChvZmZzZXQpCj4gICAgICAgICAgICAgICAgICpvZmZzZXQg
PSBhbWRncHVfYm9fbW1hcF9vZmZzZXQoYm8pOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5y
ZXNldF9zZW0pOwo+ICAgICAgICAgcmV0dXJuIDA7Cj4KPiAgYWxsb2NhdGVfaW5pdF91c2VyX3Bh
Z2VzX2ZhaWxlZDoKPiBAQCAtMTI4MSw5ICsxMjc3LDYgQEAgaW50IGFtZGdwdV9hbWRrZmRfZ3B1
dm1fYWxsb2NfbWVtb3J5X29mX2dwdSgKPiAgICAgICAgICAgICAgICAgc2dfZnJlZV90YWJsZShz
Zyk7Cj4gICAgICAgICAgICAgICAgIGtmcmVlKHNnKTsKPiAgICAgICAgIH0KPiAtCj4gLSAgICAg
ICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHJldHVybiByZXQ7Cj4g
IH0KPgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3Mu
YyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCj4gaW5kZXggYTk0YjNm
ODYyZmMyLi5mZmJjYWY0YmZiOGIgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2NzLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfY3MuYwo+IEBAIC0xMjkyLDggKzEyOTIsNiBAQCBpbnQgYW1kZ3B1X2NzX2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlscCkKPiAg
ICAgICAgIHBhcnNlci5hZGV2ID0gYWRldjsKPiAgICAgICAgIHBhcnNlci5maWxwID0gZmlscDsK
Pgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHIg
PSBhbWRncHVfY3NfcGFyc2VyX2luaXQoJnBhcnNlciwgZGF0YSk7Cj4gICAgICAgICBpZiAocikg
ewo+ICAgICAgICAgICAgICAgICBEUk1fRVJST1IoIkZhaWxlZCB0byBpbml0aWFsaXplIHBhcnNl
ciAlZCFcbiIsIHIpOwo+IEBAIC0xMzMzLDggKzEzMzEsNiBAQCBpbnQgYW1kZ3B1X2NzX2lvY3Rs
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmls
cCkKPiAgb3V0Ogo+ICAgICAgICAgYW1kZ3B1X2NzX3BhcnNlcl9maW5pKCZwYXJzZXIsIHIsIHJl
c2VydmVkX2J1ZmZlcnMpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
IC0KPiAgICAgICAgIHJldHVybiByOwo+ICB9Cj4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2N0eC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2N0eC5jCj4gaW5kZXggZDg1ZDEzZjdhMDQzLi44ODQyYzU1ZDQ0OTAgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2N0eC5jCj4gKysrIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2N0eC5jCj4gQEAgLTM1OCw4ICszNTgsNiBA
QCBzdGF0aWMgaW50IGFtZGdwdV9jdHhfcXVlcnkyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
LAo+ICAgICAgICAgaWYgKGF0b21pY19yZWFkKCZjdHgtPmd1aWx0eSkpCj4gICAgICAgICAgICAg
ICAgIG91dC0+c3RhdGUuZmxhZ3MgfD0gQU1ER1BVX0NUWF9RVUVSWTJfRkxBR1NfR1VJTFRZOwo+
Cj4gLSAgICAgICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgLypx
dWVyeSB1ZSBjb3VudCovCj4gICAgICAgICByYXNfY291bnRlciA9IGFtZGdwdV9yYXNfcXVlcnlf
ZXJyb3JfY291bnQoYWRldiwgZmFsc2UpOwo+ICAgICAgICAgLypyYXMgY291bnRlciBpcyBtb25v
dG9uaWMgaW5jcmVhc2luZyovCj4gQEAgLTM3NSw4ICszNzMsNiBAQCBzdGF0aWMgaW50IGFtZGdw
dV9jdHhfcXVlcnkyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAgICAgICAgICAgICAg
ICBjdHgtPnJhc19jb3VudGVyX2NlID0gcmFzX2NvdW50ZXI7Cj4gICAgICAgICB9Cj4KPiAtICAg
ICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgbXV0ZXhfdW5sb2Nr
KCZtZ3ItPmxvY2spOwo+ICAgICAgICAgcmV0dXJuIDA7Cj4gIH0KPiBkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9kZWJ1Z2ZzLmMKPiBpbmRleCAwYWYyNDlhMWUzNWIuLjM1ZmVk
NzVhNDM5NyAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZGVidWdmcy5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RlYnVn
ZnMuYwo+IEBAIC0xMDEsMTQgKzEwMSwxNCBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX2F1
dG9kdW1wX29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCj4KPiAg
ICAgICAgIGZpbGUtPnByaXZhdGVfZGF0YSA9IGFkZXY7Cj4KPiAtICAgICAgIGRvd25fcmVhZCgm
YWRldi0+cmVzZXRfc2VtKTsKPiArICAgICAgIG11dGV4X2xvY2soJmFkZXYtPmxvY2tfcmVzZXQp
Owo+ICAgICAgICAgaWYgKGFkZXYtPmF1dG9kdW1wLmR1bXBpbmcuZG9uZSkgewo+ICAgICAgICAg
ICAgICAgICByZWluaXRfY29tcGxldGlvbigmYWRldi0+YXV0b2R1bXAuZHVtcGluZyk7Cj4gICAg
ICAgICAgICAgICAgIHJldCA9IDA7Cj4gICAgICAgICB9IGVsc2Ugewo+ICAgICAgICAgICAgICAg
ICByZXQgPSAtRUJVU1k7Cj4gICAgICAgICB9Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNl
dF9zZW0pOwo+ICsgICAgICAgbXV0ZXhfdW5sb2NrKCZhZGV2LT5sb2NrX3Jlc2V0KTsKPgo+ICAg
ICAgICAgcmV0dXJuIHJldDsKPiAgfQo+IEBAIC0xMjcsNyArMTI3LDcgQEAgc3RhdGljIHVuc2ln
bmVkIGludCBhbWRncHVfZGVidWdmc19hdXRvZHVtcF9wb2xsKHN0cnVjdCBmaWxlICpmaWxlLCBz
dHJ1Y3QgcG9sbF8KPgo+ICAgICAgICAgcG9sbF93YWl0KGZpbGUsICZhZGV2LT5hdXRvZHVtcC5n
cHVfaGFuZywgcG9sbF90YWJsZSk7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRl
dikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICBy
ZXR1cm4gUE9MTElOIHwgUE9MTFJETk9STSB8IFBPTExXUk5PUk07Cj4KPiAgICAgICAgIHJldHVy
biAwOwo+IEBAIC0xMjQyLDcgKzEyNDIsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX3Rl
c3RfaWIoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQo+ICAgICAgICAgfQo+Cj4gICAg
ICAgICAvKiBBdm9pZCBhY2NpZGVudGx5IHVucGFya2luZyB0aGUgc2NoZWQgdGhyZWFkIGR1cmlu
ZyBHUFUgcmVzZXQgKi8KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAr
ICAgICAgIG11dGV4X2xvY2soJmFkZXYtPmxvY2tfcmVzZXQpOwo+Cj4gICAgICAgICAvKiBob2xk
IG9uIHRoZSBzY2hlZHVsZXIgKi8KPiAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBBTURHUFVfTUFY
X1JJTkdTOyBpKyspIHsKPiBAQCAtMTI2OSw3ICsxMjY5LDcgQEAgc3RhdGljIGludCBhbWRncHVf
ZGVidWdmc190ZXN0X2liKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKPiAgICAgICAg
ICAgICAgICAga3RocmVhZF91bnBhcmsocmluZy0+c2NoZWQudGhyZWFkKTsKPiAgICAgICAgIH0K
Pgo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiArICAgICAgIG11dGV4X3Vu
bG9jaygmYWRldi0+bG9ja19yZXNldCk7Cj4KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0
X2J1c3koZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGV2
LT5kZXYpOwo+IEBAIC0xNDU5LDcgKzE0NTksNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2Zz
X2liX3ByZWVtcHQodm9pZCAqZGF0YSwgdTY0IHZhbCkKPiAgICAgICAgICAgICAgICAgcmV0dXJu
IC1FTk9NRU07Cj4KPiAgICAgICAgIC8qIEF2b2lkIGFjY2lkZW50bHkgdW5wYXJraW5nIHRoZSBz
Y2hlZCB0aHJlYWQgZHVyaW5nIEdQVSByZXNldCAqLwo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2
LT5yZXNldF9zZW0pOwo+ICsgICAgICAgbXV0ZXhfbG9jaygmYWRldi0+bG9ja19yZXNldCk7Cj4K
PiAgICAgICAgIC8qIHN0b3AgdGhlIHNjaGVkdWxlciAqLwo+ICAgICAgICAga3RocmVhZF9wYXJr
KHJpbmctPnNjaGVkLnRocmVhZCk7Cj4gQEAgLTE1MDAsNyArMTUwMCw3IEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X2RlYnVnZnNfaWJfcHJlZW1wdCh2b2lkICpkYXRhLCB1NjQgdmFsKQo+ICAgICAgICAg
LyogcmVzdGFydCB0aGUgc2NoZWR1bGVyICovCj4gICAgICAgICBrdGhyZWFkX3VucGFyayhyaW5n
LT5zY2hlZC50aHJlYWQpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
ICsgICAgICAgbXV0ZXhfdW5sb2NrKCZhZGV2LT5sb2NrX3Jlc2V0KTsKPgo+ICAgICAgICAgdHRt
X2JvX3VubG9ja19kZWxheWVkX3dvcmtxdWV1ZSgmYWRldi0+bW1hbi5iZGV2LCByZXNjaGVkKTsK
Pgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNl
LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKPiBpbmRleCBm
ZTg4Nzg3NjFjMjkuLjE5YWEwZDczMzRjNyAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZGV2aWNlLmMKPiBAQCAtMTk0MCw3ICsxOTQwLDcgQEAgc3RhdGljIGludCBh
bWRncHVfZGV2aWNlX2Z3X2xvYWRpbmcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCj4gICAg
ICAgICAgICAgICAgICAgICAgICAgaWYgKGFkZXYtPmlwX2Jsb2Nrc1tpXS5zdGF0dXMuaHcgPT0g
dHJ1ZSkKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+Cj4gLSAgICAg
ICAgICAgICAgICAgICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSB8fCBhZGV2LT5pbl9z
dXNwZW5kKSB7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNl
dCB8fCBhZGV2LT5pbl9zdXNwZW5kKSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICByID0gYWRldi0+aXBfYmxvY2tzW2ldLnZlcnNpb24tPmZ1bmNzLT5yZXN1bWUoYWRldik7Cj4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocikgewo+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBEUk1fRVJST1IoInJlc3VtZSBvZiBJUCBibG9jayA8
JXM+IGZhaWxlZCAlZFxuIiwKPiBAQCAtMjExNyw3ICsyMTE3LDcgQEAgc3RhdGljIGJvb2wgYW1k
Z3B1X2RldmljZV9jaGVja192cmFtX2xvc3Qoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCj4g
ICAgICAgICAgICAgICAgICAgICAgICAgQU1ER1BVX1JFU0VUX01BR0lDX05VTSkpCj4gICAgICAg
ICAgICAgICAgIHJldHVybiB0cnVlOwo+Cj4gLSAgICAgICBpZiAoIWFtZGdwdV9pbl9yZXNldChh
ZGV2KSkKPiArICAgICAgIGlmICghYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAg
ICByZXR1cm4gZmFsc2U7Cj4KPiAgICAgICAgIC8qCj4gQEAgLTMwNTUsOCArMzA1NSw3IEBAIGlu
dCBhbWRncHVfZGV2aWNlX2luaXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gICAgICAg
ICBtdXRleF9pbml0KCZhZGV2LT5tbl9sb2NrKTsKPiAgICAgICAgIG11dGV4X2luaXQoJmFkZXYt
PnZpcnQudmZfZXJyb3JzLmxvY2spOwo+ICAgICAgICAgaGFzaF9pbml0KGFkZXYtPm1uX2hhc2gp
Owo+IC0gICAgICAgaW5pdF9yd3NlbSgmYWRldi0+cmVzZXRfc2VtKTsKPiAtICAgICAgIGF0b21p
Y19zZXQoJmFkZXYtPmluX2dwdV9yZXNldCwgMCk7Cj4gKyAgICAgICBtdXRleF9pbml0KCZhZGV2
LT5sb2NrX3Jlc2V0KTsKPiAgICAgICAgIG11dGV4X2luaXQoJmFkZXYtPnBzcC5tdXRleCk7Cj4g
ICAgICAgICBtdXRleF9pbml0KCZhZGV2LT5ub3RpZmllcl9sb2NrKTsKPgo+IEBAIC00MDg0LDEx
ICs0MDgzLDggQEAgc3RhdGljIGludCBhbWRncHVfZG9fYXNpY19yZXNldChzdHJ1Y3QgYW1kZ3B1
X2hpdmVfaW5mbyAqaGl2ZSwKPiAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkodG1wX2FkZXYs
IGRldmljZV9saXN0X2hhbmRsZSwgZ21jLnhnbWkuaGVhZCkgewo+ICAgICAgICAgICAgICAgICBp
ZiAobmVlZF9mdWxsX3Jlc2V0KSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgLyogcG9zdCBj
YXJkICovCj4gLSAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFtZGdwdV9hdG9tX2FzaWNfaW5p
dCh0bXBfYWRldi0+bW9kZV9pbmZvLmF0b21fY29udGV4dCkpIHsKPiAtICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGRldl93YXJuKHRtcF9hZGV2LT5kZXYsICJhc2ljIGF0b20gaW5pdCBm
YWlsZWQhIik7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID0gLUVBR0FJTjsK
PiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gb3V0Owo+IC0gICAgICAgICAg
ICAgICAgICAgICAgIH0KPiArICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW1kZ3B1X2F0b21f
YXNpY19pbml0KHRtcF9hZGV2LT5tb2RlX2luZm8uYXRvbV9jb250ZXh0KSkKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIERSTV9XQVJOKCJhc2ljIGF0b20gaW5pdCBmYWlsZWQhIik7
Cj4KPiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXIpIHsKPiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGRldl9pbmZvKHRtcF9hZGV2LT5kZXYsICJHUFUgcmVzZXQgc3VjY2Vl
ZGVkLCB0cnlpbmcgdG8gcmVzdW1lXG4iKTsKPiBAQCAtNDE3OCwxOCArNDE3NCwxNiBAQCBzdGF0
aWMgaW50IGFtZGdwdV9kb19hc2ljX3Jlc2V0KHN0cnVjdCBhbWRncHVfaGl2ZV9pbmZvICpoaXZl
LAo+ICAgICAgICAgcmV0dXJuIHI7Cj4gIH0KPgo+IC1zdGF0aWMgYm9vbCBhbWRncHVfZGV2aWNl
X2xvY2tfYWRldihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV9oaXZl
X2luZm8gKmhpdmUpCj4gK3N0YXRpYyBib29sIGFtZGdwdV9kZXZpY2VfbG9ja19hZGV2KHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2LCBib29sIHRyeWxvY2spCj4gIHsKPiAtICAgICAgIGlmIChh
dG9taWNfY21weGNoZygmYWRldi0+aW5fZ3B1X3Jlc2V0LCAwLCAxKSAhPSAwKQo+IC0gICAgICAg
ICAgICAgICByZXR1cm4gZmFsc2U7Cj4gLQo+IC0gICAgICAgaWYgKGhpdmUpIHsKPiAtICAgICAg
ICAgICAgICAgZG93bl93cml0ZV9uZXN0X2xvY2soJmFkZXYtPnJlc2V0X3NlbSwgJmhpdmUtPmhp
dmVfbG9jayk7Cj4gLSAgICAgICB9IGVsc2Ugewo+IC0gICAgICAgICAgICAgICBkb3duX3dyaXRl
KCZhZGV2LT5yZXNldF9zZW0pOwo+IC0gICAgICAgfQo+ICsgICAgICAgaWYgKHRyeWxvY2spIHsK
PiArICAgICAgICAgICAgICAgaWYgKCFtdXRleF90cnlsb2NrKCZhZGV2LT5sb2NrX3Jlc2V0KSkK
PiArICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7Cj4gKyAgICAgICB9IGVsc2UK
PiArICAgICAgICAgICAgICAgbXV0ZXhfbG9jaygmYWRldi0+bG9ja19yZXNldCk7Cj4KPiAgICAg
ICAgIGF0b21pY19pbmMoJmFkZXYtPmdwdV9yZXNldF9jb3VudGVyKTsKPiArICAgICAgIGFkZXYt
PmluX2dwdV9yZXNldCA9IHRydWU7Cj4gICAgICAgICBzd2l0Y2ggKGFtZGdwdV9hc2ljX3Jlc2V0
X21ldGhvZChhZGV2KSkgewo+ICAgICAgICAgY2FzZSBBTURfUkVTRVRfTUVUSE9EX01PREUxOgo+
ICAgICAgICAgICAgICAgICBhZGV2LT5tcDFfc3RhdGUgPSBQUF9NUDFfU1RBVEVfU0hVVERPV047
Cj4gQEAgLTQyMDksOCArNDIwMyw4IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9kZXZpY2VfdW5sb2Nr
X2FkZXYoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCj4gIHsKPiAgICAgICAgIGFtZGdwdV92
Zl9lcnJvcl90cmFuc19hbGwoYWRldik7Cj4gICAgICAgICBhZGV2LT5tcDFfc3RhdGUgPSBQUF9N
UDFfU1RBVEVfTk9ORTsKPiAtICAgICAgIGF0b21pY19zZXQoJmFkZXYtPmluX2dwdV9yZXNldCwg
MCk7Cj4gLSAgICAgICB1cF93cml0ZSgmYWRldi0+cmVzZXRfc2VtKTsKPiArICAgICAgIGFkZXYt
PmluX2dwdV9yZXNldCA9IGZhbHNlOwo+ICsgICAgICAgbXV0ZXhfdW5sb2NrKCZhZGV2LT5sb2Nr
X3Jlc2V0KTsKPiAgfQo+Cj4gIHN0YXRpYyB2b2lkIGFtZGdwdV9kZXZpY2VfcmVzdW1lX2Rpc3Bs
YXlfYXVkaW8oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCj4gQEAgLTQzMjAsMTQgKzQzMTQs
MTIgQEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1X3JlY292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYsCj4gICAgICAgICAgKiBXZSBhbHdheXMgcmVzZXQgYWxsIHNjaGVkdWxlcnMgZm9yIGRl
dmljZSBhbmQgYWxsIGRldmljZXMgZm9yIFhHTUkKPiAgICAgICAgICAqIGhpdmUgc28gdGhhdCBz
aG91bGQgdGFrZSBjYXJlIG9mIHRoZW0gdG9vLgo+ICAgICAgICAgICovCj4gLSAgICAgICBoaXZl
ID0gYW1kZ3B1X2dldF94Z21pX2hpdmUoYWRldiwgZmFsc2UpOwo+IC0gICAgICAgaWYgKGhpdmUp
IHsKPiAtICAgICAgICAgICAgICAgaWYgKGF0b21pY19jbXB4Y2hnKCZoaXZlLT5pbl9yZXNldCwg
MCwgMSkgIT0gMCkgewo+IC0gICAgICAgICAgICAgICAgICAgICAgIERSTV9JTkZPKCJCYWlsaW5n
IG9uIFREUiBmb3Igc19qb2I6JWxseCwgaGl2ZTogJWxseCBhcyBhbm90aGVyIGFscmVhZHkgaW4g
cHJvZ3Jlc3MiLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iID8gam9iLT5i
YXNlLmlkIDogLTEsIGhpdmUtPmhpdmVfaWQpOwo+IC0gICAgICAgICAgICAgICAgICAgICAgIHJl
dHVybiAwOwo+IC0gICAgICAgICAgICAgICB9Cj4gLSAgICAgICAgICAgICAgIG11dGV4X2xvY2so
JmhpdmUtPmhpdmVfbG9jayk7Cj4gKyAgICAgICBoaXZlID0gYW1kZ3B1X2dldF94Z21pX2hpdmUo
YWRldiwgdHJ1ZSk7Cj4gKyAgICAgICBpZiAoaGl2ZSAmJiAhbXV0ZXhfdHJ5bG9jaygmaGl2ZS0+
cmVzZXRfbG9jaykpIHsKPiArICAgICAgICAgICAgICAgRFJNX0lORk8oIkJhaWxpbmcgb24gVERS
IGZvciBzX2pvYjolbGx4LCBoaXZlOiAlbGx4IGFzIGFub3RoZXIgYWxyZWFkeSBpbiBwcm9ncmVz
cyIsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICBqb2IgPyBqb2ItPmJhc2UuaWQgOiAtMSwg
aGl2ZS0+aGl2ZV9pZCk7Cj4gKyAgICAgICAgICAgICAgIG11dGV4X3VubG9jaygmaGl2ZS0+aGl2
ZV9sb2NrKTsKPiArICAgICAgICAgICAgICAgcmV0dXJuIDA7Cj4gICAgICAgICB9Cj4KPiAgICAg
ICAgIC8qCj4gQEAgLTQzNDksMTEgKzQzNDEsMTEgQEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1X3Jl
Y292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4KPiAgICAgICAgIC8qIGJsb2NrIGFs
bCBzY2hlZHVsZXJzIGFuZCByZXNldCBnaXZlbiBqb2IncyByaW5nICovCj4gICAgICAgICBsaXN0
X2Zvcl9lYWNoX2VudHJ5KHRtcF9hZGV2LCBkZXZpY2VfbGlzdF9oYW5kbGUsIGdtYy54Z21pLmhl
YWQpIHsKPiAtICAgICAgICAgICAgICAgaWYgKCFhbWRncHVfZGV2aWNlX2xvY2tfYWRldih0bXBf
YWRldiwgaGl2ZSkpIHsKPiArICAgICAgICAgICAgICAgaWYgKCFhbWRncHVfZGV2aWNlX2xvY2tf
YWRldih0bXBfYWRldiwgIWhpdmUpKSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgRFJNX0lO
Rk8oIkJhaWxpbmcgb24gVERSIGZvciBzX2pvYjolbGx4LCBhcyBhbm90aGVyIGFscmVhZHkgaW4g
cHJvZ3Jlc3MiLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2IgPyBqb2It
PmJhc2UuaWQgOiAtMSk7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgciA9IDA7Cj4gLSAgICAg
ICAgICAgICAgICAgICAgICAgZ290byBza2lwX3JlY292ZXJ5Owo+ICsgICAgICAgICAgICAgICAg
ICAgICAgIG11dGV4X3VubG9jaygmaGl2ZS0+aGl2ZV9sb2NrKTsKPiArICAgICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gMDsKPiAgICAgICAgICAgICAgICAgfQo+Cj4gICAgICAgICAgICAgICAg
IC8qCj4gQEAgLTQ0ODYsOSArNDQ3OCw4IEBAIGludCBhbWRncHVfZGV2aWNlX2dwdV9yZWNvdmVy
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+ICAgICAgICAgICAgICAgICBhbWRncHVfZGV2
aWNlX3VubG9ja19hZGV2KHRtcF9hZGV2KTsKPiAgICAgICAgIH0KPgo+IC1za2lwX3JlY292ZXJ5
Ogo+ICAgICAgICAgaWYgKGhpdmUpIHsKPiAtICAgICAgICAgICAgICAgYXRvbWljX3NldCgmaGl2
ZS0+aW5fcmVzZXQsIDApOwo+ICsgICAgICAgICAgICAgICBtdXRleF91bmxvY2soJmhpdmUtPnJl
c2V0X2xvY2spOwo+ICAgICAgICAgICAgICAgICBtdXRleF91bmxvY2soJmhpdmUtPmhpdmVfbG9j
ayk7Cj4gICAgICAgICB9Cj4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5j
Cj4gaW5kZXggZWUxZThmZmY4M2IyLi44YzY0ZDhkNmNiODIgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5jCj4gQEAgLTY3MCw4ICs2NzAsNiBAQCBpbnQgYW1kZ3B1
X2dlbV92YV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAo+ICAgICAg
ICAgICAgICAgICBib192YSA9IE5VTEw7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVh
ZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBzd2l0Y2ggKGFyZ3MtPm9wZXJhdGlv
bikgewo+ICAgICAgICAgY2FzZSBBTURHUFVfVkFfT1BfTUFQOgo+ICAgICAgICAgICAgICAgICB2
YV9mbGFncyA9IGFtZGdwdV9nZW1fdmFfbWFwX2ZsYWdzKGFkZXYsIGFyZ3MtPmZsYWdzKTsKPiBA
QCAtNzAxLDggKzY5OSw2IEBAIGludCBhbWRncHVfZ2VtX3ZhX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCj4gICAgICAgICAgICAgICAgIGFtZGdwdV9nZW1fdmFfdXBk
YXRlX3ZtKGFkZXYsICZmcHJpdi0+dm0sIGJvX3ZhLAo+ICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBhcmdzLT5vcGVyYXRpb24pOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZh
ZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgZXJyb3JfYmFja29mZjoKPiAgICAgICAgIHR0bV9ldV9i
YWNrb2ZmX3Jlc2VydmF0aW9uKCZ0aWNrZXQsICZsaXN0KTsKPgo+IGRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2Z4LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfZ2Z4LmMKPiBpbmRleCA4Y2NkMTdkMDJjYzYuLmE4MTkzNjBhNGI2YSAx
MDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2Z4LmMKPiAr
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2Z4LmMKPiBAQCAtNzE5LDcg
KzcxOSw3IEBAIHVpbnQzMl90IGFtZGdwdV9raXFfcnJlZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiwgdWludDMyX3QgcmVnKQo+ICAgICAgICAgICoKPiAgICAgICAgICAqIGFsc28gZG9uJ3Qg
d2FpdCBhbnltb3JlIGZvciBJUlEgY29udGV4dAo+ICAgICAgICAgICogKi8KPiAtICAgICAgIGlm
IChyIDwgMSAmJiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpIHx8IGluX2ludGVycnVwdCgpKSkKPiAr
ICAgICAgIGlmIChyIDwgMSAmJiAoYWRldi0+aW5fZ3B1X3Jlc2V0IHx8IGluX2ludGVycnVwdCgp
KSkKPiAgICAgICAgICAgICAgICAgZ290byBmYWlsZWRfa2lxX3JlYWQ7Cj4KPiAgICAgICAgIG1p
Z2h0X3NsZWVwKCk7Cj4gQEAgLTc3Nyw3ICs3NzcsNyBAQCB2b2lkIGFtZGdwdV9raXFfd3JlZyhz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdWludDMyX3QgcmVnLCB1aW50MzJfdCB2KQo+ICAg
ICAgICAgICoKPiAgICAgICAgICAqIGFsc28gZG9uJ3Qgd2FpdCBhbnltb3JlIGZvciBJUlEgY29u
dGV4dAo+ICAgICAgICAgICogKi8KPiAtICAgICAgIGlmIChyIDwgMSAmJiAoYW1kZ3B1X2luX3Jl
c2V0KGFkZXYpIHx8IGluX2ludGVycnVwdCgpKSkKPiArICAgICAgIGlmIChyIDwgMSAmJiAoYWRl
di0+aW5fZ3B1X3Jlc2V0IHx8IGluX2ludGVycnVwdCgpKSkKPiAgICAgICAgICAgICAgICAgZ290
byBmYWlsZWRfa2lxX3dyaXRlOwo+Cj4gICAgICAgICBtaWdodF9zbGVlcCgpOwo+IEBAIC03OTYs
NSArNzk2LDUgQEAgdm9pZCBhbWRncHVfa2lxX3dyZWcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsIHVpbnQzMl90IHJlZywgdWludDMyX3QgdikKPiAgICAgICAgIGFtZGdwdV9yaW5nX3VuZG8o
cmluZyk7Cj4gICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZraXEtPnJpbmdfbG9jaywg
ZmxhZ3MpOwo+ICBmYWlsZWRfa2lxX3dyaXRlOgo+IC0gICAgICAgZGV2X3dhcm4oYWRldi0+ZGV2
LCAiZmFpbGVkIHRvIHdyaXRlIHJlZzoleFxuIiwgcmVnKTsKPiArICAgICAgIHByX2VycigiZmFp
bGVkIHRvIHdyaXRlIHJlZzoleFxuIiwgcmVnKTsKPiAgfQo+IGRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfam9iLmMKPiBpbmRleCA3NWQzN2RmYjUxYWEuLjkzNzAyOWFkNTI3MSAxMDA2
NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMKPiArKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMKPiBAQCAtMjIwLDE3ICsy
MjAsMTcgQEAgc3RhdGljIHN0cnVjdCBkbWFfZmVuY2UgKmFtZGdwdV9qb2JfcnVuKHN0cnVjdCBk
cm1fc2NoZWRfam9iICpzY2hlZF9qb2IpCj4KPiAgICAgICAgIHRyYWNlX2FtZGdwdV9zY2hlZF9y
dW5fam9iKGpvYik7Cj4KPiAtICAgICAgIGlmIChkb3duX3JlYWRfdHJ5bG9jaygmcmluZy0+YWRl
di0+cmVzZXRfc2VtKSkgewo+ICsgICAgICAgaWYgKGpvYi0+dnJhbV9sb3N0X2NvdW50ZXIgIT0g
YXRvbWljX3JlYWQoJnJpbmctPmFkZXYtPnZyYW1fbG9zdF9jb3VudGVyKSkKPiArICAgICAgICAg
ICAgICAgZG1hX2ZlbmNlX3NldF9lcnJvcihmaW5pc2hlZCwgLUVDQU5DRUxFRCk7Lyogc2tpcCBJ
QiBhcyB3ZWxsIGlmIFZSQU0gbG9zdCAqLwo+ICsKPiArICAgICAgIGlmIChmaW5pc2hlZC0+ZXJy
b3IgPCAwKSB7Cj4gKyAgICAgICAgICAgICAgIERSTV9JTkZPKCJTa2lwIHNjaGVkdWxpbmcgSUJz
IVxuIik7Cj4gKyAgICAgICB9IGVsc2Ugewo+ICAgICAgICAgICAgICAgICByID0gYW1kZ3B1X2li
X3NjaGVkdWxlKHJpbmcsIGpvYi0+bnVtX2licywgam9iLT5pYnMsIGpvYiwKPiAtICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJmZlbmNlKTsKPiAtICAgICAgICAgICAgICAg
dXBfcmVhZCgmcmluZy0+YWRldi0+cmVzZXRfc2VtKTsKPiArICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAmZmVuY2UpOwo+ICAgICAgICAgICAgICAgICBpZiAocikKPiAgICAg
ICAgICAgICAgICAgICAgICAgICBEUk1fRVJST1IoIkVycm9yIHNjaGVkdWxpbmcgSUJzICglZClc
biIsIHIpOwo+IC0gICAgICAgfSBlbHNlIHsKPiAtICAgICAgICAgICAgICAgZG1hX2ZlbmNlX3Nl
dF9lcnJvcihmaW5pc2hlZCwgLUVDQU5DRUxFRCk7Cj4gLSAgICAgICAgICAgICAgIERSTV9JTkZP
KCJTa2lwIHNjaGVkdWxpbmcgSUJzIVxuIik7Cj4gICAgICAgICB9Cj4gLQo+ICAgICAgICAgLyog
aWYgZ3B1IHJlc2V0LCBodyBmZW5jZSB3aWxsIGJlIHJlcGxhY2VkIGhlcmUgKi8KPiAgICAgICAg
IGRtYV9mZW5jZV9wdXQoam9iLT5mZW5jZSk7Cj4gICAgICAgICBqb2ItPmZlbmNlID0gZG1hX2Zl
bmNlX2dldChmZW5jZSk7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9rbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwo+
IGluZGV4IGY4ZGU5NDlkMjUxMC4uYjRhOWUwNDc4ZjI1IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwo+IEBAIC0xMDg3LDggKzEwODcsNiBAQCB2b2lkIGFtZGdw
dV9kcml2ZXJfcG9zdGNsb3NlX2ttcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAo+ICAgICAgICAg
aWYgKCFmcHJpdikKPiAgICAgICAgICAgICAgICAgcmV0dXJuOwo+Cj4gLSAgICAgICBkb3duX3Jl
YWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9nZXRfc3luYyhk
ZXYtPmRldik7Cj4KPiAgICAgICAgIGlmIChhbWRncHVfZGV2aWNlX2lwX2dldF9pcF9ibG9jayhh
ZGV2LCBBTURfSVBfQkxPQ0tfVFlQRV9VVkQpICE9IE5VTEwpCj4gQEAgLTExMjcsOCArMTEyNSw2
IEBAIHZvaWQgYW1kZ3B1X2RyaXZlcl9wb3N0Y2xvc2Vfa21zKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsCj4KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGV2LT5kZXYpOwo+ICAg
ICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGV2LT5kZXYpOwo+IC0KPiAtICAgICAg
IHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gIH0KPgo+ICAvKgo+IGRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9wbS5jCj4gaW5kZXggMTcwNWUzMjhjNmZjLi42NWFkMTc0YmI5NzYg
MTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3BtLmMKPiAr
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcG0uYwo+IEBAIC0xNjMsNyAr
MTYzLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wb3dlcl9kcG1fc3RhdGUoc3RydWN0
IGRldmljZSAqZGV2LAo+ICAgICAgICAgZW51bSBhbWRfcG1fc3RhdGVfdHlwZSBwbTsKPiAgICAg
ICAgIGludCByZXQ7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAg
ICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQ
RVJNOwo+Cj4gICAgICAgICByZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4g
QEAgLTE3Miw4ICsxNzIsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3Bvd2VyX2RwbV9z
dGF0ZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4g
ICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4g
ICAgICAgICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpIHsKPiAgICAgICAgICAgICAgICAg
aWYgKGFkZXYtPnNtdS5wcHRfZnVuY3MtPmdldF9jdXJyZW50X3Bvd2VyX3N0YXRlKQo+ICAgICAg
ICAgICAgICAgICAgICAgICAgIHBtID0gc211X2dldF9jdXJyZW50X3Bvd2VyX3N0YXRlKCZhZGV2
LT5zbXUpOwo+IEBAIC0xODUsOCArMTgzLDYgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9w
b3dlcl9kcG1fc3RhdGUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICBwbSA9
IGFkZXYtPnBtLmRwbS51c2VyX3N0YXRlOwo+ICAgICAgICAgfQo+Cj4gLSAgICAgICB1cF9yZWFk
KCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1
c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYt
PmRldik7Cj4KPiBAQCAtMjA1LDcgKzIwMSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRf
cG93ZXJfZHBtX3N0YXRlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgIGVudW0gYW1kX3Bt
X3N0YXRlX3R5cGUgIHN0YXRlOwo+ICAgICAgICAgaW50IHJldDsKPgo+IC0gICAgICAgaWYgKGFt
ZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4g
ICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIGlmIChzdHJuY21wKCJi
YXR0ZXJ5IiwgYnVmLCBzdHJsZW4oImJhdHRlcnkiKSkgPT0gMCkKPiBAQCAtMjIzLDggKzIxOSw2
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcG93ZXJfZHBtX3N0YXRlKHN0cnVjdCBkZXZp
Y2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0g
ICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19z
dXBwb3J0X3N3X3NtdShhZGV2KSkgewo+ICAgICAgICAgICAgICAgICBtdXRleF9sb2NrKCZhZGV2
LT5wbS5tdXRleCk7Cj4gICAgICAgICAgICAgICAgIGFkZXYtPnBtLmRwbS51c2VyX3N0YXRlID0g
c3RhdGU7Cj4gQEAgLTIzOCw5ICsyMzIsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3Bv
d2VyX2RwbV9zdGF0ZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4KPiAgICAgICAgICAgICAgICAgYW1k
Z3B1X3BtX2NvbXB1dGVfY2xvY2tzKGFkZXYpOwo+ICAgICAgICAgfQo+IC0KPiAtICAgICAgIHVw
X3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xh
c3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQo
ZGRldi0+ZGV2KTsKPgo+IEBAIC0zMTYsNyArMzA3LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1
X2dldF9wb3dlcl9kcG1fZm9yY2VfcGVyZm9ybWFuY2VfbGV2ZWwoc3RydWN0IGRldmljZSAqZGV2
LAo+ICAgICAgICAgZW51bSBhbWRfZHBtX2ZvcmNlZF9sZXZlbCBsZXZlbCA9IDB4ZmY7Cj4gICAg
ICAgICBpbnQgcmV0Owo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsg
ICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1F
UEVSTTsKPgo+ICAgICAgICAgcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5kZXYpOwo+
IEBAIC0zMjUsOCArMzE2LDYgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wb3dlcl9kcG1f
Zm9yY2VfcGVyZm9ybWFuY2VfbGV2ZWwoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAg
ICAgICByZXR1cm4gcmV0Owo+ICAgICAgICAgfQo+Cj4gLSAgICAgICBkb3duX3JlYWQoJmFkZXYt
PnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQo+
ICAgICAgICAgICAgICAgICBsZXZlbCA9IHNtdV9nZXRfcGVyZm9ybWFuY2VfbGV2ZWwoJmFkZXYt
PnNtdSk7Cj4gICAgICAgICBlbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9w
ZXJmb3JtYW5jZV9sZXZlbCkKPiBAQCAtMzM0LDggKzMyMyw2IEBAIHN0YXRpYyBzc2l6ZV90IGFt
ZGdwdV9nZXRfcG93ZXJfZHBtX2ZvcmNlX3BlcmZvcm1hbmNlX2xldmVsKHN0cnVjdCBkZXZpY2Ug
KmRldiwKPiAgICAgICAgIGVsc2UKPiAgICAgICAgICAgICAgICAgbGV2ZWwgPSBhZGV2LT5wbS5k
cG0uZm9yY2VkX2xldmVsOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAg
ICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4KPiBAQCAtMzYyLDcg
KzM0OSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcG93ZXJfZHBtX2ZvcmNlX3BlcmZv
cm1hbmNlX2xldmVsKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgIGVudW0gYW1kX2RwbV9m
b3JjZWRfbGV2ZWwgY3VycmVudF9sZXZlbCA9IDB4ZmY7Cj4gICAgICAgICBpbnQgcmV0ID0gMDsK
Pgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2
LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAg
ICAgIGlmIChzdHJuY21wKCJsb3ciLCBidWYsIHN0cmxlbigibG93IikpID09IDApIHsKPiBAQCAt
MzkzLDggKzM4MCw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcG93ZXJfZHBtX2ZvcmNl
X3BlcmZvcm1hbmNlX2xldmVsKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAg
cmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNl
dF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAg
ICAgICAgICAgICAgY3VycmVudF9sZXZlbCA9IHNtdV9nZXRfcGVyZm9ybWFuY2VfbGV2ZWwoJmFk
ZXYtPnNtdSk7Cj4gICAgICAgICBlbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdl
dF9wZXJmb3JtYW5jZV9sZXZlbCkKPiBAQCAtNDAzLDggKzM4OCw3IEBAIHN0YXRpYyBzc2l6ZV90
IGFtZGdwdV9zZXRfcG93ZXJfZHBtX2ZvcmNlX3BlcmZvcm1hbmNlX2xldmVsKHN0cnVjdCBkZXZp
Y2UgKmRldiwKPiAgICAgICAgIGlmIChjdXJyZW50X2xldmVsID09IGxldmVsKSB7Cj4gICAgICAg
ICAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAg
ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPiAtICAgICAg
ICAgICAgICAgcmV0ID0gY291bnQ7Cj4gLSAgICAgICAgICAgICAgIGdvdG8gcHJvX2VuZDsKPiAr
ICAgICAgICAgICAgICAgcmV0dXJuIGNvdW50Owo+ICAgICAgICAgfQo+Cj4gICAgICAgICBpZiAo
YWRldi0+YXNpY190eXBlID09IENISVBfUkFWRU4pIHsKPiBAQCAtNDI1LDggKzQwOSw3IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcG93ZXJfZHBtX2ZvcmNlX3BlcmZvcm1hbmNlX2xldmVs
KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcHJfZXJyKCJDdXJyZW50bHkg
bm90IGluIGFueSBwcm9maWxlIG1vZGUhXG4iKTsKPiAgICAgICAgICAgICAgICAgcG1fcnVudGlt
ZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAgICAgICAgICBwbV9ydW50aW1l
X3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+IC0gICAgICAgICAgICAgICByZXQgPSAtRUlO
VkFMOwo+IC0gICAgICAgICAgICAgICBnb3RvIHByb19lbmQ7Cj4gKyAgICAgICAgICAgICAgIHJl
dHVybiAtRUlOVkFMOwo+ICAgICAgICAgfQo+Cj4gICAgICAgICBpZiAoaXNfc3VwcG9ydF9zd19z
bXUoYWRldikpIHsKPiBAQCAtNDM0LDggKzQxNyw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9z
ZXRfcG93ZXJfZHBtX2ZvcmNlX3BlcmZvcm1hbmNlX2xldmVsKHN0cnVjdCBkZXZpY2UgKmRldiwK
PiAgICAgICAgICAgICAgICAgaWYgKHJldCkgewo+ICAgICAgICAgICAgICAgICAgICAgICAgIHBt
X3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAgICAgICAgICAgICAg
ICAgICBwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+IC0gICAgICAgICAg
ICAgICAgICAgICAgIHJldCA9IC1FSU5WQUw7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgZ290
byBwcm9fZW5kOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwo+ICAg
ICAgICAgICAgICAgICB9Cj4gICAgICAgICB9IGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9m
dW5jcy0+Zm9yY2VfcGVyZm9ybWFuY2VfbGV2ZWwpIHsKPiAgICAgICAgICAgICAgICAgbXV0ZXhf
bG9jaygmYWRldi0+cG0ubXV0ZXgpOwo+IEBAIC00NDMsMTYgKzQyNSwxNCBAQCBzdGF0aWMgc3Np
emVfdCBhbWRncHVfc2V0X3Bvd2VyX2RwbV9mb3JjZV9wZXJmb3JtYW5jZV9sZXZlbChzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgICAgICAgICAgbXV0ZXhfdW5sb2NrKCZhZGV2
LT5wbS5tdXRleCk7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xh
c3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIHBtX3J1bnRpbWVf
cHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0
ID0gLUVJTlZBTDsKPiAtICAgICAgICAgICAgICAgICAgICAgICBnb3RvIHByb19lbmQ7Cj4gKyAg
ICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7Cj4gICAgICAgICAgICAgICAgIH0K
PiAgICAgICAgICAgICAgICAgcmV0ID0gYW1kZ3B1X2RwbV9mb3JjZV9wZXJmb3JtYW5jZV9sZXZl
bChhZGV2LCBsZXZlbCk7Cj4gICAgICAgICAgICAgICAgIGlmIChyZXQpIHsKPiAgICAgICAgICAg
ICAgICAgICAgICAgICBtdXRleF91bmxvY2soJmFkZXYtPnBtLm11dGV4KTsKPiAgICAgICAgICAg
ICAgICAgICAgICAgICBwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gICAg
ICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2
KTsKPiAtICAgICAgICAgICAgICAgICAgICAgICByZXQgPSAtRUlOVkFMOwo+IC0gICAgICAgICAg
ICAgICAgICAgICAgIGdvdG8gcHJvX2VuZDsKPiArICAgICAgICAgICAgICAgICAgICAgICByZXR1
cm4gLUVJTlZBTDsKPiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKPiAgICAgICAgICAgICAgICAg
ICAgICAgICBhZGV2LT5wbS5kcG0uZm9yY2VkX2xldmVsID0gbGV2ZWw7Cj4gICAgICAgICAgICAg
ICAgIH0KPiBAQCAtNDYxLDkgKzQ0MSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcG93
ZXJfZHBtX2ZvcmNlX3BlcmZvcm1hbmNlX2xldmVsKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAg
ICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1
bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4KPiAtcHJvX2VuZDoKPiAtICAgICAg
IHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLSAgICAgICByZXR1cm4gcmV0Owo+ICsgICAg
ICAgcmV0dXJuIGNvdW50Owo+ICB9Cj4KPiAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9u
dW1fc3RhdGVzKHN0cnVjdCBkZXZpY2UgKmRldiwKPiBAQCAtNDc1LDcgKzQ1Myw3IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfbnVtX3N0YXRlcyhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4g
ICAgICAgICBzdHJ1Y3QgcHBfc3RhdGVzX2luZm8gZGF0YTsKPiAgICAgICAgIGludCBpLCBidWZf
bGVuLCByZXQ7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAg
ICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJN
Owo+Cj4gICAgICAgICByZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAg
LTUxOSw3ICs0OTcsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX2N1cl9zdGF0ZShz
dHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBlbnVtIGFtZF9wbV9zdGF0ZV90eXBlIHBtID0g
MDsKPiAgICAgICAgIGludCBpID0gMCwgcmV0ID0gMDsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9p
bl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAg
ICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIHJldCA9IHBtX3J1bnRpbWVfZ2V0
X3N5bmMoZGRldi0+ZGV2KTsKPiBAQCAtNTYwLDcgKzUzOCw3IEBAIHN0YXRpYyBzc2l6ZV90IGFt
ZGdwdV9nZXRfcHBfZm9yY2Vfc3RhdGUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgc3Ry
dWN0IGRybV9kZXZpY2UgKmRkZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKPiAgICAgICAgIHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gZGRldi0+ZGV2X3ByaXZhdGU7Cj4KPiAtICAgICAg
IGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jl
c2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICBpZiAoYWRl
di0+cHBfZm9yY2Vfc3RhdGVfZW5hYmxlZCkKPiBAQCAtNTgwLDcgKzU1OCw3IEBAIHN0YXRpYyBz
c2l6ZV90IGFtZGdwdV9zZXRfcHBfZm9yY2Vfc3RhdGUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAg
ICAgICAgdW5zaWduZWQgbG9uZyBpZHg7Cj4gICAgICAgICBpbnQgcmV0Owo+Cj4gLSAgICAgICBp
ZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNl
dCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAgaWYgKHN0cmxl
bihidWYpID09IDEpCj4gQEAgLTYwNiw3ICs1ODQsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVf
c2V0X3BwX2ZvcmNlX3N0YXRlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAg
ICAgICAgICByZXR1cm4gcmV0Owo+ICAgICAgICAgICAgICAgICB9Cj4KPiAtICAgICAgICAgICAg
ICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAgICAgICAgICAgICAgICAvKiBvbmx5
IHNldCB1c2VyIHNlbGVjdGVkIHBvd2VyIHN0YXRlcyAqLwo+ICAgICAgICAgICAgICAgICBpZiAo
c3RhdGUgIT0gUE9XRVJfU1RBVEVfVFlQRV9JTlRFUk5BTF9CT09UICYmCj4gICAgICAgICAgICAg
ICAgICAgICBzdGF0ZSAhPSBQT1dFUl9TVEFURV9UWVBFX0RFRkFVTFQpIHsKPiBAQCAtNjE0LDgg
KzU5MSw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfZm9yY2Vfc3RhdGUoc3RydWN0
IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBB
TURfUFBfVEFTS19FTkFCTEVfVVNFUl9TVEFURSwgJnN0YXRlKTsKPiAgICAgICAgICAgICAgICAg
ICAgICAgICBhZGV2LT5wcF9mb3JjZV9zdGF0ZV9lbmFibGVkID0gdHJ1ZTsKPiAgICAgICAgICAg
ICAgICAgfQo+IC0gICAgICAgICAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0K
PiAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+
ICAgICAgICAgICAgICAgICBwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+
ICAgICAgICAgfQo+IEBAIC02NDMsNyArNjE4LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dl
dF9wcF90YWJsZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBjaGFyICp0YWJsZSA9IE5V
TEw7Cj4gICAgICAgICBpbnQgc2l6ZSwgcmV0Owo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jl
c2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAg
ICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAgcmV0ID0gcG1fcnVudGltZV9nZXRfc3lu
YyhkZGV2LT5kZXYpOwo+IEBAIC02ODcsNyArNjYyLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1
X3NldF9wcF90YWJsZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiA9IGRkZXYtPmRldl9wcml2YXRlOwo+ICAgICAgICAgaW50IHJldCA9IDA7
Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRl
di0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAg
ICAgICByZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTY5NiwyMSAr
NjcxLDE2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfdGFibGUoc3RydWN0IGRldmlj
ZSAqZGV2LAo+ICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICAgICAgICAgfQo+Cj4gLSAg
ICAgICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgaWYgKGlzX3N1
cHBvcnRfc3dfc211KGFkZXYpKSB7Cj4gICAgICAgICAgICAgICAgIHJldCA9IHNtdV9zeXNfc2V0
X3BwX3RhYmxlKCZhZGV2LT5zbXUsICh2b2lkICopYnVmLCBjb3VudCk7Cj4gICAgICAgICAgICAg
ICAgIGlmIChyZXQpIHsKPiAgICAgICAgICAgICAgICAgICAgICAgICBwbV9ydW50aW1lX21hcmtf
bGFzdF9idXN5KGRkZXYtPmRldik7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGlt
ZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPiAtICAgICAgICAgICAgICAgICAgICAgICB1
cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy
biByZXQ7Cj4gICAgICAgICAgICAgICAgIH0KPiAgICAgICAgIH0gZWxzZSBpZiAoYWRldi0+cG93
ZXJwbGF5LnBwX2Z1bmNzLT5zZXRfcHBfdGFibGUpCj4gICAgICAgICAgICAgICAgIGFtZGdwdV9k
cG1fc2V0X3BwX3RhYmxlKGFkZXYsIGJ1ZiwgY291bnQpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZh
ZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3ko
ZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRl
dik7Cj4KPiBAQCAtODQ1LDcgKzgxNSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBf
b2RfY2xrX3ZvbHRhZ2Uoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgY29uc3QgY2hhciBk
ZWxpbWl0ZXJbM10gPSB7JyAnLCAnXG4nLCAnXDAnfTsKPiAgICAgICAgIHVpbnQzMl90IHR5cGU7
Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRl
di0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAg
ICAgICBpZiAoY291bnQgPiAxMjcpCj4gQEAgLTg4OSwxMCArODU5LDYgQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X3NldF9wcF9vZF9jbGtfdm9sdGFnZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAg
ICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIHJldCA9IGNv
dW50Owo+IC0KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAg
ICAgICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpIHsKPiAgICAgICAgICAgICAgICAgcmV0
ID0gc211X29kX2VkaXRfZHBtX3RhYmxlKCZhZGV2LT5zbXUsIHR5cGUsCj4gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXIsIHBhcmFtZXRlcl9zaXpl
KTsKPiBAQCAtOTAwLDggKzg2Niw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfb2Rf
Y2xrX3ZvbHRhZ2Uoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICBpZiAocmV0
KSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShk
ZGV2LT5kZXYpOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9z
dXNwZW5kKGRkZXYtPmRldik7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gLUVJTlZB
TDsKPiAtICAgICAgICAgICAgICAgICAgICAgICBnb3RvIHByb19lbmQ7Cj4gKyAgICAgICAgICAg
ICAgICAgICAgICAgcmV0dXJuIC1FSU5WQUw7Cj4gICAgICAgICAgICAgICAgIH0KPiAgICAgICAg
IH0gZWxzZSB7Cj4gICAgICAgICAgICAgICAgIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3Mt
Pm9kbl9lZGl0X2RwbV90YWJsZSkgewo+IEBAIC05MTAsOCArODc1LDcgQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X3NldF9wcF9vZF9jbGtfdm9sdGFnZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAg
ICAgICAgICAgICAgICAgICAgICAgaWYgKHJldCkgewo+ICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+
ZGV2KTsKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IC1FSU5WQUw7Cj4g
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIHByb19lbmQ7Cj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsKPiAgICAgICAgICAgICAgICAg
ICAgICAgICB9Cj4gICAgICAgICAgICAgICAgIH0KPgo+IEBAIC05MjIsMjIgKzg4NiwxOCBAQCBz
dGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX29kX2Nsa192b2x0YWdlKHN0cnVjdCBkZXZpY2Ug
KmRldiwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBO
VUxMKTsKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBtX3J1bnRpbWVfbWFya19s
YXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBt
X3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICByZXQgPSBjb3VudDsKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGdvdG8gcHJvX2VuZDsKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy
biBjb3VudDsKPiAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugewo+ICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYp
Owo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1
c3BlbmQoZGRldi0+ZGV2KTsKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9
IC1FSU5WQUw7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIHByb19lbmQ7
Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsKPiAgICAg
ICAgICAgICAgICAgICAgICAgICB9Cj4gICAgICAgICAgICAgICAgIH0KPiAgICAgICAgIH0KPiAg
ICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBt
X3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4KPiAtcHJvX2VuZDoKPiAtICAg
ICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLSAgICAgICByZXR1cm4gcmV0Owo+ICsg
ICAgICAgcmV0dXJuIGNvdW50Owo+ICB9Cj4KPiAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9w
cF9vZF9jbGtfdm9sdGFnZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gQEAgLTk0OSw3ICs5MDksNyBA
QCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX29kX2Nsa192b2x0YWdlKHN0cnVjdCBkZXZp
Y2UgKmRldiwKPiAgICAgICAgIHNzaXplX3Qgc2l6ZTsKPiAgICAgICAgIGludCByZXQ7Cj4KPiAt
ICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5f
Z3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICBy
ZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTEwMDMsNyArOTYzLDcg
QEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9mZWF0dXJlcyhzdHJ1Y3QgZGV2aWNlICpk
ZXYsCj4gICAgICAgICB1aW50NjRfdCBmZWF0dXJlbWFzazsKPiAgICAgICAgIGludCByZXQ7Cj4K
PiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+
aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAg
ICByZXQgPSBrc3RydG91NjQoYnVmLCAwLCAmZmVhdHVyZW1hc2spOwo+IEBAIC0xMDE4LDEzICs5
NzgsMTEgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9mZWF0dXJlcyhzdHJ1Y3QgZGV2
aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAt
ICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgICAgICAgIGlmIChpc19zdXBw
b3J0X3N3X3NtdShhZGV2KSkgewo+ICAgICAgICAgICAgICAgICByZXQgPSBzbXVfc3lzX3NldF9w
cF9mZWF0dXJlX21hc2soJmFkZXYtPnNtdSwgZmVhdHVyZW1hc2spOwo+ICAgICAgICAgICAgICAg
ICBpZiAocmV0KSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xh
c3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIHBtX3J1bnRpbWVf
cHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgdXBf
cmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g
LUVJTlZBTDsKPiAgICAgICAgICAgICAgICAgfQo+ICAgICAgICAgfSBlbHNlIGlmIChhZGV2LT5w
b3dlcnBsYXkucHBfZnVuY3MtPnNldF9wcGZlYXR1cmVfc3RhdHVzKSB7Cj4gQEAgLTEwMzIsMTIg
Kzk5MCw5IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfZmVhdHVyZXMoc3RydWN0IGRl
dmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICBpZiAocmV0KSB7Cj4gICAgICAgICAgICAgICAg
ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAg
ICAgICAgICAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4g
LSAgICAgICAgICAgICAgICAgICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgICAg
ICAgICAgICAgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsKPiAgICAgICAgICAgICAgICAgfQo+
ICAgICAgICAgfQo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAg
ICAgICBwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gICAgICAgICBwbV9y
dW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+Cj4gQEAgLTEwNTMsNyArMTAwOCw3
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZmVhdHVyZXMoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAgICAgICAgc3NpemVfdCBzaXplOwo+ICAgICAgICAgaW50IHJldDsKPgo+IC0gICAg
ICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVf
cmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIHJldCA9
IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGRldi0+ZGV2KTsKPiBAQCAtMTA2Miw4ICsxMDE3LDYgQEAg
c3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9mZWF0dXJlcyhzdHJ1Y3QgZGV2aWNlICpkZXYs
Cj4gICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRv
d25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9ydF9z
d19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIHNpemUgPSBzbXVfc3lzX2dldF9wcF9mZWF0
dXJlX21hc2soJmFkZXYtPnNtdSwgYnVmKTsKPiAgICAgICAgIGVsc2UgaWYgKGFkZXYtPnBvd2Vy
cGxheS5wcF9mdW5jcy0+Z2V0X3BwZmVhdHVyZV9zdGF0dXMpCj4gQEAgLTEwNzEsOCArMTAyNCw2
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZmVhdHVyZXMoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAgICAgICBzaXplID0gc25wcmludGYoYnVm
LCBQQUdFX1NJWkUsICJcbiIpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0p
Owo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAg
ICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4KPiBAQCAtMTEx
OCw3ICsxMDY5LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9kcG1fc2NsayhzdHJ1
Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBzc2l6ZV90IHNpemU7Cj4gICAgICAgICBpbnQgcmV0
Owo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFk
ZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAg
ICAgICAgcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5kZXYpOwo+IEBAIC0xMTI3LDgg
KzEwNzgsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX2RwbV9zY2xrKHN0cnVjdCBk
ZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+
IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChp
c19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAgICAgICAgICAgICAgc2l6ZSA9IHNtdV9wcmlu
dF9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9TQ0xLLCBidWYpOwo+ICAgICAgICAgZWxzZSBp
ZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5wcmludF9jbG9ja19sZXZlbHMpCj4gQEAgLTEx
MzYsOCArMTA4NSw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZHBtX3NjbGsoc3Ry
dWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAgICAgICBzaXplID0g
c25wcmludGYoYnVmLCBQQUdFX1NJWkUsICJcbiIpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2
LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRl
di0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7
Cj4KPiBAQCAtMTE5MCw3ICsxMTM3LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9k
cG1fc2NsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBpbnQgcmV0Owo+ICAgICAgICAg
dWludDMyX3QgbWFzayA9IDA7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikp
Cj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1
cm4gLUVQRVJNOwo+Cj4gICAgICAgICByZXQgPSBhbWRncHVfcmVhZF9tYXNrKGJ1ZiwgY291bnQs
ICZtYXNrKTsKPiBAQCAtMTIwMywxNSArMTE1MCwxMSBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVf
c2V0X3BwX2RwbV9zY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0
dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9z
ZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAgICAg
ICAgICAgICAgcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX1NDTEss
IG1hc2spOwo+ICAgICAgICAgZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5mb3Jj
ZV9jbG9ja19sZXZlbCkKPiAgICAgICAgICAgICAgICAgcmV0ID0gYW1kZ3B1X2RwbV9mb3JjZV9j
bG9ja19sZXZlbChhZGV2LCBQUF9TQ0xLLCBtYXNrKTsKPgo+IC0gICAgICAgdXBfcmVhZCgmYWRl
di0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRk
ZXYtPmRldik7Cj4gICAgICAgICBwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYp
Owo+Cj4gQEAgLTEyMzAsNyArMTE3Myw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBf
ZHBtX21jbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgc3NpemVfdCBzaXplOwo+ICAg
ICAgICAgaW50IHJldDsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiAr
ICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAt
RVBFUk07Cj4KPiAgICAgICAgIHJldCA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGRldi0+ZGV2KTsK
PiBAQCAtMTIzOSw4ICsxMTgyLDYgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9kcG1f
bWNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4g
ICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4g
ICAgICAgICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIHNp
emUgPSBzbXVfcHJpbnRfY2xrX2xldmVscygmYWRldi0+c211LCBTTVVfTUNMSywgYnVmKTsKPiAg
ICAgICAgIGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+cHJpbnRfY2xvY2tfbGV2
ZWxzKQo+IEBAIC0xMjQ4LDggKzExODksNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3Bw
X2RwbV9tY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgIGVsc2UKPiAgICAgICAgICAg
ICAgICAgc2l6ZSA9IHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiXG4iKTsKPgo+IC0gICAgICAg
dXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBwbV9ydW50aW1lX21hcmtf
bGFzdF9idXN5KGRkZXYtPmRldik7Cj4gICAgICAgICBwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVu
ZChkZGV2LT5kZXYpOwo+Cj4gQEAgLTEyNjYsNyArMTIwNSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFt
ZGdwdV9zZXRfcHBfZHBtX21jbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgdWludDMy
X3QgbWFzayA9IDA7Cj4gICAgICAgICBpbnQgcmV0Owo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2lu
X3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAg
ICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAgcmV0ID0gYW1kZ3B1X3JlYWRfbWFz
ayhidWYsIGNvdW50LCAmbWFzayk7Cj4gQEAgLTEyNzksMTUgKzEyMTgsMTEgQEAgc3RhdGljIHNz
aXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fbWNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAg
ICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgm
YWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRl
dikpCj4gICAgICAgICAgICAgICAgIHJldCA9IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZhZGV2LT5z
bXUsIFNNVV9NQ0xLLCBtYXNrKTsKPiAgICAgICAgIGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5w
cF9mdW5jcy0+Zm9yY2VfY2xvY2tfbGV2ZWwpCj4gICAgICAgICAgICAgICAgIHJldCA9IGFtZGdw
dV9kcG1fZm9yY2VfY2xvY2tfbGV2ZWwoYWRldiwgUFBfTUNMSywgbWFzayk7Cj4KPiAtICAgICAg
IHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJr
X2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3Bl
bmQoZGRldi0+ZGV2KTsKPgo+IEBAIC0xMzA2LDcgKzEyNDEsNyBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfZ2V0X3BwX2RwbV9zb2NjbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgc3Np
emVfdCBzaXplOwo+ICAgICAgICAgaW50IHJldDsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9y
ZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAg
ICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIHJldCA9IHBtX3J1bnRpbWVfZ2V0X3N5
bmMoZGRldi0+ZGV2KTsKPiBAQCAtMTMxNSw4ICsxMjUwLDYgQEAgc3RhdGljIHNzaXplX3QgYW1k
Z3B1X2dldF9wcF9kcG1fc29jY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAg
ICAgcmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5y
ZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAg
ICAgICAgICAgICAgICAgc2l6ZSA9IHNtdV9wcmludF9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNN
VV9TT0NDTEssIGJ1Zik7Cj4gICAgICAgICBlbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVu
Y3MtPnByaW50X2Nsb2NrX2xldmVscykKPiBAQCAtMTMyNCw4ICsxMjU3LDYgQEAgc3RhdGljIHNz
aXplX3QgYW1kZ3B1X2dldF9wcF9kcG1fc29jY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAg
ICAgIGVsc2UKPiAgICAgICAgICAgICAgICAgc2l6ZSA9IHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpF
LCAiXG4iKTsKPgo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAg
ICAgICBwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gICAgICAgICBwbV9y
dW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+Cj4gQEAgLTEzNDIsNyArMTI3Myw3
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfZHBtX3NvY2NsayhzdHJ1Y3QgZGV2aWNl
ICpkZXYsCj4gICAgICAgICBpbnQgcmV0Owo+ICAgICAgICAgdWludDMyX3QgbWFzayA9IDA7Cj4K
PiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+
aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAg
ICByZXQgPSBhbWRncHVfcmVhZF9tYXNrKGJ1ZiwgY291bnQsICZtYXNrKTsKPiBAQCAtMTM1NSw4
ICsxMjg2LDYgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fc29jY2xrKHN0cnVj
dCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKPiAgICAgICAgIH0K
Pgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlm
IChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAgICAgICAgICAgICAgcmV0ID0gc211X2Zv
cmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX1NPQ0NMSywgbWFzayk7Cj4gICAgICAgICBl
bHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmZvcmNlX2Nsb2NrX2xldmVsKQo+IEBA
IC0xMzY0LDggKzEyOTMsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9zb2Nj
bGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAgICAgICBy
ZXQgPSAwOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAg
ICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1
bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4KPiBAQCAtMTM4NCw3ICsxMzExLDcg
QEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9kcG1fZmNsayhzdHJ1Y3QgZGV2aWNlICpk
ZXYsCj4gICAgICAgICBzc2l6ZV90IHNpemU7Cj4gICAgICAgICBpbnQgcmV0Owo+Cj4gLSAgICAg
ICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9y
ZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAgcmV0ID0g
cG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5kZXYpOwo+IEBAIC0xMzkzLDggKzEzMjAsNiBAQCBz
dGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX2RwbV9mY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwK
PiAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93
bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3
X3NtdShhZGV2KSkKPiAgICAgICAgICAgICAgICAgc2l6ZSA9IHNtdV9wcmludF9jbGtfbGV2ZWxz
KCZhZGV2LT5zbXUsIFNNVV9GQ0xLLCBidWYpOwo+ICAgICAgICAgZWxzZSBpZiAoYWRldi0+cG93
ZXJwbGF5LnBwX2Z1bmNzLT5wcmludF9jbG9ja19sZXZlbHMpCj4gQEAgLTE0MDIsOCArMTMyNyw2
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZHBtX2ZjbGsoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAgICAgICBzaXplID0gc25wcmludGYoYnVm
LCBQQUdFX1NJWkUsICJcbiIpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0p
Owo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAg
ICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4KPiBAQCAtMTQy
MCw3ICsxMzQzLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fZmNsayhzdHJ1
Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBpbnQgcmV0Owo+ICAgICAgICAgdWludDMyX3QgbWFz
ayA9IDA7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBp
ZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+
Cj4gICAgICAgICByZXQgPSBhbWRncHVfcmVhZF9tYXNrKGJ1ZiwgY291bnQsICZtYXNrKTsKPiBA
QCAtMTQzMyw4ICsxMzU2LDYgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fZmNs
ayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAg
ICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAg
ICAgICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIHJldCA9
IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9GQ0xLLCBtYXNrKTsKPiAgICAg
ICAgIGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Zm9yY2VfY2xvY2tfbGV2ZWwp
Cj4gQEAgLTE0NDIsOCArMTM2Myw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfZHBt
X2ZjbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAgICAg
ICByZXQgPSAwOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAg
ICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBt
X3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4KPiBAQCAtMTQ2Miw3ICsxMzgx
LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9wcF9kcG1fZGNlZmNsayhzdHJ1Y3QgZGV2
aWNlICpkZXYsCj4gICAgICAgICBzc2l6ZV90IHNpemU7Cj4gICAgICAgICBpbnQgcmV0Owo+Cj4g
LSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmlu
X2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAg
cmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5kZXYpOwo+IEBAIC0xNDcxLDggKzEzOTAs
NiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3BwX2RwbV9kY2VmY2xrKHN0cnVjdCBkZXZp
Y2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0g
ICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19z
dXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAgICAgICAgICAgICAgc2l6ZSA9IHNtdV9wcmludF9j
bGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9EQ0VGQ0xLLCBidWYpOwo+ICAgICAgICAgZWxzZSBp
ZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5wcmludF9jbG9ja19sZXZlbHMpCj4gQEAgLTE0
ODAsOCArMTM5Nyw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfZHBtX2RjZWZjbGso
c3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAgICAgICBzaXpl
ID0gc25wcmludGYoYnVmLCBQQUdFX1NJWkUsICJcbiIpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZh
ZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3ko
ZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRl
dik7Cj4KPiBAQCAtMTQ5OCw3ICsxNDEzLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9w
cF9kcG1fZGNlZmNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBpbnQgcmV0Owo+ICAg
ICAgICAgdWludDMyX3QgbWFzayA9IDA7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQo
YWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAg
ICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICByZXQgPSBhbWRncHVfcmVhZF9tYXNrKGJ1Ziwg
Y291bnQsICZtYXNrKTsKPiBAQCAtMTUxMSw4ICsxNDI2LDYgQEAgc3RhdGljIHNzaXplX3QgYW1k
Z3B1X3NldF9wcF9kcG1fZGNlZmNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAg
ICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+
cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpCj4g
ICAgICAgICAgICAgICAgIHJldCA9IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNN
VV9EQ0VGQ0xLLCBtYXNrKTsKPiAgICAgICAgIGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9m
dW5jcy0+Zm9yY2VfY2xvY2tfbGV2ZWwpCj4gQEAgLTE1MjAsOCArMTQzMyw2IEBAIHN0YXRpYyBz
c2l6ZV90IGFtZGdwdV9zZXRfcHBfZHBtX2RjZWZjbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAg
ICAgICAgZWxzZQo+ICAgICAgICAgICAgICAgICByZXQgPSAwOwo+Cj4gLSAgICAgICB1cF9yZWFk
KCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1
c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYt
PmRldik7Cj4KPiBAQCAtMTU0MCw3ICsxNDUxLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dl
dF9wcF9kcG1fcGNpZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBzc2l6ZV90IHNpemU7
Cj4gICAgICAgICBpbnQgcmV0Owo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYp
KQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0
dXJuIC1FUEVSTTsKPgo+ICAgICAgICAgcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5k
ZXYpOwo+IEBAIC0xNTQ5LDggKzE0NjAsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3Bw
X2RwbV9wY2llKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIHJl
dDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAgICAgICAgICAg
ICAgc2l6ZSA9IHNtdV9wcmludF9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9QQ0lFLCBidWYp
Owo+ICAgICAgICAgZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5wcmludF9jbG9j
a19sZXZlbHMpCj4gQEAgLTE1NTgsOCArMTQ2Nyw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9n
ZXRfcHBfZHBtX3BjaWUoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgZWxzZQo+ICAgICAg
ICAgICAgICAgICBzaXplID0gc25wcmludGYoYnVmLCBQQUdFX1NJWkUsICJcbiIpOwo+Cj4gLSAg
ICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVf
bWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9z
dXNwZW5kKGRkZXYtPmRldik7Cj4KPiBAQCAtMTU3Niw3ICsxNDgzLDcgQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X3NldF9wcF9kcG1fcGNpZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBp
bnQgcmV0Owo+ICAgICAgICAgdWludDMyX3QgbWFzayA9IDA7Cj4KPiAtICAgICAgIGlmIChhbWRn
cHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAg
ICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICByZXQgPSBhbWRncHVfcmVh
ZF9tYXNrKGJ1ZiwgY291bnQsICZtYXNrKTsKPiBAQCAtMTU4OSw4ICsxNDk2LDYgQEAgc3RhdGlj
IHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fcGNpZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAg
ICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVh
ZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9ydF9zd19zbXUo
YWRldikpCj4gICAgICAgICAgICAgICAgIHJldCA9IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZhZGV2
LT5zbXUsIFNNVV9QQ0lFLCBtYXNrKTsKPiAgICAgICAgIGVsc2UgaWYgKGFkZXYtPnBvd2VycGxh
eS5wcF9mdW5jcy0+Zm9yY2VfY2xvY2tfbGV2ZWwpCj4gQEAgLTE1OTgsOCArMTUwMyw2IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfZHBtX3BjaWUoc3RydWN0IGRldmljZSAqZGV2LAo+
ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAgICAgICByZXQgPSAwOwo+Cj4gLSAgICAgICB1cF9y
ZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0
X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRk
ZXYtPmRldik7Cj4KPiBAQCAtMTYxOCw3ICsxNTIxLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1
X2dldF9wcF9zY2xrX29kKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgIHVpbnQzMl90IHZh
bHVlID0gMDsKPiAgICAgICAgIGludCByZXQ7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVz
ZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAg
ICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICByZXQgPSBwbV9ydW50aW1lX2dldF9zeW5j
KGRkZXYtPmRldik7Cj4gQEAgLTE2MjcsMTUgKzE1MzAsMTEgQEAgc3RhdGljIHNzaXplX3QgYW1k
Z3B1X2dldF9wcF9zY2xrX29kKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAg
cmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNl
dF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAg
ICAgICAgICAgICAgdmFsdWUgPSBzbXVfZ2V0X29kX3BlcmNlbnRhZ2UoJihhZGV2LT5zbXUpLCBT
TVVfT0RfU0NMSyk7Cj4gICAgICAgICBlbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3Mt
PmdldF9zY2xrX29kKQo+ICAgICAgICAgICAgICAgICB2YWx1ZSA9IGFtZGdwdV9kcG1fZ2V0X3Nj
bGtfb2QoYWRldik7Cj4KPiAtICAgICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+
ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAg
cG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPgo+IEBAIC0xNjUyLDcgKzE1
NTEsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX3NjbGtfb2Qoc3RydWN0IGRldmlj
ZSAqZGV2LAo+ICAgICAgICAgaW50IHJldDsKPiAgICAgICAgIGxvbmcgaW50IHZhbHVlOwo+Cj4g
LSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmlu
X2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAg
cmV0ID0ga3N0cnRvbChidWYsIDAsICZ2YWx1ZSk7Cj4gQEAgLTE2NjYsOCArMTU2NSw2IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9zZXRfcHBfc2Nsa19vZChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4g
ICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25f
cmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9ydF9zd19z
bXUoYWRldikpIHsKPiAgICAgICAgICAgICAgICAgdmFsdWUgPSBzbXVfc2V0X29kX3BlcmNlbnRh
Z2UoJihhZGV2LT5zbXUpLCBTTVVfT0RfU0NMSywgKHVpbnQzMl90KXZhbHVlKTsKPiAgICAgICAg
IH0gZWxzZSB7Cj4gQEAgLTE2ODIsOCArMTU3OSw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9z
ZXRfcHBfc2Nsa19vZChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIH0KPiAg
ICAgICAgIH0KPgo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAg
ICAgICBwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGRkZXYtPmRldik7Cj4gICAgICAgICBwbV9y
dW50aW1lX3B1dF9hdXRvc3VzcGVuZChkZGV2LT5kZXYpOwo+Cj4gQEAgLTE2OTksNyArMTU5NCw3
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfbWNsa19vZChzdHJ1Y3QgZGV2aWNlICpk
ZXYsCj4gICAgICAgICB1aW50MzJfdCB2YWx1ZSA9IDA7Cj4gICAgICAgICBpbnQgcmV0Owo+Cj4g
LSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmlu
X2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAg
cmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5kZXYpOwo+IEBAIC0xNzA4LDE1ICsxNjAz
LDExIEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfcHBfbWNsa19vZChzdHJ1Y3QgZGV2aWNl
ICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAg
ICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3Vw
cG9ydF9zd19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIHZhbHVlID0gc211X2dldF9vZF9w
ZXJjZW50YWdlKCYoYWRldi0+c211KSwgU01VX09EX01DTEspOwo+ICAgICAgICAgZWxzZSBpZiAo
YWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfbWNsa19vZCkKPiAgICAgICAgICAgICAgICAg
dmFsdWUgPSBhbWRncHVfZHBtX2dldF9tY2xrX29kKGFkZXYpOwo+Cj4gLSAgICAgICB1cF9yZWFk
KCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1
c3koZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYt
PmRldik7Cj4KPiBAQCAtMTczMyw3ICsxNjI0LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3Nl
dF9wcF9tY2xrX29kKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgIGludCByZXQ7Cj4gICAg
ICAgICBsb25nIGludCB2YWx1ZTsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2
KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJl
dHVybiAtRVBFUk07Cj4KPiAgICAgICAgIHJldCA9IGtzdHJ0b2woYnVmLCAwLCAmdmFsdWUpOwo+
IEBAIC0xNzQ3LDggKzE2MzgsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX21jbGtf
b2Qoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICAg
ICAgICAgfQo+Cj4gLSAgICAgICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAg
ICAgICAgaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKSB7Cj4gICAgICAgICAgICAgICAgIHZh
bHVlID0gc211X3NldF9vZF9wZXJjZW50YWdlKCYoYWRldi0+c211KSwgU01VX09EX01DTEssICh1
aW50MzJfdCl2YWx1ZSk7Cj4gICAgICAgICB9IGVsc2Ugewo+IEBAIC0xNzYzLDggKzE2NTIsNiBA
QCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX21jbGtfb2Qoc3RydWN0IGRldmljZSAqZGV2
LAo+ICAgICAgICAgICAgICAgICB9Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIHVwX3JlYWQoJmFk
ZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShk
ZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2
KTsKPgo+IEBAIC0xODAwLDcgKzE2ODcsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X3Bw
X3Bvd2VyX3Byb2ZpbGVfbW9kZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBzc2l6ZV90
IHNpemU7Cj4gICAgICAgICBpbnQgcmV0Owo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0
KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAg
ICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAgcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhk
ZGV2LT5kZXYpOwo+IEBAIC0xODA5LDggKzE2OTYsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVf
Z2V0X3BwX3Bvd2VyX3Byb2ZpbGVfbW9kZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAg
ICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRl
di0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikp
Cj4gICAgICAgICAgICAgICAgIHNpemUgPSBzbXVfZ2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZSgmYWRl
di0+c211LCBidWYpOwo+ICAgICAgICAgZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNz
LT5nZXRfcG93ZXJfcHJvZmlsZV9tb2RlKQo+IEBAIC0xODE4LDggKzE3MDMsNiBAQCBzdGF0aWMg
c3NpemVfdCBhbWRncHVfZ2V0X3BwX3Bvd2VyX3Byb2ZpbGVfbW9kZShzdHJ1Y3QgZGV2aWNlICpk
ZXYsCj4gICAgICAgICBlbHNlCj4gICAgICAgICAgICAgICAgIHNpemUgPSBzbnByaW50ZihidWYs
IFBBR0VfU0laRSwgIlxuIik7Cj4KPiAtICAgICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7
Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAg
ICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZGRldi0+ZGV2KTsKPgo+IEBAIC0xODQ0
LDcgKzE3MjcsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX3Bvd2VyX3Byb2ZpbGVf
bW9kZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBsb25nIGludCBwcm9maWxlX21vZGUg
PSAwOwo+ICAgICAgICAgY29uc3QgY2hhciBkZWxpbWl0ZXJbM10gPSB7JyAnLCAnXG4nLCAnXDAn
fTsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChh
ZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAg
ICAgICAgIHRtcFswXSA9ICooYnVmKTsKPiBAQCAtMTg3OCwxNSArMTc2MSwxMSBAQCBzdGF0aWMg
c3NpemVfdCBhbWRncHVfc2V0X3BwX3Bvd2VyX3Byb2ZpbGVfbW9kZShzdHJ1Y3QgZGV2aWNlICpk
ZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAgICB9Cj4KPiAtICAgICAg
IGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9y
dF9zd19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIHJldCA9IHNtdV9zZXRfcG93ZXJfcHJv
ZmlsZV9tb2RlKCZhZGV2LT5zbXUsIHBhcmFtZXRlciwgcGFyYW1ldGVyX3NpemUsIHRydWUpOwo+
ICAgICAgICAgZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5zZXRfcG93ZXJfcHJv
ZmlsZV9tb2RlKQo+ICAgICAgICAgICAgICAgICByZXQgPSBhbWRncHVfZHBtX3NldF9wb3dlcl9w
cm9maWxlX21vZGUoYWRldiwgcGFyYW1ldGVyLCBwYXJhbWV0ZXJfc2l6ZSk7Cj4KPiAtICAgICAg
IHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJr
X2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3Bl
bmQoZGRldi0+ZGV2KTsKPgo+IEBAIC0xOTEyLDcgKzE3OTEsNyBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfZ2V0X2dwdV9idXN5X3BlcmNlbnQoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAg
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBkZGV2LT5kZXZfcHJpdmF0ZTsKPiAgICAgICAg
IGludCByLCB2YWx1ZSwgc2l6ZSA9IHNpemVvZih2YWx1ZSk7Cj4KPiAtICAgICAgIGlmIChhbWRn
cHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAg
ICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICByID0gcG1fcnVudGltZV9n
ZXRfc3luYyhkZGV2LT5kZXYpOwo+IEBAIC0xOTIxLDExICsxODAwLDkgQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X2dldF9ncHVfYnVzeV9wZXJjZW50KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAg
ICAgICAgICAgICAgcmV0dXJuIHI7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgm
YWRldi0+cmVzZXRfc2VtKTsKPiAgICAgICAgIC8qIHJlYWQgdGhlIElQIGJ1c3kgc2Vuc29yICov
Cj4gICAgICAgICByID0gYW1kZ3B1X2RwbV9yZWFkX3NlbnNvcihhZGV2LCBBTURHUFVfUFBfU0VO
U09SX0dQVV9MT0FELAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHZvaWQg
KikmdmFsdWUsICZzaXplKTsKPiAtICAgICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4K
PiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAgICAgICAg
IHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4gQEAgLTE5NTIsNyArMTgy
OSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfbWVtX2J1c3lfcGVyY2VudChzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCj4gICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRkZXYt
PmRldl9wcml2YXRlOwo+ICAgICAgICAgaW50IHIsIHZhbHVlLCBzaXplID0gc2l6ZW9mKHZhbHVl
KTsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChh
ZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAg
ICAgICAgIHIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGRkZXYtPmRldik7Cj4gQEAgLTE5NjEsMTQg
KzE4MzgsMTAgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9tZW1fYnVzeV9wZXJjZW50KHN0
cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIHI7Cj4gICAgICAgICB9
Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICAv
KiByZWFkIHRoZSBJUCBidXN5IHNlbnNvciAqLwo+ICAgICAgICAgciA9IGFtZGdwdV9kcG1fcmVh
ZF9zZW5zb3IoYWRldiwgQU1ER1BVX1BQX1NFTlNPUl9NRU1fTE9BRCwKPiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICh2b2lkICopJnZhbHVlLCAmc2l6ZSk7Cj4KPiAtICAgICAg
IHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJr
X2xhc3RfYnVzeShkZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3Bl
bmQoZGRldi0+ZGV2KTsKPgo+IEBAIC0xOTk5LDcgKzE4NzIsNyBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfZ2V0X3BjaWVfYncoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgdWludDY0X3Qg
Y291bnQwID0gMCwgY291bnQxID0gMDsKPiAgICAgICAgIGludCByZXQ7Cj4KPiAtICAgICAgIGlm
IChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0
KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICBpZiAoYWRldi0+
ZmxhZ3MgJiBBTURfSVNfQVBVKQo+IEBAIC0yMDE0LDEyICsxODg3LDggQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X2dldF9wY2llX2J3KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAg
ICAgcmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5y
ZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGFtZGdwdV9hc2ljX2dldF9wY2llX3VzYWdlKGFkZXYs
ICZjb3VudDAsICZjb3VudDEpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0p
Owo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZGRldi0+ZGV2KTsKPiAg
ICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGRkZXYtPmRldik7Cj4KPiBAQCAtMjA0
NCw3ICsxOTEzLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF91bmlxdWVfaWQoc3RydWN0
IGRldmljZSAqZGV2LAo+ICAgICAgICAgc3RydWN0IGRybV9kZXZpY2UgKmRkZXYgPSBkZXZfZ2V0
X2RydmRhdGEoZGV2KTsKPiAgICAgICAgIHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gZGRl
di0+ZGV2X3ByaXZhdGU7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4g
KyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4g
LUVQRVJNOwo+Cj4gICAgICAgICBpZiAoYWRldi0+dW5pcXVlX2lkKQo+IEBAIC0yMTQyLDcgKzIw
MTEsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfZ2V0X2dwdV9tZXRyaWNzKHN0cnVjdCBkZXZp
Y2UgKmRldiwKPiAgICAgICAgIHNzaXplX3Qgc2l6ZSA9IDA7Cj4gICAgICAgICBpbnQgcmV0Owo+
Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYt
PmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAg
ICAgcmV0ID0gcG1fcnVudGltZV9nZXRfc3luYyhkZGV2LT5kZXYpOwo+IEBAIC0yMTUxLDEyICsy
MDIwLDEwIEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9nZXRfZ3B1X21ldHJpY3Moc3RydWN0IGRl
dmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICAgICAgICAgfQo+Cj4g
LSAgICAgICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gICAgICAgICBpZiAoaXNfc3Vw
cG9ydF9zd19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIHNpemUgPSBzbXVfc3lzX2dldF9n
cHVfbWV0cmljcygmYWRldi0+c211LCAmZ3B1X21ldHJpY3MpOwo+ICAgICAgICAgZWxzZSBpZiAo
YWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfZ3B1X21ldHJpY3MpCj4gICAgICAgICAgICAg
ICAgIHNpemUgPSBhbWRncHVfZHBtX2dldF9ncHVfbWV0cmljcyhhZGV2LCAmZ3B1X21ldHJpY3Mp
Owo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPgo+ICAgICAgICAgaWYgKHNp
emUgPD0gMCkKPiAgICAgICAgICAgICAgICAgZ290byBvdXQ7Cj4gQEAgLTIzNjgsNyArMjIzNSw3
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3RlbXAoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAgICAgICAgaW50IGNoYW5uZWwgPSB0b19zZW5zb3JfZGV2X2F0dHIoYXR0ciktPmlu
ZGV4Owo+ICAgICAgICAgaW50IHIsIHRlbXAgPSAwLCBzaXplID0gc2l6ZW9mKHRlbXApOwo+Cj4g
LSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmlu
X2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAg
aWYgKGNoYW5uZWwgPj0gUFBfVEVNUF9NQVgpCj4gQEAgLTIzODAsOCArMjI0Nyw2IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3RlbXAoc3RydWN0IGRldmljZSAqZGV2LAo+ICAg
ICAgICAgICAgICAgICByZXR1cm4gcjsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFk
KCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHN3aXRjaCAoY2hhbm5lbCkgewo+ICAg
ICAgICAgY2FzZSBQUF9URU1QX0pVTkNUSU9OOgo+ICAgICAgICAgICAgICAgICAvKiBnZXQgY3Vy
cmVudCBqdW5jdGlvbiB0ZW1wZXJhdHVyZSAqLwo+IEBAIC0yNDAzLDggKzIyNjgsNiBAQCBzdGF0
aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hvd190ZW1wKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAg
ICAgICAgICAgICAgICAgYnJlYWs7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIHVwX3JlYWQoJmFk
ZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShh
ZGV2LT5kZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoYWRl
di0+ZGRldi0+ZGV2KTsKPgo+IEBAIC0yNTA4LDcgKzIzNzEsNyBAQCBzdGF0aWMgc3NpemVfdCBh
bWRncHVfaHdtb25fZ2V0X3B3bTFfZW5hYmxlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAg
IHUzMiBwd21fbW9kZSA9IDA7Cj4gICAgICAgICBpbnQgcmV0Owo+Cj4gLSAgICAgICBpZiAoYW1k
Z3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAg
ICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAgcmV0ID0gcG1fcnVudGlt
ZV9nZXRfc3luYyhhZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC0yNTE3LDIzICsyMzgwLDE4IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9nZXRfcHdtMV9lbmFibGUoc3RydWN0IGRldmljZSAq
ZGV2LAo+ICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICAgICAgICAgfQo+Cj4gLSAgICAg
ICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgaWYgKGlzX3N1cHBv
cnRfc3dfc211KGFkZXYpKSB7Cj4gICAgICAgICAgICAgICAgIHB3bV9tb2RlID0gc211X2dldF9m
YW5fY29udHJvbF9tb2RlKCZhZGV2LT5zbXUpOwo+ICAgICAgICAgfSBlbHNlIHsKPiAgICAgICAg
ICAgICAgICAgaWYgKCFhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9mYW5fY29udHJvbF9t
b2RlKSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVz
eShhZGV2LT5kZGV2LT5kZXYpOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIHBtX3J1bnRpbWVf
cHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4gLSAgICAgICAgICAgICAgICAgICAg
ICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAgICAgICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gLUVJTlZBTDsKPiAgICAgICAgICAgICAgICAgfQo+Cj4gICAgICAgICAgICAgICAgIHB3
bV9tb2RlID0gYW1kZ3B1X2RwbV9nZXRfZmFuX2NvbnRyb2xfbW9kZShhZGV2KTsKPiAgICAgICAg
IH0KPgo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBw
bV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gICAgICAgICBwbV9y
dW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+Cj4gQEAgLTI1NDksNyAr
MjQwNyw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zZXRfcHdtMV9lbmFibGUoc3Ry
dWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgaW50IGVyciwgcmV0Owo+ICAgICAgICAgaW50IHZh
bHVlOwo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYg
KGFkZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+
ICAgICAgICAgZXJyID0ga3N0cnRvaW50KGJ1ZiwgMTAsICZ2YWx1ZSk7Cj4gQEAgLTI1NjIsMjMg
KzI0MjAsMTggQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3NldF9wd20xX2VuYWJsZShz
dHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gICAgICAg
ICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAg
ICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpIHsKPiAgICAgICAgICAgICAgICAgc211X3Nl
dF9mYW5fY29udHJvbF9tb2RlKCZhZGV2LT5zbXUsIHZhbHVlKTsKPiAgICAgICAgIH0gZWxzZSB7
Cj4gICAgICAgICAgICAgICAgIGlmICghYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5zZXRfZmFu
X2NvbnRyb2xfbW9kZSkgewo+ICAgICAgICAgICAgICAgICAgICAgICAgIHBtX3J1bnRpbWVfbWFy
a19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsKPiAgICAgICAgICAgICAgICAgICAgICAgICBw
bV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+IC0gICAgICAgICAg
ICAgICAgICAgICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gICAgICAgICAgICAgICAg
ICAgICAgICAgcmV0dXJuIC1FSU5WQUw7Cj4gICAgICAgICAgICAgICAgIH0KPgo+ICAgICAgICAg
ICAgICAgICBhbWRncHVfZHBtX3NldF9mYW5fY29udHJvbF9tb2RlKGFkZXYsIHZhbHVlKTsKPiAg
ICAgICAgIH0KPgo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAg
ICAgICBwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gICAgICAg
ICBwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+Cj4gQEAgLTI2
MDgsNyArMjQ2MSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zZXRfcHdtMShzdHJ1
Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICB1MzIgdmFsdWU7Cj4gICAgICAgICB1MzIgcHdtX21v
ZGU7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAo
YWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4g
ICAgICAgICBlcnIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGFkZXYtPmRkZXYtPmRldik7Cj4gQEAg
LTI2MTcsMTUgKzI0NzAsMTEgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3NldF9wd20x
KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIGVycjsKPiAgICAg
ICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAg
ICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAgICAgICAgICAgICAgcHdtX21v
ZGUgPSBzbXVfZ2V0X2Zhbl9jb250cm9sX21vZGUoJmFkZXYtPnNtdSk7Cj4gICAgICAgICBlbHNl
Cj4gICAgICAgICAgICAgICAgIHB3bV9tb2RlID0gYW1kZ3B1X2RwbV9nZXRfZmFuX2NvbnRyb2xf
bW9kZShhZGV2KTsKPgo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4g
ICAgICAgICBpZiAocHdtX21vZGUgIT0gQU1EX0ZBTl9DVFJMX01BTlVBTCkgewo+ICAgICAgICAg
ICAgICAgICBwcl9pbmZvKCJtYW51YWwgZmFuIHNwZWVkIGNvbnRyb2wgc2hvdWxkIGJlIGVuYWJs
ZWQgZmlyc3RcbiIpOwo+ICAgICAgICAgICAgICAgICBwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5
KGFkZXYtPmRkZXYtPmRldik7Cj4gQEAgLTI2NjYsNyArMjUxNSw3IEBAIHN0YXRpYyBzc2l6ZV90
IGFtZGdwdV9od21vbl9nZXRfcHdtMShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBpbnQg
ZXJyOwo+ICAgICAgICAgdTMyIHNwZWVkID0gMDsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9y
ZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAg
ICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIGVyciA9IHBtX3J1bnRpbWVfZ2V0X3N5
bmMoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjY3NSw4ICsyNTI0LDYgQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X2h3bW9uX2dldF9wd20xKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAg
ICAgICAgcmV0dXJuIGVycjsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2
LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkK
PiAgICAgICAgICAgICAgICAgZXJyID0gc211X2dldF9mYW5fc3BlZWRfcGVyY2VudCgmYWRldi0+
c211LCAmc3BlZWQpOwo+ICAgICAgICAgZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNz
LT5nZXRfZmFuX3NwZWVkX3BlcmNlbnQpCj4gQEAgLTI2ODQsOCArMjUzMSw2IEBAIHN0YXRpYyBz
c2l6ZV90IGFtZGdwdV9od21vbl9nZXRfcHdtMShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAg
ICBlbHNlCj4gICAgICAgICAgICAgICAgIGVyciA9IC1FSU5WQUw7Cj4KPiAtICAgICAgIHVwX3Jl
YWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3Rf
YnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3Bl
bmQoYWRldi0+ZGRldi0+ZGV2KTsKPgo+IEBAIC0yNzA1LDcgKzI1NTAsNyBAQCBzdGF0aWMgc3Np
emVfdCBhbWRncHVfaHdtb25fZ2V0X2ZhbjFfaW5wdXQoc3RydWN0IGRldmljZSAqZGV2LAo+ICAg
ICAgICAgaW50IGVycjsKPiAgICAgICAgIHUzMiBzcGVlZCA9IDA7Cj4KPiAtICAgICAgIGlmIChh
bWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+
ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICBlcnIgPSBwbV9ydW50
aW1lX2dldF9zeW5jKGFkZXYtPmRkZXYtPmRldik7Cj4gQEAgLTI3MTQsOCArMjU1OSw2IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9nZXRfZmFuMV9pbnB1dChzdHJ1Y3QgZGV2aWNlICpk
ZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiBlcnI7Cj4gICAgICAgICB9Cj4KPiAtICAgICAg
IGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9y
dF9zd19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIGVyciA9IHNtdV9nZXRfZmFuX3NwZWVk
X3JwbSgmYWRldi0+c211LCAmc3BlZWQpOwo+ICAgICAgICAgZWxzZSBpZiAoYWRldi0+cG93ZXJw
bGF5LnBwX2Z1bmNzLT5nZXRfZmFuX3NwZWVkX3JwbSkKPiBAQCAtMjcyMyw4ICsyNTY2LDYgQEAg
c3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX2dldF9mYW4xX2lucHV0KHN0cnVjdCBkZXZpY2Ug
KmRldiwKPiAgICAgICAgIGVsc2UKPiAgICAgICAgICAgICAgICAgZXJyID0gLUVJTlZBTDsKPgo+
IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBwbV9ydW50
aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gICAgICAgICBwbV9ydW50aW1l
X3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+Cj4gQEAgLTI3NDMsNyArMjU4NCw3
IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9nZXRfZmFuMV9taW4oc3RydWN0IGRldmlj
ZSAqZGV2LAo+ICAgICAgICAgdTMyIHNpemUgPSBzaXplb2YobWluX3JwbSk7Cj4gICAgICAgICBp
bnQgcjsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlm
IChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4K
PiAgICAgICAgIHIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGFkZXYtPmRkZXYtPmRldik7Cj4gQEAg
LTI3NTIsMTMgKzI1OTMsOSBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fZ2V0X2ZhbjFf
bWluKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIHI7Cj4gICAg
ICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAg
ICAgICByID0gYW1kZ3B1X2RwbV9yZWFkX3NlbnNvcihhZGV2LCBBTURHUFVfUFBfU0VOU09SX01J
Tl9GQU5fUlBNLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHZvaWQgKikm
bWluX3JwbSwgJnNpemUpOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsK
PiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4K
PiBAQCAtMjc3Nyw3ICsyNjE0LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX2dldF9m
YW4xX21heChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICB1MzIgc2l6ZSA9IHNpemVvZiht
YXhfcnBtKTsKPiAgICAgICAgIGludCByOwo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0
KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAg
ICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAgICAgICAgciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoYWRl
di0+ZGRldi0+ZGV2KTsKPiBAQCAtMjc4NiwxMyArMjYyMyw5IEBAIHN0YXRpYyBzc2l6ZV90IGFt
ZGdwdV9od21vbl9nZXRfZmFuMV9tYXgoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAg
ICAgICByZXR1cm4gcjsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5y
ZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHIgPSBhbWRncHVfZHBtX3JlYWRfc2Vuc29yKGFkZXYs
IEFNREdQVV9QUF9TRU5TT1JfTUFYX0ZBTl9SUE0sCj4gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAodm9pZCAqKSZtYXhfcnBtLCAmc2l6ZSk7Cj4KPiAtICAgICAgIHVwX3JlYWQo
JmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVz
eShhZGV2LT5kZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQo
YWRldi0+ZGRldi0+ZGV2KTsKPgo+IEBAIC0yODEwLDcgKzI2NDMsNyBAQCBzdGF0aWMgc3NpemVf
dCBhbWRncHVfaHdtb25fZ2V0X2ZhbjFfdGFyZ2V0KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAg
ICAgIGludCBlcnI7Cj4gICAgICAgICB1MzIgcnBtID0gMDsKPgo+IC0gICAgICAgaWYgKGFtZGdw
dV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAg
ICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIGVyciA9IHBtX3J1bnRpbWVf
Z2V0X3N5bmMoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjgxOSw4ICsyNjUyLDYgQEAgc3RhdGlj
IHNzaXplX3QgYW1kZ3B1X2h3bW9uX2dldF9mYW4xX3RhcmdldChzdHJ1Y3QgZGV2aWNlICpkZXYs
Cj4gICAgICAgICAgICAgICAgIHJldHVybiBlcnI7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRv
d25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBpZiAoaXNfc3VwcG9ydF9z
d19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIGVyciA9IHNtdV9nZXRfZmFuX3NwZWVkX3Jw
bSgmYWRldi0+c211LCAmcnBtKTsKPiAgICAgICAgIGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5w
cF9mdW5jcy0+Z2V0X2Zhbl9zcGVlZF9ycG0pCj4gQEAgLTI4MjgsOCArMjY1OSw2IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9od21vbl9nZXRfZmFuMV90YXJnZXQoc3RydWN0IGRldmljZSAqZGV2
LAo+ICAgICAgICAgZWxzZQo+ICAgICAgICAgICAgICAgICBlcnIgPSAtRUlOVkFMOwo+Cj4gLSAg
ICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVf
bWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0
X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4KPiBAQCAtMjg0OCw3ICsyNjc3LDcgQEAg
c3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3NldF9mYW4xX3RhcmdldChzdHJ1Y3QgZGV2aWNl
ICpkZXYsCj4gICAgICAgICB1MzIgdmFsdWU7Cj4gICAgICAgICB1MzIgcHdtX21vZGU7Cj4KPiAt
ICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5f
Z3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICBl
cnIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGFkZXYtPmRkZXYtPmRldik7Cj4gQEAgLTI4NTcsMTUg
KzI2ODYsMTEgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3NldF9mYW4xX3RhcmdldChz
dHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiBlcnI7Cj4gICAgICAg
ICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAg
ICBpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpCj4gICAgICAgICAgICAgICAgIHB3bV9tb2Rl
ID0gc211X2dldF9mYW5fY29udHJvbF9tb2RlKCZhZGV2LT5zbXUpOwo+ICAgICAgICAgZWxzZQo+
ICAgICAgICAgICAgICAgICBwd21fbW9kZSA9IGFtZGdwdV9kcG1fZ2V0X2Zhbl9jb250cm9sX21v
ZGUoYWRldik7Cj4KPiAtICAgICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAg
ICAgICAgaWYgKHB3bV9tb2RlICE9IEFNRF9GQU5fQ1RSTF9NQU5VQUwpIHsKPiAgICAgICAgICAg
ICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAgICAg
ICAgICAgICAgICBwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+
IEBAIC0yODc5LDggKzI3MDQsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2V0X2Zh
bjFfdGFyZ2V0KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIGVy
cjsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAgICAgICAgICAg
ICAgZXJyID0gc211X3NldF9mYW5fc3BlZWRfcnBtKCZhZGV2LT5zbXUsIHZhbHVlKTsKPiAgICAg
ICAgIGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+c2V0X2Zhbl9zcGVlZF9ycG0p
Cj4gQEAgLTI4ODgsOCArMjcxMSw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zZXRf
ZmFuMV90YXJnZXQoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgZWxzZQo+ICAgICAgICAg
ICAgICAgICBlcnIgPSAtRUlOVkFMOwo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9z
ZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+
ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRl
dik7Cj4KPiBAQCAtMjkwNyw3ICsyNzI4LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9u
X2dldF9mYW4xX2VuYWJsZShzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICB1MzIgcHdtX21v
ZGUgPSAwOwo+ICAgICAgICAgaW50IHJldDsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNl
dChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAg
ICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIHJldCA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMo
YWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMjkxNiwyMyArMjczNywxOCBAQCBzdGF0aWMgc3NpemVf
dCBhbWRncHVfaHdtb25fZ2V0X2ZhbjFfZW5hYmxlKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAg
ICAgICAgICAgICAgcmV0dXJuIHJldDsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFk
KCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShh
ZGV2KSkgewo+ICAgICAgICAgICAgICAgICBwd21fbW9kZSA9IHNtdV9nZXRfZmFuX2NvbnRyb2xf
bW9kZSgmYWRldi0+c211KTsKPiAgICAgICAgIH0gZWxzZSB7Cj4gICAgICAgICAgICAgICAgIGlm
ICghYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfZmFuX2NvbnRyb2xfbW9kZSkgewo+ICAg
ICAgICAgICAgICAgICAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRl
di0+ZGV2KTsKPiAgICAgICAgICAgICAgICAgICAgICAgICBwbV9ydW50aW1lX3B1dF9hdXRvc3Vz
cGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+IC0gICAgICAgICAgICAgICAgICAgICAgIHVwX3JlYWQo
JmFkZXYtPnJlc2V0X3NlbSk7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC1FSU5W
QUw7Cj4gICAgICAgICAgICAgICAgIH0KPgo+ICAgICAgICAgICAgICAgICBwd21fbW9kZSA9IGFt
ZGdwdV9kcG1fZ2V0X2Zhbl9jb250cm9sX21vZGUoYWRldik7Cj4gICAgICAgICB9Cj4KPiAtICAg
ICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgcG1fcnVudGltZV9t
YXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRf
YXV0b3N1c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsKPgo+IEBAIC0yOTQ5LDcgKzI3NjUsNyBAQCBz
dGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2V0X2ZhbjFfZW5hYmxlKHN0cnVjdCBkZXZpY2Ug
KmRldiwKPiAgICAgICAgIGludCB2YWx1ZTsKPiAgICAgICAgIHUzMiBwd21fbW9kZTsKPgo+IC0g
ICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9n
cHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIGVy
ciA9IGtzdHJ0b2ludChidWYsIDEwLCAmdmFsdWUpOwo+IEBAIC0yOTY5LDIyICsyNzg1LDE3IEBA
IHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zZXRfZmFuMV9lbmFibGUoc3RydWN0IGRldmlj
ZSAqZGV2LAo+ICAgICAgICAgICAgICAgICByZXR1cm4gZXJyOwo+ICAgICAgICAgfQo+Cj4gLSAg
ICAgICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgaWYgKGlzX3N1
cHBvcnRfc3dfc211KGFkZXYpKSB7Cj4gICAgICAgICAgICAgICAgIHNtdV9zZXRfZmFuX2NvbnRy
b2xfbW9kZSgmYWRldi0+c211LCBwd21fbW9kZSk7Cj4gICAgICAgICB9IGVsc2Ugewo+ICAgICAg
ICAgICAgICAgICBpZiAoIWFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+c2V0X2Zhbl9jb250cm9s
X21vZGUpIHsKPiAgICAgICAgICAgICAgICAgICAgICAgICBwbV9ydW50aW1lX21hcmtfbGFzdF9i
dXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgcG1fcnVudGlt
ZV9wdXRfYXV0b3N1c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsKPiAtICAgICAgICAgICAgICAgICAg
ICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAgICAgICAgICAgICAgICAgICAgICAg
IHJldHVybiAtRUlOVkFMOwo+ICAgICAgICAgICAgICAgICB9Cj4gICAgICAgICAgICAgICAgIGFt
ZGdwdV9kcG1fc2V0X2Zhbl9jb250cm9sX21vZGUoYWRldiwgcHdtX21vZGUpOwo+ICAgICAgICAg
fQo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBt
X3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1
bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4KPiBAQCAtMjk5OSw3ICsy
ODEwLDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfdmRkZ2Z4KHN0cnVjdCBk
ZXZpY2UgKmRldiwKPiAgICAgICAgIHUzMiB2ZGRnZng7Cj4gICAgICAgICBpbnQgciwgc2l6ZSA9
IHNpemVvZih2ZGRnZngpOwo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+
ICsgICAgICAgaWYgKGFkZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJu
IC1FUEVSTTsKPgo+ICAgICAgICAgciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoYWRldi0+ZGRldi0+
ZGV2KTsKPiBAQCAtMzAwOCwxMSArMjgxOSw5IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21v
bl9zaG93X3ZkZGdmeChzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVy
biByOwo+ICAgICAgICAgfQo+Cj4gLSAgICAgICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7
Cj4gICAgICAgICAvKiBnZXQgdGhlIHZvbHRhZ2UgKi8KPiAgICAgICAgIHIgPSBhbWRncHVfZHBt
X3JlYWRfc2Vuc29yKGFkZXYsIEFNREdQVV9QUF9TRU5TT1JfVkRER0ZYLAo+ICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgKHZvaWQgKikmdmRkZ2Z4LCAmc2l6ZSk7Cj4gLSAgICAg
ICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+Cj4gICAgICAgICBwbV9ydW50aW1lX21hcmtf
bGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gICAgICAgICBwbV9ydW50aW1lX3B1dF9hdXRv
c3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC0zMDM4LDcgKzI4NDcsNyBAQCBzdGF0aWMg
c3NpemVfdCBhbWRncHVfaHdtb25fc2hvd192ZGRuYihzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAg
ICAgICB1MzIgdmRkbmI7Cj4gICAgICAgICBpbnQgciwgc2l6ZSA9IHNpemVvZih2ZGRuYik7Cj4K
PiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+
aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAg
ICAvKiBvbmx5IEFQVXMgaGF2ZSB2ZGRuYiAqLwo+IEBAIC0zMDUxLDExICsyODYwLDkgQEAgc3Rh
dGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfdmRkbmIoc3RydWN0IGRldmljZSAqZGV2LAo+
ICAgICAgICAgICAgICAgICByZXR1cm4gcjsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9y
ZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAgICAgICAgLyogZ2V0IHRoZSB2b2x0YWdlICovCj4g
ICAgICAgICByID0gYW1kZ3B1X2RwbV9yZWFkX3NlbnNvcihhZGV2LCBBTURHUFVfUFBfU0VOU09S
X1ZERE5CLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHZvaWQgKikmdmRk
bmIsICZzaXplKTsKPiAtICAgICAgIHVwX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4KPiAgICAg
ICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRldi0+ZGRldi0+ZGV2KTsKPiAgICAgICAg
IHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYtPmRkZXYtPmRldik7Cj4gQEAgLTMwODIs
NyArMjg4OSw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3Bvd2VyX2F2Zyhz
dHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICBpbnQgciwgc2l6ZSA9IHNpemVvZih1MzIpOwo+
ICAgICAgICAgdW5zaWduZWQgdXc7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRl
dikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICBy
ZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICByID0gcG1fcnVudGltZV9nZXRfc3luYyhhZGV2LT5k
ZGV2LT5kZXYpOwo+IEBAIC0zMDkxLDExICsyODk4LDkgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1
X2h3bW9uX3Nob3dfcG93ZXJfYXZnKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAg
ICAgcmV0dXJuIHI7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIGRvd25fcmVhZCgmYWRldi0+cmVz
ZXRfc2VtKTsKPiAgICAgICAgIC8qIGdldCB0aGUgdm9sdGFnZSAqLwo+ICAgICAgICAgciA9IGFt
ZGdwdV9kcG1fcmVhZF9zZW5zb3IoYWRldiwgQU1ER1BVX1BQX1NFTlNPUl9HUFVfUE9XRVIsCj4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodm9pZCAqKSZxdWVyeSwgJnNpemUp
Owo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPgo+ICAgICAgICAgcG1fcnVu
dGltZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGlt
ZV9wdXRfYXV0b3N1c3BlbmQoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMzEyNSw3ICsyOTMwLDcg
QEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfcG93ZXJfY2FwX21heChzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCj4gICAgICAgICBzc2l6ZV90IHNpemU7Cj4gICAgICAgICBpbnQgcjsKPgo+
IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5p
bl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAg
IHIgPSBwbV9ydW50aW1lX2dldF9zeW5jKGFkZXYtPmRkZXYtPmRldik7Cj4gQEAgLTMxMzQsOCAr
MjkzOSw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3Bvd2VyX2NhcF9tYXgo
c3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICByZXR1cm4gcjsKPiAgICAgICAg
IH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAg
IGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkgewo+ICAgICAgICAgICAgICAgICBzbXVfZ2V0
X3Bvd2VyX2xpbWl0KCZhZGV2LT5zbXUsICZsaW1pdCwgdHJ1ZSk7Cj4gICAgICAgICAgICAgICAg
IHNpemUgPSBzbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiV1XG4iLCBsaW1pdCAqIDEwMDAwMDAp
Owo+IEBAIC0zMTQ2LDggKzI5NDksNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hv
d19wb3dlcl9jYXBfbWF4KHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgc2l6
ZSA9IHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiXG4iKTsKPiAgICAgICAgIH0KPgo+IC0gICAg
ICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBwbV9ydW50aW1lX21h
cmtfbGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gICAgICAgICBwbV9ydW50aW1lX3B1dF9h
dXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+Cj4gQEAgLTMxNjMsNyArMjk2NCw3IEBAIHN0
YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3Bvd2VyX2NhcChzdHJ1Y3QgZGV2aWNlICpk
ZXYsCj4gICAgICAgICBzc2l6ZV90IHNpemU7Cj4gICAgICAgICBpbnQgcjsKPgo+IC0gICAgICAg
aWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVz
ZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIHIgPSBwbV9y
dW50aW1lX2dldF9zeW5jKGFkZXYtPmRkZXYtPmRldik7Cj4gQEAgLTMxNzIsOCArMjk3Myw2IEBA
IHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3Bvd2VyX2NhcChzdHJ1Y3QgZGV2aWNl
ICpkZXYsCj4gICAgICAgICAgICAgICAgIHJldHVybiByOwo+ICAgICAgICAgfQo+Cj4gLSAgICAg
ICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gLQo+ICAgICAgICAgaWYgKGlzX3N1cHBv
cnRfc3dfc211KGFkZXYpKSB7Cj4gICAgICAgICAgICAgICAgIHNtdV9nZXRfcG93ZXJfbGltaXQo
JmFkZXYtPnNtdSwgJmxpbWl0LCBmYWxzZSk7Cj4gICAgICAgICAgICAgICAgIHNpemUgPSBzbnBy
aW50ZihidWYsIFBBR0VfU0laRSwgIiV1XG4iLCBsaW1pdCAqIDEwMDAwMDApOwo+IEBAIC0zMTg0
LDggKzI5ODMsNiBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfaHdtb25fc2hvd19wb3dlcl9jYXAo
c3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICBzaXplID0gc25wcmludGYoYnVm
LCBQQUdFX1NJWkUsICJcbiIpOwo+ICAgICAgICAgfQo+Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2
LT5yZXNldF9zZW0pOwo+IC0KPiAgICAgICAgIHBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koYWRl
di0+ZGRldi0+ZGV2KTsKPiAgICAgICAgIHBtX3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKGFkZXYt
PmRkZXYtPmRldik7Cj4KPiBAQCAtMzIwMiw3ICsyOTk5LDcgQEAgc3RhdGljIHNzaXplX3QgYW1k
Z3B1X2h3bW9uX3NldF9wb3dlcl9jYXAoc3RydWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgaW50
IGVycjsKPiAgICAgICAgIHUzMiB2YWx1ZTsKPgo+IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNl
dChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAg
ICAgIHJldHVybiAtRVBFUk07Cj4KPiAgICAgICAgIGlmIChhbWRncHVfc3Jpb3ZfdmYoYWRldikp
Cj4gQEAgLTMyMjEsOCArMzAxOCw2IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zZXRf
cG93ZXJfY2FwKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgcmV0dXJuIGVy
cjsKPiAgICAgICAgIH0KPgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+
IC0KPiAgICAgICAgIGlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKPiAgICAgICAgICAgICAg
ICAgZXJyID0gc211X3NldF9wb3dlcl9saW1pdCgmYWRldi0+c211LCB2YWx1ZSk7Cj4gICAgICAg
ICBlbHNlIGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MgJiYgYWRldi0+cG93ZXJwbGF5LnBw
X2Z1bmNzLT5zZXRfcG93ZXJfbGltaXQpCj4gQEAgLTMyMzAsOCArMzAyNSw2IEBAIHN0YXRpYyBz
c2l6ZV90IGFtZGdwdV9od21vbl9zZXRfcG93ZXJfY2FwKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAg
ICAgICAgIGVsc2UKPiAgICAgICAgICAgICAgICAgZXJyID0gLUVJTlZBTDsKPgo+IC0gICAgICAg
dXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAtCj4gICAgICAgICBwbV9ydW50aW1lX21hcmtf
bGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gICAgICAgICBwbV9ydW50aW1lX3B1dF9hdXRv
c3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+Cj4gQEAgLTMyNDksNyArMzA0Miw3IEBAIHN0YXRp
YyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3NjbGsoc3RydWN0IGRldmljZSAqZGV2LAo+ICAg
ICAgICAgdWludDMyX3Qgc2NsazsKPiAgICAgICAgIGludCByLCBzaXplID0gc2l6ZW9mKHNjbGsp
Owo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFk
ZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAg
ICAgICAgciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoYWRldi0+ZGRldi0+ZGV2KTsKPiBAQCAtMzI1
OCwxMSArMzA1MSw5IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9od21vbl9zaG93X3NjbGsoc3Ry
dWN0IGRldmljZSAqZGV2LAo+ICAgICAgICAgICAgICAgICByZXR1cm4gcjsKPiAgICAgICAgIH0K
Pgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAgICAgICAgLyogZ2V0
IHRoZSBzY2xrICovCj4gICAgICAgICByID0gYW1kZ3B1X2RwbV9yZWFkX3NlbnNvcihhZGV2LCBB
TURHUFVfUFBfU0VOU09SX0dGWF9TQ0xLLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKHZvaWQgKikmc2NsaywgJnNpemUpOwo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVz
ZXRfc2VtKTsKPgo+ICAgICAgICAgcG1fcnVudGltZV9tYXJrX2xhc3RfYnVzeShhZGV2LT5kZGV2
LT5kZXYpOwo+ICAgICAgICAgcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoYWRldi0+ZGRldi0+
ZGV2KTsKPiBAQCAtMzI4OCw3ICszMDc5LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9u
X3Nob3dfbWNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAgICAgICB1aW50MzJfdCBtY2xrOwo+
ICAgICAgICAgaW50IHIsIHNpemUgPSBzaXplb2YobWNsayk7Cj4KPiAtICAgICAgIGlmIChhbWRn
cHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAg
ICAgICAgICAgICAgICByZXR1cm4gLUVQRVJNOwo+Cj4gICAgICAgICByID0gcG1fcnVudGltZV9n
ZXRfc3luYyhhZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC0zMjk3LDExICszMDg4LDkgQEAgc3RhdGlj
IHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfbWNsayhzdHJ1Y3QgZGV2aWNlICpkZXYsCj4gICAg
ICAgICAgICAgICAgIHJldHVybiByOwo+ICAgICAgICAgfQo+Cj4gLSAgICAgICBkb3duX3JlYWQo
JmFkZXYtPnJlc2V0X3NlbSk7Cj4gICAgICAgICAvKiBnZXQgdGhlIHNjbGsgKi8KPiAgICAgICAg
IHIgPSBhbWRncHVfZHBtX3JlYWRfc2Vuc29yKGFkZXYsIEFNREdQVV9QUF9TRU5TT1JfR0ZYX01D
TEssCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodm9pZCAqKSZtY2xrLCAm
c2l6ZSk7Cj4gLSAgICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+Cj4gICAgICAgICBw
bV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGFkZXYtPmRkZXYtPmRldik7Cj4gICAgICAgICBwbV9y
dW50aW1lX3B1dF9hdXRvc3VzcGVuZChhZGV2LT5kZGV2LT5kZXYpOwo+IEBAIC00MTg4LDcgKzM5
NzcsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX3BtX2luZm8oc3RydWN0IHNlcV9maWxl
ICptLCB2b2lkICpkYXRhKQo+ICAgICAgICAgdTMyIGZsYWdzID0gMDsKPiAgICAgICAgIGludCBy
Owo+Cj4gLSAgICAgICBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFk
ZXYtPmluX2dwdV9yZXNldCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIC1FUEVSTTsKPgo+ICAg
ICAgICAgciA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZGV2LT5kZXYpOwo+IEBAIC00MjA0LDcgKzM5
OTMsNiBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX3BtX2luZm8oc3RydWN0IHNlcV9maWxl
ICptLCB2b2lkICpkYXRhKQo+ICAgICAgICAgICAgICAgICByZXR1cm4gMDsKPiAgICAgICAgIH0K
Pgo+IC0gICAgICAgZG93bl9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAgICAgICAgaWYgKCFp
c19zdXBwb3J0X3N3X3NtdShhZGV2KSAmJgo+ICAgICAgICAgICAgIGFkZXYtPnBvd2VycGxheS5w
cF9mdW5jcy0+ZGVidWdmc19wcmludF9jdXJyZW50X3BlcmZvcm1hbmNlX2xldmVsKSB7Cj4gICAg
ICAgICAgICAgICAgIG11dGV4X2xvY2soJmFkZXYtPnBtLm11dGV4KTsKPiBAQCAtNDIxNywxMyAr
NDAwNSwxMCBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX3BtX2luZm8oc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICpkYXRhKQo+ICAgICAgICAgfSBlbHNlIHsKPiAgICAgICAgICAgICAgICAg
ciA9IGFtZGdwdV9kZWJ1Z2ZzX3BtX2luZm9fcHAobSwgYWRldik7Cj4gICAgICAgICB9Cj4gLSAg
ICAgICB1cF9yZWFkKCZhZGV2LT5yZXNldF9zZW0pOwo+ICAgICAgICAgaWYgKHIpCj4gICAgICAg
ICAgICAgICAgIGdvdG8gb3V0Owo+Cj4gLSAgICAgICBkb3duX3JlYWQoJmFkZXYtPnJlc2V0X3Nl
bSk7Cj4gICAgICAgICBhbWRncHVfZGV2aWNlX2lwX2dldF9jbG9ja2dhdGluZ19zdGF0ZShhZGV2
LCAmZmxhZ3MpOwo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPgo+ICAgICAg
ICAgc2VxX3ByaW50ZihtLCAiQ2xvY2sgR2F0aW5nIEZsYWdzIE1hc2s6IDB4JXhcbiIsIGZsYWdz
KTsKPiAgICAgICAgIGFtZGdwdV9wYXJzZV9jZ19zdGF0ZShtLCBmbGFncyk7Cj4gZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYwo+IGluZGV4IDExNmE4OTk5MGYzOS4uYWExZTc3
YzYwYzBhIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9w
c3AuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYwo+IEBA
IC0xODY5LDcgKzE4NjksNyBAQCBzdGF0aWMgaW50IHBzcF9sb2FkX3NtdV9mdyhzdHJ1Y3QgcHNw
X2NvbnRleHQgKnBzcCkKPiAgICAgICAgICAgICAgICAgcmV0dXJuIDA7Cj4KPgo+IC0gICAgICAg
aWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSAmJiByYXMgJiYgcmFzLT5zdXBwb3J0ZWQpIHsKPiAr
ICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQgJiYgcmFzICYmIHJhcy0+c3VwcG9ydGVkKSB7
Cj4gICAgICAgICAgICAgICAgIHJldCA9IGFtZGdwdV9kcG1fc2V0X21wMV9zdGF0ZShhZGV2LCBQ
UF9NUDFfU1RBVEVfVU5MT0FEKTsKPiAgICAgICAgICAgICAgICAgaWYgKHJldCkgewo+ICAgICAg
ICAgICAgICAgICAgICAgICAgIERSTV9XQVJOKCJGYWlsZWQgdG8gc2V0IE1QMSBzdGF0ZSBwcmVw
YXJlIGZvciByZWxvYWRcbiIpOwo+IEBAIC0xOTg0LDcgKzE5ODQsNyBAQCBzdGF0aWMgaW50IHBz
cF9sb2FkX2Z3KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQo+ICAgICAgICAgaW50IHJldDsK
PiAgICAgICAgIHN0cnVjdCBwc3BfY29udGV4dCAqcHNwID0gJmFkZXYtPnBzcDsKPgo+IC0gICAg
ICAgaWYgKGFtZGdwdV9zcmlvdl92ZihhZGV2KSAmJiBhbWRncHVfaW5fcmVzZXQoYWRldikpIHsK
PiArICAgICAgIGlmIChhbWRncHVfc3Jpb3ZfdmYoYWRldikgJiYgYWRldi0+aW5fZ3B1X3Jlc2V0
KSB7Cj4gICAgICAgICAgICAgICAgIHBzcF9yaW5nX3N0b3AocHNwLCBQU1BfUklOR19UWVBFX19L
TSk7IC8qIHNob3VsZCBub3QgZGVzdHJveSByaW5nLCBvbmx5IHN0b3AgKi8KPiAgICAgICAgICAg
ICAgICAgZ290byBza2lwX21lbWFsbG9jOwo+ICAgICAgICAgfQo+IGRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfcmFzLmMKPiBpbmRleCBjZDE0MDNmODNkY2YuLmYwOTA4MjU3ODg2NSAx
MDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmMKPiAr
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmMKPiBAQCAtMjA3OSw3
ICsyMDc5LDcgQEAgaW50IGFtZGdwdV9yYXNfbGF0ZV9pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgIGFtZGdwdV9yYXNfcmVxdWVzdF9yZXNl
dF9vbl9ib290KGFkZXYsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHJhc19ibG9jay0+YmxvY2spOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwo+
IC0gICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFkZXYtPmluX3N1c3BlbmQgfHwgYW1kZ3B1X2lu
X3Jlc2V0KGFkZXYpKSB7Cj4gKyAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWRldi0+aW5fc3Vz
cGVuZCB8fCBhZGV2LT5pbl9ncHVfcmVzZXQpIHsKPiAgICAgICAgICAgICAgICAgICAgICAgICAv
KiBpbiByZXN1bWUgcGhhc2UsIGlmIGZhaWwgdG8gZW5hYmxlIHJhcywKPiAgICAgICAgICAgICAg
ICAgICAgICAgICAgKiBjbGVhbiB1cCBhbGwgcmFzIGZzIG5vZGVzLCBhbmQgZGlzYWJsZSByYXMg
Ki8KPiAgICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGNsZWFudXA7Cj4gQEAgLTIwODgsNyAr
MjA4OCw3IEBAIGludCBhbWRncHVfcmFzX2xhdGVfaW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiwKPiAgICAgICAgIH0KPgo+ICAgICAgICAgLyogaW4gcmVzdW1lIHBoYXNlLCBubyBuZWVk
IHRvIGNyZWF0ZSByYXMgZnMgbm9kZSAqLwo+IC0gICAgICAgaWYgKGFkZXYtPmluX3N1c3BlbmQg
fHwgYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKQo+ICsgICAgICAgaWYgKGFkZXYtPmluX3N1c3BlbmQg
fHwgYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gMDsKPgo+ICAg
ICAgICAgaWYgKGloX2luZm8tPmNiKSB7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV90dG0uYwo+IGluZGV4IDIwZmEwNDk3YWFhNC4uMWUxOWQxMzA0NzNmIDEwMDY0NAo+IC0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwo+ICsrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwo+IEBAIC0yMTAzLDcgKzIxMDMsNyBAQCB2
b2lkIGFtZGdwdV90dG1fc2V0X2J1ZmZlcl9mdW5jc19zdGF0dXMoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsIGJvb2wgZW5hYmxlKQo+ICAgICAgICAgdWludDY0X3Qgc2l6ZTsKPiAgICAgICAg
IGludCByOwo+Cj4gLSAgICAgICBpZiAoIWFkZXYtPm1tYW4uaW5pdGlhbGl6ZWQgfHwgYW1kZ3B1
X2luX3Jlc2V0KGFkZXYpIHx8Cj4gKyAgICAgICBpZiAoIWFkZXYtPm1tYW4uaW5pdGlhbGl6ZWQg
fHwgYWRldi0+aW5fZ3B1X3Jlc2V0IHx8Cj4gICAgICAgICAgICAgYWRldi0+bW1hbi5idWZmZXJf
ZnVuY3NfZW5hYmxlZCA9PSBlbmFibGUpCj4gICAgICAgICAgICAgICAgIHJldHVybjsKPgo+IGRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdWNvZGUuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91Y29kZS5jCj4gaW5kZXggMDM5MjQ1Yzk4
ZmY4Li4xODM3NDNjNWZiN2IgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X3Vjb2RlLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdWNvZGUuYwo+IEBAIC02MjgsOCArNjI4LDcgQEAgaW50IGFtZGdwdV91Y29kZV9pbml0X2Jv
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQo+ICAgICAgICAgc3RydWN0IGFtZGdwdV9maXJt
d2FyZV9pbmZvICp1Y29kZSA9IE5VTEw7Cj4KPiAgIC8qIGZvciBiYXJlbWV0YWwsIHRoZSB1Y29k
ZSBpcyBhbGxvY2F0ZWQgaW4gZ3R0LCBzbyBkb24ndCBuZWVkIHRvIGZpbGwgdGhlIGJvIHdoZW4g
cmVzZXQvc3VzcGVuZCAqLwo+IC0gICAgICAgaWYgKCFhbWRncHVfc3Jpb3ZfdmYoYWRldikgJiYK
PiAtICAgICAgICAgICAgICAgKGFtZGdwdV9pbl9yZXNldChhZGV2KSB8fCBhZGV2LT5pbl9zdXNw
ZW5kKSkKPiArICAgICAgIGlmICghYW1kZ3B1X3NyaW92X3ZmKGFkZXYpICYmIChhZGV2LT5pbl9n
cHVfcmVzZXQgfHwgYWRldi0+aW5fc3VzcGVuZCkpCj4gICAgICAgICAgICAgICAgIHJldHVybiAw
Owo+ICAgICAgICAgLyoKPiAgICAgICAgICAqIGlmIFNNVSBsb2FkZWQgZmlybXdhcmUsIGl0IG5l
ZWRuJ3QgYWRkIFNNQywgVVZELCBhbmQgVkNFCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV92aXJ0LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdmlydC5jCj4gaW5kZXggMWUyMTE1NDRmMmRjLi5hZTcyMGE2ZGM1YTAgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQuYwo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92aXJ0LmMKPiBAQCAtOTMsNyArOTMsNyBA
QCB2b2lkIGFtZGdwdV92aXJ0X2tpcV9yZWdfd3JpdGVfcmVnX3dhaXQoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsCj4gICAgICAgICBhbWRncHVfcmluZ191bmRvKHJpbmcpOwo+ICAgICAgICAg
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgma2lxLT5yaW5nX2xvY2ssIGZsYWdzKTsKPiAgZmFpbGVk
X2tpcToKPiAtICAgICAgIGRldl93YXJuKGFkZXYtPmRldiwgImZhaWxlZCB0byB3cml0ZSByZWcg
JXggd2FpdCByZWcgJXhcbiIsIHJlZzAsIHJlZzEpOwo+ICsgICAgICAgcHJfZXJyKCJmYWlsZWQg
dG8gd3JpdGUgcmVnICV4IHdhaXQgcmVnICV4XG4iLCByZWcwLCByZWcxKTsKPiAgfQo+Cj4gIC8q
Kgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmlydC5o
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZpcnQuaAo+IGluZGV4IGIyMDQ2
YzNhNDA0ZC4uZjgyNjk0NTk4OWM3IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV92aXJ0LmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdmlydC5oCj4gQEAgLTMyNSw5ICszMjUsOSBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaXNf
dmlydHVhbF9tYWNoaW5lKHZvaWQpCj4gICNkZWZpbmUgYW1kZ3B1X3NyaW92X2lzX3BwX29uZV92
ZihhZGV2KSBcCj4gICAgICAgICAoKGFkZXYpLT52aXJ0LmdpbV9mZWF0dXJlICYgQU1ER0lNX0ZF
QVRVUkVfUFBfT05FX1ZGKQo+ICAjZGVmaW5lIGFtZGdwdV9zcmlvdl9pc19kZWJ1ZyhhZGV2KSBc
Cj4gLSAgICAgICAoKCFhbWRncHVfaW5fcmVzZXQoYWRldikpICYmIGFkZXYtPnZpcnQudGRyX2Rl
YnVnKQo+ICsgICAgICAgKCghYWRldi0+aW5fZ3B1X3Jlc2V0KSAmJiBhZGV2LT52aXJ0LnRkcl9k
ZWJ1ZykKPiAgI2RlZmluZSBhbWRncHVfc3Jpb3ZfaXNfbm9ybWFsKGFkZXYpIFwKPiAtICAgICAg
ICgoIWFtZGdwdV9pbl9yZXNldChhZGV2KSkgJiYgKCFhZGV2LT52aXJ0LnRkcl9kZWJ1ZykpCj4g
KyAgICAgICAoKCFhZGV2LT5pbl9ncHVfcmVzZXQpICYmICghYWRldi0+dmlydC50ZHJfZGVidWcp
KQo+Cj4gIGJvb2wgYW1kZ3B1X3ZpcnRfbW1pb19ibG9ja2VkKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2KTsKPiAgdm9pZCBhbWRncHVfdmlydF9pbml0X3NldHRpbmcoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfeGdtaS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3hnbWkuYwo+
IGluZGV4IDY3YTc1NmY0MzM3Yi4uY2Q2ZTZlYjdkOTY2IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV94Z21pLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfeGdtaS5jCj4gQEAgLTM3Miw3ICszNzIsNyBAQCBzdHJ1Y3QgYW1k
Z3B1X2hpdmVfaW5mbyAqYW1kZ3B1X2dldF94Z21pX2hpdmUoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYsIGludCBsbwo+ICAgICAgICAgdG1wLT5oaXZlX2lkID0gYWRldi0+Z21jLnhnbWkuaGl2
ZV9pZDsKPiAgICAgICAgIElOSVRfTElTVF9IRUFEKCZ0bXAtPmRldmljZV9saXN0KTsKPiAgICAg
ICAgIG11dGV4X2luaXQoJnRtcC0+aGl2ZV9sb2NrKTsKPiAtICAgICAgIGF0b21pY19zZXQoJnRt
cC0+aW5fcmVzZXQsIDApOwo+ICsgICAgICAgbXV0ZXhfaW5pdCgmdG1wLT5yZXNldF9sb2NrKTsK
PiAgICAgICAgIHRhc2tfYmFycmllcl9pbml0KCZ0bXAtPnRiKTsKPgo+ICAgICAgICAgaWYgKGxv
Y2spCj4gQEAgLTM5Nyw3ICszOTcsNiBAQCBpbnQgYW1kZ3B1X3hnbWlfc2V0X3BzdGF0ZShzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgaW50IHBzdGF0ZSkKPiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXZlLT5oaV9yZXFfZ3B1IDogYWRldjsKPiAg
ICAgICAgIGJvb2wgaXNfaGlfcmVxID0gcHN0YXRlID09IEFNREdQVV9YR01JX1BTVEFURV9NQVhf
VkVHQTIwOwo+ICAgICAgICAgYm9vbCBpbml0X2xvdyA9IGhpdmUtPnBzdGF0ZSA9PSBBTURHUFVf
WEdNSV9QU1RBVEVfVU5LTk9XTjsKPiAtICAgICAgIGJvb2wgbG9ja2VkOwo+Cj4gICAgICAgICAv
KiBmdyBidWcgc28gdGVtcG9yYXJpbHkgZGlzYWJsZSBwc3RhdGUgc3dpdGNoaW5nICovCj4gICAg
ICAgICByZXR1cm4gMDsKPiBAQCAtNDA1LDkgKzQwNCw3IEBAIGludCBhbWRncHVfeGdtaV9zZXRf
cHN0YXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBpbnQgcHN0YXRlKQo+ICAgICAgICAg
aWYgKCFoaXZlIHx8IGFkZXYtPmFzaWNfdHlwZSAhPSBDSElQX1ZFR0EyMCkKPiAgICAgICAgICAg
ICAgICAgcmV0dXJuIDA7Cj4KPiAtICAgICAgIGxvY2tlZCA9IGF0b21pY19yZWFkKCZoaXZlLT5p
bl9yZXNldCkgPyBmYWxzZSA6IHRydWU7Cj4gLSAgICAgICBpZiAobG9ja2VkKQo+IC0gICAgICAg
ICAgICAgICBtdXRleF9sb2NrKCZoaXZlLT5oaXZlX2xvY2spOwo+ICsgICAgICAgbXV0ZXhfbG9j
aygmaGl2ZS0+aGl2ZV9sb2NrKTsKPgo+ICAgICAgICAgaWYgKGlzX2hpX3JlcSkKPiAgICAgICAg
ICAgICAgICAgaGl2ZS0+aGlfcmVxX2NvdW50Kys7Cj4gQEAgLTQ0Miw4ICs0MzksNyBAQCBpbnQg
YW1kZ3B1X3hnbWlfc2V0X3BzdGF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgaW50IHBz
dGF0ZSkKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGFkZXYgOiBOVUxMOwo+ICAgICAgICAgfQo+ICBvdXQ6Cj4gLSAgICAgICBpZiAobG9j
a2VkKQo+IC0gICAgICAgICAgICAgICBtdXRleF91bmxvY2soJmhpdmUtPmhpdmVfbG9jayk7Cj4g
KyAgICAgICBtdXRleF91bmxvY2soJmhpdmUtPmhpdmVfbG9jayk7Cj4gICAgICAgICByZXR1cm4g
cmV0Owo+ICB9Cj4KPiBAQCAtNTk4LDYgKzU5NCw3IEBAIGludCBhbWRncHVfeGdtaV9yZW1vdmVf
ZGV2aWNlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQo+ICAgICAgICAgaWYoISgtLWhpdmUt
Pm51bWJlcl9kZXZpY2VzKSl7Cj4gICAgICAgICAgICAgICAgIGFtZGdwdV94Z21pX3N5c2ZzX2Rl
c3Ryb3koYWRldiwgaGl2ZSk7Cj4gICAgICAgICAgICAgICAgIG11dGV4X2Rlc3Ryb3koJmhpdmUt
PmhpdmVfbG9jayk7Cj4gKyAgICAgICAgICAgICAgIG11dGV4X2Rlc3Ryb3koJmhpdmUtPnJlc2V0
X2xvY2spOwo+ICAgICAgICAgfQo+Cj4gICAgICAgICByZXR1cm4gcHNwX3hnbWlfdGVybWluYXRl
KCZhZGV2LT5wc3ApOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfeGdtaS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3hnbWkuaAo+
IGluZGV4IDYxNzIwY2Q0YTFlZS4uNjk5OWVhYjE2YTcyIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV94Z21pLmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfeGdtaS5oCj4gQEAgLTMwLDggKzMwLDcgQEAgc3RydWN0IGFtZGdw
dV9oaXZlX2luZm8gewo+ICAgICAgICAgdWludDY0X3QgICAgICAgICAgICAgICAgaGl2ZV9pZDsK
PiAgICAgICAgIHN0cnVjdCBsaXN0X2hlYWQgICAgICAgIGRldmljZV9saXN0Owo+ICAgICAgICAg
aW50IG51bWJlcl9kZXZpY2VzOwo+IC0gICAgICAgc3RydWN0IG11dGV4IGhpdmVfbG9jazsKPiAt
ICAgICAgIGF0b21pY190IGluX3Jlc2V0Owo+ICsgICAgICAgc3RydWN0IG11dGV4IGhpdmVfbG9j
aywgcmVzZXRfbG9jazsKPiAgICAgICAgIHN0cnVjdCBrb2JqZWN0ICprb2JqOwo+ICAgICAgICAg
c3RydWN0IGRldmljZV9hdHRyaWJ1dGUgZGV2X2F0dHI7Cj4gICAgICAgICBzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldjsKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YXRvbS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYXRvbS5jCj4gaW5kZXggODM0MWJk
OTY1MjAyLi40Y2ZjNzg2Njk5YzcgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYXRvbS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYXRvbS5jCj4g
QEAgLTc1NSw3ICs3NTUsNiBAQCBzdGF0aWMgdm9pZCBhdG9tX29wX2p1bXAoYXRvbV9leGVjX2Nv
bnRleHQgKmN0eCwgaW50ICpwdHIsIGludCBhcmcpCj4gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAvKiBqaWZmaWVzIHdyYXAgYXJvdW5kIHdlIHdpbGwganVzdCB3YWl0IGEgbGl0dGxl
IGxvbmdlciAqLwo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LT5sYXN0X2p1
bXBfamlmZmllcyA9IGppZmZpZXM7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgfQo+IC0gICAg
ICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlKCk7Cj4gICAgICAgICAgICAgICAgIH0gZWxzZSB7
Cj4gICAgICAgICAgICAgICAgICAgICAgICAgY3R4LT5sYXN0X2p1bXAgPSBjdHgtPnN0YXJ0ICsg
dGFyZ2V0Owo+ICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC0+bGFzdF9qdW1wX2ppZmZpZXMg
PSBqaWZmaWVzOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhf
djEwXzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92MTBfMC5jCj4gaW5kZXgg
ZGU2ZTZkZTQxODY3Li5lODdkNDM1MzcwMTMgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvZ2Z4X3YxMF8wLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9nZnhfdjEwXzAuYwo+IEBAIC02MjAxLDcgKzYyMDEsNyBAQCBzdGF0aWMgaW50IGdmeF92MTBf
MF9nZnhfaW5pdF9xdWV1ZShzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCj4gICAgICAgICBzdHJ1
Y3QgdjEwX2dmeF9tcWQgKm1xZCA9IHJpbmctPm1xZF9wdHI7Cj4gICAgICAgICBpbnQgbXFkX2lk
eCA9IHJpbmcgLSAmYWRldi0+Z2Z4LmdmeF9yaW5nWzBdOwo+Cj4gLSAgICAgICBpZiAoIWFtZGdw
dV9pbl9yZXNldChhZGV2KSAmJiAhYWRldi0+aW5fc3VzcGVuZCkgewo+ICsgICAgICAgaWYgKCFh
ZGV2LT5pbl9ncHVfcmVzZXQgJiYgIWFkZXYtPmluX3N1c3BlbmQpIHsKPiAgICAgICAgICAgICAg
ICAgbWVtc2V0KCh2b2lkICopbXFkLCAwLCBzaXplb2YoKm1xZCkpOwo+ICAgICAgICAgICAgICAg
ICBtdXRleF9sb2NrKCZhZGV2LT5zcmJtX211dGV4KTsKPiAgICAgICAgICAgICAgICAgbnZfZ3Ji
bV9zZWxlY3QoYWRldiwgcmluZy0+bWUsIHJpbmctPnBpcGUsIHJpbmctPnF1ZXVlLCAwKTsKPiBA
QCAtNjIxMyw3ICs2MjEzLDcgQEAgc3RhdGljIGludCBnZnhfdjEwXzBfZ2Z4X2luaXRfcXVldWUo
c3RydWN0IGFtZGdwdV9yaW5nICpyaW5nKQo+ICAgICAgICAgICAgICAgICBtdXRleF91bmxvY2so
JmFkZXYtPnNyYm1fbXV0ZXgpOwo+ICAgICAgICAgICAgICAgICBpZiAoYWRldi0+Z2Z4Lm1lLm1x
ZF9iYWNrdXBbbXFkX2lkeF0pCj4gICAgICAgICAgICAgICAgICAgICAgICAgbWVtY3B5KGFkZXYt
PmdmeC5tZS5tcWRfYmFja3VwW21xZF9pZHhdLCBtcWQsIHNpemVvZigqbXFkKSk7Cj4gLSAgICAg
ICB9IGVsc2UgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkgewo+ICsgICAgICAgfSBlbHNlIGlm
IChhZGV2LT5pbl9ncHVfcmVzZXQpIHsKPiAgICAgICAgICAgICAgICAgLyogcmVzZXQgbXFkIHdp
dGggdGhlIGJhY2t1cCBjb3B5ICovCj4gICAgICAgICAgICAgICAgIGlmIChhZGV2LT5nZngubWUu
bXFkX2JhY2t1cFttcWRfaWR4XSkKPiAgICAgICAgICAgICAgICAgICAgICAgICBtZW1jcHkobXFk
LCBhZGV2LT5nZngubWUubXFkX2JhY2t1cFttcWRfaWR4XSwgc2l6ZW9mKCptcWQpKTsKPiBAQCAt
NjU2Niw3ICs2NTY2LDcgQEAgc3RhdGljIGludCBnZnhfdjEwXzBfa2lxX2luaXRfcXVldWUoc3Ry
dWN0IGFtZGdwdV9yaW5nICpyaW5nKQo+Cj4gICAgICAgICBnZnhfdjEwXzBfa2lxX3NldHRpbmco
cmluZyk7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpIHsgLyogZm9yIEdQ
VV9SRVNFVCBjYXNlICovCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KSB7IC8qIGZv
ciBHUFVfUkVTRVQgY2FzZSAqLwo+ICAgICAgICAgICAgICAgICAvKiByZXNldCBNUUQgdG8gYSBj
bGVhbiBzdGF0dXMgKi8KPiAgICAgICAgICAgICAgICAgaWYgKGFkZXYtPmdmeC5tZWMubXFkX2Jh
Y2t1cFttcWRfaWR4XSkKPiAgICAgICAgICAgICAgICAgICAgICAgICBtZW1jcHkobXFkLCBhZGV2
LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0sIHNpemVvZigqbXFkKSk7Cj4gQEAgLTY2MDIs
NyArNjYwMiw3IEBAIHN0YXRpYyBpbnQgZ2Z4X3YxMF8wX2tjcV9pbml0X3F1ZXVlKHN0cnVjdCBh
bWRncHVfcmluZyAqcmluZykKPiAgICAgICAgIHN0cnVjdCB2MTBfY29tcHV0ZV9tcWQgKm1xZCA9
IHJpbmctPm1xZF9wdHI7Cj4gICAgICAgICBpbnQgbXFkX2lkeCA9IHJpbmcgLSAmYWRldi0+Z2Z4
LmNvbXB1dGVfcmluZ1swXTsKPgo+IC0gICAgICAgaWYgKCFhbWRncHVfaW5fcmVzZXQoYWRldikg
JiYgIWFkZXYtPmluX3N1c3BlbmQpIHsKPiArICAgICAgIGlmICghYWRldi0+aW5fZ3B1X3Jlc2V0
ICYmICFhZGV2LT5pbl9zdXNwZW5kKSB7Cj4gICAgICAgICAgICAgICAgIG1lbXNldCgodm9pZCAq
KW1xZCwgMCwgc2l6ZW9mKCptcWQpKTsKPiAgICAgICAgICAgICAgICAgbXV0ZXhfbG9jaygmYWRl
di0+c3JibV9tdXRleCk7Cj4gICAgICAgICAgICAgICAgIG52X2dyYm1fc2VsZWN0KGFkZXYsIHJp
bmctPm1lLCByaW5nLT5waXBlLCByaW5nLT5xdWV1ZSwgMCk7Cj4gQEAgLTY2MTIsNyArNjYxMiw3
IEBAIHN0YXRpYyBpbnQgZ2Z4X3YxMF8wX2tjcV9pbml0X3F1ZXVlKHN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZykKPgo+ICAgICAgICAgICAgICAgICBpZiAoYWRldi0+Z2Z4Lm1lYy5tcWRfYmFja3Vw
W21xZF9pZHhdKQo+ICAgICAgICAgICAgICAgICAgICAgICAgIG1lbWNweShhZGV2LT5nZngubWVj
Lm1xZF9iYWNrdXBbbXFkX2lkeF0sIG1xZCwgc2l6ZW9mKCptcWQpKTsKPiAtICAgICAgIH0gZWxz
ZSBpZiAoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpKSB7IC8qIGZvciBHUFVfUkVTRVQgY2FzZSAqLwo+
ICsgICAgICAgfSBlbHNlIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpIHsgLyogZm9yIEdQVV9SRVNF
VCBjYXNlICovCj4gICAgICAgICAgICAgICAgIC8qIHJlc2V0IE1RRCB0byBhIGNsZWFuIHN0YXR1
cyAqLwo+ICAgICAgICAgICAgICAgICBpZiAoYWRldi0+Z2Z4Lm1lYy5tcWRfYmFja3VwW21xZF9p
ZHhdKQo+ICAgICAgICAgICAgICAgICAgICAgICAgIG1lbWNweShtcWQsIGFkZXYtPmdmeC5tZWMu
bXFkX2JhY2t1cFttcWRfaWR4XSwgc2l6ZW9mKCptcWQpKTsKPiBkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y4XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2dmeF92OF8wLmMKPiBpbmRleCA3ZGY1NjdhNjY1NmQuLjE0ZmQwNGI2OTlkYSAxMDA2NDQK
PiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjhfMC5jCj4gKysrIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y4XzAuYwo+IEBAIC00NjMzLDcgKzQ2MzMsNyBA
QCBzdGF0aWMgaW50IGdmeF92OF8wX2tpcV9pbml0X3F1ZXVlKHN0cnVjdCBhbWRncHVfcmluZyAq
cmluZykKPgo+ICAgICAgICAgZ2Z4X3Y4XzBfa2lxX3NldHRpbmcocmluZyk7Cj4KPiAtICAgICAg
IGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpIHsgLyogZm9yIEdQVV9SRVNFVCBjYXNlICovCj4g
KyAgICAgICBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KSB7IC8qIGZvciBHUFVfUkVTRVQgY2FzZSAq
Lwo+ICAgICAgICAgICAgICAgICAvKiByZXNldCBNUUQgdG8gYSBjbGVhbiBzdGF0dXMgKi8KPiAg
ICAgICAgICAgICAgICAgaWYgKGFkZXYtPmdmeC5tZWMubXFkX2JhY2t1cFttcWRfaWR4XSkKPiAg
ICAgICAgICAgICAgICAgICAgICAgICBtZW1jcHkobXFkLCBhZGV2LT5nZngubWVjLm1xZF9iYWNr
dXBbbXFkX2lkeF0sIHNpemVvZihzdHJ1Y3QgdmlfbXFkX2FsbG9jYXRpb24pKTsKPiBAQCAtNDY3
MCw3ICs0NjcwLDcgQEAgc3RhdGljIGludCBnZnhfdjhfMF9rY3FfaW5pdF9xdWV1ZShzdHJ1Y3Qg
YW1kZ3B1X3JpbmcgKnJpbmcpCj4gICAgICAgICBzdHJ1Y3QgdmlfbXFkICptcWQgPSByaW5nLT5t
cWRfcHRyOwo+ICAgICAgICAgaW50IG1xZF9pZHggPSByaW5nIC0gJmFkZXYtPmdmeC5jb21wdXRl
X3JpbmdbMF07Cj4KPiAtICAgICAgIGlmICghYW1kZ3B1X2luX3Jlc2V0KGFkZXYpICYmICFhZGV2
LT5pbl9zdXNwZW5kKSB7Cj4gKyAgICAgICBpZiAoIWFkZXYtPmluX2dwdV9yZXNldCAmJiAhYWRl
di0+aW5fc3VzcGVuZCkgewo+ICAgICAgICAgICAgICAgICBtZW1zZXQoKHZvaWQgKiltcWQsIDAs
IHNpemVvZihzdHJ1Y3QgdmlfbXFkX2FsbG9jYXRpb24pKTsKPiAgICAgICAgICAgICAgICAgKChz
dHJ1Y3QgdmlfbXFkX2FsbG9jYXRpb24gKiltcWQpLT5keW5hbWljX2N1X21hc2sgPSAweEZGRkZG
RkZGOwo+ICAgICAgICAgICAgICAgICAoKHN0cnVjdCB2aV9tcWRfYWxsb2NhdGlvbiAqKW1xZCkt
PmR5bmFtaWNfcmJfbWFzayA9IDB4RkZGRkZGRkY7Cj4gQEAgLTQ2ODIsNyArNDY4Miw3IEBAIHN0
YXRpYyBpbnQgZ2Z4X3Y4XzBfa2NxX2luaXRfcXVldWUoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5n
KQo+Cj4gICAgICAgICAgICAgICAgIGlmIChhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lk
eF0pCj4gICAgICAgICAgICAgICAgICAgICAgICAgbWVtY3B5KGFkZXYtPmdmeC5tZWMubXFkX2Jh
Y2t1cFttcWRfaWR4XSwgbXFkLCBzaXplb2Yoc3RydWN0IHZpX21xZF9hbGxvY2F0aW9uKSk7Cj4g
LSAgICAgICB9IGVsc2UgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkgeyAvKiBmb3IgR1BVX1JF
U0VUIGNhc2UgKi8KPiArICAgICAgIH0gZWxzZSBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KSB7IC8q
IGZvciBHUFVfUkVTRVQgY2FzZSAqLwo+ICAgICAgICAgICAgICAgICAvKiByZXNldCBNUUQgdG8g
YSBjbGVhbiBzdGF0dXMgKi8KPiAgICAgICAgICAgICAgICAgaWYgKGFkZXYtPmdmeC5tZWMubXFk
X2JhY2t1cFttcWRfaWR4XSkKPiAgICAgICAgICAgICAgICAgICAgICAgICBtZW1jcHkobXFkLCBh
ZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0sIHNpemVvZihzdHJ1Y3QgdmlfbXFkX2Fs
bG9jYXRpb24pKTsKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4
X3Y5XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKPiBpbmRleCA5
M2M2M2ZmM2IzNWUuLjJjNWJiMjgyY2MwMSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9nZnhfdjlfMC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
Z2Z4X3Y5XzAuYwo+IEBAIC0zNjg2LDcgKzM2ODYsNyBAQCBzdGF0aWMgaW50IGdmeF92OV8wX2tp
cV9pbml0X3F1ZXVlKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykKPgo+ICAgICAgICAgZ2Z4X3Y5
XzBfa2lxX3NldHRpbmcocmluZyk7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRl
dikpIHsgLyogZm9yIEdQVV9SRVNFVCBjYXNlICovCj4gKyAgICAgICBpZiAoYWRldi0+aW5fZ3B1
X3Jlc2V0KSB7IC8qIGZvciBHUFVfUkVTRVQgY2FzZSAqLwo+ICAgICAgICAgICAgICAgICAvKiBy
ZXNldCBNUUQgdG8gYSBjbGVhbiBzdGF0dXMgKi8KPiAgICAgICAgICAgICAgICAgaWYgKGFkZXYt
PmdmeC5tZWMubXFkX2JhY2t1cFttcWRfaWR4XSkKPiAgICAgICAgICAgICAgICAgICAgICAgICBt
ZW1jcHkobXFkLCBhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0sIHNpemVvZihzdHJ1
Y3QgdjlfbXFkX2FsbG9jYXRpb24pKTsKPiBAQCAtMzcyNCw3ICszNzI0LDcgQEAgc3RhdGljIGlu
dCBnZnhfdjlfMF9rY3FfaW5pdF9xdWV1ZShzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCj4gICAg
ICAgICBzdHJ1Y3QgdjlfbXFkICptcWQgPSByaW5nLT5tcWRfcHRyOwo+ICAgICAgICAgaW50IG1x
ZF9pZHggPSByaW5nIC0gJmFkZXYtPmdmeC5jb21wdXRlX3JpbmdbMF07Cj4KPiAtICAgICAgIGlm
ICghYW1kZ3B1X2luX3Jlc2V0KGFkZXYpICYmICFhZGV2LT5pbl9zdXNwZW5kKSB7Cj4gKyAgICAg
ICBpZiAoIWFkZXYtPmluX2dwdV9yZXNldCAmJiAhYWRldi0+aW5fc3VzcGVuZCkgewo+ICAgICAg
ICAgICAgICAgICBtZW1zZXQoKHZvaWQgKiltcWQsIDAsIHNpemVvZihzdHJ1Y3QgdjlfbXFkX2Fs
bG9jYXRpb24pKTsKPiAgICAgICAgICAgICAgICAgKChzdHJ1Y3QgdjlfbXFkX2FsbG9jYXRpb24g
KiltcWQpLT5keW5hbWljX2N1X21hc2sgPSAweEZGRkZGRkZGOwo+ICAgICAgICAgICAgICAgICAo
KHN0cnVjdCB2OV9tcWRfYWxsb2NhdGlvbiAqKW1xZCktPmR5bmFtaWNfcmJfbWFzayA9IDB4RkZG
RkZGRkY7Cj4gQEAgLTM3MzYsNyArMzczNiw3IEBAIHN0YXRpYyBpbnQgZ2Z4X3Y5XzBfa2NxX2lu
aXRfcXVldWUoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nKQo+Cj4gICAgICAgICAgICAgICAgIGlm
IChhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBbbXFkX2lkeF0pCj4gICAgICAgICAgICAgICAgICAg
ICAgICAgbWVtY3B5KGFkZXYtPmdmeC5tZWMubXFkX2JhY2t1cFttcWRfaWR4XSwgbXFkLCBzaXpl
b2Yoc3RydWN0IHY5X21xZF9hbGxvY2F0aW9uKSk7Cj4gLSAgICAgICB9IGVsc2UgaWYgKGFtZGdw
dV9pbl9yZXNldChhZGV2KSkgeyAvKiBmb3IgR1BVX1JFU0VUIGNhc2UgKi8KPiArICAgICAgIH0g
ZWxzZSBpZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KSB7IC8qIGZvciBHUFVfUkVTRVQgY2FzZSAqLwo+
ICAgICAgICAgICAgICAgICAvKiByZXNldCBNUUQgdG8gYSBjbGVhbiBzdGF0dXMgKi8KPiAgICAg
ICAgICAgICAgICAgaWYgKGFkZXYtPmdmeC5tZWMubXFkX2JhY2t1cFttcWRfaWR4XSkKPiAgICAg
ICAgICAgICAgICAgICAgICAgICBtZW1jcHkobXFkLCBhZGV2LT5nZngubWVjLm1xZF9iYWNrdXBb
bXFkX2lkeF0sIHNpemVvZihzdHJ1Y3QgdjlfbXFkX2FsbG9jYXRpb24pKTsKPiBAQCAtMzkzMCw3
ICszOTMwLDcgQEAgc3RhdGljIGludCBnZnhfdjlfMF9od19maW5pKHZvaWQgKmhhbmRsZSkKPiAg
ICAgICAgIC8qIFVzZSBkZWluaXRpYWxpemUgc2VxdWVuY2UgZnJvbSBDQUlMIHdoZW4gdW5iaW5k
aW5nIGRldmljZSBmcm9tIGRyaXZlciwKPiAgICAgICAgICAqIG90aGVyd2lzZSBLSVEgaXMgaGFu
Z2luZyB3aGVuIGJpbmRpbmcgYmFjawo+ICAgICAgICAgICovCj4gLSAgICAgICBpZiAoIWFtZGdw
dV9pbl9yZXNldChhZGV2KSAmJiAhYWRldi0+aW5fc3VzcGVuZCkgewo+ICsgICAgICAgaWYgKCFh
ZGV2LT5pbl9ncHVfcmVzZXQgJiYgIWFkZXYtPmluX3N1c3BlbmQpIHsKPiAgICAgICAgICAgICAg
ICAgbXV0ZXhfbG9jaygmYWRldi0+c3JibV9tdXRleCk7Cj4gICAgICAgICAgICAgICAgIHNvYzE1
X2dyYm1fc2VsZWN0KGFkZXYsIGFkZXYtPmdmeC5raXEucmluZy5tZSwKPiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGFkZXYtPmdmeC5raXEucmluZy5waXBlLAo+IEBAIC00MDg4LDcg
KzQwODgsNyBAQCBzdGF0aWMgdWludDY0X3QgZ2Z4X3Y5XzBfa2lxX3JlYWRfY2xvY2soc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYpCj4gICAgICAgICAgKgo+ICAgICAgICAgICogYWxzbyBkb24n
dCB3YWl0IGFueW1vcmUgZm9yIElSUSBjb250ZXh0Cj4gICAgICAgICAgKiAqLwo+IC0gICAgICAg
aWYgKHIgPCAxICYmIChhbWRncHVfaW5fcmVzZXQoYWRldikgfHwgaW5faW50ZXJydXB0KCkpKQo+
ICsgICAgICAgaWYgKHIgPCAxICYmIChhZGV2LT5pbl9ncHVfcmVzZXQgfHwgaW5faW50ZXJydXB0
KCkpKQo+ICAgICAgICAgICAgICAgICBnb3RvIGZhaWxlZF9raXFfcmVhZDsKPgo+ICAgICAgICAg
bWlnaHRfc2xlZXAoKTsKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
Z21jX3YxMF8wLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjEwXzAuYwo+IGlu
ZGV4IDlkM2IxMjQ1YTMzOS4uZWM4YzBhZjM5NTUzIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2dtY192MTBfMC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvZ21jX3YxMF8wLmMKPiBAQCAtMjg3LDcgKzI4Nyw3IEBAIHN0YXRpYyB2b2lkIGdtY192
MTBfMF9mbHVzaF9ncHVfdGxiKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50MzJfdCB2
bWlkLAo+ICAgICAgICAgICovCj4gICAgICAgICBpZiAoYWRldi0+Z2Z4LmtpcS5yaW5nLnNjaGVk
LnJlYWR5ICYmCj4gICAgICAgICAgICAgKGFtZGdwdV9zcmlvdl9ydW50aW1lKGFkZXYpIHx8ICFh
bWRncHVfc3Jpb3ZfdmYoYWRldikpICYmCj4gLSAgICAgICAgICAgIWFtZGdwdV9pbl9yZXNldChh
ZGV2KSkgewo+ICsgICAgICAgICAgICFhZGV2LT5pbl9ncHVfcmVzZXQpIHsKPgo+ICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgYW1kZ3B1X3ZtaHViICpodWIgPSAmYWRldi0+dm1odWJbdm1odWJdOwo+
ICAgICAgICAgICAgICAgICBjb25zdCB1bnNpZ25lZCBlbmcgPSAxNzsKPiBAQCAtMzEyLDcgKzMx
Miw3IEBAIHN0YXRpYyB2b2lkIGdtY192MTBfMF9mbHVzaF9ncHVfdGxiKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LCB1aW50MzJfdCB2bWlkLAo+Cj4gICAgICAgICBpZiAoIWFkZXYtPm1tYW4u
YnVmZmVyX2Z1bmNzX2VuYWJsZWQgfHwKPiAgICAgICAgICAgICAhYWRldi0+aWJfcG9vbF9yZWFk
eSB8fAo+IC0gICAgICAgICAgIGFtZGdwdV9pbl9yZXNldChhZGV2KSB8fAo+ICsgICAgICAgICAg
IGFkZXYtPmluX2dwdV9yZXNldCB8fAo+ICAgICAgICAgICAgIHJpbmctPnNjaGVkLnJlYWR5ID09
IGZhbHNlKSB7Cj4gICAgICAgICAgICAgICAgIGdtY192MTBfMF9mbHVzaF92bV9odWIoYWRldiwg
dm1pZCwgQU1ER1BVX0dGWEhVQl8wLCAwKTsKPiAgICAgICAgICAgICAgICAgbXV0ZXhfdW5sb2Nr
KCZhZGV2LT5tbWFuLmd0dF93aW5kb3dfbG9jayk7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2dtY192N18wLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9n
bWNfdjdfMC5jCj4gaW5kZXggODBjMTQ2ZGYzMzhhLi4zY2U1YzFkMmZkZjIgMTAwNjQ0Cj4gLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y3XzAuYwo+ICsrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2dtY192N18wLmMKPiBAQCAtNDM0LDcgKzQzNCw3IEBAIHN0YXRp
YyBpbnQgZ21jX3Y3XzBfZmx1c2hfZ3B1X3RsYl9wYXNpZChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiwKPiAgICAgICAgIGludCB2bWlkOwo+ICAgICAgICAgdW5zaWduZWQgaW50IHRtcDsKPgo+
IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkKPiArICAgICAgIGlmIChhZGV2LT5p
bl9ncHVfcmVzZXQpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRUlPOwo+Cj4gICAgICAgICBm
b3IgKHZtaWQgPSAxOyB2bWlkIDwgMTY7IHZtaWQrKykgewo+IGRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjhfMC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvZ21jX3Y4XzAuYwo+IGluZGV4IDlhYjY1Y2E3ZGY3Ny4uM2U2NjE1ZjlkMzljIDEwMDY0NAo+
IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OF8wLmMKPiArKysgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjhfMC5jCj4gQEAgLTYzNSw3ICs2MzUsNyBAQCBz
dGF0aWMgaW50IGdtY192OF8wX2ZsdXNoX2dwdV90bGJfcGFzaWQoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsCj4gICAgICAgICBpbnQgdm1pZDsKPiAgICAgICAgIHVuc2lnbmVkIGludCB0bXA7
Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBpZiAoYWRl
di0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVJTzsKPgo+ICAgICAg
ICAgZm9yICh2bWlkID0gMTsgdm1pZCA8IDE2OyB2bWlkKyspIHsKPiBkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2dtY192OV8wLmMKPiBpbmRleCA3NzNlZTExYjNkMTcuLjZhNzgwYjY3NDAxOCAxMDA2
NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjlfMC5jCj4gKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYwo+IEBAIC01MDEsNyArNTAxLDcg
QEAgc3RhdGljIHZvaWQgZ21jX3Y5XzBfZmx1c2hfZ3B1X3RsYihzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwgdWludDMyX3Qgdm1pZCwKPiAgICAgICAgICAqLwo+ICAgICAgICAgaWYgKGFkZXYt
PmdmeC5raXEucmluZy5zY2hlZC5yZWFkeSAmJgo+ICAgICAgICAgICAgICAgICAgICAgICAgIChh
bWRncHVfc3Jpb3ZfcnVudGltZShhZGV2KSB8fCAhYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKSAmJgo+
IC0gICAgICAgICAgICAgICAgICAgICAgICFhbWRncHVfaW5fcmVzZXQoYWRldikpIHsKPiArICAg
ICAgICAgICAgICAgICAgICAgICAhYWRldi0+aW5fZ3B1X3Jlc2V0KSB7Cj4gICAgICAgICAgICAg
ICAgIHVpbnQzMl90IHJlcSA9IGh1Yi0+dm1faW52X2VuZzBfcmVxICsgaHViLT5lbmdfZGlzdGFu
Y2UgKiBlbmc7Cj4gICAgICAgICAgICAgICAgIHVpbnQzMl90IGFjayA9IGh1Yi0+dm1faW52X2Vu
ZzBfYWNrICsgaHViLT5lbmdfZGlzdGFuY2UgKiBlbmc7Cj4KPiBAQCAtNTk2LDcgKzU5Niw3IEBA
IHN0YXRpYyBpbnQgZ21jX3Y5XzBfZmx1c2hfZ3B1X3RsYl9wYXNpZChzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwKPiAgICAgICAgIHN0cnVjdCBhbWRncHVfcmluZyAqcmluZyA9ICZhZGV2LT5n
Zngua2lxLnJpbmc7Cj4gICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2tpcSAqa2lxID0gJmFkZXYtPmdm
eC5raXE7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikpCj4gKyAgICAgICBp
ZiAoYWRldi0+aW5fZ3B1X3Jlc2V0KQo+ICAgICAgICAgICAgICAgICByZXR1cm4gLUVJTzsKPgo+
ICAgICAgICAgaWYgKHJpbmctPnNjaGVkLnJlYWR5KSB7Cj4gQEAgLTYzMyw4ICs2MzMsNyBAQCBz
dGF0aWMgaW50IGdtY192OV8wX2ZsdXNoX2dwdV90bGJfcGFzaWQoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsCj4gICAgICAgICAgICAgICAgIHNwaW5fdW5sb2NrKCZhZGV2LT5nZngua2lxLnJp
bmdfbG9jayk7Cj4gICAgICAgICAgICAgICAgIHIgPSBhbWRncHVfZmVuY2Vfd2FpdF9wb2xsaW5n
KHJpbmcsIHNlcSwgYWRldi0+dXNlY190aW1lb3V0KTsKPiAgICAgICAgICAgICAgICAgaWYgKHIg
PCAxKSB7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgZGV2X2luZm8oYWRldi0+ZGV2LAo+IC0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIndhaXQgZm9yIGtpcSBmZW5jZSBlcnJvcjog
JWxkXG4iLCByKTsKPiArICAgICAgICAgICAgICAgICAgICAgICBEUk1fRVJST1IoIndhaXQgZm9y
IGtpcSBmZW5jZSBlcnJvcjogJWxkLlxuIiwgcik7Cj4gICAgICAgICAgICAgICAgICAgICAgICAg
cmV0dXJuIC1FVElNRTsKPiAgICAgICAgICAgICAgICAgfQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L214Z3B1X2FpLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9teGdwdV9haS5jCj4gaW5kZXggZmUzMWNiZWNjZmU5Li41ZmQ2N2UxY2MyYTAgMTAwNjQ0
Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvbXhncHVfYWkuYwo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L214Z3B1X2FpLmMKPiBAQCAtMjM4LDE2ICsyMzgsMjAg
QEAgc3RhdGljIHZvaWQgeGdwdV9haV9tYWlsYm94X2Zscl93b3JrKHN0cnVjdCB3b3JrX3N0cnVj
dCAqd29yaykKPiAgICAgICAgIHN0cnVjdCBhbWRncHVfdmlydCAqdmlydCA9IGNvbnRhaW5lcl9v
Zih3b3JrLCBzdHJ1Y3QgYW1kZ3B1X3ZpcnQsIGZscl93b3JrKTsKPiAgICAgICAgIHN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2ID0gY29udGFpbmVyX29mKHZpcnQsIHN0cnVjdCBhbWRncHVfZGV2
aWNlLCB2aXJ0KTsKPiAgICAgICAgIGludCB0aW1lb3V0ID0gQUlfTUFJTEJPWF9QT0xMX0ZMUl9U
SU1FRE9VVDsKPiArICAgICAgIGludCBsb2NrZWQ7Cj4KPiAgICAgICAgIC8qIGJsb2NrIGFtZGdw
dV9ncHVfcmVjb3ZlciB0aWxsIG1zZyBGTFIgQ09NUExFVEUgcmVjZWl2ZWQsCj4gICAgICAgICAg
KiBvdGhlcndpc2UgdGhlIG1haWxib3ggbXNnIHdpbGwgYmUgcnVpbmVkL3Jlc2V0ZWQgYnkKPiAg
ICAgICAgICAqIHRoZSBWRiBGTFIuCj4gICAgICAgICAgKgo+IC0gICAgICAgICogd2UgY2FuIHVu
bG9jayB0aGUgcmVzZXRfc2VtIHRvIGFsbG93ICJhbWRncHVfam9iX3RpbWVkb3V0Igo+ICsgICAg
ICAgICogd2UgY2FuIHVubG9jayB0aGUgbG9ja19yZXNldCB0byBhbGxvdyAiYW1kZ3B1X2pvYl90
aW1lZG91dCIKPiAgICAgICAgICAqIHRvIHJ1biBncHVfcmVjb3ZlcigpIGFmdGVyIEZMUl9OT1RJ
RklDQVRJT05fQ01QTCByZWNlaXZlZAo+ICAgICAgICAgICogd2hpY2ggbWVhbnMgaG9zdCBzaWRl
IGhhZCBmaW5pc2hlZCB0aGlzIFZGJ3MgRkxSLgo+ICAgICAgICAgICovCj4gLSAgICAgICBkb3du
X3JlYWQoJmFkZXYtPnJlc2V0X3NlbSk7Cj4gKyAgICAgICBsb2NrZWQgPSBtdXRleF90cnlsb2Nr
KCZhZGV2LT5sb2NrX3Jlc2V0KTsKPiArICAgICAgIGlmIChsb2NrZWQpCj4gKyAgICAgICAgICAg
ICAgIGFkZXYtPmluX2dwdV9yZXNldCA9IHRydWU7Cj4gKwo+ICAgICAgICAgZG8gewo+ICAgICAg
ICAgICAgICAgICBpZiAoeGdwdV9haV9tYWlsYm94X3BlZWtfbXNnKGFkZXYpID09IElESF9GTFJf
Tk9USUZJQ0FUSU9OX0NNUEwpCj4gICAgICAgICAgICAgICAgICAgICAgICAgZ290byBmbHJfZG9u
ZTsKPiBAQCAtMjU3LDcgKzI2MSwxMCBAQCBzdGF0aWMgdm9pZCB4Z3B1X2FpX21haWxib3hfZmxy
X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAgICAgICAgfSB3aGlsZSAodGltZW91
dCA+IDEpOwo+Cj4gIGZscl9kb25lOgo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2Vt
KTsKPiArICAgICAgIGlmIChsb2NrZWQpIHsKPiArICAgICAgICAgICAgICAgYWRldi0+aW5fZ3B1
X3Jlc2V0ID0gZmFsc2U7Cj4gKyAgICAgICAgICAgICAgIG11dGV4X3VubG9jaygmYWRldi0+bG9j
a19yZXNldCk7Cj4gKyAgICAgICB9Cj4KPiAgICAgICAgIC8qIFRyaWdnZXIgcmVjb3ZlcnkgZm9y
IHdvcmxkIHN3aXRjaCBmYWlsdXJlIGlmIG5vIFREUiAqLwo+ICAgICAgICAgaWYgKGFtZGdwdV9k
ZXZpY2Vfc2hvdWxkX3JlY292ZXJfZ3B1KGFkZXYpCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L214Z3B1X252LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9t
eGdwdV9udi5jCj4gaW5kZXggNmY1NTE3MmU4MzM3Li5jZTJiZjFmYjc5ZWQgMTAwNjQ0Cj4gLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvbXhncHVfbnYuYwo+ICsrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L214Z3B1X252LmMKPiBAQCAtMjU5LDE2ICsyNTksMjAgQEAgc3Rh
dGljIHZvaWQgeGdwdV9udl9tYWlsYm94X2Zscl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29y
aykKPiAgICAgICAgIHN0cnVjdCBhbWRncHVfdmlydCAqdmlydCA9IGNvbnRhaW5lcl9vZih3b3Jr
LCBzdHJ1Y3QgYW1kZ3B1X3ZpcnQsIGZscl93b3JrKTsKPiAgICAgICAgIHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2ID0gY29udGFpbmVyX29mKHZpcnQsIHN0cnVjdCBhbWRncHVfZGV2aWNlLCB2
aXJ0KTsKPiAgICAgICAgIGludCB0aW1lb3V0ID0gTlZfTUFJTEJPWF9QT0xMX0ZMUl9USU1FRE9V
VDsKPiArICAgICAgIGludCBsb2NrZWQ7Cj4KPiAgICAgICAgIC8qIGJsb2NrIGFtZGdwdV9ncHVf
cmVjb3ZlciB0aWxsIG1zZyBGTFIgQ09NUExFVEUgcmVjZWl2ZWQsCj4gICAgICAgICAgKiBvdGhl
cndpc2UgdGhlIG1haWxib3ggbXNnIHdpbGwgYmUgcnVpbmVkL3Jlc2V0ZWQgYnkKPiAgICAgICAg
ICAqIHRoZSBWRiBGTFIuCj4gICAgICAgICAgKgo+IC0gICAgICAgICogd2UgY2FuIHVubG9jayB0
aGUgcmVzZXRfc2VtIHRvIGFsbG93ICJhbWRncHVfam9iX3RpbWVkb3V0Igo+ICsgICAgICAgICog
d2UgY2FuIHVubG9jayB0aGUgbG9ja19yZXNldCB0byBhbGxvdyAiYW1kZ3B1X2pvYl90aW1lZG91
dCIKPiAgICAgICAgICAqIHRvIHJ1biBncHVfcmVjb3ZlcigpIGFmdGVyIEZMUl9OT1RJRklDQVRJ
T05fQ01QTCByZWNlaXZlZAo+ICAgICAgICAgICogd2hpY2ggbWVhbnMgaG9zdCBzaWRlIGhhZCBm
aW5pc2hlZCB0aGlzIFZGJ3MgRkxSLgo+ICAgICAgICAgICovCj4gLSAgICAgICBkb3duX3JlYWQo
JmFkZXYtPnJlc2V0X3NlbSk7Cj4gKyAgICAgICBsb2NrZWQgPSBtdXRleF90cnlsb2NrKCZhZGV2
LT5sb2NrX3Jlc2V0KTsKPiArICAgICAgIGlmIChsb2NrZWQpCj4gKyAgICAgICAgICAgICAgIGFk
ZXYtPmluX2dwdV9yZXNldCA9IHRydWU7Cj4gKwo+ICAgICAgICAgZG8gewo+ICAgICAgICAgICAg
ICAgICBpZiAoeGdwdV9udl9tYWlsYm94X3BlZWtfbXNnKGFkZXYpID09IElESF9GTFJfTk9USUZJ
Q0FUSU9OX0NNUEwpCj4gICAgICAgICAgICAgICAgICAgICAgICAgZ290byBmbHJfZG9uZTsKPiBA
QCAtMjc4LDcgKzI4MiwxMCBAQCBzdGF0aWMgdm9pZCB4Z3B1X252X21haWxib3hfZmxyX3dvcmso
c3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAgICAgICAgfSB3aGlsZSAodGltZW91dCA+IDEp
Owo+Cj4gIGZscl9kb25lOgo+IC0gICAgICAgdXBfcmVhZCgmYWRldi0+cmVzZXRfc2VtKTsKPiAr
ICAgICAgIGlmIChsb2NrZWQpIHsKPiArICAgICAgICAgICAgICAgYWRldi0+aW5fZ3B1X3Jlc2V0
ID0gZmFsc2U7Cj4gKyAgICAgICAgICAgICAgIG11dGV4X3VubG9jaygmYWRldi0+bG9ja19yZXNl
dCk7Cj4gKyAgICAgICB9Cj4KPiAgICAgICAgIC8qIFRyaWdnZXIgcmVjb3ZlcnkgZm9yIHdvcmxk
IHN3aXRjaCBmYWlsdXJlIGlmIG5vIFREUiAqLwo+ICAgICAgICAgaWYgKGFtZGdwdV9kZXZpY2Vf
c2hvdWxkX3JlY292ZXJfZ3B1KGFkZXYpCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1ka2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRrZmQva2ZkX2RldmljZV9xdWV1ZV9tYW5hZ2VyLmMKPiBpbmRleCA3YWQxNTM3ODIwYjUu
LmUwZTYwYjBkMDY2OSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9r
ZmRfZGV2aWNlX3F1ZXVlX21hbmFnZXIuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
a2ZkL2tmZF9kZXZpY2VfcXVldWVfbWFuYWdlci5jCj4gQEAgLTMwNCwxNyArMzA0LDE1IEBAIHN0
YXRpYyB2b2lkIGRlYWxsb2NhdGVfdm1pZChzdHJ1Y3QgZGV2aWNlX3F1ZXVlX21hbmFnZXIgKmRx
bSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBxY21fcHJvY2Vzc19k
ZXZpY2UgKnFwZCwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBxdWV1
ZSAqcSkKPiAgewo+IC0gICAgICAgaWYgKCFkcW0tPmlzX3Jlc2V0dGluZykgewo+IC0gICAgICAg
ICAgICAgICAvKiBPbiBHRlggdjcsIENQIGRvZXNuJ3QgZmx1c2ggVEMgYXQgZGVxdWV1ZSAqLwo+
IC0gICAgICAgICAgICAgICBpZiAocS0+ZGV2aWNlLT5kZXZpY2VfaW5mby0+YXNpY19mYW1pbHkg
PT0gQ0hJUF9IQVdBSUkpCj4gLSAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZsdXNoX3RleHR1
cmVfY2FjaGVfbm9jcHNjaChxLT5kZXZpY2UsIHFwZCkpCj4gLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBwcl9lcnIoIkZhaWxlZCB0byBmbHVzaCBUQ1xuIik7Cj4gKyAgICAgICAvKiBP
biBHRlggdjcsIENQIGRvZXNuJ3QgZmx1c2ggVEMgYXQgZGVxdWV1ZSAqLwo+ICsgICAgICAgaWYg
KHEtPmRldmljZS0+ZGV2aWNlX2luZm8tPmFzaWNfZmFtaWx5ID09IENISVBfSEFXQUlJKQo+ICsg
ICAgICAgICAgICAgICBpZiAoZmx1c2hfdGV4dHVyZV9jYWNoZV9ub2Nwc2NoKHEtPmRldmljZSwg
cXBkKSkKPiArICAgICAgICAgICAgICAgICAgICAgICBwcl9lcnIoIkZhaWxlZCB0byBmbHVzaCBU
Q1xuIik7Cj4KPiAtICAgICAgICAgICAgICAga2ZkX2ZsdXNoX3RsYihxcGRfdG9fcGRkKHFwZCkp
Owo+ICsgICAgICAga2ZkX2ZsdXNoX3RsYihxcGRfdG9fcGRkKHFwZCkpOwo+Cj4gLSAgICAgICAg
ICAgICAgIC8qIFJlbGVhc2UgdGhlIHZtaWQgbWFwcGluZyAqLwo+IC0gICAgICAgICAgICAgICBz
ZXRfcGFzaWRfdm1pZF9tYXBwaW5nKGRxbSwgMCwgcXBkLT52bWlkKTsKPiAtICAgICAgIH0KPiAr
ICAgICAgIC8qIFJlbGVhc2UgdGhlIHZtaWQgbWFwcGluZyAqLwo+ICsgICAgICAgc2V0X3Bhc2lk
X3ZtaWRfbWFwcGluZyhkcW0sIDAsIHFwZC0+dm1pZCk7Cj4gICAgICAgICBkcW0tPnZtaWRfcGFz
aWRbcXBkLT52bWlkXSA9IDA7Cj4KPiAgICAgICAgIHFwZC0+dm1pZCA9IDA7Cj4gZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wcm9jZXNzLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGtmZC9rZmRfcHJvY2Vzcy5jCj4gaW5kZXggNzFiZTg5N2Q0YzJhLi4wMTNj
MmIwMThlZGMgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX3By
b2Nlc3MuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wcm9jZXNzLmMK
PiBAQCAtMTU1MSwxMCArMTU1MSw2IEBAIGludCBrZmRfcmVzZXJ2ZWRfbWVtX21tYXAoc3RydWN0
IGtmZF9kZXYgKmRldiwgc3RydWN0IGtmZF9wcm9jZXNzICpwcm9jZXNzLAo+ICB2b2lkIGtmZF9m
bHVzaF90bGIoc3RydWN0IGtmZF9wcm9jZXNzX2RldmljZSAqcGRkKQo+ICB7Cj4gICAgICAgICBz
dHJ1Y3Qga2ZkX2RldiAqZGV2ID0gcGRkLT5kZXY7Cj4gLSAgICAgICBzdHJ1Y3QgZGV2aWNlX3F1
ZXVlX21hbmFnZXIgKmRxbSA9IGRldi0+ZHFtOwo+IC0KPiAtICAgICAgIGlmIChkcW0tPmlzX3Jl
c2V0dGluZykKPiAtICAgICAgICAgICAgICAgcmV0dXJuOwo+Cj4gICAgICAgICBpZiAoZGV2LT5k
cW0tPnNjaGVkX3BvbGljeSA9PSBLRkRfU0NIRURfUE9MSUNZX05PX0hXUykgewo+ICAgICAgICAg
ICAgICAgICAvKiBOb3RoaW5nIHRvIGZsdXNoIHVudGlsIGEgVk1JRCBpcyBhc3NpZ25lZCwgd2hp
Y2gKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9h
bWRncHVfZG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1
X2RtLmMKPiBpbmRleCBmZjVmN2Y3Y2VlYzYuLmM0ZGFhMjI5MDRkYSAxMDA2NDQKPiAtLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCj4gKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYwo+IEBAIC0x
NjU4LDcgKzE2NTgsNyBAQCBzdGF0aWMgaW50IGRtX3N1c3BlbmQodm9pZCAqaGFuZGxlKQo+ICAg
ICAgICAgc3RydWN0IGFtZGdwdV9kaXNwbGF5X21hbmFnZXIgKmRtID0gJmFkZXYtPmRtOwo+ICAg
ICAgICAgaW50IHJldCA9IDA7Cj4KPiAtICAgICAgIGlmIChhbWRncHVfaW5fcmVzZXQoYWRldikp
IHsKPiArICAgICAgIGlmIChhZGV2LT5pbl9ncHVfcmVzZXQpIHsKPiAgICAgICAgICAgICAgICAg
bXV0ZXhfbG9jaygmZG0tPmRjX2xvY2spOwo+ICAgICAgICAgICAgICAgICBkbS0+Y2FjaGVkX2Rj
X3N0YXRlID0gZGNfY29weV9zdGF0ZShkbS0+ZGMtPmN1cnJlbnRfc3RhdGUpOwo+Cj4gQEAgLTE4
NDQsNyArMTg0NCw3IEBAIHN0YXRpYyBpbnQgZG1fcmVzdW1lKHZvaWQgKmhhbmRsZSkKPiAgICAg
ICAgIHN0cnVjdCBkY19zdGF0ZSAqZGNfc3RhdGU7Cj4gICAgICAgICBpbnQgaSwgciwgajsKPgo+
IC0gICAgICAgaWYgKGFtZGdwdV9pbl9yZXNldChhZGV2KSkgewo+ICsgICAgICAgaWYgKGFkZXYt
PmluX2dwdV9yZXNldCkgewo+ICAgICAgICAgICAgICAgICBkY19zdGF0ZSA9IGRtLT5jYWNoZWRf
ZGNfc3RhdGU7Cj4KPiAgICAgICAgICAgICAgICAgciA9IGRtX2RtdWJfaHdfaW5pdChhZGV2KTsK
PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5j
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jCj4gaW5kZXggMWZm
YWNjNzEyZTUzLi5jOGUzMGQ1OWU2NTggMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9wb3dlcnBsYXkvYW1kZ3B1X3NtdS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dl
cnBsYXkvYW1kZ3B1X3NtdS5jCj4gQEAgLTExMTAsNyArMTExMCw3IEBAIHN0YXRpYyBpbnQgc211
X2Rpc2FibGVfZHBtcyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKPiAgICAgICAgIHN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2ID0gc211LT5hZGV2Owo+ICAgICAgICAgaW50IHJldCA9IDA7Cj4g
ICAgICAgICBib29sIHVzZV9iYWNvID0gIXNtdS0+aXNfYXB1ICYmCj4gLSAgICAgICAgICAgICAg
ICgoYW1kZ3B1X2luX3Jlc2V0KGFkZXYpICYmCj4gKyAgICAgICAgICAgICAgICgoYWRldi0+aW5f
Z3B1X3Jlc2V0ICYmCj4gICAgICAgICAgICAgICAgICAgKGFtZGdwdV9hc2ljX3Jlc2V0X21ldGhv
ZChhZGV2KSA9PSBBTURfUkVTRVRfTUVUSE9EX0JBQ08pKSB8fAo+ICAgICAgICAgICAgICAgICAg
KChhZGV2LT5pbl9ydW5wbSB8fCBhZGV2LT5pbl9oaWJlcm5hdGUpICYmIGFtZGdwdV9hc2ljX3N1
cHBvcnRzX2JhY28oYWRldikpKTsKPgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L3Bvd2VycGxheS9od21nci92ZWdhMjBfaHdtZ3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93
ZXJwbGF5L2h3bWdyL3ZlZ2EyMF9od21nci5jCj4gaW5kZXggZGE4NDAxMmI3ZmQ1Li5jNzIxNjM2
MmI2OGQgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvaHdtZ3Iv
dmVnYTIwX2h3bWdyLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9od21n
ci92ZWdhMjBfaHdtZ3IuYwo+IEBAIC00ODksNyArNDg5LDcgQEAgc3RhdGljIGludCB2ZWdhMjBf
c2V0dXBfYXNpY190YXNrKHN0cnVjdCBwcF9od21nciAqaHdtZ3IpCj4gIHsKPiAgICAgICAgIHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopKGh3bWdy
LT5hZGV2KTsKPiAgICAgICAgIGludCByZXQgPSAwOwo+IC0gICAgICAgYm9vbCB1c2VfYmFjbyA9
IChhbWRncHVfaW5fcmVzZXQoYWRldikgJiYKPiArICAgICAgIGJvb2wgdXNlX2JhY28gPSAoYWRl
di0+aW5fZ3B1X3Jlc2V0ICYmCj4gICAgICAgICAgICAgICAgICAgICAgICAgIChhbWRncHVfYXNp
Y19yZXNldF9tZXRob2QoYWRldikgPT0gQU1EX1JFU0VUX01FVEhPRF9CQUNPKSkgfHwKPiAgICAg
ICAgICAgICAgICAgKGFkZXYtPmluX3J1bnBtICYmIGFtZGdwdV9hc2ljX3N1cHBvcnRzX2JhY28o
YWRldikpOwo+Cj4gLS0KPiAyLjE3LjEKPgo+IF9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCj4gYW1kLWdmeCBtYWlsaW5nIGxpc3QKPiBhbWQtZ2Z4QGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwo+IGh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vYW1kLWdmeApfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZngK
