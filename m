Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 41FE910A0B8
	for <lists+amd-gfx@lfdr.de>; Tue, 26 Nov 2019 15:51:30 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4FDBF6E40D;
	Tue, 26 Nov 2019 14:51:28 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8D47A6E40D
 for <amd-gfx@lists.freedesktop.org>; Tue, 26 Nov 2019 14:51:26 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id n5so3670208wmc.0
 for <amd-gfx@lists.freedesktop.org>; Tue, 26 Nov 2019 06:51:26 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc;
 bh=zOIwr/7ExPi9N4vv5tRSGgd1gfj091DvV/3FobRwVVU=;
 b=Q4R5a0/ZGxPQVWF2BJ9ZnvVmdUhwcm4BZwJDtWIuXmCHCeMUvd9a5+x0Z78EVYCBpv
 9kD6U55iu8wh0/U7yUEE4gsdTpOTUOFd98/yIxwp+glvOMCY4Tf+dbi72cCKhD3noTCB
 1PDp6XdQU7It5+dZUjlGt+D9S+zX+jzMn/BixxjolajxKXWoXCSBJJ4VnQOvSBRtTBNe
 hlnEYUZFtPhxRYdaBATd32E24RgVGEHUOz7dtJX/bvCgRzrqZfs18tKcMZFj6Ab3jqJo
 93rJ1owN+6HYJnNxz4fHTjYUc0/aTlW4BrUKVwu/YkpFETfVM+AURAjYEfIuA4qaGHx6
 Y7AA==
X-Gm-Message-State: APjAAAXd3RUKbmpJ94SW8kM4GTFRlffwvFVICPhnVZ7xMpBKUu2zlk/z
 /ivvf7EQd3fn05ON2oBz491KTyVrBiEA506AeGA3XA==
X-Google-Smtp-Source: APXvYqxdSByYZ5tIzCWkhuqt7sawKXlmYRLgF2Kn1acbI6UPdeemNpQRrnE4jnF29g+0cSaeNxsLUKzLPWytfb12vYM=
X-Received: by 2002:a7b:c408:: with SMTP id k8mr4875032wmi.67.1574779884881;
 Tue, 26 Nov 2019 06:51:24 -0800 (PST)
MIME-Version: 1.0
References: <20191121165529.3941-1-alexander.deucher@amd.com>
In-Reply-To: <20191121165529.3941-1-alexander.deucher@amd.com>
From: Alex Deucher <alexdeucher@gmail.com>
Date: Tue, 26 Nov 2019 09:51:13 -0500
Message-ID: <CADnq5_OA56jv3wjRH43obaFM4M=nsZ4fESbQ6fDzOZ2RiQ21Sg@mail.gmail.com>
Subject: Re: [PATCH] drm/amdgpu: move pci handling out of pm ops
To: amd-gfx list <amd-gfx@lists.freedesktop.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc;
 bh=zOIwr/7ExPi9N4vv5tRSGgd1gfj091DvV/3FobRwVVU=;
 b=T8ZLS1ua35TyPMdJKVcDVeIt38fJykAjuzkl9ickT4aIJxUeLP9rL9zpXP2tVnswpG
 PcRUxOYB7rqaBAnv3T7r7KkdlpjDC/lL1C2h0nRkLb6ze68fl4d1cdN93yycd6Vpcjqo
 sREqq3pU+6q/BC0M5mm//4bWj20YaZYc7TSNCAsKRCkpZFR34R3a+8fSN/iU8NYX+NB5
 DsNZARFx+A2l+6Cnf+axPq3GBdQjCw1ToEnT+hBE+X0cXM85CZQhzYk7Pj2EkiYYkVFV
 mU8+wTLZofacRKqA1llGFVpozZDqRJgZ07U9iei2KXfuUO81/T4t3IH09qHFxHx+j85i
 odPg==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

UGluZz8gIEkndmUgdGVzdGVkIHRoaXMgb24gYWxsIHRoZSBjYXJkcyBJIGhhdmUgYWNjZXNzIHRv
LgoKQWxleAoKT24gVGh1LCBOb3YgMjEsIDIwMTkgYXQgMTE6NTUgQU0gQWxleCBEZXVjaGVyIDxh
bGV4ZGV1Y2hlckBnbWFpbC5jb20+IHdyb3RlOgo+Cj4gVGhlIGRvY3VtZW50YXRpb24gc2F5cyB0
aGUgdGhhdCBQQ0kgY29yZSBoYW5kbGVzIHRoaXMKPiBmb3IgeW91IHVubGVzcyB5b3UgY2hvb3Nl
IHRvIGltcGxlbWVudCBpdC4gIEp1c3QgcmVseQo+IG9uIHRoZSBQQ0kgY29yZSB0byBoYW5kbGUg
dGhlIHBjaSBzcGVjaWZpYyBiaXRzLgo+Cj4gU2lnbmVkLW9mZi1ieTogQWxleCBEZXVjaGVyIDxh
bGV4YW5kZXIuZGV1Y2hlckBhbWQuY29tPgo+IC0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHUuaCAgICAgICAgfCAgNCArLS0KPiAgZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2RldmljZS5jIHwgMzMgKysrKysrKysrLS0tLS0tLS0tLS0tLQo+ICBkcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMgICAgfCAxNiArKysrKy0tLS0tLQo+ICAz
IGZpbGVzIGNoYW5nZWQsIDI0IGluc2VydGlvbnMoKyksIDI5IGRlbGV0aW9ucygtKQo+Cj4gZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdS5oIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmgKPiBpbmRleCA5Nzg0MzQ2MmMyZmIuLjJlOWQwYmUw
NWYyZiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaAo+
ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdS5oCj4gQEAgLTExOTEsOCAr
MTE5MSw4IEBAIGludCBhbWRncHVfZHJpdmVyX29wZW5fa21zKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KTsKPiAgdm9pZCBhbWRncHVfZHJpdmVyX3Bv
c3RjbG9zZV9rbXMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKPiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdik7Cj4gIGludCBhbWRncHVf
ZGV2aWNlX2lwX3N1c3BlbmQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpOwo+IC1pbnQgYW1k
Z3B1X2RldmljZV9zdXNwZW5kKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGJvb2wgc3VzcGVuZCwg
Ym9vbCBmYmNvbik7Cj4gLWludCBhbWRncHVfZGV2aWNlX3Jlc3VtZShzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCBib29sIHJlc3VtZSwgYm9vbCBmYmNvbik7Cj4gK2ludCBhbWRncHVfZGV2aWNlX3N1
c3BlbmQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgYm9vbCBmYmNvbik7Cj4gK2ludCBhbWRncHVf
ZGV2aWNlX3Jlc3VtZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBib29sIGZiY29uKTsKPiAgdTMy
IGFtZGdwdV9nZXRfdmJsYW5rX2NvdW50ZXJfa21zKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVu
c2lnbmVkIGludCBwaXBlKTsKPiAgaW50IGFtZGdwdV9lbmFibGVfdmJsYW5rX2ttcyhzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSk7Cj4gIHZvaWQgYW1kZ3B1X2Rpc2Fi
bGVfdmJsYW5rX2ttcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSk7
Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2Uu
YyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYwo+IGluZGV4IGIx
NDA4YzVlNDY0MC4uZDgzMmJkMjJiYTlkIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kZXZpY2UuYwo+IEBAIC0xMDkwLDYgKzEwOTAsNyBAQCBzdGF0aWMgaW50IGFt
ZGdwdV9kZXZpY2VfY2hlY2tfYXJndW1lbnRzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQo+
ICBzdGF0aWMgdm9pZCBhbWRncHVfc3dpdGNoZXJvb19zZXRfc3RhdGUoc3RydWN0IHBjaV9kZXYg
KnBkZXYsIGVudW0gdmdhX3N3aXRjaGVyb29fc3RhdGUgc3RhdGUpCj4gIHsKPiAgICAgICAgIHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBwY2lfZ2V0X2RydmRhdGEocGRldik7Cj4gKyAgICAgICBp
bnQgcjsKPgo+ICAgICAgICAgaWYgKGFtZGdwdV9kZXZpY2Vfc3VwcG9ydHNfYm9jbyhkZXYpICYm
IHN0YXRlID09IFZHQV9TV0lUQ0hFUk9PX09GRikKPiAgICAgICAgICAgICAgICAgcmV0dXJuOwo+
IEBAIC0xMDk5LDcgKzExMDAsMTIgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X3N3aXRjaGVyb29fc2V0
X3N0YXRlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBlbnVtIHZnYV9zd2l0Y2hlcm8KPiAgICAgICAg
ICAgICAgICAgLyogZG9uJ3Qgc3VzcGVuZCBvciByZXN1bWUgY2FyZCBub3JtYWxseSAqLwo+ICAg
ICAgICAgICAgICAgICBkZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSA9IERSTV9TV0lUQ0hfUE9XRVJf
Q0hBTkdJTkc7Cj4KPiAtICAgICAgICAgICAgICAgYW1kZ3B1X2RldmljZV9yZXN1bWUoZGV2LCB0
cnVlLCB0cnVlKTsKPiArICAgICAgICAgICAgICAgcGNpX3NldF9wb3dlcl9zdGF0ZShkZXYtPnBk
ZXYsIFBDSV9EMCk7Cj4gKyAgICAgICAgICAgICAgIHBjaV9yZXN0b3JlX3N0YXRlKGRldi0+cGRl
dik7Cj4gKyAgICAgICAgICAgICAgIHIgPSBwY2lfZW5hYmxlX2RldmljZShkZXYtPnBkZXYpOwo+
ICsgICAgICAgICAgICAgICBpZiAocikKPiArICAgICAgICAgICAgICAgICAgICAgICBEUk1fV0FS
TigicGNpX2VuYWJsZV9kZXZpY2UgZmFpbGVkICglZClcbiIsIHIpOwo+ICsgICAgICAgICAgICAg
ICBhbWRncHVfZGV2aWNlX3Jlc3VtZShkZXYsIHRydWUpOwo+Cj4gICAgICAgICAgICAgICAgIGRl
di0+c3dpdGNoX3Bvd2VyX3N0YXRlID0gRFJNX1NXSVRDSF9QT1dFUl9PTjsKPiAgICAgICAgICAg
ICAgICAgZHJtX2ttc19oZWxwZXJfcG9sbF9lbmFibGUoZGV2KTsKPiBAQCAtMTEwNyw3ICsxMTEz
LDExIEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9zd2l0Y2hlcm9vX3NldF9zdGF0ZShzdHJ1Y3QgcGNp
X2RldiAqcGRldiwgZW51bSB2Z2Ffc3dpdGNoZXJvCj4gICAgICAgICAgICAgICAgIHByX2luZm8o
ImFtZGdwdTogc3dpdGNoZWQgb2ZmXG4iKTsKPiAgICAgICAgICAgICAgICAgZHJtX2ttc19oZWxw
ZXJfcG9sbF9kaXNhYmxlKGRldik7Cj4gICAgICAgICAgICAgICAgIGRldi0+c3dpdGNoX3Bvd2Vy
X3N0YXRlID0gRFJNX1NXSVRDSF9QT1dFUl9DSEFOR0lORzsKPiAtICAgICAgICAgICAgICAgYW1k
Z3B1X2RldmljZV9zdXNwZW5kKGRldiwgdHJ1ZSwgdHJ1ZSk7Cj4gKyAgICAgICAgICAgICAgIGFt
ZGdwdV9kZXZpY2Vfc3VzcGVuZChkZXYsIHRydWUpOwo+ICsgICAgICAgICAgICAgICBwY2lfc2F2
ZV9zdGF0ZShkZXYtPnBkZXYpOwo+ICsgICAgICAgICAgICAgICAvKiBTaHV0IGRvd24gdGhlIGRl
dmljZSAqLwo+ICsgICAgICAgICAgICAgICBwY2lfZGlzYWJsZV9kZXZpY2UoZGV2LT5wZGV2KTsK
PiArICAgICAgICAgICAgICAgcGNpX3NldF9wb3dlcl9zdGF0ZShkZXYtPnBkZXYsIFBDSV9EM2Nv
bGQpOwo+ICAgICAgICAgICAgICAgICBkZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSA9IERSTV9TV0lU
Q0hfUE9XRVJfT0ZGOwo+ICAgICAgICAgfQo+ICB9Cj4gQEAgLTMxOTgsNyArMzIwOCw3IEBAIHZv
aWQgYW1kZ3B1X2RldmljZV9maW5pKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQo+ICAgKiBS
ZXR1cm5zIDAgZm9yIHN1Y2Nlc3Mgb3IgYW4gZXJyb3Igb24gZmFpbHVyZS4KPiAgICogQ2FsbGVk
IGF0IGRyaXZlciBzdXNwZW5kLgo+ICAgKi8KPiAtaW50IGFtZGdwdV9kZXZpY2Vfc3VzcGVuZChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBib29sIHN1c3BlbmQsIGJvb2wgZmJjb24pCj4gK2ludCBh
bWRncHVfZGV2aWNlX3N1c3BlbmQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgYm9vbCBmYmNvbikK
PiAgewo+ICAgICAgICAgc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXY7Cj4gICAgICAgICBzdHJ1
Y3QgZHJtX2NydGMgKmNydGM7Cj4gQEAgLTMyODEsMTMgKzMyOTEsNiBAQCBpbnQgYW1kZ3B1X2Rl
dmljZV9zdXNwZW5kKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGJvb2wgc3VzcGVuZCwgYm9vbCBm
YmNvbikKPiAgICAgICAgICAqLwo+ICAgICAgICAgYW1kZ3B1X2JvX2V2aWN0X3ZyYW0oYWRldik7
Cj4KPiAtICAgICAgIGlmIChzdXNwZW5kKSB7Cj4gLSAgICAgICAgICAgICAgIHBjaV9zYXZlX3N0
YXRlKGRldi0+cGRldik7Cj4gLSAgICAgICAgICAgICAgIC8qIFNodXQgZG93biB0aGUgZGV2aWNl
ICovCj4gLSAgICAgICAgICAgICAgIHBjaV9kaXNhYmxlX2RldmljZShkZXYtPnBkZXYpOwo+IC0g
ICAgICAgICAgICAgICBwY2lfc2V0X3Bvd2VyX3N0YXRlKGRldi0+cGRldiwgUENJX0QzaG90KTsK
PiAtICAgICAgIH0KPiAtCj4gICAgICAgICByZXR1cm4gMDsKPiAgfQo+Cj4gQEAgLTMzMDIsNyAr
MzMwNSw3IEBAIGludCBhbWRncHVfZGV2aWNlX3N1c3BlbmQoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgYm9vbCBzdXNwZW5kLCBib29sIGZiY29uKQo+ICAgKiBSZXR1cm5zIDAgZm9yIHN1Y2Nlc3Mg
b3IgYW4gZXJyb3Igb24gZmFpbHVyZS4KPiAgICogQ2FsbGVkIGF0IGRyaXZlciByZXN1bWUuCj4g
ICAqLwo+IC1pbnQgYW1kZ3B1X2RldmljZV9yZXN1bWUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
Ym9vbCByZXN1bWUsIGJvb2wgZmJjb24pCj4gK2ludCBhbWRncHVfZGV2aWNlX3Jlc3VtZShzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCBib29sIGZiY29uKQo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yOwo+ICAgICAgICAgc3RydWN0IGRybV9jb25uZWN0b3JfbGlz
dF9pdGVyIGl0ZXI7Cj4gQEAgLTMzMTMsMTQgKzMzMTYsNiBAQCBpbnQgYW1kZ3B1X2RldmljZV9y
ZXN1bWUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgYm9vbCByZXN1bWUsIGJvb2wgZmJjb24pCj4g
ICAgICAgICBpZiAoZGV2LT5zd2l0Y2hfcG93ZXJfc3RhdGUgPT0gRFJNX1NXSVRDSF9QT1dFUl9P
RkYpCj4gICAgICAgICAgICAgICAgIHJldHVybiAwOwo+Cj4gLSAgICAgICBpZiAocmVzdW1lKSB7
Cj4gLSAgICAgICAgICAgICAgIHBjaV9zZXRfcG93ZXJfc3RhdGUoZGV2LT5wZGV2LCBQQ0lfRDAp
Owo+IC0gICAgICAgICAgICAgICBwY2lfcmVzdG9yZV9zdGF0ZShkZXYtPnBkZXYpOwo+IC0gICAg
ICAgICAgICAgICByID0gcGNpX2VuYWJsZV9kZXZpY2UoZGV2LT5wZGV2KTsKPiAtICAgICAgICAg
ICAgICAgaWYgKHIpCj4gLSAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7Cj4gLSAgICAg
ICB9Cj4gLQo+ICAgICAgICAgLyogcG9zdCBjYXJkICovCj4gICAgICAgICBpZiAoYW1kZ3B1X2Rl
dmljZV9uZWVkX3Bvc3QoYWRldikpIHsKPiAgICAgICAgICAgICAgICAgciA9IGFtZGdwdV9hdG9t
X2FzaWNfaW5pdChhZGV2LT5tb2RlX2luZm8uYXRvbV9jb250ZXh0KTsKPiBkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCj4gaW5kZXggZGYyZjQ3MjBhMmYwLi4yZjM2NzE0NmM3
MmMgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5j
Cj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCj4gQEAgLTEx
NTgsNyArMTE1OCw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Btb3BzX3N1c3BlbmQoc3RydWN0IGRl
dmljZSAqZGV2KQo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgZHJtX2RldmljZSAqZHJtX2RldiA9IGRl
dl9nZXRfZHJ2ZGF0YShkZXYpOwo+Cj4gLSAgICAgICByZXR1cm4gYW1kZ3B1X2RldmljZV9zdXNw
ZW5kKGRybV9kZXYsIHRydWUsIHRydWUpOwo+ICsgICAgICAgcmV0dXJuIGFtZGdwdV9kZXZpY2Vf
c3VzcGVuZChkcm1fZGV2LCB0cnVlKTsKPiAgfQo+Cj4gIHN0YXRpYyBpbnQgYW1kZ3B1X3Btb3Bz
X3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gQEAgLTExNzMsNyArMTE3Myw3IEBAIHN0YXRp
YyBpbnQgYW1kZ3B1X3Btb3BzX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gICAgICAgICAg
ICAgICAgIHBtX3J1bnRpbWVfZW5hYmxlKGRldik7Cj4gICAgICAgICB9Cj4KPiAtICAgICAgIHJl
dHVybiBhbWRncHVfZGV2aWNlX3Jlc3VtZShkcm1fZGV2LCB0cnVlLCB0cnVlKTsKPiArICAgICAg
IHJldHVybiBhbWRncHVfZGV2aWNlX3Jlc3VtZShkcm1fZGV2LCB0cnVlKTsKPiAgfQo+Cj4gIHN0
YXRpYyBpbnQgYW1kZ3B1X3Btb3BzX2ZyZWV6ZShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gQEAgLTEx
ODIsNyArMTE4Miw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Btb3BzX2ZyZWV6ZShzdHJ1Y3QgZGV2
aWNlICpkZXYpCj4gICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRybV9kZXYt
PmRldl9wcml2YXRlOwo+ICAgICAgICAgaW50IHI7Cj4KPiAtICAgICAgIHIgPSBhbWRncHVfZGV2
aWNlX3N1c3BlbmQoZHJtX2RldiwgZmFsc2UsIHRydWUpOwo+ICsgICAgICAgciA9IGFtZGdwdV9k
ZXZpY2Vfc3VzcGVuZChkcm1fZGV2LCB0cnVlKTsKPiAgICAgICAgIGlmIChyKQo+ICAgICAgICAg
ICAgICAgICByZXR1cm4gcjsKPiAgICAgICAgIHJldHVybiBhbWRncHVfYXNpY19yZXNldChhZGV2
KTsKPiBAQCAtMTE5MiwyMSArMTE5MiwyMSBAQCBzdGF0aWMgaW50IGFtZGdwdV9wbW9wc190aGF3
KHN0cnVjdCBkZXZpY2UgKmRldikKPiAgewo+ICAgICAgICAgc3RydWN0IGRybV9kZXZpY2UgKmRy
bV9kZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKPgo+IC0gICAgICAgcmV0dXJuIGFtZGdwdV9k
ZXZpY2VfcmVzdW1lKGRybV9kZXYsIGZhbHNlLCB0cnVlKTsKPiArICAgICAgIHJldHVybiBhbWRn
cHVfZGV2aWNlX3Jlc3VtZShkcm1fZGV2LCB0cnVlKTsKPiAgfQo+Cj4gIHN0YXRpYyBpbnQgYW1k
Z3B1X3Btb3BzX3Bvd2Vyb2ZmKHN0cnVjdCBkZXZpY2UgKmRldikKPiAgewo+ICAgICAgICAgc3Ry
dWN0IGRybV9kZXZpY2UgKmRybV9kZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKPgo+IC0gICAg
ICAgcmV0dXJuIGFtZGdwdV9kZXZpY2Vfc3VzcGVuZChkcm1fZGV2LCB0cnVlLCB0cnVlKTsKPiAr
ICAgICAgIHJldHVybiBhbWRncHVfZGV2aWNlX3N1c3BlbmQoZHJtX2RldiwgdHJ1ZSk7Cj4gIH0K
Pgo+ICBzdGF0aWMgaW50IGFtZGdwdV9wbW9wc19yZXN0b3JlKHN0cnVjdCBkZXZpY2UgKmRldikK
PiAgewo+ICAgICAgICAgc3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXYgPSBkZXZfZ2V0X2RydmRh
dGEoZGV2KTsKPgo+IC0gICAgICAgcmV0dXJuIGFtZGdwdV9kZXZpY2VfcmVzdW1lKGRybV9kZXYs
IGZhbHNlLCB0cnVlKTsKPiArICAgICAgIHJldHVybiBhbWRncHVfZGV2aWNlX3Jlc3VtZShkcm1f
ZGV2LCB0cnVlKTsKPiAgfQo+Cj4gIHN0YXRpYyBpbnQgYW1kZ3B1X3Btb3BzX3J1bnRpbWVfc3Vz
cGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gQEAgLTEyMjUsNyArMTIyNSw3IEBAIHN0YXRpYyBp
bnQgYW1kZ3B1X3Btb3BzX3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gICAg
ICAgICAgICAgICAgIGRybV9kZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSA9IERSTV9TV0lUQ0hfUE9X
RVJfQ0hBTkdJTkc7Cj4gICAgICAgICBkcm1fa21zX2hlbHBlcl9wb2xsX2Rpc2FibGUoZHJtX2Rl
dik7Cj4KPiAtICAgICAgIHJldCA9IGFtZGdwdV9kZXZpY2Vfc3VzcGVuZChkcm1fZGV2LCBmYWxz
ZSwgZmFsc2UpOwo+ICsgICAgICAgcmV0ID0gYW1kZ3B1X2RldmljZV9zdXNwZW5kKGRybV9kZXYs
IGZhbHNlKTsKPiAgICAgICAgIGlmIChhbWRncHVfZGV2aWNlX3N1cHBvcnRzX2JvY28oZHJtX2Rl
dikpIHsKPiAgICAgICAgICAgICAgICAgLyogT25seSBuZWVkIHRvIGhhbmRsZSBQQ0kgc3RhdGUg
aW4gdGhlIGRyaXZlciBmb3IgQVRQWAo+ICAgICAgICAgICAgICAgICAgKiBQQ0kgY29yZSBoYW5k
bGVzIGl0IGZvciBfUFIzLgo+IEBAIC0xMjc1LDcgKzEyNzUsNyBAQCBzdGF0aWMgaW50IGFtZGdw
dV9wbW9wc19ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCj4gICAgICAgICB9IGVs
c2UgaWYgKGFtZGdwdV9kZXZpY2Vfc3VwcG9ydHNfYmFjbyhkcm1fZGV2KSkgewo+ICAgICAgICAg
ICAgICAgICBhbWRncHVfZGV2aWNlX2JhY29fZXhpdChkcm1fZGV2KTsKPiAgICAgICAgIH0KPiAt
ICAgICAgIHJldCA9IGFtZGdwdV9kZXZpY2VfcmVzdW1lKGRybV9kZXYsIGZhbHNlLCBmYWxzZSk7
Cj4gKyAgICAgICByZXQgPSBhbWRncHVfZGV2aWNlX3Jlc3VtZShkcm1fZGV2LCBmYWxzZSk7Cj4g
ICAgICAgICBkcm1fa21zX2hlbHBlcl9wb2xsX2VuYWJsZShkcm1fZGV2KTsKPiAgICAgICAgIGlm
IChhbWRncHVfZGV2aWNlX3N1cHBvcnRzX2JvY28oZHJtX2RldikpCj4gICAgICAgICAgICAgICAg
IGRybV9kZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSA9IERSTV9TV0lUQ0hfUE9XRVJfT047Cj4gLS0K
PiAyLjIzLjAKPgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
