Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E18E6A20CE
	for <lists+amd-gfx@lfdr.de>; Thu, 29 Aug 2019 18:24:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E769B6E12F;
	Thu, 29 Aug 2019 16:24:20 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-BN3-obe.outbound.protection.outlook.com
 (mail-eopbgr740089.outbound.protection.outlook.com [40.107.74.89])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A75BC6E133
 for <amd-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 16:24:01 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=a1sjuTeZ45xEm4e0agHiuHIvocBpFPJzLr3Lu6IjML1owapv9fze/svSsXzfnG3cBjLEfWewGAHylwsaKxOODupF5Jr5TersZPNCvxurglocd4YC2NQIVAhTKnCms9yTWX5vwSLO15/rJt12DRtHV/FQ3RPMn3r9CdL42/BJOHatMWCtmBoNDBzgQ7GOHU2uhSwAkD02WBUt2Z0yk0dBGVlASDq+4zDBvFnBU0jfnRoe7OhLeGNuCyYEhR3P/HBKKpjVt9ogMTAGidS5dRYIODImsujbmgug107H/zeOVcUrCK6JO7vWjphJKlXdH7/Oq2Kn7kgkFqK24a3a+7vLaA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=joK1ZNhq9ZxheJ5ryU/vnAO2S6lKRJTweQgPPUkBgz0=;
 b=OCOv+FynZNAHiowcus4+MwW7lbW2l8Ec72ZIdXz6U9YteP8FiBO4MHic1A71q04RdFiUqO9pJxj4ZJ/Z2xiCUzX/xcl9Xu4pqSH70D1UF7Ek5FfF1fFKfKvpnsPQfn4MCWpDGOuP0mgAdBeabGUF/iepnqsemMQ3M31g+qoVJ6PuHsUGtF6AYAh9adTJzqTkrCZZbvEvjgCmOtH16a4Mfeo7il4jAMhD1bIgHFKDelQ0NA8nJhLYrMrjQq7BzdaHkYcoAVWhoBG449PAva2gO/PjCnIKVF669CGVaJDQEGTwyyiReFFRz4E5iLn6QrYcpHfh3+2SPpmQ6u7dvQUoXw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org smtp.mailfrom=amd.com; 
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from BN4PR12CA0012.namprd12.prod.outlook.com (2603:10b6:403:2::22)
 by BN6PR12MB1265.namprd12.prod.outlook.com (2603:10b6:404:1d::11) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2199.19; Thu, 29 Aug
 2019 16:24:00 +0000
Received: from BY2NAM03FT007.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e4a::201) by BN4PR12CA0012.outlook.office365.com
 (2603:10b6:403:2::22) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2199.14 via Frontend
 Transport; Thu, 29 Aug 2019 16:23:59 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV02.amd.com (165.204.84.17) by
 BY2NAM03FT007.mail.protection.outlook.com (10.152.84.70) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2220.16 via Frontend Transport; Thu, 29 Aug 2019 16:23:59 +0000
Received: from blakha.amd.com (10.180.168.240) by SATLEXCHOV02.amd.com
 (10.181.40.72) with Microsoft SMTP Server id 14.3.389.1; Thu, 29 Aug 2019
 11:23:44 -0500
From: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 08/20] drm/amdgpu: psp HDCP init
Date: Thu, 29 Aug 2019 12:22:41 -0400
Message-ID: <20190829162253.10195-9-Bhawanpreet.Lakha@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190829162253.10195-1-Bhawanpreet.Lakha@amd.com>
References: <20190829162253.10195-1-Bhawanpreet.Lakha@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(346002)(376002)(136003)(39860400002)(396003)(2980300002)(428003)(199004)(189003)(6916009)(4326008)(126002)(5660300002)(2351001)(426003)(81156014)(48376002)(81166006)(11346002)(16586007)(36756003)(305945005)(50466002)(8676002)(476003)(478600001)(2616005)(76176011)(336012)(2906002)(86362001)(26005)(7696005)(50226002)(53936002)(47776003)(356004)(6666004)(1076003)(486006)(53416004)(446003)(316002)(186003)(8936002)(14444005)(70586007)(70206006)(51416003);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN6PR12MB1265; H:SATLEXCHOV02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 3272cb19-a4b7-4c5a-4c47-08d72c9d4c47
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600166)(711020)(4605104)(1401327)(4618075)(2017052603328);
 SRVR:BN6PR12MB1265; 
X-MS-TrafficTypeDiagnostic: BN6PR12MB1265:
X-Microsoft-Antispam-PRVS: <BN6PR12MB126589AFABCC04EEC16DB767F9A20@BN6PR12MB1265.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:309;
X-Forefront-PRVS: 0144B30E41
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: EqubRX2deEhA3tiZ+5E6MbR7WOZPp6K9ONu1+vSsE/GqbXN0VWa3K0wAFwciRMo1WjmmNuEV/q7GoQuc+WSZNQ0GRZdeIbtgZ5U8/Ahgu+I6LLzORtae+1Qhk4DNJ7uZF5Xyvj00OVrub04evONPs5qCW6EDWEEEAEFAYtoAjH0jOBfweqRAcCfKRMhA6kdsxjih2ZycxyU627nOv89iGNK3Y1SwizilgBLGxW3hahTNOQv9m8OePyRfkMv0EZChmUUlbbx35cgHUvdtIALXSEP+e+AvaG1bttEbIl63gMXSonSIFQjoRP4VJ4te452UjgZTlnxmLCQ0hdIvndtRT50PKtuXds2LHuB/4/vF2UOv/EVEIxgpbGEJR96vI4pw4LI+UT+xSc0eWd4cO6RMM92eFjyd5rsT3H5GnO8sxZ0=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 29 Aug 2019 16:23:59.5881 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 3272cb19-a4b7-4c5a-4c47-08d72c9d4c47
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN6PR12MB1265
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=joK1ZNhq9ZxheJ5ryU/vnAO2S6lKRJTweQgPPUkBgz0=;
 b=hU6JS3o/niQlfyQIHRxzWqeZfGvIbhJaSJPC0cyBIlz01MjXV+3Zkp2Ajk2o+XEYToTQtIv08+h4yr51ISbzCjPeeRlBS6s5aBWhyQwsFqm847DS4EfSGRQyq61Ms0qP+ERaUHVfC9dRiymoXbpaHKaOsB0vJmrnMGRp8kMtCTA=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBhZGRzCi1Mb2FkaW5nIHRoZSBmaXJtd2FyZQotVGhlIGZ1bmN0aW9ucyBhbmQg
ZGVmaW5pdGlvbnMgZm9yIGNvbW11bmljYXRpb24gd2l0aCB0aGUgZmlybXdhcmUKClNpZ25lZC1v
ZmYtYnk6IEJoYXdhbnByZWV0IExha2hhIDxCaGF3YW5wcmVldC5MYWtoYUBhbWQuY29tPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYyAgIHwgMTg4ICsrKysrKysr
KysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuaCAg
IHwgIDE3ICsrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdWNvZGUuaCB8ICAg
MyArCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9wc3BfdjEwXzAuYyAgICB8ICAzMSArKyst
CiA0IGZpbGVzIGNoYW5nZWQsIDIzNyBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYwppbmRleCA5ZjdjYzViY2MwMzcuLmNj
Y2UxYjUwNmExMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3BzcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wc3AuYwpAQCAt
NzY5LDYgKzc2OSwxNzkgQEAgc3RhdGljIGludCBwc3BfcmFzX2luaXRpYWxpemUoc3RydWN0IHBz
cF9jb250ZXh0ICpwc3ApCiB9CiAvLyByYXMgZW5kCiAKKy8vIEhEQ1Agc3RhcnQKK3N0YXRpYyB2
b2lkIHBzcF9wcmVwX2hkY3BfdGFfbG9hZF9jbWRfYnVmKHN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNw
ICpjbWQsCisJCXVpbnQ2NF90IGhkY3BfdGFfbWMsIHVpbnQ2NF90IGhkY3BfbWNfc2hhcmVkLAor
CQl1aW50MzJfdCBoZGNwX3RhX3NpemUsIHVpbnQzMl90IHNoYXJlZF9zaXplKQoreworCWNtZC0+
Y21kX2lkID0gR0ZYX0NNRF9JRF9MT0FEX1RBOworCWNtZC0+Y21kLmNtZF9sb2FkX3RhLmFwcF9w
aHlfYWRkcl9sbyA9IGxvd2VyXzMyX2JpdHMoaGRjcF90YV9tYyk7CisJY21kLT5jbWQuY21kX2xv
YWRfdGEuYXBwX3BoeV9hZGRyX2hpID0gdXBwZXJfMzJfYml0cyhoZGNwX3RhX21jKTsKKwljbWQt
PmNtZC5jbWRfbG9hZF90YS5hcHBfbGVuID0gaGRjcF90YV9zaXplOworCisJY21kLT5jbWQuY21k
X2xvYWRfdGEuY21kX2J1Zl9waHlfYWRkcl9sbyA9IGxvd2VyXzMyX2JpdHMoaGRjcF9tY19zaGFy
ZWQpOworCWNtZC0+Y21kLmNtZF9sb2FkX3RhLmNtZF9idWZfcGh5X2FkZHJfaGkgPSB1cHBlcl8z
Ml9iaXRzKGhkY3BfbWNfc2hhcmVkKTsKKwljbWQtPmNtZC5jbWRfbG9hZF90YS5jbWRfYnVmX2xl
biA9IHNoYXJlZF9zaXplOworfQorCitzdGF0aWMgaW50IHBzcF9oZGNwX2luaXRfc2hhcmVkX2J1
ZihzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKK3sKKwlpbnQgcmV0OworCisJLyoKKwkgKiBBbGxv
Y2F0ZSAxNmsgbWVtb3J5IGFsaWduZWQgdG8gNGsgZnJvbSBGcmFtZSBCdWZmZXIgKGxvY2FsCisJ
ICogcGh5c2ljYWwpIGZvciBoZGNwIHRhIDwtPiBEcml2ZXIKKwkgKi8KKwlyZXQgPSBhbWRncHVf
Ym9fY3JlYXRlX2tlcm5lbChwc3AtPmFkZXYsIFBTUF9IRENQX1NIQVJFRF9NRU1fU0laRSwKKwkJ
CVBBR0VfU0laRSwgQU1ER1BVX0dFTV9ET01BSU5fVlJBTSwKKwkJCSZwc3AtPmhkY3BfY29udGV4
dC5oZGNwX3NoYXJlZF9ibywKKwkJCSZwc3AtPmhkY3BfY29udGV4dC5oZGNwX3NoYXJlZF9tY19h
ZGRyLAorCQkJJnBzcC0+aGRjcF9jb250ZXh0LmhkY3Bfc2hhcmVkX2J1Zik7CisKKwlyZXR1cm4g
cmV0OworfQorCitzdGF0aWMgaW50IHBzcF9oZGNwX2xvYWQoc3RydWN0IHBzcF9jb250ZXh0ICpw
c3ApCit7CisJaW50IHJldDsKKwlzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCAqY21kOworCisJLyoK
KwkgKiBUT0RPOiBieXBhc3MgdGhlIGxvYWRpbmcgaW4gc3Jpb3YgZm9yIG5vdworCSAqLworCWlm
IChhbWRncHVfc3Jpb3ZfdmYocHNwLT5hZGV2KSkKKwkJcmV0dXJuIDA7CisKKwljbWQgPSBremFs
bG9jKHNpemVvZihzdHJ1Y3QgcHNwX2dmeF9jbWRfcmVzcCksIEdGUF9LRVJORUwpOworCWlmICgh
Y21kKQorCQlyZXR1cm4gLUVOT01FTTsKKworCW1lbXNldChwc3AtPmZ3X3ByaV9idWYsIDAsIFBT
UF8xX01FRyk7CisJbWVtY3B5KHBzcC0+ZndfcHJpX2J1ZiwgcHNwLT50YV9oZGNwX3N0YXJ0X2Fk
ZHIsIHBzcC0+dGFfaGRjcF91Y29kZV9zaXplKTsKKworCXBzcF9wcmVwX2hkY3BfdGFfbG9hZF9j
bWRfYnVmKGNtZCwgcHNwLT5md19wcmlfbWNfYWRkciwKKwkJCXBzcC0+aGRjcF9jb250ZXh0Lmhk
Y3Bfc2hhcmVkX21jX2FkZHIsCisJCQlwc3AtPnRhX2hkY3BfdWNvZGVfc2l6ZSwgUFNQX0hEQ1Bf
U0hBUkVEX01FTV9TSVpFKTsKKworCXJldCA9IHBzcF9jbWRfc3VibWl0X2J1Zihwc3AsIE5VTEws
IGNtZCwKKwkJCXBzcC0+ZmVuY2VfYnVmX21jX2FkZHIpOworCisJaWYgKCFyZXQpIHsKKwkJcHNw
LT5oZGNwX2NvbnRleHQuaGRjcF9pbml0aWFsaXplZCA9IDE7CisJCXBzcC0+aGRjcF9jb250ZXh0
LnNlc3Npb25faWQgPSBjbWQtPnJlc3Auc2Vzc2lvbl9pZDsKKwl9CisKKwlrZnJlZShjbWQpOwor
CisJcmV0dXJuIHJldDsKK30KK3N0YXRpYyBpbnQgcHNwX2hkY3BfaW5pdGlhbGl6ZShzdHJ1Y3Qg
cHNwX2NvbnRleHQgKnBzcCkKK3sKKwlpbnQgcmV0OworCisJaWYgKCFwc3AtPmhkY3BfY29udGV4
dC5oZGNwX2luaXRpYWxpemVkKSB7CisJCXJldCA9IHBzcF9oZGNwX2luaXRfc2hhcmVkX2J1Zihw
c3ApOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXQgPSBwc3BfaGRjcF9s
b2FkKHBzcCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVybiAwOworfQorc3Rh
dGljIHZvaWQgcHNwX3ByZXBfaGRjcF90YV91bmxvYWRfY21kX2J1ZihzdHJ1Y3QgcHNwX2dmeF9j
bWRfcmVzcCAqY21kLAorCQkJCQkJdWludDMyX3QgaGRjcF9zZXNzaW9uX2lkKQoreworCWNtZC0+
Y21kX2lkID0gR0ZYX0NNRF9JRF9VTkxPQURfVEE7CisJY21kLT5jbWQuY21kX3VubG9hZF90YS5z
ZXNzaW9uX2lkID0gaGRjcF9zZXNzaW9uX2lkOworfQorCitzdGF0aWMgaW50IHBzcF9oZGNwX3Vu
bG9hZChzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKK3sKKwlpbnQgcmV0OworCXN0cnVjdCBwc3Bf
Z2Z4X2NtZF9yZXNwICpjbWQ7CisKKwkvKgorCSAqIFRPRE86IGJ5cGFzcyB0aGUgdW5sb2FkaW5n
IGluIHNyaW92IGZvciBub3cKKwkgKi8KKwlpZiAoYW1kZ3B1X3NyaW92X3ZmKHBzcC0+YWRldikp
CisJCXJldHVybiAwOworCisJY21kID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IHBzcF9nZnhfY21k
X3Jlc3ApLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNtZCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlw
c3BfcHJlcF9oZGNwX3RhX3VubG9hZF9jbWRfYnVmKGNtZCwgcHNwLT5oZGNwX2NvbnRleHQuc2Vz
c2lvbl9pZCk7CisKKwlyZXQgPSBwc3BfY21kX3N1Ym1pdF9idWYocHNwLCBOVUxMLCBjbWQsCisJ
CQlwc3AtPmZlbmNlX2J1Zl9tY19hZGRyKTsKKworCWtmcmVlKGNtZCk7CisKKwlyZXR1cm4gcmV0
OworfQorCitzdGF0aWMgdm9pZCBwc3BfcHJlcF9oZGNwX3RhX2ludm9rZV9jbWRfYnVmKHN0cnVj
dCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQsCisJCXVpbnQzMl90IHRhX2NtZF9pZCwKKwkJdWludDMy
X3QgaGRjcF9zZXNzaW9uX2lkKQoreworCWNtZC0+Y21kX2lkID0gR0ZYX0NNRF9JRF9JTlZPS0Vf
Q01EOworCWNtZC0+Y21kLmNtZF9pbnZva2VfY21kLnNlc3Npb25faWQgPSBoZGNwX3Nlc3Npb25f
aWQ7CisJY21kLT5jbWQuY21kX2ludm9rZV9jbWQudGFfY21kX2lkID0gdGFfY21kX2lkOworCS8q
IE5vdGU6IGNtZF9pbnZva2VfY21kLmJ1ZiBpcyBub3QgdXNlZCBmb3Igbm93ICovCit9CisKK2lu
dCBwc3BfaGRjcF9pbnZva2Uoc3RydWN0IHBzcF9jb250ZXh0ICpwc3AsIHVpbnQzMl90IHRhX2Nt
ZF9pZCkKK3sKKwlpbnQgcmV0OworCXN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwICpjbWQ7CisKKwkv
KgorCSAqIFRPRE86IGJ5cGFzcyB0aGUgbG9hZGluZyBpbiBzcmlvdiBmb3Igbm93CisJICovCisJ
aWYgKGFtZGdwdV9zcmlvdl92Zihwc3AtPmFkZXYpKQorCQlyZXR1cm4gMDsKKworCWNtZCA9IGt6
YWxsb2Moc2l6ZW9mKHN0cnVjdCBwc3BfZ2Z4X2NtZF9yZXNwKSwgR0ZQX0tFUk5FTCk7CisJaWYg
KCFjbWQpCisJCXJldHVybiAtRU5PTUVNOworCisJcHNwX3ByZXBfaGRjcF90YV9pbnZva2VfY21k
X2J1ZihjbWQsIHRhX2NtZF9pZCwKKwkJCXBzcC0+aGRjcF9jb250ZXh0LnNlc3Npb25faWQpOwor
CisJcmV0ID0gcHNwX2NtZF9zdWJtaXRfYnVmKHBzcCwgTlVMTCwgY21kLAorCQkJcHNwLT5mZW5j
ZV9idWZfbWNfYWRkcik7CisKKwlrZnJlZShjbWQpOworCisJcmV0dXJuIHJldDsKK30KKworCitz
dGF0aWMgaW50IHBzcF9oZGNwX3Rlcm1pbmF0ZShzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCkKK3sK
KwlpbnQgcmV0OworCisJaWYgKCFwc3AtPmhkY3BfY29udGV4dC5oZGNwX2luaXRpYWxpemVkKQor
CQlyZXR1cm4gMDsKKworCXJldCA9IHBzcF9oZGNwX3VubG9hZChwc3ApOworCWlmIChyZXQpCisJ
CXJldHVybiByZXQ7CisKKwlwc3AtPmhkY3BfY29udGV4dC5oZGNwX2luaXRpYWxpemVkID0gMDsK
KworCS8qIGZyZWUgaGRjcCBzaGFyZWQgbWVtb3J5ICovCisJYW1kZ3B1X2JvX2ZyZWVfa2VybmVs
KCZwc3AtPmhkY3BfY29udGV4dC5oZGNwX3NoYXJlZF9ibywKKwkJCSZwc3AtPmhkY3BfY29udGV4
dC5oZGNwX3NoYXJlZF9tY19hZGRyLAorCQkJJnBzcC0+aGRjcF9jb250ZXh0LmhkY3Bfc2hhcmVk
X2J1Zik7CisKKwlyZXR1cm4gMDsKK30KKy8vIEhEQ1AgZW5kCisKIHN0YXRpYyBpbnQgcHNwX2h3
X3N0YXJ0KHN0cnVjdCBwc3BfY29udGV4dCAqcHNwKQogewogCXN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2ID0gcHNwLT5hZGV2OwpAQCAtODQyLDYgKzEwMTUsMTIgQEAgc3RhdGljIGludCBwc3Bf
aHdfc3RhcnQoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiAJCWlmIChyZXQpCiAJCQlkZXZfZXJy
KHBzcC0+YWRldi0+ZGV2LAogCQkJCQkiUkFTOiBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBSQVNcbiIp
OworCisJCXJldCA9IHBzcF9oZGNwX2luaXRpYWxpemUocHNwKTsKKwkJaWYgKHJldCkKKwkJCWRl
dl9lcnIocHNwLT5hZGV2LT5kZXYsCisJCQkJCSJIRENQOiBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBI
RENQXG4iKTsKKwogCX0KIAogCXJldHVybiAwOwpAQCAtMTIxMSw4ICsxMzkwLDEwIEBAIHN0YXRp
YyBpbnQgcHNwX2h3X2Zpbmkodm9pZCAqaGFuZGxlKQogCSAgICBwc3AtPnhnbWlfY29udGV4dC5p
bml0aWFsaXplZCA9PSAxKQogICAgICAgICAgICAgICAgIHBzcF94Z21pX3Rlcm1pbmF0ZShwc3Ap
OwogCi0JaWYgKHBzcC0+YWRldi0+cHNwLnRhX2Z3KQorCWlmIChwc3AtPmFkZXYtPnBzcC50YV9m
dykgewogCQlwc3BfcmFzX3Rlcm1pbmF0ZShwc3ApOworCQlwc3BfaGRjcF90ZXJtaW5hdGUocHNw
KTsKKwl9CiAKIAlwc3BfcmluZ19kZXN0cm95KHBzcCwgUFNQX1JJTkdfVFlQRV9fS00pOwogCkBA
IC0xMjUzLDYgKzE0MzQsMTEgQEAgc3RhdGljIGludCBwc3Bfc3VzcGVuZCh2b2lkICpoYW5kbGUp
CiAJCQlEUk1fRVJST1IoIkZhaWxlZCB0byB0ZXJtaW5hdGUgcmFzIHRhXG4iKTsKIAkJCXJldHVy
biByZXQ7CiAJCX0KKwkJcmV0ID0gcHNwX2hkY3BfdGVybWluYXRlKHBzcCk7CisJCWlmIChyZXQp
IHsKKwkJCURSTV9FUlJPUigiRmFpbGVkIHRvIHRlcm1pbmF0ZSBoZGNwIHRhXG4iKTsKKwkJCXJl
dHVybiByZXQ7CisJCX0KIAl9CiAKIAlyZXQgPSBwc3BfcmluZ19zdG9wKHBzcCwgUFNQX1JJTkdf
VFlQRV9fS00pOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3BzcC5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3BzcC5oCmluZGV4IGJj
MDk0N2Y2YmM4YS4uNjc4OGUxNjAxOTQ1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfcHNwLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3BzcC5oCkBAIC0zNyw2ICszNyw4IEBACiAjZGVmaW5lIFBTUF9SQVNfU0hBUkVEX01FTV9T
SVpFIDB4NDAwMAogI2RlZmluZSBQU1BfMV9NRUcJCTB4MTAwMDAwCiAjZGVmaW5lIFBTUF9UTVJf
U0laRQkweDQwMDAwMAorI2RlZmluZSBQU1BfSERDUF9TSEFSRURfTUVNX1NJWkUJMHg0MDAwCisj
ZGVmaW5lIFBTUF9TSEFSRURfTUVNX1NJWkUJCTB4NDAwMAogCiBzdHJ1Y3QgcHNwX2NvbnRleHQ7
CiBzdHJ1Y3QgcHNwX3hnbWlfbm9kZV9pbmZvOwpAQCAtMTQyLDYgKzE0NCwxNCBAQCBzdHJ1Y3Qg
cHNwX3Jhc19jb250ZXh0IHsKIAlzdHJ1Y3QgYW1kZ3B1X3JhcwkqcmFzOwogfTsKIAorc3RydWN0
IHBzcF9oZGNwX2NvbnRleHQgeworCWJvb2wJCQloZGNwX2luaXRpYWxpemVkOworCXVpbnQzMl90
CQlzZXNzaW9uX2lkOworCXN0cnVjdCBhbWRncHVfYm8JKmhkY3Bfc2hhcmVkX2JvOworCXVpbnQ2
NF90CQloZGNwX3NoYXJlZF9tY19hZGRyOworCXZvaWQJCQkqaGRjcF9zaGFyZWRfYnVmOworfTsK
Kwogc3RydWN0IHBzcF9jb250ZXh0CiB7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgICAgICAgICAg
ICAqYWRldjsKQEAgLTIwNiw4ICsyMTYsMTQgQEAgc3RydWN0IHBzcF9jb250ZXh0CiAJdWludDMy
X3QJCQl0YV9yYXNfdWNvZGVfdmVyc2lvbjsKIAl1aW50MzJfdAkJCXRhX3Jhc191Y29kZV9zaXpl
OwogCXVpbnQ4X3QJCQkJKnRhX3Jhc19zdGFydF9hZGRyOworCisJdWludDMyX3QJCQl0YV9oZGNw
X3Vjb2RlX3ZlcnNpb247CisJdWludDMyX3QJCQl0YV9oZGNwX3Vjb2RlX3NpemU7CisJdWludDhf
dAkJCQkqdGFfaGRjcF9zdGFydF9hZGRyOworCiAJc3RydWN0IHBzcF94Z21pX2NvbnRleHQJCXhn
bWlfY29udGV4dDsKIAlzdHJ1Y3QgcHNwX3Jhc19jb250ZXh0CQlyYXM7CisJc3RydWN0IHBzcF9o
ZGNwX2NvbnRleHQgCWhkY3BfY29udGV4dDsKIAlzdHJ1Y3QgbXV0ZXgJCQltdXRleDsKIH07CiAK
QEAgLTI3OSw2ICsyOTUsNyBAQCBpbnQgcHNwX3hnbWlfaW52b2tlKHN0cnVjdCBwc3BfY29udGV4
dCAqcHNwLCB1aW50MzJfdCB0YV9jbWRfaWQpOwogaW50IHBzcF9yYXNfaW52b2tlKHN0cnVjdCBw
c3BfY29udGV4dCAqcHNwLCB1aW50MzJfdCB0YV9jbWRfaWQpOwogaW50IHBzcF9yYXNfZW5hYmxl
X2ZlYXR1cmVzKHN0cnVjdCBwc3BfY29udGV4dCAqcHNwLAogCQl1bmlvbiB0YV9yYXNfY21kX2lu
cHV0ICppbmZvLCBib29sIGVuYWJsZSk7CitpbnQgcHNwX2hkY3BfaW52b2tlKHN0cnVjdCBwc3Bf
Y29udGV4dCAqcHNwLCB1aW50MzJfdCB0YV9jbWRfaWQpOwogCiBpbnQgcHNwX3JsY19hdXRvbG9h
ZF9zdGFydChzdHJ1Y3QgcHNwX2NvbnRleHQgKnBzcCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91Y29kZS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X3Vjb2RlLmgKaW5kZXggYjM0ZjAwZDQyMDQ5Li5jMmI1OTNhYjc0OTUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91Y29kZS5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91Y29kZS5oCkBAIC0xMDgsNiArMTA4
LDkgQEAgc3RydWN0IHRhX2Zpcm13YXJlX2hlYWRlcl92MV8wIHsKIAl1aW50MzJfdCB0YV9yYXNf
dWNvZGVfdmVyc2lvbjsKIAl1aW50MzJfdCB0YV9yYXNfb2Zmc2V0X2J5dGVzOwogCXVpbnQzMl90
IHRhX3Jhc19zaXplX2J5dGVzOworCXVpbnQzMl90IHRhX2hkY3BfdWNvZGVfdmVyc2lvbjsKKwl1
aW50MzJfdCB0YV9oZGNwX29mZnNldF9ieXRlczsKKwl1aW50MzJfdCB0YV9oZGNwX3NpemVfYnl0
ZXM7CiB9OwogCiAvKiB2ZXJzaW9uX21ham9yPTEsIHZlcnNpb25fbWlub3I9MCAqLwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvcHNwX3YxMF8wLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9wc3BfdjEwXzAuYwppbmRleCBlNWZmZjZiMzAxMzcuLjM0OGVjNGUy
NzVmMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvcHNwX3YxMF8wLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvcHNwX3YxMF8wLmMKQEAgLTQ1LDcgKzQ1
LDcgQEAgc3RhdGljIGludCBwc3BfdjEwXzBfaW5pdF9taWNyb2NvZGUoc3RydWN0IHBzcF9jb250
ZXh0ICpwc3ApCiAJY2hhciBmd19uYW1lWzMwXTsKIAlpbnQgZXJyID0gMDsKIAljb25zdCBzdHJ1
Y3QgcHNwX2Zpcm13YXJlX2hlYWRlcl92MV8wICpoZHI7Ci0KKwljb25zdCBzdHJ1Y3QgdGFfZmly
bXdhcmVfaGVhZGVyX3YxXzAgKnRhX2hkcjsKIAlEUk1fREVCVUcoIlxuIik7CiAKIAlzd2l0Y2gg
KGFkZXYtPmFzaWNfdHlwZSkgewpAQCAtNzYsNyArNzYsMzYgQEAgc3RhdGljIGludCBwc3BfdjEw
XzBfaW5pdF9taWNyb2NvZGUoc3RydWN0IHBzcF9jb250ZXh0ICpwc3ApCiAJYWRldi0+cHNwLmFz
ZF9zdGFydF9hZGRyID0gKHVpbnQ4X3QgKiloZHIgKwogCQkJCWxlMzJfdG9fY3B1KGhkci0+aGVh
ZGVyLnVjb2RlX2FycmF5X29mZnNldF9ieXRlcyk7CiAKKworCXNucHJpbnRmKGZ3X25hbWUsIHNp
emVvZihmd19uYW1lKSwgImFtZGdwdS8lc190YS5iaW4iLCBjaGlwX25hbWUpOworCWVyciA9IHJl
cXVlc3RfZmlybXdhcmUoJmFkZXYtPnBzcC50YV9mdywgZndfbmFtZSwgYWRldi0+ZGV2KTsKKwlp
ZiAoZXJyKSB7CisJCXJlbGVhc2VfZmlybXdhcmUoYWRldi0+cHNwLnRhX2Z3KTsKKwkJYWRldi0+
cHNwLnRhX2Z3ID0gTlVMTDsKKwkJZGV2X2luZm8oYWRldi0+ZGV2LAorCQkJICJwc3AgdjEwLjA6
IEZhaWxlZCB0byBsb2FkIGZpcm13YXJlIFwiJXNcIlxuIiwgZndfbmFtZSk7CisJfSBlbHNlIHsK
KwkJZXJyID0gYW1kZ3B1X3Vjb2RlX3ZhbGlkYXRlKGFkZXYtPnBzcC50YV9mdyk7CisJCWlmIChl
cnIpCisJCQlnb3RvIG91dDI7CisKKwkJdGFfaGRyID0gKGNvbnN0IHN0cnVjdCB0YV9maXJtd2Fy
ZV9oZWFkZXJfdjFfMCAqKWFkZXYtPnBzcC50YV9mdy0+ZGF0YTsKKwkJYWRldi0+cHNwLnRhX2hk
Y3BfdWNvZGVfdmVyc2lvbiA9IGxlMzJfdG9fY3B1KHRhX2hkci0+dGFfaGRjcF91Y29kZV92ZXJz
aW9uKTsKKwkJYWRldi0+cHNwLnRhX2hkY3BfdWNvZGVfc2l6ZSA9IGxlMzJfdG9fY3B1KHRhX2hk
ci0+dGFfaGRjcF9zaXplX2J5dGVzKTsKKwkJYWRldi0+cHNwLnRhX2hkY3Bfc3RhcnRfYWRkciA9
ICh1aW50OF90ICopdGFfaGRyICsKKwkJCWxlMzJfdG9fY3B1KHRhX2hkci0+aGVhZGVyLnVjb2Rl
X2FycmF5X29mZnNldF9ieXRlcyk7CisKKwkJYWRldi0+cHNwLnRhX2Z3X3ZlcnNpb24gPSBsZTMy
X3RvX2NwdSh0YV9oZHItPmhlYWRlci51Y29kZV92ZXJzaW9uKTsKKworCX0KKwogCXJldHVybiAw
OworCisKKworb3V0MjoKKwlyZWxlYXNlX2Zpcm13YXJlKGFkZXYtPnBzcC50YV9mdyk7CisJYWRl
di0+cHNwLnRhX2Z3ID0gTlVMTDsKIG91dDoKIAlpZiAoZXJyKSB7CiAJCWRldl9lcnIoYWRldi0+
ZGV2LAotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
