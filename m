Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5E283D374C
	for <lists+amd-gfx@lfdr.de>; Fri, 11 Oct 2019 03:46:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6A4E16EBA0;
	Fri, 11 Oct 2019 01:46:12 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qk1-x742.google.com (mail-qk1-x742.google.com
 [IPv6:2607:f8b0:4864:20::742])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 27C406EB9B
 for <amd-gfx@lists.freedesktop.org>; Fri, 11 Oct 2019 01:45:59 +0000 (UTC)
Received: by mail-qk1-x742.google.com with SMTP id q203so7504418qke.1
 for <amd-gfx@lists.freedesktop.org>; Thu, 10 Oct 2019 18:45:59 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Fnb3b9R/0QD7U9eFADGmUKMeJWtQtwEe0anneG4klQ0=;
 b=uQa3gGX6eLDIS/LoCEhFc6uNb5kyATWFM1VPLBXbk2tDHMSl6+c4hBFKVLf0Ervzpa
 MyZjjogbayJs6i27HULbhnSKquzwveHV1LTnGz4PkK9NHEQZ4U/mH9er9zhYlOarlnYG
 AapV56MQ3M+vHo+1SiLFdlinqzvzSllMbIl0bNTrd2hGDYzBIiMNRDX8Db3MqcqU4msf
 UiYXFmPFfBVI526yqYzId19PEXV6pouJ0QkvVsE4D1EcsYHFtc0yyv4zvoDLsTOTihiS
 TtHzOl28HZ52Nj6t8diTLahSbWpnA5G9sfDxVmOrn4lh3QxFykX6Vo+eyi7enJ/XT8OE
 mmuQ==
X-Gm-Message-State: APjAAAU1kAholED+aNH5wnCc5RLsJZH6qnP+b05msU3rwz908a+nO8HU
 DwLb/kP+bLh/2SMOxJrHv1LskHqs
X-Google-Smtp-Source: APXvYqx9soFo4peVz+Dc5+HHRw6T6FWqkOlgJyMeZZJOrES0jAdljGGPCqutLn31EsamRlQDZ1cu9A==
X-Received: by 2002:a05:620a:1246:: with SMTP id
 a6mr12754564qkl.344.1570758357935; 
 Thu, 10 Oct 2019 18:45:57 -0700 (PDT)
Received: from localhost.localdomain ([71.51.171.205])
 by smtp.gmail.com with ESMTPSA id s23sm3612945qte.72.2019.10.10.18.45.57
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 10 Oct 2019 18:45:57 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org,
	tiwai@suse.de,
	lukas@wunner.de
Subject: [PATCH 13/19] drm/amdgpu: start to disentangle boco from runtime pm
Date: Thu, 10 Oct 2019 20:45:30 -0500
Message-Id: <20191011014536.10869-14-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191011014536.10869-1-alexander.deucher@amd.com>
References: <20191011014536.10869-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=Fnb3b9R/0QD7U9eFADGmUKMeJWtQtwEe0anneG4klQ0=;
 b=Nc3yohjU4i88iGQV1T0rIxxDjxxzolK0+q225Umj+0p8BOb8vAkvO3ouzzAVSX3qsj
 Zgn6YgxTT2WXdlPn+aZTltT4yUgZBnpcQcf33l6hp+qScdrsln8r4FZxu6LCkSbtWBT7
 h7sMpk3ZqN3e6JQHw6afD9ZZ/0MRTucDjDgDL65aJqTXwso/dlwtIs5K1yGYQze603JJ
 7vdf380C5hxO041nmbE1O2LZEvV9FH0AXPhkLSJQXeUXL2PTOtRAGX+sMYOP1Z+wXhPW
 xTSgXJNE5UGo0PMPw1I+6qGzNrw8MaTMmgn0uT2XuaQc2PFC0WyTDC807Vl+Qjo+79p6
 wbIw==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

V2Ugb3JpZ2luYWxseSBvbmx5IHN1cHBvcnRlZCBydW50aW1lIHBtIG9uIFBYL0hHCmxhcHRvcHMg
c28gbW9zdCBvZiB0aGUgcnVudGltZSBwbSBjb2RlIGxvb2tzIGZvciB0aGlzLgpBZGQgYSBuZXcg
ZmxhZyB0byBjaGVjayBmb3IgcnVudGltZSBwbSBlbmFibGVtZW50IGFuZAp1c2UgdGhpcyByYXRo
ZXIgdGhhbiBjaGVja2luZyBmb3IgUFgvSEcuCgpTaWduZWQtb2ZmLWJ5OiBBbGV4IERldWNoZXIg
PGFsZXhhbmRlci5kZXVjaGVyQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1LmggICAgIHwgIDMgKysrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZHJ2LmMgfCAgOSArKysrKystLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9rbXMuYyB8IDEzICsrKysrKysrLS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTcgaW5zZXJ0aW9u
cygrKSwgOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHUuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdS5oCmluZGV4
IDJiNDg4YWU5YTMyNC4uZjMyMWRjMjc1MWU0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHUuaApAQCAtOTY4LDYgKzk2OCw5IEBAIHN0cnVjdCBhbWRncHVfZGV2aWNlIHsKIAogCXVpbnQ2
NF90CQkJdW5pcXVlX2lkOwogCXVpbnQ2NF90CWRmX3BlcmZtb25fY29uZmlnX2Fzc2lnbl9tYXNr
W0FNREdQVV9NQVhfREZfUEVSRk1PTlNdOworCisJLyogZW5hYmxlIHJ1bnRpbWUgcG0gb24gdGhl
IGRldmljZSAqLworCWJvb2wgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVucG07CiB9Owog
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBhbWRncHVfZGV2aWNlICphbWRncHVfdHRtX2FkZXYoc3Ry
dWN0IHR0bV9ib19kZXZpY2UgKmJkZXYpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZHJ2LmMKaW5kZXggZGI4MmNlNGQ1ZGQ5Li4wM2NjOTRiZDQxMzIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKQEAgLTExNTMsOSArMTE1MywxMCBAQCBzdGF0aWMgaW50
IGFtZGdwdV9wbW9wc19ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2KQogewogCXN0
cnVjdCBwY2lfZGV2ICpwZGV2ID0gdG9fcGNpX2RldihkZXYpOwogCXN0cnVjdCBkcm1fZGV2aWNl
ICpkcm1fZGV2ID0gcGNpX2dldF9kcnZkYXRhKHBkZXYpOworCXN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2ID0gZHJtX2Rldi0+ZGV2X3ByaXZhdGU7CiAJaW50IHJldDsKIAotCWlmICghYW1kZ3B1
X2RldmljZV9zdXBwb3J0c19ib2NvKGRybV9kZXYpKSB7CisJaWYgKCFhZGV2LT5ydW5wbSkgewog
CQlwbV9ydW50aW1lX2ZvcmJpZChkZXYpOwogCQlyZXR1cm4gLUVCVVNZOwogCX0KQEAgLTExODUs
OSArMTE4NiwxMCBAQCBzdGF0aWMgaW50IGFtZGdwdV9wbW9wc19ydW50aW1lX3Jlc3VtZShzdHJ1
Y3QgZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSB0b19wY2lfZGV2KGRl
dik7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXYgPSBwY2lfZ2V0X2RydmRhdGEocGRldik7
CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBkcm1fZGV2LT5kZXZfcHJpdmF0ZTsKIAlp
bnQgcmV0OwogCi0JaWYgKCFhbWRncHVfZGV2aWNlX3N1cHBvcnRzX2JvY28oZHJtX2RldikpCisJ
aWYgKCFhZGV2LT5ydW5wbSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKIAlpZiAoYW1kZ3B1X2Rldmlj
ZV9zdXBwb3J0c19ib2NvKGRybV9kZXYpKQpAQCAtMTIxNSw5ICsxMjE3LDEwIEBAIHN0YXRpYyBp
bnQgYW1kZ3B1X3Btb3BzX3J1bnRpbWVfcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKIHN0YXRp
YyBpbnQgYW1kZ3B1X3Btb3BzX3J1bnRpbWVfaWRsZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRybV9kZXYtPmRldl9wcml2YXRlOwogCXN0cnVjdCBk
cm1fY3J0YyAqY3J0YzsKIAotCWlmICghYW1kZ3B1X2RldmljZV9zdXBwb3J0c19ib2NvKGRybV9k
ZXYpKSB7CisJaWYgKCFhZGV2LT5ydW5wbSkgewogCQlwbV9ydW50aW1lX2ZvcmJpZChkZXYpOwog
CQlyZXR1cm4gLUVCVVNZOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9rbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMu
YwppbmRleCBkMzA1MDY5ZWZjZmYuLmY5YjFlYmU4NzVmZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9rbXMuYwpAQCAtOTEsNyArOTEsNyBAQCB2b2lkIGFtZGdwdV9kcml2ZXJf
dW5sb2FkX2ttcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCWlmIChhbWRncHVfc3Jpb3ZfdmYo
YWRldikpCiAJCWFtZGdwdV92aXJ0X3JlcXVlc3RfZnVsbF9ncHUoYWRldiwgZmFsc2UpOwogCi0J
aWYgKGFtZGdwdV9kZXZpY2Vfc3VwcG9ydHNfYm9jbyhkZXYpKSB7CisJaWYgKGFkZXYtPnJ1bnBt
KSB7CiAJCXBtX3J1bnRpbWVfZ2V0X3N5bmMoZGV2LT5kZXYpOwogCQlwbV9ydW50aW1lX2ZvcmJp
ZChkZXYtPmRldik7CiAJfQpAQCAtMTg1LDE0ICsxODUsMTcgQEAgaW50IGFtZGdwdV9kcml2ZXJf
bG9hZF9rbXMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgbG9uZyBmbGFncykKIAl9
CiAJZGV2LT5kZXZfcHJpdmF0ZSA9ICh2b2lkICopYWRldjsKIAotCWlmICgoYW1kZ3B1X3J1bnRp
bWVfcG0gIT0gMCkgJiYKLQkgICAgYW1kZ3B1X2hhc19hdHB4KCkgJiYKKwlpZiAoYW1kZ3B1X2hh
c19hdHB4KCkgJiYKIAkgICAgKGFtZGdwdV9pc19hdHB4X2h5YnJpZCgpIHx8CiAJICAgICBhbWRn
cHVfaGFzX2F0cHhfZGdwdV9wb3dlcl9jbnRsKCkpICYmCiAJICAgICgoZmxhZ3MgJiBBTURfSVNf
QVBVKSA9PSAwKSAmJgogCSAgICAhcGNpX2lzX3RodW5kZXJib2x0X2F0dGFjaGVkKGRldi0+cGRl
dikpCiAJCWZsYWdzIHw9IEFNRF9JU19QWDsKIAorCWlmICgoYW1kZ3B1X3J1bnRpbWVfcG0gIT0g
MCkgJiYKKwkgICAgKGZsYWdzICYgQU1EX0lTX1BYKSkKKwkJYWRldi0+cnVucG0gPSB0cnVlOwor
CiAJLyogYW1kZ3B1X2RldmljZV9pbml0IHNob3VsZCByZXBvcnQgb25seSBmYXRhbCBlcnJvcgog
CSAqIGxpa2UgbWVtb3J5IGFsbG9jYXRpb24gZmFpbHVyZSBvciBpb21hcHBpbmcgZmFpbHVyZSwK
IAkgKiBvciBtZW1vcnkgbWFuYWdlciBpbml0aWFsaXphdGlvbiBmYWlsdXJlLCBpdCBtdXN0CkBA
IC0yMTUsNyArMjE4LDcgQEAgaW50IGFtZGdwdV9kcml2ZXJfbG9hZF9rbXMoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdW5zaWduZWQgbG9uZyBmbGFncykKIAkJCQkiRXJyb3IgZHVyaW5nIEFDUEkg
bWV0aG9kcyBjYWxsXG4iKTsKIAl9CiAKLQlpZiAoYW1kZ3B1X2RldmljZV9zdXBwb3J0c19ib2Nv
KGRldikpIHsKKwlpZiAoYWRldi0+cnVucG0pIHsKIAkJZGV2X3BtX3NldF9kcml2ZXJfZmxhZ3Mo
ZGV2LT5kZXYsIERQTV9GTEFHX05FVkVSX1NLSVApOwogCQlwbV9ydW50aW1lX3VzZV9hdXRvc3Vz
cGVuZChkZXYtPmRldik7CiAJCXBtX3J1bnRpbWVfc2V0X2F1dG9zdXNwZW5kX2RlbGF5KGRldi0+
ZGV2LCA1MDAwKTsKQEAgLTIyOSw3ICsyMzIsNyBAQCBpbnQgYW1kZ3B1X2RyaXZlcl9sb2FkX2tt
cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBsb25nIGZsYWdzKQogb3V0OgogCWlm
IChyKSB7CiAJCS8qIGJhbGFuY2UgcG1fcnVudGltZV9nZXRfc3luYyBpbiBhbWRncHVfZHJpdmVy
X3VubG9hZF9rbXMgKi8KLQkJaWYgKGFkZXYtPnJtbWlvICYmIGFtZGdwdV9kZXZpY2Vfc3VwcG9y
dHNfYm9jbyhkZXYpKQorCQlpZiAoYWRldi0+cm1taW8gJiYgYWRldi0+cnVucG0pCiAJCQlwbV9y
dW50aW1lX3B1dF9ub2lkbGUoZGV2LT5kZXYpOwogCQlhbWRncHVfZHJpdmVyX3VubG9hZF9rbXMo
ZGV2KTsKIAl9Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1k
LWdmeA==
