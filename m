Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E482569E13
	for <lists+amd-gfx@lfdr.de>; Mon, 15 Jul 2019 23:25:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E952F89E52;
	Mon, 15 Jul 2019 21:25:16 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qk1-x742.google.com (mail-qk1-x742.google.com
 [IPv6:2607:f8b0:4864:20::742])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 09CAC89E38
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 21:25:15 +0000 (UTC)
Received: by mail-qk1-x742.google.com with SMTP id s22so12850803qkj.12
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 14:25:14 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=0dfjBG1mYt2DoXyunuWs6wOzRBY3iZtzZCpyJKRmyc8=;
 b=GMyW0GfAtWbU/LW46edZ/hOUCGQxtMQGZgyEFMVWVKImSH1gsJrWGLi049ky2kKrz0
 xHVQlqAazqnxl0XR4wE+C+ePh9YPI5q8ysV79FQRHu+pMovl5wTkRxXJZl9JW5RGdYm+
 MEcc68+ZcbfpKLda7+0ZDY8zNq3kzqatFlp0GDfirZoRSl3O14t+o+5VRI5oAS3uW0xq
 42ZzNfVtwBx1alZP3qHI9iVxG197EnxnAoMQbW9WQv02EL9CgVLOtLzjt2DD8PbkR+xA
 hlRwTCLbY2EpdDNEzC+FBkBhI/MD9MSPg/rKs2NVhJnCroNKOjkMRHaAN94vMLjgk046
 XUDg==
X-Gm-Message-State: APjAAAUN1CquGZUbVtSXb5WIPmEfXpyZ6dKjRF7/BP7/zCPoOXcHgIM/
 8sKQcCn/83oFElHIf45ba59Cf1cV
X-Google-Smtp-Source: APXvYqxiKbOFUE4rzqw93YOcmpgdI8xskZ85MRSNDNDmFRqEU3pahecKXcAvhCeyWnZyxXhxQD4YKA==
X-Received: by 2002:a37:e30b:: with SMTP id y11mr19534739qki.100.1563225913302; 
 Mon, 15 Jul 2019 14:25:13 -0700 (PDT)
Received: from localhost.localdomain ([71.219.21.119])
 by smtp.gmail.com with ESMTPSA id q56sm10274133qtq.64.2019.07.15.14.25.12
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 15 Jul 2019 14:25:12 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 032/102] drm/amdgpu: optimize gfx9 init_microcode function
Date: Mon, 15 Jul 2019 16:23:27 -0500
Message-Id: <20190715212437.31793-30-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190715212437.31793-1-alexander.deucher@amd.com>
References: <20190715212437.31793-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=0dfjBG1mYt2DoXyunuWs6wOzRBY3iZtzZCpyJKRmyc8=;
 b=iJtWVILj90H+koXt7nfN4LG7nTFrhsnwcEU+WMbHxkl4sIJFBktgtFuNOQY4JcAZmr
 UDWOF+EjHY+oswUN5DfF3S5irx9fFLv/CmTjz1Wrzz9cvWDlrdOLSoFB7COXmjVqvmpn
 7yrXw/vBvvwZVxIS/grGX+TQvj5HQgD7cLPHQhOLFKagH2+R88ph9jtWc0GKfcm2C5V6
 CfCaX4S5+ytLxE8F3TKzMI8LKPkaKzI7VD25kEDav84cjqPgGUyaNK1W43zOolv9a8NL
 10HVqLjXqWsFmkmCGMZtV0g9vBIPRLCZV5Z8ntSb3BrA1kW6F1ipc+FPg6s00qc9NbG3
 vq5Q==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Le Ma <le.ma@amd.com>,
 Hawking Zhang <Hawking.Zhang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGUgTWEgPGxlLm1hQGFtZC5jb20+CgpTcGxpdCBlYWNoIHR5cGUgb2YgZmlybXdhcmUg
aW50byBzaW5nbGUgZnVuY3Rpb24gZm9yIGVhc3kgdG8gbWFpbnRhaW4uCgpTaWduZWQtb2ZmLWJ5
OiBMZSBNYSA8bGUubWFAYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IEhhd2tpbmcgWmhhbmcgPEhhd2tp
bmcuWmhhbmdAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogQWxleCBEZXVjaGVyIDxhbGV4YW5kZXIu
ZGV1Y2hlckBhbWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OV8w
LmMgfCAyNDcgKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxNTMg
aW5zZXJ0aW9ucygrKSwgOTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dm
eF92OV8wLmMKaW5kZXggZTBkYjBlY2MzMzRlLi5lZGQzMjI0NzIwZGQgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYwpAQCAtNjEzLDQ3ICs2MTMsMTQgQEAgc3RhdGljIHZvaWQg
Z2Z4X3Y5XzBfY2hlY2tfaWZfbmVlZF9nZnhvZmYoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYp
CiAJfQogfQogCi1zdGF0aWMgaW50IGdmeF92OV8wX2luaXRfbWljcm9jb2RlKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2KQorc3RhdGljIGludCBnZnhfdjlfMF9pbml0X2NwX2dmeF9taWNyb2Nv
ZGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJCQkJCSAgY29uc3QgY2hhciAqY2hpcF9u
YW1lKQogewotCWNvbnN0IGNoYXIgKmNoaXBfbmFtZTsKIAljaGFyIGZ3X25hbWVbMzBdOwogCWlu
dCBlcnI7CiAJc3RydWN0IGFtZGdwdV9maXJtd2FyZV9pbmZvICppbmZvID0gTlVMTDsKIAljb25z
dCBzdHJ1Y3QgY29tbW9uX2Zpcm13YXJlX2hlYWRlciAqaGVhZGVyID0gTlVMTDsKIAljb25zdCBz
dHJ1Y3QgZ2Z4X2Zpcm13YXJlX2hlYWRlcl92MV8wICpjcF9oZHI7Ci0JY29uc3Qgc3RydWN0IHJs
Y19maXJtd2FyZV9oZWFkZXJfdjJfMCAqcmxjX2hkcjsKLQl1bnNpZ25lZCBpbnQgKnRtcCA9IE5V
TEw7Ci0JdW5zaWduZWQgaW50IGkgPSAwOwotCXVpbnQxNl90IHZlcnNpb25fbWFqb3I7Ci0JdWlu
dDE2X3QgdmVyc2lvbl9taW5vcjsKLQl1aW50MzJfdCBzbXVfdmVyc2lvbjsKLQotCURSTV9ERUJV
RygiXG4iKTsKLQotCXN3aXRjaCAoYWRldi0+YXNpY190eXBlKSB7Ci0JY2FzZSBDSElQX1ZFR0Ex
MDoKLQkJY2hpcF9uYW1lID0gInZlZ2ExMCI7Ci0JCWJyZWFrOwotCWNhc2UgQ0hJUF9WRUdBMTI6
Ci0JCWNoaXBfbmFtZSA9ICJ2ZWdhMTIiOwotCQlicmVhazsKLQljYXNlIENISVBfVkVHQTIwOgot
CQljaGlwX25hbWUgPSAidmVnYTIwIjsKLQkJYnJlYWs7Ci0JY2FzZSBDSElQX1JBVkVOOgotCQlp
ZiAoYWRldi0+cmV2X2lkID49IDgpCi0JCQljaGlwX25hbWUgPSAicmF2ZW4yIjsKLQkJZWxzZSBp
ZiAoYWRldi0+cGRldi0+ZGV2aWNlID09IDB4MTVkOCkKLQkJCWNoaXBfbmFtZSA9ICJwaWNhc3Nv
IjsKLQkJZWxzZQotCQkJY2hpcF9uYW1lID0gInJhdmVuIjsKLQkJYnJlYWs7Ci0JY2FzZSBDSElQ
X0FSQ1RVUlVTOgotCQljaGlwX25hbWUgPSAiYXJjdHVydXMiOwotCQlicmVhazsKLQlkZWZhdWx0
OgotCQlCVUcoKTsKLQl9CiAKIAlzbnByaW50Zihmd19uYW1lLCBzaXplb2YoZndfbmFtZSksICJh
bWRncHUvJXNfcGZwLmJpbiIsIGNoaXBfbmFtZSk7CiAJZXJyID0gcmVxdWVzdF9maXJtd2FyZSgm
YWRldi0+Z2Z4LnBmcF9mdywgZndfbmFtZSwgYWRldi0+ZGV2KTsKQEAgLTY4OCw2ICs2NTUsNTgg
QEAgc3RhdGljIGludCBnZnhfdjlfMF9pbml0X21pY3JvY29kZShzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldikKIAlhZGV2LT5nZnguY2VfZndfdmVyc2lvbiA9IGxlMzJfdG9fY3B1KGNwX2hkci0+
aGVhZGVyLnVjb2RlX3ZlcnNpb24pOwogCWFkZXYtPmdmeC5jZV9mZWF0dXJlX3ZlcnNpb24gPSBs
ZTMyX3RvX2NwdShjcF9oZHItPnVjb2RlX2ZlYXR1cmVfdmVyc2lvbik7CiAKKwlpZiAoYWRldi0+
ZmlybXdhcmUubG9hZF90eXBlID09IEFNREdQVV9GV19MT0FEX1BTUCkgeworCQlpbmZvID0gJmFk
ZXYtPmZpcm13YXJlLnVjb2RlW0FNREdQVV9VQ09ERV9JRF9DUF9QRlBdOworCQlpbmZvLT51Y29k
ZV9pZCA9IEFNREdQVV9VQ09ERV9JRF9DUF9QRlA7CisJCWluZm8tPmZ3ID0gYWRldi0+Z2Z4LnBm
cF9mdzsKKwkJaGVhZGVyID0gKGNvbnN0IHN0cnVjdCBjb21tb25fZmlybXdhcmVfaGVhZGVyICop
aW5mby0+ZnctPmRhdGE7CisJCWFkZXYtPmZpcm13YXJlLmZ3X3NpemUgKz0KKwkJCUFMSUdOKGxl
MzJfdG9fY3B1KGhlYWRlci0+dWNvZGVfc2l6ZV9ieXRlcyksIFBBR0VfU0laRSk7CisKKwkJaW5m
byA9ICZhZGV2LT5maXJtd2FyZS51Y29kZVtBTURHUFVfVUNPREVfSURfQ1BfTUVdOworCQlpbmZv
LT51Y29kZV9pZCA9IEFNREdQVV9VQ09ERV9JRF9DUF9NRTsKKwkJaW5mby0+ZncgPSBhZGV2LT5n
ZngubWVfZnc7CisJCWhlYWRlciA9IChjb25zdCBzdHJ1Y3QgY29tbW9uX2Zpcm13YXJlX2hlYWRl
ciAqKWluZm8tPmZ3LT5kYXRhOworCQlhZGV2LT5maXJtd2FyZS5md19zaXplICs9CisJCQlBTElH
TihsZTMyX3RvX2NwdShoZWFkZXItPnVjb2RlX3NpemVfYnl0ZXMpLCBQQUdFX1NJWkUpOworCisJ
CWluZm8gPSAmYWRldi0+ZmlybXdhcmUudWNvZGVbQU1ER1BVX1VDT0RFX0lEX0NQX0NFXTsKKwkJ
aW5mby0+dWNvZGVfaWQgPSBBTURHUFVfVUNPREVfSURfQ1BfQ0U7CisJCWluZm8tPmZ3ID0gYWRl
di0+Z2Z4LmNlX2Z3OworCQloZWFkZXIgPSAoY29uc3Qgc3RydWN0IGNvbW1vbl9maXJtd2FyZV9o
ZWFkZXIgKilpbmZvLT5mdy0+ZGF0YTsKKwkJYWRldi0+ZmlybXdhcmUuZndfc2l6ZSArPQorCQkJ
QUxJR04obGUzMl90b19jcHUoaGVhZGVyLT51Y29kZV9zaXplX2J5dGVzKSwgUEFHRV9TSVpFKTsK
Kwl9CisKK291dDoKKwlpZiAoZXJyKSB7CisJCWRldl9lcnIoYWRldi0+ZGV2LAorCQkJImdmeDk6
IEZhaWxlZCB0byBsb2FkIGZpcm13YXJlIFwiJXNcIlxuIiwKKwkJCWZ3X25hbWUpOworCQlyZWxl
YXNlX2Zpcm13YXJlKGFkZXYtPmdmeC5wZnBfZncpOworCQlhZGV2LT5nZngucGZwX2Z3ID0gTlVM
TDsKKwkJcmVsZWFzZV9maXJtd2FyZShhZGV2LT5nZngubWVfZncpOworCQlhZGV2LT5nZngubWVf
ZncgPSBOVUxMOworCQlyZWxlYXNlX2Zpcm13YXJlKGFkZXYtPmdmeC5jZV9mdyk7CisJCWFkZXYt
PmdmeC5jZV9mdyA9IE5VTEw7CisJfQorCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgZ2Z4
X3Y5XzBfaW5pdF9ybGNfbWljcm9jb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJ
CQkgIGNvbnN0IGNoYXIgKmNoaXBfbmFtZSkKK3sKKwljaGFyIGZ3X25hbWVbMzBdOworCWludCBl
cnI7CisJc3RydWN0IGFtZGdwdV9maXJtd2FyZV9pbmZvICppbmZvID0gTlVMTDsKKwljb25zdCBz
dHJ1Y3QgY29tbW9uX2Zpcm13YXJlX2hlYWRlciAqaGVhZGVyID0gTlVMTDsKKwljb25zdCBzdHJ1
Y3QgcmxjX2Zpcm13YXJlX2hlYWRlcl92Ml8wICpybGNfaGRyOworCXVuc2lnbmVkIGludCAqdG1w
ID0gTlVMTDsKKwl1bnNpZ25lZCBpbnQgaSA9IDA7CisJdWludDE2X3QgdmVyc2lvbl9tYWpvcjsK
Kwl1aW50MTZfdCB2ZXJzaW9uX21pbm9yOworCXVpbnQzMl90IHNtdV92ZXJzaW9uOworCiAJLyoK
IAkgKiBGb3IgUGljYXNzbyAmJiBBTTQgU09DS0VUIGJvYXJkLCB3ZSB1c2UgcGljYXNzb19ybGNf
YW00LmJpbgogCSAqIGluc3RlYWQgb2YgcGljYXNzb19ybGMuYmluLgpAQCAtNzYyLDU3ICs3ODEs
NyBAQCBzdGF0aWMgaW50IGdmeF92OV8wX2luaXRfbWljcm9jb2RlKHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2KQogCWlmIChhZGV2LT5nZngucmxjLmlzX3JsY192Ml8xKQogCQlnZnhfdjlfMF9p
bml0X3JsY19leHRfbWljcm9jb2RlKGFkZXYpOwogCi0Jc25wcmludGYoZndfbmFtZSwgc2l6ZW9m
KGZ3X25hbWUpLCAiYW1kZ3B1LyVzX21lYy5iaW4iLCBjaGlwX25hbWUpOwotCWVyciA9IHJlcXVl
c3RfZmlybXdhcmUoJmFkZXYtPmdmeC5tZWNfZncsIGZ3X25hbWUsIGFkZXYtPmRldik7Ci0JaWYg
KGVycikKLQkJZ290byBvdXQ7Ci0JZXJyID0gYW1kZ3B1X3Vjb2RlX3ZhbGlkYXRlKGFkZXYtPmdm
eC5tZWNfZncpOwotCWlmIChlcnIpCi0JCWdvdG8gb3V0OwotCWNwX2hkciA9IChjb25zdCBzdHJ1
Y3QgZ2Z4X2Zpcm13YXJlX2hlYWRlcl92MV8wICopYWRldi0+Z2Z4Lm1lY19mdy0+ZGF0YTsKLQlh
ZGV2LT5nZngubWVjX2Z3X3ZlcnNpb24gPSBsZTMyX3RvX2NwdShjcF9oZHItPmhlYWRlci51Y29k
ZV92ZXJzaW9uKTsKLQlhZGV2LT5nZngubWVjX2ZlYXR1cmVfdmVyc2lvbiA9IGxlMzJfdG9fY3B1
KGNwX2hkci0+dWNvZGVfZmVhdHVyZV92ZXJzaW9uKTsKLQotCi0Jc25wcmludGYoZndfbmFtZSwg
c2l6ZW9mKGZ3X25hbWUpLCAiYW1kZ3B1LyVzX21lYzIuYmluIiwgY2hpcF9uYW1lKTsKLQllcnIg
PSByZXF1ZXN0X2Zpcm13YXJlKCZhZGV2LT5nZngubWVjMl9mdywgZndfbmFtZSwgYWRldi0+ZGV2
KTsKLQlpZiAoIWVycikgewotCQllcnIgPSBhbWRncHVfdWNvZGVfdmFsaWRhdGUoYWRldi0+Z2Z4
Lm1lYzJfZncpOwotCQlpZiAoZXJyKQotCQkJZ290byBvdXQ7Ci0JCWNwX2hkciA9IChjb25zdCBz
dHJ1Y3QgZ2Z4X2Zpcm13YXJlX2hlYWRlcl92MV8wICopCi0JCWFkZXYtPmdmeC5tZWMyX2Z3LT5k
YXRhOwotCQlhZGV2LT5nZngubWVjMl9md192ZXJzaW9uID0KLQkJbGUzMl90b19jcHUoY3BfaGRy
LT5oZWFkZXIudWNvZGVfdmVyc2lvbik7Ci0JCWFkZXYtPmdmeC5tZWMyX2ZlYXR1cmVfdmVyc2lv
biA9Ci0JCWxlMzJfdG9fY3B1KGNwX2hkci0+dWNvZGVfZmVhdHVyZV92ZXJzaW9uKTsKLQl9IGVs
c2UgewotCQllcnIgPSAwOwotCQlhZGV2LT5nZngubWVjMl9mdyA9IE5VTEw7Ci0JfQotCiAJaWYg
KGFkZXYtPmZpcm13YXJlLmxvYWRfdHlwZSA9PSBBTURHUFVfRldfTE9BRF9QU1ApIHsKLQkJaW5m
byA9ICZhZGV2LT5maXJtd2FyZS51Y29kZVtBTURHUFVfVUNPREVfSURfQ1BfUEZQXTsKLQkJaW5m
by0+dWNvZGVfaWQgPSBBTURHUFVfVUNPREVfSURfQ1BfUEZQOwotCQlpbmZvLT5mdyA9IGFkZXYt
PmdmeC5wZnBfZnc7Ci0JCWhlYWRlciA9IChjb25zdCBzdHJ1Y3QgY29tbW9uX2Zpcm13YXJlX2hl
YWRlciAqKWluZm8tPmZ3LT5kYXRhOwotCQlhZGV2LT5maXJtd2FyZS5md19zaXplICs9Ci0JCQlB
TElHTihsZTMyX3RvX2NwdShoZWFkZXItPnVjb2RlX3NpemVfYnl0ZXMpLCBQQUdFX1NJWkUpOwot
Ci0JCWluZm8gPSAmYWRldi0+ZmlybXdhcmUudWNvZGVbQU1ER1BVX1VDT0RFX0lEX0NQX01FXTsK
LQkJaW5mby0+dWNvZGVfaWQgPSBBTURHUFVfVUNPREVfSURfQ1BfTUU7Ci0JCWluZm8tPmZ3ID0g
YWRldi0+Z2Z4Lm1lX2Z3OwotCQloZWFkZXIgPSAoY29uc3Qgc3RydWN0IGNvbW1vbl9maXJtd2Fy
ZV9oZWFkZXIgKilpbmZvLT5mdy0+ZGF0YTsKLQkJYWRldi0+ZmlybXdhcmUuZndfc2l6ZSArPQot
CQkJQUxJR04obGUzMl90b19jcHUoaGVhZGVyLT51Y29kZV9zaXplX2J5dGVzKSwgUEFHRV9TSVpF
KTsKLQotCQlpbmZvID0gJmFkZXYtPmZpcm13YXJlLnVjb2RlW0FNREdQVV9VQ09ERV9JRF9DUF9D
RV07Ci0JCWluZm8tPnVjb2RlX2lkID0gQU1ER1BVX1VDT0RFX0lEX0NQX0NFOwotCQlpbmZvLT5m
dyA9IGFkZXYtPmdmeC5jZV9mdzsKLQkJaGVhZGVyID0gKGNvbnN0IHN0cnVjdCBjb21tb25fZmly
bXdhcmVfaGVhZGVyICopaW5mby0+ZnctPmRhdGE7Ci0JCWFkZXYtPmZpcm13YXJlLmZ3X3NpemUg
Kz0KLQkJCUFMSUdOKGxlMzJfdG9fY3B1KGhlYWRlci0+dWNvZGVfc2l6ZV9ieXRlcyksIFBBR0Vf
U0laRSk7Ci0KIAkJaW5mbyA9ICZhZGV2LT5maXJtd2FyZS51Y29kZVtBTURHUFVfVUNPREVfSURf
UkxDX0ddOwogCQlpbmZvLT51Y29kZV9pZCA9IEFNREdQVV9VQ09ERV9JRF9STENfRzsKIAkJaW5m
by0+ZncgPSBhZGV2LT5nZngucmxjX2Z3OwpAQCAtODQyLDcgKzgxMSw1OCBAQCBzdGF0aWMgaW50
IGdmeF92OV8wX2luaXRfbWljcm9jb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCQkJ
YWRldi0+ZmlybXdhcmUuZndfc2l6ZSArPQogCQkJCUFMSUdOKGFkZXYtPmdmeC5ybGMuc2F2ZV9y
ZXN0b3JlX2xpc3Rfc3JtX3NpemVfYnl0ZXMsIFBBR0VfU0laRSk7CiAJCX0KKwl9CisKK291dDoK
KwlpZiAoZXJyKSB7CisJCWRldl9lcnIoYWRldi0+ZGV2LAorCQkJImdmeDk6IEZhaWxlZCB0byBs
b2FkIGZpcm13YXJlIFwiJXNcIlxuIiwKKwkJCWZ3X25hbWUpOworCQlyZWxlYXNlX2Zpcm13YXJl
KGFkZXYtPmdmeC5ybGNfZncpOworCQlhZGV2LT5nZngucmxjX2Z3ID0gTlVMTDsKKwl9CisJcmV0
dXJuIGVycjsKK30KKworc3RhdGljIGludCBnZnhfdjlfMF9pbml0X2NwX2NvbXB1dGVfbWljcm9j
b2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJCQkgIGNvbnN0IGNoYXIgKmNoaXBf
bmFtZSkKK3sKKwljaGFyIGZ3X25hbWVbMzBdOworCWludCBlcnI7CisJc3RydWN0IGFtZGdwdV9m
aXJtd2FyZV9pbmZvICppbmZvID0gTlVMTDsKKwljb25zdCBzdHJ1Y3QgY29tbW9uX2Zpcm13YXJl
X2hlYWRlciAqaGVhZGVyID0gTlVMTDsKKwljb25zdCBzdHJ1Y3QgZ2Z4X2Zpcm13YXJlX2hlYWRl
cl92MV8wICpjcF9oZHI7CisKKwlzbnByaW50Zihmd19uYW1lLCBzaXplb2YoZndfbmFtZSksICJh
bWRncHUvJXNfbWVjLmJpbiIsIGNoaXBfbmFtZSk7CisJZXJyID0gcmVxdWVzdF9maXJtd2FyZSgm
YWRldi0+Z2Z4Lm1lY19mdywgZndfbmFtZSwgYWRldi0+ZGV2KTsKKwlpZiAoZXJyKQorCQlnb3Rv
IG91dDsKKwllcnIgPSBhbWRncHVfdWNvZGVfdmFsaWRhdGUoYWRldi0+Z2Z4Lm1lY19mdyk7CisJ
aWYgKGVycikKKwkJZ290byBvdXQ7CisJY3BfaGRyID0gKGNvbnN0IHN0cnVjdCBnZnhfZmlybXdh
cmVfaGVhZGVyX3YxXzAgKilhZGV2LT5nZngubWVjX2Z3LT5kYXRhOworCWFkZXYtPmdmeC5tZWNf
ZndfdmVyc2lvbiA9IGxlMzJfdG9fY3B1KGNwX2hkci0+aGVhZGVyLnVjb2RlX3ZlcnNpb24pOwor
CWFkZXYtPmdmeC5tZWNfZmVhdHVyZV92ZXJzaW9uID0gbGUzMl90b19jcHUoY3BfaGRyLT51Y29k
ZV9mZWF0dXJlX3ZlcnNpb24pOworCiAKKwlzbnByaW50Zihmd19uYW1lLCBzaXplb2YoZndfbmFt
ZSksICJhbWRncHUvJXNfbWVjMi5iaW4iLCBjaGlwX25hbWUpOworCWVyciA9IHJlcXVlc3RfZmly
bXdhcmUoJmFkZXYtPmdmeC5tZWMyX2Z3LCBmd19uYW1lLCBhZGV2LT5kZXYpOworCWlmICghZXJy
KSB7CisJCWVyciA9IGFtZGdwdV91Y29kZV92YWxpZGF0ZShhZGV2LT5nZngubWVjMl9mdyk7CisJ
CWlmIChlcnIpCisJCQlnb3RvIG91dDsKKwkJY3BfaGRyID0gKGNvbnN0IHN0cnVjdCBnZnhfZmly
bXdhcmVfaGVhZGVyX3YxXzAgKikKKwkJYWRldi0+Z2Z4Lm1lYzJfZnctPmRhdGE7CisJCWFkZXYt
PmdmeC5tZWMyX2Z3X3ZlcnNpb24gPQorCQlsZTMyX3RvX2NwdShjcF9oZHItPmhlYWRlci51Y29k
ZV92ZXJzaW9uKTsKKwkJYWRldi0+Z2Z4Lm1lYzJfZmVhdHVyZV92ZXJzaW9uID0KKwkJbGUzMl90
b19jcHUoY3BfaGRyLT51Y29kZV9mZWF0dXJlX3ZlcnNpb24pOworCX0gZWxzZSB7CisJCWVyciA9
IDA7CisJCWFkZXYtPmdmeC5tZWMyX2Z3ID0gTlVMTDsKKwl9CisKKwlpZiAoYWRldi0+ZmlybXdh
cmUubG9hZF90eXBlID09IEFNREdQVV9GV19MT0FEX1BTUCkgewogCQlpbmZvID0gJmFkZXYtPmZp
cm13YXJlLnVjb2RlW0FNREdQVV9VQ09ERV9JRF9DUF9NRUMxXTsKIAkJaW5mby0+dWNvZGVfaWQg
PSBBTURHUFVfVUNPREVfSURfQ1BfTUVDMTsKIAkJaW5mby0+ZncgPSBhZGV2LT5nZngubWVjX2Z3
OwpAQCAtODcxLDcgKzg5MSw2IEBAIHN0YXRpYyBpbnQgZ2Z4X3Y5XzBfaW5pdF9taWNyb2NvZGUo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCQlhZGV2LT5maXJtd2FyZS5md19zaXplICs9
CiAJCQkJQUxJR04obGUzMl90b19jcHUoY3BfaGRyLT5qdF9zaXplKSAqIDQsIFBBR0VfU0laRSk7
CiAJCX0KLQogCX0KIAogb3V0OgpAQCAtODgxLDE0ICs5MDAsNiBAQCBzdGF0aWMgaW50IGdmeF92
OV8wX2luaXRfbWljcm9jb2RlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCQlkZXZfZXJy
KGFkZXYtPmRldiwKIAkJCSJnZng5OiBGYWlsZWQgdG8gbG9hZCBmaXJtd2FyZSBcIiVzXCJcbiIs
CiAJCQlmd19uYW1lKTsKLQkJcmVsZWFzZV9maXJtd2FyZShhZGV2LT5nZngucGZwX2Z3KTsKLQkJ
YWRldi0+Z2Z4LnBmcF9mdyA9IE5VTEw7Ci0JCXJlbGVhc2VfZmlybXdhcmUoYWRldi0+Z2Z4Lm1l
X2Z3KTsKLQkJYWRldi0+Z2Z4Lm1lX2Z3ID0gTlVMTDsKLQkJcmVsZWFzZV9maXJtd2FyZShhZGV2
LT5nZnguY2VfZncpOwotCQlhZGV2LT5nZnguY2VfZncgPSBOVUxMOwotCQlyZWxlYXNlX2Zpcm13
YXJlKGFkZXYtPmdmeC5ybGNfZncpOwotCQlhZGV2LT5nZngucmxjX2Z3ID0gTlVMTDsKIAkJcmVs
ZWFzZV9maXJtd2FyZShhZGV2LT5nZngubWVjX2Z3KTsKIAkJYWRldi0+Z2Z4Lm1lY19mdyA9IE5V
TEw7CiAJCXJlbGVhc2VfZmlybXdhcmUoYWRldi0+Z2Z4Lm1lYzJfZncpOwpAQCAtODk3LDYgKzkw
OCw1NCBAQCBzdGF0aWMgaW50IGdmeF92OV8wX2luaXRfbWljcm9jb2RlKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2KQogCXJldHVybiBlcnI7CiB9CiAKK3N0YXRpYyBpbnQgZ2Z4X3Y5XzBfaW5p
dF9taWNyb2NvZGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCit7CisJY29uc3QgY2hhciAq
Y2hpcF9uYW1lOworCWludCByOworCisJRFJNX0RFQlVHKCJcbiIpOworCisJc3dpdGNoIChhZGV2
LT5hc2ljX3R5cGUpIHsKKwljYXNlIENISVBfVkVHQTEwOgorCQljaGlwX25hbWUgPSAidmVnYTEw
IjsKKwkJYnJlYWs7CisJY2FzZSBDSElQX1ZFR0ExMjoKKwkJY2hpcF9uYW1lID0gInZlZ2ExMiI7
CisJCWJyZWFrOworCWNhc2UgQ0hJUF9WRUdBMjA6CisJCWNoaXBfbmFtZSA9ICJ2ZWdhMjAiOwor
CQlicmVhazsKKwljYXNlIENISVBfUkFWRU46CisJCWlmIChhZGV2LT5yZXZfaWQgPj0gOCkKKwkJ
CWNoaXBfbmFtZSA9ICJyYXZlbjIiOworCQllbHNlIGlmIChhZGV2LT5wZGV2LT5kZXZpY2UgPT0g
MHgxNWQ4KQorCQkJY2hpcF9uYW1lID0gInBpY2Fzc28iOworCQllbHNlCisJCQljaGlwX25hbWUg
PSAicmF2ZW4iOworCQlicmVhazsKKwkJYnJlYWs7CisJY2FzZSBDSElQX0FSQ1RVUlVTOgorCQlj
aGlwX25hbWUgPSAiYXJjdHVydXMiOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlCVUcoKTsKKwl9
CisKKwlyID0gZ2Z4X3Y5XzBfaW5pdF9jcF9nZnhfbWljcm9jb2RlKGFkZXYsIGNoaXBfbmFtZSk7
CisJaWYgKHIpCisJCXJldHVybiByOworCisJciA9IGdmeF92OV8wX2luaXRfcmxjX21pY3JvY29k
ZShhZGV2LCBjaGlwX25hbWUpOworCWlmIChyKQorCQlyZXR1cm4gcjsKKworCXIgPSBnZnhfdjlf
MF9pbml0X2NwX2NvbXB1dGVfbWljcm9jb2RlKGFkZXYsIGNoaXBfbmFtZSk7CisJaWYgKHIpCisJ
CXJldHVybiByOworCisJcmV0dXJuIHI7Cit9CisKIHN0YXRpYyB1MzIgZ2Z4X3Y5XzBfZ2V0X2Nz
Yl9zaXplKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogewogCXUzMiBjb3VudCA9IDA7Ci0t
IAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
