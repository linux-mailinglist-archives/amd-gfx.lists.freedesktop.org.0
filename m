Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 47546DE258
	for <lists+amd-gfx@lfdr.de>; Mon, 21 Oct 2019 04:48:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 30C668991C;
	Mon, 21 Oct 2019 02:48:03 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM05-BY2-obe.outbound.protection.outlook.com
 (mail-eopbgr710084.outbound.protection.outlook.com [40.107.71.84])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 66BD68991C
 for <amd-gfx@lists.freedesktop.org>; Mon, 21 Oct 2019 02:47:56 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=eDFx7WMIP4vYp/BwIhXHov79vtV2+lcdEf+pPYz/VbZMibKI16Xj/QIEBYdfxKrNwQa4IRjv5Os0tajsn0XqyIU5YcZqKx9vKFenJZ3mKfl8pWgjvwpph+PmnePjLoFL3gu4Pl2uschh5TWT6mTmBiakMsTOqjfVoXLrMsXPdMjvG/rXJEJZwQPTh3pqPNKvfcnXv6/Xq2UWXQMrbgiqdT3u7evZ6p2XpF57UaAD/fc3BXLbB56D/hTRx+Ww+6EmAza2DdvYXEo/r28QHt99kZH6tyYcjCy3HtA0ELjLXGtPu9N8QPivMnxmM/U3P/oruzLUsKLN7VhSr9MdpRRHIQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=ZS7F9ryEruIQ6gshGnS/sjhghio/vAWk4c5h3io1qm0=;
 b=C64XeNH60TsxKl5OcI9SdSqYHNDxbCRjFghiBvMo5wrm31kBsSiAZ2QOpO9PL/OCI0Fm+u7qnWpsv3k5jibVP1AQg5qGZRwFO+sFL4AUGmxpSOBsn5uIHS4W1xetVM1t4tQgnUcT/bmwfWU9fiVmxFKxmCMbWEypzOMByDFTdB0qdhe2Oswj8ZyiVRhskrlGB6BRIeEAQnQoK60AFnwcXbhcxzTXdEkV7lxUpBIB8RyAPGCeONtcVxZFdfR5z7dEBcyj1Yfmo+HgqsX0hJFsb1tKzDoaxoYup7SAxPNvdF222oPLAAYVEDyhdZlxThVs8BGzx+6pei8blNJy0sRzhQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
Received: from MN2PR12MB3344.namprd12.prod.outlook.com (20.178.241.74) by
 MN2PR12MB3679.namprd12.prod.outlook.com (10.255.86.31) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2347.16; Mon, 21 Oct 2019 02:47:53 +0000
Received: from MN2PR12MB3344.namprd12.prod.outlook.com
 ([fe80::435:bdca:bac1:a26d]) by MN2PR12MB3344.namprd12.prod.outlook.com
 ([fe80::435:bdca:bac1:a26d%5]) with mapi id 15.20.2367.019; Mon, 21 Oct 2019
 02:47:53 +0000
From: "Quan, Evan" <Evan.Quan@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 1/3] drm/amd/powerplay: add lock protection for swSMU APIs V2
Thread-Topic: [PATCH 1/3] drm/amd/powerplay: add lock protection for swSMU
 APIs V2
Thread-Index: AQHVh7nvdVvHs/++skuD1dFOknI+LQ==
Date: Mon, 21 Oct 2019 02:47:53 +0000
Message-ID: <20191021024610.16569-1-evan.quan@amd.com>
Accept-Language: en-US, zh-CN
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: HK0PR01CA0020.apcprd01.prod.exchangelabs.com
 (2603:1096:203:92::32) To MN2PR12MB3344.namprd12.prod.outlook.com
 (2603:10b6:208:c5::10)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.23.0
x-originating-ip: [180.167.199.189]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: a4b97fcb-131b-4126-b490-08d755d11191
x-ms-office365-filtering-ht: Tenant
x-ms-traffictypediagnostic: MN2PR12MB3679:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <MN2PR12MB367952D5CF4A68AF41A7609AE4690@MN2PR12MB3679.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:3826;
x-forefront-prvs: 0197AFBD92
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(4636009)(396003)(346002)(366004)(376002)(136003)(39860400002)(199004)(189003)(4326008)(66946007)(5640700003)(6436002)(2351001)(5660300002)(25786009)(86362001)(26005)(14454004)(30864003)(66574012)(71200400001)(71190400001)(2501003)(6486002)(186003)(64756008)(66556008)(66446008)(66476007)(6512007)(6916009)(102836004)(6116002)(81156014)(81166006)(3846002)(2906002)(316002)(52116002)(305945005)(66066001)(8676002)(8936002)(7736002)(256004)(14444005)(478600001)(1076003)(36756003)(486006)(386003)(6506007)(99286004)(476003)(2616005)(54906003)(50226002)(579004)(559001)(569006);
 DIR:OUT; SFP:1101; SCL:1; SRVR:MN2PR12MB3679;
 H:MN2PR12MB3344.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: 70aeW8b1TJxAfine3Ik//lj7LDWTiEO+6OlLokTflMpdw2KH6xMRfqDF2e9qH8riy6pxcD/J3AaPnpqDarGPeRRDBaBbbYW2NYdbFvcpStRS+V9/ViwTHUs2Pwb8bANBcNVBvjtnmretpbG1XIHwVgO1Xbaji0zYhz0bR+aRaz5GFeYaWatrKDrF6MNxCZR5MNopeAGELNmkciYfjjQLaH2GzgD8kWx5WogJrqgafwmhWUJhLnc5v54TCOd/4NfazuI+OqadTS1XWxxG4+y4z5/hyda29HuIIxa+3mwZyd261PjyvtDZO5FEVm98aqgT4OoWd7s4KEz/xGuaX8N4LTqJ/mc5zd73mgEq10RRqoyf5yULEH72Fx0JTAtzUFGMoWwE/bSrAVwkSxPK2saECRPcEnOS9pXGBBXdFrlitEs=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: a4b97fcb-131b-4126-b490-08d755d11191
X-MS-Exchange-CrossTenant-originalarrivaltime: 21 Oct 2019 02:47:53.4088 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: T+9pnoDUilZhLyMgCDbNcVJy6oVWxB8YyuUwXNXOUV0QFXoYYEVIDw+D0EgnyEKf
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MN2PR12MB3679
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=ZS7F9ryEruIQ6gshGnS/sjhghio/vAWk4c5h3io1qm0=;
 b=SUAy7cFLD8fRwlUfxG3w8NwF/MKMUMUWZWYeSs3gQdT81IoIVdKik4vBkEwVU5Vmxrrc9onNIeAqHnX6meqKkNiySjcx6i9SJdcT5+KIzrXrklWToxjQCRUdFPWJYdwb7EkkKDctmMQFQxnfmjQFVfSGiR1+mRCOiFj2kR9MkJA=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Evan.Quan@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Deucher, Alexander" <Alexander.Deucher@amd.com>, "Grodzovsky,
 Andrey" <Andrey.Grodzovsky@amd.com>, "Quan, Evan" <Evan.Quan@amd.com>, "Xu, 
 Feifei" <Feifei.Xu@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhpcyBpcyBhIHF1aWNrIGFuZCBsb3cgcmlzayBmaXguIFRob3NlIEFQSXMgd2hpY2gKYXJlIGV4
cG9zZWQgdG8gb3RoZXIgSVBzIG9yIHRvIHN1cHBvcnQgc3lzZnMvaHdtb24KaW50ZXJmYWNlcyBv
ciBEQUwgd2lsbCBoYXZlIGxvY2sgcHJvdGVjdGlvbi4gTWVhbndoaWxlCm5vIGxvY2sgcHJvdGVj
dGlvbiBpcyBlbmZvcmNlZCBmb3Igc3dTTVUgaW50ZXJuYWwgdXNlZApBUElzLiBGdXR1cmUgb3B0
aW1pemF0aW9uIGlzIG5lZWRlZC4KClYyOiBzdHJpcCB0aGUgbG9jayBwcm90ZWN0aW9uIGZvciBh
bGwgc3dTTVUgaW50ZXJuYWwgQVBJcwoKQ2hhbmdlLUlkOiBJODM5MjY1MmM5ZGExNTc0YTg1YWNk
OWIxNzFmMDQzODBmMzYzMDg1MgpTaWduZWQtb2ZmLWJ5OiBFdmFuIFF1YW4gPGV2YW4ucXVhbkBh
bWQuY29tPgpBY2tlZC1ieTogQW5kcmV5IEdyb2R6b3Zza3kgPGFuZHJleS5ncm9kem92c2t5QGFt
ZC5jb20+CkFja2VkLWJ5OiBGZWlmZWkgWHUgPEZlaWZlaS5YdUBhbWQuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcG0uYyAgICAgICB8ICAgNiArLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RwbS5oICAgICAgIHwgICA2IC0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wbS5jICAgICAgICB8ICAyMyArLQogLi4uL2FtZC9k
aXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG1fcHBfc211LmMgIHwgICA0ICstCiBkcml2ZXJzL2dw
dS9kcm0vYW1kL3Bvd2VycGxheS9hbWRncHVfc211LmMgICAgfCA2OTYgKysrKysrKysrKysrKysr
Ky0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9hcmN0dXJ1c19wcHQuYyAgfCAgIDMg
LQogLi4uL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9pbmMvYW1kZ3B1X3NtdS5oICAgIHwgMTYzICsr
LS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L25hdmkxMF9wcHQuYyAgICB8ICAxNSAr
LQogZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvcmVub2lyX3BwdC5jICAgIHwgIDE0ICst
CiBkcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9zbXVfdjExXzAuYyAgICAgfCAgMjIgKy0K
IGRyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTJfMC5jICAgICB8ICAgMyAtCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS92ZWdhMjBfcHB0LmMgICAgfCAgMjAgKy0KIDEy
IGZpbGVzIGNoYW5nZWQsIDc3NyBpbnNlcnRpb25zKCspLCAxOTggZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RwbS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RwbS5jCmluZGV4IDI2MzI2NTI0NWUxOS4uMjhk
MzI3MjUyODViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZHBtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RwbS5jCkBAIC05
MTIsNyArOTEyLDggQEAgaW50IGFtZGdwdV9kcG1fZ2V0X3NjbGsoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsIGJvb2wgbG93KQogCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkgewogCQly
ZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKCZhZGV2LT5zbXUsIFNNVV9HRlhDTEssCiAJCQkJ
CSAgICAgbG93ID8gJmNsa19mcmVxIDogTlVMTCwKLQkJCQkJICAgICAhbG93ID8gJmNsa19mcmVx
IDogTlVMTCk7CisJCQkJCSAgICAgIWxvdyA/ICZjbGtfZnJlcSA6IE5VTEwsCisJCQkJCSAgICAg
dHJ1ZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gMDsKIAkJcmV0dXJuIGNsa19mcmVxICogMTAw
OwpAQCAtOTMwLDcgKzkzMSw4IEBAIGludCBhbWRncHVfZHBtX2dldF9tY2xrKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LCBib29sIGxvdykKIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikp
IHsKIAkJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZSgmYWRldi0+c211LCBTTVVfVUNMSywK
IAkJCQkJICAgICBsb3cgPyAmY2xrX2ZyZXEgOiBOVUxMLAotCQkJCQkgICAgICFsb3cgPyAmY2xr
X2ZyZXEgOiBOVUxMKTsKKwkJCQkJICAgICAhbG93ID8gJmNsa19mcmVxIDogTlVMTCwKKwkJCQkJ
ICAgICB0cnVlKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiAwOwogCQlyZXR1cm4gY2xrX2ZyZXEg
KiAxMDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHBt
LmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHBtLmgKaW5kZXggMWM1YzBm
ZDc2ZGJmLi4yY2ZiNjc3MjcyYWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZHBtLmgKQEAgLTI5OCwxMiArMjk4LDYgQEAgZW51bSBhbWRncHVfcGNpZV9nZW4gewogI2RlZmlu
ZSBhbWRncHVfZHBtX2dldF9jdXJyZW50X3Bvd2VyX3N0YXRlKGFkZXYpIFwKIAkJKChhZGV2KS0+
cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfY3VycmVudF9wb3dlcl9zdGF0ZSgoYWRldiktPnBvd2Vy
cGxheS5wcF9oYW5kbGUpKQogCi0jZGVmaW5lIGFtZGdwdV9zbXVfZ2V0X2N1cnJlbnRfcG93ZXJf
c3RhdGUoYWRldikgXAotCQkoKGFkZXYpLT5zbXUucHB0X2Z1bmNzLT5nZXRfY3VycmVudF9wb3dl
cl9zdGF0ZSgmKChhZGV2KS0+c211KSkpCi0KLSNkZWZpbmUgYW1kZ3B1X3NtdV9zZXRfcG93ZXJf
c3RhdGUoYWRldikgXAotCQkoKGFkZXYpLT5zbXUucHB0X2Z1bmNzLT5zZXRfcG93ZXJfc3RhdGUo
JigoYWRldiktPnNtdSkpKQotCiAjZGVmaW5lIGFtZGdwdV9kcG1fZ2V0X3BwX251bV9zdGF0ZXMo
YWRldiwgZGF0YSkgXAogCQkoKGFkZXYpLT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9wcF9udW1f
c3RhdGVzKChhZGV2KS0+cG93ZXJwbGF5LnBwX2hhbmRsZSwgZGF0YSkpCiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wbS5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3BtLmMKaW5kZXggYzUwZDVmMWU3NWU1Li4zNmYzNmIzNTAwMGQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9wbS5jCkBAIC0yMTEsNyArMjExLDcg
QEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2dldF9kcG1fc3RhdGUoc3RydWN0IGRldmljZSAqZGV2
LAogCiAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKSB7CiAJCWlmIChhZGV2LT5zbXUucHB0
X2Z1bmNzLT5nZXRfY3VycmVudF9wb3dlcl9zdGF0ZSkKLQkJCXBtID0gYW1kZ3B1X3NtdV9nZXRf
Y3VycmVudF9wb3dlcl9zdGF0ZShhZGV2KTsKKwkJCXBtID0gc211X2dldF9jdXJyZW50X3Bvd2Vy
X3N0YXRlKCZhZGV2LT5zbXUpOwogCQllbHNlCiAJCQlwbSA9IGFkZXYtPnBtLmRwbS51c2VyX3N0
YXRlOwogCX0gZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5nZXRfY3VycmVudF9w
b3dlcl9zdGF0ZSkgewpAQCAtOTU3LDcgKzk1Nyw3IEBAIHN0YXRpYyBzc2l6ZV90IGFtZGdwdV9z
ZXRfcHBfZHBtX3NjbGsoc3RydWN0IGRldmljZSAqZGV2LAogCQlyZXR1cm4gcmV0OwogCiAJaWYg
KGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQotCQlyZXQgPSBzbXVfZm9yY2VfY2xrX2xldmVscygm
YWRldi0+c211LCBTTVVfU0NMSywgbWFzayk7CisJCXJldCA9IHNtdV9mb3JjZV9jbGtfbGV2ZWxz
KCZhZGV2LT5zbXUsIFNNVV9TQ0xLLCBtYXNrLCB0cnVlKTsKIAllbHNlIGlmIChhZGV2LT5wb3dl
cnBsYXkucHBfZnVuY3MtPmZvcmNlX2Nsb2NrX2xldmVsKQogCQlyZXQgPSBhbWRncHVfZHBtX2Zv
cmNlX2Nsb2NrX2xldmVsKGFkZXYsIFBQX1NDTEssIG1hc2spOwogCkBAIC0xMDA0LDcgKzEwMDQs
NyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9tY2xrKHN0cnVjdCBkZXZpY2Ug
KmRldiwKIAkJcmV0dXJuIHJldDsKIAogCWlmIChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKLQkJ
cmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX01DTEssIG1hc2spOwor
CQlyZXQgPSBzbXVfZm9yY2VfY2xrX2xldmVscygmYWRldi0+c211LCBTTVVfTUNMSywgbWFzaywg
dHJ1ZSk7CiAJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5mb3JjZV9jbG9ja19s
ZXZlbCkKIAkJcmV0ID0gYW1kZ3B1X2RwbV9mb3JjZV9jbG9ja19sZXZlbChhZGV2LCBQUF9NQ0xL
LCBtYXNrKTsKIApAQCAtMTA0NCw3ICsxMDQ0LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3Nl
dF9wcF9kcG1fc29jY2xrKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJcmV0dXJuIHJldDsKIAogCWlm
IChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKLQkJcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMo
JmFkZXYtPnNtdSwgU01VX1NPQ0NMSywgbWFzayk7CisJCXJldCA9IHNtdV9mb3JjZV9jbGtfbGV2
ZWxzKCZhZGV2LT5zbXUsIFNNVV9TT0NDTEssIG1hc2ssIHRydWUpOwogCWVsc2UgaWYgKGFkZXYt
PnBvd2VycGxheS5wcF9mdW5jcy0+Zm9yY2VfY2xvY2tfbGV2ZWwpCiAJCXJldCA9IGFtZGdwdV9k
cG1fZm9yY2VfY2xvY2tfbGV2ZWwoYWRldiwgUFBfU09DQ0xLLCBtYXNrKTsKIApAQCAtMTA4NCw3
ICsxMDg0LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X3NldF9wcF9kcG1fZmNsayhzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCiAJCXJldHVybiByZXQ7CiAKIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRl
dikpCi0JCXJldCA9IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9GQ0xLLCBt
YXNrKTsKKwkJcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwgU01VX0ZDTEss
IG1hc2ssIHRydWUpOwogCWVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Zm9yY2Vf
Y2xvY2tfbGV2ZWwpCiAJCXJldCA9IGFtZGdwdV9kcG1fZm9yY2VfY2xvY2tfbGV2ZWwoYWRldiwg
UFBfRkNMSywgbWFzayk7CiAKQEAgLTExMjQsNyArMTEyNCw3IEBAIHN0YXRpYyBzc2l6ZV90IGFt
ZGdwdV9zZXRfcHBfZHBtX2RjZWZjbGsoc3RydWN0IGRldmljZSAqZGV2LAogCQlyZXR1cm4gcmV0
OwogCiAJaWYgKGlzX3N1cHBvcnRfc3dfc211KGFkZXYpKQotCQlyZXQgPSBzbXVfZm9yY2VfY2xr
X2xldmVscygmYWRldi0+c211LCBTTVVfRENFRkNMSywgbWFzayk7CisJCXJldCA9IHNtdV9mb3Jj
ZV9jbGtfbGV2ZWxzKCZhZGV2LT5zbXUsIFNNVV9EQ0VGQ0xLLCBtYXNrLCB0cnVlKTsKIAllbHNl
IGlmIChhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmZvcmNlX2Nsb2NrX2xldmVsKQogCQlyZXQg
PSBhbWRncHVfZHBtX2ZvcmNlX2Nsb2NrX2xldmVsKGFkZXYsIFBQX0RDRUZDTEssIG1hc2spOwog
CkBAIC0xMTY0LDcgKzExNjQsNyBAQCBzdGF0aWMgc3NpemVfdCBhbWRncHVfc2V0X3BwX2RwbV9w
Y2llKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJcmV0dXJuIHJldDsKIAogCWlmIChpc19zdXBwb3J0
X3N3X3NtdShhZGV2KSkKLQkJcmV0ID0gc211X2ZvcmNlX2Nsa19sZXZlbHMoJmFkZXYtPnNtdSwg
U01VX1BDSUUsIG1hc2spOworCQlyZXQgPSBzbXVfZm9yY2VfY2xrX2xldmVscygmYWRldi0+c211
LCBTTVVfUENJRSwgbWFzaywgdHJ1ZSk7CiAJZWxzZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1
bmNzLT5mb3JjZV9jbG9ja19sZXZlbCkKIAkJcmV0ID0gYW1kZ3B1X2RwbV9mb3JjZV9jbG9ja19s
ZXZlbChhZGV2LCBQUF9QQ0lFLCBtYXNrKTsKIApAQCAtMTM1Niw3ICsxMzU2LDcgQEAgc3RhdGlj
IHNzaXplX3QgYW1kZ3B1X3NldF9wcF9wb3dlcl9wcm9maWxlX21vZGUoc3RydWN0IGRldmljZSAq
ZGV2LAogCX0KIAlwYXJhbWV0ZXJbcGFyYW1ldGVyX3NpemVdID0gcHJvZmlsZV9tb2RlOwogCWlm
IChpc19zdXBwb3J0X3N3X3NtdShhZGV2KSkKLQkJcmV0ID0gc211X3NldF9wb3dlcl9wcm9maWxl
X21vZGUoJmFkZXYtPnNtdSwgcGFyYW1ldGVyLCBwYXJhbWV0ZXJfc2l6ZSk7CisJCXJldCA9IHNt
dV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKCZhZGV2LT5zbXUsIHBhcmFtZXRlciwgcGFyYW1ldGVy
X3NpemUsIHRydWUpOwogCWVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+c2V0X3Bv
d2VyX3Byb2ZpbGVfbW9kZSkKIAkJcmV0ID0gYW1kZ3B1X2RwbV9zZXRfcG93ZXJfcHJvZmlsZV9t
b2RlKGFkZXYsIHBhcmFtZXRlciwgcGFyYW1ldGVyX3NpemUpOwogCWlmICghcmV0KQpAQCAtMjA2
NSw3ICsyMDY1LDcgQEAgc3RhdGljIHNzaXplX3QgYW1kZ3B1X2h3bW9uX3Nob3dfcG93ZXJfY2Fw
X21heChzdHJ1Y3QgZGV2aWNlICpkZXYsCiAJdWludDMyX3QgbGltaXQgPSAwOwogCiAJaWYgKGlz
X3N1cHBvcnRfc3dfc211KGFkZXYpKSB7Ci0JCXNtdV9nZXRfcG93ZXJfbGltaXQoJmFkZXYtPnNt
dSwgJmxpbWl0LCB0cnVlKTsKKwkJc211X2dldF9wb3dlcl9saW1pdCgmYWRldi0+c211LCAmbGlt
aXQsIHRydWUsIHRydWUpOwogCQlyZXR1cm4gc25wcmludGYoYnVmLCBQQUdFX1NJWkUsICIldVxu
IiwgbGltaXQgKiAxMDAwMDAwKTsKIAl9IGVsc2UgaWYgKGFkZXYtPnBvd2VycGxheS5wcF9mdW5j
cyAmJiBhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9wb3dlcl9saW1pdCkgewogCQlhZGV2
LT5wb3dlcnBsYXkucHBfZnVuY3MtPmdldF9wb3dlcl9saW1pdChhZGV2LT5wb3dlcnBsYXkucHBf
aGFuZGxlLCAmbGltaXQsIHRydWUpOwpAQCAtMjA4Myw3ICsyMDgzLDcgQEAgc3RhdGljIHNzaXpl
X3QgYW1kZ3B1X2h3bW9uX3Nob3dfcG93ZXJfY2FwKHN0cnVjdCBkZXZpY2UgKmRldiwKIAl1aW50
MzJfdCBsaW1pdCA9IDA7CiAKIAlpZiAoaXNfc3VwcG9ydF9zd19zbXUoYWRldikpIHsKLQkJc211
X2dldF9wb3dlcl9saW1pdCgmYWRldi0+c211LCAmbGltaXQsIGZhbHNlKTsKKwkJc211X2dldF9w
b3dlcl9saW1pdCgmYWRldi0+c211LCAmbGltaXQsIGZhbHNlLCAgdHJ1ZSk7CiAJCXJldHVybiBz
bnByaW50ZihidWYsIFBBR0VfU0laRSwgIiV1XG4iLCBsaW1pdCAqIDEwMDAwMDApOwogCX0gZWxz
ZSBpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzICYmIGFkZXYtPnBvd2VycGxheS5wcF9mdW5j
cy0+Z2V0X3Bvd2VyX2xpbWl0KSB7CiAJCWFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+Z2V0X3Bv
d2VyX2xpbWl0KGFkZXYtPnBvd2VycGxheS5wcF9oYW5kbGUsICZsaW1pdCwgZmFsc2UpOwpAQCAt
MzA2NCw3ICszMDY0LDggQEAgdm9pZCBhbWRncHVfcG1fY29tcHV0ZV9jbG9ja3Moc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYpCiAJCXN0cnVjdCBzbXVfZHBtX2NvbnRleHQgKnNtdV9kcG0gPSAm
YWRldi0+c211LnNtdV9kcG07CiAJCXNtdV9oYW5kbGVfdGFzaygmYWRldi0+c211LAogCQkJCXNt
dV9kcG0tPmRwbV9sZXZlbCwKLQkJCQlBTURfUFBfVEFTS19ESVNQTEFZX0NPTkZJR19DSEFOR0Up
OworCQkJCUFNRF9QUF9UQVNLX0RJU1BMQVlfQ09ORklHX0NIQU5HRSwKKwkJCQl0cnVlKTsKIAl9
IGVsc2UgewogCQlpZiAoYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNzLT5kaXNwYXRjaF90YXNrcykg
ewogCQkJaWYgKCFhbWRncHVfZGV2aWNlX2hhc19kY19zdXBwb3J0KGFkZXYpKSB7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbV9wcF9z
bXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX3Bw
X3NtdS5jCmluZGV4IDEzNTIwMTk2NDhjMC4uZWU5OTE1ZDYxY2YxIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbV9wcF9zbXUuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbV9wcF9zbXUu
YwpAQCAtODc2LDcgKzg3Niw3IEBAIGVudW0gcHBfc211X3N0YXR1cyBwcF9udl9nZXRfbWF4aW11
bV9zdXN0YWluYWJsZV9jbG9ja3MoCiAJaWYgKCFzbXUtPmZ1bmNzLT5nZXRfbWF4X3N1c3RhaW5h
YmxlX2Nsb2Nrc19ieV9kYykKIAkJcmV0dXJuIFBQX1NNVV9SRVNVTFRfVU5TVVBQT1JURUQ7CiAK
LQlpZiAoIXNtdS0+ZnVuY3MtPmdldF9tYXhfc3VzdGFpbmFibGVfY2xvY2tzX2J5X2RjKHNtdSwg
bWF4X2Nsb2NrcykpCisJaWYgKCFzbXVfZ2V0X21heF9zdXN0YWluYWJsZV9jbG9ja3NfYnlfZGMo
c211LCBtYXhfY2xvY2tzKSkKIAkJcmV0dXJuIFBQX1NNVV9SRVNVTFRfT0s7CiAKIAlyZXR1cm4g
UFBfU01VX1JFU1VMVF9GQUlMOwpAQCAtODk1LDcgKzg5NSw3IEBAIGVudW0gcHBfc211X3N0YXR1
cyBwcF9udl9nZXRfdWNsa19kcG1fc3RhdGVzKHN0cnVjdCBwcF9zbXUgKnBwLAogCWlmICghc211
LT5wcHRfZnVuY3MtPmdldF91Y2xrX2RwbV9zdGF0ZXMpCiAJCXJldHVybiBQUF9TTVVfUkVTVUxU
X1VOU1VQUE9SVEVEOwogCi0JaWYgKCFzbXUtPnBwdF9mdW5jcy0+Z2V0X3VjbGtfZHBtX3N0YXRl
cyhzbXUsCisJaWYgKCFzbXVfZ2V0X3VjbGtfZHBtX3N0YXRlcyhzbXUsCiAJCQljbG9ja192YWx1
ZXNfaW5fa2h6LCBudW1fc3RhdGVzKSkKIAkJcmV0dXJuIFBQX1NNVV9SRVNVTFRfT0s7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2FtZGdwdV9zbXUuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2FtZGdwdV9zbXUuYwppbmRleCAyNmNhY2M4OTlk
ZmUuLjA4NDFkOGM3OWU1YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBs
YXkvYW1kZ3B1X3NtdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2FtZGdw
dV9zbXUuYwpAQCAtNjcsNiArNjcsOCBAQCBzaXplX3Qgc211X3N5c19nZXRfcHBfZmVhdHVyZV9t
YXNrKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBjaGFyICpidWYpCiAJdWludDMyX3Qgc29ydF9m
ZWF0dXJlW1NNVV9GRUFUVVJFX0NPVU5UXTsKIAl1aW50NjRfdCBod19mZWF0dXJlX2NvdW50ID0g
MDsKIAorCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCiAJcmV0ID0gc211X2ZlYXR1cmVfZ2V0
X2VuYWJsZWRfbWFzayhzbXUsIGZlYXR1cmVfbWFzaywgMik7CiAJaWYgKHJldCkKIAkJZ290byBm
YWlsZWQ7CkBAIC05Miw2ICs5NCw4IEBAIHNpemVfdCBzbXVfc3lzX2dldF9wcF9mZWF0dXJlX21h
c2soc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGNoYXIgKmJ1ZikKIAl9CiAKIGZhaWxlZDoKKwlt
dXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCiAJcmV0dXJuIHNpemU7CiB9CiAKQEAgLTE0OSw5
ICsxNTMsMTEgQEAgaW50IHNtdV9zeXNfc2V0X3BwX2ZlYXR1cmVfbWFzayhzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwgdWludDY0X3QgbmV3X21hc2spCiAJdWludDY0X3QgZmVhdHVyZV8yX2Rpc2Fi
bGVkID0gMDsKIAl1aW50NjRfdCBmZWF0dXJlX2VuYWJsZXMgPSAwOwogCisJbXV0ZXhfbG9jaygm
c211LT5tdXRleCk7CisKIAlyZXQgPSBzbXVfZmVhdHVyZV9nZXRfZW5hYmxlZF9tYXNrKHNtdSwg
ZmVhdHVyZV9tYXNrLCAyKTsKIAlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCQlnb3RvIG91dDsK
IAogCWZlYXR1cmVfZW5hYmxlcyA9ICgodWludDY0X3QpZmVhdHVyZV9tYXNrWzFdIDw8IDMyIHwg
KHVpbnQ2NF90KWZlYXR1cmVfbWFza1swXSk7CiAKQEAgLTE2MSwxNCArMTY3LDE3IEBAIGludCBz
bXVfc3lzX3NldF9wcF9mZWF0dXJlX21hc2soc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQ2
NF90IG5ld19tYXNrKQogCWlmIChmZWF0dXJlXzJfZW5hYmxlZCkgewogCQlyZXQgPSBzbXVfZmVh
dHVyZV91cGRhdGVfZW5hYmxlX3N0YXRlKHNtdSwgZmVhdHVyZV8yX2VuYWJsZWQsIHRydWUpOwog
CQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKKwkJCWdvdG8gb3V0OwogCX0KIAlpZiAoZmVhdHVy
ZV8yX2Rpc2FibGVkKSB7CiAJCXJldCA9IHNtdV9mZWF0dXJlX3VwZGF0ZV9lbmFibGVfc3RhdGUo
c211LCBmZWF0dXJlXzJfZGlzYWJsZWQsIGZhbHNlKTsKIAkJaWYgKHJldCkKLQkJCXJldHVybiBy
ZXQ7CisJCQlnb3RvIG91dDsKIAl9CiAKK291dDoKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgp
OworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMjU0LDcgKzI2Myw3IEBAIGludCBzbXVfc2V0X2hh
cmRfZnJlcV9yYW5nZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgZW51bSBzbXVfY2xrX3R5cGUg
Y2xrX3R5cGUsCiB9CiAKIGludCBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHN0cnVjdCBzbXVfY29u
dGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlwZSwKLQkJCSAgIHVpbnQzMl90ICpt
aW4sIHVpbnQzMl90ICptYXgpCisJCQkgICB1aW50MzJfdCAqbWluLCB1aW50MzJfdCAqbWF4LCBi
b29sIGxvY2tfbmVlZGVkKQogewogCXVpbnQzMl90IGNsb2NrX2xpbWl0OwogCWludCByZXQgPSAw
OwpAQCAtMjYyLDYgKzI3MSw5IEBAIGludCBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHN0cnVjdCBz
bXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlwZSwKIAlpZiAoIW1pbiAm
JiAhbWF4KQogCQlyZXR1cm4gLUVJTlZBTDsKIAorCWlmIChsb2NrX25lZWRlZCkKKwkJbXV0ZXhf
bG9jaygmc211LT5tdXRleCk7CisKIAlpZiAoIXNtdV9jbGtfZHBtX2lzX2VuYWJsZWQoc211LCBj
bGtfdHlwZSkpIHsKIAkJc3dpdGNoIChjbGtfdHlwZSkgewogCQljYXNlIFNNVV9NQ0xLOgpAQCAt
Mjg1LDE0ICsyOTcsMTcgQEAgaW50IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc3RydWN0IHNtdV9j
b250ZXh0ICpzbXUsIGVudW0gc211X2Nsa190eXBlIGNsa190eXBlLAogCQkJKm1pbiA9IGNsb2Nr
X2xpbWl0IC8gMTAwOwogCQlpZiAobWF4KQogCQkJKm1heCA9IGNsb2NrX2xpbWl0IC8gMTAwOwot
Ci0JCXJldHVybiAwOworCX0gZWxzZSB7CisJCS8qCisJCSAqIFRvZG86IFVzZSBlYWNoIGFzaWMo
QVNJQ19wcHQgZnVuY3MpIGNvbnRyb2wgdGhlIGNhbGxiYWNrcyBleHBvc2VkIHRvIHRoZQorCQkg
KiBjb3JlIGRyaXZlciBhbmQgdGhlbiBoYXZlIGhlbHBlcnMgZm9yIHN0dWZmIHRoYXQgaXMgY29t
bW9uKFNNVV92MTFfeCB8IFNNVV92MTJfeCBmdW5jcykuCisJCSAqLworCQlyZXQgPSBzbXVfZ2V0
X2RwbV91bHRpbWF0ZV9mcmVxKHNtdSwgY2xrX3R5cGUsIG1pbiwgbWF4KTsKIAl9Ci0JLyoKLQkg
KiBUb2RvOiBVc2UgZWFjaCBhc2ljKEFTSUNfcHB0IGZ1bmNzKSBjb250cm9sIHRoZSBjYWxsYmFj
a3MgZXhwb3NlZCB0byB0aGUKLQkgKiBjb3JlIGRyaXZlciBhbmQgdGhlbiBoYXZlIGhlbHBlcnMg
Zm9yIHN0dWZmIHRoYXQgaXMgY29tbW9uKFNNVV92MTFfeCB8IFNNVV92MTJfeCBmdW5jcykuCi0J
ICovCi0JcmV0ID0gc211X2dldF9kcG1fdWx0aW1hdGVfZnJlcShzbXUsIGNsa190eXBlLCBtaW4s
IG1heCk7CisKKwlpZiAobG9ja19uZWVkZWQpCisJCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7
CisKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0zNjksNiArMzg0LDggQEAgaW50IHNtdV9kcG1fc2V0
X3Bvd2VyX2dhdGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQzMl90IGJsb2NrX3R5cGUs
CiB7CiAJaW50IHJldCA9IDA7CiAKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKwogCXN3aXRj
aCAoYmxvY2tfdHlwZSkgewogCWNhc2UgQU1EX0lQX0JMT0NLX1RZUEVfVVZEOgogCQlyZXQgPSBz
bXVfZHBtX3NldF91dmRfZW5hYmxlKHNtdSwgZ2F0ZSk7CkBAIC0zODYsMTMgKzQwMyw5IEBAIGlu
dCBzbXVfZHBtX3NldF9wb3dlcl9nYXRlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB1aW50MzJf
dCBibG9ja190eXBlLAogCQlicmVhazsKIAl9CiAKLQlyZXR1cm4gcmV0OwotfQorCW11dGV4X3Vu
bG9jaygmc211LT5tdXRleCk7CiAKLWVudW0gYW1kX3BtX3N0YXRlX3R5cGUgc211X2dldF9jdXJy
ZW50X3Bvd2VyX3N0YXRlKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQotewotCS8qIG5vdCBzdXBw
b3J0IHBvd2VyIHN0YXRlICovCi0JcmV0dXJuIFBPV0VSX1NUQVRFX1RZUEVfREVGQVVMVDsKKwly
ZXR1cm4gcmV0OwogfQogCiBpbnQgc211X2dldF9wb3dlcl9udW1fc3RhdGVzKHN0cnVjdCBzbXVf
Y29udGV4dCAqc211LApAQCAtNTIwLDE2ICs1MzMsMjMgQEAgYm9vbCBpc19zdXBwb3J0X3N3X3Nt
dV94Z21pKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogaW50IHNtdV9zeXNfZ2V0X3BwX3Rh
YmxlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB2b2lkICoqdGFibGUpCiB7CiAJc3RydWN0IHNt
dV90YWJsZV9jb250ZXh0ICpzbXVfdGFibGUgPSAmc211LT5zbXVfdGFibGU7CisJdWludDMyX3Qg
cG93ZXJwbGF5X3RhYmxlX3NpemU7CiAKIAlpZiAoIXNtdV90YWJsZS0+cG93ZXJfcGxheV90YWJs
ZSAmJiAhc211X3RhYmxlLT5oYXJkY29kZV9wcHRhYmxlKQogCQlyZXR1cm4gLUVJTlZBTDsKIAor
CW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCiAJaWYgKHNtdV90YWJsZS0+aGFyZGNvZGVfcHB0
YWJsZSkKIAkJKnRhYmxlID0gc211X3RhYmxlLT5oYXJkY29kZV9wcHRhYmxlOwogCWVsc2UKIAkJ
KnRhYmxlID0gc211X3RhYmxlLT5wb3dlcl9wbGF5X3RhYmxlOwogCi0JcmV0dXJuIHNtdV90YWJs
ZS0+cG93ZXJfcGxheV90YWJsZV9zaXplOworCXBvd2VycGxheV90YWJsZV9zaXplID0gc211X3Rh
YmxlLT5wb3dlcl9wbGF5X3RhYmxlX3NpemU7CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgp
OworCisJcmV0dXJuIHBvd2VycGxheV90YWJsZV9zaXplOwogfQogCiBpbnQgc211X3N5c19zZXRf
cHBfdGFibGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsICB2b2lkICpidWYsIHNpemVfdCBzaXpl
KQpAQCAtNTU2LDE0ICs1NzYsMTEgQEAgaW50IHNtdV9zeXNfc2V0X3BwX3RhYmxlKHN0cnVjdCBz
bXVfY29udGV4dCAqc211LCAgdm9pZCAqYnVmLCBzaXplX3Qgc2l6ZSkKIAltZW1jcHkoc211X3Rh
YmxlLT5oYXJkY29kZV9wcHRhYmxlLCBidWYsIHNpemUpOwogCXNtdV90YWJsZS0+cG93ZXJfcGxh
eV90YWJsZSA9IHNtdV90YWJsZS0+aGFyZGNvZGVfcHB0YWJsZTsKIAlzbXVfdGFibGUtPnBvd2Vy
X3BsYXlfdGFibGVfc2l6ZSA9IHNpemU7Ci0JbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKIAog
CXJldCA9IHNtdV9yZXNldChzbXUpOwogCWlmIChyZXQpCiAJCXByX2luZm8oInNtdSByZXNldCBm
YWlsZWQsIHJldCA9ICVkXG4iLCByZXQpOwogCi0JcmV0dXJuIHJldDsKLQogZmFpbGVkOgogCW11
dGV4X3VubG9jaygmc211LT5tdXRleCk7CiAJcmV0dXJuIHJldDsKQEAgLTcyNiwxMSArNzQzLDEw
IEBAIHN0YXRpYyBpbnQgc211X2xhdGVfaW5pdCh2b2lkICpoYW5kbGUpCiAJaWYgKCFzbXUtPnBt
X2VuYWJsZWQpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CiAJc211
X2hhbmRsZV90YXNrKCZhZGV2LT5zbXUsCiAJCQlzbXUtPnNtdV9kcG0uZHBtX2xldmVsLAotCQkJ
QU1EX1BQX1RBU0tfQ09NUExFVEVfSU5JVCk7Ci0JbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsK
KwkJCUFNRF9QUF9UQVNLX0NPTVBMRVRFX0lOSVQsCisJCQlmYWxzZSk7CiAKIAlyZXR1cm4gMDsK
IH0KQEAgLTEwNzQsNyArMTA5MCw3IEBAIHN0YXRpYyBpbnQgc211X3NtY190YWJsZV9od19pbml0
KHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAot
CQlyZXQgPSBzbXVfZ2V0X3Bvd2VyX2xpbWl0KHNtdSwgJnNtdS0+ZGVmYXVsdF9wb3dlcl9saW1p
dCwgdHJ1ZSk7CisJCXJldCA9IHNtdV9nZXRfcG93ZXJfbGltaXQoc211LCAmc211LT5kZWZhdWx0
X3Bvd2VyX2xpbWl0LCB0cnVlLCBmYWxzZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0Owog
CX0KQEAgLTExNjAsMTUgKzExNzYsMTkgQEAgc3RhdGljIGludCBzbXVfc3RhcnRfc21jX2VuZ2lu
ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKIAogCWlmIChhZGV2LT5maXJtd2FyZS5sb2FkX3R5
cGUgIT0gQU1ER1BVX0ZXX0xPQURfUFNQKSB7CiAJCWlmIChhZGV2LT5hc2ljX3R5cGUgPCBDSElQ
X05BVkkxMCkgewotCQkJcmV0ID0gc211X2xvYWRfbWljcm9jb2RlKHNtdSk7Ci0JCQlpZiAocmV0
KQotCQkJCXJldHVybiByZXQ7CisJCQlpZiAoc211LT5mdW5jcy0+bG9hZF9taWNyb2NvZGUpIHsK
KwkJCQlyZXQgPSBzbXUtPmZ1bmNzLT5sb2FkX21pY3JvY29kZShzbXUpOworCQkJCWlmIChyZXQp
CisJCQkJCXJldHVybiByZXQ7CisJCQl9CiAJCX0KIAl9CiAKLQlyZXQgPSBzbXVfY2hlY2tfZndf
c3RhdHVzKHNtdSk7Ci0JaWYgKHJldCkKLQkJcHJfZXJyKCJTTUMgaXMgbm90IHJlYWR5XG4iKTsK
KwlpZiAoc211LT5mdW5jcy0+Y2hlY2tfZndfc3RhdHVzKSB7CisJCXJldCA9IHNtdS0+ZnVuY3Mt
PmNoZWNrX2Z3X3N0YXR1cyhzbXUpOworCQlpZiAocmV0KQorCQkJcHJfZXJyKCJTTUMgaXMgbm90
IHJlYWR5XG4iKTsKKwl9CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtMTMzNCw4ICsxMzU0LDYgQEAg
c3RhdGljIGludCBzbXVfcmVzdW1lKHZvaWQgKmhhbmRsZSkKIAogCXByX2luZm8oIlNNVSBpcyBy
ZXN1bWluZy4uLlxuIik7CiAKLQltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKLQogCXJldCA9IHNt
dV9zdGFydF9zbWNfZW5naW5lKHNtdSk7CiAJaWYgKHJldCkgewogCQlwcl9lcnIoIlNNVSBpcyBu
b3QgcmVhZHkgeWV0IVxuIik7CkBAIC0xMzUwLDEzICsxMzY4LDExIEBAIHN0YXRpYyBpbnQgc211
X3Jlc3VtZSh2b2lkICpoYW5kbGUpCiAJaWYgKHJldCkKIAkJZ290byBmYWlsZWQ7CiAKLQltdXRl
eF91bmxvY2soJnNtdS0+bXV0ZXgpOwotCiAJcHJfaW5mbygiU01VIGlzIHJlc3VtZWQgc3VjY2Vz
c2Z1bGx5IVxuIik7CiAKIAlyZXR1cm4gMDsKKwogZmFpbGVkOgotCW11dGV4X3VubG9jaygmc211
LT5tdXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTM3NCw4ICsxMzkwLDkgQEAgaW50IHNt
dV9kaXNwbGF5X2NvbmZpZ3VyYXRpb25fY2hhbmdlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAog
CiAJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CiAKLQlzbXVfc2V0X2RlZXBfc2xlZXBfZGNlZmNs
ayhzbXUsCi0JCQkJICAgZGlzcGxheV9jb25maWctPm1pbl9kY2VmX2RlZXBfc2xlZXBfc2V0X2Ns
ayAvIDEwMCk7CisJaWYgKHNtdS0+ZnVuY3MtPnNldF9kZWVwX3NsZWVwX2RjZWZjbGspCisJCXNt
dS0+ZnVuY3MtPnNldF9kZWVwX3NsZWVwX2RjZWZjbGsoc211LAorCQkJCWRpc3BsYXlfY29uZmln
LT5taW5fZGNlZl9kZWVwX3NsZWVwX3NldF9jbGsgLyAxMDApOwogCiAJZm9yIChpbmRleCA9IDA7
IGluZGV4IDwgZGlzcGxheV9jb25maWctPm51bV9wYXRoX2luY2x1ZGluZ19ub25fZGlzcGxheTsg
aW5kZXgrKykgewogCQlpZiAoZGlzcGxheV9jb25maWctPmRpc3BsYXlzW2luZGV4XS5jb250cm9s
bGVyX2lkICE9IDApCkBAIC0xNTUzLDkgKzE1NzAsOSBAQCBzdGF0aWMgaW50IHNtdV9kZWZhdWx0
X3NldF9wZXJmb3JtYW5jZV9sZXZlbChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgZW51bSBhbWRf
ZAogCQkJCQkJICZzb2NfbWFzayk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwotCQlzbXVf
Zm9yY2VfY2xrX2xldmVscyhzbXUsIFNNVV9TQ0xLLCAxIDw8IHNjbGtfbWFzayk7Ci0JCXNtdV9m
b3JjZV9jbGtfbGV2ZWxzKHNtdSwgU01VX01DTEssIDEgPDwgbWNsa19tYXNrKTsKLQkJc211X2Zv
cmNlX2Nsa19sZXZlbHMoc211LCBTTVVfU09DQ0xLLCAxIDw8IHNvY19tYXNrKTsKKwkJc211X2Zv
cmNlX2Nsa19sZXZlbHMoc211LCBTTVVfU0NMSywgMSA8PCBzY2xrX21hc2ssIGZhbHNlKTsKKwkJ
c211X2ZvcmNlX2Nsa19sZXZlbHMoc211LCBTTVVfTUNMSywgMSA8PCBtY2xrX21hc2ssIGZhbHNl
KTsKKwkJc211X2ZvcmNlX2Nsa19sZXZlbHMoc211LCBTTVVfU09DQ0xLLCAxIDw8IHNvY19tYXNr
LCBmYWxzZSk7CiAJCWJyZWFrOwogCWNhc2UgQU1EX0RQTV9GT1JDRURfTEVWRUxfTUFOVUFMOgog
CWNhc2UgQU1EX0RQTV9GT1JDRURfTEVWRUxfUFJPRklMRV9FWElUOgpAQCAtMTYxOSw3ICsxNjM2
LDcgQEAgaW50IHNtdV9hZGp1c3RfcG93ZXJfc3RhdGVfZHluYW1pYyhzdHJ1Y3Qgc211X2NvbnRl
eHQgKnNtdSwKIAkJd29ya2xvYWQgPSBzbXUtPndvcmtsb2FkX3NldHRpbmdbaW5kZXhdOwogCiAJ
CWlmIChzbXUtPnBvd2VyX3Byb2ZpbGVfbW9kZSAhPSB3b3JrbG9hZCkKLQkJCXNtdV9zZXRfcG93
ZXJfcHJvZmlsZV9tb2RlKHNtdSwgJndvcmtsb2FkLCAwKTsKKwkJCXNtdV9zZXRfcG93ZXJfcHJv
ZmlsZV9tb2RlKHNtdSwgJndvcmtsb2FkLCAwLCBmYWxzZSk7CiAJfQogCiAJcmV0dXJuIHJldDsK
QEAgLTE2MjcsMTggKzE2NDQsMjIgQEAgaW50IHNtdV9hZGp1c3RfcG93ZXJfc3RhdGVfZHluYW1p
YyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAogaW50IHNtdV9oYW5kbGVfdGFzayhzdHJ1Y3Qg
c211X2NvbnRleHQgKnNtdSwKIAkJICAgIGVudW0gYW1kX2RwbV9mb3JjZWRfbGV2ZWwgbGV2ZWws
Ci0JCSAgICBlbnVtIGFtZF9wcF90YXNrIHRhc2tfaWQpCisJCSAgICBlbnVtIGFtZF9wcF90YXNr
IHRhc2tfaWQsCisJCSAgICBib29sIGxvY2tfbmVlZGVkKQogewogCWludCByZXQgPSAwOwogCisJ
aWYgKGxvY2tfbmVlZGVkKQorCQltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKwogCXN3aXRjaCAo
dGFza19pZCkgewogCWNhc2UgQU1EX1BQX1RBU0tfRElTUExBWV9DT05GSUdfQ0hBTkdFOgogCQly
ZXQgPSBzbXVfcHJlX2Rpc3BsYXlfY29uZmlnX2NoYW5nZWQoc211KTsKIAkJaWYgKHJldCkKLQkJ
CXJldHVybiByZXQ7CisJCQlnb3RvIG91dDsKIAkJcmV0ID0gc211X3NldF9jcHVfcG93ZXJfc3Rh
dGUoc211KTsKIAkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7CisJCQlnb3RvIG91dDsKIAkJcmV0
ID0gc211X2FkanVzdF9wb3dlcl9zdGF0ZV9keW5hbWljKHNtdSwgbGV2ZWwsIGZhbHNlKTsKIAkJ
YnJlYWs7CiAJY2FzZSBBTURfUFBfVEFTS19DT01QTEVURV9JTklUOgpAQCAtMTY0OSw2ICsxNjcw
LDEwIEBAIGludCBzbXVfaGFuZGxlX3Rhc2soc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJCWJy
ZWFrOwogCX0KIAorb3V0OgorCWlmIChsb2NrX25lZWRlZCkKKwkJbXV0ZXhfdW5sb2NrKCZzbXUt
Pm11dGV4KTsKKwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTE2ODEsNyArMTcwNiw3IEBAIGludCBz
bXVfc3dpdGNoX3Bvd2VyX3Byb2ZpbGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJfQogCiAJ
aWYgKHNtdV9kcG1fY3R4LT5kcG1fbGV2ZWwgIT0gQU1EX0RQTV9GT1JDRURfTEVWRUxfTUFOVUFM
KQotCQlzbXVfc2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZShzbXUsICZ3b3JrbG9hZCwgMCk7CisJCXNt
dV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHNtdSwgJndvcmtsb2FkLCAwLCBmYWxzZSk7CiAKIAlt
dXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOwogCkBAIC0xNzExLDEyICsxNzM2LDE5IEBAIGludCBz
bXVfZm9yY2VfcGVyZm9ybWFuY2VfbGV2ZWwoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGVudW0g
YW1kX2RwbV9mb3JjZWRfbGV2CiAJaWYgKCFzbXUtPmlzX2FwdSAmJiAhc211X2RwbV9jdHgtPmRw
bV9jb250ZXh0KQogCQlyZXR1cm4gLUVJTlZBTDsKIAorCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgp
OworCiAJcmV0ID0gc211X2VuYWJsZV91bWRfcHN0YXRlKHNtdSwgJmxldmVsKTsKLQlpZiAocmV0
KQorCWlmIChyZXQpIHsKKwkJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKIAkJcmV0dXJuIHJl
dDsKKwl9CiAKIAlyZXQgPSBzbXVfaGFuZGxlX3Rhc2soc211LCBsZXZlbCwKLQkJCSAgICAgIEFN
RF9QUF9UQVNLX1JFQURKVVNUX1BPV0VSX1NUQVRFKTsKKwkJCSAgICAgIEFNRF9QUF9UQVNLX1JF
QURKVVNUX1BPV0VSX1NUQVRFLAorCQkJICAgICAgZmFsc2UpOworCisJbXV0ZXhfdW5sb2NrKCZz
bXUtPm11dGV4KTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC0xNzM0LDcgKzE3NjYsOCBAQCBpbnQg
c211X3NldF9kaXNwbGF5X2NvdW50KHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB1aW50MzJfdCBj
b3VudCkKIAogaW50IHNtdV9mb3JjZV9jbGtfbGV2ZWxzKHN0cnVjdCBzbXVfY29udGV4dCAqc211
LAogCQkJIGVudW0gc211X2Nsa190eXBlIGNsa190eXBlLAotCQkJIHVpbnQzMl90IG1hc2spCisJ
CQkgdWludDMyX3QgbWFzaywKKwkJCSBib29sIGxvY2tfbmVlZGVkKQogewogCXN0cnVjdCBzbXVf
ZHBtX2NvbnRleHQgKnNtdV9kcG1fY3R4ID0gJihzbXUtPnNtdV9kcG0pOwogCWludCByZXQgPSAw
OwpAQCAtMTc0NCw5ICsxNzc3LDE1IEBAIGludCBzbXVfZm9yY2VfY2xrX2xldmVscyhzdHJ1Y3Qg
c211X2NvbnRleHQgKnNtdSwKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCisJaWYgKGxvY2tfbmVl
ZGVkKQorCQltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKwogCWlmIChzbXUtPnBwdF9mdW5jcyAm
JiBzbXUtPnBwdF9mdW5jcy0+Zm9yY2VfY2xrX2xldmVscykKIAkJcmV0ID0gc211LT5wcHRfZnVu
Y3MtPmZvcmNlX2Nsa19sZXZlbHMoc211LCBjbGtfdHlwZSwgbWFzayk7CiAKKwlpZiAobG9ja19u
ZWVkZWQpCisJCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKIAlyZXR1cm4gcmV0OwogfQog
CkBAIC0xNzY0LDYgKzE4MDMsOCBAQCBpbnQgc211X3NldF9tcDFfc3RhdGUoc3RydWN0IHNtdV9j
b250ZXh0ICpzbXUsCiAJaWYgKCFzbXUtPnBtX2VuYWJsZWQpCiAJCXJldHVybiAwOwogCisJbXV0
ZXhfbG9jaygmc211LT5tdXRleCk7CisKIAlzd2l0Y2ggKG1wMV9zdGF0ZSkgewogCWNhc2UgUFBf
TVAxX1NUQVRFX1NIVVRET1dOOgogCQltc2cgPSBTTVVfTVNHX1ByZXBhcmVNcDFGb3JTaHV0ZG93
bjsKQEAgLTE3NzYsMTcgKzE4MTcsMjIgQEAgaW50IHNtdV9zZXRfbXAxX3N0YXRlKHN0cnVjdCBz
bXVfY29udGV4dCAqc211LAogCQlicmVhazsKIAljYXNlIFBQX01QMV9TVEFURV9OT05FOgogCWRl
ZmF1bHQ6CisJCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CiAJCXJldHVybiAwOwogCX0KIAog
CS8qIHNvbWUgYXNpY3MgbWF5IG5vdCBzdXBwb3J0IHRob3NlIG1lc3NhZ2VzICovCi0JaWYgKHNt
dV9tc2dfZ2V0X2luZGV4KHNtdSwgbXNnKSA8IDApCisJaWYgKHNtdV9tc2dfZ2V0X2luZGV4KHNt
dSwgbXNnKSA8IDApIHsKKwkJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKIAkJcmV0dXJuIDA7
CisJfQogCiAJcmV0ID0gc211X3NlbmRfc21jX21zZyhzbXUsIG1zZyk7CiAJaWYgKHJldCkKIAkJ
cHJfZXJyKCJbUHJlcGFyZU1wMV0gRmFpbGVkIVxuIik7CiAKKwltdXRleF91bmxvY2soJnNtdS0+
bXV0ZXgpOworCiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTgwNiwxMCArMTg1MiwxNCBAQCBpbnQg
c211X3NldF9kZl9jc3RhdGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJaWYgKCFzbXUtPnBw
dF9mdW5jcyB8fCAhc211LT5wcHRfZnVuY3MtPnNldF9kZl9jc3RhdGUpCiAJCXJldHVybiAwOwog
CisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKIAlyZXQgPSBzbXUtPnBwdF9mdW5jcy0+c2V0
X2RmX2NzdGF0ZShzbXUsIHN0YXRlKTsKIAlpZiAocmV0KQogCQlwcl9lcnIoIltTZXREZkNzdGF0
ZV0gZmFpbGVkIVxuIik7CiAKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCiAJcmV0dXJu
IHJldDsKIH0KIApAQCAtMTg0OSwzICsxODk5LDU0OSBAQCBjb25zdCBzdHJ1Y3QgYW1kZ3B1X2lw
X2Jsb2NrX3ZlcnNpb24gc211X3YxMl8wX2lwX2Jsb2NrID0KIAkucmV2ID0gMCwKIAkuZnVuY3Mg
PSAmc211X2lwX2Z1bmNzLAogfTsKKworaW50IHNtdV9sb2FkX21pY3JvY29kZShzdHJ1Y3Qgc211
X2NvbnRleHQgKnNtdSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0
ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPmxvYWRfbWljcm9jb2RlKQorCQlyZXQgPSBzbXUtPmZ1
bmNzLT5sb2FkX21pY3JvY29kZShzbXUpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsK
KworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfY2hlY2tfZndfc3RhdHVzKHN0cnVjdCBzbXVf
Y29udGV4dCAqc211KQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRl
eCk7CisKKwlpZiAoc211LT5mdW5jcy0+Y2hlY2tfZndfc3RhdHVzKQorCQlyZXQgPSBzbXUtPmZ1
bmNzLT5jaGVja19md19zdGF0dXMoc211KTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7
CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X3NldF9nZnhfY2dwZyhzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwgYm9vbCBlbmFibGVkKQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9j
aygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5mdW5jcy0+c2V0X2dmeF9jZ3BnKQorCQlyZXQg
PSBzbXUtPmZ1bmNzLT5zZXRfZ2Z4X2NncGcoc211LCBlbmFibGVkKTsKKworCW11dGV4X3VubG9j
aygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X3NldF9mYW5fc3Bl
ZWRfcnBtKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB1aW50MzJfdCBzcGVlZCkKK3sKKwlpbnQg
cmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3Mt
PnNldF9mYW5fc3BlZWRfcnBtKQorCQlyZXQgPSBzbXUtPmZ1bmNzLT5zZXRfZmFuX3NwZWVkX3Jw
bShzbXUsIHNwZWVkKTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4g
cmV0OworfQorCitpbnQgc211X2dldF9wb3dlcl9saW1pdChzdHJ1Y3Qgc211X2NvbnRleHQgKnNt
dSwKKwkJCXVpbnQzMl90ICpsaW1pdCwKKwkJCWJvb2wgZGVmLAorCQkJYm9vbCBsb2NrX25lZWRl
ZCkKK3sKKwlpbnQgcmV0ID0gMDsKKworCWlmIChsb2NrX25lZWRlZCkKKwkJbXV0ZXhfbG9jaygm
c211LT5tdXRleCk7CisKKwlpZiAoc211LT5wcHRfZnVuY3MtPmdldF9wb3dlcl9saW1pdCkKKwkJ
cmV0ID0gc211LT5wcHRfZnVuY3MtPmdldF9wb3dlcl9saW1pdChzbXUsIGxpbWl0LCBkZWYpOwor
CisJaWYgKGxvY2tfbmVlZGVkKQorCQltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0
dXJuIHJldDsKK30KKworaW50IHNtdV9zZXRfcG93ZXJfbGltaXQoc3RydWN0IHNtdV9jb250ZXh0
ICpzbXUsIHVpbnQzMl90IGxpbWl0KQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygm
c211LT5tdXRleCk7CisKKwlpZiAoc211LT5mdW5jcy0+c2V0X3Bvd2VyX2xpbWl0KQorCQlyZXQg
PSBzbXUtPmZ1bmNzLT5zZXRfcG93ZXJfbGltaXQoc211LCBsaW1pdCk7CisKKwltdXRleF91bmxv
Y2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9wcmludF9jbGtf
bGV2ZWxzKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlw
ZSwgY2hhciAqYnVmKQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRl
eCk7CisKKwlpZiAoc211LT5wcHRfZnVuY3MtPnByaW50X2Nsa19sZXZlbHMpCisJCXJldCA9IHNt
dS0+cHB0X2Z1bmNzLT5wcmludF9jbGtfbGV2ZWxzKHNtdSwgY2xrX3R5cGUsIGJ1Zik7CisKKwlt
dXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9n
ZXRfb2RfcGVyY2VudGFnZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgZW51bSBzbXVfY2xrX3R5
cGUgdHlwZSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOwor
CisJaWYgKHNtdS0+cHB0X2Z1bmNzLT5nZXRfb2RfcGVyY2VudGFnZSkKKwkJcmV0ID0gc211LT5w
cHRfZnVuY3MtPmdldF9vZF9wZXJjZW50YWdlKHNtdSwgdHlwZSk7CisKKwltdXRleF91bmxvY2so
JnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9zZXRfb2RfcGVyY2Vu
dGFnZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgZW51bSBzbXVfY2xrX3R5cGUgdHlwZSwgdWlu
dDMyX3QgdmFsdWUpCit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4
KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+c2V0X29kX3BlcmNlbnRhZ2UpCisJCXJldCA9IHNt
dS0+cHB0X2Z1bmNzLT5zZXRfb2RfcGVyY2VudGFnZShzbXUsIHR5cGUsIHZhbHVlKTsKKworCW11
dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X29k
X2VkaXRfZHBtX3RhYmxlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJICBlbnVtIFBQX09E
X0RQTV9UQUJMRV9DT01NQU5EIHR5cGUsCisJCQkgIGxvbmcgKmlucHV0LCB1aW50MzJfdCBzaXpl
KQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAo
c211LT5wcHRfZnVuY3MtPm9kX2VkaXRfZHBtX3RhYmxlKQorCQlyZXQgPSBzbXUtPnBwdF9mdW5j
cy0+b2RfZWRpdF9kcG1fdGFibGUoc211LCB0eXBlLCBpbnB1dCwgc2l6ZSk7CisKKwltdXRleF91
bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9yZWFkX3Nl
bnNvcihzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKKwkJICAgIGVudW0gYW1kX3BwX3NlbnNvcnMg
c2Vuc29yLAorCQkgICAgdm9pZCAqZGF0YSwgdWludDMyX3QgKnNpemUpCit7CisJaW50IHJldCA9
IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+
cmVhZF9zZW5zb3IpCisJCXJldCA9IHNtdS0+cHB0X2Z1bmNzLT5yZWFkX3NlbnNvcihzbXUsIHNl
bnNvciwgZGF0YSwgc2l6ZSk7CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0
dXJuIHJldDsKK30KKworaW50IHNtdV9nZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHN0cnVjdCBzbXVf
Y29udGV4dCAqc211LCBjaGFyICpidWYpCit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2Nr
KCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+Z2V0X3Bvd2VyX3Byb2ZpbGVf
bW9kZSkKKwkJcmV0ID0gc211LT5wcHRfZnVuY3MtPmdldF9wb3dlcl9wcm9maWxlX21vZGUoc211
LCBidWYpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9
CisKK2ludCBzbXVfc2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNt
dSwKKwkJCSAgICAgICBsb25nICpwYXJhbSwKKwkJCSAgICAgICB1aW50MzJfdCBwYXJhbV9zaXpl
LAorCQkJICAgICAgIGJvb2wgbG9ja19uZWVkZWQpCit7CisJaW50IHJldCA9IDA7CisKKwlpZiAo
bG9ja19uZWVkZWQpCisJCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+cHB0
X2Z1bmNzLT5zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKQorCQlyZXQgPSBzbXUtPnBwdF9mdW5jcy0+
c2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZShzbXUsIHBhcmFtLCBwYXJhbV9zaXplKTsKKworCWlmIChs
b2NrX25lZWRlZCkKKwkJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7
Cit9CisKKworaW50IHNtdV9nZXRfZmFuX2NvbnRyb2xfbW9kZShzdHJ1Y3Qgc211X2NvbnRleHQg
KnNtdSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJ
aWYgKHNtdS0+ZnVuY3MtPmdldF9mYW5fY29udHJvbF9tb2RlKQorCQlyZXQgPSBzbXUtPmZ1bmNz
LT5nZXRfZmFuX2NvbnRyb2xfbW9kZShzbXUpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4
KTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfc2V0X2Zhbl9jb250cm9sX21vZGUoc3Ry
dWN0IHNtdV9jb250ZXh0ICpzbXUsIGludCB2YWx1ZSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11
dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPnNldF9mYW5fY29udHJv
bF9tb2RlKQorCQlyZXQgPSBzbXUtPmZ1bmNzLT5zZXRfZmFuX2NvbnRyb2xfbW9kZShzbXUsIHZh
bHVlKTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQor
CitpbnQgc211X2dldF9mYW5fc3BlZWRfcGVyY2VudChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwg
dWludDMyX3QgKnNwZWVkKQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5t
dXRleCk7CisKKwlpZiAoc211LT5wcHRfZnVuY3MtPmdldF9mYW5fc3BlZWRfcGVyY2VudCkKKwkJ
cmV0ID0gc211LT5wcHRfZnVuY3MtPmdldF9mYW5fc3BlZWRfcGVyY2VudChzbXUsIHNwZWVkKTsK
KworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQg
c211X3NldF9mYW5fc3BlZWRfcGVyY2VudChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgdWludDMy
X3Qgc3BlZWQpCit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsK
KworCWlmIChzbXUtPmZ1bmNzLT5zZXRfZmFuX3NwZWVkX3BlcmNlbnQpCisJCXJldCA9IHNtdS0+
ZnVuY3MtPnNldF9mYW5fc3BlZWRfcGVyY2VudChzbXUsIHNwZWVkKTsKKworCW11dGV4X3VubG9j
aygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X2dldF9mYW5fc3Bl
ZWRfcnBtKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB1aW50MzJfdCAqc3BlZWQpCit7CisJaW50
IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9m
dW5jcy0+Z2V0X2Zhbl9zcGVlZF9ycG0pCisJCXJldCA9IHNtdS0+cHB0X2Z1bmNzLT5nZXRfZmFu
X3NwZWVkX3JwbShzbXUsIHNwZWVkKTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisK
KwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X3NldF9kZWVwX3NsZWVwX2RjZWZjbGsoc3RydWN0
IHNtdV9jb250ZXh0ICpzbXUsIGludCBjbGspCit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9s
b2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5zZXRfZGVlcF9zbGVlcF9kY2Vm
Y2xrKQorCQlyZXQgPSBzbXUtPmZ1bmNzLT5zZXRfZGVlcF9zbGVlcF9kY2VmY2xrKHNtdSwgY2xr
KTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitp
bnQgc211X3NldF9hY3RpdmVfZGlzcGxheV9jb3VudChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwg
dWludDMyX3QgY291bnQpCit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11
dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5zZXRfYWN0aXZlX2Rpc3BsYXlfY291bnQpCisJCXJl
dCA9IHNtdS0+ZnVuY3MtPnNldF9hY3RpdmVfZGlzcGxheV9jb3VudChzbXUsIGNvdW50KTsKKwor
CW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211
X2dldF9jbG9ja19ieV90eXBlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJICBlbnVtIGFt
ZF9wcF9jbG9ja190eXBlIHR5cGUsCisJCQkgIHN0cnVjdCBhbWRfcHBfY2xvY2tzICpjbG9ja3Mp
Cit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChz
bXUtPmZ1bmNzLT5nZXRfY2xvY2tfYnlfdHlwZSkKKwkJcmV0ID0gc211LT5mdW5jcy0+Z2V0X2Ns
b2NrX2J5X3R5cGUoc211LCB0eXBlLCBjbG9ja3MpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11
dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfZ2V0X21heF9oaWdoX2Nsb2Nrcyhz
dHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKKwkJCSAgICBzdHJ1Y3QgYW1kX3BwX3NpbXBsZV9jbG9j
a19pbmZvICpjbG9ja3MpCit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11
dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5nZXRfbWF4X2hpZ2hfY2xvY2tzKQorCQlyZXQgPSBz
bXUtPmZ1bmNzLT5nZXRfbWF4X2hpZ2hfY2xvY2tzKHNtdSwgY2xvY2tzKTsKKworCW11dGV4X3Vu
bG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgc211X2dldF9jbG9j
a19ieV90eXBlX3dpdGhfbGF0ZW5jeShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKKwkJCQkgICAg
ICAgZW51bSBzbXVfY2xrX3R5cGUgY2xrX3R5cGUsCisJCQkJICAgICAgIHN0cnVjdCBwcF9jbG9j
a19sZXZlbHNfd2l0aF9sYXRlbmN5ICpjbG9ja3MpCit7CisJaW50IHJldCA9IDA7CisKKwltdXRl
eF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+Z2V0X2Nsb2NrX2J5
X3R5cGVfd2l0aF9sYXRlbmN5KQorCQlyZXQgPSBzbXUtPnBwdF9mdW5jcy0+Z2V0X2Nsb2NrX2J5
X3R5cGVfd2l0aF9sYXRlbmN5KHNtdSwgY2xrX3R5cGUsIGNsb2Nrcyk7CisKKwltdXRleF91bmxv
Y2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9nZXRfY2xvY2tf
YnlfdHlwZV93aXRoX3ZvbHRhZ2Uoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCisJCQkJICAgICAg
IGVudW0gYW1kX3BwX2Nsb2NrX3R5cGUgdHlwZSwKKwkJCQkgICAgICAgc3RydWN0IHBwX2Nsb2Nr
X2xldmVsc193aXRoX3ZvbHRhZ2UgKmNsb2NrcykKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4
X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+cHB0X2Z1bmNzLT5nZXRfY2xvY2tfYnlf
dHlwZV93aXRoX3ZvbHRhZ2UpCisJCXJldCA9IHNtdS0+cHB0X2Z1bmNzLT5nZXRfY2xvY2tfYnlf
dHlwZV93aXRoX3ZvbHRhZ2Uoc211LCB0eXBlLCBjbG9ja3MpOworCisJbXV0ZXhfdW5sb2NrKCZz
bXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKKworaW50IHNtdV9kaXNwbGF5X2Nsb2Nr
X3ZvbHRhZ2VfcmVxdWVzdChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKKwkJCQkgICAgICBzdHJ1
Y3QgcHBfZGlzcGxheV9jbG9ja19yZXF1ZXN0ICpjbG9ja19yZXEpCit7CisJaW50IHJldCA9IDA7
CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5kaXNwbGF5
X2Nsb2NrX3ZvbHRhZ2VfcmVxdWVzdCkKKwkJcmV0ID0gc211LT5mdW5jcy0+ZGlzcGxheV9jbG9j
a192b2x0YWdlX3JlcXVlc3Qoc211LCBjbG9ja19yZXEpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUt
Pm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKKworaW50IHNtdV9kaXNwbGF5X2Rpc2FibGVf
bWVtb3J5X2Nsb2NrX3N3aXRjaChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgYm9vbCBkaXNhYmxl
X21lbW9yeV9jbG9ja19zd2l0Y2gpCit7CisJaW50IHJldCA9IC1FSU5WQUw7CisKKwltdXRleF9s
b2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+ZGlzcGxheV9kaXNhYmxl
X21lbW9yeV9jbG9ja19zd2l0Y2gpCisJCXJldCA9IHNtdS0+cHB0X2Z1bmNzLT5kaXNwbGF5X2Rp
c2FibGVfbWVtb3J5X2Nsb2NrX3N3aXRjaChzbXUsIGRpc2FibGVfbWVtb3J5X2Nsb2NrX3N3aXRj
aCk7CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKwor
aW50IHNtdV9ub3RpZnlfc211X2VuYWJsZV9wd2Uoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCit7
CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUt
PmZ1bmNzLT5ub3RpZnlfc211X2VuYWJsZV9wd2UpCisJCXJldCA9IHNtdS0+ZnVuY3MtPm5vdGlm
eV9zbXVfZW5hYmxlX3B3ZShzbXUpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKwor
CXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfc2V0X3dhdGVybWFya3NfZm9yX2Nsb2NrX3Jhbmdl
cyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKKwkJCQkJc3RydWN0IGRtX3BwX3dtX3NldHNfd2l0
aF9jbG9ja19yYW5nZXNfc29jMTUgKmNsb2NrX3JhbmdlcykKK3sKKwlpbnQgcmV0ID0gMDsKKwor
CW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPnNldF93YXRlcm1h
cmtzX2Zvcl9jbG9ja19yYW5nZXMpCisJCXJldCA9IHNtdS0+ZnVuY3MtPnNldF93YXRlcm1hcmtz
X2Zvcl9jbG9ja19yYW5nZXMoc211LCBjbG9ja19yYW5nZXMpOworCisJbXV0ZXhfdW5sb2NrKCZz
bXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfc2V0X3hnbWlfcHN0YXRl
KHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJdWludDMyX3QgcHN0YXRlKQoreworCWludCBy
ZXQgPSAwOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5mdW5jcy0+
c2V0X3hnbWlfcHN0YXRlKQorCQlyZXQgPSBzbXUtPmZ1bmNzLT5zZXRfeGdtaV9wc3RhdGUoc211
LCBwc3RhdGUpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiByZXQ7
Cit9CisKK2ludCBzbXVfc2V0X2F6YWxpYV9kM19wbWUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUp
Cit7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChz
bXUtPmZ1bmNzLT5zZXRfYXphbGlhX2QzX3BtZSkKKwkJcmV0ID0gc211LT5mdW5jcy0+c2V0X2F6
YWxpYV9kM19wbWUoc211KTsKKworCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CisKKwlyZXR1
cm4gcmV0OworfQorCitib29sIHNtdV9iYWNvX2lzX3N1cHBvcnQoc3RydWN0IHNtdV9jb250ZXh0
ICpzbXUpCit7CisJYm9vbCByZXQgPSBmYWxzZTsKKworCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgp
OworCisJaWYgKHNtdS0+ZnVuY3MtPmJhY29faXNfc3VwcG9ydCkKKwkJcmV0ID0gc211LT5mdW5j
cy0+YmFjb19pc19zdXBwb3J0KHNtdSk7CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOwor
CisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9iYWNvX2dldF9zdGF0ZShzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwgZW51bSBzbXVfYmFjb19zdGF0ZSAqc3RhdGUpCit7CisJaWYgKHNtdS0+ZnVu
Y3MtPmJhY29fZ2V0X3N0YXRlKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCW11dGV4X2xvY2soJnNt
dS0+bXV0ZXgpOworCSpzdGF0ZSA9IHNtdS0+ZnVuY3MtPmJhY29fZ2V0X3N0YXRlKHNtdSk7CisJ
bXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsKKworCXJldHVybiAwOworfQorCitpbnQgc211X2Jh
Y29fcmVzZXQoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCit7CisJaW50IHJldCA9IDA7CisKKwlt
dXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPmZ1bmNzLT5iYWNvX3Jlc2V0KQor
CQlyZXQgPSBzbXUtPmZ1bmNzLT5iYWNvX3Jlc2V0KHNtdSk7CisKKwltdXRleF91bmxvY2soJnNt
dS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9tb2RlMl9yZXNldChzdHJ1
Y3Qgc211X2NvbnRleHQgKnNtdSkKK3sKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJnNt
dS0+bXV0ZXgpOworCisJaWYgKHNtdS0+ZnVuY3MtPm1vZGUyX3Jlc2V0KQorCQlyZXQgPSBzbXUt
PmZ1bmNzLT5tb2RlMl9yZXNldChzbXUpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11dGV4KTsK
KworCXJldHVybiByZXQ7Cit9CisKK2ludCBzbXVfZ2V0X21heF9zdXN0YWluYWJsZV9jbG9ja3Nf
YnlfZGMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCisJCQkJCSBzdHJ1Y3QgcHBfc211X252X2Ns
b2NrX3RhYmxlICptYXhfY2xvY2tzKQoreworCWludCByZXQgPSAwOworCisJbXV0ZXhfbG9jaygm
c211LT5tdXRleCk7CisKKwlpZiAoc211LT5mdW5jcy0+Z2V0X21heF9zdXN0YWluYWJsZV9jbG9j
a3NfYnlfZGMpCisJCXJldCA9IHNtdS0+ZnVuY3MtPmdldF9tYXhfc3VzdGFpbmFibGVfY2xvY2tz
X2J5X2RjKHNtdSwgbWF4X2Nsb2Nrcyk7CisKKwltdXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOwor
CisJcmV0dXJuIHJldDsKK30KKworaW50IHNtdV9nZXRfdWNsa19kcG1fc3RhdGVzKHN0cnVjdCBz
bXVfY29udGV4dCAqc211LAorCQkJICAgIHVuc2lnbmVkIGludCAqY2xvY2tfdmFsdWVzX2luX2to
eiwKKwkJCSAgICB1bnNpZ25lZCBpbnQgKm51bV9zdGF0ZXMpCit7CisJaW50IHJldCA9IDA7CisK
KwltdXRleF9sb2NrKCZzbXUtPm11dGV4KTsKKworCWlmIChzbXUtPnBwdF9mdW5jcy0+Z2V0X3Vj
bGtfZHBtX3N0YXRlcykKKwkJcmV0ID0gc211LT5wcHRfZnVuY3MtPmdldF91Y2xrX2RwbV9zdGF0
ZXMoc211LCBjbG9ja192YWx1ZXNfaW5fa2h6LCBudW1fc3RhdGVzKTsKKworCW11dGV4X3VubG9j
aygmc211LT5tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitlbnVtIGFtZF9wbV9zdGF0ZV90
eXBlIHNtdV9nZXRfY3VycmVudF9wb3dlcl9zdGF0ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkK
K3sKKwllbnVtIGFtZF9wbV9zdGF0ZV90eXBlIHBtX3N0YXRlID0gUE9XRVJfU1RBVEVfVFlQRV9E
RUZBVUxUOworCisJbXV0ZXhfbG9jaygmc211LT5tdXRleCk7CisKKwlpZiAoc211LT5wcHRfZnVu
Y3MtPmdldF9jdXJyZW50X3Bvd2VyX3N0YXRlKQorCQlwbV9zdGF0ZSA9IHNtdS0+cHB0X2Z1bmNz
LT5nZXRfY3VycmVudF9wb3dlcl9zdGF0ZShzbXUpOworCisJbXV0ZXhfdW5sb2NrKCZzbXUtPm11
dGV4KTsKKworCXJldHVybiBwbV9zdGF0ZTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvcG93ZXJwbGF5L2FyY3R1cnVzX3BwdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dl
cnBsYXkvYXJjdHVydXNfcHB0LmMKaW5kZXggNjczMWZlZDU0NThlLi4xNDFlNDhjZDFjNWQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2FyY3R1cnVzX3BwdC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L2FyY3R1cnVzX3BwdC5jCkBAIC03NzIs
OCArNzcyLDYgQEAgc3RhdGljIGludCBhcmN0dXJ1c19mb3JjZV9jbGtfbGV2ZWxzKHN0cnVjdCBz
bXVfY29udGV4dCAqc211LAogCXVpbnQzMl90IHNvZnRfbWluX2xldmVsLCBzb2Z0X21heF9sZXZl
bDsKIAlpbnQgcmV0ID0gMDsKIAotCW11dGV4X2xvY2soJihzbXUtPm11dGV4KSk7Ci0KIAlzb2Z0
X21pbl9sZXZlbCA9IG1hc2sgPyAoZmZzKG1hc2spIC0gMSkgOiAwOwogCXNvZnRfbWF4X2xldmVs
ID0gbWFzayA/IChmbHMobWFzaykgLSAxKSA6IDA7CiAKQEAgLTg5Miw3ICs4OTAsNiBAQCBzdGF0
aWMgaW50IGFyY3R1cnVzX2ZvcmNlX2Nsa19sZXZlbHMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUs
CiAJCWJyZWFrOwogCX0KIAotCW11dGV4X3VubG9jaygmKHNtdS0+bXV0ZXgpKTsKIAlyZXR1cm4g
cmV0OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9pbmMv
YW1kZ3B1X3NtdS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvaW5jL2FtZGdwdV9z
bXUuaAppbmRleCBjZGI4NDVmNWYyM2UuLjNlMzQ2NGZhMmZmNSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvaW5jL2FtZGdwdV9zbXUuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL3Bvd2VycGxheS9pbmMvYW1kZ3B1X3NtdS5oCkBAIC01NjUsMTggKzU2NSwxNyBA
QCBzdHJ1Y3Qgc211X2Z1bmNzCiAJKChzbXUpLT5mdW5jcy0+aW5pdF9wb3dlciA/IChzbXUpLT5m
dW5jcy0+aW5pdF9wb3dlcigoc211KSkgOiAwKQogI2RlZmluZSBzbXVfZmluaV9wb3dlcihzbXUp
IFwKIAkoKHNtdSktPmZ1bmNzLT5maW5pX3Bvd2VyID8gKHNtdSktPmZ1bmNzLT5maW5pX3Bvd2Vy
KChzbXUpKSA6IDApCi0jZGVmaW5lIHNtdV9sb2FkX21pY3JvY29kZShzbXUpIFwKLQkoKHNtdSkt
PmZ1bmNzLT5sb2FkX21pY3JvY29kZSA/IChzbXUpLT5mdW5jcy0+bG9hZF9taWNyb2NvZGUoKHNt
dSkpIDogMCkKLSNkZWZpbmUgc211X2NoZWNrX2Z3X3N0YXR1cyhzbXUpIFwKLQkoKHNtdSktPmZ1
bmNzLT5jaGVja19md19zdGF0dXMgPyAoc211KS0+ZnVuY3MtPmNoZWNrX2Z3X3N0YXR1cygoc211
KSkgOiAwKQoraW50IHNtdV9sb2FkX21pY3JvY29kZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSk7
CisKK2ludCBzbXVfY2hlY2tfZndfc3RhdHVzKHN0cnVjdCBzbXVfY29udGV4dCAqc211KTsKKwog
I2RlZmluZSBzbXVfc2V0dXBfcHB0YWJsZShzbXUpIFwKIAkoKHNtdSktPmZ1bmNzLT5zZXR1cF9w
cHRhYmxlID8gKHNtdSktPmZ1bmNzLT5zZXR1cF9wcHRhYmxlKChzbXUpKSA6IDApCiAjZGVmaW5l
IHNtdV9wb3dlcmdhdGVfc2RtYShzbXUsIGdhdGUpIFwKIAkoKHNtdSktPmZ1bmNzLT5wb3dlcmdh
dGVfc2RtYSA/IChzbXUpLT5mdW5jcy0+cG93ZXJnYXRlX3NkbWEoKHNtdSksIChnYXRlKSkgOiAw
KQogI2RlZmluZSBzbXVfcG93ZXJnYXRlX3ZjbihzbXUsIGdhdGUpIFwKIAkoKHNtdSktPmZ1bmNz
LT5wb3dlcmdhdGVfdmNuID8gKHNtdSktPmZ1bmNzLT5wb3dlcmdhdGVfdmNuKChzbXUpLCAoZ2F0
ZSkpIDogMCkKLSNkZWZpbmUgc211X3NldF9nZnhfY2dwZyhzbXUsIGVuYWJsZWQpIFwKLQkoKHNt
dSktPmZ1bmNzLT5zZXRfZ2Z4X2NncGcgPyAoc211KS0+ZnVuY3MtPnNldF9nZnhfY2dwZygoc211
KSwgKGVuYWJsZWQpKSA6IDApCitpbnQgc211X3NldF9nZnhfY2dwZyhzdHJ1Y3Qgc211X2NvbnRl
eHQgKnNtdSwgYm9vbCBlbmFibGVkKTsKICNkZWZpbmUgc211X2dldF92Ymlvc19ib290dXBfdmFs
dWVzKHNtdSkgXAogCSgoc211KS0+ZnVuY3MtPmdldF92Ymlvc19ib290dXBfdmFsdWVzID8gKHNt
dSktPmZ1bmNzLT5nZXRfdmJpb3NfYm9vdHVwX3ZhbHVlcygoc211KSkgOiAwKQogI2RlZmluZSBz
bXVfZ2V0X2Nsa19pbmZvX2Zyb21fdmJpb3Moc211KSBcCkBAIC02MTAsOCArNjA5LDggQEAgc3Ry
dWN0IHNtdV9mdW5jcwogCSgoc211KS0+ZnVuY3MtPmluaXRfbWF4X3N1c3RhaW5hYmxlX2Nsb2Nr
cyA/IChzbXUpLT5mdW5jcy0+aW5pdF9tYXhfc3VzdGFpbmFibGVfY2xvY2tzKChzbXUpKSA6IDAp
CiAjZGVmaW5lIHNtdV9zZXRfZGVmYXVsdF9vZF9zZXR0aW5ncyhzbXUsIGluaXRpYWxpemUpIFwK
IAkoKHNtdSktPnBwdF9mdW5jcy0+c2V0X2RlZmF1bHRfb2Rfc2V0dGluZ3MgPyAoc211KS0+cHB0
X2Z1bmNzLT5zZXRfZGVmYXVsdF9vZF9zZXR0aW5ncygoc211KSwgKGluaXRpYWxpemUpKSA6IDAp
Ci0jZGVmaW5lIHNtdV9zZXRfZmFuX3NwZWVkX3JwbShzbXUsIHNwZWVkKSBcCi0JKChzbXUpLT5m
dW5jcy0+c2V0X2Zhbl9zcGVlZF9ycG0gPyAoc211KS0+ZnVuY3MtPnNldF9mYW5fc3BlZWRfcnBt
KChzbXUpLCAoc3BlZWQpKSA6IDApCitpbnQgc211X3NldF9mYW5fc3BlZWRfcnBtKHN0cnVjdCBz
bXVfY29udGV4dCAqc211LCB1aW50MzJfdCBzcGVlZCk7CisKICNkZWZpbmUgc211X3NlbmRfc21j
X21zZyhzbXUsIG1zZykgXAogCSgoc211KS0+ZnVuY3MtPnNlbmRfc21jX21zZz8gKHNtdSktPmZ1
bmNzLT5zZW5kX3NtY19tc2coKHNtdSksIChtc2cpKSA6IDApCiAjZGVmaW5lIHNtdV9zZW5kX3Nt
Y19tc2dfd2l0aF9wYXJhbShzbXUsIG1zZywgcGFyYW0pIFwKQEAgLTY0MiwyMCArNjQxLDIyIEBA
IHN0cnVjdCBzbXVfZnVuY3MKIAkoKHNtdSktPnBwdF9mdW5jcy0+cG9wdWxhdGVfdW1kX3N0YXRl
X2NsayA/IChzbXUpLT5wcHRfZnVuY3MtPnBvcHVsYXRlX3VtZF9zdGF0ZV9jbGsoKHNtdSkpIDog
MCkKICNkZWZpbmUgc211X3NldF9kZWZhdWx0X29kOF9zZXR0aW5ncyhzbXUpIFwKIAkoKHNtdSkt
PnBwdF9mdW5jcy0+c2V0X2RlZmF1bHRfb2Q4X3NldHRpbmdzID8gKHNtdSktPnBwdF9mdW5jcy0+
c2V0X2RlZmF1bHRfb2Q4X3NldHRpbmdzKChzbXUpKSA6IDApCi0jZGVmaW5lIHNtdV9nZXRfcG93
ZXJfbGltaXQoc211LCBsaW1pdCwgZGVmKSBcCi0JKChzbXUpLT5wcHRfZnVuY3MtPmdldF9wb3dl
cl9saW1pdCA/IChzbXUpLT5wcHRfZnVuY3MtPmdldF9wb3dlcl9saW1pdCgoc211KSwgKGxpbWl0
KSwgKGRlZikpIDogMCkKLSNkZWZpbmUgc211X3NldF9wb3dlcl9saW1pdChzbXUsIGxpbWl0KSBc
Ci0JKChzbXUpLT5mdW5jcy0+c2V0X3Bvd2VyX2xpbWl0ID8gKHNtdSktPmZ1bmNzLT5zZXRfcG93
ZXJfbGltaXQoKHNtdSksIChsaW1pdCkpIDogMCkKKworaW50IHNtdV9nZXRfcG93ZXJfbGltaXQo
c3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCisJCQl1aW50MzJfdCAqbGltaXQsCisJCQlib29sIGRl
ZiwKKwkJCWJvb2wgbG9ja19uZWVkZWQpOworCitpbnQgc211X3NldF9wb3dlcl9saW1pdChzdHJ1
Y3Qgc211X2NvbnRleHQgKnNtdSwgdWludDMyX3QgbGltaXQpOwogI2RlZmluZSBzbXVfZ2V0X2N1
cnJlbnRfY2xrX2ZyZXEoc211LCBjbGtfaWQsIHZhbHVlKSBcCiAJKChzbXUpLT5mdW5jcy0+Z2V0
X2N1cnJlbnRfY2xrX2ZyZXE/IChzbXUpLT5mdW5jcy0+Z2V0X2N1cnJlbnRfY2xrX2ZyZXEoKHNt
dSksIChjbGtfaWQpLCAodmFsdWUpKSA6IDApCi0jZGVmaW5lIHNtdV9wcmludF9jbGtfbGV2ZWxz
KHNtdSwgY2xrX3R5cGUsIGJ1ZikgXAotCSgoc211KS0+cHB0X2Z1bmNzLT5wcmludF9jbGtfbGV2
ZWxzID8gKHNtdSktPnBwdF9mdW5jcy0+cHJpbnRfY2xrX2xldmVscygoc211KSwgKGNsa190eXBl
KSwgKGJ1ZikpIDogMCkKLSNkZWZpbmUgc211X2dldF9vZF9wZXJjZW50YWdlKHNtdSwgdHlwZSkg
XAotCSgoc211KS0+cHB0X2Z1bmNzLT5nZXRfb2RfcGVyY2VudGFnZSA/IChzbXUpLT5wcHRfZnVu
Y3MtPmdldF9vZF9wZXJjZW50YWdlKChzbXUpLCAodHlwZSkpIDogMCkKLSNkZWZpbmUgc211X3Nl
dF9vZF9wZXJjZW50YWdlKHNtdSwgdHlwZSwgdmFsdWUpIFwKLQkoKHNtdSktPnBwdF9mdW5jcy0+
c2V0X29kX3BlcmNlbnRhZ2UgPyAoc211KS0+cHB0X2Z1bmNzLT5zZXRfb2RfcGVyY2VudGFnZSgo
c211KSwgKHR5cGUpLCAodmFsdWUpKSA6IDApCi0jZGVmaW5lIHNtdV9vZF9lZGl0X2RwbV90YWJs
ZShzbXUsIHR5cGUsIGlucHV0LCBzaXplKSBcCi0JKChzbXUpLT5wcHRfZnVuY3MtPm9kX2VkaXRf
ZHBtX3RhYmxlID8gKHNtdSktPnBwdF9mdW5jcy0+b2RfZWRpdF9kcG1fdGFibGUoKHNtdSksICh0
eXBlKSwgKGlucHV0KSwgKHNpemUpKSA6IDApCitpbnQgc211X3ByaW50X2Nsa19sZXZlbHMoc3Ry
dWN0IHNtdV9jb250ZXh0ICpzbXUsIGVudW0gc211X2Nsa190eXBlIGNsa190eXBlLCBjaGFyICpi
dWYpOworaW50IHNtdV9nZXRfb2RfcGVyY2VudGFnZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwg
ZW51bSBzbXVfY2xrX3R5cGUgdHlwZSk7CitpbnQgc211X3NldF9vZF9wZXJjZW50YWdlKHN0cnVj
dCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSB0eXBlLCB1aW50MzJfdCB2YWx1
ZSk7CisKK2ludCBzbXVfb2RfZWRpdF9kcG1fdGFibGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUs
CisJCQkgIGVudW0gUFBfT0RfRFBNX1RBQkxFX0NPTU1BTkQgdHlwZSwKKwkJCSAgbG9uZyAqaW5w
dXQsIHVpbnQzMl90IHNpemUpOwogI2RlZmluZSBzbXVfdGFibGVzX2luaXQoc211LCB0YWIpIFwK
IAkoKHNtdSktPnBwdF9mdW5jcy0+dGFibGVzX2luaXQgPyAoc211KS0+cHB0X2Z1bmNzLT50YWJs
ZXNfaW5pdCgoc211KSwgKHRhYikpIDogMCkKICNkZWZpbmUgc211X3NldF90aGVybWFsX2Zhbl90
YWJsZShzbXUpIFwKQEAgLTY2NCwxNCArNjY1LDE4IEBAIHN0cnVjdCBzbXVfZnVuY3MKIAkoKHNt
dSktPmZ1bmNzLT5zdGFydF90aGVybWFsX2NvbnRyb2w/IChzbXUpLT5mdW5jcy0+c3RhcnRfdGhl
cm1hbF9jb250cm9sKChzbXUpKSA6IDApCiAjZGVmaW5lIHNtdV9zdG9wX3RoZXJtYWxfY29udHJv
bChzbXUpIFwKIAkoKHNtdSktPmZ1bmNzLT5zdG9wX3RoZXJtYWxfY29udHJvbD8gKHNtdSktPmZ1
bmNzLT5zdG9wX3RoZXJtYWxfY29udHJvbCgoc211KSkgOiAwKQotI2RlZmluZSBzbXVfcmVhZF9z
ZW5zb3Ioc211LCBzZW5zb3IsIGRhdGEsIHNpemUpIFwKLQkoKHNtdSktPnBwdF9mdW5jcy0+cmVh
ZF9zZW5zb3I/IChzbXUpLT5wcHRfZnVuY3MtPnJlYWRfc2Vuc29yKChzbXUpLCAoc2Vuc29yKSwg
KGRhdGEpLCAoc2l6ZSkpIDogMCkKKworaW50IHNtdV9yZWFkX3NlbnNvcihzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwKKwkJICAgIGVudW0gYW1kX3BwX3NlbnNvcnMgc2Vuc29yLAorCQkgICAgdm9p
ZCAqZGF0YSwgdWludDMyX3QgKnNpemUpOwogI2RlZmluZSBzbXVfc21jX3JlYWRfc2Vuc29yKHNt
dSwgc2Vuc29yLCBkYXRhLCBzaXplKSBcCiAJKChzbXUpLT5mdW5jcy0+cmVhZF9zZW5zb3I/IChz
bXUpLT5mdW5jcy0+cmVhZF9zZW5zb3IoKHNtdSksIChzZW5zb3IpLCAoZGF0YSksIChzaXplKSkg
OiAtRUlOVkFMKQotI2RlZmluZSBzbXVfZ2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZShzbXUsIGJ1Zikg
XAotCSgoc211KS0+cHB0X2Z1bmNzLT5nZXRfcG93ZXJfcHJvZmlsZV9tb2RlID8gKHNtdSktPnBw
dF9mdW5jcy0+Z2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZSgoc211KSwgYnVmKSA6IDApCi0jZGVmaW5l
IHNtdV9zZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHNtdSwgcGFyYW0sIHBhcmFtX3NpemUpIFwKLQko
KHNtdSktPnBwdF9mdW5jcy0+c2V0X3Bvd2VyX3Byb2ZpbGVfbW9kZSA/IChzbXUpLT5wcHRfZnVu
Y3MtPnNldF9wb3dlcl9wcm9maWxlX21vZGUoKHNtdSksIChwYXJhbSksIChwYXJhbV9zaXplKSkg
OiAwKQoraW50IHNtdV9nZXRfcG93ZXJfcHJvZmlsZV9tb2RlKHN0cnVjdCBzbXVfY29udGV4dCAq
c211LCBjaGFyICpidWYpOworCitpbnQgc211X3NldF9wb3dlcl9wcm9maWxlX21vZGUoc3RydWN0
IHNtdV9jb250ZXh0ICpzbXUsCisJCQkgICAgICAgbG9uZyAqcGFyYW0sCisJCQkgICAgICAgdWlu
dDMyX3QgcGFyYW1fc2l6ZSwKKwkJCSAgICAgICBib29sIGxvY2tfbmVlZGVkKTsKICNkZWZpbmUg
c211X3ByZV9kaXNwbGF5X2NvbmZpZ19jaGFuZ2VkKHNtdSkgXAogCSgoc211KS0+cHB0X2Z1bmNz
LT5wcmVfZGlzcGxheV9jb25maWdfY2hhbmdlZCA/IChzbXUpLT5wcHRfZnVuY3MtPnByZV9kaXNw
bGF5X2NvbmZpZ19jaGFuZ2VkKChzbXUpKSA6IDApCiAjZGVmaW5lIHNtdV9kaXNwbGF5X2NvbmZp
Z19jaGFuZ2VkKHNtdSkgXApAQCAtNjg4LDE2ICs2OTMsMTEgQEAgc3RydWN0IHNtdV9mdW5jcwog
CSgoc211KS0+cHB0X2Z1bmNzLT5nZXRfcHJvZmlsaW5nX2Nsa19tYXNrID8gKHNtdSktPnBwdF9m
dW5jcy0+Z2V0X3Byb2ZpbGluZ19jbGtfbWFzaygoc211KSwgKGxldmVsKSwgKHNjbGtfbWFzayks
IChtY2xrX21hc2spLCAoc29jX21hc2spKSA6IDApCiAjZGVmaW5lIHNtdV9zZXRfY3B1X3Bvd2Vy
X3N0YXRlKHNtdSkgXAogCSgoc211KS0+cHB0X2Z1bmNzLT5zZXRfY3B1X3Bvd2VyX3N0YXRlID8g
KHNtdSktPnBwdF9mdW5jcy0+c2V0X2NwdV9wb3dlcl9zdGF0ZSgoc211KSkgOiAwKQotI2RlZmlu
ZSBzbXVfZ2V0X2Zhbl9jb250cm9sX21vZGUoc211KSBcCi0JKChzbXUpLT5mdW5jcy0+Z2V0X2Zh
bl9jb250cm9sX21vZGUgPyAoc211KS0+ZnVuY3MtPmdldF9mYW5fY29udHJvbF9tb2RlKChzbXUp
KSA6IDApCi0jZGVmaW5lIHNtdV9zZXRfZmFuX2NvbnRyb2xfbW9kZShzbXUsIHZhbHVlKSBcCi0J
KChzbXUpLT5mdW5jcy0+c2V0X2Zhbl9jb250cm9sX21vZGUgPyAoc211KS0+ZnVuY3MtPnNldF9m
YW5fY29udHJvbF9tb2RlKChzbXUpLCAodmFsdWUpKSA6IDApCi0jZGVmaW5lIHNtdV9nZXRfZmFu
X3NwZWVkX3BlcmNlbnQoc211LCBzcGVlZCkgXAotCSgoc211KS0+cHB0X2Z1bmNzLT5nZXRfZmFu
X3NwZWVkX3BlcmNlbnQgPyAoc211KS0+cHB0X2Z1bmNzLT5nZXRfZmFuX3NwZWVkX3BlcmNlbnQo
KHNtdSksIChzcGVlZCkpIDogMCkKLSNkZWZpbmUgc211X3NldF9mYW5fc3BlZWRfcGVyY2VudChz
bXUsIHNwZWVkKSBcCi0JKChzbXUpLT5mdW5jcy0+c2V0X2Zhbl9zcGVlZF9wZXJjZW50ID8gKHNt
dSktPmZ1bmNzLT5zZXRfZmFuX3NwZWVkX3BlcmNlbnQoKHNtdSksIChzcGVlZCkpIDogMCkKLSNk
ZWZpbmUgc211X2dldF9mYW5fc3BlZWRfcnBtKHNtdSwgc3BlZWQpIFwKLQkoKHNtdSktPnBwdF9m
dW5jcy0+Z2V0X2Zhbl9zcGVlZF9ycG0gPyAoc211KS0+cHB0X2Z1bmNzLT5nZXRfZmFuX3NwZWVk
X3JwbSgoc211KSwgKHNwZWVkKSkgOiAwKQoraW50IHNtdV9nZXRfZmFuX2NvbnRyb2xfbW9kZShz
dHJ1Y3Qgc211X2NvbnRleHQgKnNtdSk7CitpbnQgc211X3NldF9mYW5fY29udHJvbF9tb2RlKHN0
cnVjdCBzbXVfY29udGV4dCAqc211LCBpbnQgdmFsdWUpOworaW50IHNtdV9nZXRfZmFuX3NwZWVk
X3BlcmNlbnQoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQzMl90ICpzcGVlZCk7CitpbnQg
c211X3NldF9mYW5fc3BlZWRfcGVyY2VudChzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgdWludDMy
X3Qgc3BlZWQpOworaW50IHNtdV9nZXRfZmFuX3NwZWVkX3JwbShzdHJ1Y3Qgc211X2NvbnRleHQg
KnNtdSwgdWludDMyX3QgKnNwZWVkKTsKIAogI2RlZmluZSBzbXVfbXNnX2dldF9pbmRleChzbXUs
IG1zZykgXAogCSgoc211KS0+cHB0X2Z1bmNzPyAoKHNtdSktPnBwdF9mdW5jcy0+Z2V0X3NtdV9t
c2dfaW5kZXg/IChzbXUpLT5wcHRfZnVuY3MtPmdldF9zbXVfbXNnX2luZGV4KChzbXUpLCAobXNn
KSkgOiAtRUlOVkFMKSA6IC1FSU5WQUwpCkBAIC03MTUsNDAgKzcxNSw0NiBAQCBzdHJ1Y3Qgc211
X2Z1bmNzCiAJKChzbXUpLT5wcHRfZnVuY3M/ICgoc211KS0+cHB0X2Z1bmNzLT5ydW5fYnRjPyAo
c211KS0+cHB0X2Z1bmNzLT5ydW5fYnRjKChzbXUpKSA6IDApIDogMCkKICNkZWZpbmUgc211X2dl
dF9hbGxvd2VkX2ZlYXR1cmVfbWFzayhzbXUsIGZlYXR1cmVfbWFzaywgbnVtKSBcCiAJKChzbXUp
LT5wcHRfZnVuY3M/ICgoc211KS0+cHB0X2Z1bmNzLT5nZXRfYWxsb3dlZF9mZWF0dXJlX21hc2s/
IChzbXUpLT5wcHRfZnVuY3MtPmdldF9hbGxvd2VkX2ZlYXR1cmVfbWFzaygoc211KSwgKGZlYXR1
cmVfbWFzayksIChudW0pKSA6IDApIDogMCkKLSNkZWZpbmUgc211X3NldF9kZWVwX3NsZWVwX2Rj
ZWZjbGsoc211LCBjbGspIFwKLQkoKHNtdSktPmZ1bmNzLT5zZXRfZGVlcF9zbGVlcF9kY2VmY2xr
ID8gKHNtdSktPmZ1bmNzLT5zZXRfZGVlcF9zbGVlcF9kY2VmY2xrKChzbXUpLCAoY2xrKSkgOiAw
KQotI2RlZmluZSBzbXVfc2V0X2FjdGl2ZV9kaXNwbGF5X2NvdW50KHNtdSwgY291bnQpIFwKLQko
KHNtdSktPmZ1bmNzLT5zZXRfYWN0aXZlX2Rpc3BsYXlfY291bnQgPyAoc211KS0+ZnVuY3MtPnNl
dF9hY3RpdmVfZGlzcGxheV9jb3VudCgoc211KSwgKGNvdW50KSkgOiAwKQoraW50IHNtdV9zZXRf
ZGVlcF9zbGVlcF9kY2VmY2xrKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBpbnQgY2xrKTsKK2lu
dCBzbXVfc2V0X2FjdGl2ZV9kaXNwbGF5X2NvdW50KHN0cnVjdCBzbXVfY29udGV4dCAqc211LCB1
aW50MzJfdCBjb3VudCk7CiAjZGVmaW5lIHNtdV9zdG9yZV9jYzZfZGF0YShzbXUsIHN0LCBjYzZf
ZGlzLCBwc3RfZGlzLCBwc3Rfc3dfZGlzKSBcCiAJKChzbXUpLT5mdW5jcy0+c3RvcmVfY2M2X2Rh
dGEgPyAoc211KS0+ZnVuY3MtPnN0b3JlX2NjNl9kYXRhKChzbXUpLCAoc3QpLCAoY2M2X2Rpcyks
IChwc3RfZGlzKSwgKHBzdF9zd19kaXMpKSA6IDApCi0jZGVmaW5lIHNtdV9nZXRfY2xvY2tfYnlf
dHlwZShzbXUsIHR5cGUsIGNsb2NrcykgXAotCSgoc211KS0+ZnVuY3MtPmdldF9jbG9ja19ieV90
eXBlID8gKHNtdSktPmZ1bmNzLT5nZXRfY2xvY2tfYnlfdHlwZSgoc211KSwgKHR5cGUpLCAoY2xv
Y2tzKSkgOiAwKQotI2RlZmluZSBzbXVfZ2V0X21heF9oaWdoX2Nsb2NrcyhzbXUsIGNsb2Nrcykg
XAotCSgoc211KS0+ZnVuY3MtPmdldF9tYXhfaGlnaF9jbG9ja3MgPyAoc211KS0+ZnVuY3MtPmdl
dF9tYXhfaGlnaF9jbG9ja3MoKHNtdSksIChjbG9ja3MpKSA6IDApCi0jZGVmaW5lIHNtdV9nZXRf
Y2xvY2tfYnlfdHlwZV93aXRoX2xhdGVuY3koc211LCBjbGtfdHlwZSwgY2xvY2tzKSBcCi0JKChz
bXUpLT5wcHRfZnVuY3MtPmdldF9jbG9ja19ieV90eXBlX3dpdGhfbGF0ZW5jeSA/IChzbXUpLT5w
cHRfZnVuY3MtPmdldF9jbG9ja19ieV90eXBlX3dpdGhfbGF0ZW5jeSgoc211KSwgKGNsa190eXBl
KSwgKGNsb2NrcykpIDogMCkKLSNkZWZpbmUgc211X2dldF9jbG9ja19ieV90eXBlX3dpdGhfdm9s
dGFnZShzbXUsIHR5cGUsIGNsb2NrcykgXAotCSgoc211KS0+cHB0X2Z1bmNzLT5nZXRfY2xvY2tf
YnlfdHlwZV93aXRoX3ZvbHRhZ2UgPyAoc211KS0+cHB0X2Z1bmNzLT5nZXRfY2xvY2tfYnlfdHlw
ZV93aXRoX3ZvbHRhZ2UoKHNtdSksICh0eXBlKSwgKGNsb2NrcykpIDogMCkKLSNkZWZpbmUgc211
X2Rpc3BsYXlfY2xvY2tfdm9sdGFnZV9yZXF1ZXN0KHNtdSwgY2xvY2tfcmVxKSBcCi0JKChzbXUp
LT5mdW5jcy0+ZGlzcGxheV9jbG9ja192b2x0YWdlX3JlcXVlc3QgPyAoc211KS0+ZnVuY3MtPmRp
c3BsYXlfY2xvY2tfdm9sdGFnZV9yZXF1ZXN0KChzbXUpLCAoY2xvY2tfcmVxKSkgOiAwKQotI2Rl
ZmluZSBzbXVfZGlzcGxheV9kaXNhYmxlX21lbW9yeV9jbG9ja19zd2l0Y2goc211LCBkaXNhYmxl
X21lbW9yeV9jbG9ja19zd2l0Y2gpIFwKLQkoKHNtdSktPnBwdF9mdW5jcy0+ZGlzcGxheV9kaXNh
YmxlX21lbW9yeV9jbG9ja19zd2l0Y2ggPyAoc211KS0+cHB0X2Z1bmNzLT5kaXNwbGF5X2Rpc2Fi
bGVfbWVtb3J5X2Nsb2NrX3N3aXRjaCgoc211KSwgKGRpc2FibGVfbWVtb3J5X2Nsb2NrX3N3aXRj
aCkpIDogLUVJTlZBTCkKKworaW50IHNtdV9nZXRfY2xvY2tfYnlfdHlwZShzdHJ1Y3Qgc211X2Nv
bnRleHQgKnNtdSwKKwkJCSAgZW51bSBhbWRfcHBfY2xvY2tfdHlwZSB0eXBlLAorCQkJICBzdHJ1
Y3QgYW1kX3BwX2Nsb2NrcyAqY2xvY2tzKTsKKworaW50IHNtdV9nZXRfbWF4X2hpZ2hfY2xvY2tz
KHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJICAgIHN0cnVjdCBhbWRfcHBfc2ltcGxlX2Ns
b2NrX2luZm8gKmNsb2Nrcyk7CisKK2ludCBzbXVfZ2V0X2Nsb2NrX2J5X3R5cGVfd2l0aF9sYXRl
bmN5KHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJCSAgICAgICBlbnVtIHNtdV9jbGtfdHlw
ZSBjbGtfdHlwZSwKKwkJCQkgICAgICAgc3RydWN0IHBwX2Nsb2NrX2xldmVsc193aXRoX2xhdGVu
Y3kgKmNsb2Nrcyk7CisKK2ludCBzbXVfZ2V0X2Nsb2NrX2J5X3R5cGVfd2l0aF92b2x0YWdlKHN0
cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJCSAgICAgICBlbnVtIGFtZF9wcF9jbG9ja190eXBl
IHR5cGUsCisJCQkJICAgICAgIHN0cnVjdCBwcF9jbG9ja19sZXZlbHNfd2l0aF92b2x0YWdlICpj
bG9ja3MpOworCitpbnQgc211X2Rpc3BsYXlfY2xvY2tfdm9sdGFnZV9yZXF1ZXN0KHN0cnVjdCBz
bXVfY29udGV4dCAqc211LAorCQkJCSAgICAgIHN0cnVjdCBwcF9kaXNwbGF5X2Nsb2NrX3JlcXVl
c3QgKmNsb2NrX3JlcSk7CitpbnQgc211X2Rpc3BsYXlfZGlzYWJsZV9tZW1vcnlfY2xvY2tfc3dp
dGNoKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBib29sIGRpc2FibGVfbWVtb3J5X2Nsb2NrX3N3
aXRjaCk7CiAjZGVmaW5lIHNtdV9nZXRfZGFsX3Bvd2VyX2xldmVsKHNtdSwgY2xvY2tzKSBcCiAJ
KChzbXUpLT5mdW5jcy0+Z2V0X2RhbF9wb3dlcl9sZXZlbCA/IChzbXUpLT5mdW5jcy0+Z2V0X2Rh
bF9wb3dlcl9sZXZlbCgoc211KSwgKGNsb2NrcykpIDogMCkKICNkZWZpbmUgc211X2dldF9wZXJm
X2xldmVsKHNtdSwgZGVzaWduYXRpb24sIGxldmVsKSBcCiAJKChzbXUpLT5mdW5jcy0+Z2V0X3Bl
cmZfbGV2ZWwgPyAoc211KS0+ZnVuY3MtPmdldF9wZXJmX2xldmVsKChzbXUpLCAoZGVzaWduYXRp
b24pLCAobGV2ZWwpKSA6IDApCiAjZGVmaW5lIHNtdV9nZXRfY3VycmVudF9zaGFsbG93X3NsZWVw
X2Nsb2NrcyhzbXUsIGNsb2NrcykgXAogCSgoc211KS0+ZnVuY3MtPmdldF9jdXJyZW50X3NoYWxs
b3dfc2xlZXBfY2xvY2tzID8gKHNtdSktPmZ1bmNzLT5nZXRfY3VycmVudF9zaGFsbG93X3NsZWVw
X2Nsb2Nrcygoc211KSwgKGNsb2NrcykpIDogMCkKLSNkZWZpbmUgc211X25vdGlmeV9zbXVfZW5h
YmxlX3B3ZShzbXUpIFwKLQkoKHNtdSktPmZ1bmNzLT5ub3RpZnlfc211X2VuYWJsZV9wd2UgPyAo
c211KS0+ZnVuY3MtPm5vdGlmeV9zbXVfZW5hYmxlX3B3ZSgoc211KSkgOiAwKQotI2RlZmluZSBz
bXVfc2V0X3dhdGVybWFya3NfZm9yX2Nsb2NrX3JhbmdlcyhzbXUsIGNsb2NrX3JhbmdlcykgXAot
CSgoc211KS0+ZnVuY3MtPnNldF93YXRlcm1hcmtzX2Zvcl9jbG9ja19yYW5nZXMgPyAoc211KS0+
ZnVuY3MtPnNldF93YXRlcm1hcmtzX2Zvcl9jbG9ja19yYW5nZXMoKHNtdSksIChjbG9ja19yYW5n
ZXMpKSA6IDApCitpbnQgc211X25vdGlmeV9zbXVfZW5hYmxlX3B3ZShzdHJ1Y3Qgc211X2NvbnRl
eHQgKnNtdSk7CisKK2ludCBzbXVfc2V0X3dhdGVybWFya3NfZm9yX2Nsb2NrX3JhbmdlcyhzdHJ1
Y3Qgc211X2NvbnRleHQgKnNtdSwKKwkJCQkJc3RydWN0IGRtX3BwX3dtX3NldHNfd2l0aF9jbG9j
a19yYW5nZXNfc29jMTUgKmNsb2NrX3Jhbmdlcyk7CiAjZGVmaW5lIHNtdV9kcG1fc2V0X3V2ZF9l
bmFibGUoc211LCBlbmFibGUpIFwKIAkoKHNtdSktPnBwdF9mdW5jcy0+ZHBtX3NldF91dmRfZW5h
YmxlID8gKHNtdSktPnBwdF9mdW5jcy0+ZHBtX3NldF91dmRfZW5hYmxlKChzbXUpLCAoZW5hYmxl
KSkgOiAwKQogI2RlZmluZSBzbXVfZHBtX3NldF92Y2VfZW5hYmxlKHNtdSwgZW5hYmxlKSBcCiAJ
KChzbXUpLT5wcHRfZnVuY3MtPmRwbV9zZXRfdmNlX2VuYWJsZSA/IChzbXUpLT5wcHRfZnVuY3Mt
PmRwbV9zZXRfdmNlX2VuYWJsZSgoc211KSwgKGVuYWJsZSkpIDogMCkKLSNkZWZpbmUgc211X3Nl
dF94Z21pX3BzdGF0ZShzbXUsIHBzdGF0ZSkgXAotCQkoKHNtdSktPmZ1bmNzLT5zZXRfeGdtaV9w
c3RhdGUgPyAoc211KS0+ZnVuY3MtPnNldF94Z21pX3BzdGF0ZSgoc211KSwgKHBzdGF0ZSkpIDog
MCkKKworaW50IHNtdV9zZXRfeGdtaV9wc3RhdGUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCisJ
CQl1aW50MzJfdCBwc3RhdGUpOwogI2RlZmluZSBzbXVfc2V0X3dhdGVybWFya3NfdGFibGUoc211
LCB0YWIsIGNsb2NrX3JhbmdlcykgXAogCSgoc211KS0+cHB0X2Z1bmNzLT5zZXRfd2F0ZXJtYXJr
c190YWJsZSA/IChzbXUpLT5wcHRfZnVuY3MtPnNldF93YXRlcm1hcmtzX3RhYmxlKChzbXUpLCAo
dGFiKSwgKGNsb2NrX3JhbmdlcykpIDogMCkKICNkZWZpbmUgc211X2dldF9jdXJyZW50X2Nsa19m
cmVxX2J5X3RhYmxlKHNtdSwgY2xrX3R5cGUsIHZhbHVlKSBcCkBAIC03NTksMjIgKzc2NSwxOCBA
QCBzdHJ1Y3Qgc211X2Z1bmNzCiAJKChzbXUpLT5wcHRfZnVuY3MtPmdldF90aGVybWFsX3RlbXBl
cmF0dXJlX3JhbmdlPyAoc211KS0+cHB0X2Z1bmNzLT5nZXRfdGhlcm1hbF90ZW1wZXJhdHVyZV9y
YW5nZSgoc211KSwgKHJhbmdlKSkgOiAwKQogI2RlZmluZSBzbXVfcmVnaXN0ZXJfaXJxX2hhbmRs
ZXIoc211KSBcCiAJKChzbXUpLT5mdW5jcy0+cmVnaXN0ZXJfaXJxX2hhbmRsZXIgPyAoc211KS0+
ZnVuY3MtPnJlZ2lzdGVyX2lycV9oYW5kbGVyKHNtdSkgOiAwKQotI2RlZmluZSBzbXVfc2V0X2F6
YWxpYV9kM19wbWUoc211KSBcCi0JKChzbXUpLT5mdW5jcy0+c2V0X2F6YWxpYV9kM19wbWUgPyAo
c211KS0+ZnVuY3MtPnNldF9hemFsaWFfZDNfcG1lKChzbXUpKSA6IDApCisKK2ludCBzbXVfc2V0
X2F6YWxpYV9kM19wbWUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpOwogI2RlZmluZSBzbXVfZ2V0
X2RwbV91bHRpbWF0ZV9mcmVxKHNtdSwgcGFyYW0sIG1pbiwgbWF4KSBcCiAJCSgoc211KS0+ZnVu
Y3MtPmdldF9kcG1fdWx0aW1hdGVfZnJlcSA/IChzbXUpLT5mdW5jcy0+Z2V0X2RwbV91bHRpbWF0
ZV9mcmVxKChzbXUpLCAocGFyYW0pLCAobWluKSwgKG1heCkpIDogMCkKLSNkZWZpbmUgc211X2dl
dF91Y2xrX2RwbV9zdGF0ZXMoc211LCBjbG9ja3NfaW5fa2h6LCBudW1fc3RhdGVzKSBcCi0JKChz
bXUpLT5wcHRfZnVuY3MtPmdldF91Y2xrX2RwbV9zdGF0ZXMgPyAoc211KS0+cHB0X2Z1bmNzLT5n
ZXRfdWNsa19kcG1fc3RhdGVzKChzbXUpLCAoY2xvY2tzX2luX2toeiksIChudW1fc3RhdGVzKSkg
OiAwKQotI2RlZmluZSBzbXVfZ2V0X21heF9zdXN0YWluYWJsZV9jbG9ja3NfYnlfZGMoc211LCBt
YXhfY2xvY2tzKSBcCi0JKChzbXUpLT5mdW5jcy0+Z2V0X21heF9zdXN0YWluYWJsZV9jbG9ja3Nf
YnlfZGMgPyAoc211KS0+ZnVuY3MtPmdldF9tYXhfc3VzdGFpbmFibGVfY2xvY2tzX2J5X2RjKChz
bXUpLCAobWF4X2Nsb2NrcykpIDogMCkKLSNkZWZpbmUgc211X2JhY29faXNfc3VwcG9ydChzbXUp
IFwKLQkoKHNtdSktPmZ1bmNzLT5iYWNvX2lzX3N1cHBvcnQ/IChzbXUpLT5mdW5jcy0+YmFjb19p
c19zdXBwb3J0KChzbXUpKSA6IGZhbHNlKQotI2RlZmluZSBzbXVfYmFjb19nZXRfc3RhdGUoc211
LCBzdGF0ZSkgXAotCSgoc211KS0+ZnVuY3MtPmJhY29fZ2V0X3N0YXRlPyAoc211KS0+ZnVuY3Mt
PmJhY29fZ2V0X3N0YXRlKChzbXUpLCAoc3RhdGUpKSA6IDApCi0jZGVmaW5lIHNtdV9iYWNvX3Jl
c2V0KHNtdSkgXAotCSgoc211KS0+ZnVuY3MtPmJhY29fcmVzZXQ/IChzbXUpLT5mdW5jcy0+YmFj
b19yZXNldCgoc211KSkgOiAwKQotI2RlZmluZSBzbXVfbW9kZTJfcmVzZXQoc211KSBcCi0JKChz
bXUpLT5mdW5jcy0+bW9kZTJfcmVzZXQ/IChzbXUpLT5mdW5jcy0+bW9kZTJfcmVzZXQoKHNtdSkp
IDogMCkKKworYm9vbCBzbXVfYmFjb19pc19zdXBwb3J0KHN0cnVjdCBzbXVfY29udGV4dCAqc211
KTsKKworaW50IHNtdV9iYWNvX2dldF9zdGF0ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgZW51
bSBzbXVfYmFjb19zdGF0ZSAqc3RhdGUpOworCitpbnQgc211X2JhY29fcmVzZXQoc3RydWN0IHNt
dV9jb250ZXh0ICpzbXUpOworCitpbnQgc211X21vZGUyX3Jlc2V0KHN0cnVjdCBzbXVfY29udGV4
dCAqc211KTsKICNkZWZpbmUgc211X2FzaWNfc2V0X3BlcmZvcm1hbmNlX2xldmVsKHNtdSwgbGV2
ZWwpIFwKIAkoKHNtdSktPnBwdF9mdW5jcy0+c2V0X3BlcmZvcm1hbmNlX2xldmVsPyAoc211KS0+
cHB0X2Z1bmNzLT5zZXRfcGVyZm9ybWFuY2VfbGV2ZWwoKHNtdSksIChsZXZlbCkpIDogLUVJTlZB
TCk7CiAjZGVmaW5lIHNtdV9kdW1wX3BwdGFibGUoc211KSBcCkBAIC04MzMsNyArODM1LDggQEAg
ZXh0ZXJuIGludCBzbXVfZ2V0X2N1cnJlbnRfY2xvY2tzKHN0cnVjdCBzbXVfY29udGV4dCAqc211
LAogZXh0ZXJuIGludCBzbXVfZHBtX3NldF9wb3dlcl9nYXRlKHN0cnVjdCBzbXVfY29udGV4dCAq
c211LHVpbnQzMl90IGJsb2NrX3R5cGUsIGJvb2wgZ2F0ZSk7CiBleHRlcm4gaW50IHNtdV9oYW5k
bGVfdGFzayhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAkJCSAgIGVudW0gYW1kX2RwbV9mb3Jj
ZWRfbGV2ZWwgbGV2ZWwsCi0JCQkgICBlbnVtIGFtZF9wcF90YXNrIHRhc2tfaWQpOworCQkJICAg
ZW51bSBhbWRfcHBfdGFzayB0YXNrX2lkLAorCQkJICAgYm9vbCBsb2NrX25lZWRlZCk7CiBpbnQg
c211X3N3aXRjaF9wb3dlcl9wcm9maWxlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCQkJICAg
ICBlbnVtIFBQX1NNQ19QT1dFUl9QUk9GSUxFIHR5cGUsCiAJCQkgICAgIGJvb2wgZW4pOwpAQCAt
ODQzLDcgKzg0Niw3IEBAIGludCBzbXVfZ2V0X2RwbV9mcmVxX2J5X2luZGV4KHN0cnVjdCBzbXVf
Y29udGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlwCiBpbnQgc211X2dldF9kcG1f
bGV2ZWxfY291bnQoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGVudW0gc211X2Nsa190eXBlIGNs
a190eXBlLAogCQkJICAgIHVpbnQzMl90ICp2YWx1ZSk7CiBpbnQgc211X2dldF9kcG1fZnJlcV9y
YW5nZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgZW51bSBzbXVfY2xrX3R5cGUgY2xrX3R5cGUs
Ci0JCQkgICB1aW50MzJfdCAqbWluLCB1aW50MzJfdCAqbWF4KTsKKwkJCSAgIHVpbnQzMl90ICpt
aW4sIHVpbnQzMl90ICptYXgsIGJvb2wgbG9ja19uZWVkZWQpOwogaW50IHNtdV9zZXRfc29mdF9m
cmVxX3JhbmdlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGtfdHlwZSBjbGtf
dHlwZSwKIAkJCSAgICB1aW50MzJfdCBtaW4sIHVpbnQzMl90IG1heCk7CiBpbnQgc211X3NldF9o
YXJkX2ZyZXFfcmFuZ2Uoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIGVudW0gc211X2Nsa190eXBl
IGNsa190eXBlLApAQCAtODU4LDEwICs4NjEsMjAgQEAgc2l6ZV90IHNtdV9zeXNfZ2V0X3BwX2Zl
YXR1cmVfbWFzayhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgY2hhciAqYnVmKTsKIGludCBzbXVf
c3lzX3NldF9wcF9mZWF0dXJlX21hc2soc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHVpbnQ2NF90
IG5ld19tYXNrKTsKIGludCBzbXVfZm9yY2VfY2xrX2xldmVscyhzdHJ1Y3Qgc211X2NvbnRleHQg
KnNtdSwKIAkJCSBlbnVtIHNtdV9jbGtfdHlwZSBjbGtfdHlwZSwKLQkJCSB1aW50MzJfdCBtYXNr
KTsKKwkJCSB1aW50MzJfdCBtYXNrLAorCQkJIGJvb2wgbG9ja19uZWVkZWQpOwogaW50IHNtdV9z
ZXRfbXAxX3N0YXRlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCQkgICAgICBlbnVtIHBwX21w
MV9zdGF0ZSBtcDFfc3RhdGUpOwogaW50IHNtdV9zZXRfZGZfY3N0YXRlKHN0cnVjdCBzbXVfY29u
dGV4dCAqc211LAogCQkgICAgICBlbnVtIHBwX2RmX2NzdGF0ZSBzdGF0ZSk7CiAKK2ludCBzbXVf
Z2V0X21heF9zdXN0YWluYWJsZV9jbG9ja3NfYnlfZGMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUs
CisJCQkJCSBzdHJ1Y3QgcHBfc211X252X2Nsb2NrX3RhYmxlICptYXhfY2xvY2tzKTsKKworaW50
IHNtdV9nZXRfdWNsa19kcG1fc3RhdGVzKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAorCQkJICAg
IHVuc2lnbmVkIGludCAqY2xvY2tfdmFsdWVzX2luX2toeiwKKwkJCSAgICB1bnNpZ25lZCBpbnQg
Km51bV9zdGF0ZXMpOworCitlbnVtIGFtZF9wbV9zdGF0ZV90eXBlIHNtdV9nZXRfY3VycmVudF9w
b3dlcl9zdGF0ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSk7CisKICNlbmRpZgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvbmF2aTEwX3BwdC5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9wb3dlcnBsYXkvbmF2aTEwX3BwdC5jCmluZGV4IGI4OGFhZTliYjI0Mi4uZWFk
NDBiMjg0MGY5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9uYXZp
MTBfcHB0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvbmF2aTEwX3BwdC5j
CkBAIC03OTUsMTMgKzc5NSwxMyBAQCBzdGF0aWMgaW50IG5hdmkxMF9wb3B1bGF0ZV91bWRfc3Rh
dGVfY2xrKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQogCWludCByZXQgPSAwOwogCXVpbnQzMl90
IG1pbl9zY2xrX2ZyZXEgPSAwLCBtaW5fbWNsa19mcmVxID0gMDsKIAotCXJldCA9IHNtdV9nZXRf
ZHBtX2ZyZXFfcmFuZ2Uoc211LCBTTVVfU0NMSywgJm1pbl9zY2xrX2ZyZXEsIE5VTEwpOworCXJl
dCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211LCBTTVVfU0NMSywgJm1pbl9zY2xrX2ZyZXEs
IE5VTEwsIGZhbHNlKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCiAJc211LT5wc3RhdGVf
c2NsayA9IG1pbl9zY2xrX2ZyZXEgKiAxMDA7CiAKLQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3Jh
bmdlKHNtdSwgU01VX01DTEssICZtaW5fbWNsa19mcmVxLCBOVUxMKTsKKwlyZXQgPSBzbXVfZ2V0
X2RwbV9mcmVxX3JhbmdlKHNtdSwgU01VX01DTEssICZtaW5fbWNsa19mcmVxLCBOVUxMLCBmYWxz
ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtODU0LDcgKzg1NCw3IEBAIHN0YXRp
YyBpbnQgbmF2aTEwX3ByZV9kaXNwbGF5X2NvbmZpZ19jaGFuZ2VkKHN0cnVjdCBzbXVfY29udGV4
dCAqc211KQogCQlyZXR1cm4gcmV0OwogCiAJaWYgKHNtdV9mZWF0dXJlX2lzX2VuYWJsZWQoc211
LCBTTVVfRkVBVFVSRV9EUE1fVUNMS19CSVQpKSB7Ci0JCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFf
cmFuZ2Uoc211LCBTTVVfVUNMSywgTlVMTCwgJm1heF9mcmVxKTsKKwkJcmV0ID0gc211X2dldF9k
cG1fZnJlcV9yYW5nZShzbXUsIFNNVV9VQ0xLLCBOVUxMLCAmbWF4X2ZyZXEsIGZhbHNlKTsKIAkJ
aWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAJCXJldCA9IHNtdV9zZXRfaGFyZF9mcmVxX3Jhbmdl
KHNtdSwgU01VX1VDTEssIDAsIG1heF9mcmVxKTsKQEAgLTkwNCw3ICs5MDQsNyBAQCBzdGF0aWMg
aW50IG5hdmkxMF9mb3JjZV9kcG1fbGltaXRfdmFsdWUoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUs
IGJvb2wgaGlnaGVzdCkKIAogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsa3MpOyBpKysp
IHsKIAkJY2xrX3R5cGUgPSBjbGtzW2ldOwotCQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3Jhbmdl
KHNtdSwgY2xrX3R5cGUsICZtaW5fZnJlcSwgJm1heF9mcmVxKTsKKwkJcmV0ID0gc211X2dldF9k
cG1fZnJlcV9yYW5nZShzbXUsIGNsa190eXBlLCAmbWluX2ZyZXEsICZtYXhfZnJlcSwgZmFsc2Up
OwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIApAQCAtOTMxLDcgKzkzMSw3IEBAIHN0YXRp
YyBpbnQgbmF2aTEwX3VuZm9yY2VfZHBtX2xldmVscyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkK
IAogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsa3MpOyBpKyspIHsKIAkJY2xrX3R5cGUg
PSBjbGtzW2ldOwotCQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNtdSwgY2xrX3R5cGUs
ICZtaW5fZnJlcSwgJm1heF9mcmVxKTsKKwkJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShz
bXUsIGNsa190eXBlLCAmbWluX2ZyZXEsICZtYXhfZnJlcSwgZmFsc2UpOwogCQlpZiAocmV0KQog
CQkJcmV0dXJuIHJldDsKIApAQCAtMTI2Niw3ICsxMjY2LDEwIEBAIHN0YXRpYyBpbnQgbmF2aTEw
X25vdGlmeV9zbWNfZGlzcGFseV9jb25maWcoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCiAJaWYg
KHNtdV9mZWF0dXJlX2lzX3N1cHBvcnRlZChzbXUsIFNNVV9GRUFUVVJFX0RQTV9EQ0VGQ0xLX0JJ
VCkpIHsKIAkJY2xvY2tfcmVxLmNsb2NrX3R5cGUgPSBhbWRfcHBfZGNlZl9jbG9jazsKIAkJY2xv
Y2tfcmVxLmNsb2NrX2ZyZXFfaW5fa2h6ID0gbWluX2Nsb2Nrcy5kY2VmX2Nsb2NrICogMTA7Ci0J
CWlmICghc211X2Rpc3BsYXlfY2xvY2tfdm9sdGFnZV9yZXF1ZXN0KHNtdSwgJmNsb2NrX3JlcSkp
IHsKKworCQlpZiAoc211LT5mdW5jcy0+ZGlzcGxheV9jbG9ja192b2x0YWdlX3JlcXVlc3QpCisJ
CQlyZXQgPSBzbXUtPmZ1bmNzLT5kaXNwbGF5X2Nsb2NrX3ZvbHRhZ2VfcmVxdWVzdChzbXUsICZj
bG9ja19yZXEpOworCQlpZiAoIXJldCkgewogCQkJaWYgKHNtdV9mZWF0dXJlX2lzX3N1cHBvcnRl
ZChzbXUsIFNNVV9GRUFUVVJFX0RTX0RDRUZDTEtfQklUKSkgewogCQkJCXJldCA9IHNtdV9zZW5k
X3NtY19tc2dfd2l0aF9wYXJhbShzbXUsCiAJCQkJCQkJCSAgU01VX01TR19TZXRNaW5EZWVwU2xl
ZXBEY2VmY2xrLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvcmVu
b2lyX3BwdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvcmVub2lyX3BwdC5jCmlu
ZGV4IDZhZWRmZmQ3MzlkYi4uNjAzNmY2ODJlNmY5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL3Bvd2VycGxheS9yZW5vaXJfcHB0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9w
b3dlcnBsYXkvcmVub2lyX3BwdC5jCkBAIC0xOTQsNyArMTk0LDcgQEAgc3RhdGljIGludCByZW5v
aXJfcHJpbnRfY2xrX2xldmVscyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAljYXNlIFNNVV9T
Q0xLOgogCQkvKiByZXRpcnZlIHRhYmxlIHJldHVybmVkIHBhcmFtdGVycyB1bml0IGlzIE1IeiAq
LwogCQljdXJfdmFsdWUgPSBtZXRyaWNzLkNsb2NrRnJlcXVlbmN5W0NMT0NLX0dGWENMS107Ci0J
CXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211LCBTTVVfR0ZYQ0xLLCAmbWluLCAmbWF4
KTsKKwkJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShzbXUsIFNNVV9HRlhDTEssICZtaW4s
ICZtYXgsIGZhbHNlKTsKIAkJaWYgKCFyZXQpIHsKIAkJCS8qIGRyaXZlciBvbmx5IGtub3cgbWlu
L21heCBnZnhfY2xrLCBBZGQgbGV2ZWwgMSBmb3IgYWxsIG90aGVyIGdmeCBjbGtzICovCiAJCQlp
ZiAoY3VyX3ZhbHVlICA9PSBtYXgpCkBAIC0yNTEsNyArMjUxLDYgQEAgc3RhdGljIGVudW0gYW1k
X3BtX3N0YXRlX3R5cGUgcmVub2lyX2dldF9jdXJyZW50X3Bvd2VyX3N0YXRlKHN0cnVjdCBzbXVf
Y29udGV4dAogCSAgICAhc211X2RwbV9jdHgtPmRwbV9jdXJyZW50X3Bvd2VyX3N0YXRlKQogCQly
ZXR1cm4gLUVJTlZBTDsKIAotCW11dGV4X2xvY2soJihzbXUtPm11dGV4KSk7CiAJc3dpdGNoIChz
bXVfZHBtX2N0eC0+ZHBtX2N1cnJlbnRfcG93ZXJfc3RhdGUtPmNsYXNzaWZpY2F0aW9uLnVpX2xh
YmVsKSB7CiAJY2FzZSBTTVVfU1RBVEVfVUlfTEFCRUxfQkFUVEVSWToKIAkJcG1fdHlwZSA9IFBP
V0VSX1NUQVRFX1RZUEVfQkFUVEVSWTsKQEAgLTI2OSw3ICsyNjgsNiBAQCBzdGF0aWMgZW51bSBh
bWRfcG1fc3RhdGVfdHlwZSByZW5vaXJfZ2V0X2N1cnJlbnRfcG93ZXJfc3RhdGUoc3RydWN0IHNt
dV9jb250ZXh0CiAJCQlwbV90eXBlID0gUE9XRVJfU1RBVEVfVFlQRV9ERUZBVUxUOwogCQlicmVh
azsKIAl9Ci0JbXV0ZXhfdW5sb2NrKCYoc211LT5tdXRleCkpOwogCiAJcmV0dXJuIHBtX3R5cGU7
CiB9CkBAIC0zMTQsNyArMzEyLDcgQEAgc3RhdGljIGludCByZW5vaXJfZm9yY2VfZHBtX2xpbWl0
X3ZhbHVlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBib29sIGhpZ2hlc3QpCiAKIAlmb3IgKGkg
PSAwOyBpIDwgQVJSQVlfU0laRShjbGtzKTsgaSsrKSB7CiAJCWNsa190eXBlID0gY2xrc1tpXTsK
LQkJcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShzbXUsIGNsa190eXBlLCAmbWluX2ZyZXEs
ICZtYXhfZnJlcSk7CisJCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211LCBjbGtfdHlw
ZSwgJm1pbl9mcmVxLCAmbWF4X2ZyZXEsIGZhbHNlKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiBy
ZXQ7CiAKQEAgLTM0OCw3ICszNDYsNyBAQCBzdGF0aWMgaW50IHJlbm9pcl91bmZvcmNlX2RwbV9s
ZXZlbHMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpIHsKIAogCQljbGtfdHlwZSA9IGNsa19mZWF0
dXJlX21hcFtpXS5jbGtfdHlwZTsKIAotCQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNt
dSwgY2xrX3R5cGUsICZtaW5fZnJlcSwgJm1heF9mcmVxKTsKKwkJcmV0ID0gc211X2dldF9kcG1f
ZnJlcV9yYW5nZShzbXUsIGNsa190eXBlLCAmbWluX2ZyZXEsICZtYXhfZnJlcSwgZmFsc2UpOwog
CQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIApAQCAtNDM1LDcgKzQzMyw3IEBAIHN0YXRpYyBp
bnQgcmVub2lyX2ZvcmNlX2Nsa19sZXZlbHMoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJCQly
ZXR1cm4gLUVJTlZBTDsKIAkJfQogCi0JCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211
LCBTTVVfR0ZYQ0xLLCAmbWluX2ZyZXEsICZtYXhfZnJlcSk7CisJCXJldCA9IHNtdV9nZXRfZHBt
X2ZyZXFfcmFuZ2Uoc211LCBTTVVfR0ZYQ0xLLCAmbWluX2ZyZXEsICZtYXhfZnJlcSwgZmFsc2Up
OwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAkJcmV0ID0gc211X3NlbmRfc21jX21zZ193
aXRoX3BhcmFtKHNtdSwgU01VX01TR19TZXRTb2Z0TWF4R2Z4Q2xrLApAQCAtNTExLDcgKzUwOSw3
IEBAIHN0YXRpYyBpbnQgcmVub2lyX3NldF9wZWFrX2Nsb2NrX2J5X2RldmljZShzdHJ1Y3Qgc211
X2NvbnRleHQgKnNtdSkKIAlpbnQgcmV0ID0gMDsKIAl1aW50MzJfdCBzY2xrX2ZyZXEgPSAwLCB1
Y2xrX2ZyZXEgPSAwOwogCi0JcmV0ID0gc211X2dldF9kcG1fZnJlcV9yYW5nZShzbXUsIFNNVV9T
Q0xLLCBOVUxMLCAmc2Nsa19mcmVxKTsKKwlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNt
dSwgU01VX1NDTEssIE5VTEwsICZzY2xrX2ZyZXEsIGZhbHNlKTsKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCkBAIC01MTksNyArNTE3LDcgQEAgc3RhdGljIGludCByZW5vaXJfc2V0X3BlYWtf
Y2xvY2tfYnlfZGV2aWNlKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQogCWlmIChyZXQpCiAJCXJl
dHVybiByZXQ7CiAKLQlyZXQgPSBzbXVfZ2V0X2RwbV9mcmVxX3JhbmdlKHNtdSwgU01VX1VDTEss
IE5VTEwsICZ1Y2xrX2ZyZXEpOworCXJldCA9IHNtdV9nZXRfZHBtX2ZyZXFfcmFuZ2Uoc211LCBT
TVVfVUNMSywgTlVMTCwgJnVjbGtfZnJlcSwgZmFsc2UpOwogCWlmIChyZXQpCiAJCXJldHVybiBy
ZXQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTFf
MC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvc211X3YxMV8wLmMKaW5kZXggYjY4
Y2I4YmFkYzc1Li5jYWY4YTM3Mjg1NDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
cG93ZXJwbGF5L3NtdV92MTFfMC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5
L3NtdV92MTFfMC5jCkBAIC04MDksOCArODA5LDExIEBAIHN0YXRpYyBpbnQgc211X3YxMV8wX3Nl
dF9taW5fZGNlZl9kZWVwX3NsZWVwKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQogCWlmICghdGFi
bGVfY29udGV4dCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlyZXR1cm4gc211X3NldF9kZWVwX3Ns
ZWVwX2RjZWZjbGsoc211LAotCQkJCQkgIHRhYmxlX2NvbnRleHQtPmJvb3RfdmFsdWVzLmRjZWZj
bGsgLyAxMDApOworCWlmIChzbXUtPmZ1bmNzLT5zZXRfZGVlcF9zbGVlcF9kY2VmY2xrKQorCQly
ZXR1cm4gc211LT5mdW5jcy0+c2V0X2RlZXBfc2xlZXBfZGNlZmNsayhzbXUsCisJCQkJdGFibGVf
Y29udGV4dC0+Ym9vdF92YWx1ZXMuZGNlZmNsayAvIDEwMCk7CisKKwlyZXR1cm4gMDsKIH0KIAog
c3RhdGljIGludCBzbXVfdjExXzBfc2V0X3Rvb2xfdGFibGVfbG9jYXRpb24oc3RydWN0IHNtdV9j
b250ZXh0ICpzbXUpCkBAIC0xMzI1LDkgKzEzMjgsNyBAQCBzbXVfdjExXzBfZGlzcGxheV9jbG9j
a192b2x0YWdlX3JlcXVlc3Qoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsCiAJCWlmIChjbGtfc2Vs
ZWN0ID09IFNNVV9VQ0xLICYmIHNtdS0+ZGlzYWJsZV91Y2xrX3N3aXRjaCkKIAkJCXJldHVybiAw
OwogCi0JCW11dGV4X2xvY2soJnNtdS0+bXV0ZXgpOwogCQlyZXQgPSBzbXVfc2V0X2hhcmRfZnJl
cV9yYW5nZShzbXUsIGNsa19zZWxlY3QsIGNsa19mcmVxLCAwKTsKLQkJbXV0ZXhfdW5sb2NrKCZz
bXUtPm11dGV4KTsKIAogCQlpZihjbGtfc2VsZWN0ID09IFNNVV9VQ0xLKQogCQkJc211LT5oYXJk
X21pbl91Y2xrX3JlcV9mcm9tX2RhbCA9IGNsa19mcmVxOwpAQCAtMTM3MCwxMiArMTM3MSwxMCBA
QCBzdGF0aWMgaW50IHNtdV92MTFfMF9nZnhfb2ZmX2NvbnRyb2woc3RydWN0IHNtdV9jb250ZXh0
ICpzbXUsIGJvb2wgZW5hYmxlKQogCWNhc2UgQ0hJUF9OQVZJMTI6CiAJCWlmICghKGFkZXYtPnBt
LnBwX2ZlYXR1cmUgJiBQUF9HRlhPRkZfTUFTSykpCiAJCQlyZXR1cm4gMDsKLQkJbXV0ZXhfbG9j
aygmc211LT5tdXRleCk7CiAJCWlmIChlbmFibGUpCiAJCQlyZXQgPSBzbXVfc2VuZF9zbWNfbXNn
KHNtdSwgU01VX01TR19BbGxvd0dmeE9mZik7CiAJCWVsc2UKIAkJCXJldCA9IHNtdV9zZW5kX3Nt
Y19tc2coc211LCBTTVVfTVNHX0Rpc2FsbG93R2Z4T2ZmKTsKLQkJbXV0ZXhfdW5sb2NrKCZzbXUt
Pm11dGV4KTsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJYnJlYWs7CkBAIC0xNDkxLDEwICsxNDkw
LDkgQEAgc3RhdGljIGludCBzbXVfdjExXzBfc2V0X2Zhbl9zcGVlZF9ycG0oc3RydWN0IHNtdV9j
b250ZXh0ICpzbXUsCiAJaWYgKCFzcGVlZCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQltdXRleF9s
b2NrKCYoc211LT5tdXRleCkpOwogCXJldCA9IHNtdV92MTFfMF9hdXRvX2Zhbl9jb250cm9sKHNt
dSwgMCk7CiAJaWYgKHJldCkKLQkJZ290byBzZXRfZmFuX3NwZWVkX3JwbV9mYWlsZWQ7CisJCXJl
dHVybiByZXQ7CiAKIAljcnlzdGFsX2Nsb2NrX2ZyZXEgPSBhbWRncHVfYXNpY19nZXRfeGNsayhh
ZGV2KTsKIAl0YWNoX3BlcmlvZCA9IDYwICogY3J5c3RhbF9jbG9ja19mcmVxICogMTAwMDAgLyAo
OCAqIHNwZWVkKTsKQEAgLTE1MDUsOCArMTUwMyw2IEBAIHN0YXRpYyBpbnQgc211X3YxMV8wX3Nl
dF9mYW5fc3BlZWRfcnBtKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCiAJcmV0ID0gc211X3Yx
MV8wX3NldF9mYW5fc3RhdGljX21vZGUoc211LCBGRE9fUFdNX01PREVfU1RBVElDX1JQTSk7CiAK
LXNldF9mYW5fc3BlZWRfcnBtX2ZhaWxlZDoKLQltdXRleF91bmxvY2soJihzbXUtPm11dGV4KSk7
CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTUxNywxMSArMTUxMyw5IEBAIHN0YXRpYyBpbnQgc211
X3YxMV8wX3NldF94Z21pX3BzdGF0ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAkJCQkgICAg
IHVpbnQzMl90IHBzdGF0ZSkKIHsKIAlpbnQgcmV0ID0gMDsKLQltdXRleF9sb2NrKCYoc211LT5t
dXRleCkpOwogCXJldCA9IHNtdV9zZW5kX3NtY19tc2dfd2l0aF9wYXJhbShzbXUsCiAJCQkJCSAg
U01VX01TR19TZXRYZ21pTW9kZSwKIAkJCQkJICBwc3RhdGUgPyBYR01JX1NUQVRFX0QwIDogWEdN
SV9TVEFURV9EMyk7Ci0JbXV0ZXhfdW5sb2NrKCYoc211LT5tdXRleCkpOwogCXJldHVybiByZXQ7
CiB9CiAKQEAgLTE2MzMsOSArMTYyNyw3IEBAIHN0YXRpYyBpbnQgc211X3YxMV8wX3NldF9hemFs
aWFfZDNfcG1lKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQogewogCWludCByZXQgPSAwOwogCi0J
bXV0ZXhfbG9jaygmc211LT5tdXRleCk7CiAJcmV0ID0gc211X3NlbmRfc21jX21zZyhzbXUsIFNN
VV9NU0dfQmFjb0F1ZGlvRDNQTUUpOwotCW11dGV4X3VubG9jaygmc211LT5tdXRleCk7CiAKIAly
ZXR1cm4gcmV0OwogfQpAQCAtMTc2Nyw3ICsxNzU5LDYgQEAgc3RhdGljIGludCBzbXVfdjExXzBf
Z2V0X2RwbV91bHRpbWF0ZV9mcmVxKHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9j
bGsKIAlpbnQgcmV0ID0gMCwgY2xrX2lkID0gMDsKIAl1aW50MzJfdCBwYXJhbSA9IDA7CiAKLQlt
dXRleF9sb2NrKCZzbXUtPm11dGV4KTsKIAljbGtfaWQgPSBzbXVfY2xrX2dldF9pbmRleChzbXUs
IGNsa190eXBlKTsKIAlpZiAoY2xrX2lkIDwgMCkgewogCQlyZXQgPSAtRUlOVkFMOwpAQCAtMTc5
NCw3ICsxNzg1LDYgQEAgc3RhdGljIGludCBzbXVfdjExXzBfZ2V0X2RwbV91bHRpbWF0ZV9mcmVx
KHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGsKIAl9CiAKIGZhaWxlZDoKLQlt
dXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTJfMC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9wb3dlcnBsYXkvc211X3YxMl8wLmMKaW5kZXggYzk2OTFkMGZiNTIzLi42YmY5NDJk
M2NlY2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTJf
MC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3NtdV92MTJfMC5jCkBAIC0z
MjUsOCArMzI1LDYgQEAgc3RhdGljIGludCBzbXVfdjEyXzBfZ2V0X2RwbV91bHRpbWF0ZV9mcmVx
KHN0cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGsKIAlpbnQgcmV0ID0gMDsKIAl1
aW50MzJfdCBtY2xrX21hc2ssIHNvY19tYXNrOwogCi0JbXV0ZXhfbG9jaygmc211LT5tdXRleCk7
Ci0KIAlpZiAobWF4KSB7CiAJCXJldCA9IHNtdV9nZXRfcHJvZmlsaW5nX2Nsa19tYXNrKHNtdSwg
QU1EX0RQTV9GT1JDRURfTEVWRUxfUFJPRklMRV9QRUFLLAogCQkJCQkJIE5VTEwsCkBAIC0zOTYs
NyArMzk0LDYgQEAgc3RhdGljIGludCBzbXVfdjEyXzBfZ2V0X2RwbV91bHRpbWF0ZV9mcmVxKHN0
cnVjdCBzbXVfY29udGV4dCAqc211LCBlbnVtIHNtdV9jbGsKIAkJfQogCX0KIGZhaWxlZDoKLQlt
dXRleF91bmxvY2soJnNtdS0+bXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3ZlZ2EyMF9wcHQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvcG93ZXJwbGF5L3ZlZ2EyMF9wcHQuYwppbmRleCBhNzZmZmQ1ODQwNGUuLmMyNDlk
ZjkyNTZjNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dlcnBsYXkvdmVnYTIw
X3BwdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvcG93ZXJwbGF5L3ZlZ2EyMF9wcHQuYwpA
QCAtNjM1LDcgKzYzNSw2IEBAIGFtZF9wbV9zdGF0ZV90eXBlIHZlZ2EyMF9nZXRfY3VycmVudF9w
b3dlcl9zdGF0ZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSkKIAkgICAgIXNtdV9kcG1fY3R4LT5k
cG1fY3VycmVudF9wb3dlcl9zdGF0ZSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQltdXRleF9sb2Nr
KCYoc211LT5tdXRleCkpOwogCXN3aXRjaCAoc211X2RwbV9jdHgtPmRwbV9jdXJyZW50X3Bvd2Vy
X3N0YXRlLT5jbGFzc2lmaWNhdGlvbi51aV9sYWJlbCkgewogCWNhc2UgU01VX1NUQVRFX1VJX0xB
QkVMX0JBVFRFUlk6CiAJCXBtX3R5cGUgPSBQT1dFUl9TVEFURV9UWVBFX0JBVFRFUlk7CkBAIC02
NTMsNyArNjUyLDYgQEAgYW1kX3BtX3N0YXRlX3R5cGUgdmVnYTIwX2dldF9jdXJyZW50X3Bvd2Vy
X3N0YXRlKHN0cnVjdCBzbXVfY29udGV4dCAqc211KQogCQkJcG1fdHlwZSA9IFBPV0VSX1NUQVRF
X1RZUEVfREVGQVVMVDsKIAkJYnJlYWs7CiAJfQotCW11dGV4X3VubG9jaygmKHNtdS0+bXV0ZXgp
KTsKIAogCXJldHVybiBwbV90eXBlOwogfQpAQCAtMTI3Nyw4ICsxMjc1LDYgQEAgc3RhdGljIGlu
dCB2ZWdhMjBfZm9yY2VfY2xrX2xldmVscyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAl1aW50
MzJfdCBzb2Z0X21pbl9sZXZlbCwgc29mdF9tYXhfbGV2ZWwsIGhhcmRfbWluX2xldmVsOwogCWlu
dCByZXQgPSAwOwogCi0JbXV0ZXhfbG9jaygmKHNtdS0+bXV0ZXgpKTsKLQogCXNvZnRfbWluX2xl
dmVsID0gbWFzayA/IChmZnMobWFzaykgLSAxKSA6IDA7CiAJc29mdF9tYXhfbGV2ZWwgPSBtYXNr
ID8gKGZscyhtYXNrKSAtIDEpIDogMDsKIApAQCAtMTQzMSw3ICsxNDI3LDYgQEAgc3RhdGljIGlu
dCB2ZWdhMjBfZm9yY2VfY2xrX2xldmVscyhzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAkJYnJl
YWs7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCYoc211LT5tdXRleCkpOwogCXJldHVybiByZXQ7CiB9
CiAKQEAgLTE0NDYsOCArMTQ0MSw2IEBAIHN0YXRpYyBpbnQgdmVnYTIwX2dldF9jbG9ja19ieV90
eXBlX3dpdGhfbGF0ZW5jeShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAogCWRwbV90YWJsZSA9
IHNtdV9kcG0tPmRwbV9jb250ZXh0OwogCi0JbXV0ZXhfbG9jaygmc211LT5tdXRleCk7Ci0KIAlz
d2l0Y2ggKGNsa190eXBlKSB7CiAJY2FzZSBTTVVfR0ZYQ0xLOgogCQlzaW5nbGVfZHBtX3RhYmxl
ID0gJihkcG1fdGFibGUtPmdmeF90YWJsZSk7CkBAIC0xNDY5LDcgKzE0NjIsNiBAQCBzdGF0aWMg
aW50IHZlZ2EyMF9nZXRfY2xvY2tfYnlfdHlwZV93aXRoX2xhdGVuY3koc3RydWN0IHNtdV9jb250
ZXh0ICpzbXUsCiAJCXJldCA9IC1FSU5WQUw7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZzbXUtPm11
dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0yNTQyLDggKzI1MzQsNiBAQCBzdGF0aWMgaW50
IHZlZ2EyMF9zZXRfb2RfcGVyY2VudGFnZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwKIAlpbnQg
ZmVhdHVyZV9lbmFibGVkOwogCVBQQ0xLX2UgY2xrX2lkOwogCi0JbXV0ZXhfbG9jaygmKHNtdS0+
bXV0ZXgpKTsKLQogCWRwbV90YWJsZSA9IHNtdV9kcG0tPmRwbV9jb250ZXh0OwogCWdvbGRlbl90
YWJsZSA9IHNtdV9kcG0tPmdvbGRlbl9kcG1fY29udGV4dDsKIApAQCAtMjU5MywxMSArMjU4Mywx
MCBAQCBzdGF0aWMgaW50IHZlZ2EyMF9zZXRfb2RfcGVyY2VudGFnZShzdHJ1Y3Qgc211X2NvbnRl
eHQgKnNtdSwKIAl9CiAKIAlyZXQgPSBzbXVfaGFuZGxlX3Rhc2soc211LCBzbXVfZHBtLT5kcG1f
bGV2ZWwsCi0JCQkgICAgICBBTURfUFBfVEFTS19SRUFESlVTVF9QT1dFUl9TVEFURSk7CisJCQkg
ICAgICBBTURfUFBfVEFTS19SRUFESlVTVF9QT1dFUl9TVEFURSwKKwkJCSAgICAgIGZhbHNlKTsK
IAogc2V0X29kX2ZhaWxlZDoKLQltdXRleF91bmxvY2soJihzbXUtPm11dGV4KSk7Ci0KIAlyZXR1
cm4gcmV0OwogfQogCkBAIC0yODIyLDEwICsyODExLDkgQEAgc3RhdGljIGludCB2ZWdhMjBfb2Ru
X2VkaXRfZHBtX3RhYmxlKHN0cnVjdCBzbXVfY29udGV4dCAqc211LAogCX0KIAogCWlmICh0eXBl
ID09IFBQX09EX0NPTU1JVF9EUE1fVEFCTEUpIHsKLQkJbXV0ZXhfbG9jaygmKHNtdS0+bXV0ZXgp
KTsKIAkJcmV0ID0gc211X2hhbmRsZV90YXNrKHNtdSwgc211X2RwbS0+ZHBtX2xldmVsLAotCQkJ
CSAgICAgIEFNRF9QUF9UQVNLX1JFQURKVVNUX1BPV0VSX1NUQVRFKTsKLQkJbXV0ZXhfdW5sb2Nr
KCYoc211LT5tdXRleCkpOworCQkJCSAgICAgIEFNRF9QUF9UQVNLX1JFQURKVVNUX1BPV0VSX1NU
QVRFLAorCQkJCSAgICAgIGZhbHNlKTsKIAl9CiAKIAlyZXR1cm4gcmV0OwotLSAKMi4yMy4wCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1h
aWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
