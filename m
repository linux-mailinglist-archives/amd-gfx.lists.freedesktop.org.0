Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3C5A8CA0B0
	for <lists+amd-gfx@lfdr.de>; Thu,  3 Oct 2019 16:55:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9CC5289E33;
	Thu,  3 Oct 2019 14:55:05 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM03-CO1-obe.outbound.protection.outlook.com
 (mail-eopbgr790043.outbound.protection.outlook.com [40.107.79.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 06DB789D7C
 for <amd-gfx@lists.freedesktop.org>; Thu,  3 Oct 2019 14:55:03 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=lwKfljzxSnfL1L55fUKoAXZRsdCR9x5PgGX5NwAg21k3sRHgVTH08e4KByuw7wKVImkoRw7MyBQ23vhgsBupmDAIwRktrRpy1aL5z1CNCVZW30yI9ELOLjByacEWCQpTsI5C3wG5FxbQO2dKDtFt5TazZPRW/FEtzuE4tgqVJNJgWoEidIpwagzg2nwOjBGvDf1id+YNpIGNyw5oWpJgPwJ09A9KazoqMy0LqX0PeHN7e/ECoM4xpA+gokQnOATVqs5SS2wK1jGBYWJ+12gaE71sWdni/9sRg1nXEnDoQcgT/zfxweIAmK0FWdGmyIi6MXo0BDRWOkY8U60jXtUN6Q==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=ac934izu/LyMC+j+NXvlagsGBvhH4GolshUSPu00reI=;
 b=bm/ignGOEmhmAxcfYx87t7rwAuxCC3zb+FeRH1zzQ0zb7bqnvX31bhP0IiMl1PGWC6AHQVstOUM4b918EFcPeBHntuK6ETEOGQDUeq1aRQSzEYATQWzyxdgv744Q/gHZePVwkp8lqGRap/FL7KTFaiwVeXmsymlJcL3Le+SjuJIajQ8rA7Cfcx6cIwc3IExNkyR7fpr7QOpA+P0k+vBCTJzF1p9NrFxLsLrlJ1CzKQPTTaH6mIwCzPM3ewxKYVawnLfuz7WC4+cqAKTUsW4KAlVrzy0Ku7egrTTVdRcazmYFX8SPOdR9093mq4gdwgUA03YJcZvZLMhNrP+PZfhjqg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org smtp.mailfrom=amd.com; 
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from BN4PR12CA0020.namprd12.prod.outlook.com (2603:10b6:403:2::30)
 by BN8PR12MB3284.namprd12.prod.outlook.com (2603:10b6:408:9a::10) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2305.20; Thu, 3 Oct
 2019 14:55:00 +0000
Received: from BY2NAM03FT045.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e4a::205) by BN4PR12CA0020.outlook.office365.com
 (2603:10b6:403:2::30) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2305.15 via Frontend
 Transport; Thu, 3 Oct 2019 14:54:59 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV02.amd.com (165.204.84.17) by
 BY2NAM03FT045.mail.protection.outlook.com (10.152.85.113) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2327.20 via Frontend Transport; Thu, 3 Oct 2019 14:54:59 +0000
Received: from blakha.amd.com (10.180.168.240) by SATLEXCHOV02.amd.com
 (10.181.40.72) with Microsoft SMTP Server id 14.3.389.1; Thu, 3 Oct 2019
 09:54:56 -0500
From: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
To: <harry.wentland@amd.com>, <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 03/11] drm/amd/display: Add execution and transition states
 for HDCP2.2
Date: Thu, 3 Oct 2019 10:54:33 -0400
Message-ID: <20191003145441.28952-4-Bhawanpreet.Lakha@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191003145441.28952-1-Bhawanpreet.Lakha@amd.com>
References: <20191003145441.28952-1-Bhawanpreet.Lakha@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(376002)(136003)(39850400004)(396003)(346002)(428003)(199004)(189003)(8936002)(47776003)(26005)(186003)(446003)(86362001)(2906002)(1076003)(4326008)(126002)(11346002)(81166006)(81156014)(476003)(2616005)(8676002)(486006)(6666004)(336012)(51416003)(478600001)(426003)(50226002)(7696005)(76176011)(316002)(70206006)(53416004)(5660300002)(110136005)(305945005)(14444005)(48376002)(356004)(50466002)(36756003)(70586007)(30864003)(16586007)(579004)(559001)(569006);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN8PR12MB3284; H:SATLEXCHOV02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 4b977764-e50e-4ced-6b94-08d74811a9db
X-MS-TrafficTypeDiagnostic: BN8PR12MB3284:
X-Microsoft-Antispam-PRVS: <BN8PR12MB3284A33A081FA8161DFF9174F99F0@BN8PR12MB3284.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:8882;
X-Forefront-PRVS: 01792087B6
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: VvESnweoe0121Fe2CkfMXkAlo/HakCfAjx6gHClB6BrxsuXTAaILE/zQmrtyASqaYDXvNWr843vhuCFSbVWjZ1fAfKv7kYeRYKqpLpWOoaJbXKO+pNljEN3JFKHCClzpAeplSDd4NxujuOeTTHp3HDXbUz0Y2eLubYuaOT+IwuPFBSa0bbLQjnlDawdvUBbRqRe2mjnrteMIjLLC4mW4nSFfjXhScprId3zL8f0vL8pBolplSVfEbB/MGKRtBpyjctbcAH+R5qLwdaRn2zsMZdRAxTJn3CtVpxlT46rPQmWiMtATnIw7pZgtpO5NeFxCKzgbzhdmwSV6p0Qm2/Gl/ABh3NRG54onPrXNeA8Jv3ucjvSzqS4nWNqKWVpJG4xk+EBVTy2ZQ8huUQmBNiv9UBfgdg9jlhC0RRWwIfwnKZc=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 03 Oct 2019 14:54:59.5966 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 4b977764-e50e-4ced-6b94-08d74811a9db
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN8PR12MB3284
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=ac934izu/LyMC+j+NXvlagsGBvhH4GolshUSPu00reI=;
 b=zqIxkcBj7eGG9EV9QGrOc7XTahQBK6ov2+8X+fdoUyX5K7Pnipo12o3umhuIpzzi214UQCJoM7oQgZoCgyYE2IeN5dWc6WAofLiavrDOMh29w8cA+1t1tBTiSE7FXllyppEzpN+TfmZezuy9EUc5sj0Dq5WtX+kXna9z2HW2CjI=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhlIG1vZHVsZSB3b3JrcyBsaWtlIGEgc3RhdGUgbWFjaGluZQoKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgKy0tLS0tLS0tLS0tLS0rCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAtLS0tLS0+IHwgRXhlY3V0aW9uLmMgfCAtLS0tLS0KICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHwgICAgICAgKy0tLS0tLS0tLS0tLS0rICAgICAgIHwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFYKICAgICstLS0tKyAgICAg
ICAgICAgICAgKy0tLS0tLS0tKyAgICAgICAgICAgICAgICAgKy0tLS0tLS0tLS0tLS0tKwogICAg
fCBETSB8ICAgIC0tLS0tPiAgICB8IEhkY3AuYyB8ICA8LS0tLS0tLS0tLS0tICB8IFRyYW5zaXRp
b24uYyB8CiAgICArLS0tLSsgICAgPC0tLS0tICAgICstLS0tLS0tLSsgICAgICAgICAgICAgICAg
ICstLS0tLS0tLS0tLS0tLSsKClRoaXMgcGF0Y2ggYWRkcyB0aGUgZXhlY3V0aW9uIGFuZCB0cmFu
c2l0aW9uIGZpbGVzIGZvciAyLjIKCkV4dGVuc2lvbiB0byAiNDBhNzAyZDQyNyBkcm0vYW1kL2Rp
c3BsYXk6IEFkZCBIRENQIG1vZHVsZSIgZm9yIDIuMgoKU2lnbmVkLW9mZi1ieTogQmhhd2FucHJl
ZXQgTGFraGEgPEJoYXdhbnByZWV0Lkxha2hhQGFtZC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vYW1k
L2Rpc3BsYXkvbW9kdWxlcy9oZGNwL01ha2VmaWxlIHwgICAzICstCiAuLi4vZ3B1L2RybS9hbWQv
ZGlzcGxheS9tb2R1bGVzL2hkY3AvaGRjcC5jICAgfCAgODYgKy0KIC4uLi9ncHUvZHJtL2FtZC9k
aXNwbGF5L21vZHVsZXMvaGRjcC9oZGNwLmggICB8IDEyNyArKysKIC4uLi9kaXNwbGF5L21vZHVs
ZXMvaGRjcC9oZGNwMl9leGVjdXRpb24uYyAgICB8IDg4MSArKysrKysrKysrKysrKysrKysKIC4u
Li9kaXNwbGF5L21vZHVsZXMvaGRjcC9oZGNwMl90cmFuc2l0aW9uLmMgICB8IDY3NCArKysrKysr
KysrKysrKwogLi4uL2RybS9hbWQvZGlzcGxheS9tb2R1bGVzL2luYy9tb2RfaGRjcC5oICAgIHwg
ICAyICsKIDYgZmlsZXMgY2hhbmdlZCwgMTc2NCBpbnNlcnRpb25zKCspLCA5IGRlbGV0aW9ucygt
KQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9tb2R1bGVz
L2hkY3AvaGRjcDJfZXhlY3V0aW9uLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9k
cm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9oZGNwL2hkY3AyX3RyYW5zaXRpb24uYwoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9tb2R1bGVzL2hkY3AvTWFrZWZpbGUgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9oZGNwL01ha2VmaWxlCmluZGV4IDFj
M2M2ZDQ3OTczYS4uOTA0NDI0ZGEwMWI1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2Rpc3BsYXkvbW9kdWxlcy9oZGNwL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
ZGlzcGxheS9tb2R1bGVzL2hkY3AvTWFrZWZpbGUKQEAgLTI0LDcgKzI0LDggQEAKICMKIAogSERD
UCA9IGhkY3BfZGRjLm8gaGRjcF9sb2cubyBoZGNwX3BzcC5vIGhkY3AubyBcCi0JCWhkY3AxX2V4
ZWN1dGlvbi5vIGhkY3AxX3RyYW5zaXRpb24ubworCQloZGNwMV9leGVjdXRpb24ubyBoZGNwMV90
cmFuc2l0aW9uLm8gXAorCQloZGNwMl9leGVjdXRpb24ubyBoZGNwMl90cmFuc2l0aW9uLm8KIAog
QU1EX0RBTF9IRENQID0gJChhZGRwcmVmaXggJChBTUREQUxQQVRIKS9tb2R1bGVzL2hkY3AvLCQo
SERDUCkpCiAjJChpbmZvICoqKioqKioqKioqKiAgREFMLUhEQ1BfTUFLRUZJTEUgKioqKioqKioq
KioqKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L21vZHVsZXMvaGRj
cC9oZGNwLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9oZGNwL2hkY3Au
YwppbmRleCBkN2FjNDQ1ZGVjNmYuLmE3NDgxMjk3Nzk2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9kaXNwbGF5L21vZHVsZXMvaGRjcC9oZGNwLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9kaXNwbGF5L21vZHVsZXMvaGRjcC9oZGNwLmMKQEAgLTM3LDI0ICszNyw1MiBAQCBz
dGF0aWMgdm9pZCBwdXNoX2Vycm9yX3N0YXR1cyhzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCiAJCUhE
Q1BfRVJST1JfVFJBQ0UoaGRjcCwgc3RhdHVzKTsKIAl9CiAKLQloZGNwLT5jb25uZWN0aW9uLmhk
Y3AxX3JldHJ5X2NvdW50Kys7CisJaWYgKGlzX2hkY3AxKGhkY3ApKSB7CisJCWhkY3AtPmNvbm5l
Y3Rpb24uaGRjcDFfcmV0cnlfY291bnQrKzsKKwl9IGVsc2UgaWYgKGlzX2hkY3AyKGhkY3ApKSB7
CisJCWhkY3AtPmNvbm5lY3Rpb24uaGRjcDJfcmV0cnlfY291bnQrKzsKKwl9CiB9CiAKIHN0YXRp
YyB1aW50OF90IGlzX2NwX2Rlc2lyZWRfaGRjcDEoc3RydWN0IG1vZF9oZGNwICpoZGNwKQogewot
CWludCBpLCBkaXNwbGF5X2VuYWJsZWQgPSAwOworCWludCBpLCBpc19hdXRoX25lZWRlZCA9IDA7
CiAKLQkvKiBpZiBhbGwgZGlzcGxheXMgb24gdGhlIGxpbmsgYXJlIGRpc2FibGVkLCBoZGNwIGlz
IG5vdCBkZXNpcmVkICovCisJLyogaWYgYWxsIGRpc3BsYXlzIG9uIHRoZSBsaW5rIGRvbid0IG5l
ZWQgYXV0aGVudGljYXRpb24sCisJICogaGRjcCBpcyBub3QgZGVzaXJlZAorCSAqLwogCWZvciAo
aSA9IDA7IGkgPCBNQVhfTlVNX09GX0RJU1BMQVlTOyBpKyspIHsKIAkJaWYgKGhkY3AtPmNvbm5l
Y3Rpb24uZGlzcGxheXNbaV0uc3RhdGUgIT0gTU9EX0hEQ1BfRElTUExBWV9JTkFDVElWRSAmJgog
CQkJCSFoZGNwLT5jb25uZWN0aW9uLmRpc3BsYXlzW2ldLmFkanVzdC5kaXNhYmxlKSB7Ci0JCQlk
aXNwbGF5X2VuYWJsZWQgPSAxOworCQkJaXNfYXV0aF9uZWVkZWQgPSAxOwogCQkJYnJlYWs7CiAJ
CX0KIAl9CiAKIAlyZXR1cm4gKGhkY3AtPmNvbm5lY3Rpb24uaGRjcDFfcmV0cnlfY291bnQgPCBN
QVhfTlVNX09GX0FUVEVNUFRTKSAmJgotCQkJZGlzcGxheV9lbmFibGVkICYmICFoZGNwLT5jb25u
ZWN0aW9uLmxpbmsuYWRqdXN0LmhkY3AxLmRpc2FibGU7CisJCQlpc19hdXRoX25lZWRlZCAmJgor
CQkJIWhkY3AtPmNvbm5lY3Rpb24ubGluay5hZGp1c3QuaGRjcDEuZGlzYWJsZTsKK30KKworc3Rh
dGljIHVpbnQ4X3QgaXNfY3BfZGVzaXJlZF9oZGNwMihzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCit7
CisJaW50IGksIGlzX2F1dGhfbmVlZGVkID0gMDsKKworCS8qIGlmIGFsbCBkaXNwbGF5cyBvbiB0
aGUgbGluayBkb24ndCBuZWVkIGF1dGhlbnRpY2F0aW9uLAorCSAqIGhkY3AgaXMgbm90IGRlc2ly
ZWQKKwkgKi8KKwlmb3IgKGkgPSAwOyBpIDwgTUFYX05VTV9PRl9ESVNQTEFZUzsgaSsrKSB7CisJ
CWlmIChoZGNwLT5jb25uZWN0aW9uLmRpc3BsYXlzW2ldLnN0YXRlICE9IE1PRF9IRENQX0RJU1BM
QVlfSU5BQ1RJVkUgJiYKKwkJCQkhaGRjcC0+Y29ubmVjdGlvbi5kaXNwbGF5c1tpXS5hZGp1c3Qu
ZGlzYWJsZSkgeworCQkJaXNfYXV0aF9uZWVkZWQgPSAxOworCQkJYnJlYWs7CisJCX0KKwl9CisK
KwlyZXR1cm4gKGhkY3AtPmNvbm5lY3Rpb24uaGRjcDJfcmV0cnlfY291bnQgPCBNQVhfTlVNX09G
X0FUVEVNUFRTKSAmJgorCQkJaXNfYXV0aF9uZWVkZWQgJiYKKwkJCSFoZGNwLT5jb25uZWN0aW9u
LmxpbmsuYWRqdXN0LmhkY3AyLmRpc2FibGUgJiYKKwkJCSFoZGNwLT5jb25uZWN0aW9uLmlzX2hk
Y3AyX3Jldm9rZWQ7CiB9CiAKIHN0YXRpYyBlbnVtIG1vZF9oZGNwX3N0YXR1cyBleGVjdXRpb24o
c3RydWN0IG1vZF9oZGNwICpoZGNwLApAQCAtODIsNiArMTEwLDExIEBAIHN0YXRpYyBlbnVtIG1v
ZF9oZGNwX3N0YXR1cyBleGVjdXRpb24oc3RydWN0IG1vZF9oZGNwICpoZGNwLAogCX0gZWxzZSBp
ZiAoaXNfaW5faGRjcDFfZHBfc3RhdGVzKGhkY3ApKSB7CiAJCXN0YXR1cyA9IG1vZF9oZGNwX2hk
Y3AxX2RwX2V4ZWN1dGlvbihoZGNwLAogCQkJCWV2ZW50X2N0eCwgJmlucHV0LT5oZGNwMSk7CisJ
fSBlbHNlIGlmIChpc19pbl9oZGNwMl9zdGF0ZXMoaGRjcCkpIHsKKwkJc3RhdHVzID0gbW9kX2hk
Y3BfaGRjcDJfZXhlY3V0aW9uKGhkY3AsIGV2ZW50X2N0eCwgJmlucHV0LT5oZGNwMik7CisJfSBl
bHNlIGlmIChpc19pbl9oZGNwMl9kcF9zdGF0ZXMoaGRjcCkpIHsKKwkJc3RhdHVzID0gbW9kX2hk
Y3BfaGRjcDJfZHBfZXhlY3V0aW9uKGhkY3AsCisJCQkJZXZlbnRfY3R4LCAmaW5wdXQtPmhkY3Ay
KTsKIAl9CiBvdXQ6CiAJcmV0dXJuIHN0YXR1czsKQEAgLTk5LDcgKzEzMiwxMCBAQCBzdGF0aWMg
ZW51bSBtb2RfaGRjcF9zdGF0dXMgdHJhbnNpdGlvbihzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCiAK
IAlpZiAoaXNfaW5faW5pdGlhbGl6ZWRfc3RhdGUoaGRjcCkpIHsKIAkJaWYgKGlzX2RwX2hkY3Ao
aGRjcCkpCi0JCQlpZiAoaXNfY3BfZGVzaXJlZF9oZGNwMShoZGNwKSkgeworCQkJaWYgKGlzX2Nw
X2Rlc2lyZWRfaGRjcDIoaGRjcCkpIHsKKwkJCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOwor
CQkJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEQyX0EwX0RFVEVSTUlORV9SWF9IRENQX0NB
UEFCTEUpOworCQkJfSBlbHNlIGlmIChpc19jcF9kZXNpcmVkX2hkY3AxKGhkY3ApKSB7CiAJCQkJ
Y2FsbGJhY2tfaW5fbXMoMCwgb3V0cHV0KTsKIAkJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0
LCBEMV9BMF9ERVRFUk1JTkVfUlhfSERDUF9DQVBBQkxFKTsKIAkJCX0gZWxzZSB7CkBAIC0xMDcs
NyArMTQzLDEwIEBAIHN0YXRpYyBlbnVtIG1vZF9oZGNwX3N0YXR1cyB0cmFuc2l0aW9uKHN0cnVj
dCBtb2RfaGRjcCAqaGRjcCwKIAkJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBIRENQX0NQ
X05PVF9ERVNJUkVEKTsKIAkJCX0KIAkJZWxzZSBpZiAoaXNfaGRtaV9kdmlfc2xfaGRjcChoZGNw
KSkKLQkJCWlmIChpc19jcF9kZXNpcmVkX2hkY3AxKGhkY3ApKSB7CisJCQlpZiAoaXNfY3BfZGVz
aXJlZF9oZGNwMihoZGNwKSkgeworCQkJCWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCQkJ
c2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1dCwgSDJfQTBfS05PV05fSERDUDJfQ0FQQUJMRV9SWCk7
CisJCQl9IGVsc2UgaWYgKGlzX2NwX2Rlc2lyZWRfaGRjcDEoaGRjcCkpIHsKIAkJCQljYWxsYmFj
a19pbl9tcygwLCBvdXRwdXQpOwogCQkJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEgxX0Ew
X1dBSVRfRk9SX0FDVElWRV9SWCk7CiAJCQl9IGVsc2UgewpAQCAtMTI2LDYgKzE2NSwxMiBAQCBz
dGF0aWMgZW51bSBtb2RfaGRjcF9zdGF0dXMgdHJhbnNpdGlvbihzdHJ1Y3QgbW9kX2hkY3AgKmhk
Y3AsCiAJfSBlbHNlIGlmIChpc19pbl9oZGNwMV9kcF9zdGF0ZXMoaGRjcCkpIHsKIAkJc3RhdHVz
ID0gbW9kX2hkY3BfaGRjcDFfZHBfdHJhbnNpdGlvbihoZGNwLAogCQkJCWV2ZW50X2N0eCwgJmlu
cHV0LT5oZGNwMSwgb3V0cHV0KTsKKwl9IGVsc2UgaWYgKGlzX2luX2hkY3AyX3N0YXRlcyhoZGNw
KSkgeworCQlzdGF0dXMgPSBtb2RfaGRjcF9oZGNwMl90cmFuc2l0aW9uKGhkY3AsCisJCQkJZXZl
bnRfY3R4LCAmaW5wdXQtPmhkY3AyLCBvdXRwdXQpOworCX0gZWxzZSBpZiAoaXNfaW5faGRjcDJf
ZHBfc3RhdGVzKGhkY3ApKSB7CisJCXN0YXR1cyA9IG1vZF9oZGNwX2hkY3AyX2RwX3RyYW5zaXRp
b24oaGRjcCwKKwkJCQlldmVudF9jdHgsICZpbnB1dC0+aGRjcDIsIG91dHB1dCk7CiAJfSBlbHNl
IHsKIAkJc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVTX0lOVkFMSURfU1RBVEU7CiAJfQpAQCAtMTM5
LDkgKzE4NCwxMyBAQCBzdGF0aWMgZW51bSBtb2RfaGRjcF9zdGF0dXMgcmVzZXRfYXV0aGVudGlj
YXRpb24oc3RydWN0IG1vZF9oZGNwICpoZGNwLAogCWVudW0gbW9kX2hkY3Bfc3RhdHVzIHN0YXR1
cyA9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTOwogCiAJaWYgKGlzX2hkY3AxKGhkY3ApKSB7Ci0J
CWlmIChoZGNwLT5hdXRoLnRyYW5zX2lucHV0LmhkY3AxLmNyZWF0ZV9zZXNzaW9uICE9IFVOS05P
V04pCisJCWlmIChoZGNwLT5hdXRoLnRyYW5zX2lucHV0LmhkY3AxLmNyZWF0ZV9zZXNzaW9uICE9
IFVOS05PV04pIHsKKwkJCS8qIFRPRE8gLSB1cGRhdGUgcHNwIHRvIHVuaWZ5IGNyZWF0ZSBzZXNz
aW9uIGZhaWx1cmUKKwkJCSAqIHJlY292ZXJ5IGJldHdlZW4gaGRjcDEgYW5kIDIuCisJCQkgKi8K
IAkJCW1vZF9oZGNwX2hkY3AxX2Rlc3Ryb3lfc2Vzc2lvbihoZGNwKTsKIAorCQl9CiAJCWlmICho
ZGNwLT5hdXRoLnRyYW5zX2lucHV0LmhkY3AxLmFkZF90b3BvbG9neSA9PSBQQVNTKSB7CiAJCQlz
dGF0dXMgPSBtb2RfaGRjcF9yZW1vdmVfZGlzcGxheV90b3BvbG9neShoZGNwKTsKIAkJCWlmIChz
dGF0dXMgIT0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1MpIHsKQEAgLTE1NCw2ICsyMDMsMjcgQEAg
c3RhdGljIGVudW0gbW9kX2hkY3Bfc3RhdHVzIHJlc2V0X2F1dGhlbnRpY2F0aW9uKHN0cnVjdCBt
b2RfaGRjcCAqaGRjcCwKIAkJbWVtc2V0KCZoZGNwLT5hdXRoLCAwLCBzaXplb2Yoc3RydWN0IG1v
ZF9oZGNwX2F1dGhlbnRpY2F0aW9uKSk7CiAJCW1lbXNldCgmaGRjcC0+c3RhdGUsIDAsIHNpemVv
ZihzdHJ1Y3QgbW9kX2hkY3Bfc3RhdGUpKTsKIAkJc2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1dCwg
SERDUF9JTklUSUFMSVpFRCk7CisJfSBlbHNlIGlmIChpc19oZGNwMihoZGNwKSkgeworCQlpZiAo
aGRjcC0+YXV0aC50cmFuc19pbnB1dC5oZGNwMi5jcmVhdGVfc2Vzc2lvbiA9PSBQQVNTKSB7CisJ
CQlzdGF0dXMgPSBtb2RfaGRjcF9oZGNwMl9kZXN0cm95X3Nlc3Npb24oaGRjcCk7CisJCQlpZiAo
c3RhdHVzICE9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTKSB7CisJCQkJb3V0cHV0LT5jYWxsYmFj
a19uZWVkZWQgPSAwOworCQkJCW91dHB1dC0+d2F0Y2hkb2dfdGltZXJfbmVlZGVkID0gMDsKKwkJ
CQlnb3RvIG91dDsKKwkJCX0KKwkJfQorCQlpZiAoaGRjcC0+YXV0aC50cmFuc19pbnB1dC5oZGNw
Mi5hZGRfdG9wb2xvZ3kgPT0gUEFTUykgeworCQkJc3RhdHVzID0gbW9kX2hkY3BfcmVtb3ZlX2Rp
c3BsYXlfdG9wb2xvZ3koaGRjcCk7CisJCQlpZiAoc3RhdHVzICE9IE1PRF9IRENQX1NUQVRVU19T
VUNDRVNTKSB7CisJCQkJb3V0cHV0LT5jYWxsYmFja19uZWVkZWQgPSAwOworCQkJCW91dHB1dC0+
d2F0Y2hkb2dfdGltZXJfbmVlZGVkID0gMDsKKwkJCQlnb3RvIG91dDsKKwkJCX0KKwkJfQorCQlI
RENQX1RPUF9SRVNFVF9BVVRIX1RSQUNFKGhkY3ApOworCQltZW1zZXQoJmhkY3AtPmF1dGgsIDAs
IHNpemVvZihzdHJ1Y3QgbW9kX2hkY3BfYXV0aGVudGljYXRpb24pKTsKKwkJbWVtc2V0KCZoZGNw
LT5zdGF0ZSwgMCwgc2l6ZW9mKHN0cnVjdCBtb2RfaGRjcF9zdGF0ZSkpOworCQlzZXRfc3RhdGVf
aWQoaGRjcCwgb3V0cHV0LCBIRENQX0lOSVRJQUxJWkVEKTsKIAl9IGVsc2UgaWYgKGlzX2luX2Nw
X25vdF9kZXNpcmVkX3N0YXRlKGhkY3ApKSB7CiAJCXN0YXR1cyA9IG1vZF9oZGNwX3JlbW92ZV9k
aXNwbGF5X3RvcG9sb2d5KGhkY3ApOwogCQlpZiAoc3RhdHVzICE9IE1PRF9IRENQX1NUQVRVU19T
VUNDRVNTKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxl
cy9oZGNwL2hkY3AuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9tb2R1bGVzL2hkY3Av
aGRjcC5oCmluZGV4IDU5NmEwMTkyNzg0Yy4uNmI3MmQ3NGNlMGQ2IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9oZGNwL2hkY3AuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9oZGNwL2hkY3AuaApAQCAtNDQsMTEgKzQ0LDEz
IEBACiAjZGVmaW5lIEJJTkZPX01BWF9ERVZTX0VYQ0VFREVEX01BU0tfRFAJCQkweDAwODAKICNk
ZWZpbmUgQklORk9fTUFYX0NBU0NBREVfRVhDRUVERURfTUFTS19EUAkJMHgwODAwCiAKKyNkZWZp
bmUgVkVSU0lPTl9IRENQMl9NQVNLCQkJCTB4MDQKICNkZWZpbmUgUlhTVEFUVVNfTVNHX1NJWkVf
TUFTSwkJCQkweDAzRkYKICNkZWZpbmUgUlhTVEFUVVNfUkVBRFlfTUFTSwkJCQkweDA0MDAKICNk
ZWZpbmUgUlhTVEFUVVNfUkVBVVRIX1JFUVVFU1RfTUFTSwkJCTB4MDgwMAogI2RlZmluZSBSWElE
TElTVF9ERVZJQ0VfQ09VTlRfTE9XRVJfTUFTSwkJMHhmMAogI2RlZmluZSBSWElETElTVF9ERVZJ
Q0VfQ09VTlRfVVBQRVJfTUFTSwkJMHgwMQorI2RlZmluZSBSWENBUFNfQllURTJfSERDUDJfVkVS
U0lPTl9EUAkJCTB4MDIKICNkZWZpbmUgUlhDQVBTX0JZVEUwX0hEQ1BfQ0FQQUJMRV9NQVNLX0RQ
CQkweDAyCiAjZGVmaW5lIFJYU1RBVFVTX1JFQURZX01BU0tfRFAJCQkJMHgwMDAxCiAjZGVmaW5l
IFJYU1RBVFVTX0hfUF9BVkFJTEFCTEVfTUFTS19EUAkJCTB4MDAwMgpAQCAtOTIsOCArOTQsNTIg
QEAgc3RydWN0IG1vZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDEgewogCXVpbnQ4X3Qgc3Ry
ZWFtX2VuY3J5cHRpb25fZHA7CiB9OwogCitzdHJ1Y3QgbW9kX2hkY3BfdHJhbnNpdGlvbl9pbnB1
dF9oZGNwMiB7CisJdWludDhfdCBoZGNwMnZlcnNpb25fcmVhZDsKKwl1aW50OF90IGhkY3AyX2Nh
cGFibGVfY2hlY2s7CisJdWludDhfdCBhZGRfdG9wb2xvZ3k7CisJdWludDhfdCBjcmVhdGVfc2Vz
c2lvbjsKKwl1aW50OF90IGFrZV9pbml0X3ByZXBhcmU7CisJdWludDhfdCBha2VfaW5pdF93cml0
ZTsKKwl1aW50OF90IHJ4c3RhdHVzX3JlYWQ7CisJdWludDhfdCBha2VfY2VydF9hdmFpbGFibGU7
CisJdWludDhfdCBha2VfY2VydF9yZWFkOworCXVpbnQ4X3QgYWtlX2NlcnRfdmFsaWRhdGlvbjsK
Kwl1aW50OF90IHN0b3JlZF9rbV93cml0ZTsKKwl1aW50OF90IG5vX3N0b3JlZF9rbV93cml0ZTsK
Kwl1aW50OF90IGhfcHJpbWVfYXZhaWxhYmxlOworCXVpbnQ4X3QgaF9wcmltZV9yZWFkOworCXVp
bnQ4X3QgcGFpcmluZ19hdmFpbGFibGU7CisJdWludDhfdCBwYWlyaW5nX2luZm9fcmVhZDsKKwl1
aW50OF90IGhfcHJpbWVfdmFsaWRhdGlvbjsKKwl1aW50OF90IGxjX2luaXRfcHJlcGFyZTsKKwl1
aW50OF90IGxjX2luaXRfd3JpdGU7CisJdWludDhfdCBsX3ByaW1lX2F2YWlsYWJsZV9wb2xsOwor
CXVpbnQ4X3QgbF9wcmltZV9yZWFkOworCXVpbnQ4X3QgbF9wcmltZV92YWxpZGF0aW9uOworCXVp
bnQ4X3QgZWtzX3ByZXBhcmU7CisJdWludDhfdCBla3Nfd3JpdGU7CisJdWludDhfdCBlbmFibGVf
ZW5jcnlwdGlvbjsKKwl1aW50OF90IHJlYXV0aF9yZXF1ZXN0X2NoZWNrOworCXVpbnQ4X3Qgcnhf
aWRfbGlzdF9yZWFkOworCXVpbnQ4X3QgZGV2aWNlX2NvdW50X2NoZWNrOworCXVpbnQ4X3Qgcnhf
aWRfbGlzdF92YWxpZGF0aW9uOworCXVpbnQ4X3QgcmVwZWF0ZXJfYXV0aF9hY2tfd3JpdGU7CisJ
dWludDhfdCBwcmVwYXJlX3N0cmVhbV9tYW5hZ2U7CisJdWludDhfdCBzdHJlYW1fbWFuYWdlX3dy
aXRlOworCXVpbnQ4X3Qgc3RyZWFtX3JlYWR5X2F2YWlsYWJsZTsKKwl1aW50OF90IHN0cmVhbV9y
ZWFkeV9yZWFkOworCXVpbnQ4X3Qgc3RyZWFtX3JlYWR5X3ZhbGlkYXRpb247CisKKwl1aW50OF90
IHJ4X2NhcHNfcmVhZF9kcDsKKwl1aW50OF90IGNvbnRlbnRfc3RyZWFtX3R5cGVfd3JpdGU7CisJ
dWludDhfdCBsaW5rX2ludGVncml0eV9jaGVja19kcDsKKwl1aW50OF90IHN0cmVhbV9lbmNyeXB0
aW9uX2RwOworfTsKKwogdW5pb24gbW9kX2hkY3BfdHJhbnNpdGlvbl9pbnB1dCB7CiAJc3RydWN0
IG1vZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDEgaGRjcDE7CisJc3RydWN0IG1vZF9oZGNw
X3RyYW5zaXRpb25faW5wdXRfaGRjcDIgaGRjcDI7CiB9OwogCiBzdHJ1Y3QgbW9kX2hkY3BfbWVz
c2FnZV9oZGNwMSB7CkBAIC0xNTAsOCArMTk2LDEwIEBAIHN0cnVjdCBtb2RfaGRjcF9jb25uZWN0
aW9uIHsKIAlzdHJ1Y3QgbW9kX2hkY3BfZGlzcGxheSBkaXNwbGF5c1tNQVhfTlVNX09GX0RJU1BM
QVlTXTsKIAl1aW50OF90IGlzX3JlcGVhdGVyOwogCXVpbnQ4X3QgaXNfa21fc3RvcmVkOworCXVp
bnQ4X3QgaXNfaGRjcDJfcmV2b2tlZDsKIAlzdHJ1Y3QgbW9kX2hkY3BfdHJhY2UgdHJhY2U7CiAJ
dWludDhfdCBoZGNwMV9yZXRyeV9jb3VudDsKKwl1aW50OF90IGhkY3AyX3JldHJ5X2NvdW50Owog
fTsKIAogLyogY29udGFpbnMgdmFsdWVzIHBlciBhdXRoZW50aWNhdGlvbiBjeWNsZSAqLwpAQCAt
MjE5LDYgKzI2Nyw1MCBAQCBlbnVtIG1vZF9oZGNwX2hkY3AxX2RwX3N0YXRlX2lkIHsKIAlIRENQ
MV9EUF9TVEFURV9FTkQgPSBEMV9BN19SRUFEX0tTVl9MSVNULAogfTsKIAorZW51bSBtb2RfaGRj
cF9oZGNwMl9zdGF0ZV9pZCB7CisJSERDUDJfU1RBVEVfU1RBUlQgPSBIRENQMV9EUF9TVEFURV9F
TkQsCisJSDJfQTBfS05PV05fSERDUDJfQ0FQQUJMRV9SWCwKKwlIMl9BMV9TRU5EX0FLRV9JTklU
LAorCUgyX0ExX1ZBTElEQVRFX0FLRV9DRVJULAorCUgyX0ExX1NFTkRfTk9fU1RPUkVEX0tNLAor
CUgyX0ExX1JFQURfSF9QUklNRSwKKwlIMl9BMV9SRUFEX1BBSVJJTkdfSU5GT19BTkRfVkFMSURB
VEVfSF9QUklNRSwKKwlIMl9BMV9TRU5EX1NUT1JFRF9LTSwKKwlIMl9BMV9WQUxJREFURV9IX1BS
SU1FLAorCUgyX0EyX0xPQ0FMSVRZX0NIRUNLLAorCUgyX0EzX0VYQ0hBTkdFX0tTX0FORF9URVNU
X0ZPUl9SRVBFQVRFUiwKKwlIMl9FTkFCTEVfRU5DUllQVElPTiwKKwlIMl9BNV9BVVRIRU5USUNB
VEVELAorCUgyX0E2X1dBSVRfRk9SX1JYX0lEX0xJU1QsCisJSDJfQTc4X1ZFUklGWV9SWF9JRF9M
SVNUX0FORF9TRU5EX0FDSywKKwlIMl9BOV9TRU5EX1NUUkVBTV9NQU5BR0VNRU5ULAorCUgyX0E5
X1ZBTElEQVRFX1NUUkVBTV9SRUFEWSwKKwlIRENQMl9TVEFURV9FTkQgPSBIMl9BOV9WQUxJREFU
RV9TVFJFQU1fUkVBRFksCit9OworCitlbnVtIG1vZF9oZGNwX2hkY3AyX2RwX3N0YXRlX2lkIHsK
KwlIRENQMl9EUF9TVEFURV9TVEFSVCA9IEhEQ1AyX1NUQVRFX0VORCwKKwlEMl9BMF9ERVRFUk1J
TkVfUlhfSERDUF9DQVBBQkxFLAorCUQyX0ExX1NFTkRfQUtFX0lOSVQsCisJRDJfQTFfVkFMSURB
VEVfQUtFX0NFUlQsCisJRDJfQTFfU0VORF9OT19TVE9SRURfS00sCisJRDJfQTFfUkVBRF9IX1BS
SU1FLAorCUQyX0ExX1JFQURfUEFJUklOR19JTkZPX0FORF9WQUxJREFURV9IX1BSSU1FLAorCUQy
X0ExX1NFTkRfU1RPUkVEX0tNLAorCUQyX0ExX1ZBTElEQVRFX0hfUFJJTUUsCisJRDJfQTJfTE9D
QUxJVFlfQ0hFQ0ssCisJRDJfQTM0X0VYQ0hBTkdFX0tTX0FORF9URVNUX0ZPUl9SRVBFQVRFUiwK
KwlEMl9TRU5EX0NPTlRFTlRfU1RSRUFNX1RZUEUsCisJRDJfRU5BQkxFX0VOQ1JZUFRJT04sCisJ
RDJfQTVfQVVUSEVOVElDQVRFRCwKKwlEMl9BNl9XQUlUX0ZPUl9SWF9JRF9MSVNULAorCUQyX0E3
OF9WRVJJRllfUlhfSURfTElTVF9BTkRfU0VORF9BQ0ssCisJRDJfQTlfU0VORF9TVFJFQU1fTUFO
QUdFTUVOVCwKKwlEMl9BOV9WQUxJREFURV9TVFJFQU1fUkVBRFksCisJSERDUDJfRFBfU1RBVEVf
RU5EID0gRDJfQTlfVkFMSURBVEVfU1RSRUFNX1JFQURZLAorCUhEQ1BfU1RBVEVfRU5EID0gSERD
UDJfRFBfU1RBVEVfRU5ELAorfTsKKwogLyogaGRjcDEgZXhlY3V0aW9ucyBhbmQgdHJhbnNpdGlv
bnMgKi8KIHR5cGVkZWYgZW51bSBtb2RfaGRjcF9zdGF0dXMgKCptb2RfaGRjcF9hY3Rpb24pKHN0
cnVjdCBtb2RfaGRjcCAqaGRjcCk7CiB1aW50OF90IG1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldCgK
QEAgLTIzOSw2ICszMzEsMjIgQEAgZW51bSBtb2RfaGRjcF9zdGF0dXMgbW9kX2hkY3BfaGRjcDFf
ZHBfdHJhbnNpdGlvbihzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCiAJc3RydWN0IG1vZF9oZGNwX3Ry
YW5zaXRpb25faW5wdXRfaGRjcDEgKmlucHV0LAogCXN0cnVjdCBtb2RfaGRjcF9vdXRwdXQgKm91
dHB1dCk7CiAKKy8qIGhkY3AyIGV4ZWN1dGlvbnMgYW5kIHRyYW5zaXRpb25zICovCitlbnVtIG1v
ZF9oZGNwX3N0YXR1cyBtb2RfaGRjcF9oZGNwMl9leGVjdXRpb24oc3RydWN0IG1vZF9oZGNwICpo
ZGNwLAorCXN0cnVjdCBtb2RfaGRjcF9ldmVudF9jb250ZXh0ICpldmVudF9jdHgsCisJc3RydWN0
IG1vZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDIgKmlucHV0KTsKK2VudW0gbW9kX2hkY3Bf
c3RhdHVzIG1vZF9oZGNwX2hkY3AyX2RwX2V4ZWN1dGlvbihzdHJ1Y3QgbW9kX2hkY3AgKmhkY3As
CisJc3RydWN0IG1vZF9oZGNwX2V2ZW50X2NvbnRleHQgKmV2ZW50X2N0eCwKKwlzdHJ1Y3QgbW9k
X2hkY3BfdHJhbnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQpOworZW51bSBtb2RfaGRjcF9zdGF0
dXMgbW9kX2hkY3BfaGRjcDJfdHJhbnNpdGlvbihzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCisJc3Ry
dWN0IG1vZF9oZGNwX2V2ZW50X2NvbnRleHQgKmV2ZW50X2N0eCwKKwlzdHJ1Y3QgbW9kX2hkY3Bf
dHJhbnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQsCisJc3RydWN0IG1vZF9oZGNwX291dHB1dCAq
b3V0cHV0KTsKK2VudW0gbW9kX2hkY3Bfc3RhdHVzIG1vZF9oZGNwX2hkY3AyX2RwX3RyYW5zaXRp
b24oc3RydWN0IG1vZF9oZGNwICpoZGNwLAorCXN0cnVjdCBtb2RfaGRjcF9ldmVudF9jb250ZXh0
ICpldmVudF9jdHgsCisJc3RydWN0IG1vZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDIgKmlu
cHV0LAorCXN0cnVjdCBtb2RfaGRjcF9vdXRwdXQgKm91dHB1dCk7CisKIC8qIGxvZyBmdW5jdGlv
bnMgKi8KIHZvaWQgbW9kX2hkY3BfZHVtcF9iaW5hcnlfbWVzc2FnZSh1aW50OF90ICptc2csIHVp
bnQzMl90IG1zZ19zaXplLAogCQl1aW50OF90ICpidWYsIHVpbnQzMl90IGJ1Zl9zaXplKTsKQEAg
LTI4OSw2ICszOTcsNyBAQCBlbnVtIG1vZF9oZGNwX3N0YXR1cyBtb2RfaGRjcF9yZWFkX2JpbmZv
KHN0cnVjdCBtb2RfaGRjcCAqaGRjcCk7CiBlbnVtIG1vZF9oZGNwX3N0YXR1cyBtb2RfaGRjcF93
cml0ZV9ha3N2KHN0cnVjdCBtb2RfaGRjcCAqaGRjcCk7CiBlbnVtIG1vZF9oZGNwX3N0YXR1cyBt
b2RfaGRjcF93cml0ZV9haW5mbyhzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApOwogZW51bSBtb2RfaGRj
cF9zdGF0dXMgbW9kX2hkY3Bfd3JpdGVfYW4oc3RydWN0IG1vZF9oZGNwICpoZGNwKTsKK2VudW0g
bW9kX2hkY3Bfc3RhdHVzIG1vZF9oZGNwX3JlYWRfaGRjcDJ2ZXJzaW9uKHN0cnVjdCBtb2RfaGRj
cCAqaGRjcCk7CiBlbnVtIG1vZF9oZGNwX3N0YXR1cyBtb2RfaGRjcF9yZWFkX3J4Y2FwcyhzdHJ1
Y3QgbW9kX2hkY3AgKmhkY3ApOwogZW51bSBtb2RfaGRjcF9zdGF0dXMgbW9kX2hkY3BfcmVhZF9y
eHN0YXR1cyhzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApOwogZW51bSBtb2RfaGRjcF9zdGF0dXMgbW9k
X2hkY3BfcmVhZF9ha2VfY2VydChzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApOwpAQCAtMzUyLDExICs0
NjEsMjggQEAgc3RhdGljIGlubGluZSB1aW50OF90IGlzX2luX2hkY3AxX2RwX3N0YXRlcyhzdHJ1
Y3QgbW9kX2hkY3AgKmhkY3ApCiAJCQljdXJyZW50X3N0YXRlKGhkY3ApIDw9IEhEQ1AxX0RQX1NU
QVRFX0VORCk7CiB9CiAKK3N0YXRpYyBpbmxpbmUgdWludDhfdCBpc19pbl9oZGNwMl9zdGF0ZXMo
c3RydWN0IG1vZF9oZGNwICpoZGNwKQoreworCXJldHVybiAoY3VycmVudF9zdGF0ZShoZGNwKSA+
IEhEQ1AyX1NUQVRFX1NUQVJUICYmCisJCQljdXJyZW50X3N0YXRlKGhkY3ApIDw9IEhEQ1AyX1NU
QVRFX0VORCk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdWludDhfdCBpc19pbl9oZGNwMl9kcF9zdGF0
ZXMoc3RydWN0IG1vZF9oZGNwICpoZGNwKQoreworCXJldHVybiAoY3VycmVudF9zdGF0ZShoZGNw
KSA+IEhEQ1AyX0RQX1NUQVRFX1NUQVJUICYmCisJCQljdXJyZW50X3N0YXRlKGhkY3ApIDw9IEhE
Q1AyX0RQX1NUQVRFX0VORCk7Cit9CisKIHN0YXRpYyBpbmxpbmUgdWludDhfdCBpc19oZGNwMShz
dHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCiB7CiAJcmV0dXJuIChpc19pbl9oZGNwMV9zdGF0ZXMoaGRj
cCkgfHwgaXNfaW5faGRjcDFfZHBfc3RhdGVzKGhkY3ApKTsKIH0KIAorc3RhdGljIGlubGluZSB1
aW50OF90IGlzX2hkY3AyKHN0cnVjdCBtb2RfaGRjcCAqaGRjcCkKK3sKKwlyZXR1cm4gKGlzX2lu
X2hkY3AyX3N0YXRlcyhoZGNwKSB8fCBpc19pbl9oZGNwMl9kcF9zdGF0ZXMoaGRjcCkpOworfQor
CiBzdGF0aWMgaW5saW5lIHVpbnQ4X3QgaXNfaW5fY3Bfbm90X2Rlc2lyZWRfc3RhdGUoc3RydWN0
IG1vZF9oZGNwICpoZGNwKQogewogCXJldHVybiBjdXJyZW50X3N0YXRlKGhkY3ApID09IEhEQ1Bf
Q1BfTk9UX0RFU0lSRUQ7CkBAIC00ODEsNiArNjA3LDcgQEAgc3RhdGljIGlubGluZSBzdHJ1Y3Qg
bW9kX2hkY3BfZGlzcGxheSAqZ2V0X2VtcHR5X2Rpc3BsYXlfY29udGFpbmVyKAogc3RhdGljIGlu
bGluZSB2b2lkIHJlc2V0X3JldHJ5X2NvdW50cyhzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCiB7CiAJ
aGRjcC0+Y29ubmVjdGlvbi5oZGNwMV9yZXRyeV9jb3VudCA9IDA7CisJaGRjcC0+Y29ubmVjdGlv
bi5oZGNwMl9yZXRyeV9jb3VudCA9IDA7CiB9CiAKICNlbmRpZiAvKiBIRENQX0hfICovCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9oZGNwL2hkY3AyX2V4
ZWN1dGlvbi5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L21vZHVsZXMvaGRjcC9oZGNw
Ml9leGVjdXRpb24uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmM5
M2M4MDk4ZDk3MgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxh
eS9tb2R1bGVzL2hkY3AvaGRjcDJfZXhlY3V0aW9uLmMKQEAgLTAsMCArMSw4ODEgQEAKKy8qCisg
KiBDb3B5cmlnaHQgMjAxOCBBZHZhbmNlZCBNaWNybyBEZXZpY2VzLCBJbmMuCisgKgorICogUGVy
bWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24g
b2J0YWluaW5nIGEKKyAqIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1
bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksCisgKiB0byBkZWFsIGluIHRoZSBTb2Z0
d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uCisg
KiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJp
YnV0ZSwgc3VibGljZW5zZSwKKyAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUs
IGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQorICogU29mdHdhcmUgaXMgZnVybmlz
aGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisg
KiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBz
aGFsbCBiZSBpbmNsdWRlZCBpbgorICogYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9u
cyBvZiB0aGUgU29mdHdhcmUuCisgKgorICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJ
UyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKKyAqIElNUExJRUQs
IElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRB
QklMSVRZLAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJ
TkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMCisgKiBUSEUgQ09QWVJJR0hUIEhPTERFUihTKSBP
UiBBVVRIT1IoUykgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IKKyAqIE9USEVS
IExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RI
RVJXSVNFLAorICogQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRI
RSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCisgKiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdB
UkUuCisgKgorICogQXV0aG9yczogQU1ECisgKgorICovCisKKyNpbmNsdWRlICJoZGNwLmgiCisK
K3N0YXRpYyBpbmxpbmUgZW51bSBtb2RfaGRjcF9zdGF0dXMgY2hlY2tfcmVjZWl2ZXJfaWRfbGlz
dF9yZWFkeShzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCit7CisJdWludDhfdCBpc19yZWFkeSA9IDA7
CisKKwlpZiAoaXNfZHBfaGRjcChoZGNwKSkKKwkJaXNfcmVhZHkgPSAoaGRjcC0+YXV0aC5tc2cu
aGRjcDIucnhzdGF0dXMgJiBSWFNUQVRVU19SRUFEWV9NQVNLX0RQKSA/IDEgOiAwOworCWVsc2UK
KwkJaXNfcmVhZHkgPSAoKGhkY3AtPmF1dGgubXNnLmhkY3AyLnJ4c3RhdHVzICYgUlhTVEFUVVNf
UkVBRFlfTUFTSykgJiYKKwkJCQkoaGRjcC0+YXV0aC5tc2cuaGRjcDIucnhzdGF0dXMgJiBSWFNU
QVRVU19NU0dfU0laRV9NQVNLKSkgPyAxIDogMDsKKwlyZXR1cm4gaXNfcmVhZHkgPyBNT0RfSERD
UF9TVEFUVVNfU1VDQ0VTUyA6CisJCQlNT0RfSERDUF9TVEFUVVNfSERDUDJfUlhfSURfTElTVF9O
T1RfUkVBRFk7Cit9CisKK3N0YXRpYyBpbmxpbmUgZW51bSBtb2RfaGRjcF9zdGF0dXMgY2hlY2tf
aGRjcDJfY2FwYWJsZShzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCit7CisJZW51bSBtb2RfaGRjcF9z
dGF0dXMgc3RhdHVzOworCisJaWYgKGlzX2RwX2hkY3AoaGRjcCkpCisJCXN0YXR1cyA9ICgoaGRj
cC0+YXV0aC5tc2cuaGRjcDIucnhjYXBzX2RwWzJdICYKKwkJCQkJCVJYQ0FQU19CWVRFMF9IRENQ
X0NBUEFCTEVfTUFTS19EUCkgJiYKKwkJCQkoaGRjcC0+YXV0aC5tc2cuaGRjcDIucnhjYXBzX2Rw
WzBdID09CisJCQkJCQlSWENBUFNfQllURTJfSERDUDJfVkVSU0lPTl9EUCkpID8KKwkJCQlNT0Rf
SERDUF9TVEFUVVNfU1VDQ0VTUyA6CisJCQkJTU9EX0hEQ1BfU1RBVFVTX0hEQ1AyX05PVF9DQVBB
QkxFOworCWVsc2UKKwkJc3RhdHVzID0gKGhkY3AtPmF1dGgubXNnLmhkY3AyLmhkY3AydmVyc2lv
bl9oZG1pICYgVkVSU0lPTl9IRENQMl9NQVNLKSA/CisJCQkJTU9EX0hEQ1BfU1RBVFVTX1NVQ0NF
U1MgOgorCQkJCU1PRF9IRENQX1NUQVRVU19IRENQMl9OT1RfQ0FQQUJMRTsKKwlyZXR1cm4gc3Rh
dHVzOworfQorCitzdGF0aWMgaW5saW5lIGVudW0gbW9kX2hkY3Bfc3RhdHVzIGNoZWNrX3JlYXV0
aGVudGljYXRpb25fcmVxdWVzdCgKKwkJc3RydWN0IG1vZF9oZGNwICpoZGNwKQoreworCXVpbnQ4
X3QgcmV0ID0gMDsKKworCWlmIChpc19kcF9oZGNwKGhkY3ApKQorCQlyZXQgPSAoaGRjcC0+YXV0
aC5tc2cuaGRjcDIucnhzdGF0dXMgJgorCQkJCVJYU1RBVFVTX1JFQVVUSF9SRVFVRVNUX01BU0tf
RFApID8KKwkJCQlNT0RfSERDUF9TVEFUVVNfSERDUDJfUkVBVVRIX1JFUVVFU1QgOgorCQkJCU1P
RF9IRENQX1NUQVRVU19TVUNDRVNTOworCWVsc2UKKwkJcmV0ID0gKGhkY3AtPmF1dGgubXNnLmhk
Y3AyLnJ4c3RhdHVzICYgUlhTVEFUVVNfUkVBVVRIX1JFUVVFU1RfTUFTSykgPworCQkJCU1PRF9I
RENQX1NUQVRVU19IRENQMl9SRUFVVEhfUkVRVUVTVCA6CisJCQkJTU9EX0hEQ1BfU1RBVFVTX1NV
Q0NFU1M7CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGlubGluZSBlbnVtIG1vZF9oZGNwX3N0
YXR1cyBjaGVja19saW5rX2ludGVncml0eV9mYWlsdXJlX2RwKAorCQlzdHJ1Y3QgbW9kX2hkY3Ag
KmhkY3ApCit7CisJcmV0dXJuIChoZGNwLT5hdXRoLm1zZy5oZGNwMi5yeHN0YXR1cyAmCisJCQlS
WFNUQVRVU19MSU5LX0lOVEVHUklUWV9GQUlMVVJFX01BU0tfRFApID8KKwkJCU1PRF9IRENQX1NU
QVRVU19IRENQMl9SRUFVVEhfTElOS19JTlRFR1JJVFlfRkFJTFVSRSA6CisJCQlNT0RfSERDUF9T
VEFUVVNfU1VDQ0VTUzsKK30KKworc3RhdGljIGVudW0gbW9kX2hkY3Bfc3RhdHVzIGNoZWNrX2Fr
ZV9jZXJ0X2F2YWlsYWJsZShzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCit7CisJZW51bSBtb2RfaGRj
cF9zdGF0dXMgc3RhdHVzOworCXVpbnQxNl90IHNpemU7CisKKwlpZiAoaXNfZHBfaGRjcChoZGNw
KSkgeworCQlzdGF0dXMgPSBNT0RfSERDUF9TVEFUVVNfU1VDQ0VTUzsKKwl9IGVsc2UgeworCQlz
dGF0dXMgPSBtb2RfaGRjcF9yZWFkX3J4c3RhdHVzKGhkY3ApOworCQlpZiAoc3RhdHVzID09IE1P
RF9IRENQX1NUQVRVU19TVUNDRVNTKSB7CisJCQlzaXplID0gaGRjcC0+YXV0aC5tc2cuaGRjcDIu
cnhzdGF0dXMgJiBSWFNUQVRVU19NU0dfU0laRV9NQVNLOworCQkJc3RhdHVzID0gKHNpemUgPT0g
c2l6ZW9mKGhkY3AtPmF1dGgubXNnLmhkY3AyLmFrZV9jZXJ0KSkgPworCQkJCQlNT0RfSERDUF9T
VEFUVVNfU1VDQ0VTUyA6CisJCQkJCU1PRF9IRENQX1NUQVRVU19IRENQMl9BS0VfQ0VSVF9QRU5E
SU5HOworCQl9CisJfQorCXJldHVybiBzdGF0dXM7Cit9CisKK3N0YXRpYyBlbnVtIG1vZF9oZGNw
X3N0YXR1cyBjaGVja19oX3ByaW1lX2F2YWlsYWJsZShzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCit7
CisJZW51bSBtb2RfaGRjcF9zdGF0dXMgc3RhdHVzOworCXVpbnQ4X3Qgc2l6ZTsKKworCXN0YXR1
cyA9IG1vZF9oZGNwX3JlYWRfcnhzdGF0dXMoaGRjcCk7CisJaWYgKHN0YXR1cyAhPSBNT0RfSERD
UF9TVEFUVVNfU1VDQ0VTUykKKwkJZ290byBvdXQ7CisKKwlpZiAoaXNfZHBfaGRjcChoZGNwKSkg
eworCQlzdGF0dXMgPSAoaGRjcC0+YXV0aC5tc2cuaGRjcDIucnhzdGF0dXMgJiBSWFNUQVRVU19I
X1BfQVZBSUxBQkxFX01BU0tfRFApID8KKwkJCQlNT0RfSERDUF9TVEFUVVNfU1VDQ0VTUyA6CisJ
CQkJTU9EX0hEQ1BfU1RBVFVTX0hEQ1AyX0hfUFJJTUVfUEVORElORzsKKwl9IGVsc2UgeworCQlz
aXplID0gaGRjcC0+YXV0aC5tc2cuaGRjcDIucnhzdGF0dXMgJiBSWFNUQVRVU19NU0dfU0laRV9N
QVNLOworCQlzdGF0dXMgPSAoc2l6ZSA9PSBzaXplb2YoaGRjcC0+YXV0aC5tc2cuaGRjcDIuYWtl
X2hfcHJpbWUpKSA/CisJCQkJTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1MgOgorCQkJCU1PRF9IRENQ
X1NUQVRVU19IRENQMl9IX1BSSU1FX1BFTkRJTkc7CisJfQorb3V0OgorCXJldHVybiBzdGF0dXM7
Cit9CisKK3N0YXRpYyBlbnVtIG1vZF9oZGNwX3N0YXR1cyBjaGVja19wYWlyaW5nX2luZm9fYXZh
aWxhYmxlKHN0cnVjdCBtb2RfaGRjcCAqaGRjcCkKK3sKKwllbnVtIG1vZF9oZGNwX3N0YXR1cyBz
dGF0dXM7CisJdWludDhfdCBzaXplOworCisJc3RhdHVzID0gbW9kX2hkY3BfcmVhZF9yeHN0YXR1
cyhoZGNwKTsKKwlpZiAoc3RhdHVzICE9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTKQorCQlnb3Rv
IG91dDsKKworCWlmIChpc19kcF9oZGNwKGhkY3ApKSB7CisJCXN0YXR1cyA9IChoZGNwLT5hdXRo
Lm1zZy5oZGNwMi5yeHN0YXR1cyAmIFJYU1RBVFVTX1BBSVJJTkdfQVZBSUxBQkxFX01BU0tfRFAp
ID8KKwkJCQlNT0RfSERDUF9TVEFUVVNfU1VDQ0VTUyA6CisJCQkJTU9EX0hEQ1BfU1RBVFVTX0hE
Q1AyX1BBSVJJTkdfSU5GT19QRU5ESU5HOworCX0gZWxzZSB7CisJCXNpemUgPSBoZGNwLT5hdXRo
Lm1zZy5oZGNwMi5yeHN0YXR1cyAmIFJYU1RBVFVTX01TR19TSVpFX01BU0s7CisJCXN0YXR1cyA9
IChzaXplID09IHNpemVvZihoZGNwLT5hdXRoLm1zZy5oZGNwMi5ha2VfcGFpcmluZ19pbmZvKSkg
PworCQkJCU1PRF9IRENQX1NUQVRVU19TVUNDRVNTIDoKKwkJCQlNT0RfSERDUF9TVEFUVVNfSERD
UDJfUEFJUklOR19JTkZPX1BFTkRJTkc7CisJfQorb3V0OgorCXJldHVybiBzdGF0dXM7Cit9CisK
K3N0YXRpYyBlbnVtIG1vZF9oZGNwX3N0YXR1cyBwb2xsX2xfcHJpbWVfYXZhaWxhYmxlKHN0cnVj
dCBtb2RfaGRjcCAqaGRjcCkKK3sKKwllbnVtIG1vZF9oZGNwX3N0YXR1cyBzdGF0dXM7CisJdWlu
dDhfdCBzaXplOworCXVpbnQxNl90IG1heF93YWl0ID0gMjAwMDA7IC8vIHVuaXRzIG9mIHVzCisJ
dWludDE2X3QgbnVtX3BvbGxzID0gNTsKKwl1aW50MTZfdCB3YWl0X3RpbWUgPSBtYXhfd2FpdCAv
IG51bV9wb2xsczsKKworCWlmIChpc19kcF9oZGNwKGhkY3ApKQorCQlzdGF0dXMgPSBNT0RfSERD
UF9TVEFUVVNfSU5WQUxJRF9PUEVSQVRJT047CisJZWxzZQorCQlmb3IgKDsgbnVtX3BvbGxzOyBu
dW1fcG9sbHMtLSkgeworCQkJdWRlbGF5KHdhaXRfdGltZSk7CisKKwkJCXN0YXR1cyA9IG1vZF9o
ZGNwX3JlYWRfcnhzdGF0dXMoaGRjcCk7CisJCQlpZiAoc3RhdHVzICE9IE1PRF9IRENQX1NUQVRV
U19TVUNDRVNTKQorCQkJCWJyZWFrOworCisJCQlzaXplID0gaGRjcC0+YXV0aC5tc2cuaGRjcDIu
cnhzdGF0dXMgJiBSWFNUQVRVU19NU0dfU0laRV9NQVNLOworCQkJc3RhdHVzID0gKHNpemUgPT0g
c2l6ZW9mKGhkY3AtPmF1dGgubXNnLmhkY3AyLmxjX2xfcHJpbWUpKSA/CisJCQkJCU1PRF9IRENQ
X1NUQVRVU19TVUNDRVNTIDoKKwkJCQkJTU9EX0hEQ1BfU1RBVFVTX0hEQ1AyX0xfUFJJTUVfUEVO
RElORzsKKwkJCWlmIChzdGF0dXMgPT0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1MpCisJCQkJYnJl
YWs7CisJCX0KKwlyZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMgZW51bSBtb2RfaGRjcF9zdGF0
dXMgY2hlY2tfc3RyZWFtX3JlYWR5X2F2YWlsYWJsZShzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCit7
CisJZW51bSBtb2RfaGRjcF9zdGF0dXMgc3RhdHVzOworCXVpbnQ4X3Qgc2l6ZTsKKworCWlmIChp
c19kcF9oZGNwKGhkY3ApKSB7CisJCXN0YXR1cyA9IE1PRF9IRENQX1NUQVRVU19JTlZBTElEX09Q
RVJBVElPTjsKKwl9IGVsc2UgeworCQlzdGF0dXMgPSBtb2RfaGRjcF9yZWFkX3J4c3RhdHVzKGhk
Y3ApOworCQlpZiAoc3RhdHVzICE9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTKQorCQkJZ290byBv
dXQ7CisJCXNpemUgPSBoZGNwLT5hdXRoLm1zZy5oZGNwMi5yeHN0YXR1cyAmIFJYU1RBVFVTX01T
R19TSVpFX01BU0s7CisJCXN0YXR1cyA9IChzaXplID09IHNpemVvZihoZGNwLT5hdXRoLm1zZy5o
ZGNwMi5yZXBlYXRlcl9hdXRoX3N0cmVhbV9yZWFkeSkpID8KKwkJCQlNT0RfSERDUF9TVEFUVVNf
U1VDQ0VTUyA6CisJCQkJTU9EX0hEQ1BfU1RBVFVTX0hEQ1AyX1NUUkVBTV9SRUFEWV9QRU5ESU5H
OworCX0KK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMgaW5saW5lIHVpbnQ4X3Qg
Z2V0X2RldmljZV9jb3VudChzdHJ1Y3QgbW9kX2hkY3AgKmhkY3ApCit7CisJcmV0dXJuICgoaGRj
cC0+YXV0aC5tc2cuaGRjcDIucnhfaWRfbGlzdFsyXSAmIFJYSURMSVNUX0RFVklDRV9DT1VOVF9M
T1dFUl9NQVNLKSA+PiA0KSArCisJCSgoaGRjcC0+YXV0aC5tc2cuaGRjcDIucnhfaWRfbGlzdFsx
XSAmIFJYSURMSVNUX0RFVklDRV9DT1VOVF9VUFBFUl9NQVNLKSA8PCA0KTsKK30KKworc3RhdGlj
IGVudW0gbW9kX2hkY3Bfc3RhdHVzIGNoZWNrX2RldmljZV9jb3VudChzdHJ1Y3QgbW9kX2hkY3Ag
KmhkY3ApCit7CisJLyogZGV2aWNlIGNvdW50IG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFs
IHRvIHRyYWNrZWQgaGRjcCBkaXNwbGF5cyAqLworCXJldHVybiAoZ2V0X2RldmljZV9jb3VudCho
ZGNwKSA8IGdldF9hZGRlZF9kaXNwbGF5X2NvdW50KGhkY3ApKSA/CisJCQlNT0RfSERDUF9TVEFU
VVNfSERDUDJfREVWSUNFX0NPVU5UX01JU01BVENIX0ZBSUxVUkUgOgorCQkJTU9EX0hEQ1BfU1RB
VFVTX1NVQ0NFU1M7Cit9CisKK3N0YXRpYyB1aW50OF90IHByb2Nlc3NfcnhzdGF0dXMoc3RydWN0
IG1vZF9oZGNwICpoZGNwLAorCQlzdHJ1Y3QgbW9kX2hkY3BfZXZlbnRfY29udGV4dCAqZXZlbnRf
Y3R4LAorCQlzdHJ1Y3QgbW9kX2hkY3BfdHJhbnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQsCisJ
CWVudW0gbW9kX2hkY3Bfc3RhdHVzICpzdGF0dXMpCit7CisJaWYgKCFtb2RfaGRjcF9leGVjdXRl
X2FuZF9zZXQobW9kX2hkY3BfcmVhZF9yeHN0YXR1cywKKwkJCSZpbnB1dC0+cnhzdGF0dXNfcmVh
ZCwgc3RhdHVzLAorCQkJaGRjcCwgInJ4c3RhdHVzX3JlYWQiKSkKKwkJZ290byBvdXQ7CisJaWYg
KCFtb2RfaGRjcF9leGVjdXRlX2FuZF9zZXQoY2hlY2tfcmVhdXRoZW50aWNhdGlvbl9yZXF1ZXN0
LAorCQkJJmlucHV0LT5yZWF1dGhfcmVxdWVzdF9jaGVjaywgc3RhdHVzLAorCQkJaGRjcCwgInJl
YXV0aF9yZXF1ZXN0X2NoZWNrIikpCisJCWdvdG8gb3V0OworCWlmIChpc19kcF9oZGNwKGhkY3Ap
KSB7CisJCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KGNoZWNrX2xpbmtfaW50ZWdyaXR5
X2ZhaWx1cmVfZHAsCisJCQkJJmlucHV0LT5saW5rX2ludGVncml0eV9jaGVja19kcCwgc3RhdHVz
LAorCQkJCWhkY3AsICJsaW5rX2ludGVncml0eV9jaGVja19kcCIpKQorCQkJZ290byBvdXQ7CisJ
fQorCWlmIChoZGNwLT5jb25uZWN0aW9uLmlzX3JlcGVhdGVyKQorCQlpZiAoY2hlY2tfcmVjZWl2
ZXJfaWRfbGlzdF9yZWFkeShoZGNwKSA9PQorCQkJCU1PRF9IRENQX1NUQVRVU19TVUNDRVNTKSB7
CisJCQlIRENQX0lOUFVUX1BBU1NfVFJBQ0UoaGRjcCwgInJ4X2lkX2xpc3RfcmVhZHkiKTsKKwkJ
CWV2ZW50X2N0eC0+cnhfaWRfbGlzdF9yZWFkeSA9IDE7CisJCQlpZiAoaXNfZHBfaGRjcChoZGNw
KSkKKwkJCQloZGNwLT5hdXRoLm1zZy5oZGNwMi5yeF9pZF9saXN0X3NpemUgPQorCQkJCQkJc2l6
ZW9mKGhkY3AtPmF1dGgubXNnLmhkY3AyLnJ4X2lkX2xpc3QpOworCQkJZWxzZQorCQkJCWhkY3At
PmF1dGgubXNnLmhkY3AyLnJ4X2lkX2xpc3Rfc2l6ZSA9CisJCQkJCQloZGNwLT5hdXRoLm1zZy5o
ZGNwMi5yeHN0YXR1cyAmIDB4M0ZGOworCQl9CitvdXQ6CisJcmV0dXJuICgqc3RhdHVzID09IE1P
RF9IRENQX1NUQVRVU19TVUNDRVNTKTsKK30KKworc3RhdGljIGVudW0gbW9kX2hkY3Bfc3RhdHVz
IGtub3duX2hkY3AyX2NhcGFibGVfcngoc3RydWN0IG1vZF9oZGNwICpoZGNwLAorCQlzdHJ1Y3Qg
bW9kX2hkY3BfZXZlbnRfY29udGV4dCAqZXZlbnRfY3R4LAorCQlzdHJ1Y3QgbW9kX2hkY3BfdHJh
bnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQpCit7CisJZW51bSBtb2RfaGRjcF9zdGF0dXMgc3Rh
dHVzID0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1M7CisKKwlpZiAoZXZlbnRfY3R4LT5ldmVudCAh
PSBNT0RfSERDUF9FVkVOVF9DQUxMQkFDSykgeworCQlldmVudF9jdHgtPnVuZXhwZWN0ZWRfZXZl
bnQgPSAxOworCQlnb3RvIG91dDsKKwl9CisJaWYgKCFtb2RfaGRjcF9leGVjdXRlX2FuZF9zZXQo
bW9kX2hkY3BfcmVhZF9oZGNwMnZlcnNpb24sCisJCQkmaW5wdXQtPmhkY3AydmVyc2lvbl9yZWFk
LCAmc3RhdHVzLAorCQkJaGRjcCwgImhkY3AydmVyc2lvbl9yZWFkIikpCisJCWdvdG8gb3V0Owor
CWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KGNoZWNrX2hkY3AyX2NhcGFibGUsCisJCQkm
aW5wdXQtPmhkY3AyX2NhcGFibGVfY2hlY2ssICZzdGF0dXMsCisJCQloZGNwLCAiaGRjcDJfY2Fw
YWJsZSIpKQorCQlnb3RvIG91dDsKK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMg
ZW51bSBtb2RfaGRjcF9zdGF0dXMgc2VuZF9ha2VfaW5pdChzdHJ1Y3QgbW9kX2hkY3AgKmhkY3As
CisJCXN0cnVjdCBtb2RfaGRjcF9ldmVudF9jb250ZXh0ICpldmVudF9jdHgsCisJCXN0cnVjdCBt
b2RfaGRjcF90cmFuc2l0aW9uX2lucHV0X2hkY3AyICppbnB1dCkKK3sKKwllbnVtIG1vZF9oZGNw
X3N0YXR1cyBzdGF0dXMgPSBNT0RfSERDUF9TVEFUVVNfU1VDQ0VTUzsKKworCWlmIChldmVudF9j
dHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NBTExCQUNLKSB7CisJCWV2ZW50X2N0eC0+dW5l
eHBlY3RlZF9ldmVudCA9IDE7CisJCWdvdG8gb3V0OworCX0KKwlpZiAoIW1vZF9oZGNwX2V4ZWN1
dGVfYW5kX3NldChtb2RfaGRjcF9hZGRfZGlzcGxheV90b3BvbG9neSwKKwkJCSZpbnB1dC0+YWRk
X3RvcG9sb2d5LCAmc3RhdHVzLAorCQkJaGRjcCwgImFkZF90b3BvbG9neSIpKQorCQlnb3RvIG91
dDsKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChtb2RfaGRjcF9oZGNwMl9jcmVhdGVf
c2Vzc2lvbiwKKwkJCSZpbnB1dC0+Y3JlYXRlX3Nlc3Npb24sICZzdGF0dXMsCisJCQloZGNwLCAi
Y3JlYXRlX3Nlc3Npb24iKSkKKwkJZ290byBvdXQ7CisJaWYgKCFtb2RfaGRjcF9leGVjdXRlX2Fu
ZF9zZXQobW9kX2hkY3BfaGRjcDJfcHJlcGFyZV9ha2VfaW5pdCwKKwkJCSZpbnB1dC0+YWtlX2lu
aXRfcHJlcGFyZSwgJnN0YXR1cywKKwkJCWhkY3AsICJha2VfaW5pdF9wcmVwYXJlIikpCisJCWdv
dG8gb3V0OworCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KG1vZF9oZGNwX3dyaXRlX2Fr
ZV9pbml0LAorCQkJJmlucHV0LT5ha2VfaW5pdF93cml0ZSwgJnN0YXR1cywKKwkJCWhkY3AsICJh
a2VfaW5pdF93cml0ZSIpKQorCQlnb3RvIG91dDsKK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQor
CitzdGF0aWMgZW51bSBtb2RfaGRjcF9zdGF0dXMgdmFsaWRhdGVfYWtlX2NlcnQoc3RydWN0IG1v
ZF9oZGNwICpoZGNwLAorCQlzdHJ1Y3QgbW9kX2hkY3BfZXZlbnRfY29udGV4dCAqZXZlbnRfY3R4
LAorCQlzdHJ1Y3QgbW9kX2hkY3BfdHJhbnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQpCit7CisJ
ZW51bSBtb2RfaGRjcF9zdGF0dXMgc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1M7CisK
KworCWlmIChldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NBTExCQUNLICYmCisJ
CQlldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX1dBVENIRE9HX1RJTUVPVVQpIHsK
KwkJZXZlbnRfY3R4LT51bmV4cGVjdGVkX2V2ZW50ID0gMTsKKwkJZ290byBvdXQ7CisJfQorCisJ
aWYgKGlzX2hkbWlfZHZpX3NsX2hkY3AoaGRjcCkpCisJCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9h
bmRfc2V0KGNoZWNrX2FrZV9jZXJ0X2F2YWlsYWJsZSwKKwkJCQkmaW5wdXQtPmFrZV9jZXJ0X2F2
YWlsYWJsZSwgJnN0YXR1cywKKwkJCQloZGNwLCAiYWtlX2NlcnRfYXZhaWxhYmxlIikpCisJCQln
b3RvIG91dDsKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChtb2RfaGRjcF9yZWFkX2Fr
ZV9jZXJ0LAorCQkJJmlucHV0LT5ha2VfY2VydF9yZWFkLCAmc3RhdHVzLAorCQkJaGRjcCwgImFr
ZV9jZXJ0X3JlYWQiKSkKKwkJZ290byBvdXQ7CisJaWYgKCFtb2RfaGRjcF9leGVjdXRlX2FuZF9z
ZXQobW9kX2hkY3BfaGRjcDJfdmFsaWRhdGVfYWtlX2NlcnQsCisJCQkmaW5wdXQtPmFrZV9jZXJ0
X3ZhbGlkYXRpb24sICZzdGF0dXMsCisJCQloZGNwLCAiYWtlX2NlcnRfdmFsaWRhdGlvbiIpKQor
CQlnb3RvIG91dDsKK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMgZW51bSBtb2Rf
aGRjcF9zdGF0dXMgc2VuZF9ub19zdG9yZWRfa20oc3RydWN0IG1vZF9oZGNwICpoZGNwLAorCQlz
dHJ1Y3QgbW9kX2hkY3BfZXZlbnRfY29udGV4dCAqZXZlbnRfY3R4LAorCQlzdHJ1Y3QgbW9kX2hk
Y3BfdHJhbnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQpCit7CisJZW51bSBtb2RfaGRjcF9zdGF0
dXMgc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1M7CisKKwlpZiAoZXZlbnRfY3R4LT5l
dmVudCAhPSBNT0RfSERDUF9FVkVOVF9DQUxMQkFDSykgeworCQlldmVudF9jdHgtPnVuZXhwZWN0
ZWRfZXZlbnQgPSAxOworCQlnb3RvIG91dDsKKwl9CisKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVf
YW5kX3NldChtb2RfaGRjcF93cml0ZV9ub19zdG9yZWRfa20sCisJCQkmaW5wdXQtPm5vX3N0b3Jl
ZF9rbV93cml0ZSwgJnN0YXR1cywKKwkJCWhkY3AsICJub19zdG9yZWRfa21fd3JpdGUiKSkKKwkJ
Z290byBvdXQ7CitvdXQ6CisJcmV0dXJuIHN0YXR1czsKK30KKworc3RhdGljIGVudW0gbW9kX2hk
Y3Bfc3RhdHVzIHJlYWRfaF9wcmltZShzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCisJCXN0cnVjdCBt
b2RfaGRjcF9ldmVudF9jb250ZXh0ICpldmVudF9jdHgsCisJCXN0cnVjdCBtb2RfaGRjcF90cmFu
c2l0aW9uX2lucHV0X2hkY3AyICppbnB1dCkKK3sKKwllbnVtIG1vZF9oZGNwX3N0YXR1cyBzdGF0
dXMgPSBNT0RfSERDUF9TVEFUVVNfU1VDQ0VTUzsKKworCWlmIChldmVudF9jdHgtPmV2ZW50ICE9
IE1PRF9IRENQX0VWRU5UX0NBTExCQUNLICYmCisJCQlldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9I
RENQX0VWRU5UX0NQSVJRICYmCisJCQlldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5U
X1dBVENIRE9HX1RJTUVPVVQpIHsKKwkJZXZlbnRfY3R4LT51bmV4cGVjdGVkX2V2ZW50ID0gMTsK
KwkJZ290byBvdXQ7CisJfQorCisJaWYgKCFtb2RfaGRjcF9leGVjdXRlX2FuZF9zZXQoY2hlY2tf
aF9wcmltZV9hdmFpbGFibGUsCisJCQkmaW5wdXQtPmhfcHJpbWVfYXZhaWxhYmxlLCAmc3RhdHVz
LAorCQkJaGRjcCwgImhfcHJpbWVfYXZhaWxhYmxlIikpCisJCWdvdG8gb3V0OworCisJaWYgKCFt
b2RfaGRjcF9leGVjdXRlX2FuZF9zZXQobW9kX2hkY3BfcmVhZF9oX3ByaW1lLAorCQkJJmlucHV0
LT5oX3ByaW1lX3JlYWQsICZzdGF0dXMsCisJCQloZGNwLCAiaF9wcmltZV9yZWFkIikpCisJCWdv
dG8gb3V0Oworb3V0OgorCXJldHVybiBzdGF0dXM7Cit9CisKK3N0YXRpYyBlbnVtIG1vZF9oZGNw
X3N0YXR1cyByZWFkX3BhaXJpbmdfaW5mb19hbmRfdmFsaWRhdGVfaF9wcmltZSgKKwkJc3RydWN0
IG1vZF9oZGNwICpoZGNwLAorCQlzdHJ1Y3QgbW9kX2hkY3BfZXZlbnRfY29udGV4dCAqZXZlbnRf
Y3R4LAorCQlzdHJ1Y3QgbW9kX2hkY3BfdHJhbnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQpCit7
CisJZW51bSBtb2RfaGRjcF9zdGF0dXMgc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1M7
CisKKwlpZiAoZXZlbnRfY3R4LT5ldmVudCAhPSBNT0RfSERDUF9FVkVOVF9DQUxMQkFDSyAmJgor
CQkJZXZlbnRfY3R4LT5ldmVudCAhPSBNT0RfSERDUF9FVkVOVF9DUElSUSAmJgorCQkJZXZlbnRf
Y3R4LT5ldmVudCAhPSBNT0RfSERDUF9FVkVOVF9XQVRDSERPR19USU1FT1VUKSB7CisJCWV2ZW50
X2N0eC0+dW5leHBlY3RlZF9ldmVudCA9IDE7CisJCWdvdG8gb3V0OworCX0KKworCWlmICghbW9k
X2hkY3BfZXhlY3V0ZV9hbmRfc2V0KGNoZWNrX3BhaXJpbmdfaW5mb19hdmFpbGFibGUsCisJCQkm
aW5wdXQtPnBhaXJpbmdfYXZhaWxhYmxlLCAmc3RhdHVzLAorCQkJaGRjcCwgInBhaXJpbmdfYXZh
aWxhYmxlIikpCisJCWdvdG8gb3V0OworCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KG1v
ZF9oZGNwX3JlYWRfcGFpcmluZ19pbmZvLAorCQkJJmlucHV0LT5wYWlyaW5nX2luZm9fcmVhZCwg
JnN0YXR1cywKKwkJCWhkY3AsICJwYWlyaW5nX2luZm9fcmVhZCIpKQorCQlnb3RvIG91dDsKKwlp
ZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChtb2RfaGRjcF9oZGNwMl92YWxpZGF0ZV9oX3By
aW1lLAorCQkJJmlucHV0LT5oX3ByaW1lX3ZhbGlkYXRpb24sICZzdGF0dXMsCisJCQloZGNwLCAi
aF9wcmltZV92YWxpZGF0aW9uIikpCisJCWdvdG8gb3V0Oworb3V0OgorCXJldHVybiBzdGF0dXM7
Cit9CisKK3N0YXRpYyBlbnVtIG1vZF9oZGNwX3N0YXR1cyBzZW5kX3N0b3JlZF9rbShzdHJ1Y3Qg
bW9kX2hkY3AgKmhkY3AsCisJCXN0cnVjdCBtb2RfaGRjcF9ldmVudF9jb250ZXh0ICpldmVudF9j
dHgsCisJCXN0cnVjdCBtb2RfaGRjcF90cmFuc2l0aW9uX2lucHV0X2hkY3AyICppbnB1dCkKK3sK
KwllbnVtIG1vZF9oZGNwX3N0YXR1cyBzdGF0dXMgPSBNT0RfSERDUF9TVEFUVVNfU1VDQ0VTUzsK
KworCWlmIChldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NBTExCQUNLKSB7CisJ
CWV2ZW50X2N0eC0+dW5leHBlY3RlZF9ldmVudCA9IDE7CisJCWdvdG8gb3V0OworCX0KKworCWlm
ICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KG1vZF9oZGNwX3dyaXRlX3N0b3JlZF9rbSwKKwkJ
CSZpbnB1dC0+c3RvcmVkX2ttX3dyaXRlLCAmc3RhdHVzLAorCQkJaGRjcCwgInN0b3JlZF9rbV93
cml0ZSIpKQorCQlnb3RvIG91dDsKK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMg
ZW51bSBtb2RfaGRjcF9zdGF0dXMgdmFsaWRhdGVfaF9wcmltZShzdHJ1Y3QgbW9kX2hkY3AgKmhk
Y3AsCisJCXN0cnVjdCBtb2RfaGRjcF9ldmVudF9jb250ZXh0ICpldmVudF9jdHgsCisJCXN0cnVj
dCBtb2RfaGRjcF90cmFuc2l0aW9uX2lucHV0X2hkY3AyICppbnB1dCkKK3sKKwllbnVtIG1vZF9o
ZGNwX3N0YXR1cyBzdGF0dXMgPSBNT0RfSERDUF9TVEFUVVNfU1VDQ0VTUzsKKworCWlmIChldmVu
dF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NBTExCQUNLICYmCisJCQlldmVudF9jdHgt
PmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NQSVJRICYmCisJCQlldmVudF9jdHgtPmV2ZW50ICE9
IE1PRF9IRENQX0VWRU5UX1dBVENIRE9HX1RJTUVPVVQpIHsKKwkJZXZlbnRfY3R4LT51bmV4cGVj
dGVkX2V2ZW50ID0gMTsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKCFtb2RfaGRjcF9leGVjdXRl
X2FuZF9zZXQoY2hlY2tfaF9wcmltZV9hdmFpbGFibGUsCisJCQkmaW5wdXQtPmhfcHJpbWVfYXZh
aWxhYmxlLCAmc3RhdHVzLAorCQkJaGRjcCwgImhfcHJpbWVfYXZhaWxhYmxlIikpCisJCWdvdG8g
b3V0OworCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KG1vZF9oZGNwX3JlYWRfaF9wcmlt
ZSwKKwkJCSZpbnB1dC0+aF9wcmltZV9yZWFkLCAmc3RhdHVzLAorCQkJaGRjcCwgImhfcHJpbWVf
cmVhZCIpKQorCQlnb3RvIG91dDsKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChtb2Rf
aGRjcF9oZGNwMl92YWxpZGF0ZV9oX3ByaW1lLAorCQkJJmlucHV0LT5oX3ByaW1lX3ZhbGlkYXRp
b24sICZzdGF0dXMsCisJCQloZGNwLCAiaF9wcmltZV92YWxpZGF0aW9uIikpCisJCWdvdG8gb3V0
Oworb3V0OgorCXJldHVybiBzdGF0dXM7Cit9CisKK3N0YXRpYyBlbnVtIG1vZF9oZGNwX3N0YXR1
cyBsb2NhbGl0eV9jaGVjayhzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCisJCXN0cnVjdCBtb2RfaGRj
cF9ldmVudF9jb250ZXh0ICpldmVudF9jdHgsCisJCXN0cnVjdCBtb2RfaGRjcF90cmFuc2l0aW9u
X2lucHV0X2hkY3AyICppbnB1dCkKK3sKKwllbnVtIG1vZF9oZGNwX3N0YXR1cyBzdGF0dXMgPSBN
T0RfSERDUF9TVEFUVVNfU1VDQ0VTUzsKKworCWlmIChldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9I
RENQX0VWRU5UX0NBTExCQUNLKSB7CisJCWV2ZW50X2N0eC0+dW5leHBlY3RlZF9ldmVudCA9IDE7
CisJCWdvdG8gb3V0OworCX0KKworCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KG1vZF9o
ZGNwX2hkY3AyX3ByZXBhcmVfbGNfaW5pdCwKKwkJCSZpbnB1dC0+bGNfaW5pdF9wcmVwYXJlLCAm
c3RhdHVzLAorCQkJaGRjcCwgImxjX2luaXRfcHJlcGFyZSIpKQorCQlnb3RvIG91dDsKKwlpZiAo
IW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChtb2RfaGRjcF93cml0ZV9sY19pbml0LAorCQkJJmlu
cHV0LT5sY19pbml0X3dyaXRlLCAmc3RhdHVzLAorCQkJIGhkY3AsICJsY19pbml0X3dyaXRlIikp
CisJCWdvdG8gb3V0OworCWlmIChpc19kcF9oZGNwKGhkY3ApKQorCQl1ZGVsYXkoMTYwMDApOwor
CWVsc2UKKwkJaWYgKCFtb2RfaGRjcF9leGVjdXRlX2FuZF9zZXQocG9sbF9sX3ByaW1lX2F2YWls
YWJsZSwKKwkJCQkmaW5wdXQtPmxfcHJpbWVfYXZhaWxhYmxlX3BvbGwsICZzdGF0dXMsCisJCQkJ
aGRjcCwgImxfcHJpbWVfYXZhaWxhYmxlX3BvbGwiKSkKKwkJCWdvdG8gb3V0OworCWlmICghbW9k
X2hkY3BfZXhlY3V0ZV9hbmRfc2V0KG1vZF9oZGNwX3JlYWRfbF9wcmltZSwKKwkJCSZpbnB1dC0+
bF9wcmltZV9yZWFkLCAmc3RhdHVzLAorCQkJaGRjcCwgImxfcHJpbWVfcmVhZCIpKQorCQlnb3Rv
IG91dDsKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChtb2RfaGRjcF9oZGNwMl92YWxp
ZGF0ZV9sX3ByaW1lLAorCQkJJmlucHV0LT5sX3ByaW1lX3ZhbGlkYXRpb24sICZzdGF0dXMsCisJ
CQloZGNwLCAibF9wcmltZV92YWxpZGF0aW9uIikpCisJCWdvdG8gb3V0Oworb3V0OgorCXJldHVy
biBzdGF0dXM7Cit9CisKK3N0YXRpYyBlbnVtIG1vZF9oZGNwX3N0YXR1cyBleGNoYW5nZV9rc19h
bmRfdGVzdF9mb3JfcmVwZWF0ZXIoc3RydWN0IG1vZF9oZGNwICpoZGNwLAorCQlzdHJ1Y3QgbW9k
X2hkY3BfZXZlbnRfY29udGV4dCAqZXZlbnRfY3R4LAorCQlzdHJ1Y3QgbW9kX2hkY3BfdHJhbnNp
dGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQpCit7CisJZW51bSBtb2RfaGRjcF9zdGF0dXMgc3RhdHVz
ID0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1M7CisKKwlpZiAoZXZlbnRfY3R4LT5ldmVudCAhPSBN
T0RfSERDUF9FVkVOVF9DQUxMQkFDSykgeworCQlldmVudF9jdHgtPnVuZXhwZWN0ZWRfZXZlbnQg
PSAxOworCQlnb3RvIG91dDsKKwl9CisKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldCht
b2RfaGRjcF9oZGNwMl9wcmVwYXJlX2VrcywKKwkJCSZpbnB1dC0+ZWtzX3ByZXBhcmUsICZzdGF0
dXMsCisJCQloZGNwLCAiZWtzX3ByZXBhcmUiKSkKKwkJZ290byBvdXQ7CisJaWYgKCFtb2RfaGRj
cF9leGVjdXRlX2FuZF9zZXQobW9kX2hkY3Bfd3JpdGVfZWtzLAorCQkJJmlucHV0LT5la3Nfd3Jp
dGUsICZzdGF0dXMsCisJCQloZGNwLCAiZWtzX3dyaXRlIikpCisJCWdvdG8gb3V0Oworb3V0Ogor
CXJldHVybiBzdGF0dXM7Cit9CisKK3N0YXRpYyBlbnVtIG1vZF9oZGNwX3N0YXR1cyBlbmFibGVf
ZW5jcnlwdGlvbihzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCisJCXN0cnVjdCBtb2RfaGRjcF9ldmVu
dF9jb250ZXh0ICpldmVudF9jdHgsCisJCXN0cnVjdCBtb2RfaGRjcF90cmFuc2l0aW9uX2lucHV0
X2hkY3AyICppbnB1dCkKK3sKKwllbnVtIG1vZF9oZGNwX3N0YXR1cyBzdGF0dXMgPSBNT0RfSERD
UF9TVEFUVVNfU1VDQ0VTUzsKKworCWlmIChldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VW
RU5UX0NBTExCQUNLICYmCisJCQlldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NQ
SVJRKSB7CisJCWV2ZW50X2N0eC0+dW5leHBlY3RlZF9ldmVudCA9IDE7CisJCWdvdG8gb3V0Owor
CX0KKwlpZiAoZXZlbnRfY3R4LT5ldmVudCA9PSBNT0RfSERDUF9FVkVOVF9DUElSUSkgeworCQlw
cm9jZXNzX3J4c3RhdHVzKGhkY3AsIGV2ZW50X2N0eCwgaW5wdXQsICZzdGF0dXMpOworCQlnb3Rv
IG91dDsKKwl9CisKKwlpZiAoaXNfaGRtaV9kdmlfc2xfaGRjcChoZGNwKSkgeworCQlpZiAoIXBy
b2Nlc3NfcnhzdGF0dXMoaGRjcCwgZXZlbnRfY3R4LCBpbnB1dCwgJnN0YXR1cykpCisJCQlnb3Rv
IG91dDsKKwkJaWYgKGV2ZW50X2N0eC0+cnhfaWRfbGlzdF9yZWFkeSkKKwkJCWdvdG8gb3V0Owor
CX0KKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChtb2RfaGRjcF9oZGNwMl9lbmFibGVf
ZW5jcnlwdGlvbiwKKwkJCSZpbnB1dC0+ZW5hYmxlX2VuY3J5cHRpb24sICZzdGF0dXMsCisJCQlo
ZGNwLCAiZW5hYmxlX2VuY3J5cHRpb24iKSkKKwkJZ290byBvdXQ7CisJaWYgKGlzX2RwX21zdF9o
ZGNwKGhkY3ApKSB7CisJCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KAorCQkJCW1vZF9o
ZGNwX2hkY3AyX2VuYWJsZV9kcF9zdHJlYW1fZW5jcnlwdGlvbiwKKwkJCQkmaW5wdXQtPnN0cmVh
bV9lbmNyeXB0aW9uX2RwLCAmc3RhdHVzLAorCQkJCWhkY3AsICJzdHJlYW1fZW5jcnlwdGlvbl9k
cCIpKQorCQkJZ290byBvdXQ7CisJfQorb3V0OgorCXJldHVybiBzdGF0dXM7Cit9CisKK3N0YXRp
YyBlbnVtIG1vZF9oZGNwX3N0YXR1cyBhdXRoZW50aWNhdGVkKHN0cnVjdCBtb2RfaGRjcCAqaGRj
cCwKKwkJc3RydWN0IG1vZF9oZGNwX2V2ZW50X2NvbnRleHQgKmV2ZW50X2N0eCwKKwkJc3RydWN0
IG1vZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDIgKmlucHV0KQoreworCWVudW0gbW9kX2hk
Y3Bfc3RhdHVzIHN0YXR1cyA9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTOworCisJaWYgKGV2ZW50
X2N0eC0+ZXZlbnQgIT0gTU9EX0hEQ1BfRVZFTlRfQ0FMTEJBQ0sgJiYKKwkJCWV2ZW50X2N0eC0+
ZXZlbnQgIT0gTU9EX0hEQ1BfRVZFTlRfQ1BJUlEpIHsKKwkJZXZlbnRfY3R4LT51bmV4cGVjdGVk
X2V2ZW50ID0gMTsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKCFwcm9jZXNzX3J4c3RhdHVzKGhk
Y3AsIGV2ZW50X2N0eCwgaW5wdXQsICZzdGF0dXMpKQorCQlnb3RvIG91dDsKKwlpZiAoZXZlbnRf
Y3R4LT5yeF9pZF9saXN0X3JlYWR5KQorCQlnb3RvIG91dDsKK291dDoKKwlyZXR1cm4gc3RhdHVz
OworfQorCitzdGF0aWMgZW51bSBtb2RfaGRjcF9zdGF0dXMgd2FpdF9mb3JfcnhfaWRfbGlzdChz
dHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCisJCXN0cnVjdCBtb2RfaGRjcF9ldmVudF9jb250ZXh0ICpl
dmVudF9jdHgsCisJCXN0cnVjdCBtb2RfaGRjcF90cmFuc2l0aW9uX2lucHV0X2hkY3AyICppbnB1
dCkKK3sKKwllbnVtIG1vZF9oZGNwX3N0YXR1cyBzdGF0dXMgPSBNT0RfSERDUF9TVEFUVVNfU1VD
Q0VTUzsKKworCWlmIChldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NBTExCQUNL
ICYmCisJCQlldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NQSVJRICYmCisJCQll
dmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX1dBVENIRE9HX1RJTUVPVVQpIHsKKwkJ
ZXZlbnRfY3R4LT51bmV4cGVjdGVkX2V2ZW50ID0gMTsKKwkJZ290byBvdXQ7CisJfQorCisJaWYg
KCFwcm9jZXNzX3J4c3RhdHVzKGhkY3AsIGV2ZW50X2N0eCwgaW5wdXQsICZzdGF0dXMpKQorCQln
b3RvIG91dDsKKwlpZiAoIWV2ZW50X2N0eC0+cnhfaWRfbGlzdF9yZWFkeSkgeworCQlzdGF0dXMg
PSBNT0RfSERDUF9TVEFUVVNfSERDUDJfUlhfSURfTElTVF9OT1RfUkVBRFk7CisJCWdvdG8gb3V0
OworCX0KK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMgZW51bSBtb2RfaGRjcF9z
dGF0dXMgdmVyaWZ5X3J4X2lkX2xpc3RfYW5kX3NlbmRfYWNrKHN0cnVjdCBtb2RfaGRjcCAqaGRj
cCwKKwkJc3RydWN0IG1vZF9oZGNwX2V2ZW50X2NvbnRleHQgKmV2ZW50X2N0eCwKKwkJc3RydWN0
IG1vZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDIgKmlucHV0KQoreworCWVudW0gbW9kX2hk
Y3Bfc3RhdHVzIHN0YXR1cyA9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTOworCisJaWYgKGV2ZW50
X2N0eC0+ZXZlbnQgIT0gTU9EX0hEQ1BfRVZFTlRfQ0FMTEJBQ0sgJiYKKwkJCWV2ZW50X2N0eC0+
ZXZlbnQgIT0gTU9EX0hEQ1BfRVZFTlRfQ1BJUlEpIHsKKwkJZXZlbnRfY3R4LT51bmV4cGVjdGVk
X2V2ZW50ID0gMTsKKwkJZ290byBvdXQ7CisJfQorCWlmIChldmVudF9jdHgtPmV2ZW50ID09IE1P
RF9IRENQX0VWRU5UX0NQSVJRKSB7CisJCXByb2Nlc3NfcnhzdGF0dXMoaGRjcCwgZXZlbnRfY3R4
LCBpbnB1dCwgJnN0YXR1cyk7CisJCWdvdG8gb3V0OworCX0KKworCWlmICghbW9kX2hkY3BfZXhl
Y3V0ZV9hbmRfc2V0KG1vZF9oZGNwX3JlYWRfcnhfaWRfbGlzdCwKKwkJCSZpbnB1dC0+cnhfaWRf
bGlzdF9yZWFkLAorCQkJJnN0YXR1cywgaGRjcCwgInJlY2VpdmVyX2lkX2xpc3RfcmVhZCIpKQor
CQlnb3RvIG91dDsKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChjaGVja19kZXZpY2Vf
Y291bnQsCisJCQkmaW5wdXQtPmRldmljZV9jb3VudF9jaGVjaywKKwkJCSZzdGF0dXMsIGhkY3As
ICJkZXZpY2VfY291bnRfY2hlY2siKSkKKwkJZ290byBvdXQ7CisJaWYgKCFtb2RfaGRjcF9leGVj
dXRlX2FuZF9zZXQobW9kX2hkY3BfaGRjcDJfdmFsaWRhdGVfcnhfaWRfbGlzdCwKKwkJCSZpbnB1
dC0+cnhfaWRfbGlzdF92YWxpZGF0aW9uLAorCQkJJnN0YXR1cywgaGRjcCwgInJ4X2lkX2xpc3Rf
dmFsaWRhdGlvbiIpKQorCQlnb3RvIG91dDsKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3Nl
dChtb2RfaGRjcF93cml0ZV9yZXBlYXRlcl9hdXRoX2FjaywKKwkJCSZpbnB1dC0+cmVwZWF0ZXJf
YXV0aF9hY2tfd3JpdGUsCisJCQkmc3RhdHVzLCBoZGNwLCAicmVwZWF0ZXJfYXV0aF9hY2tfd3Jp
dGUiKSkKKwkJZ290byBvdXQ7CitvdXQ6CisJcmV0dXJuIHN0YXR1czsKK30KKworc3RhdGljIGVu
dW0gbW9kX2hkY3Bfc3RhdHVzIHNlbmRfc3RyZWFtX21hbmFnZW1lbnQoc3RydWN0IG1vZF9oZGNw
ICpoZGNwLAorCQlzdHJ1Y3QgbW9kX2hkY3BfZXZlbnRfY29udGV4dCAqZXZlbnRfY3R4LAorCQlz
dHJ1Y3QgbW9kX2hkY3BfdHJhbnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQpCit7CisJZW51bSBt
b2RfaGRjcF9zdGF0dXMgc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1M7CisKKwlpZiAo
ZXZlbnRfY3R4LT5ldmVudCAhPSBNT0RfSERDUF9FVkVOVF9DQUxMQkFDSyAmJgorCQkJZXZlbnRf
Y3R4LT5ldmVudCAhPSBNT0RfSERDUF9FVkVOVF9DUElSUSkgeworCQlldmVudF9jdHgtPnVuZXhw
ZWN0ZWRfZXZlbnQgPSAxOworCQlnb3RvIG91dDsKKwl9CisJaWYgKGV2ZW50X2N0eC0+ZXZlbnQg
PT0gTU9EX0hEQ1BfRVZFTlRfQ1BJUlEpIHsKKwkJcHJvY2Vzc19yeHN0YXR1cyhoZGNwLCBldmVu
dF9jdHgsIGlucHV0LCAmc3RhdHVzKTsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKGlzX2hkbWlf
ZHZpX3NsX2hkY3AoaGRjcCkpIHsKKwkJaWYgKCFwcm9jZXNzX3J4c3RhdHVzKGhkY3AsIGV2ZW50
X2N0eCwgaW5wdXQsICZzdGF0dXMpKQorCQkJZ290byBvdXQ7CisJCWlmIChldmVudF9jdHgtPnJ4
X2lkX2xpc3RfcmVhZHkpCisJCQlnb3RvIG91dDsKKwl9CisJaWYgKCFtb2RfaGRjcF9leGVjdXRl
X2FuZF9zZXQobW9kX2hkY3BfaGRjcDJfcHJlcGFyZV9zdHJlYW1fbWFuYWdlbWVudCwKKwkJCSZp
bnB1dC0+cHJlcGFyZV9zdHJlYW1fbWFuYWdlLAorCQkJJnN0YXR1cywgaGRjcCwgInByZXBhcmVf
c3RyZWFtX21hbmFnZSIpKQorCQlnb3RvIG91dDsKKworCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9h
bmRfc2V0KG1vZF9oZGNwX3dyaXRlX3N0cmVhbV9tYW5hZ2UsCisJCQkmaW5wdXQtPnN0cmVhbV9t
YW5hZ2Vfd3JpdGUsCisJCQkmc3RhdHVzLCBoZGNwLCAic3RyZWFtX21hbmFnZV93cml0ZSIpKQor
CQlnb3RvIG91dDsKK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMgZW51bSBtb2Rf
aGRjcF9zdGF0dXMgdmFsaWRhdGVfc3RyZWFtX3JlYWR5KHN0cnVjdCBtb2RfaGRjcCAqaGRjcCwK
KwkJc3RydWN0IG1vZF9oZGNwX2V2ZW50X2NvbnRleHQgKmV2ZW50X2N0eCwKKwkJc3RydWN0IG1v
ZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDIgKmlucHV0KQoreworCWVudW0gbW9kX2hkY3Bf
c3RhdHVzIHN0YXR1cyA9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTOworCisJaWYgKGV2ZW50X2N0
eC0+ZXZlbnQgIT0gTU9EX0hEQ1BfRVZFTlRfQ0FMTEJBQ0sgJiYKKwkJCWV2ZW50X2N0eC0+ZXZl
bnQgIT0gTU9EX0hEQ1BfRVZFTlRfQ1BJUlEgJiYKKwkJCWV2ZW50X2N0eC0+ZXZlbnQgIT0gTU9E
X0hEQ1BfRVZFTlRfV0FUQ0hET0dfVElNRU9VVCkgeworCQlldmVudF9jdHgtPnVuZXhwZWN0ZWRf
ZXZlbnQgPSAxOworCQlnb3RvIG91dDsKKwl9CisJaWYgKGV2ZW50X2N0eC0+ZXZlbnQgPT0gTU9E
X0hEQ1BfRVZFTlRfQ1BJUlEpIHsKKwkJcHJvY2Vzc19yeHN0YXR1cyhoZGNwLCBldmVudF9jdHgs
IGlucHV0LCAmc3RhdHVzKTsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKGlzX2hkbWlfZHZpX3Ns
X2hkY3AoaGRjcCkpIHsKKwkJaWYgKCFwcm9jZXNzX3J4c3RhdHVzKGhkY3AsIGV2ZW50X2N0eCwg
aW5wdXQsICZzdGF0dXMpKQorCQkJZ290byBvdXQ7CisJCWlmIChldmVudF9jdHgtPnJ4X2lkX2xp
c3RfcmVhZHkpIHsKKwkJCWdvdG8gb3V0OworCQl9CisJfQorCWlmIChpc19oZG1pX2R2aV9zbF9o
ZGNwKGhkY3ApKQorCQlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVfYW5kX3NldChjaGVja19zdHJlYW1f
cmVhZHlfYXZhaWxhYmxlLAorCQkJCSZpbnB1dC0+c3RyZWFtX3JlYWR5X2F2YWlsYWJsZSwKKwkJ
CQkmc3RhdHVzLCBoZGNwLCAic3RyZWFtX3JlYWR5X2F2YWlsYWJsZSIpKQorCQkJZ290byBvdXQ7
CisJaWYgKCFtb2RfaGRjcF9leGVjdXRlX2FuZF9zZXQobW9kX2hkY3BfcmVhZF9zdHJlYW1fcmVh
ZHksCisJCQkmaW5wdXQtPnN0cmVhbV9yZWFkeV9yZWFkLAorCQkJJnN0YXR1cywgaGRjcCwgInN0
cmVhbV9yZWFkeV9yZWFkIikpCisJCWdvdG8gb3V0OworCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9h
bmRfc2V0KG1vZF9oZGNwX2hkY3AyX3ZhbGlkYXRlX3N0cmVhbV9yZWFkeSwKKwkJCSZpbnB1dC0+
c3RyZWFtX3JlYWR5X3ZhbGlkYXRpb24sCisJCQkmc3RhdHVzLCBoZGNwLCAic3RyZWFtX3JlYWR5
X3ZhbGlkYXRpb24iKSkKKwkJZ290byBvdXQ7CisKK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQor
CitzdGF0aWMgZW51bSBtb2RfaGRjcF9zdGF0dXMgZGV0ZXJtaW5lX3J4X2hkY3BfY2FwYWJsZV9k
cChzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCisJCXN0cnVjdCBtb2RfaGRjcF9ldmVudF9jb250ZXh0
ICpldmVudF9jdHgsCisJCXN0cnVjdCBtb2RfaGRjcF90cmFuc2l0aW9uX2lucHV0X2hkY3AyICpp
bnB1dCkKK3sKKwllbnVtIG1vZF9oZGNwX3N0YXR1cyBzdGF0dXMgPSBNT0RfSERDUF9TVEFUVVNf
U1VDQ0VTUzsKKworCWlmIChldmVudF9jdHgtPmV2ZW50ICE9IE1PRF9IRENQX0VWRU5UX0NBTExC
QUNLKSB7CisJCWV2ZW50X2N0eC0+dW5leHBlY3RlZF9ldmVudCA9IDE7CisJCWdvdG8gb3V0Owor
CX0KKworCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0KG1vZF9oZGNwX3JlYWRfcnhjYXBz
LAorCQkJJmlucHV0LT5yeF9jYXBzX3JlYWRfZHAsCisJCQkmc3RhdHVzLCBoZGNwLCAicnhfY2Fw
c19yZWFkX2RwIikpCisJCWdvdG8gb3V0OworCWlmICghbW9kX2hkY3BfZXhlY3V0ZV9hbmRfc2V0
KGNoZWNrX2hkY3AyX2NhcGFibGUsCisJCQkmaW5wdXQtPmhkY3AyX2NhcGFibGVfY2hlY2ssICZz
dGF0dXMsCisJCQloZGNwLCAiaGRjcDJfY2FwYWJsZV9jaGVjayIpKQorCQlnb3RvIG91dDsKK291
dDoKKwlyZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMgZW51bSBtb2RfaGRjcF9zdGF0dXMgc2Vu
ZF9jb250ZW50X3N0cmVhbV90eXBlX2RwKHN0cnVjdCBtb2RfaGRjcCAqaGRjcCwKKwkJc3RydWN0
IG1vZF9oZGNwX2V2ZW50X2NvbnRleHQgKmV2ZW50X2N0eCwKKwkJc3RydWN0IG1vZF9oZGNwX3Ry
YW5zaXRpb25faW5wdXRfaGRjcDIgKmlucHV0KQoreworCWVudW0gbW9kX2hkY3Bfc3RhdHVzIHN0
YXR1cyA9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTOworCisJaWYgKGV2ZW50X2N0eC0+ZXZlbnQg
IT0gTU9EX0hEQ1BfRVZFTlRfQ0FMTEJBQ0sgJiYKKwkJCWV2ZW50X2N0eC0+ZXZlbnQgIT0gTU9E
X0hEQ1BfRVZFTlRfQ1BJUlEpIHsKKwkJZXZlbnRfY3R4LT51bmV4cGVjdGVkX2V2ZW50ID0gMTsK
KwkJZ290byBvdXQ7CisJfQorCisJaWYgKCFwcm9jZXNzX3J4c3RhdHVzKGhkY3AsIGV2ZW50X2N0
eCwgaW5wdXQsICZzdGF0dXMpKQorCQlnb3RvIG91dDsKKwlpZiAoIW1vZF9oZGNwX2V4ZWN1dGVf
YW5kX3NldChtb2RfaGRjcF93cml0ZV9jb250ZW50X3R5cGUsCisJCQkmaW5wdXQtPmNvbnRlbnRf
c3RyZWFtX3R5cGVfd3JpdGUsICZzdGF0dXMsCisJCQloZGNwLCAiY29udGVudF9zdHJlYW1fdHlw
ZV93cml0ZSIpKQorCQlnb3RvIG91dDsKK291dDoKKwlyZXR1cm4gc3RhdHVzOworfQorCitlbnVt
IG1vZF9oZGNwX3N0YXR1cyBtb2RfaGRjcF9oZGNwMl9leGVjdXRpb24oc3RydWN0IG1vZF9oZGNw
ICpoZGNwLAorCXN0cnVjdCBtb2RfaGRjcF9ldmVudF9jb250ZXh0ICpldmVudF9jdHgsCisJc3Ry
dWN0IG1vZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDIgKmlucHV0KQoreworCWVudW0gbW9k
X2hkY3Bfc3RhdHVzIHN0YXR1cyA9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTOworCisJc3dpdGNo
IChjdXJyZW50X3N0YXRlKGhkY3ApKSB7CisJY2FzZSBIMl9BMF9LTk9XTl9IRENQMl9DQVBBQkxF
X1JYOgorCQlzdGF0dXMgPSBrbm93bl9oZGNwMl9jYXBhYmxlX3J4KGhkY3AsIGV2ZW50X2N0eCwg
aW5wdXQpOworCQlicmVhazsKKwljYXNlIEgyX0ExX1NFTkRfQUtFX0lOSVQ6CisJCXN0YXR1cyA9
IHNlbmRfYWtlX2luaXQoaGRjcCwgZXZlbnRfY3R4LCBpbnB1dCk7CisJCWJyZWFrOworCWNhc2Ug
SDJfQTFfVkFMSURBVEVfQUtFX0NFUlQ6CisJCXN0YXR1cyA9IHZhbGlkYXRlX2FrZV9jZXJ0KGhk
Y3AsIGV2ZW50X2N0eCwgaW5wdXQpOworCQlicmVhazsKKwljYXNlIEgyX0ExX1NFTkRfTk9fU1RP
UkVEX0tNOgorCQlzdGF0dXMgPSBzZW5kX25vX3N0b3JlZF9rbShoZGNwLCBldmVudF9jdHgsIGlu
cHV0KTsKKwkJYnJlYWs7CisJY2FzZSBIMl9BMV9SRUFEX0hfUFJJTUU6CisJCXN0YXR1cyA9IHJl
YWRfaF9wcmltZShoZGNwLCBldmVudF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJY2FzZSBIMl9B
MV9SRUFEX1BBSVJJTkdfSU5GT19BTkRfVkFMSURBVEVfSF9QUklNRToKKwkJc3RhdHVzID0gcmVh
ZF9wYWlyaW5nX2luZm9fYW5kX3ZhbGlkYXRlX2hfcHJpbWUoaGRjcCwKKwkJCQlldmVudF9jdHgs
IGlucHV0KTsKKwkJYnJlYWs7CisJY2FzZSBIMl9BMV9TRU5EX1NUT1JFRF9LTToKKwkJc3RhdHVz
ID0gc2VuZF9zdG9yZWRfa20oaGRjcCwgZXZlbnRfY3R4LCBpbnB1dCk7CisJCWJyZWFrOworCWNh
c2UgSDJfQTFfVkFMSURBVEVfSF9QUklNRToKKwkJc3RhdHVzID0gdmFsaWRhdGVfaF9wcmltZSho
ZGNwLCBldmVudF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJY2FzZSBIMl9BMl9MT0NBTElUWV9D
SEVDSzoKKwkJc3RhdHVzID0gbG9jYWxpdHlfY2hlY2soaGRjcCwgZXZlbnRfY3R4LCBpbnB1dCk7
CisJCWJyZWFrOworCWNhc2UgSDJfQTNfRVhDSEFOR0VfS1NfQU5EX1RFU1RfRk9SX1JFUEVBVEVS
OgorCQlzdGF0dXMgPSBleGNoYW5nZV9rc19hbmRfdGVzdF9mb3JfcmVwZWF0ZXIoaGRjcCwgZXZl
bnRfY3R4LCBpbnB1dCk7CisJCWJyZWFrOworCWNhc2UgSDJfRU5BQkxFX0VOQ1JZUFRJT046CisJ
CXN0YXR1cyA9IGVuYWJsZV9lbmNyeXB0aW9uKGhkY3AsIGV2ZW50X2N0eCwgaW5wdXQpOworCQli
cmVhazsKKwljYXNlIEgyX0E1X0FVVEhFTlRJQ0FURUQ6CisJCXN0YXR1cyA9IGF1dGhlbnRpY2F0
ZWQoaGRjcCwgZXZlbnRfY3R4LCBpbnB1dCk7CisJCWJyZWFrOworCWNhc2UgSDJfQTZfV0FJVF9G
T1JfUlhfSURfTElTVDoKKwkJc3RhdHVzID0gd2FpdF9mb3JfcnhfaWRfbGlzdChoZGNwLCBldmVu
dF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJY2FzZSBIMl9BNzhfVkVSSUZZX1JYX0lEX0xJU1Rf
QU5EX1NFTkRfQUNLOgorCQlzdGF0dXMgPSB2ZXJpZnlfcnhfaWRfbGlzdF9hbmRfc2VuZF9hY2so
aGRjcCwgZXZlbnRfY3R4LCBpbnB1dCk7CisJCWJyZWFrOworCWNhc2UgSDJfQTlfU0VORF9TVFJF
QU1fTUFOQUdFTUVOVDoKKwkJc3RhdHVzID0gc2VuZF9zdHJlYW1fbWFuYWdlbWVudChoZGNwLCBl
dmVudF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJY2FzZSBIMl9BOV9WQUxJREFURV9TVFJFQU1f
UkVBRFk6CisJCXN0YXR1cyA9IHZhbGlkYXRlX3N0cmVhbV9yZWFkeShoZGNwLCBldmVudF9jdHgs
IGlucHV0KTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVT
X0lOVkFMSURfU1RBVEU7CisJCWJyZWFrOworCX0KKworCXJldHVybiBzdGF0dXM7Cit9CisKK2Vu
dW0gbW9kX2hkY3Bfc3RhdHVzIG1vZF9oZGNwX2hkY3AyX2RwX2V4ZWN1dGlvbihzdHJ1Y3QgbW9k
X2hkY3AgKmhkY3AsCisJc3RydWN0IG1vZF9oZGNwX2V2ZW50X2NvbnRleHQgKmV2ZW50X2N0eCwK
KwlzdHJ1Y3QgbW9kX2hkY3BfdHJhbnNpdGlvbl9pbnB1dF9oZGNwMiAqaW5wdXQpCit7CisJZW51
bSBtb2RfaGRjcF9zdGF0dXMgc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1M7CisKKwlz
d2l0Y2ggKGN1cnJlbnRfc3RhdGUoaGRjcCkpIHsKKwljYXNlIEQyX0EwX0RFVEVSTUlORV9SWF9I
RENQX0NBUEFCTEU6CisJCXN0YXR1cyA9IGRldGVybWluZV9yeF9oZGNwX2NhcGFibGVfZHAoaGRj
cCwgZXZlbnRfY3R4LCBpbnB1dCk7CisJCWJyZWFrOworCWNhc2UgRDJfQTFfU0VORF9BS0VfSU5J
VDoKKwkJc3RhdHVzID0gc2VuZF9ha2VfaW5pdChoZGNwLCBldmVudF9jdHgsIGlucHV0KTsKKwkJ
YnJlYWs7CisJY2FzZSBEMl9BMV9WQUxJREFURV9BS0VfQ0VSVDoKKwkJc3RhdHVzID0gdmFsaWRh
dGVfYWtlX2NlcnQoaGRjcCwgZXZlbnRfY3R4LCBpbnB1dCk7CisJCWJyZWFrOworCWNhc2UgRDJf
QTFfU0VORF9OT19TVE9SRURfS006CisJCXN0YXR1cyA9IHNlbmRfbm9fc3RvcmVkX2ttKGhkY3As
IGV2ZW50X2N0eCwgaW5wdXQpOworCQlicmVhazsKKwljYXNlIEQyX0ExX1JFQURfSF9QUklNRToK
KwkJc3RhdHVzID0gcmVhZF9oX3ByaW1lKGhkY3AsIGV2ZW50X2N0eCwgaW5wdXQpOworCQlicmVh
azsKKwljYXNlIEQyX0ExX1JFQURfUEFJUklOR19JTkZPX0FORF9WQUxJREFURV9IX1BSSU1FOgor
CQlzdGF0dXMgPSByZWFkX3BhaXJpbmdfaW5mb19hbmRfdmFsaWRhdGVfaF9wcmltZShoZGNwLAor
CQkJCWV2ZW50X2N0eCwgaW5wdXQpOworCQlicmVhazsKKwljYXNlIEQyX0ExX1NFTkRfU1RPUkVE
X0tNOgorCQlzdGF0dXMgPSBzZW5kX3N0b3JlZF9rbShoZGNwLCBldmVudF9jdHgsIGlucHV0KTsK
KwkJYnJlYWs7CisJY2FzZSBEMl9BMV9WQUxJREFURV9IX1BSSU1FOgorCQlzdGF0dXMgPSB2YWxp
ZGF0ZV9oX3ByaW1lKGhkY3AsIGV2ZW50X2N0eCwgaW5wdXQpOworCQlicmVhazsKKwljYXNlIEQy
X0EyX0xPQ0FMSVRZX0NIRUNLOgorCQlzdGF0dXMgPSBsb2NhbGl0eV9jaGVjayhoZGNwLCBldmVu
dF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJY2FzZSBEMl9BMzRfRVhDSEFOR0VfS1NfQU5EX1RF
U1RfRk9SX1JFUEVBVEVSOgorCQlzdGF0dXMgPSBleGNoYW5nZV9rc19hbmRfdGVzdF9mb3JfcmVw
ZWF0ZXIoaGRjcCwKKwkJCQlldmVudF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJY2FzZSBEMl9T
RU5EX0NPTlRFTlRfU1RSRUFNX1RZUEU6CisJCXN0YXR1cyA9IHNlbmRfY29udGVudF9zdHJlYW1f
dHlwZV9kcChoZGNwLCBldmVudF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJY2FzZSBEMl9FTkFC
TEVfRU5DUllQVElPTjoKKwkJc3RhdHVzID0gZW5hYmxlX2VuY3J5cHRpb24oaGRjcCwgZXZlbnRf
Y3R4LCBpbnB1dCk7CisJCWJyZWFrOworCWNhc2UgRDJfQTVfQVVUSEVOVElDQVRFRDoKKwkJc3Rh
dHVzID0gYXV0aGVudGljYXRlZChoZGNwLCBldmVudF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJ
Y2FzZSBEMl9BNl9XQUlUX0ZPUl9SWF9JRF9MSVNUOgorCQlzdGF0dXMgPSB3YWl0X2Zvcl9yeF9p
ZF9saXN0KGhkY3AsIGV2ZW50X2N0eCwgaW5wdXQpOworCQlicmVhazsKKwljYXNlIEQyX0E3OF9W
RVJJRllfUlhfSURfTElTVF9BTkRfU0VORF9BQ0s6CisJCXN0YXR1cyA9IHZlcmlmeV9yeF9pZF9s
aXN0X2FuZF9zZW5kX2FjayhoZGNwLCBldmVudF9jdHgsIGlucHV0KTsKKwkJYnJlYWs7CisJY2Fz
ZSBEMl9BOV9TRU5EX1NUUkVBTV9NQU5BR0VNRU5UOgorCQlzdGF0dXMgPSBzZW5kX3N0cmVhbV9t
YW5hZ2VtZW50KGhkY3AsIGV2ZW50X2N0eCwgaW5wdXQpOworCQlicmVhazsKKwljYXNlIEQyX0E5
X1ZBTElEQVRFX1NUUkVBTV9SRUFEWToKKwkJc3RhdHVzID0gdmFsaWRhdGVfc3RyZWFtX3JlYWR5
KGhkY3AsIGV2ZW50X2N0eCwgaW5wdXQpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlzdGF0dXMg
PSBNT0RfSERDUF9TVEFUVVNfSU5WQUxJRF9TVEFURTsKKwkJYnJlYWs7CisJfQorCisJcmV0dXJu
IHN0YXR1czsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9tb2R1
bGVzL2hkY3AvaGRjcDJfdHJhbnNpdGlvbi5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5
L21vZHVsZXMvaGRjcC9oZGNwMl90cmFuc2l0aW9uLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAwMDAwLi45NGEwZTVmYTkzMWIKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9oZGNwL2hkY3AyX3RyYW5zaXRpb24uYwpAQCAt
MCwwICsxLDY3NCBAQAorLyoKKyAqIENvcHlyaWdodCAyMDE4IEFkdmFuY2VkIE1pY3JvIERldmlj
ZXMsIEluYy4KKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNo
YXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICogY29weSBvZiB0aGlzIHNvZnR3YXJl
IGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKKyAq
IHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3
aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1l
cmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLAorICogYW5kL29yIHNlbGwgY29w
aWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCisg
KiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2lu
ZyBjb25kaXRpb25zOgorICoKKyAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlz
IHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCisgKiBhbGwgY29waWVzIG9y
IHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdB
UkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQ
UkVTUyBPUgorICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FS
UkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIg
UFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBD
T1BZUklHSFQgSE9MREVSKFMpIE9SIEFVVEhPUihTKSBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwg
REFNQUdFUyBPUgorICogT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBD
T05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsCisgKiBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJ
TiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IKKyAqIE9USEVSIERF
QUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKyAqCisgKiBBdXRob3JzOiBBTUQKKyAqCisgKi8KKwor
I2luY2x1ZGUgImhkY3AuaCIKKworZW51bSBtb2RfaGRjcF9zdGF0dXMgbW9kX2hkY3BfaGRjcDJf
dHJhbnNpdGlvbihzdHJ1Y3QgbW9kX2hkY3AgKmhkY3AsCisJCXN0cnVjdCBtb2RfaGRjcF9ldmVu
dF9jb250ZXh0ICpldmVudF9jdHgsCisJCXN0cnVjdCBtb2RfaGRjcF90cmFuc2l0aW9uX2lucHV0
X2hkY3AyICppbnB1dCwKKwkJc3RydWN0IG1vZF9oZGNwX291dHB1dCAqb3V0cHV0KQoreworCWVu
dW0gbW9kX2hkY3Bfc3RhdHVzIHN0YXR1cyA9IE1PRF9IRENQX1NUQVRVU19TVUNDRVNTOworCXN0
cnVjdCBtb2RfaGRjcF9jb25uZWN0aW9uICpjb25uID0gJmhkY3AtPmNvbm5lY3Rpb247CisJc3Ry
dWN0IG1vZF9oZGNwX2xpbmtfYWRqdXN0bWVudCAqYWRqdXN0ID0gJmhkY3AtPmNvbm5lY3Rpb24u
bGluay5hZGp1c3Q7CisKKwlzd2l0Y2ggKGN1cnJlbnRfc3RhdGUoaGRjcCkpIHsKKwljYXNlIEgy
X0EwX0tOT1dOX0hEQ1AyX0NBUEFCTEVfUlg6CisJCWlmIChpbnB1dC0+aGRjcDJ2ZXJzaW9uX3Jl
YWQgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5oZGNwMl9jYXBhYmxlX2NoZWNrICE9IFBBU1MpIHsK
KwkJCWFkanVzdC0+aGRjcDIuZGlzYWJsZSA9IDE7CisJCQljYWxsYmFja19pbl9tcygwLCBvdXRw
dXQpOworCQkJc2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1dCwgSERDUF9JTklUSUFMSVpFRCk7CisJ
CX0gZWxzZSB7CisJCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQkJc2V0X3N0YXRlX2lk
KGhkY3AsIG91dHB1dCwgSDJfQTFfU0VORF9BS0VfSU5JVCk7CisJCX0KKwkJYnJlYWs7CisJY2Fz
ZSBIMl9BMV9TRU5EX0FLRV9JTklUOgorCQlpZiAoaW5wdXQtPmFkZF90b3BvbG9neSAhPSBQQVNT
IHx8CisJCQkJaW5wdXQtPmNyZWF0ZV9zZXNzaW9uICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+YWtl
X2luaXRfcHJlcGFyZSAhPSBQQVNTKSB7CisJCQkvKiBvdXQgb2Ygc3luYyB3aXRoIHBzcCBzdGF0
ZSAqLworCQkJYWRqdXN0LT5oZGNwMi5kaXNhYmxlID0gMTsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRf
aW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJyZWFrOworCQl9IGVsc2UgaWYgKGlucHV0
LT5ha2VfaW5pdF93cml0ZSAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21zKDAs
ICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfQorCQlzZXRfd2F0Y2hkb2dfaW5fbXMo
aGRjcCwgMTAwLCBvdXRwdXQpOworCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQlzZXRf
c3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBIMl9BMV9WQUxJREFURV9BS0VfQ0VSVCk7CisJCWJyZWFr
OworCWNhc2UgSDJfQTFfVkFMSURBVEVfQUtFX0NFUlQ6CisJCWlmIChpbnB1dC0+YWtlX2NlcnRf
YXZhaWxhYmxlICE9IFBBU1MpIHsKKwkJCWlmIChldmVudF9jdHgtPmV2ZW50ID09CisJCQkJCU1P
RF9IRENQX0VWRU5UX1dBVENIRE9HX1RJTUVPVVQpIHsKKwkJCQkvKiAxQS0wODogY29uc2lkZXIg
YWtlIHRpbWVvdXQgYSBmYWlsdXJlICovCisJCQkJLyogc29tZSBoZG1pIHJlY2VpdmVycyBhcmUg
bm90IHJlYWR5IGZvciBIRENQCisJCQkJICogaW1tZWRpYXRlbHkgYWZ0ZXIgdmlkZW8gYmVjb21l
cyBhY3RpdmUsCisJCQkJICogZGVsYXkgMXMgYmVmb3JlIHJldHJ5IG9uIGZpcnN0IEhEQ1AgbWVz
c2FnZQorCQkJCSAqIHRpbWVvdXQuCisJCQkJICovCisJCQkJZmFpbF9hbmRfcmVzdGFydF9pbl9t
cygxMDAwLCAmc3RhdHVzLCBvdXRwdXQpOworCQkJfSBlbHNlIHsKKwkJCQkvKiBjb250aW51ZSBh
a2UgY2VydCBwb2xsaW5nKi8KKwkJCQljYWxsYmFja19pbl9tcygxMCwgb3V0cHV0KTsKKwkJCQlp
bmNyZW1lbnRfc3RheV9jb3VudGVyKGhkY3ApOworCQkJfQorCQkJYnJlYWs7CisJCX0gZWxzZSBp
ZiAoaW5wdXQtPmFrZV9jZXJ0X3JlYWQgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5ha2VfY2VydF92
YWxpZGF0aW9uICE9IFBBU1MpIHsKKwkJCS8qCisJCQkgKiAxQS0wOTogY29uc2lkZXIgaW52YWxp
ZCBha2UgY2VydCBhIGZhaWx1cmUKKwkJCSAqIDFBLTEwOiBjb25zaWRlciByZWNlaXZlciBpZCBs
aXN0ZWQgaW4gU1JNIGEgZmFpbHVyZQorCQkJICovCisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21z
KDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfQorCQlpZiAoY29ubi0+aXNfa21f
c3RvcmVkICYmCisJCQkJIWFkanVzdC0+aGRjcDIuZm9yY2Vfbm9fc3RvcmVkX2ttKSB7CisJCQlj
YWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQkJc2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1dCwg
SDJfQTFfU0VORF9TVE9SRURfS00pOworCQl9IGVsc2UgeworCQkJY2FsbGJhY2tfaW5fbXMoMCwg
b3V0cHV0KTsKKwkJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEgyX0ExX1NFTkRfTk9fU1RP
UkVEX0tNKTsKKwkJfQorCQlicmVhazsKKwljYXNlIEgyX0ExX1NFTkRfTk9fU1RPUkVEX0tNOgor
CQlpZiAoaW5wdXQtPm5vX3N0b3JlZF9rbV93cml0ZSAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9y
ZXN0YXJ0X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfQorCQlpZiAo
YWRqdXN0LT5oZGNwMi5pbmNyZWFzZV9oX3ByaW1lX3RpbWVvdXQpCisJCQlzZXRfd2F0Y2hkb2df
aW5fbXMoaGRjcCwgMjAwMCwgb3V0cHV0KTsKKwkJZWxzZQorCQkJc2V0X3dhdGNoZG9nX2luX21z
KGhkY3AsIDEwMDAsIG91dHB1dCk7CisJCWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCXNl
dF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEgyX0ExX1JFQURfSF9QUklNRSk7CisJCWJyZWFrOwor
CWNhc2UgSDJfQTFfUkVBRF9IX1BSSU1FOgorCQlpZiAoaW5wdXQtPmhfcHJpbWVfYXZhaWxhYmxl
ICE9IFBBU1MpIHsKKwkJCWlmIChldmVudF9jdHgtPmV2ZW50ID09CisJCQkJCU1PRF9IRENQX0VW
RU5UX1dBVENIRE9HX1RJTUVPVVQpIHsKKwkJCQkvKiAxQS0xMS0zOiBjb25zaWRlciBoJyB0aW1l
b3V0IGEgZmFpbHVyZSAqLworCQkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywg
b3V0cHV0KTsKKwkJCX0gZWxzZSB7CisJCQkJLyogY29udGludWUgaCcgcG9sbGluZyAqLworCQkJ
CWNhbGxiYWNrX2luX21zKDEwMCwgb3V0cHV0KTsKKwkJCQlpbmNyZW1lbnRfc3RheV9jb3VudGVy
KGhkY3ApOworCQkJfQorCQkJYnJlYWs7CisJCX0gZWxzZSBpZiAoaW5wdXQtPmhfcHJpbWVfcmVh
ZCAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21zKDAsICZzdGF0dXMsIG91dHB1
dCk7CisJCQlicmVhazsKKwkJfQorCQlzZXRfd2F0Y2hkb2dfaW5fbXMoaGRjcCwgMjAwLCBvdXRw
dXQpOworCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQlzZXRfc3RhdGVfaWQoaGRjcCwg
b3V0cHV0LCBIMl9BMV9SRUFEX1BBSVJJTkdfSU5GT19BTkRfVkFMSURBVEVfSF9QUklNRSk7CisJ
CWJyZWFrOworCWNhc2UgSDJfQTFfUkVBRF9QQUlSSU5HX0lORk9fQU5EX1ZBTElEQVRFX0hfUFJJ
TUU6CisJCWlmIChpbnB1dC0+cGFpcmluZ19hdmFpbGFibGUgIT0gUEFTUykgeworCQkJaWYgKGV2
ZW50X2N0eC0+ZXZlbnQgPT0KKwkJCQkJTU9EX0hEQ1BfRVZFTlRfV0FUQ0hET0dfVElNRU9VVCkg
eworCQkJCS8qIDFBLTEyOiBjb25zaWRlciBwYWlyaW5nIGluZm8gdGltZW91dAorCQkJCSAqIGEg
ZmFpbHVyZQorCQkJCSAqLworCQkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywg
b3V0cHV0KTsKKwkJCX0gZWxzZSB7CisJCQkJLyogY29udGludWUgcGFpcmluZyBpbmZvIHBvbGxp
bmcgKi8KKwkJCQljYWxsYmFja19pbl9tcygyMCwgb3V0cHV0KTsKKwkJCQlpbmNyZW1lbnRfc3Rh
eV9jb3VudGVyKGhkY3ApOworCQkJfQorCQkJYnJlYWs7CisJCX0gZWxzZSBpZiAoaW5wdXQtPnBh
aXJpbmdfaW5mb19yZWFkICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+aF9wcmltZV92YWxpZGF0aW9u
ICE9IFBBU1MpIHsKKwkJCS8qIDFBLTExLTE6IGNvbnNpZGVyIGludmFsaWQgaCcgYSBmYWlsdXJl
ICovCisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQli
cmVhazsKKwkJfQorCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQlzZXRfc3RhdGVfaWQo
aGRjcCwgb3V0cHV0LCBIMl9BMl9MT0NBTElUWV9DSEVDSyk7CisJCWJyZWFrOworCWNhc2UgSDJf
QTFfU0VORF9TVE9SRURfS006CisJCWlmIChpbnB1dC0+c3RvcmVkX2ttX3dyaXRlICE9IFBBU1Mp
IHsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJy
ZWFrOworCQl9CisJCXNldF93YXRjaGRvZ19pbl9tcyhoZGNwLCAyMDAsIG91dHB1dCk7CisJCWNh
bGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEgy
X0ExX1ZBTElEQVRFX0hfUFJJTUUpOworCQlicmVhazsKKwljYXNlIEgyX0ExX1ZBTElEQVRFX0hf
UFJJTUU6CisJCWlmIChpbnB1dC0+aF9wcmltZV9hdmFpbGFibGUgIT0gUEFTUykgeworCQkJaWYg
KGV2ZW50X2N0eC0+ZXZlbnQgPT0KKwkJCQkJTU9EX0hEQ1BfRVZFTlRfV0FUQ0hET0dfVElNRU9V
VCkgeworCQkJCS8qIDFBLTExLTI6IGNvbnNpZGVyIGgnIHRpbWVvdXQgYSBmYWlsdXJlICovCisJ
CQkJZmFpbF9hbmRfcmVzdGFydF9pbl9tcygwLCAmc3RhdHVzLCBvdXRwdXQpOworCQkJfSBlbHNl
IHsKKwkJCQkvKiBjb250aW51ZSBoJyBwb2xsaW5nICovCisJCQkJY2FsbGJhY2tfaW5fbXMoMjAs
IG91dHB1dCk7CisJCQkJaW5jcmVtZW50X3N0YXlfY291bnRlcihoZGNwKTsKKwkJCX0KKwkJCWJy
ZWFrOworCQl9IGVsc2UgaWYgKGlucHV0LT5oX3ByaW1lX3JlYWQgIT0gUEFTUykgeworCQkJZmFp
bF9hbmRfcmVzdGFydF9pbl9tcygwLCAmc3RhdHVzLCBvdXRwdXQpOworCQkJYnJlYWs7CisJCX0g
ZWxzZSBpZiAoaW5wdXQtPmhfcHJpbWVfdmFsaWRhdGlvbiAhPSBQQVNTKSB7CisJCQkvKiAxQS0x
MS0xOiBjb25zaWRlciBpbnZhbGlkIGgnIGEgZmFpbHVyZSAqLworCQkJYWRqdXN0LT5oZGNwMi5m
b3JjZV9ub19zdG9yZWRfa20gPSAxOworCQkJZmFpbF9hbmRfcmVzdGFydF9pbl9tcygwLCAmc3Rh
dHVzLCBvdXRwdXQpOworCQkJYnJlYWs7CisJCX0KKwkJY2FsbGJhY2tfaW5fbXMoMCwgb3V0cHV0
KTsKKwkJc2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1dCwgSDJfQTJfTE9DQUxJVFlfQ0hFQ0spOwor
CQlicmVhazsKKwljYXNlIEgyX0EyX0xPQ0FMSVRZX0NIRUNLOgorCQlpZiAoaGRjcC0+c3RhdGUu
c3RheV9jb3VudCA+IDEwIHx8CisJCQkJaW5wdXQtPmxjX2luaXRfcHJlcGFyZSAhPSBQQVNTIHx8
CisJCQkJaW5wdXQtPmxjX2luaXRfd3JpdGUgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5sX3ByaW1l
X2F2YWlsYWJsZV9wb2xsICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+bF9wcmltZV9yZWFkICE9IFBB
U1MpIHsKKwkJCS8qCisJCQkgKiAxQS0wNTogY29uc2lkZXIgZGlzY29ubmVjdGlvbiBhZnRlciBM
QyBpbml0IGEgZmFpbHVyZQorCQkJICogMUEtMTMtMTogY29uc2lkZXIgaW52YWxpZCBsJyBhIGZh
aWx1cmUKKwkJCSAqIDFBLTEzLTI6IGNvbnNpZGVyIGwnIHRpbWVvdXQgYSBmYWlsdXJlCisJCQkg
Ki8KKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJy
ZWFrOworCQl9IGVsc2UgaWYgKGlucHV0LT5sX3ByaW1lX3ZhbGlkYXRpb24gIT0gUEFTUykgewor
CQkJY2FsbGJhY2tfaW5fbXMoMCwgb3V0cHV0KTsKKwkJCWluY3JlbWVudF9zdGF5X2NvdW50ZXIo
aGRjcCk7CisJCQlicmVhazsKKwkJfQorCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQlz
ZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBIMl9BM19FWENIQU5HRV9LU19BTkRfVEVTVF9GT1Jf
UkVQRUFURVIpOworCQlicmVhazsKKwljYXNlIEgyX0EzX0VYQ0hBTkdFX0tTX0FORF9URVNUX0ZP
Ul9SRVBFQVRFUjoKKwkJaWYgKGlucHV0LT5la3NfcHJlcGFyZSAhPSBQQVNTIHx8CisJCQkJaW5w
dXQtPmVrc193cml0ZSAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21zKDAsICZz
dGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfQorCQlpZiAoY29ubi0+aXNfcmVwZWF0ZXIp
IHsKKwkJCXNldF93YXRjaGRvZ19pbl9tcyhoZGNwLCAzMDAwLCBvdXRwdXQpOworCQkJY2FsbGJh
Y2tfaW5fbXMoMCwgb3V0cHV0KTsKKwkJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEgyX0E2
X1dBSVRfRk9SX1JYX0lEX0xJU1QpOworCQl9IGVsc2UgeworCQkJLyogc29tZSBDVFMgZXF1aXBt
ZW50IHJlcXVpcmVzIGEgZGVsYXkgR1JFQVRFUiB0aGFuCisJCQkgKiAyMDAgbXMsIHNvIGRlbGF5
IDIxMCBtcyBpbnN0ZWFkIG9mIDIwMCBtcworCQkJICovCisJCQljYWxsYmFja19pbl9tcygyMTAs
IG91dHB1dCk7CisJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBIMl9FTkFCTEVfRU5DUllQ
VElPTik7CisJCX0KKwkJYnJlYWs7CisJY2FzZSBIMl9FTkFCTEVfRU5DUllQVElPTjoKKwkJaWYg
KGlucHV0LT5yeHN0YXR1c19yZWFkICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+cmVhdXRoX3JlcXVl
c3RfY2hlY2sgIT0gUEFTUykgeworCQkJLyoKKwkJCSAqIDFBLTA3OiByZXN0YXJ0IGhkY3Agb24g
UkVBVVRIX1JFUQorCQkJICogMUItMDg6IHJlc3RhcnQgaGRjcCBvbiBSRUFVVEhfUkVRCisJCQkg
Ki8KKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJy
ZWFrOworCQl9IGVsc2UgaWYgKGV2ZW50X2N0eC0+cnhfaWRfbGlzdF9yZWFkeSAmJiBjb25uLT5p
c19yZXBlYXRlcikgeworCQkJY2FsbGJhY2tfaW5fbXMoMCwgb3V0cHV0KTsKKwkJCXNldF9zdGF0
ZV9pZChoZGNwLCBvdXRwdXQsIEgyX0E3OF9WRVJJRllfUlhfSURfTElTVF9BTkRfU0VORF9BQ0sp
OworCQkJYnJlYWs7CisJCX0gZWxzZSBpZiAoaW5wdXQtPmVuYWJsZV9lbmNyeXB0aW9uICE9IFBB
U1MpIHsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJ
CWJyZWFrOworCQl9CisJCWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCXNldF9zdGF0ZV9p
ZChoZGNwLCBvdXRwdXQsIEgyX0E1X0FVVEhFTlRJQ0FURUQpOworCQlIRENQX0ZVTExfRERDX1RS
QUNFKGhkY3ApOworCQlicmVhazsKKwljYXNlIEgyX0E1X0FVVEhFTlRJQ0FURUQ6CisJCWlmIChp
bnB1dC0+cnhzdGF0dXNfcmVhZCAhPSBQQVNTIHx8CisJCQkJaW5wdXQtPnJlYXV0aF9yZXF1ZXN0
X2NoZWNrICE9IFBBU1MpIHsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywg
b3V0cHV0KTsKKwkJCWJyZWFrOworCQl9IGVsc2UgaWYgKGV2ZW50X2N0eC0+cnhfaWRfbGlzdF9y
ZWFkeSAmJiBjb25uLT5pc19yZXBlYXRlcikgeworCQkJY2FsbGJhY2tfaW5fbXMoMCwgb3V0cHV0
KTsKKwkJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEgyX0E3OF9WRVJJRllfUlhfSURfTElT
VF9BTkRfU0VORF9BQ0spOworCQkJYnJlYWs7CisJCX0KKwkJY2FsbGJhY2tfaW5fbXMoNTAwLCBv
dXRwdXQpOworCQlpbmNyZW1lbnRfc3RheV9jb3VudGVyKGhkY3ApOworCQlicmVhazsKKwljYXNl
IEgyX0E2X1dBSVRfRk9SX1JYX0lEX0xJU1Q6CisJCWlmIChpbnB1dC0+cnhzdGF0dXNfcmVhZCAh
PSBQQVNTIHx8CisJCQkJaW5wdXQtPnJlYXV0aF9yZXF1ZXN0X2NoZWNrICE9IFBBU1MpIHsKKwkJ
CWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJyZWFrOwor
CQl9IGVsc2UgaWYgKCFldmVudF9jdHgtPnJ4X2lkX2xpc3RfcmVhZHkpIHsKKwkJCWlmIChldmVu
dF9jdHgtPmV2ZW50ID09IE1PRF9IRENQX0VWRU5UX1dBVENIRE9HX1RJTUVPVVQpIHsKKwkJCQkv
KiAxQi0wMjogY29uc2lkZXIgcnggaWQgbGlzdCB0aW1lb3V0IGEgZmFpbHVyZSAqLworCQkJCS8q
IHNvbWUgQ1RTIGVxdWlwbWVudCdzIGFjdHVhbCB0aW1lb3V0CisJCQkJICogbWVhc3VyZW1lbnQg
aXMgc2xpZ2h0bHkgZ3JlYXRlciB0aGFuIDMwMDAgbXMuCisJCQkJICogRGVsYXkgMTAwIG1zIHRv
IGVuc3VyZSBpdCBpcyBmdWxseSB0aW1lb3V0CisJCQkJICogYmVmb3JlIHJlLWF1dGhlbnRpY2F0
aW9uLgorCQkJCSAqLworCQkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMTAwLCAmc3RhdHVzLCBv
dXRwdXQpOworCQkJfSBlbHNlIHsKKwkJCQljYWxsYmFja19pbl9tcygzMDAsIG91dHB1dCk7CisJ
CQkJaW5jcmVtZW50X3N0YXlfY291bnRlcihoZGNwKTsKKwkJCX0KKwkJCWJyZWFrOworCQl9CisJ
CWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQs
IEgyX0E3OF9WRVJJRllfUlhfSURfTElTVF9BTkRfU0VORF9BQ0spOworCQlicmVhazsKKwljYXNl
IEgyX0E3OF9WRVJJRllfUlhfSURfTElTVF9BTkRfU0VORF9BQ0s6CisJCWlmIChpbnB1dC0+cnhz
dGF0dXNfcmVhZCAhPSBQQVNTIHx8CisJCQkJaW5wdXQtPnJlYXV0aF9yZXF1ZXN0X2NoZWNrICE9
IFBBU1MgfHwKKwkJCQlpbnB1dC0+cnhfaWRfbGlzdF9yZWFkICE9IFBBU1MgfHwKKwkJCQlpbnB1
dC0+ZGV2aWNlX2NvdW50X2NoZWNrICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+cnhfaWRfbGlzdF92
YWxpZGF0aW9uICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+cmVwZWF0ZXJfYXV0aF9hY2tfd3JpdGUg
IT0gUEFTUykgeworCQkJLyogMUItMDM6IGNvbnNpZGVyIGludmFsaWQgdicgYSBmYWlsdXJlCisJ
CQkgKiAxQi0wNDogY29uc2lkZXIgTUFYX0RFVlNfRVhDRUVERUQgYSBmYWlsdXJlCisJCQkgKiAx
Qi0wNTogY29uc2lkZXIgTUFYX0NBU0NBREVfRVhDRUVERUQgYSBmYWlsdXJlCisJCQkgKiAxQi0w
NjogY29uc2lkZXIgaW52YWxpZCBzZXFfbnVtX1YgYSBmYWlsdXJlCisJCQkgKiAxQi0wOTogY29u
c2lkZXIgc2VxX251bV9WIHJvbGxvdmVyIGEgZmFpbHVyZQorCQkJICovCisJCQlmYWlsX2FuZF9y
ZXN0YXJ0X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfQorCQljYWxs
YmFja19pbl9tcygwLCBvdXRwdXQpOworCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBIMl9B
OV9TRU5EX1NUUkVBTV9NQU5BR0VNRU5UKTsKKwkJYnJlYWs7CisJY2FzZSBIMl9BOV9TRU5EX1NU
UkVBTV9NQU5BR0VNRU5UOgorCQlpZiAoaW5wdXQtPnJ4c3RhdHVzX3JlYWQgIT0gUEFTUyB8fAor
CQkJCWlucHV0LT5yZWF1dGhfcmVxdWVzdF9jaGVjayAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9y
ZXN0YXJ0X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfSBlbHNlIGlm
IChldmVudF9jdHgtPnJ4X2lkX2xpc3RfcmVhZHkgJiYgY29ubi0+aXNfcmVwZWF0ZXIpIHsKKwkJ
CWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0
LCBIMl9BNzhfVkVSSUZZX1JYX0lEX0xJU1RfQU5EX1NFTkRfQUNLKTsKKwkJCWJyZWFrOworCQl9
IGVsc2UgaWYgKGlucHV0LT5wcmVwYXJlX3N0cmVhbV9tYW5hZ2UgIT0gUEFTUyB8fAorCQkJCWlu
cHV0LT5zdHJlYW1fbWFuYWdlX3dyaXRlICE9IFBBU1MpIHsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRf
aW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJyZWFrOworCQl9CisJCXNldF93YXRjaGRv
Z19pbl9tcyhoZGNwLCAxMDAsIG91dHB1dCk7CisJCWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7
CisJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEgyX0E5X1ZBTElEQVRFX1NUUkVBTV9SRUFE
WSk7CisJCWJyZWFrOworCWNhc2UgSDJfQTlfVkFMSURBVEVfU1RSRUFNX1JFQURZOgorCQlpZiAo
aW5wdXQtPnJ4c3RhdHVzX3JlYWQgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5yZWF1dGhfcmVxdWVz
dF9jaGVjayAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21zKDAsICZzdGF0dXMs
IG91dHB1dCk7CisJCQlicmVhazsKKwkJfSBlbHNlIGlmIChldmVudF9jdHgtPnJ4X2lkX2xpc3Rf
cmVhZHkgJiYgY29ubi0+aXNfcmVwZWF0ZXIpIHsKKwkJCWNhbGxiYWNrX2luX21zKDAsIG91dHB1
dCk7CisJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBIMl9BNzhfVkVSSUZZX1JYX0lEX0xJ
U1RfQU5EX1NFTkRfQUNLKTsKKwkJCWJyZWFrOworCQl9IGVsc2UgaWYgKGlucHV0LT5zdHJlYW1f
cmVhZHlfYXZhaWxhYmxlICE9IFBBU1MpIHsKKwkJCWlmIChldmVudF9jdHgtPmV2ZW50ID09IE1P
RF9IRENQX0VWRU5UX1dBVENIRE9HX1RJTUVPVVQpIHsKKwkJCQkvKiAxQi0xMC0yOiByZXN0YXJ0
IGNvbnRlbnQgc3RyZWFtIG1hbmFnZW1lbnQgb24KKwkJCQkgKiBzdHJlYW0gcmVhZHkgdGltZW91
dAorCQkJCSAqLworCQkJCWhkY3AtPmF1dGguY291bnQuc3RyZWFtX21hbmFnZW1lbnRfcmV0cnlf
Y291bnQrKzsKKwkJCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQkJCXNldF9zdGF0ZV9p
ZChoZGNwLCBvdXRwdXQsIEgyX0E5X1NFTkRfU1RSRUFNX01BTkFHRU1FTlQpOworCQkJfSBlbHNl
IHsKKwkJCQljYWxsYmFja19pbl9tcygxMCwgb3V0cHV0KTsKKwkJCQlpbmNyZW1lbnRfc3RheV9j
b3VudGVyKGhkY3ApOworCQkJfQorCQkJYnJlYWs7CisJCX0gZWxzZSBpZiAoaW5wdXQtPnN0cmVh
bV9yZWFkeV9yZWFkICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+c3RyZWFtX3JlYWR5X3ZhbGlkYXRp
b24gIT0gUEFTUykgeworCQkJLyoKKwkJCSAqIDFCLTEwLTE6IHJlc3RhcnQgY29udGVudCBzdHJl
YW0gbWFuYWdlbWVudAorCQkJICogb24gaW52YWxpZCBNJworCQkJICovCisJCQlpZiAoaGRjcC0+
YXV0aC5jb3VudC5zdHJlYW1fbWFuYWdlbWVudF9yZXRyeV9jb3VudCA+IDEwKSB7CisJCQkJZmFp
bF9hbmRfcmVzdGFydF9pbl9tcygwLCAmc3RhdHVzLCBvdXRwdXQpOworCQkJfSBlbHNlIHsKKwkJ
CQloZGNwLT5hdXRoLmNvdW50LnN0cmVhbV9tYW5hZ2VtZW50X3JldHJ5X2NvdW50Kys7CisJCQkJ
Y2FsbGJhY2tfaW5fbXMoMCwgb3V0cHV0KTsKKwkJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0
LCBIMl9BOV9TRU5EX1NUUkVBTV9NQU5BR0VNRU5UKTsKKwkJCX0KKwkJCWJyZWFrOworCQl9CisJ
CWNhbGxiYWNrX2luX21zKDIwMCwgb3V0cHV0KTsKKwkJc2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1
dCwgSDJfRU5BQkxFX0VOQ1JZUFRJT04pOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlzdGF0dXMg
PSBNT0RfSERDUF9TVEFUVVNfSU5WQUxJRF9TVEFURTsKKwkJZmFpbF9hbmRfcmVzdGFydF9pbl9t
cygwLCAmc3RhdHVzLCBvdXRwdXQpOworCQlicmVhazsKKwl9CisKKwlyZXR1cm4gc3RhdHVzOwor
fQorCitlbnVtIG1vZF9oZGNwX3N0YXR1cyBtb2RfaGRjcF9oZGNwMl9kcF90cmFuc2l0aW9uKHN0
cnVjdCBtb2RfaGRjcCAqaGRjcCwKKwkJc3RydWN0IG1vZF9oZGNwX2V2ZW50X2NvbnRleHQgKmV2
ZW50X2N0eCwKKwkJc3RydWN0IG1vZF9oZGNwX3RyYW5zaXRpb25faW5wdXRfaGRjcDIgKmlucHV0
LAorCQlzdHJ1Y3QgbW9kX2hkY3Bfb3V0cHV0ICpvdXRwdXQpCit7CisJZW51bSBtb2RfaGRjcF9z
dGF0dXMgc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVTX1NVQ0NFU1M7CisJc3RydWN0IG1vZF9oZGNw
X2Nvbm5lY3Rpb24gKmNvbm4gPSAmaGRjcC0+Y29ubmVjdGlvbjsKKwlzdHJ1Y3QgbW9kX2hkY3Bf
bGlua19hZGp1c3RtZW50ICphZGp1c3QgPSAmaGRjcC0+Y29ubmVjdGlvbi5saW5rLmFkanVzdDsK
KworCXN3aXRjaCAoY3VycmVudF9zdGF0ZShoZGNwKSkgeworCWNhc2UgRDJfQTBfREVURVJNSU5F
X1JYX0hEQ1BfQ0FQQUJMRToKKwkJaWYgKGlucHV0LT5yeF9jYXBzX3JlYWRfZHAgIT0gUEFTUyB8
fAorCQkJCWlucHV0LT5oZGNwMl9jYXBhYmxlX2NoZWNrICE9IFBBU1MpIHsKKwkJCWFkanVzdC0+
aGRjcDIuZGlzYWJsZSA9IDE7CisJCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQkJc2V0
X3N0YXRlX2lkKGhkY3AsIG91dHB1dCwgSERDUF9JTklUSUFMSVpFRCk7CisJCX0gZWxzZSB7CisJ
CQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQkJc2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1
dCwgRDJfQTFfU0VORF9BS0VfSU5JVCk7CisJCX0KKwkJYnJlYWs7CisJY2FzZSBEMl9BMV9TRU5E
X0FLRV9JTklUOgorCQlpZiAoaW5wdXQtPmFkZF90b3BvbG9neSAhPSBQQVNTIHx8CisJCQkJaW5w
dXQtPmNyZWF0ZV9zZXNzaW9uICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+YWtlX2luaXRfcHJlcGFy
ZSAhPSBQQVNTKSB7CisJCQkvKiBvdXQgb2Ygc3luYyB3aXRoIHBzcCBzdGF0ZSAqLworCQkJYWRq
dXN0LT5oZGNwMi5kaXNhYmxlID0gMTsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0
YXR1cywgb3V0cHV0KTsKKwkJCWJyZWFrOworCQl9IGVsc2UgaWYgKGlucHV0LT5ha2VfaW5pdF93
cml0ZSAhPSBQQVNTKSB7CisJCQkvKiBwb3NzaWJseSBkaXNwbGF5IG5vdCByZWFkeSAqLworCQkJ
ZmFpbF9hbmRfcmVzdGFydF9pbl9tcygwLCAmc3RhdHVzLCBvdXRwdXQpOworCQkJYnJlYWs7CisJ
CX0KKwkJY2FsbGJhY2tfaW5fbXMoMTAwLCBvdXRwdXQpOworCQlzZXRfc3RhdGVfaWQoaGRjcCwg
b3V0cHV0LCBEMl9BMV9WQUxJREFURV9BS0VfQ0VSVCk7CisJCWJyZWFrOworCWNhc2UgRDJfQTFf
VkFMSURBVEVfQUtFX0NFUlQ6CisJCWlmIChpbnB1dC0+YWtlX2NlcnRfcmVhZCAhPSBQQVNTIHx8
CisJCQkJaW5wdXQtPmFrZV9jZXJ0X3ZhbGlkYXRpb24gIT0gUEFTUykgeworCQkJLyoKKwkJCSAq
IDFBLTA4OiBjb25zaWRlciBpbnZhbGlkIGFrZSBjZXJ0IGEgZmFpbHVyZQorCQkJICogMUEtMDk6
IGNvbnNpZGVyIHJlY2VpdmVyIGlkIGxpc3RlZCBpbiBTUk0gYSBmYWlsdXJlCisJCQkgKi8KKwkJ
CWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJyZWFrOwor
CQl9CisJCWlmIChjb25uLT5pc19rbV9zdG9yZWQgJiYKKwkJCQkhYWRqdXN0LT5oZGNwMi5mb3Jj
ZV9ub19zdG9yZWRfa20pIHsKKwkJCWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCQlzZXRf
c3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBEMl9BMV9TRU5EX1NUT1JFRF9LTSk7CisJCX0gZWxzZSB7
CisJCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQkJc2V0X3N0YXRlX2lkKGhkY3AsIG91
dHB1dCwgRDJfQTFfU0VORF9OT19TVE9SRURfS00pOworCQl9CisJCWJyZWFrOworCWNhc2UgRDJf
QTFfU0VORF9OT19TVE9SRURfS006CisJCWlmIChpbnB1dC0+bm9fc3RvcmVkX2ttX3dyaXRlICE9
IFBBU1MpIHsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsK
KwkJCWJyZWFrOworCQl9CisJCWlmIChhZGp1c3QtPmhkY3AyLmluY3JlYXNlX2hfcHJpbWVfdGlt
ZW91dCkKKwkJCXNldF93YXRjaGRvZ19pbl9tcyhoZGNwLCAyMDAwLCBvdXRwdXQpOworCQllbHNl
CisJCQlzZXRfd2F0Y2hkb2dfaW5fbXMoaGRjcCwgMTAwMCwgb3V0cHV0KTsKKwkJc2V0X3N0YXRl
X2lkKGhkY3AsIG91dHB1dCwgRDJfQTFfUkVBRF9IX1BSSU1FKTsKKwkJYnJlYWs7CisJY2FzZSBE
Ml9BMV9SRUFEX0hfUFJJTUU6CisJCWlmIChpbnB1dC0+aF9wcmltZV9hdmFpbGFibGUgIT0gUEFT
UykgeworCQkJaWYgKGV2ZW50X2N0eC0+ZXZlbnQgPT0KKwkJCQkJTU9EX0hEQ1BfRVZFTlRfV0FU
Q0hET0dfVElNRU9VVCkKKwkJCQkvKiAxQS0xMC0zOiBjb25zaWRlciBoJyB0aW1lb3V0IGEgZmFp
bHVyZSAqLworCQkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsK
KwkJCWVsc2UKKwkJCQlpbmNyZW1lbnRfc3RheV9jb3VudGVyKGhkY3ApOworCQkJYnJlYWs7CisJ
CX0gZWxzZSBpZiAoaW5wdXQtPmhfcHJpbWVfcmVhZCAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9y
ZXN0YXJ0X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfQorCQlzZXRf
d2F0Y2hkb2dfaW5fbXMoaGRjcCwgMjAwLCBvdXRwdXQpOworCQlzZXRfc3RhdGVfaWQoaGRjcCwg
b3V0cHV0LCBEMl9BMV9SRUFEX1BBSVJJTkdfSU5GT19BTkRfVkFMSURBVEVfSF9QUklNRSk7CisJ
CWJyZWFrOworCWNhc2UgRDJfQTFfUkVBRF9QQUlSSU5HX0lORk9fQU5EX1ZBTElEQVRFX0hfUFJJ
TUU6CisJCWlmIChpbnB1dC0+cGFpcmluZ19hdmFpbGFibGUgIT0gUEFTUykgeworCQkJaWYgKGV2
ZW50X2N0eC0+ZXZlbnQgPT0KKwkJCQkJTU9EX0hEQ1BfRVZFTlRfV0FUQ0hET0dfVElNRU9VVCkK
KwkJCQkvKgorCQkJCSAqIDFBLTExOiBjb25zaWRlciBwYWlyaW5nIGluZm8gdGltZW91dAorCQkJ
CSAqIGEgZmFpbHVyZQorCQkJCSAqLworCQkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0
YXR1cywgb3V0cHV0KTsKKwkJCWVsc2UKKwkJCQlpbmNyZW1lbnRfc3RheV9jb3VudGVyKGhkY3Ap
OworCQkJYnJlYWs7CisJCX0gZWxzZSBpZiAoaW5wdXQtPnBhaXJpbmdfaW5mb19yZWFkICE9IFBB
U1MgfHwKKwkJCQlpbnB1dC0+aF9wcmltZV92YWxpZGF0aW9uICE9IFBBU1MpIHsKKwkJCS8qIDFB
LTEwLTE6IGNvbnNpZGVyIGludmFsaWQgaCcgYSBmYWlsdXJlICovCisJCQlmYWlsX2FuZF9yZXN0
YXJ0X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfQorCQljYWxsYmFj
a19pbl9tcygwLCBvdXRwdXQpOworCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBEMl9BMl9M
T0NBTElUWV9DSEVDSyk7CisJCWJyZWFrOworCWNhc2UgRDJfQTFfU0VORF9TVE9SRURfS006CisJ
CWlmIChpbnB1dC0+c3RvcmVkX2ttX3dyaXRlICE9IFBBU1MpIHsKKwkJCWZhaWxfYW5kX3Jlc3Rh
cnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJyZWFrOworCQl9CisJCXNldF93YXRj
aGRvZ19pbl9tcyhoZGNwLCAyMDAsIG91dHB1dCk7CisJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRw
dXQsIEQyX0ExX1ZBTElEQVRFX0hfUFJJTUUpOworCQlicmVhazsKKwljYXNlIEQyX0ExX1ZBTElE
QVRFX0hfUFJJTUU6CisJCWlmIChpbnB1dC0+aF9wcmltZV9hdmFpbGFibGUgIT0gUEFTUykgewor
CQkJaWYgKGV2ZW50X2N0eC0+ZXZlbnQgPT0KKwkJCQkJTU9EX0hEQ1BfRVZFTlRfV0FUQ0hET0df
VElNRU9VVCkKKwkJCQkvKiAxQS0xMC0yOiBjb25zaWRlciBoJyB0aW1lb3V0IGEgZmFpbHVyZSAq
LworCQkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWVs
c2UKKwkJCQlpbmNyZW1lbnRfc3RheV9jb3VudGVyKGhkY3ApOworCQkJYnJlYWs7CisJCX0gZWxz
ZSBpZiAoaW5wdXQtPmhfcHJpbWVfcmVhZCAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9yZXN0YXJ0
X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfSBlbHNlIGlmIChpbnB1
dC0+aF9wcmltZV92YWxpZGF0aW9uICE9IFBBU1MpIHsKKwkJCS8qIDFBLTEwLTE6IGNvbnNpZGVy
IGludmFsaWQgaCcgYSBmYWlsdXJlICovCisJCQlhZGp1c3QtPmhkY3AyLmZvcmNlX25vX3N0b3Jl
ZF9rbSA9IDE7CisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7
CisJCQlicmVhazsKKwkJfQorCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQlzZXRfc3Rh
dGVfaWQoaGRjcCwgb3V0cHV0LCBEMl9BMl9MT0NBTElUWV9DSEVDSyk7CisJCWJyZWFrOworCWNh
c2UgRDJfQTJfTE9DQUxJVFlfQ0hFQ0s6CisJCWlmIChoZGNwLT5zdGF0ZS5zdGF5X2NvdW50ID4g
MTAgfHwKKwkJCQlpbnB1dC0+bGNfaW5pdF9wcmVwYXJlICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+
bGNfaW5pdF93cml0ZSAhPSBQQVNTIHx8CisJCQkJaW5wdXQtPmxfcHJpbWVfcmVhZCAhPSBQQVNT
KSB7CisJCQkvKiAxQS0xMjogY29uc2lkZXIgaW52YWxpZCBsJyBhIGZhaWx1cmUgKi8KKwkJCWZh
aWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJyZWFrOworCQl9
IGVsc2UgaWYgKGlucHV0LT5sX3ByaW1lX3ZhbGlkYXRpb24gIT0gUEFTUykgeworCQkJY2FsbGJh
Y2tfaW5fbXMoMCwgb3V0cHV0KTsKKwkJCWluY3JlbWVudF9zdGF5X2NvdW50ZXIoaGRjcCk7CisJ
CQlicmVhazsKKwkJfQorCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQlzZXRfc3RhdGVf
aWQoaGRjcCwgb3V0cHV0LCBEMl9BMzRfRVhDSEFOR0VfS1NfQU5EX1RFU1RfRk9SX1JFUEVBVEVS
KTsKKwkJYnJlYWs7CisJY2FzZSBEMl9BMzRfRVhDSEFOR0VfS1NfQU5EX1RFU1RfRk9SX1JFUEVB
VEVSOgorCQlpZiAoaW5wdXQtPmVrc19wcmVwYXJlICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+ZWtz
X3dyaXRlICE9IFBBU1MpIHsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywg
b3V0cHV0KTsKKwkJCWJyZWFrOworCQl9CisJCWlmIChjb25uLT5pc19yZXBlYXRlcikgeworCQkJ
c2V0X3dhdGNoZG9nX2luX21zKGhkY3AsIDMwMDAsIG91dHB1dCk7CisJCQlzZXRfc3RhdGVfaWQo
aGRjcCwgb3V0cHV0LCBEMl9BNl9XQUlUX0ZPUl9SWF9JRF9MSVNUKTsKKwkJfSBlbHNlIHsKKwkJ
CWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0
LCBEMl9TRU5EX0NPTlRFTlRfU1RSRUFNX1RZUEUpOworCQl9CisJCWJyZWFrOworCWNhc2UgRDJf
U0VORF9DT05URU5UX1NUUkVBTV9UWVBFOgorCQlpZiAoaW5wdXQtPnJ4c3RhdHVzX3JlYWQgIT0g
UEFTUyB8fAorCQkJCWlucHV0LT5yZWF1dGhfcmVxdWVzdF9jaGVjayAhPSBQQVNTIHx8CisJCQkJ
aW5wdXQtPmxpbmtfaW50ZWdyaXR5X2NoZWNrX2RwICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+Y29u
dGVudF9zdHJlYW1fdHlwZV93cml0ZSAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9yZXN0YXJ0X2lu
X21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfQorCQljYWxsYmFja19pbl9t
cygyMTAsIG91dHB1dCk7CisJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEQyX0VOQUJMRV9F
TkNSWVBUSU9OKTsKKwkJYnJlYWs7CisJY2FzZSBEMl9FTkFCTEVfRU5DUllQVElPTjoKKwkJaWYg
KGlucHV0LT5yeHN0YXR1c19yZWFkICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+cmVhdXRoX3JlcXVl
c3RfY2hlY2sgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5saW5rX2ludGVncml0eV9jaGVja19kcCAh
PSBQQVNTKSB7CisJCQkvKgorCQkJICogMUEtMDc6IHJlc3RhcnQgaGRjcCBvbiBSRUFVVEhfUkVR
CisJCQkgKiAxQi0wODogcmVzdGFydCBoZGNwIG9uIFJFQVVUSF9SRVEKKwkJCSAqLworCQkJZmFp
bF9hbmRfcmVzdGFydF9pbl9tcygwLCAmc3RhdHVzLCBvdXRwdXQpOworCQkJYnJlYWs7CisJCX0g
ZWxzZSBpZiAoZXZlbnRfY3R4LT5yeF9pZF9saXN0X3JlYWR5ICYmIGNvbm4tPmlzX3JlcGVhdGVy
KSB7CisJCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQkJc2V0X3N0YXRlX2lkKGhkY3As
IG91dHB1dCwgRDJfQTc4X1ZFUklGWV9SWF9JRF9MSVNUX0FORF9TRU5EX0FDSyk7CisJCQlicmVh
azsKKwkJfSBlbHNlIGlmIChpbnB1dC0+ZW5hYmxlX2VuY3J5cHRpb24gIT0gUEFTUyB8fAorCQkJ
CShpc19kcF9tc3RfaGRjcChoZGNwKSAmJiBpbnB1dC0+c3RyZWFtX2VuY3J5cHRpb25fZHAgIT0g
UEFTUykpIHsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsK
KwkJCWJyZWFrOworCQl9CisJCXNldF9zdGF0ZV9pZChoZGNwLCBvdXRwdXQsIEQyX0E1X0FVVEhF
TlRJQ0FURUQpOworCQlIRENQX0ZVTExfRERDX1RSQUNFKGhkY3ApOworCQlicmVhazsKKwljYXNl
IEQyX0E1X0FVVEhFTlRJQ0FURUQ6CisJCWlmIChpbnB1dC0+cnhzdGF0dXNfcmVhZCAhPSBQQVNT
IHx8CisJCQkJaW5wdXQtPnJlYXV0aF9yZXF1ZXN0X2NoZWNrICE9IFBBU1MpIHsKKwkJCWZhaWxf
YW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJCWJyZWFrOworCQl9IGVs
c2UgaWYgKGlucHV0LT5saW5rX2ludGVncml0eV9jaGVja19kcCAhPSBQQVNTKSB7CisJCQlpZiAo
aGRjcC0+Y29ubmVjdGlvbi5oZGNwMl9yZXRyeV9jb3VudCA+PSAxKQorCQkJCWFkanVzdC0+aGRj
cDIuZGlzYWJsZV90eXBlMSA9IDE7CisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21zKDAsICZzdGF0
dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfSBlbHNlIGlmIChldmVudF9jdHgtPnJ4X2lkX2xp
c3RfcmVhZHkgJiYgY29ubi0+aXNfcmVwZWF0ZXIpIHsKKwkJCWNhbGxiYWNrX2luX21zKDAsIG91
dHB1dCk7CisJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBEMl9BNzhfVkVSSUZZX1JYX0lE
X0xJU1RfQU5EX1NFTkRfQUNLKTsKKwkJCWJyZWFrOworCQl9CisJCWluY3JlbWVudF9zdGF5X2Nv
dW50ZXIoaGRjcCk7CisJCWJyZWFrOworCWNhc2UgRDJfQTZfV0FJVF9GT1JfUlhfSURfTElTVDoK
KwkJaWYgKGlucHV0LT5yeHN0YXR1c19yZWFkICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+cmVhdXRo
X3JlcXVlc3RfY2hlY2sgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5saW5rX2ludGVncml0eV9jaGVj
a19kcCAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9yZXN0YXJ0X2luX21zKDAsICZzdGF0dXMsIG91
dHB1dCk7CisJCQlicmVhazsKKwkJfSBlbHNlIGlmICghZXZlbnRfY3R4LT5yeF9pZF9saXN0X3Jl
YWR5KSB7CisJCQlpZiAoZXZlbnRfY3R4LT5ldmVudCA9PSBNT0RfSERDUF9FVkVOVF9XQVRDSERP
R19USU1FT1VUKQorCQkJCS8qIDFCLTAyOiBjb25zaWRlciByeCBpZCBsaXN0IHRpbWVvdXQgYSBm
YWlsdXJlICovCisJCQkJZmFpbF9hbmRfcmVzdGFydF9pbl9tcygwLCAmc3RhdHVzLCBvdXRwdXQp
OworCQkJZWxzZQorCQkJCWluY3JlbWVudF9zdGF5X2NvdW50ZXIoaGRjcCk7CisJCQlicmVhazsK
KwkJfQorCQljYWxsYmFja19pbl9tcygwLCBvdXRwdXQpOworCQlzZXRfc3RhdGVfaWQoaGRjcCwg
b3V0cHV0LCBEMl9BNzhfVkVSSUZZX1JYX0lEX0xJU1RfQU5EX1NFTkRfQUNLKTsKKwkJYnJlYWs7
CisJY2FzZSBEMl9BNzhfVkVSSUZZX1JYX0lEX0xJU1RfQU5EX1NFTkRfQUNLOgorCQlpZiAoaW5w
dXQtPnJ4c3RhdHVzX3JlYWQgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5yZWF1dGhfcmVxdWVzdF9j
aGVjayAhPSBQQVNTIHx8CisJCQkJaW5wdXQtPmxpbmtfaW50ZWdyaXR5X2NoZWNrX2RwICE9IFBB
U1MgfHwKKwkJCQlpbnB1dC0+cnhfaWRfbGlzdF9yZWFkICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+
ZGV2aWNlX2NvdW50X2NoZWNrICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+cnhfaWRfbGlzdF92YWxp
ZGF0aW9uICE9IFBBU1MgfHwKKwkJCQlpbnB1dC0+cmVwZWF0ZXJfYXV0aF9hY2tfd3JpdGUgIT0g
UEFTUykgeworCQkJLyoKKwkJCSAqIDFCLTAzOiBjb25zaWRlciBpbnZhbGlkIHYnIGEgZmFpbHVy
ZQorCQkJICogMUItMDQ6IGNvbnNpZGVyIE1BWF9ERVZTX0VYQ0VFREVEIGEgZmFpbHVyZQorCQkJ
ICogMUItMDU6IGNvbnNpZGVyIE1BWF9DQVNDQURFX0VYQ0VFREVEIGEgZmFpbHVyZQorCQkJICog
MUItMDY6IGNvbnNpZGVyIGludmFsaWQgc2VxX251bV9WIGEgZmFpbHVyZQorCQkJICogMUItMDk6
IGNvbnNpZGVyIHNlcV9udW1fViByb2xsb3ZlciBhIGZhaWx1cmUKKwkJCSAqLworCQkJZmFpbF9h
bmRfcmVzdGFydF9pbl9tcygwLCAmc3RhdHVzLCBvdXRwdXQpOworCQkJYnJlYWs7CisJCX0KKwkJ
Y2FsbGJhY2tfaW5fbXMoMCwgb3V0cHV0KTsKKwkJc2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1dCwg
RDJfQTlfU0VORF9TVFJFQU1fTUFOQUdFTUVOVCk7CisJCWJyZWFrOworCWNhc2UgRDJfQTlfU0VO
RF9TVFJFQU1fTUFOQUdFTUVOVDoKKwkJaWYgKGlucHV0LT5yeHN0YXR1c19yZWFkICE9IFBBU1Mg
fHwKKwkJCQlpbnB1dC0+cmVhdXRoX3JlcXVlc3RfY2hlY2sgIT0gUEFTUyB8fAorCQkJCWlucHV0
LT5saW5rX2ludGVncml0eV9jaGVja19kcCAhPSBQQVNTKSB7CisJCQlmYWlsX2FuZF9yZXN0YXJ0
X2luX21zKDAsICZzdGF0dXMsIG91dHB1dCk7CisJCQlicmVhazsKKwkJfSBlbHNlIGlmIChldmVu
dF9jdHgtPnJ4X2lkX2xpc3RfcmVhZHkpIHsKKwkJCWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7
CisJCQlzZXRfc3RhdGVfaWQoaGRjcCwgb3V0cHV0LCBEMl9BNzhfVkVSSUZZX1JYX0lEX0xJU1Rf
QU5EX1NFTkRfQUNLKTsKKwkJCWJyZWFrOworCQl9IGVsc2UgaWYgKGlucHV0LT5wcmVwYXJlX3N0
cmVhbV9tYW5hZ2UgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5zdHJlYW1fbWFuYWdlX3dyaXRlICE9
IFBBU1MpIHsKKwkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsK
KwkJCWJyZWFrOworCQl9CisJCWNhbGxiYWNrX2luX21zKDEwMCwgb3V0cHV0KTsKKwkJc2V0X3N0
YXRlX2lkKGhkY3AsIG91dHB1dCwgRDJfQTlfVkFMSURBVEVfU1RSRUFNX1JFQURZKTsKKwkJYnJl
YWs7CisJY2FzZSBEMl9BOV9WQUxJREFURV9TVFJFQU1fUkVBRFk6CisJCWlmIChpbnB1dC0+cnhz
dGF0dXNfcmVhZCAhPSBQQVNTIHx8CisJCQkJaW5wdXQtPnJlYXV0aF9yZXF1ZXN0X2NoZWNrICE9
IFBBU1MgfHwKKwkJCQlpbnB1dC0+bGlua19pbnRlZ3JpdHlfY2hlY2tfZHAgIT0gUEFTUykgewor
CQkJZmFpbF9hbmRfcmVzdGFydF9pbl9tcygwLCAmc3RhdHVzLCBvdXRwdXQpOworCQkJYnJlYWs7
CisJCX0gZWxzZSBpZiAoZXZlbnRfY3R4LT5yeF9pZF9saXN0X3JlYWR5KSB7CisJCQljYWxsYmFj
a19pbl9tcygwLCBvdXRwdXQpOworCQkJc2V0X3N0YXRlX2lkKGhkY3AsIG91dHB1dCwgRDJfQTc4
X1ZFUklGWV9SWF9JRF9MSVNUX0FORF9TRU5EX0FDSyk7CisJCQlicmVhazsKKwkJfSBlbHNlIGlm
IChpbnB1dC0+c3RyZWFtX3JlYWR5X3JlYWQgIT0gUEFTUyB8fAorCQkJCWlucHV0LT5zdHJlYW1f
cmVhZHlfdmFsaWRhdGlvbiAhPSBQQVNTKSB7CisJCQkvKgorCQkJICogMUItMTAtMTogcmVzdGFy
dCBjb250ZW50IHN0cmVhbSBtYW5hZ2VtZW50CisJCQkgKiBvbiBpbnZhbGlkIE0nCisJCQkgKiAx
Qi0xMC0yOiBjb25zaWRlciBzdHJlYW0gcmVhZHkgdGltZW91dCBhIGZhaWx1cmUKKwkJCSAqLwor
CQkJaWYgKGhkY3AtPmF1dGguY291bnQuc3RyZWFtX21hbmFnZW1lbnRfcmV0cnlfY291bnQgPiAx
MCkgeworCQkJCWZhaWxfYW5kX3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJ
CX0gZWxzZSB7CisJCQkJaGRjcC0+YXV0aC5jb3VudC5zdHJlYW1fbWFuYWdlbWVudF9yZXRyeV9j
b3VudCsrOworCQkJCWNhbGxiYWNrX2luX21zKDAsIG91dHB1dCk7CisJCQkJc2V0X3N0YXRlX2lk
KGhkY3AsIG91dHB1dCwgRDJfQTlfU0VORF9TVFJFQU1fTUFOQUdFTUVOVCk7CisJCQl9CisJCQli
cmVhazsKKwkJfQorCQljYWxsYmFja19pbl9tcygyMDAsIG91dHB1dCk7CisJCXNldF9zdGF0ZV9p
ZChoZGNwLCBvdXRwdXQsIEQyX0VOQUJMRV9FTkNSWVBUSU9OKTsKKwkJYnJlYWs7CisJZGVmYXVs
dDoKKwkJc3RhdHVzID0gTU9EX0hEQ1BfU1RBVFVTX0lOVkFMSURfU1RBVEU7CisJCWZhaWxfYW5k
X3Jlc3RhcnRfaW5fbXMoMCwgJnN0YXR1cywgb3V0cHV0KTsKKwkJYnJlYWs7CisJfQorCXJldHVy
biBzdGF0dXM7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9k
dWxlcy9pbmMvbW9kX2hkY3AuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9tb2R1bGVz
L2luYy9tb2RfaGRjcC5oCmluZGV4IGRlYTIxNzAyZWRmZi4uOTdlY2JmNWJmZWMxIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9pbmMvbW9kX2hkY3AuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvbW9kdWxlcy9pbmMvbW9kX2hkY3AuaApA
QCAtNzcsNiArNzcsNyBAQCBlbnVtIG1vZF9oZGNwX3N0YXR1cyB7CiAJTU9EX0hEQ1BfU1RBVFVT
X0hEQ1AyX0hfUFJJTUVfUEVORElORywKIAlNT0RfSERDUF9TVEFUVVNfSERDUDJfUEFJUklOR19J
TkZPX1BFTkRJTkcsCiAJTU9EX0hEQ1BfU1RBVFVTX0hEQ1AyX1ZBTElEQVRFX0FLRV9DRVJUX0ZB
SUxVUkUsCisJTU9EX0hEQ1BfU1RBVFVTX0hEQ1AyX0FLRV9DRVJUX1JFVk9LRUQsCiAJTU9EX0hE
Q1BfU1RBVFVTX0hEQ1AyX1ZBTElEQVRFX0hfUFJJTUVfRkFJTFVSRSwKIAlNT0RfSERDUF9TVEFU
VVNfSERDUDJfVkFMSURBVEVfUEFJUklOR19JTkZPX0ZBSUxVUkUsCiAJTU9EX0hEQ1BfU1RBVFVT
X0hEQ1AyX1BSRVBfTENfSU5JVF9GQUlMVVJFLApAQCAtODYsNiArODcsNyBAQCBlbnVtIG1vZF9o
ZGNwX3N0YXR1cyB7CiAJTU9EX0hEQ1BfU1RBVFVTX0hEQ1AyX0VOQUJMRV9FTkNSWVBUSU9OX0ZB
SUxVUkUsCiAJTU9EX0hEQ1BfU1RBVFVTX0hEQ1AyX1JYX0lEX0xJU1RfTk9UX1JFQURZLAogCU1P
RF9IRENQX1NUQVRVU19IRENQMl9WQUxJREFURV9SWF9JRF9MSVNUX0ZBSUxVUkUsCisJTU9EX0hE
Q1BfU1RBVFVTX0hEQ1AyX1JYX0lEX0xJU1RfUkVWT0tFRCwKIAlNT0RfSERDUF9TVEFUVVNfSERD
UDJfRU5BQkxFX1NUUkVBTV9FTkNSWVBUSU9OLAogCU1PRF9IRENQX1NUQVRVU19IRENQMl9TVFJF
QU1fUkVBRFlfUEVORElORywKIAlNT0RfSERDUF9TVEFUVVNfSERDUDJfVkFMSURBVEVfU1RSRUFN
X1JFQURZX0ZBSUxVUkUsCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vYW1kLWdmeA==
