Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 739C3DD09B
	for <lists+amd-gfx@lfdr.de>; Fri, 18 Oct 2019 22:49:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D87AD6E04A;
	Fri, 18 Oct 2019 20:49:55 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-CY1-obe.outbound.protection.outlook.com
 (mail-eopbgr760082.outbound.protection.outlook.com [40.107.76.82])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D918A6E048
 for <amd-gfx@lists.freedesktop.org>; Fri, 18 Oct 2019 20:49:52 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=CXQIjn/ZCfJbHh1vxmRMcSD61/OlEY526OMRzeLsgRYwOdpjDPLaB1FWoLAZo3XhgErhaowVIr0JFyAJz0fdqULSD6cfV0oSgOLGfAFAJNmmVM+c9AUanfpFrjqo/JFui86GJ8Zm/WGU6m2fso9/99+HY2CEsNBMrtX+CJfjHx3av1itYQ2AwM8D6gx5mkXTdga/MKO4zEZUbjj+XWOqEWrplKTZ3UiUIhmyC22nTeoKIQamVZIwQ7L9IWSMSShUqjW5SeBTTe4KIGVOngeCjkph8X3yEzdClqmPKoLTH3i+mEYXU6Irir/OJQY7bFloByYIWTsPNNG6/lDyLqhehA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=L8LsWpgiS2nbBO24RXaFcufTNHDxAldQFhjahiF+niM=;
 b=i0yDf+ub1kq0WHPLv+WimBZxOdtipQELMfN/LrFTNEYVVPrS0RzibEIXpWvd5CTZFiIBhvJZ2/HYFaieIR8ATpyBGgkiC/y7eOZ7J6K3RTKKTBUlE0av2WWtZYTYJYHSoBTMfkCug/p+j1AMvdyfOCNmKoqJ8W/8gWB2JArDJEWl3qTspT/4oah2E+jcUH+634TH7Ej3CjEnCUkBqFNZzC2pRS+7h+awhvK9GRIXlvGPpi0OXeyIeF2vILQE7IVO65oCFMfop9nQfsOMejeoHOJZoozuAAMBc5rb6XXb2MGBgiWoiHQqncRzVRFAOXTS1VASEF+a7Jh7bEDKfi08gQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org smtp.mailfrom=amd.com; 
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from DM5PR12CA0002.namprd12.prod.outlook.com (2603:10b6:4:1::12) by
 BN6PR12MB1298.namprd12.prod.outlook.com (2603:10b6:404:17::19) with
 Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2347.21; Fri, 18 Oct 2019 20:49:50 +0000
Received: from BY2NAM03FT035.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e4a::204) by DM5PR12CA0002.outlook.office365.com
 (2603:10b6:4:1::12) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2367.20 via Frontend
 Transport; Fri, 18 Oct 2019 20:49:50 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXMB01.amd.com (165.204.84.17) by
 BY2NAM03FT035.mail.protection.outlook.com (10.152.84.223) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.20.2367.14 via Frontend Transport; Fri, 18 Oct 2019 20:49:49 +0000
Received: from SATLEXMB02.amd.com (10.181.40.143) by SATLEXMB01.amd.com
 (10.181.40.142) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1713.5; Fri, 18 Oct
 2019 15:49:49 -0500
Received: from agrodzovsky-All-Series.amd.com (10.180.168.240) by
 SATLEXMB02.amd.com (10.181.40.143) with Microsoft SMTP Server id 15.1.1713.5
 via Frontend Transport; Fri, 18 Oct 2019 15:49:48 -0500
From: Andrey Grodzovsky <andrey.grodzovsky@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 2/4] drm/amd/powerplay: Add EEPROM I2C read/write support to
 Arcturus.
Date: Fri, 18 Oct 2019 16:48:29 -0400
Message-ID: <1571431711-30149-3-git-send-email-andrey.grodzovsky@amd.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1571431711-30149-1-git-send-email-andrey.grodzovsky@amd.com>
References: <1571431711-30149-1-git-send-email-andrey.grodzovsky@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(396003)(376002)(39860400002)(346002)(136003)(428003)(199004)(189003)(70586007)(478600001)(70206006)(305945005)(7696005)(76176011)(5660300002)(86362001)(50466002)(6666004)(53416004)(16586007)(356004)(2351001)(14444005)(316002)(51416003)(54906003)(8936002)(336012)(8676002)(476003)(2616005)(50226002)(126002)(81156014)(26005)(48376002)(81166006)(44832011)(186003)(6916009)(4326008)(36756003)(2906002)(47776003)(446003)(11346002)(426003)(486006);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN6PR12MB1298; H:SATLEXMB01.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 2d74ccb1-05e3-4fbb-023c-08d7540cb80e
X-MS-TrafficTypeDiagnostic: BN6PR12MB1298:
X-Microsoft-Antispam-PRVS: <BN6PR12MB1298F13A245E81412650688AEA6C0@BN6PR12MB1298.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:6790;
X-Forefront-PRVS: 01949FE337
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: SwSon9urZ7UmdJIBTNRsMVh9Uwn+jPG9Y9gL0VUOfuLPLTICq6wlqHqmV1GoM/YSvTwLDQgsbg3vkLsOg5oz96F0O2AiOUxUh/4AU8WbvNBwQGodcmB7ST8/iXZDdJk9fXsWctTDkshnm1SKaKfo0toCMrVhMbD1IeF6UHsEi3AtPyQP4Ut6K9cZOp9BsMC9W5rrq+x/mCB0acyXpGRDQCLjDmoJ8WXC/hB9aM38P8h8TsCMWeMvMATQPM6gEjrYkvCXCMAb1DJk1pEVLwv1CKhy3C4rpgG4Cy+5oWq4SrMb1JxI88K0f81LFQsAUbJLALBPa2WOIY0EcrV8nsHg57GITUCw94woS7QDJ6z3nsbhkp4rQKlbt/VnaZSYPq0JKCyGAdLh4pYwY2kHFczjBryIvteE4gfiLlcRng0vFfU=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 18 Oct 2019 20:49:49.9180 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 2d74ccb1-05e3-4fbb-023c-08d7540cb80e
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXMB01.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN6PR12MB1298
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=L8LsWpgiS2nbBO24RXaFcufTNHDxAldQFhjahiF+niM=;
 b=QzqL57HuJ6sSvg1eXro1w2HdLWdPT6iZGlx7s57aajwqyD4M5qAlIjeYO3ZAD1OIpqjiEvSlKS+D7kEYr53drSWaWNZJF9uruEXvTOCYWqqVZrUHwVCDFuCbMwkyU3dGi2tXB1F80jU6zzp7TY+VR7ezzH7MFqpZFBZrdAXFNv4=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Andrey Grodzovsky <andrey.grodzovsky@amd.com>, Guchun.Chen@amd.com,
 Tao.Zhou1@amd.com, noreply-confluence@amd.com, Alexander.Deucher@amd.com,
 Evan.Quan@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

VGhlIGNvbW11bmljYXRpb24gaXMgZG9uZSB0aHJvdWdoIFNNVSB0YWJsZSBhbmQgaGVuY2UgdGhl
IGNvZGUKaXMgaW4gcG93ZXJwbGF5LgoKU2lnbmVkLW9mZi1ieTogQW5kcmV5IEdyb2R6b3Zza3kg
PGFuZHJleS5ncm9kem92c2t5QGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9wb3dl
cnBsYXkvYXJjdHVydXNfcHB0LmMgfCAyMjkgKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAx
IGZpbGUgY2hhbmdlZCwgMjI5IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL3Bvd2VycGxheS9hcmN0dXJ1c19wcHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
cG93ZXJwbGF5L2FyY3R1cnVzX3BwdC5jCmluZGV4IDkwZDg3MWEuLjUzZDA4ZGU1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9hcmN0dXJ1c19wcHQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL3Bvd2VycGxheS9hcmN0dXJ1c19wcHQuYwpAQCAtMzYsNiArMzYs
MTEgQEAKICNpbmNsdWRlICJzbXVfdjExXzBfcHB0YWJsZS5oIgogI2luY2x1ZGUgImFyY3R1cnVz
X3Bwc21jLmgiCiAjaW5jbHVkZSAibmJpby9uYmlvXzdfNF9zaF9tYXNrLmgiCisjaW5jbHVkZSA8
bGludXgvaTJjLmg+CisjaW5jbHVkZSA8bGludXgvcGNpLmg+CisjaW5jbHVkZSAiYW1kZ3B1X3Jh
cy5oIgorCisjZGVmaW5lIHRvX2FtZGdwdV9kZXZpY2UoeCkgKGNvbnRhaW5lcl9vZih4LCBzdHJ1
Y3QgYW1kZ3B1X3JhcywgZWVwcm9tX2NvbnRyb2wuZWVwcm9tX2FjY2Vzc29yKSktPmFkZXYKIAog
I2RlZmluZSBDVEZfT0ZGU0VUX0VER0UJCQk1CiAjZGVmaW5lIENURl9PRkZTRVRfSE9UU1BPVAkJ
NQpAQCAtMTcxLDYgKzE3Niw3IEBAIHN0YXRpYyBzdHJ1Y3Qgc211XzExXzBfY21uMmFpc2NfbWFw
cGluZyBhcmN0dXJ1c190YWJsZV9tYXBbU01VX1RBQkxFX0NPVU5UXSA9IHsKIAlUQUJfTUFQKFNN
VV9NRVRSSUNTKSwKIAlUQUJfTUFQKERSSVZFUl9TTVVfQ09ORklHKSwKIAlUQUJfTUFQKE9WRVJE
UklWRSksCisJVEFCX01BUChJMkNfQ09NTUFORFMpLAogfTsKIAogc3RhdGljIHN0cnVjdCBzbXVf
MTFfMF9jbW4yYWlzY19tYXBwaW5nIGFyY3R1cnVzX3B3cl9zcmNfbWFwW1NNVV9QT1dFUl9TT1VS
Q0VfQ09VTlRdID0gewpAQCAtMjkzLDYgKzI5OSw5IEBAIHN0YXRpYyBpbnQgYXJjdHVydXNfdGFi
bGVzX2luaXQoc3RydWN0IHNtdV9jb250ZXh0ICpzbXUsIHN0cnVjdCBzbXVfdGFibGUgKnRhYmxl
CiAJU01VX1RBQkxFX0lOSVQodGFibGVzLCBTTVVfVEFCTEVfU01VX01FVFJJQ1MsIHNpemVvZihT
bXVNZXRyaWNzX3QpLAogCQkgICAgICAgUEFHRV9TSVpFLCBBTURHUFVfR0VNX0RPTUFJTl9WUkFN
KTsKIAorCVNNVV9UQUJMRV9JTklUKHRhYmxlcywgU01VX1RBQkxFX0kyQ19DT01NQU5EUywgc2l6
ZW9mKFN3STJjUmVxdWVzdF90KSwKKwkJCSAgICAgICBQQUdFX1NJWkUsIEFNREdQVV9HRU1fRE9N
QUlOX1ZSQU0pOworCiAJc211X3RhYmxlLT5tZXRyaWNzX3RhYmxlID0ga3phbGxvYyhzaXplb2Yo
U211TWV0cmljc190KSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFzbXVfdGFibGUtPm1ldHJpY3NfdGFi
bGUpCiAJCXJldHVybiAtRU5PTUVNOwpAQCAtMTkyNyw2ICsxOTM2LDIyNCBAQCBzdGF0aWMgaW50
IGFyY3R1cnVzX2RwbV9zZXRfdXZkX2VuYWJsZShzdHJ1Y3Qgc211X2NvbnRleHQgKnNtdSwgYm9v
bCBlbmFibGUpCiAJcmV0dXJuIHJldDsKIH0KIAorCitzdGF0aWMgdm9pZCBhcmN0dXJ1c19maWxs
X2VlcHJvbV9pMmNfcmVxKFN3STJjUmVxdWVzdF90ICAqcmVxLCBib29sIHdyaXRlLAorCQkJCSAg
dWludDhfdCBhZGRyZXNzLCB1aW50MzJfdCBudW1ieXRlcywKKwkJCQkgIHVpbnQ4X3QgKmRhdGEp
Cit7CisJaW50IGk7CisKKwlCVUdfT04obnVtYnl0ZXMgPiBNQVhfU1dfSTJDX0NPTU1BTkRTKTsK
KworCXJlcS0+STJDY29udHJvbGxlclBvcnQgPSAwOworCXJlcS0+STJDU3BlZWQgPSAyOworCXJl
cS0+U2xhdmVBZGRyZXNzID0gYWRkcmVzczsKKwlyZXEtPk51bUNtZHMgPSBudW1ieXRlczsKKwor
CWZvciAoaSA9IDA7IGkgPCBudW1ieXRlczsgaSsrKSB7CisJCVN3STJjQ21kX3QgKmNtZCA9ICAm
cmVxLT5Td0kyY0NtZHNbaV07CisKKwkJLyogRmlyc3QgMiBieXRlcyBhcmUgYWx3YXlzIHdyaXRl
IGZvciBsb3dlciAyYiBFRVBST00gYWRkcmVzcyAqLworCQlpZiAoaSA8IDIpCisJCQljbWQtPkNt
ZCA9IDE7CisJCWVsc2UKKwkJCWNtZC0+Q21kID0gd3JpdGU7CisKKworCQkvKiBBZGQgUkVTVEFS
VCBmb3IgcmVhZCAgYWZ0ZXIgYWRkcmVzcyBmaWxsZWQgKi8KKwkJY21kLT5DbWRDb25maWcgfD0g
KGkgPT0gMiAmJiAhd3JpdGUpID8gQ01EQ09ORklHX1JFU1RBUlRfTUFTSyA6IDA7CisKKwkJLyog
QWRkIFNUT1AgaW4gdGhlIGVuZCAqLworCQljbWQtPkNtZENvbmZpZyB8PSAoaSA9PSAobnVtYnl0
ZXMgLSAxKSkgPyBDTURDT05GSUdfU1RPUF9NQVNLIDogMDsKKworCQkvKiBGaWxsIHdpdGggZGF0
YSByZWdhcmRsZXNzIGlmIHJlYWQgb3Igd3JpdGUgdG8gc2ltcGxpZnkgY29kZSAqLworCQljbWQt
PlJlZ2lzdGVyQWRkciA9IGRhdGFbaV07CisJfQorfQorCitzdGF0aWMgaW50IGFyY3R1cnVzX2ky
Y19lZXByb21fcmVhZF9kYXRhKHN0cnVjdCBpMmNfYWRhcHRlciAqY29udHJvbCwKKwkJCQkJICAg
ICAgIHVpbnQ4X3QgYWRkcmVzcywKKwkJCQkJICAgICAgIHVpbnQ4X3QgKmRhdGEsCisJCQkJCSAg
ICAgICB1aW50MzJfdCBudW1ieXRlcykKK3sKKwl1aW50MzJfdCAgaSwgcmV0ID0gMDsKKwlTd0ky
Y1JlcXVlc3RfdCByZXE7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSB0b19hbWRncHVf
ZGV2aWNlKGNvbnRyb2wpOworCXN0cnVjdCBzbXVfdGFibGVfY29udGV4dCAqc211X3RhYmxlID0g
JmFkZXYtPnNtdS5zbXVfdGFibGU7CisJc3RydWN0IHNtdV90YWJsZSAqdGFibGUgPSAmc211X3Rh
YmxlLT50YWJsZXNbU01VX1RBQkxFX0kyQ19DT01NQU5EU107CisKKwltZW1zZXQoJnJlcSwgMCwg
c2l6ZW9mKHJlcSkpOworCWFyY3R1cnVzX2ZpbGxfZWVwcm9tX2kyY19yZXEoJnJlcSwgZmFsc2Us
IGFkZHJlc3MsIG51bWJ5dGVzLCBkYXRhKTsKKworCW11dGV4X2xvY2soJmFkZXYtPnNtdS5tdXRl
eCk7CisJLyogTm93IHJlYWQgZGF0YSBzdGFydGluZyB3aXRoIHRoYXQgYWRkcmVzcyAqLworCXJl
dCA9IHNtdV91cGRhdGVfdGFibGUoJmFkZXYtPnNtdSwgU01VX1RBQkxFX0kyQ19DT01NQU5EUywg
MCwgJnJlcSwKKwkJCQkJdHJ1ZSk7CisJbXV0ZXhfdW5sb2NrKCZhZGV2LT5zbXUubXV0ZXgpOwor
CisJaWYgKCFyZXQpIHsKKwkJU3dJMmNSZXF1ZXN0X3QgKnJlcyA9IChTd0kyY1JlcXVlc3RfdCAq
KXRhYmxlLT5jcHVfYWRkcjsKKworCQkvKiBBc3N1bWUgU01VICBmaWxscyByZXMuU3dJMmNDbWRz
W2ldLkRhdGEgd2l0aCByZWFkIGJ5dGVzICovCisJCWZvciAoaSA9IDA7IGkgPCBudW1ieXRlczsg
aSsrKQorCQkJZGF0YVtpXSA9IHJlcy0+U3dJMmNDbWRzW2ldLkRhdGE7CisKKwkJcHJfZGVidWco
ImFyY3R1cnVzX2kyY19lZXByb21fcmVhZF9kYXRhLCBhZGRyZXNzID0gJXgsIGJ5dGVzID0gJWQs
IGRhdGEgOiIsCisJCQkJICAodWludDE2X3QpYWRkcmVzcywgbnVtYnl0ZXMpOworCisJCXByaW50
X2hleF9kdW1wKEtFUk5fREVCVUcsICJkYXRhOiAiLCBEVU1QX1BSRUZJWF9OT05FLAorCQkJICAg
ICAgIDgsIDEsIGRhdGEsIG51bWJ5dGVzLCBmYWxzZSk7CisJfSBlbHNlCisJCXByX2VycigiYXJj
dHVydXNfaTJjX2VlcHJvbV9yZWFkX2RhdGEgLSBlcnJvciBvY2N1cnJlZCA6JXgiLCByZXQpOwor
CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBhcmN0dXJ1c19pMmNfZWVwcm9tX3dyaXRl
X2RhdGEoc3RydWN0IGkyY19hZGFwdGVyICpjb250cm9sLAorCQkJCQkJdWludDhfdCBhZGRyZXNz
LAorCQkJCQkJdWludDhfdCAqZGF0YSwKKwkJCQkJCXVpbnQzMl90IG51bWJ5dGVzKQoreworCXVp
bnQzMl90IHJldDsKKwlTd0kyY1JlcXVlc3RfdCByZXE7CisJc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYgPSB0b19hbWRncHVfZGV2aWNlKGNvbnRyb2wpOworCisJbWVtc2V0KCZyZXEsIDAsIHNp
emVvZihyZXEpKTsKKwlhcmN0dXJ1c19maWxsX2VlcHJvbV9pMmNfcmVxKCZyZXEsIHRydWUsIGFk
ZHJlc3MsIG51bWJ5dGVzLCBkYXRhKTsKKworCW11dGV4X2xvY2soJmFkZXYtPnNtdS5tdXRleCk7
CisJcmV0ID0gc211X3VwZGF0ZV90YWJsZSgmYWRldi0+c211LCBTTVVfVEFCTEVfSTJDX0NPTU1B
TkRTLCAwLCAmcmVxLCB0cnVlKTsKKwltdXRleF91bmxvY2soJmFkZXYtPnNtdS5tdXRleCk7CisK
KwlpZiAoIXJldCkgeworCQlwcl9kZWJ1ZygiYXJjdHVydXNfaTJjX3dyaXRlKCksIGFkZHJlc3Mg
PSAleCwgYnl0ZXMgPSAlZCAsIGRhdGE6ICIsCisJCQkJCSAodWludDE2X3QpYWRkcmVzcywgbnVt
Ynl0ZXMpOworCisJCXByaW50X2hleF9kdW1wKEtFUk5fREVCVUcsICJkYXRhOiAiLCBEVU1QX1BS
RUZJWF9OT05FLAorCQkJICAgICAgIDgsIDEsIGRhdGEsIG51bWJ5dGVzLCBmYWxzZSk7CisJCS8q
CisJCSAqIEFjY29yZGluZyB0byBFRVBST00gc3BlYyB0aGVyZSBpcyBhIE1BWCBvZiAxMCBtcyBy
ZXF1aXJlZCBmb3IKKwkJICogRUVQUk9NIHRvIGZsdXNoIGludGVybmFsIFJYIGJ1ZmZlciBhZnRl
ciBTVE9QIHdhcyBpc3N1ZWQgYXQgdGhlCisJCSAqIGVuZCBvZiB3cml0ZSB0cmFuc2FjdGlvbi4g
RHVyaW5nIHRoaXMgdGltZSB0aGUgRUVQUk9NIHdpbGwgbm90IGJlCisJCSAqIHJlc3BvbnNpdmUg
dG8gYW55IG1vcmUgY29tbWFuZHMgLSBzbyB3YWl0IGEgYml0IG1vcmUuCisJCSAqLworCQltc2xl
ZXAoMTApOworCisJfSBlbHNlCisJCXByX2VycigiYXJjdHVydXNfaTJjX3dyaXRlLSBlcnJvciBv
Y2N1cnJlZCA6JXgiLCByZXQpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBhcmN0
dXJ1c19pMmNfZWVwcm9tX2kyY194ZmVyKHN0cnVjdCBpMmNfYWRhcHRlciAqaTJjX2FkYXAsCisJ
CQkgICAgICBzdHJ1Y3QgaTJjX21zZyAqbXNncywgaW50IG51bSkKK3sKKwl1aW50MzJfdCAgaSwg
aiwgcmV0LCBkYXRhX3NpemUsIGRhdGFfY2h1bmtfc2l6ZSwgbmV4dF9lZXByb21fYWRkciA9IDA7
CisJdWludDhfdCAqZGF0YV9wdHIsIGRhdGFfY2h1bmtbTUFYX1NXX0kyQ19DT01NQU5EU10gPSB7
IDAgfTsKKworCWZvciAoaSA9IDA7IGkgPCBudW07IGkrKykgeworCQkvKgorCQkgKiBTTVUgaW50
ZXJmYWNlIGFsbG93cyBhdCBtb3N0IE1BWF9TV19JMkNfQ09NTUFORFMgYnl0ZXMgb2YgZGF0YSBh
dAorCQkgKiBvbmNlIGFuZCBoZW5jZSB0aGUgZGF0YSBuZWVkcyB0byBiZSBzcGxpY2VkIGludG8g
Y2h1bmtzIGFuZCBzZW50IGVhY2gKKwkJICogY2h1bmsgc2VwYXJhdGVseQorCQkgKi8KKwkJZGF0
YV9zaXplID0gbXNnc1tpXS5sZW4gLSAyOworCQlkYXRhX2NodW5rX3NpemUgPSBNQVhfU1dfSTJD
X0NPTU1BTkRTIC0gMjsKKwkJbmV4dF9lZXByb21fYWRkciA9IChtc2dzW2ldLmJ1ZlswXSA8PCA4
ICYgMHhmZjAwKSB8IChtc2dzW2ldLmJ1ZlsxXSAmIDB4ZmYpOworCQlkYXRhX3B0ciA9IG1zZ3Nb
aV0uYnVmICsgMjsKKworCQlmb3IgKGogPSAwOyBqIDwgZGF0YV9zaXplIC8gZGF0YV9jaHVua19z
aXplOyBqKyspIHsKKwkJCS8qIEluc2VydCB0aGUgRUVQUk9NIGRlc3QgYWRkZXNzLCBiaXRzIDAt
MTUgKi8KKwkJCWRhdGFfY2h1bmtbMF0gPSAoKG5leHRfZWVwcm9tX2FkZHIgPj4gOCkgJiAweGZm
KTsKKwkJCWRhdGFfY2h1bmtbMV0gPSAobmV4dF9lZXByb21fYWRkciAmIDB4ZmYpOworCisJCQlp
ZiAobXNnc1tpXS5mbGFncyAmIEkyQ19NX1JEKSB7CisJCQkJcmV0ID0gYXJjdHVydXNfaTJjX2Vl
cHJvbV9yZWFkX2RhdGEoaTJjX2FkYXAsCisJCQkJCQkJCSh1aW50OF90KW1zZ3NbaV0uYWRkciwK
KwkJCQkJCQkJZGF0YV9jaHVuaywgTUFYX1NXX0kyQ19DT01NQU5EUyk7CisKKwkJCQltZW1jcHko
ZGF0YV9wdHIsIGRhdGFfY2h1bmsgKyAyLCBkYXRhX2NodW5rX3NpemUpOworCQkJfSBlbHNlIHsK
KworCQkJCW1lbWNweShkYXRhX2NodW5rICsgMiwgZGF0YV9wdHIsIGRhdGFfY2h1bmtfc2l6ZSk7
CisKKwkJCQlyZXQgPSBhcmN0dXJ1c19pMmNfZWVwcm9tX3dyaXRlX2RhdGEoaTJjX2FkYXAsCisJ
CQkJCQkJCSAodWludDhfdCltc2dzW2ldLmFkZHIsCisJCQkJCQkJCSBkYXRhX2NodW5rLCBNQVhf
U1dfSTJDX0NPTU1BTkRTKTsKKwkJCX0KKworCQkJaWYgKHJldCkgeworCQkJCW51bSA9IC1FSU87
CisJCQkJZ290byBmYWlsOworCQkJfQorCisJCQluZXh0X2VlcHJvbV9hZGRyICs9IGRhdGFfY2h1
bmtfc2l6ZTsKKwkJCWRhdGFfcHRyICs9IGRhdGFfY2h1bmtfc2l6ZTsKKwkJfQorCisJCWlmIChk
YXRhX3NpemUgJSBkYXRhX2NodW5rX3NpemUpIHsKKwkJCWRhdGFfY2h1bmtbMF0gPSAoKG5leHRf
ZWVwcm9tX2FkZHIgPj4gOCkgJiAweGZmKTsKKwkJCWRhdGFfY2h1bmtbMV0gPSAobmV4dF9lZXBy
b21fYWRkciAmIDB4ZmYpOworCisJCQlpZiAobXNnc1tpXS5mbGFncyAmIEkyQ19NX1JEKSB7CisJ
CQkJcmV0ID0gYXJjdHVydXNfaTJjX2VlcHJvbV9yZWFkX2RhdGEoaTJjX2FkYXAsCisJCQkJCQkJ
CSh1aW50OF90KW1zZ3NbaV0uYWRkciwKKwkJCQkJCQkJZGF0YV9jaHVuaywgKGRhdGFfc2l6ZSAl
IGRhdGFfY2h1bmtfc2l6ZSkgKyAyKTsKKworCQkJCW1lbWNweShkYXRhX3B0ciwgZGF0YV9jaHVu
ayArIDIsIGRhdGFfc2l6ZSAlIGRhdGFfY2h1bmtfc2l6ZSk7CisJCQl9IGVsc2UgeworCQkJCW1l
bWNweShkYXRhX2NodW5rICsgMiwgZGF0YV9wdHIsIGRhdGFfc2l6ZSAlIGRhdGFfY2h1bmtfc2l6
ZSk7CisKKwkJCQlyZXQgPSBhcmN0dXJ1c19pMmNfZWVwcm9tX3dyaXRlX2RhdGEoaTJjX2FkYXAs
CisJCQkJCQkJCSAodWludDhfdCltc2dzW2ldLmFkZHIsCisJCQkJCQkJCSBkYXRhX2NodW5rLCAo
ZGF0YV9zaXplICUgZGF0YV9jaHVua19zaXplKSArIDIpOworCQkJfQorCisJCQlpZiAocmV0KSB7
CisJCQkJbnVtID0gLUVJTzsKKwkJCQlnb3RvIGZhaWw7CisJCQl9CisJCX0KKwl9CisKK2ZhaWw6
CisJcmV0dXJuIG51bTsKK30KKworc3RhdGljIHUzMiBhcmN0dXJ1c19pMmNfZWVwcm9tX2kyY19m
dW5jKHN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcCkKK3sKKwlyZXR1cm4gSTJDX0ZVTkNfSTJDIHwg
STJDX0ZVTkNfU01CVVNfRU1VTDsKK30KKworCitzdGF0aWMgY29uc3Qgc3RydWN0IGkyY19hbGdv
cml0aG0gYXJjdHVydXNfaTJjX2VlcHJvbV9pMmNfYWxnbyA9IHsKKwkubWFzdGVyX3hmZXIgPSBh
cmN0dXJ1c19pMmNfZWVwcm9tX2kyY194ZmVyLAorCS5mdW5jdGlvbmFsaXR5ID0gYXJjdHVydXNf
aTJjX2VlcHJvbV9pMmNfZnVuYywKK307CisKK2ludCBhcmN0dXJ1c19pMmNfZWVwcm9tX2NvbnRy
b2xfaW5pdChzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmNvbnRyb2wpCit7CisJc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYgPSB0b19hbWRncHVfZGV2aWNlKGNvbnRyb2wpOworCWludCByZXM7CisKKwlj
b250cm9sLT5vd25lciA9IFRISVNfTU9EVUxFOworCWNvbnRyb2wtPmNsYXNzID0gSTJDX0NMQVNT
X1NQRDsKKwljb250cm9sLT5kZXYucGFyZW50ID0gJmFkZXYtPnBkZXYtPmRldjsKKwljb250cm9s
LT5hbGdvID0gJmFyY3R1cnVzX2kyY19lZXByb21faTJjX2FsZ287CisJc25wcmludGYoY29udHJv
bC0+bmFtZSwgc2l6ZW9mKGNvbnRyb2wtPm5hbWUpLCAiUkFTIEVFUFJPTSIpOworCisJcmVzID0g
aTJjX2FkZF9hZGFwdGVyKGNvbnRyb2wpOworCWlmIChyZXMpCisJCURSTV9FUlJPUigiRmFpbGVk
IHRvIHJlZ2lzdGVyIGh3IGkyYywgZXJyOiAlZFxuIiwgcmVzKTsKKworCXJldHVybiByZXM7Cit9
CisKK3ZvaWQgYXJjdHVydXNfaTJjX2VlcHJvbV9jb250cm9sX2Zpbmkoc3RydWN0IGkyY19hZGFw
dGVyICpjb250cm9sKQoreworCWkyY19kZWxfYWRhcHRlcihjb250cm9sKTsKK30KKwogc3RhdGlj
IGNvbnN0IHN0cnVjdCBwcHRhYmxlX2Z1bmNzIGFyY3R1cnVzX3BwdF9mdW5jcyA9IHsKIAkvKiB0
cmFuc2xhdGUgc211IGluZGV4IGludG8gYXJjdHVydXMgc3BlY2lmaWMgaW5kZXggKi8KIAkuZ2V0
X3NtdV9tc2dfaW5kZXggPSBhcmN0dXJ1c19nZXRfc211X21zZ19pbmRleCwKQEAgLTE5NjYsNiAr
MjE5Myw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgcHB0YWJsZV9mdW5jcyBhcmN0dXJ1c19wcHRf
ZnVuY3MgPSB7CiAJLmdldF9wb3dlcl9saW1pdCA9IGFyY3R1cnVzX2dldF9wb3dlcl9saW1pdCwK
IAkuaXNfZHBtX3J1bm5pbmcgPSBhcmN0dXJ1c19pc19kcG1fcnVubmluZywKIAkuZHBtX3NldF91
dmRfZW5hYmxlID0gYXJjdHVydXNfZHBtX3NldF91dmRfZW5hYmxlLAorCS5pMmNfZWVwcm9tX2lu
aXQgPSBhcmN0dXJ1c19pMmNfZWVwcm9tX2NvbnRyb2xfaW5pdCwKKwkuaTJjX2VlcHJvbV9maW5p
ID0gYXJjdHVydXNfaTJjX2VlcHJvbV9jb250cm9sX2ZpbmksCiB9OwogCiB2b2lkIGFyY3R1cnVz
X3NldF9wcHRfZnVuY3Moc3RydWN0IHNtdV9jb250ZXh0ICpzbXUpCi0tIAoyLjcuNAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5n
IGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
