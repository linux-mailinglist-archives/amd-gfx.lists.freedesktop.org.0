Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A9F782911C3
	for <lists+amd-gfx@lfdr.de>; Sat, 17 Oct 2020 14:07:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C96056E0A1;
	Sat, 17 Oct 2020 12:07:41 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wm1-x342.google.com (mail-wm1-x342.google.com
 [IPv6:2a00:1450:4864:20::342])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CB85A6E0A1
 for <amd-gfx@lists.freedesktop.org>; Sat, 17 Oct 2020 12:07:40 +0000 (UTC)
Received: by mail-wm1-x342.google.com with SMTP id k18so8164761wmj.5
 for <amd-gfx@lists.freedesktop.org>; Sat, 17 Oct 2020 05:07:40 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=aLBZjUxfdM8dt4uovYZuL4eSp+ObUdOraawh7tyJ3L0=;
 b=UjArImGceS1HgciMOBJZK+m0/dCpRgIiZ3ecDnCz4ipfMnMexc0QGtqAyGhSIIvEuG
 gekXzavqYcwKECex+F+1AuKSGKiayvi5qEI60WqbcIK8FE7/zFfpY16t+BzHBOjohgHu
 2+j8/kmdws01B1W2TbjMdWy2yItX7J2zBULA2wcr065aPwh0gFOW2+QOUJXRF8nmdHbz
 mwFpph16uMRUwypV9jyzIU82BDljfDy9PzWdbhA6iCpDlCWNDGEI466xZrXPucy2vhRf
 E6l1p0YdL7O/UBpdXw/WBYVSXH6Aw7PHyDfEF0xhTpCZGVFXBrx3EyUADbamY+5Tr9H2
 RJ9g==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=aLBZjUxfdM8dt4uovYZuL4eSp+ObUdOraawh7tyJ3L0=;
 b=TiqigM3zEw16/pU0JnbZJWG2FlAnoRpWG77f/t5AyxDScsU8i3df0LqXDGgmc75COp
 sYUBGeHsblH3WN6KYFtVBYagcCTHPZTWcR5dhc+N4cmD5X7J2Xw1aP/hoTkV07k2EA+L
 jOv74v2cHmotHH+swKRiTaBrZ7hUMVRWj/iEyhMevHcaUYtzlk4V/qCdt+lpVyNhSNpy
 8c4Ih/UWfuPKF5cpNWfaCDsiIK8QRU1wvneXW7FVbzAMt9n/rmQh6meCGeXVE/5bHyqW
 dnt+z0YJXubie+nrR8y9Hz49pYjOM1DIVF9j0i1G3UAzJ9RdUNlW/WeUUuzVhRc/Q1Z0
 A6fQ==
X-Gm-Message-State: AOAM531FGNHOkkwDoYU5YBvKutEvVguVTkDSkMsYP/CxvT2oqQUB+yyB
 6D5WY+gvjIBlXSS2cSPxOWA1IS46+MdlizMG
X-Google-Smtp-Source: ABdhPJyCS5t4gCWxcInCkf9M7y3hg2N4C6z7kFEk0JIGFWgtHH15VCJBHFBrelCvyeHWx8kEoxhknw==
X-Received: by 2002:a1c:bd57:: with SMTP id n84mr8488242wmf.126.1602936459145; 
 Sat, 17 Oct 2020 05:07:39 -0700 (PDT)
Received: from abel.fritz.box
 (dynamic-002-244-048-143.2.244.pool.telefonica.de. [2.244.48.143])
 by smtp.gmail.com with ESMTPSA id y4sm7957128wrp.74.2020.10.17.05.07.38
 for <amd-gfx@lists.freedesktop.org>
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Sat, 17 Oct 2020 05:07:38 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 2/2] drm/amdgpu: nuke amdgpu_vm_bo_split_mapping v2
Date: Sat, 17 Oct 2020 14:07:37 +0200
Message-Id: <20201017120737.2430-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20201017120737.2430-1-christian.koenig@amd.com>
References: <20201017120737.2430-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

TWVyZ2UgdGhlIGZ1bmN0aW9uYWxpdHkgbW9zdGx5IGludG8gYW1kZ3B1X3ZtX2JvX3VwZGF0ZV9t
YXBwaW5nLgoKVGhpcyB3YXkgd2UgY2FuIGV2ZW4gaGFuZGxlIHNtYWxsIGNvbnRpZ3VvdXMgc3lz
dGVtIHBhZ2VzIHdpdGhvdXQKdG8gbXVjaCBleHRyYSBDUFUgb3ZlcmhlYWQuCgp2MjogZml4IHR5
cG8sIGtlZXAgdGhlIGN1cnNvciBhcyBpdCBpcyBmb3Igbm93CgpTaWduZWQtb2ZmLWJ5OiBDaHJp
c3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+ClJldmlld2VkLWJ5OiBNYWRo
YXYgQ2hhdWhhbiA8bWFkaGF2LmNoYXVoYW5AYW1kLmNvbT4gKHYxKQotLS0KIGRyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jIHwgMTgyICsrKysrKysrKysrLS0tLS0tLS0tLS0t
LS0KIDEgZmlsZSBjaGFuZ2VkLCA3OSBpbnNlcnRpb25zKCspLCAxMDMgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYwppbmRleCAzY2Q5NDlhYWQ1MDAuLjBk
NGE3ZDZkMzg1NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMKQEAgLTE1
NzAsNyArMTU3MCw4IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX3VwZGF0ZV9wdGVzKHN0cnVjdCBh
bWRncHVfdm1fdXBkYXRlX3BhcmFtcyAqcGFyYW1zLAogLyoqCiAgKiBhbWRncHVfdm1fYm9fdXBk
YXRlX21hcHBpbmcgLSB1cGRhdGUgYSBtYXBwaW5nIGluIHRoZSB2bSBwYWdlIHRhYmxlCiAgKgot
ICogQGFkZXY6IGFtZGdwdV9kZXZpY2UgcG9pbnRlcgorICogQGFkZXY6IGFtZGdwdV9kZXZpY2Ug
cG9pbnRlciBvZiB0aGUgVk0KKyAqIEBib19hZGV2OiBhbWRncHVfZGV2aWNlIHBvaW50ZXIgb2Yg
dGhlIG1hcHBlZCBCTwogICogQHZtOiByZXF1ZXN0ZWQgdm0KICAqIEBpbW1lZGlhdGU6IGltbWVk
aWF0ZSBzdWJtaXNzaW9uIGluIGEgcGFnZSBmYXVsdAogICogQHVubG9ja2VkOiB1bmxvY2tlZCBp
bnZhbGlkYXRpb24gZHVyaW5nIE1NIGNhbGxiYWNrCkBAIC0xNTc4LDcgKzE1NzksOCBAQCBzdGF0
aWMgaW50IGFtZGdwdV92bV91cGRhdGVfcHRlcyhzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9wYXJh
bXMgKnBhcmFtcywKICAqIEBzdGFydDogc3RhcnQgb2YgbWFwcGVkIHJhbmdlCiAgKiBAbGFzdDog
bGFzdCBtYXBwZWQgZW50cnkKICAqIEBmbGFnczogZmxhZ3MgZm9yIHRoZSBlbnRyaWVzCi0gKiBA
YWRkcjogYWRkciB0byBzZXQgdGhlIGFyZWEgdG8KKyAqIEBvZmZzZXQ6IG9mZnNldCBpbnRvIG5v
ZGVzIGFuZCBwYWdlc19hZGRyCisgKiBAbm9kZXM6IGFycmF5IG9mIGRybV9tbV9ub2RlcyB3aXRo
IHRoZSBNQyBhZGRyZXNzZXMKICAqIEBwYWdlc19hZGRyOiBETUEgYWRkcmVzc2VzIHRvIHVzZSBm
b3IgbWFwcGluZwogICogQGZlbmNlOiBvcHRpb25hbCByZXN1bHRpbmcgZmVuY2UKICAqCkBAIC0x
NTg4LDE1ICsxNTkwLDE4IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX3VwZGF0ZV9wdGVzKHN0cnVj
dCBhbWRncHVfdm1fdXBkYXRlX3BhcmFtcyAqcGFyYW1zLAogICogMCBmb3Igc3VjY2VzcywgLUVJ
TlZBTCBmb3IgZmFpbHVyZS4KICAqLwogc3RhdGljIGludCBhbWRncHVfdm1fYm9fdXBkYXRlX21h
cHBpbmcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJCQkJICAgICAgIHN0cnVjdCBhbWRn
cHVfZGV2aWNlICpib19hZGV2LAogCQkJCSAgICAgICBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwgYm9v
bCBpbW1lZGlhdGUsCiAJCQkJICAgICAgIGJvb2wgdW5sb2NrZWQsIHN0cnVjdCBkbWFfcmVzdiAq
cmVzdiwKIAkJCQkgICAgICAgdWludDY0X3Qgc3RhcnQsIHVpbnQ2NF90IGxhc3QsCi0JCQkJICAg
ICAgIHVpbnQ2NF90IGZsYWdzLCB1aW50NjRfdCBhZGRyLAorCQkJCSAgICAgICB1aW50NjRfdCBm
bGFncywgdWludDY0X3Qgb2Zmc2V0LAorCQkJCSAgICAgICBzdHJ1Y3QgZHJtX21tX25vZGUgKm5v
ZGVzLAogCQkJCSAgICAgICBkbWFfYWRkcl90ICpwYWdlc19hZGRyLAogCQkJCSAgICAgICBzdHJ1
Y3QgZG1hX2ZlbmNlICoqZmVuY2UpCiB7CiAJc3RydWN0IGFtZGdwdV92bV91cGRhdGVfcGFyYW1z
IHBhcmFtczsKIAllbnVtIGFtZGdwdV9zeW5jX21vZGUgc3luY19tb2RlOworCXVpbnQ2NF90IHBm
bjsKIAlpbnQgcjsKIAogCW1lbXNldCgmcGFyYW1zLCAwLCBzaXplb2YocGFyYW1zKSk7CkBAIC0x
NjE0LDYgKzE2MTksMTQgQEAgc3RhdGljIGludCBhbWRncHVfdm1fYm9fdXBkYXRlX21hcHBpbmco
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJZWxzZQogCQlzeW5jX21vZGUgPSBBTURHUFVf
U1lOQ19FWFBMSUNJVDsKIAorCXBmbiA9IG9mZnNldCA+PiBQQUdFX1NISUZUOworCWlmIChub2Rl
cykgeworCQl3aGlsZSAocGZuID49IG5vZGVzLT5zaXplKSB7CisJCQlwZm4gLT0gbm9kZXMtPnNp
emU7CisJCQkrK25vZGVzOworCQl9CisJfQorCiAJYW1kZ3B1X3ZtX2V2aWN0aW9uX2xvY2sodm0p
OwogCWlmICh2bS0+ZXZpY3RpbmcpIHsKIAkJciA9IC1FQlVTWTsKQEAgLTE2MzIsMTA1ICsxNjQ1
LDQ3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0ZV9tYXBwaW5nKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LAogCWlmIChyKQogCQlnb3RvIGVycm9yX3VubG9jazsKIAotCXIgPSBh
bWRncHVfdm1fdXBkYXRlX3B0ZXMoJnBhcmFtcywgc3RhcnQsIGxhc3QgKyAxLCBhZGRyLCBmbGFn
cyk7Ci0JaWYgKHIpCi0JCWdvdG8gZXJyb3JfdW5sb2NrOwotCi0JciA9IHZtLT51cGRhdGVfZnVu
Y3MtPmNvbW1pdCgmcGFyYW1zLCBmZW5jZSk7Ci0KLWVycm9yX3VubG9jazoKLQlhbWRncHVfdm1f
ZXZpY3Rpb25fdW5sb2NrKHZtKTsKLQlyZXR1cm4gcjsKLX0KLQotLyoqCi0gKiBhbWRncHVfdm1f
Ym9fc3BsaXRfbWFwcGluZyAtIHNwbGl0IGEgbWFwcGluZyBpbnRvIHNtYWxsZXIgY2h1bmtzCi0g
KgotICogQGFkZXY6IGFtZGdwdV9kZXZpY2UgcG9pbnRlcgotICogQHJlc3Y6IGZlbmNlcyB3ZSBu
ZWVkIHRvIHN5bmMgdG8KLSAqIEBwYWdlc19hZGRyOiBETUEgYWRkcmVzc2VzIHRvIHVzZSBmb3Ig
bWFwcGluZwotICogQHZtOiByZXF1ZXN0ZWQgdm0KLSAqIEBtYXBwaW5nOiBtYXBwZWQgcmFuZ2Ug
YW5kIGZsYWdzIHRvIHVzZSBmb3IgdGhlIHVwZGF0ZQotICogQGZsYWdzOiBIVyBmbGFncyBmb3Ig
dGhlIG1hcHBpbmcKLSAqIEBib19hZGV2OiBhbWRncHVfZGV2aWNlIHBvaW50ZXIgdGhhdCBibyBh
Y3R1YWxseSBiZWVuIGFsbG9jYXRlZAotICogQG5vZGVzOiBhcnJheSBvZiBkcm1fbW1fbm9kZXMg
d2l0aCB0aGUgTUMgYWRkcmVzc2VzCi0gKiBAZmVuY2U6IG9wdGlvbmFsIHJlc3VsdGluZyBmZW5j
ZQotICoKLSAqIFNwbGl0IHRoZSBtYXBwaW5nIGludG8gc21hbGxlciBjaHVua3Mgc28gdGhhdCBl
YWNoIHVwZGF0ZSBmaXRzCi0gKiBpbnRvIGEgU0RNQSBJQi4KLSAqCi0gKiBSZXR1cm5zOgotICog
MCBmb3Igc3VjY2VzcywgLUVJTlZBTCBmb3IgZmFpbHVyZS4KLSAqLwotc3RhdGljIGludCBhbWRn
cHVfdm1fYm9fc3BsaXRfbWFwcGluZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKLQkJCQkg
ICAgICBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsCi0JCQkJICAgICAgZG1hX2FkZHJfdCAqcGFnZXNf
YWRkciwKLQkJCQkgICAgICBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKLQkJCQkgICAgICBzdHJ1Y3Qg
YW1kZ3B1X2JvX3ZhX21hcHBpbmcgKm1hcHBpbmcsCi0JCQkJICAgICAgdWludDY0X3QgZmxhZ3Ms
Ci0JCQkJICAgICAgc3RydWN0IGFtZGdwdV9kZXZpY2UgKmJvX2FkZXYsCi0JCQkJICAgICAgc3Ry
dWN0IGRybV9tbV9ub2RlICpub2RlcywKLQkJCQkgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICoqZmVu
Y2UpCi17Ci0JdW5zaWduZWQgbWluX2xpbmVhcl9wYWdlcyA9IDEgPDwgYWRldi0+dm1fbWFuYWdl
ci5mcmFnbWVudF9zaXplOwotCXVpbnQ2NF90IHBmbiwgc3RhcnQgPSBtYXBwaW5nLT5zdGFydDsK
LQlpbnQgcjsKLQotCS8qIG5vcm1hbGx5LGJvX3ZhLT5mbGFncyBvbmx5IGNvbnRpYW5zIFJFQURB
QkxFIGFuZCBXSVJURUFCTEUgYml0IGdvIGhlcmUKLQkgKiBidXQgaW4gY2FzZSBvZiBzb21ldGhp
bmcsIHdlIGZpbHRlciB0aGUgZmxhZ3MgaW4gZmlyc3QgcGxhY2UKLQkgKi8KLQlpZiAoIShtYXBw
aW5nLT5mbGFncyAmIEFNREdQVV9QVEVfUkVBREFCTEUpKQotCQlmbGFncyAmPSB+QU1ER1BVX1BU
RV9SRUFEQUJMRTsKLQlpZiAoIShtYXBwaW5nLT5mbGFncyAmIEFNREdQVV9QVEVfV1JJVEVBQkxF
KSkKLQkJZmxhZ3MgJj0gfkFNREdQVV9QVEVfV1JJVEVBQkxFOwotCi0JLyogQXBwbHkgQVNJQyBz
cGVjaWZpYyBtYXBwaW5nIGZsYWdzICovCi0JYW1kZ3B1X2dtY19nZXRfdm1fcHRlKGFkZXYsIG1h
cHBpbmcsICZmbGFncyk7Ci0KLQl0cmFjZV9hbWRncHVfdm1fYm9fdXBkYXRlKG1hcHBpbmcpOwot
Ci0JcGZuID0gbWFwcGluZy0+b2Zmc2V0ID4+IFBBR0VfU0hJRlQ7Ci0JaWYgKG5vZGVzKSB7Ci0J
CXdoaWxlIChwZm4gPj0gbm9kZXMtPnNpemUpIHsKLQkJCXBmbiAtPSBub2Rlcy0+c2l6ZTsKLQkJ
CSsrbm9kZXM7Ci0JCX0KLQl9Ci0KIAlkbyB7Ci0JCWRtYV9hZGRyX3QgKmRtYV9hZGRyID0gTlVM
TDsKLQkJdWludDY0X3QgbWF4X2VudHJpZXM7Ci0JCXVpbnQ2NF90IGFkZHIsIGxhc3Q7CisJCXVp
bnQ2NF90IHRtcCwgbnVtX2VudHJpZXMsIGFkZHI7CiAKLQkJbWF4X2VudHJpZXMgPSBtYXBwaW5n
LT5sYXN0IC0gc3RhcnQgKyAxOworCisJCW51bV9lbnRyaWVzID0gbGFzdCAtIHN0YXJ0ICsgMTsK
IAkJaWYgKG5vZGVzKSB7CiAJCQlhZGRyID0gbm9kZXMtPnN0YXJ0IDw8IFBBR0VfU0hJRlQ7Ci0J
CQltYXhfZW50cmllcyA9IG1pbigobm9kZXMtPnNpemUgLSBwZm4pICoKLQkJCQlBTURHUFVfR1BV
X1BBR0VTX0lOX0NQVV9QQUdFLCBtYXhfZW50cmllcyk7CisJCQludW1fZW50cmllcyA9IG1pbigo
bm9kZXMtPnNpemUgLSBwZm4pICoKKwkJCQlBTURHUFVfR1BVX1BBR0VTX0lOX0NQVV9QQUdFLCBu
dW1fZW50cmllcyk7CiAJCX0gZWxzZSB7CiAJCQlhZGRyID0gMDsKIAkJfQogCiAJCWlmIChwYWdl
c19hZGRyKSB7Ci0JCQl1aW50NjRfdCBjb3VudDsKKwkJCWJvb2wgY29udGlndW91cyA9IHRydWU7
CiAKLQkJCWZvciAoY291bnQgPSAxOwotCQkJICAgICBjb3VudCA8IG1heF9lbnRyaWVzIC8gQU1E
R1BVX0dQVV9QQUdFU19JTl9DUFVfUEFHRTsKLQkJCSAgICAgKytjb3VudCkgewotCQkJCXVpbnQ2
NF90IGlkeCA9IHBmbiArIGNvdW50OworCQkJaWYgKG51bV9lbnRyaWVzID4gQU1ER1BVX0dQVV9Q
QUdFU19JTl9DUFVfUEFHRSkgeworCQkJCXVpbnQ2NF90IGNvdW50OwogCi0JCQkJaWYgKHBhZ2Vz
X2FkZHJbaWR4XSAhPQotCQkJCSAgICAocGFnZXNfYWRkcltpZHggLSAxXSArIFBBR0VfU0laRSkp
Ci0JCQkJCWJyZWFrOworCQkJCWNvbnRpZ3VvdXMgPSBwYWdlc19hZGRyW3BmbiArIDFdID09CisJ
CQkJCXBhZ2VzX2FkZHJbcGZuXSArIFBBR0VfU0laRTsKKworCQkJCXRtcCA9IG51bV9lbnRyaWVz
IC8KKwkJCQkJQU1ER1BVX0dQVV9QQUdFU19JTl9DUFVfUEFHRTsKKwkJCQlmb3IgKGNvdW50ID0g
MjsgY291bnQgPCB0bXA7ICsrY291bnQpIHsKKwkJCQkJdWludDY0X3QgaWR4ID0gcGZuICsgY291
bnQ7CisKKwkJCQkJaWYgKGNvbnRpZ3VvdXMgIT0gKHBhZ2VzX2FkZHJbaWR4XSA9PQorCQkJCQkg
ICAgcGFnZXNfYWRkcltpZHggLSAxXSArIFBBR0VfU0laRSkpCisJCQkJCQlicmVhazsKKwkJCQl9
CisJCQkJbnVtX2VudHJpZXMgPSBjb3VudCAqCisJCQkJCUFNREdQVV9HUFVfUEFHRVNfSU5fQ1BV
X1BBR0U7CiAJCQl9CiAKLQkJCWlmIChjb3VudCA8IG1pbl9saW5lYXJfcGFnZXMpIHsKKwkJCWlm
ICghY29udGlndW91cykgewogCQkJCWFkZHIgPSBwZm4gPDwgUEFHRV9TSElGVDsKLQkJCQlkbWFf
YWRkciA9IHBhZ2VzX2FkZHI7CisJCQkJcGFyYW1zLnBhZ2VzX2FkZHIgPSBwYWdlc19hZGRyOwog
CQkJfSBlbHNlIHsKIAkJCQlhZGRyID0gcGFnZXNfYWRkcltwZm5dOwotCQkJCW1heF9lbnRyaWVz
ID0gY291bnQgKgotCQkJCQlBTURHUFVfR1BVX1BBR0VTX0lOX0NQVV9QQUdFOworCQkJCXBhcmFt
cy5wYWdlc19hZGRyID0gTlVMTDsKIAkJCX0KIAogCQl9IGVsc2UgaWYgKGZsYWdzICYgKEFNREdQ
VV9QVEVfVkFMSUQgfCBBTURHUFVfUFRFX1BSVCkpIHsKQEAgLTE3MzgsMjMgKzE2OTMsMjUgQEAg
c3RhdGljIGludCBhbWRncHVfdm1fYm9fc3BsaXRfbWFwcGluZyhzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwKIAkJCWFkZHIgKz0gcGZuIDw8IFBBR0VfU0hJRlQ7CiAJCX0KIAotCQlsYXN0ID0g
c3RhcnQgKyBtYXhfZW50cmllcyAtIDE7Ci0JCXIgPSBhbWRncHVfdm1fYm9fdXBkYXRlX21hcHBp
bmcoYWRldiwgdm0sIGZhbHNlLCBmYWxzZSwgcmVzdiwKLQkJCQkJCXN0YXJ0LCBsYXN0LCBmbGFn
cywgYWRkciwKLQkJCQkJCWRtYV9hZGRyLCBmZW5jZSk7CisJCXRtcCA9IHN0YXJ0ICsgbnVtX2Vu
dHJpZXM7CisJCXIgPSBhbWRncHVfdm1fdXBkYXRlX3B0ZXMoJnBhcmFtcywgc3RhcnQsIHRtcCwg
YWRkciwgZmxhZ3MpOwogCQlpZiAocikKLQkJCXJldHVybiByOworCQkJZ290byBlcnJvcl91bmxv
Y2s7CiAKLQkJcGZuICs9IChsYXN0IC0gc3RhcnQgKyAxKSAvIEFNREdQVV9HUFVfUEFHRVNfSU5f
Q1BVX1BBR0U7CisJCXBmbiArPSBudW1fZW50cmllcyAvIEFNREdQVV9HUFVfUEFHRVNfSU5fQ1BV
X1BBR0U7CiAJCWlmIChub2RlcyAmJiBub2Rlcy0+c2l6ZSA9PSBwZm4pIHsKIAkJCXBmbiA9IDA7
CiAJCQkrK25vZGVzOwogCQl9Ci0JCXN0YXJ0ID0gbGFzdCArIDE7CisJCXN0YXJ0ID0gdG1wOwog
Ci0JfSB3aGlsZSAodW5saWtlbHkoc3RhcnQgIT0gbWFwcGluZy0+bGFzdCArIDEpKTsKKwl9IHdo
aWxlICh1bmxpa2VseShzdGFydCAhPSBsYXN0ICsgMSkpOwogCi0JcmV0dXJuIDA7CisJciA9IHZt
LT51cGRhdGVfZnVuY3MtPmNvbW1pdCgmcGFyYW1zLCBmZW5jZSk7CisKK2Vycm9yX3VubG9jazoK
KwlhbWRncHVfdm1fZXZpY3Rpb25fdW5sb2NrKHZtKTsKKwlyZXR1cm4gcjsKIH0KIAogLyoqCkBA
IC0xODM1LDkgKzE3OTIsMjYgQEAgaW50IGFtZGdwdV92bV9ib191cGRhdGUoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfYm9fdmEgKmJvX3ZhLAogCX0KIAogCWxpc3Rf
Zm9yX2VhY2hfZW50cnkobWFwcGluZywgJmJvX3ZhLT5pbnZhbGlkcywgbGlzdCkgewotCQlyID0g
YW1kZ3B1X3ZtX2JvX3NwbGl0X21hcHBpbmcoYWRldiwgcmVzdiwgcGFnZXNfYWRkciwgdm0sCi0J
CQkJCSAgICAgICBtYXBwaW5nLCBmbGFncywgYm9fYWRldiwgbm9kZXMsCi0JCQkJCSAgICAgICBs
YXN0X3VwZGF0ZSk7CisJCXVpbnQ2NF90IHVwZGF0ZV9mbGFncyA9IGZsYWdzOworCisJCS8qIG5v
cm1hbGx5LGJvX3ZhLT5mbGFncyBvbmx5IGNvbnRpYW5zIFJFQURBQkxFIGFuZCBXSVJURUFCTEUg
Yml0IGdvIGhlcmUKKwkJICogYnV0IGluIGNhc2Ugb2Ygc29tZXRoaW5nLCB3ZSBmaWx0ZXIgdGhl
IGZsYWdzIGluIGZpcnN0IHBsYWNlCisJCSAqLworCQlpZiAoIShtYXBwaW5nLT5mbGFncyAmIEFN
REdQVV9QVEVfUkVBREFCTEUpKQorCQkJdXBkYXRlX2ZsYWdzICY9IH5BTURHUFVfUFRFX1JFQURB
QkxFOworCQlpZiAoIShtYXBwaW5nLT5mbGFncyAmIEFNREdQVV9QVEVfV1JJVEVBQkxFKSkKKwkJ
CXVwZGF0ZV9mbGFncyAmPSB+QU1ER1BVX1BURV9XUklURUFCTEU7CisKKwkJLyogQXBwbHkgQVNJ
QyBzcGVjaWZpYyBtYXBwaW5nIGZsYWdzICovCisJCWFtZGdwdV9nbWNfZ2V0X3ZtX3B0ZShhZGV2
LCBtYXBwaW5nLCAmdXBkYXRlX2ZsYWdzKTsKKworCQl0cmFjZV9hbWRncHVfdm1fYm9fdXBkYXRl
KG1hcHBpbmcpOworCisJCXIgPSBhbWRncHVfdm1fYm9fdXBkYXRlX21hcHBpbmcoYWRldiwgYm9f
YWRldiwgdm0sIGZhbHNlLCBmYWxzZSwKKwkJCQkJCXJlc3YsIG1hcHBpbmctPnN0YXJ0LAorCQkJ
CQkJbWFwcGluZy0+bGFzdCwgdXBkYXRlX2ZsYWdzLAorCQkJCQkJbWFwcGluZy0+b2Zmc2V0LCBu
b2RlcywKKwkJCQkJCXBhZ2VzX2FkZHIsIGxhc3RfdXBkYXRlKTsKIAkJaWYgKHIpCiAJCQlyZXR1
cm4gcjsKIAl9CkBAIC0yMDQ1LDkgKzIwMTksMTAgQEAgaW50IGFtZGdwdV92bV9jbGVhcl9mcmVl
ZChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJICAgIG1hcHBpbmctPnN0YXJ0IDwgQU1E
R1BVX0dNQ19IT0xFX1NUQVJUKQogCQkJaW5pdF9wdGVfdmFsdWUgPSBBTURHUFVfUFRFX0RFRkFV
TFRfQVRDOwogCi0JCXIgPSBhbWRncHVfdm1fYm9fdXBkYXRlX21hcHBpbmcoYWRldiwgdm0sIGZh
bHNlLCBmYWxzZSwgcmVzdiwKLQkJCQkJCW1hcHBpbmctPnN0YXJ0LCBtYXBwaW5nLT5sYXN0LAot
CQkJCQkJaW5pdF9wdGVfdmFsdWUsIDAsIE5VTEwsICZmKTsKKwkJciA9IGFtZGdwdV92bV9ib191
cGRhdGVfbWFwcGluZyhhZGV2LCBhZGV2LCB2bSwgZmFsc2UsIGZhbHNlLAorCQkJCQkJcmVzdiwg
bWFwcGluZy0+c3RhcnQsCisJCQkJCQltYXBwaW5nLT5sYXN0LCBpbml0X3B0ZV92YWx1ZSwKKwkJ
CQkJCTAsIE5VTEwsIE5VTEwsICZmKTsKIAkJYW1kZ3B1X3ZtX2ZyZWVfbWFwcGluZyhhZGV2LCB2
bSwgbWFwcGluZywgZik7CiAJCWlmIChyKSB7CiAJCQlkbWFfZmVuY2VfcHV0KGYpOwpAQCAtMzM3
NSw4ICszMzUwLDkgQEAgYm9vbCBhbWRncHVfdm1faGFuZGxlX2ZhdWx0KHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LCB1bnNpZ25lZCBpbnQgcGFzaWQsCiAJCXZhbHVlID0gMDsKIAl9CiAKLQly
ID0gYW1kZ3B1X3ZtX2JvX3VwZGF0ZV9tYXBwaW5nKGFkZXYsIHZtLCB0cnVlLCBmYWxzZSwgTlVM
TCwgYWRkciwKLQkJCQkJYWRkciArIDEsIGZsYWdzLCB2YWx1ZSwgTlVMTCwgTlVMTCk7CisJciA9
IGFtZGdwdV92bV9ib191cGRhdGVfbWFwcGluZyhhZGV2LCBhZGV2LCB2bSwgdHJ1ZSwgZmFsc2Us
IE5VTEwsIGFkZHIsCisJCQkJCWFkZHIgKyAxLCBmbGFncywgdmFsdWUsIE5VTEwsIE5VTEwsCisJ
CQkJCU5VTEwpOwogCWlmIChyKQogCQlnb3RvIGVycm9yX3VubG9jazsKIAotLSAKMi4xNy4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1h
aWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZngK
