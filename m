Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9EEBE69E1E
	for <lists+amd-gfx@lfdr.de>; Mon, 15 Jul 2019 23:25:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 74F0989EB4;
	Mon, 15 Jul 2019 21:25:26 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qk1-x742.google.com (mail-qk1-x742.google.com
 [IPv6:2607:f8b0:4864:20::742])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E565489E9E
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 21:25:24 +0000 (UTC)
Received: by mail-qk1-x742.google.com with SMTP id v22so12854312qkj.8
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 14:25:24 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=mxqwaYEWl7L3odD1wbO1Xxbve58dVoaWZ39nOOLfN9I=;
 b=AlLFdVJh9rQmgHMkJ/pOj22LprLZdav+iaPy010Kat3kJcBRotmMspEqYb8FdmaHIX
 88npAkUNsserkpBhrgHQciNSsX243i8D/RVsI//Hgw/r0ORNiQQcwr2IZ6qyeIvYy5NL
 VD1NhMUUBcOksW6WFBURBjN1V00jdeOom1ejYD+K60F5zmKknGma11bKvk8nV7S0MESr
 L8fkpFNLQokKAVD3ED3B5FKssjDxQCEfxA4Onlxne5riqLL0UGYe0ty/zDXsOTz43RBQ
 CbEcFstJAl21YF0pNoYTEc/YYnrV2MjpLjAYKsBIVbtY0OXNWfllhUfbvLqi/mj0uKYa
 DQ6A==
X-Gm-Message-State: APjAAAUbj+5Emnny+S4hLUNnhBPiDuXH31PaQxa+KRExIAd+y5mpf+Za
 TZpqAB7eAh1qEz5tAc3uY6IOLc7y
X-Google-Smtp-Source: APXvYqzyrprhfbHjNuQyeeQ/WXBn40e86UPoKgJevoQzpnbthHmA2SEJfcTxH2tJVz2js3YumrXYhA==
X-Received: by 2002:a37:81c2:: with SMTP id
 c185mr17575679qkd.365.1563225923164; 
 Mon, 15 Jul 2019 14:25:23 -0700 (PDT)
Received: from localhost.localdomain ([71.219.21.119])
 by smtp.gmail.com with ESMTPSA id q56sm10274133qtq.64.2019.07.15.14.25.22
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 15 Jul 2019 14:25:22 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 043/102] drm/amdkfd: Support bigger gds size
Date: Mon, 15 Jul 2019 16:23:38 -0500
Message-Id: <20190715212437.31793-41-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190715212437.31793-1-alexander.deucher@amd.com>
References: <20190715212437.31793-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=mxqwaYEWl7L3odD1wbO1Xxbve58dVoaWZ39nOOLfN9I=;
 b=gVsIZWdJMtUrH8XiTfjUdtsxlGx6tOa/FF+Oho6GrwOm19xh7+W0ejfzy06/BwSwnx
 EWoIL7PzqudhpYLaqp0lglNywkokmB/xZKJmEzYMt/r/Z0KjtT2zT819bbOa+aM/PB22
 zrElv6fJp+UHY2Nj7LHARgvSQxryZJ5ShOEBIpWd1CGoapQg4GfO0AQD0TtZX+ZuDxIA
 nFwhZbljeIi7r+2qTSLFMAaIMMVpWAF7Clxjow2Kw4RDevM3v1pW725SSx1RoQP/31o1
 dA/7jy3IaT/3AwevDYgBqklitS2mqNwhNtWHMjaZnZf5tLp0/OcnzAk2apbrYLcz8TxW
 +2kQ==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Oak Zeng <Oak.Zeng@amd.com>,
 Felix Kuehling <Felix.Kuehling@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogT2FrIFplbmcgPE9hay5aZW5nQGFtZC5jb20+CgpFeHRlbmQgbWFwX3Byb2Nlc3MgYW5k
IHNldF9yZXNvdXJjZXMgcG00IHBhY2tldCB0byBzdXBwb3J0CmJpZ2dlciBnZHMgc2l6ZSBmb3Ig
YXJjdHVydXMuCgp2MjogT25seSBtYWtlIHRoZSBjaGFuZ2UgZm9yIHY5CgpTaWduZWQtb2ZmLWJ5
OiBPYWsgWmVuZyA8T2FrLlplbmdAYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IEZlbGl4IEt1ZWhsaW5n
IDxGZWxpeC5LdWVobGluZ0BhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBBbGV4IERldWNoZXIgPGFs
ZXhhbmRlci5kZXVjaGVyQGFtZC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRf
a2VybmVsX3F1ZXVlX3Y5LmMgIHwgMzMgKysrKysrKysrKysrKysrKystLQogLi4uL2dwdS9kcm0v
YW1kL2FtZGtmZC9rZmRfcG00X2hlYWRlcnNfYWkuaCAgIHwgMTAgKysrLS0tCiAyIGZpbGVzIGNo
YW5nZWQsIDM2IGluc2VydGlvbnMoKyksIDcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2ZkX2tlcm5lbF9xdWV1ZV92OS5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRrZmQva2ZkX2tlcm5lbF9xdWV1ZV92OS5jCmluZGV4IDkxZGE3MmQwZDQw
NS4uOWE0YmFmYjJlMTc1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9r
ZmRfa2VybmVsX3F1ZXVlX3Y5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRrZmQva2Zk
X2tlcm5lbF9xdWV1ZV92OS5jCkBAIC04MSw3ICs4MSw4IEBAIHN0YXRpYyBpbnQgcG1fbWFwX3By
b2Nlc3Nfdjkoc3RydWN0IHBhY2tldF9tYW5hZ2VyICpwbSwKIAlwYWNrZXQtPmJpdGZpZWxkczIu
ZGlxX2VuYWJsZSA9IChxcGQtPmlzX2RlYnVnKSA/IDEgOiAwOwogCXBhY2tldC0+Yml0ZmllbGRz
Mi5wcm9jZXNzX3F1YW50dW0gPSAxOwogCXBhY2tldC0+Yml0ZmllbGRzMi5wYXNpZCA9IHFwZC0+
cHFtLT5wcm9jZXNzLT5wYXNpZDsKLQlwYWNrZXQtPmJpdGZpZWxkczE0Lmdkc19zaXplID0gcXBk
LT5nZHNfc2l6ZTsKKwlwYWNrZXQtPmJpdGZpZWxkczE0Lmdkc19zaXplID0gcXBkLT5nZHNfc2l6
ZSAmIDB4M0Y7CisJcGFja2V0LT5iaXRmaWVsZHMxNC5nZHNfc2l6ZV9oaSA9IChxcGQtPmdkc19z
aXplID4+IDYpICYgMHhGOwogCXBhY2tldC0+Yml0ZmllbGRzMTQubnVtX2d3cyA9IHFwZC0+bnVt
X2d3czsKIAlwYWNrZXQtPmJpdGZpZWxkczE0Lm51bV9vYWMgPSBxcGQtPm51bV9vYWM7CiAJcGFj
a2V0LT5iaXRmaWVsZHMxNC5zZG1hX2VuYWJsZSA9IDE7CkBAIC0xNDMsNiArMTQ0LDM0IEBAIHN0
YXRpYyBpbnQgcG1fcnVubGlzdF92OShzdHJ1Y3QgcGFja2V0X21hbmFnZXIgKnBtLCB1aW50MzJf
dCAqYnVmZmVyLAogCXJldHVybiAwOwogfQogCitzdGF0aWMgaW50IHBtX3NldF9yZXNvdXJjZXNf
djkoc3RydWN0IHBhY2tldF9tYW5hZ2VyICpwbSwgdWludDMyX3QgKmJ1ZmZlciwKKwkJCQlzdHJ1
Y3Qgc2NoZWR1bGluZ19yZXNvdXJjZXMgKnJlcykKK3sKKwlzdHJ1Y3QgcG00X21lc19zZXRfcmVz
b3VyY2VzICpwYWNrZXQ7CisKKwlwYWNrZXQgPSAoc3RydWN0IHBtNF9tZXNfc2V0X3Jlc291cmNl
cyAqKWJ1ZmZlcjsKKwltZW1zZXQoYnVmZmVyLCAwLCBzaXplb2Yoc3RydWN0IHBtNF9tZXNfc2V0
X3Jlc291cmNlcykpOworCisJcGFja2V0LT5oZWFkZXIudTMyQWxsID0gcG1fYnVpbGRfcG00X2hl
YWRlcihJVF9TRVRfUkVTT1VSQ0VTLAorCQkJCQlzaXplb2Yoc3RydWN0IHBtNF9tZXNfc2V0X3Jl
c291cmNlcykpOworCisJcGFja2V0LT5iaXRmaWVsZHMyLnF1ZXVlX3R5cGUgPQorCQkJcXVldWVf
dHlwZV9fbWVzX3NldF9yZXNvdXJjZXNfX2hzYV9pbnRlcmZhY2VfcXVldWVfaGlxOworCXBhY2tl
dC0+Yml0ZmllbGRzMi52bWlkX21hc2sgPSByZXMtPnZtaWRfbWFzazsKKwlwYWNrZXQtPmJpdGZp
ZWxkczIudW5tYXBfbGF0ZW5jeSA9IEtGRF9VTk1BUF9MQVRFTkNZX01TIC8gMTAwOworCXBhY2tl
dC0+Yml0ZmllbGRzNy5vYWNfbWFzayA9IHJlcy0+b2FjX21hc2s7CisJcGFja2V0LT5iaXRmaWVs
ZHM4Lmdkc19oZWFwX2Jhc2UgPSByZXMtPmdkc19oZWFwX2Jhc2U7CisJcGFja2V0LT5iaXRmaWVs
ZHM4Lmdkc19oZWFwX3NpemUgPSByZXMtPmdkc19oZWFwX3NpemU7CisKKwlwYWNrZXQtPmd3c19t
YXNrX2xvID0gbG93ZXJfMzJfYml0cyhyZXMtPmd3c19tYXNrKTsKKwlwYWNrZXQtPmd3c19tYXNr
X2hpID0gdXBwZXJfMzJfYml0cyhyZXMtPmd3c19tYXNrKTsKKworCXBhY2tldC0+cXVldWVfbWFz
a19sbyA9IGxvd2VyXzMyX2JpdHMocmVzLT5xdWV1ZV9tYXNrKTsKKwlwYWNrZXQtPnF1ZXVlX21h
c2tfaGkgPSB1cHBlcl8zMl9iaXRzKHJlcy0+cXVldWVfbWFzayk7CisKKwlyZXR1cm4gMDsKK30K
Kwogc3RhdGljIGludCBwbV9tYXBfcXVldWVzX3Y5KHN0cnVjdCBwYWNrZXRfbWFuYWdlciAqcG0s
IHVpbnQzMl90ICpidWZmZXIsCiAJCXN0cnVjdCBxdWV1ZSAqcSwgYm9vbCBpc19zdGF0aWMpCiB7
CkBAIC0zNDQsNyArMzczLDcgQEAgc3RhdGljIGludCBwbV9yZWxlYXNlX21lbV92OSh1aW50NjRf
dCBncHVfYWRkciwgdWludDMyX3QgKmJ1ZmZlcikKIGNvbnN0IHN0cnVjdCBwYWNrZXRfbWFuYWdl
cl9mdW5jcyBrZmRfdjlfcG1fZnVuY3MgPSB7CiAJLm1hcF9wcm9jZXNzCQk9IHBtX21hcF9wcm9j
ZXNzX3Y5LAogCS5ydW5saXN0CQk9IHBtX3J1bmxpc3RfdjksCi0JLnNldF9yZXNvdXJjZXMJCT0g
cG1fc2V0X3Jlc291cmNlc192aSwKKwkuc2V0X3Jlc291cmNlcwkJPSBwbV9zZXRfcmVzb3VyY2Vz
X3Y5LAogCS5tYXBfcXVldWVzCQk9IHBtX21hcF9xdWV1ZXNfdjksCiAJLnVubWFwX3F1ZXVlcwkJ
PSBwbV91bm1hcF9xdWV1ZXNfdjksCiAJLnF1ZXJ5X3N0YXR1cwkJPSBwbV9xdWVyeV9zdGF0dXNf
djksCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGtmZC9rZmRfcG00X2hlYWRl
cnNfYWkuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1ka2ZkL2tmZF9wbTRfaGVhZGVyc19haS5o
CmluZGV4IDQ0ZWQ5NDIzOTUxMy4uNGQ3YWRkODQzNzQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGtmZC9rZmRfcG00X2hlYWRlcnNfYWkuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGtmZC9rZmRfcG00X2hlYWRlcnNfYWkuaApAQCAtODMsMTAgKzgzLDEwIEBAIHN0
cnVjdCBwbTRfbWVzX3NldF9yZXNvdXJjZXMgewogCiAJdW5pb24gewogCQlzdHJ1Y3QgewotCQl1
aW50MzJfdCBnZHNfaGVhcF9iYXNlOjY7Ci0JCXVpbnQzMl90IHJlc2VydmVkMzo1OwotCQl1aW50
MzJfdCBnZHNfaGVhcF9zaXplOjY7Ci0JCXVpbnQzMl90IHJlc2VydmVkNDoxNTsKKwkJdWludDMy
X3QgZ2RzX2hlYXBfYmFzZToxMDsKKwkJdWludDMyX3QgcmVzZXJ2ZWQzOjE7CisJCXVpbnQzMl90
IGdkc19oZWFwX3NpemU6MTA7CisJCXVpbnQzMl90IHJlc2VydmVkNDoxMTsKIAkJfSBiaXRmaWVs
ZHM4OwogCQl1aW50MzJfdCBvcmRpbmFsODsKIAl9OwpAQCAtMTc5LDcgKzE3OSw3IEBAIHN0cnVj
dCBwbTRfbWVzX21hcF9wcm9jZXNzIHsKIAkJCXVpbnQzMl90IG51bV9nd3M6NzsKIAkJCXVpbnQz
Ml90IHNkbWFfZW5hYmxlOjE7CiAJCQl1aW50MzJfdCBudW1fb2FjOjQ7Ci0JCQl1aW50MzJfdCBy
ZXNlcnZlZDg6NDsKKwkJCXVpbnQzMl90IGdkc19zaXplX2hpOjQ7CiAJCQl1aW50MzJfdCBnZHNf
c2l6ZTo2OwogCQkJdWludDMyX3QgbnVtX3F1ZXVlczoxMDsKIAkJfSBiaXRmaWVsZHMxNDsKLS0g
CjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
YW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
