Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C08CC331577
	for <lists+amd-gfx@lfdr.de>; Mon,  8 Mar 2021 19:06:54 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 897716E084;
	Mon,  8 Mar 2021 18:06:52 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-ed1-x52a.google.com (mail-ed1-x52a.google.com
 [IPv6:2a00:1450:4864:20::52a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EF0F76E084
 for <amd-gfx@lists.freedesktop.org>; Mon,  8 Mar 2021 18:06:51 +0000 (UTC)
Received: by mail-ed1-x52a.google.com with SMTP id h10so16105911edl.6
 for <amd-gfx@lists.freedesktop.org>; Mon, 08 Mar 2021 10:06:51 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=3oexb5yptvUCt94W8ToUl1ALO14d+z/lLbMJT4AXdAk=;
 b=OTuv8CrLCGfv7zD1nGnTNjwe0zGOfjddYHA7delMGT2QmHVKviufht8mCoQ0tgzNpu
 4NS4k7ZNOcj62ftl1HQzTmS+x0ZW4agducsVdx6vZ7gLh5UVfQzFueW5ZBZWPxB2JgPl
 aUGTSL9vVaXio2cEBVjnC/tbdLIDZA+l9xz9fhJPWorZp1RS2+UtD3LIiuVGzug2ZczH
 siLgnx+7ZryX6QGXmeMWOY+OZfEzpUoP06HWtsPVsC2zvS9urEk3FqNlQiIA4719lodW
 2KxHTKLlaxlFHPr80lmApQ9s7uX2t19gAM4iY4KViH9Yq7ZLPWp5zEHB7paxaMO73Qd3
 noQA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=3oexb5yptvUCt94W8ToUl1ALO14d+z/lLbMJT4AXdAk=;
 b=dvvrP2HldmmLCTpPWIAAmyNsDLInLI6b8lcWWyy6iozyukazaoXoeXfz8wlsqA1KPq
 K5phT1sH1NktKtQhd4zijPuGZQbgdNh/BMy5wL46UjxFPbUNhZAjUMg2i/6bqnFf7xtU
 DbNX4rT3DtJHAQV7yu8OxRpV9OrA+v0loUk1o0H8Z8x4efzKZM7sQ3R+4seTmJh0QKH0
 9rcbQ1Au2aAJKRKkQcYmDo0ubpR1YowBOTSIcGWLDR328tKu5sqcbcJPOsADK1RU7C1S
 35f8biX5KUaLBGyHBO3PXSCXM5heNOllWSo0qZ/7viMCL3LZeoUEVDxoudavqvt9VocC
 PA3w==
X-Gm-Message-State: AOAM5313XAQ8X/uHFPFkuGa3y9edoJ/ImhwvCoDfdNV44NFjLWomorb2
 +dukOhqK5N4d3/0gwQZuqcZhCJ0oLCd7GQ==
X-Google-Smtp-Source: ABdhPJwNS0bS90Xpwt3m+z6VnTjm07t9Z3ZJH8FQVGqeqkv8OH9SBQcchR8OK6s21fW4xBRe3fMrvA==
X-Received: by 2002:a05:6402:b70:: with SMTP id
 cb16mr23340035edb.11.1615226810623; 
 Mon, 08 Mar 2021 10:06:50 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:5f05:a903:d4af:1240])
 by smtp.gmail.com with ESMTPSA id g11sm3142295edt.35.2021.03.08.10.06.49
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 08 Mar 2021 10:06:50 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH] drm/amdgpu: capture invalid hardware access v2
Date: Mon,  8 Mar 2021 19:06:49 +0100
Message-Id: <20210308180649.2117-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
MIME-Version: 1.0
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: andrey.grodzovsky@amd.com, Dennis.Li@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGVubmlzIExpIDxEZW5uaXMuTGlAYW1kLmNvbT4KCldoZW4gcmVjb3ZlcnkgdGhyZWFk
IGhhcyBiZWd1biBHUFUgcmVzZXQsIHRoZXJlIHNob3VsZCBiZSBub3Qgb3RoZXIKdGhyZWFkcyB0
byBhY2Nlc3MgaGFyZHdhcmUsIG90aGVyd2lzZSBzeXN0ZW0gcmFuZG9tbHkgaGFuZy4KCnYyIChj
aGspOiByZXdyaXR0ZW4gZnJvbSBzY3JhdGNoLCB1c2UgdHJ5bG9jayBhbmQgbG9ja2RlcCBpbnN0
ZWFkIG9mCgkgIGhhbmQgd2lyaW5nIHRoZSBsb2dpYy4KClNpZ25lZC1vZmYtYnk6IERlbm5pcyBM
aSA8RGVubmlzLkxpQGFtZC5jb20+ClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNo
cmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZGV2aWNlLmMgfCA3NCArKysrKysrKysrKysrKysrKy0tLS0tCiAxIGZpbGUgY2hhbmdl
ZCwgNTcgaW5zZXJ0aW9ucygrKSwgMTcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCmluZGV4IGUyNDdjM2EyZWMwOC4uYzk5MGFmNmE0M2Nh
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCkBAIC0zMjYs
NiArMzI2LDM0IEBAIHZvaWQgYW1kZ3B1X2RldmljZV92cmFtX2FjY2VzcyhzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiwgbG9mZl90IHBvcywKIC8qCiAgKiByZWdpc3RlciBhY2Nlc3MgaGVscGVy
IGZ1bmN0aW9ucy4KICAqLworCisvKiBDaGVjayBpZiBodyBhY2Nlc3Mgc2hvdWxkIGJlIHNraXBw
ZWQgYmVjYXVzZSBvZiBob3RwbHVnIG9yIGRldmljZSBlcnJvciAqLworc3RhdGljIGJvb2wgYW1k
Z3B1X2RldmljZV9za2lwX2h3X2FjY2VzcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKK3sK
KwlpZiAoYWRldi0+aW5fcGNpX2Vycl9yZWNvdmVyeSkKKwkJcmV0dXJuIHRydWU7CisKKyNpZmRl
ZiBDT05GSUdfTE9DS0RFUAorCS8qCisJICogVGhpcyBpcyBhIGJpdCBjb21wbGljYXRlZCB0byB1
bmRlcnN0YW5kLCBzbyB3b3J0aCBhIGNvbW1lbnQuIFdoYXQgd2UgYXNzZXJ0CisJICogaGVyZSBp
cyB0aGF0IHRoZSBHUFUgcmVzZXQgaXMgbm90IHJ1bm5pbmcgb24gYW5vdGhlciB0aHJlYWQgaW4g
cGFyYWxsZWwuCisJICoKKwkgKiBGb3IgdGhpcyB3ZSB0cnlsb2NrIHRoZSByZWFkIHNpZGUgb2Yg
dGhlIHJlc2V0IHNlbWFwaG9yZSwgaWYgdGhhdCBzdWNjZWVkcworCSAqIHdlIGtub3cgdGhhdCB0
aGUgcmVzZXQgaXMgbm90IHJ1bm5pbmcgaW4gcGFyYWxlbGwuCisJICoKKwkgKiBJZiB0aGUgdHJ5
bG9jayBmYWlscyB3ZSBhc3NlcnQgdGhhdCB3ZSBhcmUgZWl0aGVyIGFscmVhZHkgaG9sZGluZyB0
aGUgcmVhZAorCSAqIHNpZGUgb2YgdGhlIGxvY2sgb3IgYXJlIHRoZSByZXNldCB0aHJlYWQgaXRz
ZWxmIGFuZCBob2xkIHRoZSB3cml0ZSBzaWRlIG9mCisJICogdGhlIGxvY2suCisJICovCisJaWYg
KGRvd25fcmVhZF90cnlsb2NrKCZhZGV2LT5yZXNldF9zZW0pKQorCQl1cF9yZWFkKCZhZGV2LT5y
ZXNldF9zZW0pOworCWVsc2UKKwkJbG9ja2RlcF9hc3NlcnRfaGVsZCgmYWRldi0+cmVzZXRfc2Vt
KTsKKyNlbmRpZgorCisJcmV0dXJuIGZhbHNlOworfQorCiAvKioKICAqIGFtZGdwdV9kZXZpY2Vf
cnJlZyAtIHJlYWQgYSBtZW1vcnkgbWFwcGVkIElPIG9yIGluZGlyZWN0IHJlZ2lzdGVyCiAgKgpA
QCAtMzQwLDcgKzM2OCw3IEBAIHVpbnQzMl90IGFtZGdwdV9kZXZpY2VfcnJlZyhzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKIHsKIAl1aW50MzJfdCByZXQ7CiAKLQlpZiAoYWRldi0+aW5fcGNp
X2Vycl9yZWNvdmVyeSkKKwlpZiAoYW1kZ3B1X2RldmljZV9za2lwX2h3X2FjY2VzcyhhZGV2KSkK
IAkJcmV0dXJuIDA7CiAKIAlpZiAoKHJlZyAqIDQpIDwgYWRldi0+cm1taW9fc2l6ZSkgewpAQCAt
Mzc3LDcgKzQwNSw3IEBAIHVpbnQzMl90IGFtZGdwdV9kZXZpY2VfcnJlZyhzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiwKICAqLwogdWludDhfdCBhbWRncHVfbW1fcnJlZzgoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IG9mZnNldCkKIHsKLQlpZiAoYWRldi0+aW5fcGNpX2Vy
cl9yZWNvdmVyeSkKKwlpZiAoYW1kZ3B1X2RldmljZV9za2lwX2h3X2FjY2VzcyhhZGV2KSkKIAkJ
cmV0dXJuIDA7CiAKIAlpZiAob2Zmc2V0IDwgYWRldi0+cm1taW9fc2l6ZSkKQEAgLTQwMiw3ICs0
MzAsNyBAQCB1aW50OF90IGFtZGdwdV9tbV9ycmVnOChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
diwgdWludDMyX3Qgb2Zmc2V0KQogICovCiB2b2lkIGFtZGdwdV9tbV93cmVnOChzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwgdWludDMyX3Qgb2Zmc2V0LCB1aW50OF90IHZhbHVlKQogewotCWlm
IChhZGV2LT5pbl9wY2lfZXJyX3JlY292ZXJ5KQorCWlmIChhbWRncHVfZGV2aWNlX3NraXBfaHdf
YWNjZXNzKGFkZXYpKQogCQlyZXR1cm47CiAKIAlpZiAob2Zmc2V0IDwgYWRldi0+cm1taW9fc2l6
ZSkKQEAgLTQyNSw3ICs0NTMsNyBAQCB2b2lkIGFtZGdwdV9kZXZpY2Vfd3JlZyhzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKIAkJCXVpbnQzMl90IHJlZywgdWludDMyX3QgdiwKIAkJCXVpbnQz
Ml90IGFjY19mbGFncykKIHsKLQlpZiAoYWRldi0+aW5fcGNpX2Vycl9yZWNvdmVyeSkKKwlpZiAo
YW1kZ3B1X2RldmljZV9za2lwX2h3X2FjY2VzcyhhZGV2KSkKIAkJcmV0dXJuOwogCiAJaWYgKChy
ZWcgKiA0KSA8IGFkZXYtPnJtbWlvX3NpemUpIHsKQEAgLTQ1Miw3ICs0ODAsNyBAQCB2b2lkIGFt
ZGdwdV9kZXZpY2Vfd3JlZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIHZvaWQgYW1kZ3B1
X21tX3dyZWdfbW1pb19ybGMoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkgICAgIHVp
bnQzMl90IHJlZywgdWludDMyX3QgdikKIHsKLQlpZiAoYWRldi0+aW5fcGNpX2Vycl9yZWNvdmVy
eSkKKwlpZiAoYW1kZ3B1X2RldmljZV9za2lwX2h3X2FjY2VzcyhhZGV2KSkKIAkJcmV0dXJuOwog
CiAJaWYgKGFtZGdwdV9zcmlvdl9mdWxsYWNjZXNzKGFkZXYpICYmCkBAIC00NzUsNyArNTAzLDcg
QEAgdm9pZCBhbWRncHVfbW1fd3JlZ19tbWlvX3JsYyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
diwKICAqLwogdTMyIGFtZGdwdV9pb19ycmVnKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1
MzIgcmVnKQogewotCWlmIChhZGV2LT5pbl9wY2lfZXJyX3JlY292ZXJ5KQorCWlmIChhbWRncHVf
ZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQogCQlyZXR1cm4gMDsKIAogCWlmICgocmVnICog
NCkgPCBhZGV2LT5yaW9fbWVtX3NpemUpCkBAIC00OTcsNyArNTI1LDcgQEAgdTMyIGFtZGdwdV9p
b19ycmVnKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgcmVnKQogICovCiB2b2lkIGFt
ZGdwdV9pb193cmVnKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgcmVnLCB1MzIgdikK
IHsKLQlpZiAoYWRldi0+aW5fcGNpX2Vycl9yZWNvdmVyeSkKKwlpZiAoYW1kZ3B1X2RldmljZV9z
a2lwX2h3X2FjY2VzcyhhZGV2KSkKIAkJcmV0dXJuOwogCiAJaWYgKChyZWcgKiA0KSA8IGFkZXYt
PnJpb19tZW1fc2l6ZSkKQEAgLTUxOSw3ICs1NDcsNyBAQCB2b2lkIGFtZGdwdV9pb193cmVnKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgcmVnLCB1MzIgdikKICAqLwogdTMyIGFtZGdw
dV9tbV9yZG9vcmJlbGwoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiBpbmRleCkKIHsK
LQlpZiAoYWRldi0+aW5fcGNpX2Vycl9yZWNvdmVyeSkKKwlpZiAoYW1kZ3B1X2RldmljZV9za2lw
X2h3X2FjY2VzcyhhZGV2KSkKIAkJcmV0dXJuIDA7CiAKIAlpZiAoaW5kZXggPCBhZGV2LT5kb29y
YmVsbC5udW1fZG9vcmJlbGxzKSB7CkBAIC01NDIsNyArNTcwLDcgQEAgdTMyIGFtZGdwdV9tbV9y
ZG9vcmJlbGwoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiBpbmRleCkKICAqLwogdm9p
ZCBhbWRncHVfbW1fd2Rvb3JiZWxsKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgaW5k
ZXgsIHUzMiB2KQogewotCWlmIChhZGV2LT5pbl9wY2lfZXJyX3JlY292ZXJ5KQorCWlmIChhbWRn
cHVfZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQogCQlyZXR1cm47CiAKIAlpZiAoaW5kZXgg
PCBhZGV2LT5kb29yYmVsbC5udW1fZG9vcmJlbGxzKSB7CkBAIC01NjMsNyArNTkxLDcgQEAgdm9p
ZCBhbWRncHVfbW1fd2Rvb3JiZWxsKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgaW5k
ZXgsIHUzMiB2KQogICovCiB1NjQgYW1kZ3B1X21tX3Jkb29yYmVsbDY0KHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LCB1MzIgaW5kZXgpCiB7Ci0JaWYgKGFkZXYtPmluX3BjaV9lcnJfcmVjb3Zl
cnkpCisJaWYgKGFtZGdwdV9kZXZpY2Vfc2tpcF9od19hY2Nlc3MoYWRldikpCiAJCXJldHVybiAw
OwogCiAJaWYgKGluZGV4IDwgYWRldi0+ZG9vcmJlbGwubnVtX2Rvb3JiZWxscykgewpAQCAtNTg2
LDcgKzYxNCw3IEBAIHU2NCBhbWRncHVfbW1fcmRvb3JiZWxsNjQoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsIHUzMiBpbmRleCkKICAqLwogdm9pZCBhbWRncHVfbW1fd2Rvb3JiZWxsNjQoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHUzMiBpbmRleCwgdTY0IHYpCiB7Ci0JaWYgKGFkZXYt
PmluX3BjaV9lcnJfcmVjb3ZlcnkpCisJaWYgKGFtZGdwdV9kZXZpY2Vfc2tpcF9od19hY2Nlc3Mo
YWRldikpCiAJCXJldHVybjsKIAogCWlmIChpbmRleCA8IGFkZXYtPmRvb3JiZWxsLm51bV9kb29y
YmVsbHMpIHsKQEAgLTYxMCwxMCArNjM4LDEzIEBAIHUzMiBhbWRncHVfZGV2aWNlX2luZGlyZWN0
X3JyZWcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkJdTMyIHBjaWVfaW5kZXgsIHUz
MiBwY2llX2RhdGEsCiAJCQkJdTMyIHJlZ19hZGRyKQogewotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7
Ci0JdTMyIHI7CiAJdm9pZCBfX2lvbWVtICpwY2llX2luZGV4X29mZnNldDsKIAl2b2lkIF9faW9t
ZW0gKnBjaWVfZGF0YV9vZmZzZXQ7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKwl1MzIgcjsKKwor
CWlmIChhbWRncHVfZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQorCQlyZXR1cm4gMDsKIAog
CXNwaW5fbG9ja19pcnFzYXZlKCZhZGV2LT5wY2llX2lkeF9sb2NrLCBmbGFncyk7CiAJcGNpZV9p
bmRleF9vZmZzZXQgPSAodm9pZCBfX2lvbWVtICopYWRldi0+cm1taW8gKyBwY2llX2luZGV4ICog
NDsKQEAgLTY0MSwxMCArNjcyLDEzIEBAIHU2NCBhbWRncHVfZGV2aWNlX2luZGlyZWN0X3JyZWc2
NChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCQkgIHUzMiBwY2llX2luZGV4LCB1MzIg
cGNpZV9kYXRhLAogCQkJCSAgdTMyIHJlZ19hZGRyKQogewotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7
Ci0JdTY0IHI7CiAJdm9pZCBfX2lvbWVtICpwY2llX2luZGV4X29mZnNldDsKIAl2b2lkIF9faW9t
ZW0gKnBjaWVfZGF0YV9vZmZzZXQ7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKwl1NjQgcjsKKwor
CWlmIChhbWRncHVfZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQorCQlyZXR1cm4gMDsKIAog
CXNwaW5fbG9ja19pcnFzYXZlKCZhZGV2LT5wY2llX2lkeF9sb2NrLCBmbGFncyk7CiAJcGNpZV9p
bmRleF9vZmZzZXQgPSAodm9pZCBfX2lvbWVtICopYWRldi0+cm1taW8gKyBwY2llX2luZGV4ICog
NDsKQEAgLTY3Nyw5ICs3MTEsMTIgQEAgdm9pZCBhbWRncHVfZGV2aWNlX2luZGlyZWN0X3dyZWco
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkJIHUzMiBwY2llX2luZGV4LCB1MzIgcGNp
ZV9kYXRhLAogCQkJCSB1MzIgcmVnX2FkZHIsIHUzMiByZWdfZGF0YSkKIHsKLQl1bnNpZ25lZCBs
b25nIGZsYWdzOwogCXZvaWQgX19pb21lbSAqcGNpZV9pbmRleF9vZmZzZXQ7CiAJdm9pZCBfX2lv
bWVtICpwY2llX2RhdGFfb2Zmc2V0OworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlpZiAoYW1k
Z3B1X2RldmljZV9za2lwX2h3X2FjY2VzcyhhZGV2KSkKKwkJcmV0dXJuOwogCiAJc3Bpbl9sb2Nr
X2lycXNhdmUoJmFkZXYtPnBjaWVfaWR4X2xvY2ssIGZsYWdzKTsKIAlwY2llX2luZGV4X29mZnNl
dCA9ICh2b2lkIF9faW9tZW0gKilhZGV2LT5ybW1pbyArIHBjaWVfaW5kZXggKiA0OwpAQCAtNzA2
LDkgKzc0MywxMiBAQCB2b2lkIGFtZGdwdV9kZXZpY2VfaW5kaXJlY3Rfd3JlZzY0KHN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2LAogCQkJCSAgIHUzMiBwY2llX2luZGV4LCB1MzIgcGNpZV9kYXRh
LAogCQkJCSAgIHUzMiByZWdfYWRkciwgdTY0IHJlZ19kYXRhKQogewotCXVuc2lnbmVkIGxvbmcg
ZmxhZ3M7CiAJdm9pZCBfX2lvbWVtICpwY2llX2luZGV4X29mZnNldDsKIAl2b2lkIF9faW9tZW0g
KnBjaWVfZGF0YV9vZmZzZXQ7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCWlmIChhbWRncHVf
ZGV2aWNlX3NraXBfaHdfYWNjZXNzKGFkZXYpKQorCQlyZXR1cm47CiAKIAlzcGluX2xvY2tfaXJx
c2F2ZSgmYWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOwogCXBjaWVfaW5kZXhfb2Zmc2V0ID0g
KHZvaWQgX19pb21lbSAqKWFkZXYtPnJtbWlvICsgcGNpZV9pbmRleCAqIDQ7Ci0tIAoyLjI1LjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZngg
bWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeAo=
