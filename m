Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 334A657456
	for <lists+amd-gfx@lfdr.de>; Thu, 27 Jun 2019 00:35:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CBACC6E53E;
	Wed, 26 Jun 2019 22:35:28 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-io1-xd43.google.com (mail-io1-xd43.google.com
 [IPv6:2607:f8b0:4864:20::d43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 642DD6E53E
 for <amd-gfx@lists.freedesktop.org>; Wed, 26 Jun 2019 22:35:28 +0000 (UTC)
Received: by mail-io1-xd43.google.com with SMTP id i10so292986iol.13
 for <amd-gfx@lists.freedesktop.org>; Wed, 26 Jun 2019 15:35:28 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=HnQ1OwrteAlwlJ5S12fe5/iQmZ8KLR00YUGdEnxDs38=;
 b=Cf2Ijemt8HEl7eK8q3jzGjrqwx+1hLw0HQNybupD6oc/uTvX0tFFiqWcB0wz92HtWn
 t2XecV4Zl+Z9CUplLssk/stw10vd1F8Us+Ums9E5Vz2Xgpb5pPqrlvh43/319TjkGkpq
 A25HxDtrreb3LZg2Im13nxi6jMSk2nW/EAPaw/UJCLvBJJDLtBuvYGi/Uf6t8BK2dxAd
 hI/W5hrJCttIRY1ywFFTWs/aW4gJ+L0v4eA1i5Y9A+W0wYtrxj6P2vQCVPO1GwKc95XM
 kNGH7dpLTNxjOh9N4Aktx4iApr4WXLY2rAakhnqz3cP/r2+DpivlYGl/KUAKc6+QthWN
 zmnQ==
X-Gm-Message-State: APjAAAXTyfvJDSU0C4Z09Du584zOWhZQmy+XEP9zjNLBo3Blm4o0EUFP
 mBpV76aqVgqVVzMk08RNiZBOzkSG
X-Google-Smtp-Source: APXvYqwczco/5ihlELjvFBVpw1/1G9/IcVxlP6fdSFzrJ67zvx5ShDex2abBmjH5sb4HURJdIGHugQ==
X-Received: by 2002:a6b:7401:: with SMTP id s1mr636778iog.67.1561588527466;
 Wed, 26 Jun 2019 15:35:27 -0700 (PDT)
Received: from crimson.amd.com ([165.204.55.251])
 by smtp.gmail.com with ESMTPSA id l5sm237544ioq.83.2019.06.26.15.35.26
 for <amd-gfx@lists.freedesktop.org>
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Wed, 26 Jun 2019 15:35:26 -0700 (PDT)
From: =?UTF-8?q?Marek=20Ol=C5=A1=C3=A1k?= <maraeo@gmail.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 1/2] drm/amdgpu: fix transform feedback GDS hang on gfx10 (v2)
Date: Wed, 26 Jun 2019 18:35:20 -0400
Message-Id: <20190626223521.14347-1-maraeo@gmail.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=HnQ1OwrteAlwlJ5S12fe5/iQmZ8KLR00YUGdEnxDs38=;
 b=ueK6WGOA3qO7YofREAA7lr83p1OQn/aBnEzrLPe9PgbZM4OljXoXjY7GjbAxMgr0bm
 9cleHU7q1jM8eXIZ+V8BoYlMkXYSdBw6vFyTJViERJTiAS3v/1dlPpUvYzpq70Z7repG
 ZCIp33ej3oO/PW65VrtdmeT2sMrzCX4ymKQh2U3uzN7jI0/MZ40lzgoqksmqrRtk5cUi
 BWQFD8UNbNjT8/KYixpG/oUdke6EWZRdPwT9JHwONliq3oGmKiB0K5b/P9WbH+KfBah4
 /YLpFTUhWmXn2ZjZXbt87zs8bbZlLbo0Vv1uo95mq+AcXVqddn5iz5oVkNLRDtOK36Po
 7e4A==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogTWFyZWsgT2zFocOhayA8bWFyZWsub2xzYWtAYW1kLmNvbT4KCnYyOiB1cGRhdGUgZW1p
dF9pYl9zaXplCih0aG91Z2ggaXQncyBzdGlsbCB3cm9uZyBiZWNhdXNlIGl0IHdhcyB3cm9uZyBi
ZWZvcmUpCgpTaWduZWQtb2ZmLWJ5OiBNYXJlayBPbMWhw6FrIDxtYXJlay5vbHNha0BhbWQuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nZHMuaCB8ICAzICsrLQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3YxMF8wLmMgIHwgMTQgKysrKysrKysrKyst
LS0KIDIgZmlsZXMgY2hhbmdlZCwgMTMgaW5zZXJ0aW9ucygrKSwgNCBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2RzLmggYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2RzLmgKaW5kZXggZGFkMjE4NmY0ZWQ1Li5k
ZjhhMjM1NTQ4MzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9nZHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2RzLmgKQEAg
LTI0LDIxICsyNCwyMiBAQAogI2lmbmRlZiBfX0FNREdQVV9HRFNfSF9fCiAjZGVmaW5lIF9fQU1E
R1BVX0dEU19IX18KIAogc3RydWN0IGFtZGdwdV9yaW5nOwogc3RydWN0IGFtZGdwdV9ibzsKIAog
c3RydWN0IGFtZGdwdV9nZHMgewogCXVpbnQzMl90IGdkc19zaXplOwogCXVpbnQzMl90IGd3c19z
aXplOwogCXVpbnQzMl90IG9hX3NpemU7Ci0JdWludDMyX3QJCQlnZHNfY29tcHV0ZV9tYXhfd2F2
ZV9pZDsKKwl1aW50MzJfdCBnZHNfY29tcHV0ZV9tYXhfd2F2ZV9pZDsKKwl1aW50MzJfdCB2Z3Rf
Z3NfbWF4X3dhdmVfaWQ7CiB9OwogCiBzdHJ1Y3QgYW1kZ3B1X2dkc19yZWdfb2Zmc2V0IHsKIAl1
aW50MzJfdAltZW1fYmFzZTsKIAl1aW50MzJfdAltZW1fc2l6ZTsKIAl1aW50MzJfdAlnd3M7CiAJ
dWludDMyX3QJb2E7CiB9OwogCiAjZW5kaWYgLyogX19BTURHUFVfR0RTX0hfXyAqLwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3YxMF8wLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9nZnhfdjEwXzAuYwppbmRleCAxNmIyYmNjNTkwZTcuLjZiYWFhNjVh
MWRhYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3YxMF8wLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3YxMF8wLmMKQEAgLTQyMTEsMjAg
KzQyMTEsMjkgQEAgc3RhdGljIHZvaWQgZ2Z4X3YxMF8wX3JpbmdfZW1pdF9oZHBfZmx1c2goc3Ry
dWN0IGFtZGdwdV9yaW5nICpyaW5nKQogfQogCiBzdGF0aWMgdm9pZCBnZnhfdjEwXzBfcmluZ19l
bWl0X2liX2dmeChzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsCiAJCQkJICAgICAgIHN0cnVjdCBh
bWRncHVfam9iICpqb2IsCiAJCQkJICAgICAgIHN0cnVjdCBhbWRncHVfaWIgKmliLAogCQkJCSAg
ICAgICB1aW50MzJfdCBmbGFncykKIHsKIAl1bnNpZ25lZCB2bWlkID0gQU1ER1BVX0pPQl9HRVRf
Vk1JRChqb2IpOwogCXUzMiBoZWFkZXIsIGNvbnRyb2wgPSAwOwogCisJLyogUHJldmVudCBhIGh3
IGRlYWRsb2NrIGR1ZSB0byBhIHdhdmUgSUQgbWlzbWF0Y2ggYmV0d2VlbiBNRSBhbmQgR0RTLgor
CSAqIFRoaXMgcmVzZXRzIHRoZSB3YXZlIElEIGNvdW50ZXJzLiAobmVlZGVkIGJ5IHRyYW5zZm9y
bSBmZWVkYmFjaykKKwkgKiBUT0RPOiBUaGlzIG1pZ2h0IG9ubHkgYmUgbmVlZGVkIG9uIGEgVk1J
RCBzd2l0Y2ggd2hlbiB3ZSBjaGFuZ2UKKwkgKiAgICAgICB0aGUgR0RTIE9BIG1hcHBpbmcsIG5v
dCBzdXJlLgorCSAqLworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIFBBQ0tFVDMoUEFDS0VUM19T
RVRfQ09ORklHX1JFRywgMSkpOworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIG1tVkdUX0dTX01B
WF9XQVZFX0lEKTsKKwlhbWRncHVfcmluZ193cml0ZShyaW5nLCByaW5nLT5hZGV2LT5nZHMudmd0
X2dzX21heF93YXZlX2lkKTsKKwogCWlmIChpYi0+ZmxhZ3MgJiBBTURHUFVfSUJfRkxBR19DRSkK
IAkJaGVhZGVyID0gUEFDS0VUMyhQQUNLRVQzX0lORElSRUNUX0JVRkZFUl9DTlNULCAyKTsKIAll
bHNlCiAJCWhlYWRlciA9IFBBQ0tFVDMoUEFDS0VUM19JTkRJUkVDVF9CVUZGRVIsIDIpOwogCiAJ
Y29udHJvbCB8PSBpYi0+bGVuZ3RoX2R3IHwgKHZtaWQgPDwgMjQpOwogCiAJaWYgKGFtZGdwdV9t
Y2JwICYmIChpYi0+ZmxhZ3MgJiBBTURHUFVfSUJfRkxBR19QUkVFTVBUKSkgewogCQljb250cm9s
IHw9IElORElSRUNUX0JVRkZFUl9QUkVfRU5CKDEpOwogCkBAIC00OTQ0LDIxICs0OTUzLDIxIEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgYW1kZ3B1X3JpbmdfZnVuY3MgZ2Z4X3YxMF8wX3JpbmdfZnVu
Y3NfZ2Z4ID0gewogCQkgICAgICovCiAJCTUgKyAvKiBDT05EX0VYRUMgKi8KIAkJNyArIC8qIEhE
UF9mbHVzaCAqLwogCQk0ICsgLyogVkdUX2ZsdXNoICovCiAJCTE0ICsgLyoJQ0VfTUVUQSAqLwog
CQkzMSArIC8qCURFX01FVEEgKi8KIAkJMyArIC8qIENOVFhfQ1RSTCAqLwogCQk1ICsgLyogSERQ
X0lOVkwgKi8KIAkJOCArIDggKyAvKiBGRU5DRSB4MiAqLwogCQkyLCAvKiBTV0lUQ0hfQlVGRkVS
ICovCi0JLmVtaXRfaWJfc2l6ZSA9CTQsIC8qIGdmeF92MTBfMF9yaW5nX2VtaXRfaWJfZ2Z4ICov
CisJLmVtaXRfaWJfc2l6ZSA9CTcsIC8qIGdmeF92MTBfMF9yaW5nX2VtaXRfaWJfZ2Z4ICovCiAJ
LmVtaXRfaWIgPSBnZnhfdjEwXzBfcmluZ19lbWl0X2liX2dmeCwKIAkuZW1pdF9mZW5jZSA9IGdm
eF92MTBfMF9yaW5nX2VtaXRfZmVuY2UsCiAJLmVtaXRfcGlwZWxpbmVfc3luYyA9IGdmeF92MTBf
MF9yaW5nX2VtaXRfcGlwZWxpbmVfc3luYywKIAkuZW1pdF92bV9mbHVzaCA9IGdmeF92MTBfMF9y
aW5nX2VtaXRfdm1fZmx1c2gsCiAJLmVtaXRfZ2RzX3N3aXRjaCA9IGdmeF92MTBfMF9yaW5nX2Vt
aXRfZ2RzX3N3aXRjaCwKIAkuZW1pdF9oZHBfZmx1c2ggPSBnZnhfdjEwXzBfcmluZ19lbWl0X2hk
cF9mbHVzaCwKIAkudGVzdF9yaW5nID0gZ2Z4X3YxMF8wX3JpbmdfdGVzdF9yaW5nLAogCS50ZXN0
X2liID0gZ2Z4X3YxMF8wX3JpbmdfdGVzdF9pYiwKIAkuaW5zZXJ0X25vcCA9IGFtZGdwdV9yaW5n
X2luc2VydF9ub3AsCiAJLnBhZF9pYiA9IGFtZGdwdV9yaW5nX2dlbmVyaWNfcGFkX2liLApAQCAt
NTA5MiwyNCArNTEwMSwyMyBAQCBzdGF0aWMgdm9pZCBnZnhfdjEwXzBfc2V0X3JsY19mdW5jcyhz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAlkZWZhdWx0OgogCQlicmVhazsKIAl9CiB9CiAK
IHN0YXRpYyB2b2lkIGdmeF92MTBfMF9zZXRfZ2RzX2luaXQoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYpCiB7CiAJLyogaW5pdCBhc2ljIGdkcyBpbmZvICovCiAJc3dpdGNoIChhZGV2LT5hc2lj
X3R5cGUpIHsKIAljYXNlIENISVBfTkFWSTEwOgotCQlhZGV2LT5nZHMuZ2RzX3NpemUgPSAweDEw
MDAwOwotCQlicmVhazsKIAlkZWZhdWx0OgogCQlhZGV2LT5nZHMuZ2RzX3NpemUgPSAweDEwMDAw
OworCQlhZGV2LT5nZHMudmd0X2dzX21heF93YXZlX2lkID0gMHgzZmY7CiAJCWJyZWFrOwogCX0K
IAogCWFkZXYtPmdkcy5nd3Nfc2l6ZSA9IDY0OwogCWFkZXYtPmdkcy5vYV9zaXplID0gMTY7CiB9
CiAKIHN0YXRpYyB2b2lkIGdmeF92MTBfMF9zZXRfdXNlcl93Z3BfaW5hY3RpdmVfYml0bWFwX3Bl
cl9zaChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCQkJCQkgIHUzMiBiaXRtYXApCiB7
Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
