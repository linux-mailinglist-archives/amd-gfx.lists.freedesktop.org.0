Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8161C15F1E
	for <lists+amd-gfx@lfdr.de>; Tue,  7 May 2019 10:15:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 01CC789F8E;
	Tue,  7 May 2019 08:15:24 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-wr1-x441.google.com (mail-wr1-x441.google.com
 [IPv6:2a00:1450:4864:20::441])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 286F989F43
 for <amd-gfx@lists.freedesktop.org>; Tue,  7 May 2019 08:15:22 +0000 (UTC)
Received: by mail-wr1-x441.google.com with SMTP id d12so466813wrm.8
 for <amd-gfx@lists.freedesktop.org>; Tue, 07 May 2019 01:15:22 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=gxQ3w1R6HQmo9Z8W5Uw7WnWlMm9zfwwEdw2W0/d9RIk=;
 b=syHlQ4RHQpJ5T3fj3GVz2FjblpTQ9ZDp4ePlZgwsk6kKHG4iavkqPo+w4q89rQuyKe
 L17DDZGxZX2Ab+QlsstMfjkh8f34KujDzkqZZHg2vrFBJ4S85AsSjZYlNh+PP5SS5JbK
 skT7Nbp4gdCEHZgfyokQulS+Bk9Ri/tnMQhvuOJk/wUYnh/AiGqYlKul4P+PnIk4L3ve
 4uyZbdmneSxySjLmTQyIeD+Ili0l8j/1SOHMYxEM6W1g7hgGsK0Udzj9OncnrOVMlez0
 1mcURUZ2hTnLhq2SqVmkUPXPSnrhZt/U2aeiJ5JqDLzFAXFM73WPVymjS1MzENmE7M3v
 GjvQ==
X-Gm-Message-State: APjAAAWdRBdyelf1PAeP5mt7qHELfizo26CXh/9PbjhJLi/VetutDiqG
 7BlhyNNw++ncFkoaE/mR2PC2JbEr
X-Google-Smtp-Source: APXvYqw2uesqorTZKYLGsLh71eJ1+04jfSEq96yaSRJlN5OMvFFcYjCCZTLDvrUQv377F3sl3gW+yA==
X-Received: by 2002:a5d:50c7:: with SMTP id f7mr12674714wrt.95.1557216920298; 
 Tue, 07 May 2019 01:15:20 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:c572:e952:8ef0:ace])
 by smtp.gmail.com with ESMTPSA id v16sm15065476wru.76.2019.05.07.01.15.19
 for <amd-gfx@lists.freedesktop.org>
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Tue, 07 May 2019 01:15:19 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 8/9] drm/amdgpu: add independent DMA-buf import v5
Date: Tue,  7 May 2019 10:15:11 +0200
Message-Id: <20190507081512.2619-8-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190507081512.2619-1-christian.koenig@amd.com>
References: <20190507081512.2619-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=gxQ3w1R6HQmo9Z8W5Uw7WnWlMm9zfwwEdw2W0/d9RIk=;
 b=e7nmwoqO8bO3JiMCTdap/GjLolhPGZnG2RHEoQsvg5iNImySoTLtzwkcFX5mpEWGXF
 7S1ZzGUMzHpe/bdXnLquEsvEoPWJqw4GLh+tJ6XBIndh/AyXF9x8V+s/pRj+XMCsYVbn
 +NU4+bVsL4cd3MYpDgRdF5MsN7KE0NjNPQRPAFYvl8N7FPVuy13909hVFkguGOiFh6oG
 bkRi62dL3h6SnmC0bUj5DtL/C1tWK7ZHVqUDkw//BbhMx3HS0S8eoi68MJzP/ARjX72g
 9U+TdpuNQEviny2A/vyLjj3GGqW6RvtVeFoxobdzx4jhLVvDh7XfM67A9UbIOkaDbJII
 hOTQ==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiByZWx5aW5nIG9uIHRoZSBEUk0gZnVuY3Rpb25zIGp1c3QgaW1wbGVtZW50IG91
ciBvd24gaW1wb3J0CmZ1bmN0aW9ucy4gVGhpcyBwcmVwYXJlcyBzdXBwb3J0IGZvciB0YWtpbmcg
Y2FyZSBvZiB1bnBpbm5lZCBETUEtYnVmLgoKdjI6IGVuYWJsZSBmb3IgYWxsIGV4cG9ydGVycywg
bm90IGp1c3QgYW1kZ3B1LCBmaXggaW52YWxpZGF0aW9uCiAgICBoYW5kbGluZywgbG9jayByZXNl
cnZhdGlvbiBvYmplY3Qgd2hpbGUgc2V0dGluZyBjYWxsYmFjawp2MzogY2hhbmdlIHRvIG5ldyBk
bWFfYnVmIGF0dGFjaCBpbnRlcmZhY2UKdjQ6IHNwbGl0IG91dCBmcm9tIHVucGlubmVkIERNQS1i
dWYgd29yawp2NTogcmViYXNlZCBhbmQgY2xlYW51cCBvbiBuZXcgRE1BLWJ1ZiBpbnRlcmZhY2UK
ClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jIHwgMzgg
KysrKysrKysrKysrKy0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZG1hX2J1Zi5oIHwgIDQgLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2
LmMgICAgIHwgIDEgLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jICAg
ICB8IDM0ICsrKysrKysrKysrKysrKy0tLQogNCBmaWxlcyBjaGFuZ2VkLCA1MiBpbnNlcnRpb25z
KCspLCAyNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZG1hX2J1Zi5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2RtYV9idWYuYwppbmRleCA2OGEwNzEwNjA3OTMuLjBmNGZlMjFkMWIyYiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jCkBAIC00MjAsMzEgKzQyMCwyOCBA
QCBzdHJ1Y3QgZG1hX2J1ZiAqYW1kZ3B1X2dlbV9wcmltZV9leHBvcnQoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIH0KIAogLyoqCi0gKiBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSAt
ICZkcm1fZHJpdmVyLmdlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUKLSAqIGltcGxlbWVudGF0aW9u
CisgKiBhbWRncHVfZG1hX2J1Zl9jcmVhdGVfb2JqIC0gY3JlYXRlIEJPIGZvciBETUEtYnVmIGlt
cG9ydAorICoKICAqIEBkZXY6IERSTSBkZXZpY2UKLSAqIEBhdHRhY2g6IERNQS1idWYgYXR0YWNo
bWVudAotICogQHNnOiBTY2F0dGVyL2dhdGhlciB0YWJsZQorICogQGRtYV9idWY6IERNQS1idWYK
ICAqCi0gKiBJbXBvcnRzIHNoYXJlZCBETUEgYnVmZmVyIG1lbW9yeSBleHBvcnRlZCBieSBhbm90
aGVyIGRldmljZS4KKyAqIENyZWF0ZXMgYW4gZW1wdHkgU0cgQk8gZm9yIERNQS1idWYgaW1wb3J0
LgogICoKICAqIFJldHVybnM6CiAgKiBBIG5ldyBHRU0gQk8gb2YgdGhlIGdpdmVuIERSTSBkZXZp
Y2UsIHJlcHJlc2VudGluZyB0aGUgbWVtb3J5CiAgKiBkZXNjcmliZWQgYnkgdGhlIGdpdmVuIERN
QS1idWYgYXR0YWNobWVudCBhbmQgc2NhdHRlci9nYXRoZXIgdGFibGUuCiAgKi8KLXN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqCi1hbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZShzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAotCQkJCSBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gs
Ci0JCQkJIHN0cnVjdCBzZ190YWJsZSAqc2cpCitzdGF0aWMgc3RydWN0IGRybV9nZW1fb2JqZWN0
ICoKK2FtZGdwdV9kbWFfYnVmX2NyZWF0ZV9vYmooc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3Ry
dWN0IGRtYV9idWYgKmRtYV9idWYpCiB7Ci0Jc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVz
diA9IGF0dGFjaC0+ZG1hYnVmLT5yZXN2OworCXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgKnJl
c3YgPSBkbWFfYnVmLT5yZXN2OwogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gZGV2LT5k
ZXZfcHJpdmF0ZTsKIAlzdHJ1Y3QgYW1kZ3B1X2JvICpibzsKIAlzdHJ1Y3QgYW1kZ3B1X2JvX3Bh
cmFtIGJwOwogCWludCByZXQ7CiAKIAltZW1zZXQoJmJwLCAwLCBzaXplb2YoYnApKTsKLQlicC5z
aXplID0gYXR0YWNoLT5kbWFidWYtPnNpemU7CisJYnAuc2l6ZSA9IGRtYV9idWYtPnNpemU7CiAJ
YnAuYnl0ZV9hbGlnbiA9IFBBR0VfU0laRTsKIAlicC5kb21haW4gPSBBTURHUFVfR0VNX0RPTUFJ
Tl9DUFU7CiAJYnAuZmxhZ3MgPSAwOwpAQCAtNDU1LDExICs0NTIsOSBAQCBhbWRncHVfZ2VtX3By
aW1lX2ltcG9ydF9zZ190YWJsZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCWlmIChyZXQpCiAJ
CWdvdG8gZXJyb3I7CiAKLQliby0+dGJvLnNnID0gc2c7Ci0JYm8tPnRiby50dG0tPnNnID0gc2c7
CiAJYm8tPmFsbG93ZWRfZG9tYWlucyA9IEFNREdQVV9HRU1fRE9NQUlOX0dUVDsKIAliby0+cHJl
ZmVycmVkX2RvbWFpbnMgPSBBTURHUFVfR0VNX0RPTUFJTl9HVFQ7Ci0JaWYgKGF0dGFjaC0+ZG1h
YnVmLT5vcHMgIT0gJmFtZGdwdV9kbWFidWZfb3BzKQorCWlmIChkbWFfYnVmLT5vcHMgIT0gJmFt
ZGdwdV9kbWFidWZfb3BzKQogCQliby0+cHJpbWVfc2hhcmVkX2NvdW50ID0gMTsKIAogCXd3X211
dGV4X3VubG9jaygmcmVzdi0+bG9jayk7CkBAIC00ODQsNiArNDc5LDcgQEAgYW1kZ3B1X2dlbV9w
cmltZV9pbXBvcnRfc2dfdGFibGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIHN0cnVjdCBkcm1f
Z2VtX29iamVjdCAqYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnQoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwKIAkJCQkJICAgIHN0cnVjdCBkbWFfYnVmICpkbWFfYnVmKQogeworCXN0cnVjdCBkbWFfYnVm
X2F0dGFjaG1lbnQgKmF0dGFjaDsKIAlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iajsKIAogCWlm
IChkbWFfYnVmLT5vcHMgPT0gJmFtZGdwdV9kbWFidWZfb3BzKSB7CkBAIC00OTgsNSArNDk0LDE3
IEBAIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnQoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKIAkJfQogCX0KIAotCXJldHVybiBkcm1fZ2VtX3ByaW1lX2ltcG9y
dChkZXYsIGRtYV9idWYpOworCW9iaiA9IGFtZGdwdV9kbWFfYnVmX2NyZWF0ZV9vYmooZGV2LCBk
bWFfYnVmKTsKKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBvYmo7CisKKwlhdHRhY2ggPSBk
bWFfYnVmX2F0dGFjaChkbWFfYnVmLCBkZXYtPmRldik7CisJaWYgKElTX0VSUihhdHRhY2gpKSB7
CisJCWRybV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJSX0NBU1QoYXR0YWNoKTsK
Kwl9CisKKwlnZXRfZG1hX2J1ZihkbWFfYnVmKTsKKwlvYmotPmltcG9ydF9hdHRhY2ggPSBhdHRh
Y2g7CisJcmV0dXJuIG9iajsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kbWFfYnVmLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZG1hX2J1Zi5oCmluZGV4IGYxNTIyMjkyODE0Yy4uMjc2NTQxMzc3MGI5IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmgKQEAgLTI1LDEwICsyNSw2IEBACiAK
ICNpbmNsdWRlIDxkcm0vZHJtX2dlbS5oPgogCi1zdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKgotYW1k
Z3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJ
CQkgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLAotCQkJCSBzdHJ1Y3Qgc2dfdGFi
bGUgKnNnKTsKIHN0cnVjdCBkbWFfYnVmICphbWRncHVfZ2VtX3ByaW1lX2V4cG9ydChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAogCQkJCQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdvYmosCiAJCQkJ
CWludCBmbGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKaW5kZXgg
NzBjNWNkMmQ1ZmI0Li40N2ZmMjk4MWQ4NzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZHJ2LmMKQEAgLTEzMjEsNyArMTMyMSw2IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2RyaXZl
ciBrbXNfZHJpdmVyID0gewogCS5nZW1fcHJpbWVfZXhwb3J0ID0gYW1kZ3B1X2dlbV9wcmltZV9l
eHBvcnQsCiAJLmdlbV9wcmltZV9pbXBvcnQgPSBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydCwKIAku
Z2VtX3ByaW1lX3Jlc19vYmogPSBhbWRncHVfZ2VtX3ByaW1lX3Jlc19vYmosCi0JLmdlbV9wcmlt
ZV9pbXBvcnRfc2dfdGFibGUgPSBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSwKIAku
Z2VtX3ByaW1lX3ZtYXAgPSBhbWRncHVfZ2VtX3ByaW1lX3ZtYXAsCiAJLmdlbV9wcmltZV92dW5t
YXAgPSBhbWRncHVfZ2VtX3ByaW1lX3Z1bm1hcCwKIAkuZ2VtX3ByaW1lX21tYXAgPSBhbWRncHVf
Z2VtX3ByaW1lX21tYXAsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKaW5k
ZXggYzE0MTk4NzM3ZGNkLi5hZmNjY2E1YjFmNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfdHRtLmMKQEAgLTQ0LDYgKzQ0LDcgQEAKICNpbmNsdWRlIDxsaW51eC9kZWJ1Z2Zz
Lmg+CiAjaW5jbHVkZSA8bGludXgvaW9tbXUuaD4KICNpbmNsdWRlIDxsaW51eC9obW0uaD4KKyNp
bmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CiAjaW5jbHVkZSAiYW1kZ3B1LmgiCiAjaW5jbHVkZSAi
YW1kZ3B1X29iamVjdC5oIgogI2luY2x1ZGUgImFtZGdwdV90cmFjZS5oIgpAQCAtNzA2LDYgKzcw
Nyw3IEBAIHN0YXRpYyB1bnNpZ25lZCBsb25nIGFtZGdwdV90dG1faW9fbWVtX3BmbihzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogICovCiBzdHJ1Y3QgYW1kZ3B1X3R0bV90dCB7CiAJc3Ry
dWN0IHR0bV9kbWFfdHQJdHRtOworCXN0cnVjdCBkcm1fZ2VtX29iamVjdAkqZ29iajsKIAl1NjQJ
CQlvZmZzZXQ7CiAJdWludDY0X3QJCXVzZXJwdHI7CiAJc3RydWN0IHRhc2tfc3RydWN0CSp1c2Vy
dGFzazsKQEAgLTExNzksNiArMTE4MSw3IEBAIHN0YXRpYyBzdHJ1Y3QgdHRtX3R0ICphbWRncHVf
dHRtX3R0X2NyZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCQlyZXR1cm4gTlVM
TDsKIAl9CiAJZ3R0LT50dG0udHRtLmZ1bmMgPSAmYW1kZ3B1X2JhY2tlbmRfZnVuYzsKKwlndHQt
PmdvYmogPSAmdHRtX3RvX2FtZGdwdV9ibyhibyktPmdlbV9iYXNlOwogCiAJLyogYWxsb2NhdGUg
c3BhY2UgZm9yIHRoZSB1bmluaXRpYWxpemVkIHBhZ2UgZW50cmllcyAqLwogCWlmICh0dG1fc2df
dHRfaW5pdCgmZ3R0LT50dG0sIGJvLCBwYWdlX2ZsYWdzKSkgewpAQCAtMTE5OSw3ICsxMjAyLDYg
QEAgc3RhdGljIGludCBhbWRncHVfdHRtX3R0X3BvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSwK
IHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGFtZGdwdV90dG1fYWRldih0dG0tPmJk
ZXYpOwogCXN0cnVjdCBhbWRncHVfdHRtX3R0ICpndHQgPSAodm9pZCAqKXR0bTsKLQlib29sIHNs
YXZlID0gISEodHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19TRyk7CiAKIAkvKiB1c2Vy
IHBhZ2VzIGFyZSBib3VuZCBieSBhbWRncHVfdHRtX3R0X3Bpbl91c2VycHRyKCkgKi8KIAlpZiAo
Z3R0ICYmIGd0dC0+dXNlcnB0cikgewpAQCAtMTIxMiw3ICsxMjE0LDIwIEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X3R0bV90dF9wb3B1bGF0ZShzdHJ1Y3QgdHRtX3R0ICp0dG0sCiAJCXJldHVybiAwOwog
CX0KIAotCWlmIChzbGF2ZSAmJiB0dG0tPnNnKSB7CisJaWYgKHR0bS0+cGFnZV9mbGFncyAmIFRU
TV9QQUdFX0ZMQUdfU0cpIHsKKwkJaWYgKCF0dG0tPnNnKSB7CisJCQlzdHJ1Y3QgZG1hX2J1Zl9h
dHRhY2htZW50ICphdHRhY2g7CisJCQlzdHJ1Y3Qgc2dfdGFibGUgKnNndDsKKworCQkJYXR0YWNo
ID0gZ3R0LT5nb2JqLT5pbXBvcnRfYXR0YWNoOworCQkJc2d0ID0gZG1hX2J1Zl9tYXBfYXR0YWNo
bWVudF9sb2NrZWQoYXR0YWNoLAorCQkJCQkJCSAgICBETUFfQklESVJFQ1RJT05BTCk7CisJCQlp
ZiAoSVNfRVJSKHNndCkpCisJCQkJcmV0dXJuIFBUUl9FUlIoc2d0KTsKKworCQkJdHRtLT5zZyA9
IHNndDsKKwkJfQorCiAJCWRybV9wcmltZV9zZ190b19wYWdlX2FkZHJfYXJyYXlzKHR0bS0+c2cs
IHR0bS0+cGFnZXMsCiAJCQkJCQkgZ3R0LT50dG0uZG1hX2FkZHJlc3MsCiAJCQkJCQkgdHRtLT5u
dW1fcGFnZXMpOwpAQCAtMTIzOSw5ICsxMjU0LDggQEAgc3RhdGljIGludCBhbWRncHVfdHRtX3R0
X3BvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSwKICAqLwogc3RhdGljIHZvaWQgYW1kZ3B1X3R0
bV90dF91bnBvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSkKIHsKLQlzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldjsKIAlzdHJ1Y3QgYW1kZ3B1X3R0bV90dCAqZ3R0ID0gKHZvaWQgKil0dG07Ci0J
Ym9vbCBzbGF2ZSA9ICEhKHR0bS0+cGFnZV9mbGFncyAmIFRUTV9QQUdFX0ZMQUdfU0cpOworCXN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2OwogCiAJaWYgKGd0dCAmJiBndHQtPnVzZXJwdHIpIHsK
IAkJYW1kZ3B1X3R0bV90dF9zZXRfdXNlcl9wYWdlcyh0dG0sIE5VTEwpOwpAQCAtMTI1MCw3ICsx
MjY0LDE3IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV90dG1fdHRfdW5wb3B1bGF0ZShzdHJ1Y3QgdHRt
X3R0ICp0dG0pCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoc2xhdmUpCisJaWYgKHR0bS0+c2cgJiYg
Z3R0LT5nb2JqLT5pbXBvcnRfYXR0YWNoKSB7CisJCXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQg
KmF0dGFjaDsKKworCQlhdHRhY2ggPSBndHQtPmdvYmotPmltcG9ydF9hdHRhY2g7CisJCWRtYV9i
dWZfdW5tYXBfYXR0YWNobWVudF9sb2NrZWQoYXR0YWNoLCB0dG0tPnNnLAorCQkJCQkJRE1BX0JJ
RElSRUNUSU9OQUwpOworCQl0dG0tPnNnID0gTlVMTDsKKwkJcmV0dXJuOworCX0KKworCWlmICh0
dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX1NHKQogCQlyZXR1cm47CiAKIAlhZGV2ID0g
YW1kZ3B1X3R0bV9hZGV2KHR0bS0+YmRldik7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBsaXN0CmFtZC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
