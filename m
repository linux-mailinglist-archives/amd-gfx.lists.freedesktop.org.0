Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 82A90E7B99
	for <lists+amd-gfx@lfdr.de>; Mon, 28 Oct 2019 22:43:48 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E85846EAAC;
	Mon, 28 Oct 2019 21:43:46 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-yb1-xb43.google.com (mail-yb1-xb43.google.com
 [IPv6:2607:f8b0:4864:20::b43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 42AEC6EAAC
 for <amd-gfx@lists.freedesktop.org>; Mon, 28 Oct 2019 21:43:45 +0000 (UTC)
Received: by mail-yb1-xb43.google.com with SMTP id q143so4622827ybg.12
 for <amd-gfx@lists.freedesktop.org>; Mon, 28 Oct 2019 14:43:45 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Zq27KxaTxmtstlOCSE4K4tPBxG7thhuuXBs3cHKpcy0=;
 b=dBIflTDpf3WI6e2eIhDsSJXquzCRgJp1LjAhBgMVu1HPzgNWQfdy35uXiewLo6MDIH
 901lmH/f4D8MrBbXc7H67GiiOdF+ux/7iLKj7FdSbbmV1pIcZ10ZrdKSU8wr73e8sLTL
 9zH9tT8N5eY0DNqOCLitMgebIWvuePs+Cftiy2a0gHE4g6cZzi/ZhnOVaNpMwWZ9+BpZ
 +haTptl1E/vxz1bqTICBGMxI9GzKuea056vRU4hsiXr3VGOdeAVXQ2oHD05heMRe/EJL
 SfUIyJZIwEX9/KhbYK26/k5xAhVUTG+oyvvVBba3o3m8hgF9lPUYSVIEnus5xX207kz+
 n05g==
X-Gm-Message-State: APjAAAUFY2x0h0B2COk09SiUj5ccParKIBlsc5578Lb6/icgJBTreBZk
 bJ/PmnG1d7ygGMvvxGURzt6SXydLouE=
X-Google-Smtp-Source: APXvYqwpkfHFuhRh+KxDdhtW7m7HcfNCAhYbRT29Y8l/CCp/CTQcCrmA9pTM8vF4QRR62JUwhumRLw==
X-Received: by 2002:a25:8502:: with SMTP id w2mr1477826ybk.505.1572299024162; 
 Mon, 28 Oct 2019 14:43:44 -0700 (PDT)
Received: from tr4.amd.com (atlvpn.amd.com. [165.204.84.11])
 by smtp.gmail.com with ESMTPSA id l68sm3421090ywf.95.2019.10.28.14.43.38
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 28 Oct 2019 14:43:43 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org, alsa-devel@alsa-project.org, tiwai@suse.de,
 lukas@wunner.de
Subject: [PATCH 14/21] drm/amdgpu: start to disentangle boco from runtime pm
Date: Mon, 28 Oct 2019 17:42:09 -0400
Message-Id: <20191028214216.1508370-15-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191028214216.1508370-1-alexander.deucher@amd.com>
References: <20191028214216.1508370-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=Zq27KxaTxmtstlOCSE4K4tPBxG7thhuuXBs3cHKpcy0=;
 b=I7GuFVs5opcvn7ciPCzreSvnTnjCt4NQuQXN0whdRVOozdFPAy2vpR/LdFxs0C/5qm
 TnI1K/cGS8PnqVdHtWDQh1/M962fV7AjATd8iKeIZ3pnj/eobOqgG5AUyO9Wnu3iP+bp
 6kJHQ+MI1hBiJjyprDi1beRHBl/Eb1YuRJwWQB7ppqi1wYbkH5tXtgVKvF3CocjGm5Fh
 /W6Y57OIfmZt2pT8DHXvTPhMfyV6Iq3fpUj1xX2uzr628GvabihnqhmlY+C03lAy1cBo
 hNAa9Pv0Ose132aCRAMhqKfug1Mqi/EPLWBxzwM393rjUUex4nJzt4K1wHvzZx/vmzXH
 aTBQ==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>, Evan Quan <evan.quan@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

QkFDTyAtIEJ1cyBBY3RpdmUsIENoaXAgT2ZmCkJPQ08gLSBCdXMgT2ZmLCBDaGlwIE9mZgoKV2Ug
b3JpZ2luYWxseSBvbmx5IHN1cHBvcnRlZCBydW50aW1lIHBtIG9uIFBYL0hHCmxhcHRvcHMgc28g
bW9zdCBvZiB0aGUgcnVudGltZSBwbSBjb2RlIGxvb2tzIGZvciB0aGlzLgpBZGQgYSBuZXcgZmxh
ZyB0byBjaGVjayBmb3IgcnVudGltZSBwbSBlbmFibGVtZW50IGFuZAp1c2UgdGhpcyByYXRoZXIg
dGhhbiBjaGVja2luZyBmb3IgUFgvSEcuCgpSZXZpZXdlZC1ieTogRXZhbiBRdWFuIDxldmFuLnF1
YW5AYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogQWxleCBEZXVjaGVyIDxhbGV4YW5kZXIuZGV1Y2hl
ckBhbWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdS5oICAgICB8
ICAzICsrKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jIHwgIDkgKysr
KysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMgfCAxMyArKysr
KysrKy0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDE3IGluc2VydGlvbnMoKyksIDggZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmggYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaAppbmRleCBmMmI5NzE0ZTdlMGMuLmZm
MmY2NmJmNTMxYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmgKQEAgLTk4NSw2ICs5
ODUsOSBAQCBzdHJ1Y3QgYW1kZ3B1X2RldmljZSB7CiAKIAl1aW50NjRfdAkJCXVuaXF1ZV9pZDsK
IAl1aW50NjRfdAlkZl9wZXJmbW9uX2NvbmZpZ19hc3NpZ25fbWFza1tBTURHUFVfTUFYX0RGX1BF
UkZNT05TXTsKKworCS8qIGVuYWJsZSBydW50aW1lIHBtIG9uIHRoZSBkZXZpY2UgKi8KKwlib29s
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bnBtOwogfTsKIAogc3RhdGljIGlubGluZSBz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYW1kZ3B1X3R0bV9hZGV2KHN0cnVjdCB0dG1fYm9fZGV2aWNl
ICpiZGV2KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Ry
di5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCmluZGV4IDg0OTc4
NGUyN2E5OC4uOTQxYTdmMmE4MTQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2Rydi5jCkBAIC0xMjExLDkgKzEyMTEsMTAgQEAgc3RhdGljIGludCBhbWRncHVfcG1vcHNfcnVu
dGltZV9zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldikKIHsKIAlzdHJ1Y3QgcGNpX2RldiAqcGRl
diA9IHRvX3BjaV9kZXYoZGV2KTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtX2RldiA9IHBjaV9n
ZXRfZHJ2ZGF0YShwZGV2KTsKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRybV9kZXYt
PmRldl9wcml2YXRlOwogCWludCByZXQ7CiAKLQlpZiAoIWFtZGdwdV9kZXZpY2Vfc3VwcG9ydHNf
Ym9jbyhkcm1fZGV2KSkgeworCWlmICghYWRldi0+cnVucG0pIHsKIAkJcG1fcnVudGltZV9mb3Ji
aWQoZGV2KTsKIAkJcmV0dXJuIC1FQlVTWTsKIAl9CkBAIC0xMjQzLDkgKzEyNDQsMTAgQEAgc3Rh
dGljIGludCBhbWRncHVfcG1vcHNfcnVudGltZV9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KQog
ewogCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gdG9fcGNpX2RldihkZXYpOwogCXN0cnVjdCBkcm1f
ZGV2aWNlICpkcm1fZGV2ID0gcGNpX2dldF9kcnZkYXRhKHBkZXYpOworCXN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2ID0gZHJtX2Rldi0+ZGV2X3ByaXZhdGU7CiAJaW50IHJldDsKIAotCWlmICgh
YW1kZ3B1X2RldmljZV9zdXBwb3J0c19ib2NvKGRybV9kZXYpKQorCWlmICghYWRldi0+cnVucG0p
CiAJCXJldHVybiAtRUlOVkFMOwogCiAJaWYgKGFtZGdwdV9kZXZpY2Vfc3VwcG9ydHNfYm9jbyhk
cm1fZGV2KSkgewpAQCAtMTI3Miw5ICsxMjc0LDEwIEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Btb3Bz
X3J1bnRpbWVfcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKIHN0YXRpYyBpbnQgYW1kZ3B1X3Bt
b3BzX3J1bnRpbWVfaWRsZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IGRybV9kZXZp
Y2UgKmRybV9kZXYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiA9IGRybV9kZXYtPmRldl9wcml2YXRlOwogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsK
IAotCWlmICghYW1kZ3B1X2RldmljZV9zdXBwb3J0c19ib2NvKGRybV9kZXYpKSB7CisJaWYgKCFh
ZGV2LT5ydW5wbSkgewogCQlwbV9ydW50aW1lX2ZvcmJpZChkZXYpOwogCQlyZXR1cm4gLUVCVVNZ
OwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwppbmRleCAxZjAzY2Zl
YzUyNjUuLjA2ZGFlMWRlNzFkMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9r
bXMuYwpAQCAtOTEsNyArOTEsNyBAQCB2b2lkIGFtZGdwdV9kcml2ZXJfdW5sb2FkX2ttcyhzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2KQogCWlmIChhbWRncHVfc3Jpb3ZfdmYoYWRldikpCiAJCWFtZGdw
dV92aXJ0X3JlcXVlc3RfZnVsbF9ncHUoYWRldiwgZmFsc2UpOwogCi0JaWYgKGFtZGdwdV9kZXZp
Y2Vfc3VwcG9ydHNfYm9jbyhkZXYpKSB7CisJaWYgKGFkZXYtPnJ1bnBtKSB7CiAJCXBtX3J1bnRp
bWVfZ2V0X3N5bmMoZGV2LT5kZXYpOwogCQlwbV9ydW50aW1lX2ZvcmJpZChkZXYtPmRldik7CiAJ
fQpAQCAtMTUwLDE0ICsxNTAsMTcgQEAgaW50IGFtZGdwdV9kcml2ZXJfbG9hZF9rbXMoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgbG9uZyBmbGFncykKIAl9CiAJZGV2LT5kZXZfcHJp
dmF0ZSA9ICh2b2lkICopYWRldjsKIAotCWlmICgoYW1kZ3B1X3J1bnRpbWVfcG0gIT0gMCkgJiYK
LQkgICAgYW1kZ3B1X2hhc19hdHB4KCkgJiYKKwlpZiAoYW1kZ3B1X2hhc19hdHB4KCkgJiYKIAkg
ICAgKGFtZGdwdV9pc19hdHB4X2h5YnJpZCgpIHx8CiAJICAgICBhbWRncHVfaGFzX2F0cHhfZGdw
dV9wb3dlcl9jbnRsKCkpICYmCiAJICAgICgoZmxhZ3MgJiBBTURfSVNfQVBVKSA9PSAwKSAmJgog
CSAgICAhcGNpX2lzX3RodW5kZXJib2x0X2F0dGFjaGVkKGRldi0+cGRldikpCiAJCWZsYWdzIHw9
IEFNRF9JU19QWDsKIAorCWlmICgoYW1kZ3B1X3J1bnRpbWVfcG0gIT0gMCkgJiYKKwkgICAgKGZs
YWdzICYgQU1EX0lTX1BYKSkKKwkJYWRldi0+cnVucG0gPSB0cnVlOworCiAJLyogYW1kZ3B1X2Rl
dmljZV9pbml0IHNob3VsZCByZXBvcnQgb25seSBmYXRhbCBlcnJvcgogCSAqIGxpa2UgbWVtb3J5
IGFsbG9jYXRpb24gZmFpbHVyZSBvciBpb21hcHBpbmcgZmFpbHVyZSwKIAkgKiBvciBtZW1vcnkg
bWFuYWdlciBpbml0aWFsaXphdGlvbiBmYWlsdXJlLCBpdCBtdXN0CkBAIC0xODAsNyArMTgzLDcg
QEAgaW50IGFtZGdwdV9kcml2ZXJfbG9hZF9rbXMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5z
aWduZWQgbG9uZyBmbGFncykKIAkJCQkiRXJyb3IgZHVyaW5nIEFDUEkgbWV0aG9kcyBjYWxsXG4i
KTsKIAl9CiAKLQlpZiAoYW1kZ3B1X2RldmljZV9zdXBwb3J0c19ib2NvKGRldikpIHsKKwlpZiAo
YWRldi0+cnVucG0pIHsKIAkJZGV2X3BtX3NldF9kcml2ZXJfZmxhZ3MoZGV2LT5kZXYsIERQTV9G
TEFHX05FVkVSX1NLSVApOwogCQlwbV9ydW50aW1lX3VzZV9hdXRvc3VzcGVuZChkZXYtPmRldik7
CiAJCXBtX3J1bnRpbWVfc2V0X2F1dG9zdXNwZW5kX2RlbGF5KGRldi0+ZGV2LCA1MDAwKTsKQEAg
LTE5NCw3ICsxOTcsNyBAQCBpbnQgYW1kZ3B1X2RyaXZlcl9sb2FkX2ttcyhzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB1bnNpZ25lZCBsb25nIGZsYWdzKQogb3V0OgogCWlmIChyKSB7CiAJCS8qIGJh
bGFuY2UgcG1fcnVudGltZV9nZXRfc3luYyBpbiBhbWRncHVfZHJpdmVyX3VubG9hZF9rbXMgKi8K
LQkJaWYgKGFkZXYtPnJtbWlvICYmIGFtZGdwdV9kZXZpY2Vfc3VwcG9ydHNfYm9jbyhkZXYpKQor
CQlpZiAoYWRldi0+cm1taW8gJiYgYWRldi0+cnVucG0pCiAJCQlwbV9ydW50aW1lX3B1dF9ub2lk
bGUoZGV2LT5kZXYpOwogCQlhbWRncHVfZHJpdmVyX3VubG9hZF9rbXMoZGV2KTsKIAl9Ci0tIAoy
LjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFt
ZC1nZnggbWFpbGluZyBsaXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
