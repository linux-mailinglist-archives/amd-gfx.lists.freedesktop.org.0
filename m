Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1800067526
	for <lists+amd-gfx@lfdr.de>; Fri, 12 Jul 2019 20:39:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5F5F06E364;
	Fri, 12 Jul 2019 18:39:03 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-BL2-obe.outbound.protection.outlook.com
 (mail-eopbgr750070.outbound.protection.outlook.com [40.107.75.70])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E26766E364
 for <amd-gfx@lists.freedesktop.org>; Fri, 12 Jul 2019 18:39:01 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=H5cXrgEEbxomC2GaWuiXayPm8gSqXWIWSn3xUrB5LHVuYbmId4t5TPKMD0//vTehe770SSHKw0SsUDW94ODwrWh/4iecpumAIHzCHV3RtYsUms9Zl/89SMlFpX06ne7n1xVIsGifK94bBTaguz2q/E9XQ4E3mojzOLzn4YcgvhzEL0T0hEElFU1K54VOeeOmXEj45CiXrCOk5N2rDhfGH049hg2vIvJFLt0ySlqjoz6ypdfoacjdRyapCvr+sSqOWUBOANY8GPRfYWmpbrD9WxiPhwrGGZHRcaUTPSmW3v6mi4ii5lC99UU4gMGrKBFqUxyiGQsTYQpcr/qOp7DcjQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=i6r0f8cbJqqD5M7aomP434VaakxE7AFFTR4BL1VZA1Q=;
 b=JrcjBi1jlMa3a1tgIQ9Mr2n5MB3ldt47GqOP6y0m3cKgc3Mru69KqH9sdjl5UF6uVCO3AAsJkFpECQH7dCHXvJFhg7ebTrW+cnykCUqM1LiAokzrBZDX149nhTUgLS0cvaTnrou1g9jgCL+OH23DA8dtCDNXhwgUIo9F24lYliN/DGnHPGXoVQwhgnZ3Igt0xXYTOwRfHP1JpXU/FsoF4WQ38wMv2UBPKNAxoKMGUZWkXlwqS8SMiTVqwSFn2ORwWzyrvcQezlrp87yiMvtkCKAsGZXH9IgLkVzRh7hFW4SX+wFjrGqJ5V4uK7DOO0/eROdAeRapF5NbKo23Vm5w7A==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=pass
 smtp.mailfrom=amd.com;dmarc=pass action=none header.from=amd.com;dkim=pass
 header.d=amd.com;arc=none
Received: from CH2PR12MB3831.namprd12.prod.outlook.com (52.132.245.141) by
 CH2PR12MB4166.namprd12.prod.outlook.com (20.180.16.141) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2073.10; Fri, 12 Jul 2019 18:38:59 +0000
Received: from CH2PR12MB3831.namprd12.prod.outlook.com
 ([fe80::6c10:a243:58ee:29e2]) by CH2PR12MB3831.namprd12.prod.outlook.com
 ([fe80::6c10:a243:58ee:29e2%4]) with mapi id 15.20.2073.012; Fri, 12 Jul 2019
 18:38:59 +0000
From: "Kim, Jonathan" <Jonathan.Kim@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 1/2] drm/amdgpu: add perfmon and fica atomics for df
Thread-Topic: [PATCH 1/2] drm/amdgpu: add perfmon and fica atomics for df
Thread-Index: AQHVOOERlnA/0BA4yU6ReCD94wUJLA==
Date: Fri, 12 Jul 2019 18:38:59 +0000
Message-ID: <20190712183847.2897-1-jonathan.kim@amd.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: YT1PR01CA0035.CANPRD01.PROD.OUTLOOK.COM (2603:10b6:b01::48)
 To CH2PR12MB3831.namprd12.prod.outlook.com
 (2603:10b6:610:29::13)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.17.1
x-originating-ip: [165.204.55.251]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 7696dd33-ddab-4297-10fc-08d706f833ed
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(4618075)(2017052603328)(7193020);
 SRVR:CH2PR12MB4166; 
x-ms-traffictypediagnostic: CH2PR12MB4166:
x-microsoft-antispam-prvs: <CH2PR12MB4166A3F72426026E570350EE85F20@CH2PR12MB4166.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:2958;
x-forefront-prvs: 00963989E5
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(4636009)(376002)(346002)(396003)(136003)(39860400002)(366004)(199004)(189003)(2616005)(7736002)(66556008)(64756008)(66446008)(476003)(256004)(66476007)(14444005)(68736007)(2501003)(305945005)(25786009)(71200400001)(71190400001)(36756003)(66946007)(1076003)(4326008)(6436002)(486006)(6486002)(8676002)(386003)(6506007)(8936002)(50226002)(478600001)(6512007)(316002)(5640700003)(6116002)(3846002)(102836004)(81166006)(53936002)(14454004)(81156014)(2906002)(86362001)(54906003)(52116002)(99286004)(6916009)(2351001)(26005)(5660300002)(186003)(66066001);
 DIR:OUT; SFP:1101; SCL:1; SRVR:CH2PR12MB4166;
 H:CH2PR12MB3831.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: KUEnlO8jSDgogveu0c/RkaiFlZr7DMZIyqrwZgUY9MMGrctJVjkP/RboN4SjR3fBT6VxjL9/M9qKJr/o78z0cRU9llJmcYsyAyzWDaSJn57Qxeg+lRzuY6CaaH/4cY4loKz87bMQqYkSOLFqwPpTgYcIYqFE6TEjVNKJvLW7uiu85SyoVuaaLg59ZTSb8YQUnpM7tmQ1E7EwCZK92NqFkP8J6JjWQ3eMs1UiWIoXNfHVZJ3cUZtbbkzQoFmQFrbit9oOk2vlh4mtMhdBd3hLOCA3NSJzokvulIpvT+UfzvzgSe/2Pg2gqhG1+e6Dw5j/h3VXgbFLm3Wep1f+Y9kUjmFhDsrLRUa2m7M+gO/vHygzlpORiTCry4bI/hDKeOuy6WOiknlt4Qhx77AwHRRSoUjjDNm2PwBON/DH5EnEvms=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 7696dd33-ddab-4297-10fc-08d706f833ed
X-MS-Exchange-CrossTenant-originalarrivaltime: 12 Jul 2019 18:38:59.1373 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: jokim@amd.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: CH2PR12MB4166
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=i6r0f8cbJqqD5M7aomP434VaakxE7AFFTR4BL1VZA1Q=;
 b=tc9pbvFTXGwx4PdyE2he9MARDK2M0FutQgXTIMNGZ+SE3DyHayaL5nI1xGP5ri7rl03vgTVMeO2HqUXugU7UEYLZBScS7GA+/edrNQCqhs6eWHb1yDZa8e9Ii/W64Sz+cd+Pnbk4BdVqbvFDNi0my32Li8nAFHJWWPQFAwhadKU=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Jonathan.Kim@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "Kim, Jonathan" <Jonathan.Kim@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

YWRkaW5nIHBlcmZtb24gYW5kIGZpY2EgYXRvbWljIG9wZXJhdGlvbnMgdG8gYWRoZXJlIHRvIGRh
dGEgZmFicmljcyBmaW5pdGUKc3RhdGUgbWFjaGluZSByZXF1aXJlbWVudHMgZm9yIGluZGlyZWN0
IHJlZ2lzdGVyIGFjY2Vzcy4KCkNoYW5nZS1JZDogSTJhYjE3ZmQ1OWQ1NjZiNDI1MWM5YTlkMGU2
N2I4OTdiOGMyMjEyNDkKU2lnbmVkLW9mZi1ieTogSm9uYXRoYW4gS2ltIDxKb25hdGhhbi5LaW1A
YW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaCAgfCAgIDMg
KwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jIHwgMjAyICsrKysrKysrKysr
KysrKysrLS0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAxMjggaW5zZXJ0aW9ucygrKSwgNzcg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1LmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHUuaAppbmRleCBlNjQ2OWUy
M2I3NmYuLjE5OGFhNjBjNDNiZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1LmgKQEAg
LTcwNyw2ICs3MDcsOSBAQCBzdHJ1Y3QgYW1kZ3B1X2RmX2Z1bmNzIHsKIAkJCQkJIGludCBpc19k
aXNhYmxlKTsKIAl2b2lkICgqcG1jX2dldF9jb3VudCkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsIHVpbnQ2NF90IGNvbmZpZywKIAkJCQkJIHVpbnQ2NF90ICpjb3VudCk7CisJdWludDY0X3Qg
KCpnZXRfZmljYSkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IGZpY2FhX3Zh
bCk7CisJdm9pZCAoKnNldF9maWNhKShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdWludDMy
X3QgZmljYWFfdmFsLAorCQkJIHVpbnQzMl90IGZpY2FkbF92YWwsIHVpbnQzMl90IGZpY2FkaF92
YWwpOwogfTsKIC8qIERlZmluZSB0aGUgSFcgSVAgYmxvY2tzIHdpbGwgYmUgdXNlZCBpbiBkcml2
ZXIgLCBhZGQgbW9yZSBpZiBuZWNlc3NhcnkgKi8KIGVudW0gYW1kX2h3X2lwX2Jsb2NrX3R5cGUg
ewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jCmluZGV4IGVmNmU5MWY5ZjUxYy4uZGNj
N2JlMGM5ZDMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9kZl92M182
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGZfdjNfNi5jCkBAIC05Myw2ICs5
Myw5NiBAQCBjb25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwICpkZl92M182X2F0dHJfZ3JvdXBz
W10gPSB7CiAJCU5VTEwKIH07CiAKK3N0YXRpYyB1aW50NjRfdCBkZl92M182X2dldF9maWNhKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJCSB1aW50MzJfdCBmaWNhYV92YWwpCit7CisJ
dW5zaWduZWQgbG9uZyBmbGFncywgYWRkcmVzcywgZGF0YTsKKwl1aW50MzJfdCBmaWNhZGxfdmFs
LCBmaWNhZGhfdmFsOworCisJYWRkcmVzcyA9IGFkZXYtPm5iaW9fZnVuY3MtPmdldF9wY2llX2lu
ZGV4X29mZnNldChhZGV2KTsKKwlkYXRhID0gYWRldi0+bmJpb19mdW5jcy0+Z2V0X3BjaWVfZGF0
YV9vZmZzZXQoYWRldik7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmYWRldi0+cGNpZV9pZHhfbG9j
aywgZmxhZ3MpOworCVdSRUczMihhZGRyZXNzLCBzbW5ERl9QSUVfQU9OX0ZhYnJpY0luZGlyZWN0
Q29uZmlnQWNjZXNzQWRyZXNzNSk7CisJV1JFRzMyKGRhdGEsIGZpY2FhX3ZhbCk7CisKKwlXUkVH
MzIoYWRkcmVzcywgc21uREZfUElFX0FPTl9GYWJyaWNJbmRpcmVjdENvbmZpZ0FjY2Vzc0RhdGFM
bzUpOworCWZpY2FkbF92YWwgPSBSUkVHMzIoZGF0YSk7CisKKwlXUkVHMzIoYWRkcmVzcywgc21u
REZfUElFX0FPTl9GYWJyaWNJbmRpcmVjdENvbmZpZ0FjY2Vzc0RhdGFIaTUpOworCWZpY2FkaF92
YWwgPSBSUkVHMzIoZGF0YSk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZhZGV2LT5wY2ll
X2lkeF9sb2NrLCBmbGFncyk7CisKKwlyZXR1cm4gKCgoZmljYWRoX3ZhbCAmIDB4RkZGRkZGRkZG
RkZGRkZGRikgPDwgMzIpIHwgZmljYWRsX3ZhbCk7Cit9CisKK3N0YXRpYyB2b2lkIGRmX3YzXzZf
c2V0X2ZpY2Eoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IGZpY2FhX3ZhbCwK
KwkJCSAgICAgdWludDMyX3QgZmljYWRsX3ZhbCwgdWludDMyX3QgZmljYWRoX3ZhbCkKK3sKKwl1
bnNpZ25lZCBsb25nIGZsYWdzLCBhZGRyZXNzLCBkYXRhOworCisJYWRkcmVzcyA9IGFkZXYtPm5i
aW9fZnVuY3MtPmdldF9wY2llX2luZGV4X29mZnNldChhZGV2KTsKKwlkYXRhID0gYWRldi0+bmJp
b19mdW5jcy0+Z2V0X3BjaWVfZGF0YV9vZmZzZXQoYWRldik7CisKKwlzcGluX2xvY2tfaXJxc2F2
ZSgmYWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOworCVdSRUczMihhZGRyZXNzLCBzbW5ERl9Q
SUVfQU9OX0ZhYnJpY0luZGlyZWN0Q29uZmlnQWNjZXNzQWRyZXNzNSk7CisJV1JFRzMyKGRhdGEs
IGZpY2FhX3ZhbCk7CisKKwlXUkVHMzIoYWRkcmVzcywgc21uREZfUElFX0FPTl9GYWJyaWNJbmRp
cmVjdENvbmZpZ0FjY2Vzc0RhdGFMbzUpOworCVdSRUczMihkYXRhLCBmaWNhZGxfdmFsKTsKKwor
CVdSRUczMihhZGRyZXNzLCBzbW5ERl9QSUVfQU9OX0ZhYnJpY0luZGlyZWN0Q29uZmlnQWNjZXNz
RGF0YUhpNSk7CisJV1JFRzMyKGRhdGEsIGZpY2FkaF92YWwpOworCisJc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmYWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOworfQorCisvKgorICogZGZfdjNf
Nl9wZXJmbW9uX3JyZWcgLSByZWFkIHBlcmZtb24gbG8gYW5kIGhpCisgKgorICogcmVxdWlyZWQg
dG8gYmUgYXRvbWljLiAgbm8gbW1pbyBtZXRob2QgcHJvdmlkZWQgc28gc3Vic2VxdWVudCByZWFk
cyBmb3IgbG8KKyAqIGFuZCBoaSByZXF1aXJlIHRvIHByZXNlcnZlIGRmIGZpbml0ZSBzdGF0ZSBt
YWNoaW5lCisgKi8KK3N0YXRpYyB2b2lkIGRmX3YzXzZfcGVyZm1vbl9ycmVnKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LAorCQkJICAgIHVpbnQzMl90IGxvX2FkZHIsIHVpbnQzMl90ICpsb192
YWwsCisJCQkgICAgdWludDMyX3QgaGlfYWRkciwgdWludDMyX3QgKmhpX3ZhbCkKK3sKKwl1bnNp
Z25lZCBsb25nIGZsYWdzLCBhZGRyZXNzLCBkYXRhOworCisJYWRkcmVzcyA9IGFkZXYtPm5iaW9f
ZnVuY3MtPmdldF9wY2llX2luZGV4X29mZnNldChhZGV2KTsKKwlkYXRhID0gYWRldi0+bmJpb19m
dW5jcy0+Z2V0X3BjaWVfZGF0YV9vZmZzZXQoYWRldik7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgm
YWRldi0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOworCVdSRUczMihhZGRyZXNzLCBsb19hZGRyKTsK
KwkqbG9fdmFsID0gUlJFRzMyKGRhdGEpOworCVdSRUczMihhZGRyZXNzLCBoaV9hZGRyKTsKKwkq
aGlfdmFsID0gUlJFRzMyKGRhdGEpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmFkZXYtPnBj
aWVfaWR4X2xvY2ssIGZsYWdzKTsKK30KKworLyoKKyAqIGRmX3YzXzZfcGVyZm1vbl93cmVnIC0g
d3JpdGUgdG8gcGVyZm1vbiBsbyBhbmQgaGkKKyAqCisgKiByZXF1aXJlZCB0byBiZSBhdG9taWMu
ICBubyBtbWlvIG1ldGhvZCBwcm92aWRlZCBzbyBzdWJzZXF1ZW50IHJlYWRzIGFmdGVyCisgKiBk
YXRhIHdyaXRlcyBjYW5ub3Qgb2NjdXIgdG8gcHJlc2VydmUgZGF0YSBmYWJyaWNzIGZpbml0ZSBz
dGF0ZSBtYWNoaW5lLgorICovCitzdGF0aWMgdm9pZCBkZl92M182X3BlcmZtb25fd3JlZyhzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdWludDMyX3QgbG9fYWRkciwKKwkJCSAgICB1aW50MzJf
dCBsb192YWwsIHVpbnQzMl90IGhpX2FkZHIsIHVpbnQzMl90IGhpX3ZhbCkKK3sKKwl1bnNpZ25l
ZCBsb25nIGZsYWdzLCBhZGRyZXNzLCBkYXRhOworCisJYWRkcmVzcyA9IGFkZXYtPm5iaW9fZnVu
Y3MtPmdldF9wY2llX2luZGV4X29mZnNldChhZGV2KTsKKwlkYXRhID0gYWRldi0+bmJpb19mdW5j
cy0+Z2V0X3BjaWVfZGF0YV9vZmZzZXQoYWRldik7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmYWRl
di0+cGNpZV9pZHhfbG9jaywgZmxhZ3MpOworCVdSRUczMihhZGRyZXNzLCBsb19hZGRyKTsKKwlX
UkVHMzIoZGF0YSwgbG9fdmFsKTsKKwlXUkVHMzIoYWRkcmVzcywgaGlfYWRkcik7CisJV1JFRzMy
KGRhdGEsIGhpX3ZhbCk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYWRldi0+cGNpZV9pZHhf
bG9jaywgZmxhZ3MpOworfQorCiAvKiBnZXQgdGhlIG51bWJlciBvZiBkZiBjb3VudGVycyBhdmFp
bGFibGUgKi8KIHN0YXRpYyBzc2l6ZV90IGRmX3YzXzZfZ2V0X2RmX2NudHJfYXZhaWwoc3RydWN0
IGRldmljZSAqZGV2LAogCQlzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKQEAgLTI2OCw2
ICszNTgsMTAgQEAgc3RhdGljIGludCBkZl92M182X3BtY19nZXRfY3RybF9zZXR0aW5ncyhzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCQkJICB1aW50MzJfdCAqbG9fdmFsLAogCQkJCQkg
IHVpbnQzMl90ICpoaV92YWwpCiB7CisKKwl1aW50MzJfdCBldmVudHNlbCwgaW5zdGFuY2UsIHVu
aXRtYXNrOworCXVpbnQzMl90IGluc3RhbmNlXzEwLCBpbnN0YW5jZV81NDMyLCBpbnN0YW5jZV83
NjsKKwogCWRmX3YzXzZfcG1jX2dldF9hZGRyKGFkZXYsIGNvbmZpZywgMSwgbG9fYmFzZV9hZGRy
LCBoaV9iYXNlX2FkZHIpOwogCiAJaWYgKCgqbG9fYmFzZV9hZGRyID09IDApIHx8ICgqaGlfYmFz
ZV9hZGRyID09IDApKSB7CkBAIC0yNzYsNDAgKzM3MCwzMyBAQCBzdGF0aWMgaW50IGRmX3YzXzZf
cG1jX2dldF9jdHJsX3NldHRpbmdzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQlyZXR1
cm4gLUVOWElPOwogCX0KIAotCWlmIChsb192YWwgJiYgaGlfdmFsKSB7Ci0JCXVpbnQzMl90IGV2
ZW50c2VsLCBpbnN0YW5jZSwgdW5pdG1hc2s7Ci0JCXVpbnQzMl90IGluc3RhbmNlXzEwLCBpbnN0
YW5jZV81NDMyLCBpbnN0YW5jZV83NjsKKwlldmVudHNlbCA9IERGX1YzXzZfR0VUX0VWRU5UKGNv
bmZpZykgJiAweDNmOworCXVuaXRtYXNrID0gREZfVjNfNl9HRVRfVU5JVE1BU0soY29uZmlnKSAm
IDB4ZjsKKwlpbnN0YW5jZSA9IERGX1YzXzZfR0VUX0lOU1RBTkNFKGNvbmZpZyk7CiAKLQkJZXZl
bnRzZWwgPSBERl9WM182X0dFVF9FVkVOVChjb25maWcpICYgMHgzZjsKLQkJdW5pdG1hc2sgPSBE
Rl9WM182X0dFVF9VTklUTUFTSyhjb25maWcpICYgMHhmOwotCQlpbnN0YW5jZSA9IERGX1YzXzZf
R0VUX0lOU1RBTkNFKGNvbmZpZyk7CisJaW5zdGFuY2VfMTAgPSBpbnN0YW5jZSAmIDB4MzsKKwlp
bnN0YW5jZV81NDMyID0gKGluc3RhbmNlID4+IDIpICYgMHhmOworCWluc3RhbmNlXzc2ID0gKGlu
c3RhbmNlID4+IDYpICYgMHgzOwogCi0JCWluc3RhbmNlXzEwID0gaW5zdGFuY2UgJiAweDM7Ci0J
CWluc3RhbmNlXzU0MzIgPSAoaW5zdGFuY2UgPj4gMikgJiAweGY7Ci0JCWluc3RhbmNlXzc2ID0g
KGluc3RhbmNlID4+IDYpICYgMHgzOworCSpsb192YWwgPSAodW5pdG1hc2sgPDwgOCkgfCAoaW5z
dGFuY2VfMTAgPDwgNikgfCBldmVudHNlbCB8ICgxIDw8IDIyKTsKKwkqaGlfdmFsID0gKGluc3Rh
bmNlXzc2IDw8IDI5KSB8IGluc3RhbmNlXzU0MzI7CiAKLQkJKmxvX3ZhbCA9ICh1bml0bWFzayA8
PCA4KSB8IChpbnN0YW5jZV8xMCA8PCA2KSB8IGV2ZW50c2VsOwotCQkqaGlfdmFsID0gKGluc3Rh
bmNlXzc2IDw8IDI5KSB8IGluc3RhbmNlXzU0MzI7Ci0JfQorCURSTV9ERUJVR19EUklWRVIoImNv
bmZpZz0lbGx4IGFkZHI9JTA4eDolMDh4IHZhbD0lMDh4OiUwOHgiLAorCQljb25maWcsIGxvX2Jh
c2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWwsIGhpX3ZhbCk7CiAKIAlyZXR1cm4gMDsKIH0K
IAotLyogYXNzaWduIGRmIHBlcmZvcm1hbmNlIGNvdW50ZXJzIGZvciByZWFkICovCi1zdGF0aWMg
aW50IGRmX3YzXzZfcG1jX2Fzc2lnbl9jbnRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAot
CQkJCSAgIHVpbnQ2NF90IGNvbmZpZywKLQkJCQkgICBpbnQgKmlzX2Fzc2lnbmVkKQorLyogYWRk
IGRmIHBlcmZvcm1hbmNlIGNvdW50ZXJzIGZvciByZWFkICovCitzdGF0aWMgaW50IGRmX3YzXzZf
cG1jX2FkZF9jbnRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJCSAgIHVpbnQ2NF90
IGNvbmZpZykKIHsKIAlpbnQgaSwgdGFyZ2V0X2NudHI7CiAKLQkqaXNfYXNzaWduZWQgPSAwOwot
CiAJdGFyZ2V0X2NudHIgPSBkZl92M182X3BtY19jb25maWdfMl9jbnRyKGFkZXYsIGNvbmZpZyk7
CiAKLQlpZiAodGFyZ2V0X2NudHIgPj0gMCkgewotCQkqaXNfYXNzaWduZWQgPSAxOworCWlmICh0
YXJnZXRfY250ciA+PSAwKQogCQlyZXR1cm4gMDsKLQl9CiAKIAlmb3IgKGkgPSAwOyBpIDwgREZf
VjNfNl9NQVhfQ09VTlRFUlM7IGkrKykgewogCQlpZiAoYWRldi0+ZGZfcGVyZm1vbl9jb25maWdf
YXNzaWduX21hc2tbaV0gPT0gMFUpIHsKQEAgLTM0NCw0NSArNDMxLDEzIEBAIHN0YXRpYyB2b2lk
IGRmX3YzXzZfcmVzZXRfcGVyZm1vbl9jbnRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAog
CWlmICgobG9fYmFzZV9hZGRyID09IDApIHx8IChoaV9iYXNlX2FkZHIgPT0gMCkpCiAJCXJldHVy
bjsKIAotCVdSRUczMl9QQ0lFKGxvX2Jhc2VfYWRkciwgMFVMKTsKLQlXUkVHMzJfUENJRShoaV9i
YXNlX2FkZHIsIDBVTCk7Ci19Ci0KLQotc3RhdGljIGludCBkZl92M182X2FkZF9wZXJmbW9uX2Nu
dHIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCi0JCQkJICAgICAgdWludDY0X3QgY29uZmln
KQotewotCXVpbnQzMl90IGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWwsIGhpX3Zh
bDsKLQlpbnQgcmV0LCBpc19hc3NpZ25lZDsKLQotCXJldCA9IGRmX3YzXzZfcG1jX2Fzc2lnbl9j
bnRyKGFkZXYsIGNvbmZpZywgJmlzX2Fzc2lnbmVkKTsKLQotCWlmIChyZXQgfHwgaXNfYXNzaWdu
ZWQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBkZl92M182X3BtY19nZXRfY3RybF9zZXR0aW5n
cyhhZGV2LAotCQkJY29uZmlnLAotCQkJJmxvX2Jhc2VfYWRkciwKLQkJCSZoaV9iYXNlX2FkZHIs
Ci0JCQkmbG9fdmFsLAotCQkJJmhpX3ZhbCk7Ci0KLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0Owot
Ci0JRFJNX0RFQlVHX0RSSVZFUigiY29uZmlnPSVsbHggYWRkcj0lMDh4OiUwOHggdmFsPSUwOHg6
JTA4eCIsCi0JCQljb25maWcsIGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWwsIGhp
X3ZhbCk7Ci0KLQlXUkVHMzJfUENJRShsb19iYXNlX2FkZHIsIGxvX3ZhbCk7Ci0JV1JFRzMyX1BD
SUUoaGlfYmFzZV9hZGRyLCBoaV92YWwpOwotCi0JcmV0dXJuIHJldDsKKwlkZl92M182X3BlcmZt
b25fd3JlZyhhZGV2LCBsb19iYXNlX2FkZHIsIDAsIGhpX2Jhc2VfYWRkciwgMCk7CiB9CiAKIHN0
YXRpYyBpbnQgZGZfdjNfNl9wbWNfc3RhcnQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVp
bnQ2NF90IGNvbmZpZywKIAkJCSAgICAgaW50IGlzX2VuYWJsZSkKIHsKLQl1aW50MzJfdCBsb19i
YXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwgbG9fdmFsOworCXVpbnQzMl90IGxvX2Jhc2VfYWRkciwg
aGlfYmFzZV9hZGRyLCBsb192YWwsIGhpX3ZhbDsKIAlpbnQgcmV0ID0gMDsKIAogCXN3aXRjaCAo
YWRldi0+YXNpY190eXBlKSB7CkBAIC0zOTEsMjQgKzQ0NiwyMCBAQCBzdGF0aWMgaW50IGRmX3Yz
XzZfcG1jX3N0YXJ0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50NjRfdCBjb25maWcs
CiAJCWRmX3YzXzZfcmVzZXRfcGVyZm1vbl9jbnRyKGFkZXYsIGNvbmZpZyk7CiAKIAkJaWYgKGlz
X2VuYWJsZSkgewotCQkJcmV0ID0gZGZfdjNfNl9hZGRfcGVyZm1vbl9jbnRyKGFkZXYsIGNvbmZp
Zyk7CisJCQlyZXQgPSBkZl92M182X3BtY19hZGRfY250cihhZGV2LCBjb25maWcpOwogCQl9IGVs
c2UgewogCQkJcmV0ID0gZGZfdjNfNl9wbWNfZ2V0X2N0cmxfc2V0dGluZ3MoYWRldiwKIAkJCQkJ
Y29uZmlnLAogCQkJCQkmbG9fYmFzZV9hZGRyLAogCQkJCQkmaGlfYmFzZV9hZGRyLAotCQkJCQlO
VUxMLAotCQkJCQlOVUxMKTsKKwkJCQkJJmxvX3ZhbCwKKwkJCQkJJmhpX3ZhbCk7CiAKIAkJCWlm
IChyZXQpCiAJCQkJcmV0dXJuIHJldDsKIAotCQkJbG9fdmFsID0gUlJFRzMyX1BDSUUobG9fYmFz
ZV9hZGRyKTsKLQotCQkJRFJNX0RFQlVHX0RSSVZFUigiY29uZmlnPSVsbHggYWRkcj0lMDh4OiUw
OHggdmFsPSUwOHgiLAotCQkJCWNvbmZpZywgbG9fYmFzZV9hZGRyLCBoaV9iYXNlX2FkZHIsIGxv
X3ZhbCk7Ci0KLQkJCVdSRUczMl9QQ0lFKGxvX2Jhc2VfYWRkciwgbG9fdmFsIHwgKDFVTEwgPDwg
MjIpKTsKKwkJCWRmX3YzXzZfcGVyZm1vbl93cmVnKGFkZXYsIGxvX2Jhc2VfYWRkciwgbG9fdmFs
LAorCQkJCQloaV9iYXNlX2FkZHIsIGhpX3ZhbCk7CiAJCX0KIAogCQlicmVhazsKQEAgLTQyMiw3
ICs0NzMsNyBAQCBzdGF0aWMgaW50IGRmX3YzXzZfcG1jX3N0YXJ0KHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LCB1aW50NjRfdCBjb25maWcsCiBzdGF0aWMgaW50IGRmX3YzXzZfcG1jX3N0b3Ao
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQ2NF90IGNvbmZpZywKIAkJCSAgICBpbnQg
aXNfZGlzYWJsZSkKIHsKLQl1aW50MzJfdCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwgbG9f
dmFsOworCXVpbnQzMl90IGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWwsIGhpX3Zh
bDsKIAlpbnQgcmV0ID0gMDsKIAogCXN3aXRjaCAoYWRldi0+YXNpY190eXBlKSB7CkBAIC00MzEs
MTggKzQ4MiwxMyBAQCBzdGF0aWMgaW50IGRmX3YzXzZfcG1jX3N0b3Aoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsIHVpbnQ2NF90IGNvbmZpZywKIAkJCWNvbmZpZywKIAkJCSZsb19iYXNlX2Fk
ZHIsCiAJCQkmaGlfYmFzZV9hZGRyLAotCQkJTlVMTCwKLQkJCU5VTEwpOworCQkJJmxvX3ZhbCwK
KwkJCSZoaV92YWwpOwogCiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCi0JCWxvX3ZhbCA9
IFJSRUczMl9QQ0lFKGxvX2Jhc2VfYWRkcik7Ci0KLQkJRFJNX0RFQlVHX0RSSVZFUigiY29uZmln
PSVsbHggYWRkcj0lMDh4OiUwOHggdmFsPSUwOHgiLAotCQkJCWNvbmZpZywgbG9fYmFzZV9hZGRy
LCBoaV9iYXNlX2FkZHIsIGxvX3ZhbCk7Ci0KLQkJV1JFRzMyX1BDSUUobG9fYmFzZV9hZGRyLCBs
b192YWwgJiB+KDFVTEwgPDwgMjIpKTsKKwkJZGZfdjNfNl9wZXJmbW9uX3dyZWcoYWRldiwgbG9f
YmFzZV9hZGRyLCAwLCBoaV9iYXNlX2FkZHIsIDApOwogCiAJCWlmIChpc19kaXNhYmxlKQogCQkJ
ZGZfdjNfNl9wbWNfcmVsZWFzZV9jbnRyKGFkZXYsIGNvbmZpZyk7CkBAIC00NzEsOCArNTE3LDgg
QEAgc3RhdGljIHZvaWQgZGZfdjNfNl9wbWNfZ2V0X2NvdW50KHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LAogCQlpZiAoKGxvX2Jhc2VfYWRkciA9PSAwKSB8fCAoaGlfYmFzZV9hZGRyID09IDAp
KQogCQkJcmV0dXJuOwogCi0JCWxvX3ZhbCA9IFJSRUczMl9QQ0lFKGxvX2Jhc2VfYWRkcik7Ci0J
CWhpX3ZhbCA9IFJSRUczMl9QQ0lFKGhpX2Jhc2VfYWRkcik7CisJCWRmX3YzXzZfcGVyZm1vbl9y
cmVnKGFkZXYsIGxvX2Jhc2VfYWRkciwgJmxvX3ZhbCwKKwkJCQloaV9iYXNlX2FkZHIsICZoaV92
YWwpOwogCiAJCSpjb3VudCAgPSAoKGhpX3ZhbCB8IDBVTEwpIDw8IDMyKSB8IChsb192YWwgfCAw
VUxMKTsKIApAQCAtNDgwLDcgKzUyNiw3IEBAIHN0YXRpYyB2b2lkIGRmX3YzXzZfcG1jX2dldF9j
b3VudChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCSpjb3VudCA9IDA7CiAKIAkJRFJN
X0RFQlVHX0RSSVZFUigiY29uZmlnPSVsbHggYWRkcj0lMDh4OiUwOHggdmFsPSUwOHg6JTA4eCIs
Ci0JCQljb25maWcsIGxvX2Jhc2VfYWRkciwgaGlfYmFzZV9hZGRyLCBsb192YWwsIGhpX3ZhbCk7
CisJCQkgY29uZmlnLCBsb19iYXNlX2FkZHIsIGhpX2Jhc2VfYWRkciwgbG9fdmFsLCBoaV92YWwp
OwogCiAJCWJyZWFrOwogCkBAIC00OTksNSArNTQ1LDcgQEAgY29uc3Qgc3RydWN0IGFtZGdwdV9k
Zl9mdW5jcyBkZl92M182X2Z1bmNzID0gewogCS5nZXRfY2xvY2tnYXRpbmdfc3RhdGUgPSBkZl92
M182X2dldF9jbG9ja2dhdGluZ19zdGF0ZSwKIAkucG1jX3N0YXJ0ID0gZGZfdjNfNl9wbWNfc3Rh
cnQsCiAJLnBtY19zdG9wID0gZGZfdjNfNl9wbWNfc3RvcCwKLQkucG1jX2dldF9jb3VudCA9IGRm
X3YzXzZfcG1jX2dldF9jb3VudAorCS5wbWNfZ2V0X2NvdW50ID0gZGZfdjNfNl9wbWNfZ2V0X2Nv
dW50LAorCS5nZXRfZmljYSA9IGRmX3YzXzZfZ2V0X2ZpY2EsCisJLnNldF9maWNhID0gZGZfdjNf
Nl9zZXRfZmljYQogfTsKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9hbWQtZ2Z4
