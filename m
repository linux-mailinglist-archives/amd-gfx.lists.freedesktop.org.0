Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 02C6F40453C
	for <lists+amd-gfx@lfdr.de>; Thu,  9 Sep 2021 07:55:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4E2AE6E43C;
	Thu,  9 Sep 2021 05:55:28 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM10-DM6-obe.outbound.protection.outlook.com
 (mail-dm6nam10on2069.outbound.protection.outlook.com [40.107.93.69])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CF2A06E43C
 for <amd-gfx@lists.freedesktop.org>; Thu,  9 Sep 2021 05:55:26 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=mwzA00a1/ZVIx7nAod4kmH/33MLev0TQEvJB4IY+GP6fwUh6QHGjV5kqiwdF4KQy8miJbGcf/og0G8urnifc0xG5JW32ZSemcRM763TS/Kekxd4bpdareO1XO/kIwDK3qJwon5bQSLEMLRNjz8/El/3C3l/bbsora9aB2oN+p+DgPq8J5Zrx6ELmwRM0YIo43Kwv7lZo0I3Y/c2Y/lN/H4apxcrkIJSCYI68GFj3I5ahIjpDwHTK1+qMcRIe5n5Xof3uHo33Wqom8LE8Iphow3cgxOBCNGkpIXZxPZphhAxxnLhD9mJ7z/iCapaaQHpqBNvXEF9C7biPTtJB99Xvzw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version; 
 bh=zH863IY5ytYbxkPzrY2pg5l/hymmMyRHr9JibrNQSnw=;
 b=R56HLkEzpkRtfI4p9IlfNdN5+71DMlrv3TCHChiuRJWNwz4/5YspyBdDDWpG8Nq+ZmZBCmaaPU9KZ9ZEV7pXboPz9U+HbkZKhznWmPYICFoHhMpE2FkflEh/Q5R61DoL5F1DZ7xAYY5+H3bTD3qew8+L/z02UoT14HFSsqTMkHJxeoqqh8D+eZh+9uYtoCFDX9RFq0Qch0aiq3ldmtRWkJvnZ4GD/1V0D9lZp0/LAe2cDrQJg1rPtNbNCyEATB+SFYbhnKxszj+ZgXlqQNqjUvj1ZquiA4tTdybqCFbjYFrzPKisQlmjqysHvw+pi4XXBncEH2NnJYVhRcQTDVaT+A==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=amd.com; s=selector1; 
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=zH863IY5ytYbxkPzrY2pg5l/hymmMyRHr9JibrNQSnw=;
 b=4QonRMgfkMgvXHE9u99HR8gk4JNQc6+1f5IEl2U21EnMyZSq24IkBNdPUrVwMaLJm2ChsTfXN2khzbZNzC3nChqsMNcqtvYmdxuwfQnIlrFLoosKGgZ/a5JvO80BN8n19hM0LxwAxkAzZ2J6r8zTgZd8jz/6yURREapHG4KoyRc=
Received: from DM4PR12MB5165.namprd12.prod.outlook.com (2603:10b6:5:394::9) by
 DM4PR12MB5184.namprd12.prod.outlook.com (2603:10b6:5:397::18) with
 Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.4500.14; Thu, 9 Sep 2021 05:55:24 +0000
Received: from DM4PR12MB5165.namprd12.prod.outlook.com
 ([fe80::79d6:3902:9bcd:37ca]) by DM4PR12MB5165.namprd12.prod.outlook.com
 ([fe80::79d6:3902:9bcd:37ca%9]) with mapi id 15.20.4500.016; Thu, 9 Sep 2021
 05:55:24 +0000
From: "Pan, Xinhui" <Xinhui.Pan@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
CC: "Deucher, Alexander" <Alexander.Deucher@amd.com>, "Koenig, Christian"
 <Christian.Koenig@amd.com>
Subject: [PATCH 2/2] drm/amdgpu: alloc IB extra msg from IB pool
Thread-Topic: [PATCH 2/2] drm/amdgpu: alloc IB extra msg from IB pool
Thread-Index: AQHXpT8vytTD7lxt+k+m7Tk/uyOQlg==
Date: Thu, 9 Sep 2021 05:55:24 +0000
Message-ID: <DM4PR12MB5165E6211939B36FD10BF65C87D59@DM4PR12MB5165.namprd12.prod.outlook.com>
Accept-Language: zh-CN, en-US
Content-Language: zh-CN
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
msip_labels: MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_Enabled=True;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_SiteId=3dd8961f-e488-4e60-8e11-a82d994e183d;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_SetDate=2021-09-09T05:55:24.524Z;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_Name=AMD
 Official Use
 Only; MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_ContentBits=0;
 MSIP_Label_88914ebd-7e6c-4e12-a031-a9906be2db14_Method=Standard; 
suggested_attachment_session_id: 8f35584a-3ab4-8f85-8e9a-3ab1125ea2f3
authentication-results: lists.freedesktop.org; dkim=none (message not signed)
 header.d=none; lists.freedesktop.org;
 dmarc=none action=none header.from=amd.com;
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 8850242c-b6e2-49ee-1276-08d973566af9
x-ms-traffictypediagnostic: DM4PR12MB5184:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <DM4PR12MB518432B2029944D7FDE7336387D59@DM4PR12MB5184.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:390;
x-ms-exchange-senderadcheck: 1
x-ms-exchange-antispam-relay: 0
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: tBSP/coCqwaIWppHjK6TDluIs4iXDN1S7/6HPdC3K70AQ1PUUmYU6pAxd0BMLbebaJ2vBTHAfbG3rQquicXgQgvU0POnDi2MU+WsWtvMNHmfyJZ9M6jrCyr/omh4lwqmSwXHZ+bKAGJOpWkdr5k4i3injMWNPSfqjhYgvG7rNO0jDhCHrRXY3XB8jPU9AbatngjvvzSZxRwPE4PBVEs0fox27DDLRDBHV7/HJKG5xaPq4+5hw52TB85cKgxUsw7HYyPVCxCeTAgrEbtg6oyL2ZlreC80oBtCGgcFtS65RT4i6VTGjPs1NXXnm9bhNls4cGPQT/BNe0WJjphUvKCwDXKyqzXu1lrxBy8erJCmGSMQdhnHHvZy3ttfINXQoqoKVm64Z0Uvy8i7SvQFk2lUd+VCyV34OQi7fpfWEoNsJBbdWLBETRPSnDB0ym8MU/ZPB7HEKXmsuz71N32mIXyhMhHvTQ0jkC6nvCZ4dpB8O3m0OBbpPrmVJvRYZq/oOyIiDr2M8iFrq1e+yzKrVsi1+JQ4VTYngjGiIvoC5SKnzmJ96AWG11Eqo05fsnMlptBEvztrWhB0LgdmUZr9RD9zeZ+Ze4OzvpXuKT7iXyeC6aSn1OzHEpXvkRFUbfzZrf6Bjt8Hwi/WwMRZk5Hc5Qow0aucyd1RiTf+Lf5coGkPLUlFJWj/pyv4VTOQSxBWVIPKtmf2XDyIzsPFUPVtOhWjew==
x-forefront-antispam-report: CIP:255.255.255.255; CTRY:; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:DM4PR12MB5165.namprd12.prod.outlook.com; PTR:; CAT:NONE;
 SFS:(4636009)(366004)(39860400002)(136003)(376002)(346002)(396003)(122000001)(5660300002)(83380400001)(7696005)(71200400001)(2906002)(8936002)(6506007)(4326008)(6916009)(86362001)(9686003)(33656002)(38100700002)(30864003)(316002)(478600001)(186003)(26005)(54906003)(66556008)(64756008)(66446008)(66476007)(55016002)(38070700005)(91956017)(66946007)(76116006)(52536014)(8676002)(559001)(579004);
 DIR:OUT; SFP:1101; 
x-ms-exchange-antispam-messagedata-chunkcount: 1
x-ms-exchange-antispam-messagedata-0: =?gb2312?B?dkMrWWFTQ0VIOG1ET3EzeGxaWmFxVEhXZUdZVDdUVE1Pb25PSG8yZkhwbTJU?=
 =?gb2312?B?dEhyUUp1bkRvdkNNb2hLNjdERjc1bURYcUJUVWc5bzNMMHJxaUhpVGZSTFBH?=
 =?gb2312?B?dnlsYjQrdk4rdm9ROWFTcFE1TVBjRUdROW5EVVpBOWRSZWtNNTROamZqYVQx?=
 =?gb2312?B?UHk2aGRPUXpEN0xtNTViQkNsWjBZZlVta25MYXJwaGY5Z21DR0tVcGNscFAw?=
 =?gb2312?B?ZG43dzJvbEEwRkEwb2w5VzU4OUhWZ05RWU9xbldseUlsUGJoUndpTGJOVDZK?=
 =?gb2312?B?cGM2SmtpbHdCK0xzVlF1U3pJeG1veVZkck5rMzhFdzFVSVE0TmJHY0I2QXhi?=
 =?gb2312?B?enZiSFJUT1RoOWtkMGZFMXdXTHFtYVEreEpLOVRhbVhvWjlDbXVacytuZmd0?=
 =?gb2312?B?S0xoaUJEdmpEZnpNVXF6VHlJcE9BWjhRb2dsc1V0NGRRM01TaXJlandpSVVN?=
 =?gb2312?B?OFdBRWo0LzhvZ2lmZ2pkbjAvQm1rcGVYWXVVaytKNHl5UnVYeE1qZnJhNHlK?=
 =?gb2312?B?Qkh3bVlvdzdCVno2VmtlWVdwc0xqaHAxTG53Z0h6cUJIUGVrbytENXNlRHVt?=
 =?gb2312?B?em9MOHM3N3hLSUl4dWJRajMvY2xvdUNlVy9jVjZySFhubHRpOHJDVEFGM0k1?=
 =?gb2312?B?WlJ6amNtTWczVW9jQ3l4ZW5SZ0FkS0VUMzlpSWVFaE9LcVRjODVZVXd2L29s?=
 =?gb2312?B?RjFRVmlucnJ2RFlzVEZucklrdFZXMDRibkc0dEtHTE12YzFnclhxdWNaWVlj?=
 =?gb2312?B?Y2ZDaFNHQytoZk9mZjg3SmlWcDZFZzB1UitoRlkxUS9VOWg0dUREVmFDVlZG?=
 =?gb2312?B?MHRYL1JXaTFNQk5BMitKRkRrV1k0enZUVXRBUEtqTW9jaDU0bkJXWjBaWHVq?=
 =?gb2312?B?d0tKUUxjd1o3UmZEaFozdks2cDNGNjZSeUFsNk04L0x6N05GTDhIc2RDOGxl?=
 =?gb2312?B?elYrd2RaRDIvSFdrSkUxcVNBNWRrSzRGeldtazdnU1JESEpZcDRlT2JYQWdZ?=
 =?gb2312?B?UHZWTG9MeEZpZzlNbU11cWdraVR3NXY5K1U2TzkzVmR5QTJPOE9KUCs4TDN4?=
 =?gb2312?B?MzJxc0FMaHNLTmVoWllIaXhJenNsdURTR1hBRmRkaGVNd3orQytScmlybFNh?=
 =?gb2312?B?Yk02M1AyaXdYVVdvdlZrb0dvT3pSeWZVMzg0N3hoYVpiZjhVV042YjJXZUdu?=
 =?gb2312?B?UVl0YmE3dVk5ZThFYy9YSFdUUSs2YzVEYWJHMU1zcW9mc0docEJycmc0ZVNP?=
 =?gb2312?B?YkJHd1k2TDFicVpmQ2szQ1lzUCtvSnhnS2hwMURINUl3d0p2WE93TGlYa0NY?=
 =?gb2312?B?SkpqVHphaTE2NUVGSGZFR0dtb3NwZi90eXNMZ2ZHSnZMZkRXaWNJMHBMTkRQ?=
 =?gb2312?B?VHFDODUvL29nMmlNM0E2UmlYd1JaYkw3dVhHeGhiV1JRQ0lrdThpS25oTDBG?=
 =?gb2312?B?VVhFK2s4Q0c0cTc3dDBwSTZaRmJRWFhVWXVUOXlYSUk1djU0cXc5RlFDdUxa?=
 =?gb2312?B?Qm9XR3J2bVZQamdwczVTV2lKNHV0ckovSUNwOVNTMXFUd0VmbUF6QkNwOFpQ?=
 =?gb2312?B?VlhraEc3NytvYWt3Z283NUYyY3M0eXlJL3dueTVROGxnNTJwUmkrc1QxTVlC?=
 =?gb2312?B?Nm14TzVXaFFaWDBKV3VLd1VoL3lPNGNvekN3L1Axeng1MkFQMW5reXF4blhu?=
 =?gb2312?B?ZmtBWmt5NmxXWThYcVVOTURFeGJheHdTTCt5NmJtZU1qS0dCK1VaYS8zSWRN?=
 =?gb2312?Q?Oxc7VkA6Ie28SeJZ+q7CH/m5zObRT5KV3fIcfqs?=
Content-Type: text/plain; charset="gb2312"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: DM4PR12MB5165.namprd12.prod.outlook.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 8850242c-b6e2-49ee-1276-08d973566af9
X-MS-Exchange-CrossTenant-originalarrivaltime: 09 Sep 2021 05:55:24.6983 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: /BxnVfic6uQ3/za41QnxBwr6xFYcRrBFAzy5IShcQfV3VVFAeT7hkCJOaOjlb9fp
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM4PR12MB5184
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

W0FNRCBPZmZpY2lhbCBVc2UgT25seV0NCg0KVGhlcmUgaXMgb25lIGRlZGljYXRlZCBJQiBwb29s
IGZvciBJQiB0ZXN0LiBTbyBsZXRzIHVzZSBpdCBmb3IgZXh0cmEgbXNnDQp0b28uDQoNCkZvciBV
VkQgb24gb2xkZXIgSFcsIHVzZSBvbmUgcmVzZXJ2ZWQgQk8gYXQgc3BlY2lmaWMgcmFuZ2UuDQoN
ClNpZ25lZC1vZmYtYnk6IHhpbmh1aSBwYW4gPHhpbmh1aS5wYW5AYW1kLmNvbT4NCi0tLQ0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91dmQuYyB8IDE3MyArKysrKysrKysrKysr
KystLS0tLS0tLS0NCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdXZkLmggfCAg
IDEgKw0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92Y2UuYyB8ICAxOCArLS0N
CiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdmNuLmMgfCAgOTkgKysrKysrLS0t
LS0tLS0NCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS91dmRfdjZfMC5jICAgfCAgMjggKyst
LQ0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3V2ZF92N18wLmMgICB8ICAyOCArKy0tDQog
NiBmaWxlcyBjaGFuZ2VkLCAxODUgaW5zZXJ0aW9ucygrKSwgMTYyIGRlbGV0aW9ucygtKQ0KDQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5jIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5jDQppbmRleCBkNDUxYzM1OTYwNmEu
LjczM2NmYzg0OGM2YyAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV91dmQuYw0KKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5j
DQpAQCAtMjk5LDggKzI5OSwzNiBAQCBpbnQgYW1kZ3B1X3V2ZF9zd19pbml0KHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2KQ0KICAgICAgICB9DQoNCiAgICAgICAgLyogZnJvbSB1dmQgdjUuMCBI
VyBhZGRyZXNzaW5nIGNhcGFjaXR5IGluY3JlYXNlZCB0byA2NCBiaXRzICovDQotICAgICAgIGlm
ICghYW1kZ3B1X2RldmljZV9pcF9ibG9ja192ZXJzaW9uX2NtcChhZGV2LCBBTURfSVBfQkxPQ0tf
VFlQRV9VVkQsIDUsIDApKQ0KKyAgICAgICBpZiAoIWFtZGdwdV9kZXZpY2VfaXBfYmxvY2tfdmVy
c2lvbl9jbXAoYWRldiwgQU1EX0lQX0JMT0NLX1RZUEVfVVZELCA1LCAwKSkgew0KICAgICAgICAg
ICAgICAgIGFkZXYtPnV2ZC5hZGRyZXNzXzY0X2JpdCA9IHRydWU7DQorICAgICAgIH0gZWxzZSB7
DQorICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8gPSBOVUxMOw0KKyAgICAgICAg
ICAgICAgIHZvaWQgKmFkZHI7DQorDQorICAgICAgICAgICAgICAgciA9IGFtZGdwdV9ib19jcmVh
dGVfcmVzZXJ2ZWQoYWRldiwgUEFHRV9TSVpFLCBQQUdFX1NJWkUsDQorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEFNREdQVV9HRU1fRE9NQUlOX1ZSQU0sDQorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZibywgTlVMTCwgJmFkZHIpOw0KKyAgICAgICAgICAgICAgIGlmIChy
KQ0KKyAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7DQorICAgICAgICAgICAgICAgYW1k
Z3B1X2JvX2t1bm1hcChibyk7DQorICAgICAgICAgICAgICAgYW1kZ3B1X2JvX3VucGluKGJvKTsN
CisgICAgICAgICAgICAgICByID0gYW1kZ3B1X2JvX3Bpbl9yZXN0cmljdGVkKGJvLCBBTURHUFVf
R0VNX0RPTUFJTl9WUkFNLA0KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCAyNTYg
PDwgMjApOw0KKyAgICAgICAgICAgICAgIGlmIChyKSB7DQorICAgICAgICAgICAgICAgICAgICAg
ICBhbWRncHVfYm9fdW5yZXNlcnZlKGJvKTsNCisgICAgICAgICAgICAgICAgICAgICAgIGFtZGdw
dV9ib191bnJlZigmYm8pOw0KKyAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7DQorICAg
ICAgICAgICAgICAgfQ0KKyAgICAgICAgICAgICAgIHIgPSBhbWRncHVfYm9fa21hcChibywgJmFk
ZHIpOw0KKyAgICAgICAgICAgICAgIGlmIChyKSB7DQorICAgICAgICAgICAgICAgICAgICAgICBh
bWRncHVfYm9fdW5waW4oYm8pOw0KKyAgICAgICAgICAgICAgICAgICAgICAgYW1kZ3B1X2JvX3Vu
cmVzZXJ2ZShibyk7DQorICAgICAgICAgICAgICAgICAgICAgICBhbWRncHVfYm9fdW5yZWYoJmJv
KTsNCisgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByOw0KKyAgICAgICAgICAgICAgIH0N
CisgICAgICAgICAgICAgICBhZGV2LT51dmQuaWJfYm8gPSBibzsNCisgICAgICAgICAgICAgICBh
bWRncHVfYm9fdW5yZXNlcnZlKGJvKTsNCisgICAgICAgfQ0KDQogICAgICAgIHN3aXRjaCAoYWRl
di0+YXNpY190eXBlKSB7DQogICAgICAgIGNhc2UgQ0hJUF9UT05HQToNCkBAIC0zNDIsNiArMzcw
LDcgQEAgaW50IGFtZGdwdV91dmRfc3dfZmluaShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikN
CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgQU1ER1BVX01BWF9VVkRfRU5DX1JJTkdT
OyArK2kpDQogICAgICAgICAgICAgICAgICAgICAgICBhbWRncHVfcmluZ19maW5pKCZhZGV2LT51
dmQuaW5zdFtqXS5yaW5nX2VuY1tpXSk7DQogICAgICAgIH0NCisgICAgICAgYW1kZ3B1X2JvX2Zy
ZWVfa2VybmVsKCZhZGV2LT51dmQuaWJfYm8sIE5VTEwsIE5VTEwpOw0KICAgICAgICByZWxlYXNl
X2Zpcm13YXJlKGFkZXYtPnV2ZC5mdyk7DQoNCiAgICAgICAgcmV0dXJuIDA7DQpAQCAtMTA2Niw3
ICsxMDk1LDcgQEAgaW50IGFtZGdwdV91dmRfcmluZ19wYXJzZV9jcyhzdHJ1Y3QgYW1kZ3B1X2Nz
X3BhcnNlciAqcGFyc2VyLCB1aW50MzJfdCBpYl9pZHgpDQogICAgICAgIHJldHVybiAwOw0KIH0N
Cg0KLXN0YXRpYyBpbnQgYW1kZ3B1X3V2ZF9zZW5kX21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJp
bmcsIHN0cnVjdCBhbWRncHVfYm8gKmJvLA0KK3N0YXRpYyBpbnQgYW1kZ3B1X3V2ZF9zZW5kX21z
ZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQ2NF90IGFkZHIsDQogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgYm9vbCBkaXJlY3QsIHN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZSkN
CiB7DQogICAgICAgIHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gcmluZy0+YWRldjsNCkBA
IC0xMDc0LDI5ICsxMTAzLDE1IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3V2ZF9zZW5kX21zZyhzdHJ1
Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHN0cnVjdCBhbWRncHVfYm8gKmJvLA0KICAgICAgICBzdHJ1
Y3QgYW1kZ3B1X2pvYiAqam9iOw0KICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2liICppYjsNCiAgICAg
ICAgdWludDMyX3QgZGF0YVs0XTsNCi0gICAgICAgdWludDY0X3QgYWRkcjsNCiAgICAgICAgbG9u
ZyByOw0KICAgICAgICBpbnQgaTsNCiAgICAgICAgdW5zaWduZWQgb2Zmc2V0X2lkeCA9IDA7DQog
ICAgICAgIHVuc2lnbmVkIG9mZnNldFszXSA9IHsgVVZEX0JBU0VfU0ksIDAsIDAgfTsNCg0KLSAg
ICAgICBhbWRncHVfYm9fa3VubWFwKGJvKTsNCi0gICAgICAgYW1kZ3B1X2JvX3VucGluKGJvKTsN
Ci0NCi0gICAgICAgaWYgKCFyaW5nLT5hZGV2LT51dmQuYWRkcmVzc182NF9iaXQpIHsNCi0gICAg
ICAgICAgICAgICBzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggY3R4ID0geyB0cnVlLCBmYWxzZSB9
Ow0KLQ0KLSAgICAgICAgICAgICAgIGFtZGdwdV9ib19wbGFjZW1lbnRfZnJvbV9kb21haW4oYm8s
IEFNREdQVV9HRU1fRE9NQUlOX1ZSQU0pOw0KLSAgICAgICAgICAgICAgIGFtZGdwdV91dmRfZm9y
Y2VfaW50b191dmRfc2VnbWVudChibyk7DQotICAgICAgICAgICAgICAgciA9IHR0bV9ib192YWxp
ZGF0ZSgmYm8tPnRibywgJmJvLT5wbGFjZW1lbnQsICZjdHgpOw0KLSAgICAgICAgICAgICAgIGlm
IChyKQ0KLSAgICAgICAgICAgICAgICAgICAgICAgZ290byBlcnI7DQotICAgICAgIH0NCi0NCiAg
ICAgICAgciA9IGFtZGdwdV9qb2JfYWxsb2Nfd2l0aF9pYihhZGV2LCA2NCwgZGlyZWN0ID8gQU1E
R1BVX0lCX1BPT0xfRElSRUNUIDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBBTURHUFVfSUJfUE9PTF9ERUxBWUVELCAmam9iKTsNCiAgICAgICAgaWYgKHIpDQotICAgICAg
ICAgICAgICAgZ290byBlcnI7DQorICAgICAgICAgICAgICAgcmV0dXJuIHI7DQoNCiAgICAgICAg
aWYgKGFkZXYtPmFzaWNfdHlwZSA+PSBDSElQX1ZFR0ExMCkgew0KICAgICAgICAgICAgICAgIG9m
ZnNldF9pZHggPSAxICsgcmluZy0+bWU7DQpAQCAtMTExMCw3ICsxMTI1LDYgQEAgc3RhdGljIGlu
dCBhbWRncHVfdXZkX3NlbmRfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgc3RydWN0IGFt
ZGdwdV9ibyAqYm8sDQogICAgICAgIGRhdGFbM10gPSBQQUNLRVQwKG9mZnNldFtvZmZzZXRfaWR4
XSArIFVWRF9OT19PUCwgMCk7DQoNCiAgICAgICAgaWIgPSAmam9iLT5pYnNbMF07DQotICAgICAg
IGFkZHIgPSBhbWRncHVfYm9fZ3B1X29mZnNldChibyk7DQogICAgICAgIGliLT5wdHJbMF0gPSBk
YXRhWzBdOw0KICAgICAgICBpYi0+cHRyWzFdID0gYWRkcjsNCiAgICAgICAgaWItPnB0clsyXSA9
IGRhdGFbMV07DQpAQCAtMTEyMywzMyArMTEzNywxMyBAQCBzdGF0aWMgaW50IGFtZGdwdV91dmRf
c2VuZF9tc2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCBzdHJ1Y3QgYW1kZ3B1X2JvICpibywN
CiAgICAgICAgfQ0KICAgICAgICBpYi0+bGVuZ3RoX2R3ID0gMTY7DQoNCi0gICAgICAgaWYgKGRp
cmVjdCkgew0KLSAgICAgICAgICAgICAgIHIgPSBkbWFfcmVzdl93YWl0X3RpbWVvdXQoYm8tPnRi
by5iYXNlLnJlc3YsIHRydWUsIGZhbHNlLA0KLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbXNlY3NfdG9famlmZmllcygxMCkpOw0KLSAgICAgICAgICAgICAgIGlmIChy
ID09IDApDQotICAgICAgICAgICAgICAgICAgICAgICByID0gLUVUSU1FRE9VVDsNCi0gICAgICAg
ICAgICAgICBpZiAociA8IDApDQotICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGVycl9mcmVl
Ow0KLQ0KKyAgICAgICBpZiAoZGlyZWN0KQ0KICAgICAgICAgICAgICAgIHIgPSBhbWRncHVfam9i
X3N1Ym1pdF9kaXJlY3Qoam9iLCByaW5nLCAmZik7DQotICAgICAgICAgICAgICAgaWYgKHIpDQot
ICAgICAgICAgICAgICAgICAgICAgICBnb3RvIGVycl9mcmVlOw0KLSAgICAgICB9IGVsc2Ugew0K
LSAgICAgICAgICAgICAgIHIgPSBhbWRncHVfc3luY19yZXN2KGFkZXYsICZqb2ItPnN5bmMsIGJv
LT50Ym8uYmFzZS5yZXN2LA0KLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFN
REdQVV9TWU5DX0FMV0FZUywNCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBB
TURHUFVfRkVOQ0VfT1dORVJfVU5ERUZJTkVEKTsNCi0gICAgICAgICAgICAgICBpZiAocikNCi0g
ICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZXJyX2ZyZWU7DQotDQorICAgICAgIGVsc2UNCiAg
ICAgICAgICAgICAgICByID0gYW1kZ3B1X2pvYl9zdWJtaXQoam9iLCAmYWRldi0+dXZkLmVudGl0
eSwNCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQU1ER1BVX0ZFTkNFX09X
TkVSX1VOREVGSU5FRCwgJmYpOw0KLSAgICAgICAgICAgICAgIGlmIChyKQ0KLSAgICAgICAgICAg
ICAgICAgICAgICAgZ290byBlcnJfZnJlZTsNCi0gICAgICAgfQ0KLQ0KLSAgICAgICBhbWRncHVf
Ym9fZmVuY2UoYm8sIGYsIGZhbHNlKTsNCi0gICAgICAgYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7
DQotICAgICAgIGFtZGdwdV9ib191bnJlZigmYm8pOw0KKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBBTURHUFVfRkVOQ0VfT1dORVJfVU5ERUZJTkVELCAmZik7DQorICAgICAgIGlmIChy
KQ0KKyAgICAgICAgICAgICAgIGdvdG8gZXJyX2ZyZWU7DQoNCiAgICAgICAgaWYgKGZlbmNlKQ0K
ICAgICAgICAgICAgICAgICpmZW5jZSA9IGRtYV9mZW5jZV9nZXQoZik7DQpAQCAtMTE1OSwxMCAr
MTE1Myw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3V2ZF9zZW5kX21zZyhzdHJ1Y3QgYW1kZ3B1X3Jp
bmcgKnJpbmcsIHN0cnVjdCBhbWRncHVfYm8gKmJvLA0KDQogZXJyX2ZyZWU6DQogICAgICAgIGFt
ZGdwdV9qb2JfZnJlZShqb2IpOw0KLQ0KLWVycjoNCi0gICAgICAgYW1kZ3B1X2JvX3VucmVzZXJ2
ZShibyk7DQotICAgICAgIGFtZGdwdV9ib191bnJlZigmYm8pOw0KICAgICAgICByZXR1cm4gcjsN
CiB9DQoNCkBAIC0xMTczLDE2ICsxMTYzLDMxIEBAIGludCBhbWRncHVfdXZkX2dldF9jcmVhdGVf
bXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgdWludDMyX3QgaGFuZGxlLA0KICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKQ0KIHsNCiAgICAg
ICAgc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5nLT5hZGV2Ow0KLSAgICAgICBzdHJ1
Y3QgYW1kZ3B1X2JvICpibyA9IE5VTEw7DQorICAgICAgIHN0cnVjdCBhbWRncHVfYm8gKmJvID0g
YWRldi0+dXZkLmliX2JvOw0KKyAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmID0gTlVMTDsNCisg
ICAgICAgc3RydWN0IGFtZGdwdV9pYiBpYjsNCiAgICAgICAgdWludDMyX3QgKm1zZzsNCiAgICAg
ICAgaW50IHIsIGk7DQoNCi0gICAgICAgciA9IGFtZGdwdV9ib19jcmVhdGVfcmVzZXJ2ZWQoYWRl
diwgMTAyNCwgUEFHRV9TSVpFLA0KLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBBTURHUFVfR0VNX0RPTUFJTl9HVFQsDQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZibywgTlVMTCwgKHZvaWQgKiopJm1zZyk7DQotICAgICAgIGlmIChyKQ0KLSAgICAg
ICAgICAgICAgIHJldHVybiByOw0KLQ0KKyAgICAgICBpZiAoYm8pIHsNCisgICAgICAgICAgICAg
ICByID0gdHRtX2JvX3Jlc2VydmUoJmJvLT50Ym8sIHRydWUsIHRydWUsIE5VTEwpOw0KKyAgICAg
ICAgICAgICAgIGlmIChyKQ0KKyAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7DQorICAg
ICAgICAgICAgICAgciA9IGRtYV9yZXN2X3dhaXRfdGltZW91dChiby0+dGJvLmJhc2UucmVzdiwg
dHJ1ZSwgZmFsc2UsDQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZWNzX3RvX2pp
ZmZpZXMoMTApKTsNCisgICAgICAgICAgICAgICBpZiAociA9PSAwKQ0KKyAgICAgICAgICAgICAg
ICAgICAgICAgciA9IC1FVElNRURPVVQ7DQorICAgICAgICAgICAgICAgaWYgKHIgPCAwKQ0KKyAg
ICAgICAgICAgICAgICAgICAgICAgZ290byBlcnI7DQorICAgICAgICAgICAgICAgaWIuZ3B1X2Fk
ZHIgPSBhbWRncHVfYm9fZ3B1X29mZnNldChibyk7DQorICAgICAgICAgICAgICAgbXNnID0gYW1k
Z3B1X2JvX2twdHIoYm8pOw0KKyAgICAgICB9IGVsc2Ugew0KKyAgICAgICAgICAgICAgIG1lbXNl
dCgmaWIsIDAsIHNpemVvZihpYikpOw0KKyAgICAgICAgICAgICAgIHIgPSBhbWRncHVfaWJfZ2V0
KGFkZXYsIE5VTEwsIFBBR0VfU0laRSwNCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
QU1ER1BVX0lCX1BPT0xfRElSRUNULA0KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAm
aWIpOw0KKyAgICAgICAgICAgICAgIG1zZyA9IGliLnB0cjsNCisgICAgICAgfQ0KICAgICAgICAv
KiBzdGl0Y2ggdG9nZXRoZXIgYW4gVVZEIGNyZWF0ZSBtc2cgKi8NCiAgICAgICAgbXNnWzBdID0g
Y3B1X3RvX2xlMzIoMHgwMDAwMGRlNCk7DQogICAgICAgIG1zZ1sxXSA9IGNwdV90b19sZTMyKDB4
MDAwMDAwMDApOw0KQEAgLTExOTgsMjMgKzEyMDMsNTIgQEAgaW50IGFtZGdwdV91dmRfZ2V0X2Ny
ZWF0ZV9tc2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCB1aW50MzJfdCBoYW5kbGUsDQogICAg
ICAgIGZvciAoaSA9IDExOyBpIDwgMTAyNDsgKytpKQ0KICAgICAgICAgICAgICAgIG1zZ1tpXSA9
IGNwdV90b19sZTMyKDB4MCk7DQoNCi0gICAgICAgcmV0dXJuIGFtZGdwdV91dmRfc2VuZF9tc2co
cmluZywgYm8sIHRydWUsIGZlbmNlKTsNCisgICAgICAgciA9IGFtZGdwdV91dmRfc2VuZF9tc2co
cmluZywgaWIuZ3B1X2FkZHIsIHRydWUsICZmKTsNCisgICAgICAgaWYgKHIpDQorICAgICAgICAg
ICAgICAgZ290byBlcnI7DQorICAgICAgIGlmIChibykNCisgICAgICAgICAgICAgICBhbWRncHVf
Ym9fZmVuY2UoYm8sIGYsIGZhbHNlKTsNCisgICAgICAgaWYgKGZlbmNlKQ0KKyAgICAgICAgICAg
ICAgICpmZW5jZSA9IGRtYV9mZW5jZV9nZXQoZik7DQorZXJyOg0KKyAgICAgICBpZiAoYm8pDQor
ICAgICAgICAgICAgICAgYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7DQorICAgICAgIGVsc2UNCisg
ICAgICAgICAgICAgICBhbWRncHVfaWJfZnJlZShhZGV2LCAmaWIsIGYpOw0KKyAgICAgICBkbWFf
ZmVuY2VfcHV0KGYpOw0KKyAgICAgICByZXR1cm4gcjsNCiB9DQoNCiBpbnQgYW1kZ3B1X3V2ZF9n
ZXRfZGVzdHJveV9tc2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCB1aW50MzJfdCBoYW5kbGUs
DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBkaXJlY3QsIHN0cnVjdCBkbWFf
ZmVuY2UgKipmZW5jZSkNCiB7DQogICAgICAgIHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0g
cmluZy0+YWRldjsNCi0gICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8gPSBOVUxMOw0KKyAgICAg
ICBzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IGFkZXYtPnV2ZC5pYl9ibzsNCisgICAgICAgc3RydWN0
IGRtYV9mZW5jZSAqZiA9IE5VTEw7DQorICAgICAgIHN0cnVjdCBhbWRncHVfaWIgaWI7DQogICAg
ICAgIHVpbnQzMl90ICptc2c7DQogICAgICAgIGludCByLCBpOw0KDQotICAgICAgIHIgPSBhbWRn
cHVfYm9fY3JlYXRlX3Jlc2VydmVkKGFkZXYsIDEwMjQsIFBBR0VfU0laRSwNCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgQU1ER1BVX0dFTV9ET01BSU5fR1RULA0KLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmYm8sIE5VTEwsICh2b2lkICoqKSZtc2cp
Ow0KLSAgICAgICBpZiAocikNCi0gICAgICAgICAgICAgICByZXR1cm4gcjsNCi0NCisgICAgICAg
aWYgKGJvKSB7DQorICAgICAgICAgICAgICAgciA9IHR0bV9ib19yZXNlcnZlKCZiby0+dGJvLCB0
cnVlLCB0cnVlLCBOVUxMKTsNCisgICAgICAgICAgICAgICBpZiAocikNCisgICAgICAgICAgICAg
ICAgICAgICAgIHJldHVybiByOw0KKyAgICAgICAgICAgICAgIHIgPSBkbWFfcmVzdl93YWl0X3Rp
bWVvdXQoYm8tPnRiby5iYXNlLnJlc3YsIHRydWUsIGZhbHNlLA0KKyAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBtc2Vjc190b19qaWZmaWVzKDEwKSk7DQorICAgICAgICAgICAgICAgaWYg
KHIgPT0gMCkNCisgICAgICAgICAgICAgICAgICAgICAgIHIgPSAtRVRJTUVET1VUOw0KKyAgICAg
ICAgICAgICAgIGlmIChyIDwgMCkNCisgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gZXJyOw0K
KyAgICAgICAgICAgICAgIGliLmdwdV9hZGRyID0gYW1kZ3B1X2JvX2dwdV9vZmZzZXQoYm8pOw0K
KyAgICAgICAgICAgICAgIG1zZyA9IGFtZGdwdV9ib19rcHRyKGJvKTsNCisgICAgICAgfSBlbHNl
IHsNCisgICAgICAgICAgICAgICBtZW1zZXQoJmliLCAwLCBzaXplb2YoaWIpKTsNCisgICAgICAg
ICAgICAgICByID0gYW1kZ3B1X2liX2dldChhZGV2LCBOVUxMLCBQQUdFX1NJWkUsDQorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdCA/DQorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEFNREdQVV9JQl9QT09MX0RJUkVDVCA6IEFNREdQVV9JQl9QT09MX0RFTEFZRUQs
DQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZpYik7DQorICAgICAgICAgICAgICAg
bXNnID0gaWIucHRyOw0KKyAgICAgICB9DQogICAgICAgIC8qIHN0aXRjaCB0b2dldGhlciBhbiBV
VkQgZGVzdHJveSBtc2cgKi8NCiAgICAgICAgbXNnWzBdID0gY3B1X3RvX2xlMzIoMHgwMDAwMGRl
NCk7DQogICAgICAgIG1zZ1sxXSA9IGNwdV90b19sZTMyKDB4MDAwMDAwMDIpOw0KQEAgLTEyMjMs
NyArMTI1NywyMCBAQCBpbnQgYW1kZ3B1X3V2ZF9nZXRfZGVzdHJveV9tc2coc3RydWN0IGFtZGdw
dV9yaW5nICpyaW5nLCB1aW50MzJfdCBoYW5kbGUsDQogICAgICAgIGZvciAoaSA9IDQ7IGkgPCAx
MDI0OyArK2kpDQogICAgICAgICAgICAgICAgbXNnW2ldID0gY3B1X3RvX2xlMzIoMHgwKTsNCg0K
LSAgICAgICByZXR1cm4gYW1kZ3B1X3V2ZF9zZW5kX21zZyhyaW5nLCBibywgZGlyZWN0LCBmZW5j
ZSk7DQorICAgICAgIHIgPSBhbWRncHVfdXZkX3NlbmRfbXNnKHJpbmcsIGliLmdwdV9hZGRyLCB0
cnVlLCAmZik7DQorICAgICAgIGlmIChyKQ0KKyAgICAgICAgICAgICAgIGdvdG8gZXJyOw0KKyAg
ICAgICBpZiAoYm8pDQorICAgICAgICAgICAgICAgYW1kZ3B1X2JvX2ZlbmNlKGJvLCBmLCBmYWxz
ZSk7DQorICAgICAgIGlmIChmZW5jZSkNCisgICAgICAgICAgICAgICAqZmVuY2UgPSBkbWFfZmVu
Y2VfZ2V0KGYpOw0KK2VycjoNCisgICAgICAgaWYgKGJvKQ0KKyAgICAgICAgICAgICAgIGFtZGdw
dV9ib191bnJlc2VydmUoYm8pOw0KKyAgICAgICBlbHNlDQorICAgICAgICAgICAgICAgYW1kZ3B1
X2liX2ZyZWUoYWRldiwgJmliLCBmKTsNCisgICAgICAgZG1hX2ZlbmNlX3B1dChmKTsNCisgICAg
ICAgcmV0dXJuIHI7DQogfQ0KDQogc3RhdGljIHZvaWQgYW1kZ3B1X3V2ZF9pZGxlX3dvcmtfaGFu
ZGxlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X3V2ZC5oDQppbmRleCBlZGJiODE5NGVlODEuLjc2YWM5Njk5ODg1ZCAxMDA2NDQNCi0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91dmQuaA0KKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5oDQpAQCAtNjgsNiArNjgsNyBAQCBzdHJ1
Y3QgYW1kZ3B1X3V2ZCB7DQogICAgICAgIC8qIHN0b3JlIGltYWdlIHdpZHRoIHRvIGFkanVzdCBu
YiBtZW1vcnkgc3RhdGUgKi8NCiAgICAgICAgdW5zaWduZWQgICAgICAgICAgICAgICAgZGVjb2Rl
X2ltYWdlX3dpZHRoOw0KICAgICAgICB1aW50MzJfdCAgICAgICAgICAgICAgICBrZXlzZWxlY3Q7
DQorICAgICAgIHN0cnVjdCBhbWRncHVfYm8gICAgICAgICppYl9ibzsNCiB9Ow0KDQogaW50IGFt
ZGdwdV91dmRfc3dfaW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7DQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZjZS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZjZS5jDQppbmRleCBlOWZkZjQ5ZDY5ZTguLjQ1ZDk4Njk0
ZGIxOCAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92Y2Uu
Yw0KKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZjZS5jDQpAQCAtODIs
NyArODIsNiBAQCBNT0RVTEVfRklSTVdBUkUoRklSTVdBUkVfVkVHQTIwKTsNCg0KIHN0YXRpYyB2
b2lkIGFtZGdwdV92Y2VfaWRsZV93b3JrX2hhbmRsZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KTsNCiBzdGF0aWMgaW50IGFtZGdwdV92Y2VfZ2V0X2NyZWF0ZV9tc2coc3RydWN0IGFtZGdwdV9y
aW5nICpyaW5nLCB1aW50MzJfdCBoYW5kbGUsDQotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8sDQogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKTsNCiBzdGF0aWMgaW50IGFtZGdw
dV92Y2VfZ2V0X2Rlc3Ryb3lfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgdWludDMyX3Qg
aGFuZGxlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGRpcmVj
dCwgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKTsNCkBAIC00NDEsNyArNDQwLDYgQEAgdm9pZCBh
bWRncHVfdmNlX2ZyZWVfaGFuZGxlcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0
IGRybV9maWxlICpmaWxwKQ0KICAqIE9wZW4gdXAgYSBzdHJlYW0gZm9yIEhXIHRlc3QNCiAgKi8N
CiBzdGF0aWMgaW50IGFtZGdwdV92Y2VfZ2V0X2NyZWF0ZV9tc2coc3RydWN0IGFtZGdwdV9yaW5n
ICpyaW5nLCB1aW50MzJfdCBoYW5kbGUsDQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKQ0KIHsNCiAgICAgICAgY29uc3QgdW5z
aWduZWQgaWJfc2l6ZV9kdyA9IDEwMjQ7DQpAQCAtNDUxLDE0ICs0NDksMTMgQEAgc3RhdGljIGlu
dCBhbWRncHVfdmNlX2dldF9jcmVhdGVfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgdWlu
dDMyX3QgaGFuZGxlLA0KICAgICAgICB1aW50NjRfdCBhZGRyOw0KICAgICAgICBpbnQgaSwgcjsN
Cg0KLSAgICAgICByID0gYW1kZ3B1X2pvYl9hbGxvY193aXRoX2liKHJpbmctPmFkZXYsIGliX3Np
emVfZHcgKiA0LA0KKyAgICAgICByID0gYW1kZ3B1X2pvYl9hbGxvY193aXRoX2liKHJpbmctPmFk
ZXYsIGliX3NpemVfZHcgKiA0ICsgUEFHRV9TSVpFLA0KICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEFNREdQVV9JQl9QT09MX0RJUkVDVCwgJmpvYik7DQogICAgICAgIGlmIChy
KQ0KICAgICAgICAgICAgICAgIHJldHVybiByOw0KDQogICAgICAgIGliID0gJmpvYi0+aWJzWzBd
Ow0KLQ0KLSAgICAgICBhZGRyID0gYW1kZ3B1X2JvX2dwdV9vZmZzZXQoYm8pOw0KKyAgICAgICBh
ZGRyID0gaWItPmdwdV9hZGRyICsgaWJfc2l6ZV9kdyAqIDQ7DQoNCiAgICAgICAgLyogc3RpdGNo
IHRvZ2V0aGVyIGFuIFZDRSBjcmVhdGUgbXNnICovDQogICAgICAgIGliLT5sZW5ndGhfZHcgPSAw
Ow0KQEAgLTExMzQsMjAgKzExMzEsMTMgQEAgaW50IGFtZGdwdV92Y2VfcmluZ190ZXN0X3Jpbmco
c3RydWN0IGFtZGdwdV9yaW5nICpyaW5nKQ0KIGludCBhbWRncHVfdmNlX3JpbmdfdGVzdF9pYihz
dHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIGxvbmcgdGltZW91dCkNCiB7DQogICAgICAgIHN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlID0gTlVMTDsNCi0gICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8g
PSBOVUxMOw0KICAgICAgICBsb25nIHI7DQoNCiAgICAgICAgLyogc2tpcCB2Y2UgcmluZzEvMiBp
YiB0ZXN0IGZvciBub3csIHNpbmNlIGl0J3Mgbm90IHJlbGlhYmxlICovDQogICAgICAgIGlmIChy
aW5nICE9ICZyaW5nLT5hZGV2LT52Y2UucmluZ1swXSkNCiAgICAgICAgICAgICAgICByZXR1cm4g
MDsNCg0KLSAgICAgICByID0gYW1kZ3B1X2JvX2NyZWF0ZV9yZXNlcnZlZChyaW5nLT5hZGV2LCA1
MTIsIFBBR0VfU0laRSwNCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQU1E
R1BVX0dFTV9ET01BSU5fVlJBTSwNCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgJmJvLCBOVUxMLCBOVUxMKTsNCi0gICAgICAgaWYgKHIpDQotICAgICAgICAgICAgICAgcmV0
dXJuIHI7DQotDQotICAgICAgIHIgPSBhbWRncHVfdmNlX2dldF9jcmVhdGVfbXNnKHJpbmcsIDEs
IGJvLCBOVUxMKTsNCisgICAgICAgciA9IGFtZGdwdV92Y2VfZ2V0X2NyZWF0ZV9tc2cocmluZywg
MSwgTlVMTCk7DQogICAgICAgIGlmIChyKQ0KICAgICAgICAgICAgICAgIGdvdG8gZXJyb3I7DQoN
CkBAIC0xMTYzLDggKzExNTMsNiBAQCBpbnQgYW1kZ3B1X3ZjZV9yaW5nX3Rlc3RfaWIoc3RydWN0
IGFtZGdwdV9yaW5nICpyaW5nLCBsb25nIHRpbWVvdXQpDQoNCiBlcnJvcjoNCiAgICAgICAgZG1h
X2ZlbmNlX3B1dChmZW5jZSk7DQotICAgICAgIGFtZGdwdV9ib191bnJlc2VydmUoYm8pOw0KLSAg
ICAgICBhbWRncHVfYm9fZnJlZV9rZXJuZWwoJmJvLCBOVUxMLCBOVUxMKTsNCiAgICAgICAgcmV0
dXJuIHI7DQogfQ0KDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3Zjbi5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Zjbi5jDQppbmRl
eCA1NjEyOTZhODViNDMuLmI2MGQ1ZjAxZmRhZSAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV92Y24uYw0KKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X3Zjbi5jDQpAQCAtNTQxLDE1ICs1NDEsMTQgQEAgaW50IGFtZGdwdV92Y25fZGVj
X3N3X3JpbmdfdGVzdF9yaW5nKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykNCiB9DQoNCiBzdGF0
aWMgaW50IGFtZGdwdV92Y25fZGVjX3NlbmRfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywN
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8s
DQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKipm
ZW5jZSkNCisgICAgICAgICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2liICppYl9tc2csDQorICAgICAg
ICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKQ0KIHsNCiAgICAgICAgc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5nLT5hZGV2Ow0KICAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNl
ICpmID0gTlVMTDsNCiAgICAgICAgc3RydWN0IGFtZGdwdV9qb2IgKmpvYjsNCiAgICAgICAgc3Ry
dWN0IGFtZGdwdV9pYiAqaWI7DQotICAgICAgIHVpbnQ2NF90IGFkZHI7DQotICAgICAgIHZvaWQg
Km1zZyA9IE5VTEw7DQorICAgICAgIHVpbnQ2NF90IGFkZHIgPSBpYl9tc2ctPmdwdV9hZGRyOw0K
ICAgICAgICBpbnQgaSwgcjsNCg0KICAgICAgICByID0gYW1kZ3B1X2pvYl9hbGxvY193aXRoX2li
KGFkZXYsIDY0LA0KQEAgLTU1OCw4ICs1NTcsNiBAQCBzdGF0aWMgaW50IGFtZGdwdV92Y25fZGVj
X3NlbmRfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywNCiAgICAgICAgICAgICAgICBnb3Rv
IGVycjsNCg0KICAgICAgICBpYiA9ICZqb2ItPmlic1swXTsNCi0gICAgICAgYWRkciA9IGFtZGdw
dV9ib19ncHVfb2Zmc2V0KGJvKTsNCi0gICAgICAgbXNnID0gYW1kZ3B1X2JvX2twdHIoYm8pOw0K
ICAgICAgICBpYi0+cHRyWzBdID0gUEFDS0VUMChhZGV2LT52Y24uaW50ZXJuYWwuZGF0YTAsIDAp
Ow0KICAgICAgICBpYi0+cHRyWzFdID0gYWRkcjsNCiAgICAgICAgaWItPnB0clsyXSA9IFBBQ0tF
VDAoYWRldi0+dmNuLmludGVybmFsLmRhdGExLCAwKTsNCkBAIC01NzYsOSArNTczLDcgQEAgc3Rh
dGljIGludCBhbWRncHVfdmNuX2RlY19zZW5kX21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcs
DQogICAgICAgIGlmIChyKQ0KICAgICAgICAgICAgICAgIGdvdG8gZXJyX2ZyZWU7DQoNCi0gICAg
ICAgYW1kZ3B1X2JvX2ZlbmNlKGJvLCBmLCBmYWxzZSk7DQotICAgICAgIGFtZGdwdV9ib191bnJl
c2VydmUoYm8pOw0KLSAgICAgICBhbWRncHVfYm9fZnJlZV9rZXJuZWwoJmJvLCBOVUxMLCAodm9p
ZCAqKikmbXNnKTsNCisgICAgICAgYW1kZ3B1X2liX2ZyZWUoYWRldiwgaWJfbXNnLCBmKTsNCg0K
ICAgICAgICBpZiAoZmVuY2UpDQogICAgICAgICAgICAgICAgKmZlbmNlID0gZG1hX2ZlbmNlX2dl
dChmKTsNCkBAIC01ODgsMjcgKzU4MywyNiBAQCBzdGF0aWMgaW50IGFtZGdwdV92Y25fZGVjX3Nl
bmRfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywNCg0KIGVycl9mcmVlOg0KICAgICAgICBh
bWRncHVfam9iX2ZyZWUoam9iKTsNCi0NCiBlcnI6DQotICAgICAgIGFtZGdwdV9ib191bnJlc2Vy
dmUoYm8pOw0KLSAgICAgICBhbWRncHVfYm9fZnJlZV9rZXJuZWwoJmJvLCBOVUxMLCAodm9pZCAq
KikmbXNnKTsNCisgICAgICAgYW1kZ3B1X2liX2ZyZWUoYWRldiwgaWJfbXNnLCBmKTsNCiAgICAg
ICAgcmV0dXJuIHI7DQogfQ0KDQogc3RhdGljIGludCBhbWRncHVfdmNuX2RlY19nZXRfY3JlYXRl
X21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQzMl90IGhhbmRsZSwNCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9ibyAqKmJvKQ0K
KyAgICAgICAgICAgICAgIHN0cnVjdCBhbWRncHVfaWIgKmliKQ0KIHsNCiAgICAgICAgc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5nLT5hZGV2Ow0KICAgICAgICB1aW50MzJfdCAqbXNn
Ow0KICAgICAgICBpbnQgciwgaTsNCg0KLSAgICAgICAqYm8gPSBOVUxMOw0KLSAgICAgICByID0g
YW1kZ3B1X2JvX2NyZWF0ZV9yZXNlcnZlZChhZGV2LCAxMDI0LCBQQUdFX1NJWkUsDQotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFNREdQVV9HRU1fRE9NQUlOX1ZSQU0sDQot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvLCBOVUxMLCAodm9pZCAqKikm
bXNnKTsNCisgICAgICAgbWVtc2V0KGliLCAwLCBzaXplb2YoKmliKSk7DQorICAgICAgIHIgPSBh
bWRncHVfaWJfZ2V0KGFkZXYsIE5VTEwsIFBBR0VfU0laRSwNCisgICAgICAgICAgICAgICAgICAg
ICAgIEFNREdQVV9JQl9QT09MX0RJUkVDVCwNCisgICAgICAgICAgICAgICAgICAgICAgIGliKTsN
CiAgICAgICAgaWYgKHIpDQogICAgICAgICAgICAgICAgcmV0dXJuIHI7DQoNCisgICAgICAgbXNn
ID0gaWItPnB0cjsNCiAgICAgICAgbXNnWzBdID0gY3B1X3RvX2xlMzIoMHgwMDAwMDAyOCk7DQog
ICAgICAgIG1zZ1sxXSA9IGNwdV90b19sZTMyKDB4MDAwMDAwMzgpOw0KICAgICAgICBtc2dbMl0g
PSBjcHVfdG9fbGUzMigweDAwMDAwMDAxKTsNCkBAIC02MzAsMTkgKzYyNCwyMCBAQCBzdGF0aWMg
aW50IGFtZGdwdV92Y25fZGVjX2dldF9jcmVhdGVfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmlu
ZywgdWludDMyX3QgaGFuZA0KIH0NCg0KIHN0YXRpYyBpbnQgYW1kZ3B1X3Zjbl9kZWNfZ2V0X2Rl
c3Ryb3lfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgdWludDMyX3QgaGFuZGxlLA0KLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9ibyAq
KmJvKQ0KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFt
ZGdwdV9pYiAqaWIpDQogew0KICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IHJp
bmctPmFkZXY7DQogICAgICAgIHVpbnQzMl90ICptc2c7DQogICAgICAgIGludCByLCBpOw0KDQot
ICAgICAgICpibyA9IE5VTEw7DQotICAgICAgIHIgPSBhbWRncHVfYm9fY3JlYXRlX3Jlc2VydmVk
KGFkZXYsIDEwMjQsIFBBR0VfU0laRSwNCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgQU1ER1BVX0dFTV9ET01BSU5fVlJBTSwNCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgYm8sIE5VTEwsICh2b2lkICoqKSZtc2cpOw0KKyAgICAgICBtZW1zZXQoaWIs
IDAsIHNpemVvZigqaWIpKTsNCisgICAgICAgciA9IGFtZGdwdV9pYl9nZXQoYWRldiwgTlVMTCwg
UEFHRV9TSVpFLA0KKyAgICAgICAgICAgICAgICAgICAgICAgQU1ER1BVX0lCX1BPT0xfRElSRUNU
LA0KKyAgICAgICAgICAgICAgICAgICAgICAgaWIpOw0KICAgICAgICBpZiAocikNCiAgICAgICAg
ICAgICAgICByZXR1cm4gcjsNCg0KKyAgICAgICBtc2cgPSBpYi0+cHRyOw0KICAgICAgICBtc2db
MF0gPSBjcHVfdG9fbGUzMigweDAwMDAwMDI4KTsNCiAgICAgICAgbXNnWzFdID0gY3B1X3RvX2xl
MzIoMHgwMDAwMDAxOCk7DQogICAgICAgIG1zZ1syXSA9IGNwdV90b19sZTMyKDB4MDAwMDAwMDAp
Ow0KQEAgLTY1OCwyMSArNjUzLDIxIEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Zjbl9kZWNfZ2V0X2Rl
c3Ryb3lfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgdWludDMyX3QgaGFuDQogaW50IGFt
ZGdwdV92Y25fZGVjX3JpbmdfdGVzdF9pYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIGxvbmcg
dGltZW91dCkNCiB7DQogICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0gTlVMTDsNCi0g
ICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm87DQorICAgICAgIHN0cnVjdCBhbWRncHVfaWIgaWI7
DQogICAgICAgIGxvbmcgcjsNCg0KLSAgICAgICByID0gYW1kZ3B1X3Zjbl9kZWNfZ2V0X2NyZWF0
ZV9tc2cocmluZywgMSwgJmJvKTsNCisgICAgICAgciA9IGFtZGdwdV92Y25fZGVjX2dldF9jcmVh
dGVfbXNnKHJpbmcsIDEsICZpYik7DQogICAgICAgIGlmIChyKQ0KICAgICAgICAgICAgICAgIGdv
dG8gZXJyb3I7DQoNCi0gICAgICAgciA9IGFtZGdwdV92Y25fZGVjX3NlbmRfbXNnKHJpbmcsIGJv
LCBOVUxMKTsNCisgICAgICAgciA9IGFtZGdwdV92Y25fZGVjX3NlbmRfbXNnKHJpbmcsICZpYiwg
TlVMTCk7DQogICAgICAgIGlmIChyKQ0KICAgICAgICAgICAgICAgIGdvdG8gZXJyb3I7DQotICAg
ICAgIHIgPSBhbWRncHVfdmNuX2RlY19nZXRfZGVzdHJveV9tc2cocmluZywgMSwgJmJvKTsNCisg
ICAgICAgciA9IGFtZGdwdV92Y25fZGVjX2dldF9kZXN0cm95X21zZyhyaW5nLCAxLCAmaWIpOw0K
ICAgICAgICBpZiAocikNCiAgICAgICAgICAgICAgICBnb3RvIGVycm9yOw0KDQotICAgICAgIHIg
PSBhbWRncHVfdmNuX2RlY19zZW5kX21zZyhyaW5nLCBibywgJmZlbmNlKTsNCisgICAgICAgciA9
IGFtZGdwdV92Y25fZGVjX3NlbmRfbXNnKHJpbmcsICZpYiwgJmZlbmNlKTsNCiAgICAgICAgaWYg
KHIpDQogICAgICAgICAgICAgICAgZ290byBlcnJvcjsNCg0KQEAgLTY4OCw4ICs2ODMsOCBAQCBp
bnQgYW1kZ3B1X3Zjbl9kZWNfcmluZ190ZXN0X2liKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywg
bG9uZyB0aW1lb3V0KQ0KIH0NCg0KIHN0YXRpYyBpbnQgYW1kZ3B1X3Zjbl9kZWNfc3dfc2VuZF9t
c2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLA0KLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2JvICpibywNCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKQ0KKyAgICAgICAgICAgICAgIHN0cnVj
dCBhbWRncHVfaWIgKmliX21zZywNCisgICAgICAgICAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICoq
ZmVuY2UpDQogew0KICAgICAgICBzdHJ1Y3QgYW1kZ3B1X3Zjbl9kZWNvZGVfYnVmZmVyICpkZWNv
ZGVfYnVmZmVyID0gTlVMTDsNCiAgICAgICAgY29uc3QgdW5zaWduZWQgaW50IGliX3NpemVfZHcg
PSA2NDsNCkBAIC02OTcsNyArNjkyLDcgQEAgc3RhdGljIGludCBhbWRncHVfdmNuX2RlY19zd19z
ZW5kX21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsDQogICAgICAgIHN0cnVjdCBkbWFfZmVu
Y2UgKmYgPSBOVUxMOw0KICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2pvYiAqam9iOw0KICAgICAgICBz
dHJ1Y3QgYW1kZ3B1X2liICppYjsNCi0gICAgICAgdWludDY0X3QgYWRkcjsNCisgICAgICAgdWlu
dDY0X3QgYWRkciA9IGliX21zZy0+Z3B1X2FkZHI7DQogICAgICAgIGludCBpLCByOw0KDQogICAg
ICAgIHIgPSBhbWRncHVfam9iX2FsbG9jX3dpdGhfaWIoYWRldiwgaWJfc2l6ZV9kdyAqIDQsDQpA
QCAtNzA2LDcgKzcwMSw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Zjbl9kZWNfc3dfc2VuZF9tc2co
c3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLA0KICAgICAgICAgICAgICAgIGdvdG8gZXJyOw0KDQog
ICAgICAgIGliID0gJmpvYi0+aWJzWzBdOw0KLSAgICAgICBhZGRyID0gYW1kZ3B1X2JvX2dwdV9v
ZmZzZXQoYm8pOw0KICAgICAgICBpYi0+bGVuZ3RoX2R3ID0gMDsNCg0KICAgICAgICBpYi0+cHRy
W2liLT5sZW5ndGhfZHcrK10gPSBzaXplb2Yoc3RydWN0IGFtZGdwdV92Y25fZGVjb2RlX2J1ZmZl
cikgKyA4Ow0KQEAgLTcyNiw5ICs3MjAsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV92Y25fZGVjX3N3
X3NlbmRfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywNCiAgICAgICAgaWYgKHIpDQogICAg
ICAgICAgICAgICAgZ290byBlcnJfZnJlZTsNCg0KLSAgICAgICBhbWRncHVfYm9fZmVuY2UoYm8s
IGYsIGZhbHNlKTsNCi0gICAgICAgYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7DQotICAgICAgIGFt
ZGdwdV9ib191bnJlZigmYm8pOw0KKyAgICAgICBhbWRncHVfaWJfZnJlZShhZGV2LCBpYl9tc2cs
IGYpOw0KDQogICAgICAgIGlmIChmZW5jZSkNCiAgICAgICAgICAgICAgICAqZmVuY2UgPSBkbWFf
ZmVuY2VfZ2V0KGYpOw0KQEAgLTczOCwzMSArNzMwLDI5IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3Zj
bl9kZWNfc3dfc2VuZF9tc2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLA0KDQogZXJyX2ZyZWU6
DQogICAgICAgIGFtZGdwdV9qb2JfZnJlZShqb2IpOw0KLQ0KIGVycjoNCi0gICAgICAgYW1kZ3B1
X2JvX3VucmVzZXJ2ZShibyk7DQotICAgICAgIGFtZGdwdV9ib191bnJlZigmYm8pOw0KKyAgICAg
ICBhbWRncHVfaWJfZnJlZShhZGV2LCBpYl9tc2csIGYpOw0KICAgICAgICByZXR1cm4gcjsNCiB9
DQoNCiBpbnQgYW1kZ3B1X3Zjbl9kZWNfc3dfcmluZ190ZXN0X2liKHN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZywgbG9uZyB0aW1lb3V0KQ0KIHsNCiAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVu
Y2UgPSBOVUxMOw0KLSAgICAgICBzdHJ1Y3QgYW1kZ3B1X2JvICpibzsNCisgICAgICAgc3RydWN0
IGFtZGdwdV9pYiBpYjsNCiAgICAgICAgbG9uZyByOw0KDQotICAgICAgIHIgPSBhbWRncHVfdmNu
X2RlY19nZXRfY3JlYXRlX21zZyhyaW5nLCAxLCAmYm8pOw0KKyAgICAgICByID0gYW1kZ3B1X3Zj
bl9kZWNfZ2V0X2NyZWF0ZV9tc2cocmluZywgMSwgJmliKTsNCiAgICAgICAgaWYgKHIpDQogICAg
ICAgICAgICAgICAgZ290byBlcnJvcjsNCg0KLSAgICAgICByID0gYW1kZ3B1X3Zjbl9kZWNfc3df
c2VuZF9tc2cocmluZywgYm8sIE5VTEwpOw0KKyAgICAgICByID0gYW1kZ3B1X3Zjbl9kZWNfc3df
c2VuZF9tc2cocmluZywgJmliLCBOVUxMKTsNCiAgICAgICAgaWYgKHIpDQogICAgICAgICAgICAg
ICAgZ290byBlcnJvcjsNCi0gICAgICAgciA9IGFtZGdwdV92Y25fZGVjX2dldF9kZXN0cm95X21z
ZyhyaW5nLCAxLCAmYm8pOw0KKyAgICAgICByID0gYW1kZ3B1X3Zjbl9kZWNfZ2V0X2Rlc3Ryb3lf
bXNnKHJpbmcsIDEsICZpYik7DQogICAgICAgIGlmIChyKQ0KICAgICAgICAgICAgICAgIGdvdG8g
ZXJyb3I7DQoNCi0gICAgICAgciA9IGFtZGdwdV92Y25fZGVjX3N3X3NlbmRfbXNnKHJpbmcsIGJv
LCAmZmVuY2UpOw0KKyAgICAgICByID0gYW1kZ3B1X3Zjbl9kZWNfc3dfc2VuZF9tc2cocmluZywg
JmliLCAmZmVuY2UpOw0KICAgICAgICBpZiAocikNCiAgICAgICAgICAgICAgICBnb3RvIGVycm9y
Ow0KDQpAQCAtODA5LDcgKzc5OSw3IEBAIGludCBhbWRncHVfdmNuX2VuY19yaW5nX3Rlc3Rfcmlu
ZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpDQogfQ0KDQogc3RhdGljIGludCBhbWRncHVfdmNu
X2VuY19nZXRfY3JlYXRlX21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQzMl90IGhh
bmRsZSwNCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFt
ZGdwdV9ibyAqYm8sDQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0
cnVjdCBhbWRncHVfaWIgKmliX21zZywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKQ0KIHsNCiAgICAgICAgY29uc3QgdW5z
aWduZWQgaWJfc2l6ZV9kdyA9IDE2Ow0KQEAgLTgyNSw3ICs4MTUsNyBAQCBzdGF0aWMgaW50IGFt
ZGdwdV92Y25fZW5jX2dldF9jcmVhdGVfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywgdWlu
dDMyX3QgaGFuZA0KICAgICAgICAgICAgICAgIHJldHVybiByOw0KDQogICAgICAgIGliID0gJmpv
Yi0+aWJzWzBdOw0KLSAgICAgICBhZGRyID0gYW1kZ3B1X2JvX2dwdV9vZmZzZXQoYm8pOw0KKyAg
ICAgICBhZGRyID0gaWJfbXNnLT5ncHVfYWRkcjsNCg0KICAgICAgICBpYi0+bGVuZ3RoX2R3ID0g
MDsNCiAgICAgICAgaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gMHgwMDAwMDAxODsNCkBAIC04
NjMsNyArODUzLDcgQEAgc3RhdGljIGludCBhbWRncHVfdmNuX2VuY19nZXRfY3JlYXRlX21zZyhz
dHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQzMl90IGhhbmQNCiB9DQoNCiBzdGF0aWMgaW50
IGFtZGdwdV92Y25fZW5jX2dldF9kZXN0cm95X21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcs
IHVpbnQzMl90IGhhbmRsZSwNCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHN0cnVjdCBhbWRncHVfYm8gKmJvLA0KKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9pYiAqaWJfbXNnLA0KICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqKmZlbmNlKQ0KIHsNCiAg
ICAgICAgY29uc3QgdW5zaWduZWQgaWJfc2l6ZV9kdyA9IDE2Ow0KQEAgLTg3OSw3ICs4NjksNyBA
QCBzdGF0aWMgaW50IGFtZGdwdV92Y25fZW5jX2dldF9kZXN0cm95X21zZyhzdHJ1Y3QgYW1kZ3B1
X3JpbmcgKnJpbmcsIHVpbnQzMl90IGhhbg0KICAgICAgICAgICAgICAgIHJldHVybiByOw0KDQog
ICAgICAgIGliID0gJmpvYi0+aWJzWzBdOw0KLSAgICAgICBhZGRyID0gYW1kZ3B1X2JvX2dwdV9v
ZmZzZXQoYm8pOw0KKyAgICAgICBhZGRyID0gaWJfbXNnLT5ncHVfYWRkcjsNCg0KICAgICAgICBp
Yi0+bGVuZ3RoX2R3ID0gMDsNCiAgICAgICAgaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gMHgw
MDAwMDAxODsNCkBAIC05MTgsMjEgKzkwOCwyMyBAQCBzdGF0aWMgaW50IGFtZGdwdV92Y25fZW5j
X2dldF9kZXN0cm95X21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQzMl90IGhhbg0K
DQogaW50IGFtZGdwdV92Y25fZW5jX3JpbmdfdGVzdF9pYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJp
bmcsIGxvbmcgdGltZW91dCkNCiB7DQorICAgICAgIHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
ID0gcmluZy0+YWRldjsNCiAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UgPSBOVUxMOw0K
LSAgICAgICBzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IE5VTEw7DQorICAgICAgIHN0cnVjdCBhbWRn
cHVfaWIgaWI7DQogICAgICAgIGxvbmcgcjsNCg0KLSAgICAgICByID0gYW1kZ3B1X2JvX2NyZWF0
ZV9yZXNlcnZlZChyaW5nLT5hZGV2LCAxMjggKiAxMDI0LCBQQUdFX1NJWkUsDQotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFNREdQVV9HRU1fRE9NQUlOX1ZSQU0sDQotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZibywgTlVMTCwgTlVMTCk7DQorICAg
ICAgIG1lbXNldCgmaWIsIDAsIHNpemVvZihpYikpOw0KKyAgICAgICByID0gYW1kZ3B1X2liX2dl
dChhZGV2LCBOVUxMLCAxMjggPDwgMTAsDQorICAgICAgICAgICAgICAgICAgICAgICBBTURHUFVf
SUJfUE9PTF9ESVJFQ1QsDQorICAgICAgICAgICAgICAgICAgICAgICAmaWIpOw0KICAgICAgICBp
ZiAocikNCiAgICAgICAgICAgICAgICByZXR1cm4gcjsNCg0KLSAgICAgICByID0gYW1kZ3B1X3Zj
bl9lbmNfZ2V0X2NyZWF0ZV9tc2cocmluZywgMSwgYm8sIE5VTEwpOw0KKyAgICAgICByID0gYW1k
Z3B1X3Zjbl9lbmNfZ2V0X2NyZWF0ZV9tc2cocmluZywgMSwgJmliLCBOVUxMKTsNCiAgICAgICAg
aWYgKHIpDQogICAgICAgICAgICAgICAgZ290byBlcnJvcjsNCg0KLSAgICAgICByID0gYW1kZ3B1
X3Zjbl9lbmNfZ2V0X2Rlc3Ryb3lfbXNnKHJpbmcsIDEsIGJvLCAmZmVuY2UpOw0KKyAgICAgICBy
ID0gYW1kZ3B1X3Zjbl9lbmNfZ2V0X2Rlc3Ryb3lfbXNnKHJpbmcsIDEsICZpYiwgJmZlbmNlKTsN
CiAgICAgICAgaWYgKHIpDQogICAgICAgICAgICAgICAgZ290byBlcnJvcjsNCg0KQEAgLTk0Myw5
ICs5MzUsOCBAQCBpbnQgYW1kZ3B1X3Zjbl9lbmNfcmluZ190ZXN0X2liKHN0cnVjdCBhbWRncHVf
cmluZyAqcmluZywgbG9uZyB0aW1lb3V0KQ0KICAgICAgICAgICAgICAgIHIgPSAwOw0KDQogZXJy
b3I6DQorICAgICAgIGFtZGdwdV9pYl9mcmVlKGFkZXYsICZpYiwgZmVuY2UpOw0KICAgICAgICBk
bWFfZmVuY2VfcHV0KGZlbmNlKTsNCi0gICAgICAgYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7DQot
ICAgICAgIGFtZGdwdV9ib19mcmVlX2tlcm5lbCgmYm8sIE5VTEwsIE5VTEwpOw0KDQogICAgICAg
IHJldHVybiByOw0KIH0NCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS91
dmRfdjZfMC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvdXZkX3Y2XzAuYw0KaW5kZXgg
YmM1NzE4MzM2MzJlLi45ODQ0MjQ2MjEzNWMgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS91dmRfdjZfMC5jDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS91
dmRfdjZfMC5jDQpAQCAtMjA2LDE0ICsyMDYsMTQgQEAgc3RhdGljIGludCB1dmRfdjZfMF9lbmNf
cmluZ190ZXN0X3Jpbmcoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nKQ0KICAqIE9wZW4gdXAgYSBz
dHJlYW0gZm9yIEhXIHRlc3QNCiAgKi8NCiBzdGF0aWMgaW50IHV2ZF92Nl8wX2VuY19nZXRfY3Jl
YXRlX21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQzMl90IGhhbmRsZSwNCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBhbWRncHVfYm8gKmJvLA0K
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9pYiAq
aWJfbXNnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGRt
YV9mZW5jZSAqKmZlbmNlKQ0KIHsNCiAgICAgICAgY29uc3QgdW5zaWduZWQgaWJfc2l6ZV9kdyA9
IDE2Ow0KICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2pvYiAqam9iOw0KICAgICAgICBzdHJ1Y3QgYW1k
Z3B1X2liICppYjsNCiAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZiA9IE5VTEw7DQotICAgICAg
IHVpbnQ2NF90IGFkZHI7DQorICAgICAgIHVpbnQ2NF90IGFkZHIgPSBpYl9tc2ctPmdwdV9hZGRy
Ow0KICAgICAgICBpbnQgaSwgcjsNCg0KICAgICAgICByID0gYW1kZ3B1X2pvYl9hbGxvY193aXRo
X2liKHJpbmctPmFkZXYsIGliX3NpemVfZHcgKiA0LA0KQEAgLTIyMiw3ICsyMjIsNiBAQCBzdGF0
aWMgaW50IHV2ZF92Nl8wX2VuY19nZXRfY3JlYXRlX21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJp
bmcsIHVpbnQzMl90IGhhbmRsZQ0KICAgICAgICAgICAgICAgIHJldHVybiByOw0KDQogICAgICAg
IGliID0gJmpvYi0+aWJzWzBdOw0KLSAgICAgICBhZGRyID0gYW1kZ3B1X2JvX2dwdV9vZmZzZXQo
Ym8pOw0KDQogICAgICAgIGliLT5sZW5ndGhfZHcgPSAwOw0KICAgICAgICBpYi0+cHRyW2liLT5s
ZW5ndGhfZHcrK10gPSAweDAwMDAwMDE4Ow0KQEAgLTI3MCwxNCArMjY5LDE0IEBAIHN0YXRpYyBp
bnQgdXZkX3Y2XzBfZW5jX2dldF9jcmVhdGVfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywg
dWludDMyX3QgaGFuZGxlDQogICovDQogc3RhdGljIGludCB1dmRfdjZfMF9lbmNfZ2V0X2Rlc3Ry
b3lfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywNCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICB1aW50MzJfdCBoYW5kbGUsDQotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8sDQorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9pYiAqaWJfbXNnLA0KICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKipmZW5j
ZSkNCiB7DQogICAgICAgIGNvbnN0IHVuc2lnbmVkIGliX3NpemVfZHcgPSAxNjsNCiAgICAgICAg
c3RydWN0IGFtZGdwdV9qb2IgKmpvYjsNCiAgICAgICAgc3RydWN0IGFtZGdwdV9pYiAqaWI7DQog
ICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmYgPSBOVUxMOw0KLSAgICAgICB1aW50NjRfdCBhZGRy
Ow0KKyAgICAgICB1aW50NjRfdCBhZGRyID0gaWJfbXNnLT5ncHVfYWRkcjsNCiAgICAgICAgaW50
IGksIHI7DQoNCiAgICAgICAgciA9IGFtZGdwdV9qb2JfYWxsb2Nfd2l0aF9pYihyaW5nLT5hZGV2
LCBpYl9zaXplX2R3ICogNCwNCkBAIC0yODYsNyArMjg1LDYgQEAgc3RhdGljIGludCB1dmRfdjZf
MF9lbmNfZ2V0X2Rlc3Ryb3lfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZywNCiAgICAgICAg
ICAgICAgICByZXR1cm4gcjsNCg0KICAgICAgICBpYiA9ICZqb2ItPmlic1swXTsNCi0gICAgICAg
YWRkciA9IGFtZGdwdV9ib19ncHVfb2Zmc2V0KGJvKTsNCg0KICAgICAgICBpYi0+bGVuZ3RoX2R3
ID0gMDsNCiAgICAgICAgaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gMHgwMDAwMDAxODsNCkBA
IC0zMzEsMjEgKzMyOSwyMyBAQCBzdGF0aWMgaW50IHV2ZF92Nl8wX2VuY19nZXRfZGVzdHJveV9t
c2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLA0KICAqLw0KIHN0YXRpYyBpbnQgdXZkX3Y2XzBf
ZW5jX3JpbmdfdGVzdF9pYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIGxvbmcgdGltZW91dCkN
CiB7DQorICAgICAgIHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gcmluZy0+YWRldjsNCiAg
ICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UgPSBOVUxMOw0KLSAgICAgICBzdHJ1Y3QgYW1k
Z3B1X2JvICpibyA9IE5VTEw7DQorICAgICAgIHN0cnVjdCBhbWRncHVfaWIgaWI7DQogICAgICAg
IGxvbmcgcjsNCg0KLSAgICAgICByID0gYW1kZ3B1X2JvX2NyZWF0ZV9yZXNlcnZlZChyaW5nLT5h
ZGV2LCAxMjggKiAxMDI0LCBQQUdFX1NJWkUsDQotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIEFNREdQVV9HRU1fRE9NQUlOX1ZSQU0sDQotICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZibywgTlVMTCwgTlVMTCk7DQorICAgICAgIG1lbXNldCgmaWIsIDAs
IHNpemVvZihpYikpOw0KKyAgICAgICByID0gYW1kZ3B1X2liX2dldChhZGV2LCBOVUxMLCAxMjgg
PDwgMTAsDQorICAgICAgICAgICAgICAgICAgICAgICBBTURHUFVfSUJfUE9PTF9ESVJFQ1QsDQor
ICAgICAgICAgICAgICAgICAgICAgICAmaWIpOw0KICAgICAgICBpZiAocikNCiAgICAgICAgICAg
ICAgICByZXR1cm4gcjsNCg0KLSAgICAgICByID0gdXZkX3Y2XzBfZW5jX2dldF9jcmVhdGVfbXNn
KHJpbmcsIDEsIGJvLCBOVUxMKTsNCisgICAgICAgciA9IHV2ZF92Nl8wX2VuY19nZXRfY3JlYXRl
X21zZyhyaW5nLCAxLCAmaWIsIE5VTEwpOw0KICAgICAgICBpZiAocikNCiAgICAgICAgICAgICAg
ICBnb3RvIGVycm9yOw0KDQotICAgICAgIHIgPSB1dmRfdjZfMF9lbmNfZ2V0X2Rlc3Ryb3lfbXNn
KHJpbmcsIDEsIGJvLCAmZmVuY2UpOw0KKyAgICAgICByID0gdXZkX3Y2XzBfZW5jX2dldF9kZXN0
cm95X21zZyhyaW5nLCAxLCAmaWIsICZmZW5jZSk7DQogICAgICAgIGlmIChyKQ0KICAgICAgICAg
ICAgICAgIGdvdG8gZXJyb3I7DQoNCkBAIC0zNTYsMTAgKzM1Niw4IEBAIHN0YXRpYyBpbnQgdXZk
X3Y2XzBfZW5jX3JpbmdfdGVzdF9pYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIGxvbmcgdGlt
ZW91dCkNCiAgICAgICAgICAgICAgICByID0gMDsNCg0KIGVycm9yOg0KKyAgICAgICBhbWRncHVf
aWJfZnJlZShhZGV2LCAmaWIsIGZlbmNlKTsNCiAgICAgICAgZG1hX2ZlbmNlX3B1dChmZW5jZSk7
DQotICAgICAgIGFtZGdwdV9ib191bnBpbihibyk7DQotICAgICAgIGFtZGdwdV9ib191bnJlc2Vy
dmUoYm8pOw0KLSAgICAgICBhbWRncHVfYm9fdW5yZWYoJmJvKTsNCiAgICAgICAgcmV0dXJuIHI7
DQogfQ0KDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvdXZkX3Y3XzAu
YyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3V2ZF92N18wLmMNCmluZGV4IGI2ZTgyZDc1
NTYxZi4uMzQ0MGVmNTU0Zjk5IDEwMDY0NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvdXZkX3Y3XzAuYw0KKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvdXZkX3Y3XzAu
Yw0KQEAgLTIxMywxNCArMjEzLDE0IEBAIHN0YXRpYyBpbnQgdXZkX3Y3XzBfZW5jX3JpbmdfdGVz
dF9yaW5nKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykNCiAgKiBPcGVuIHVwIGEgc3RyZWFtIGZv
ciBIVyB0ZXN0DQogICovDQogc3RhdGljIGludCB1dmRfdjdfMF9lbmNfZ2V0X2NyZWF0ZV9tc2co
c3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCB1aW50MzJfdCBoYW5kbGUsDQotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgYW1kZ3B1X2JvICpibywNCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBhbWRncHVfaWIgKmliX21zZywN
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2Ug
KipmZW5jZSkNCiB7DQogICAgICAgIGNvbnN0IHVuc2lnbmVkIGliX3NpemVfZHcgPSAxNjsNCiAg
ICAgICAgc3RydWN0IGFtZGdwdV9qb2IgKmpvYjsNCiAgICAgICAgc3RydWN0IGFtZGdwdV9pYiAq
aWI7DQogICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmYgPSBOVUxMOw0KLSAgICAgICB1aW50NjRf
dCBhZGRyOw0KKyAgICAgICB1aW50NjRfdCBhZGRyID0gaWJfbXNnLT5ncHVfYWRkcjsNCiAgICAg
ICAgaW50IGksIHI7DQoNCiAgICAgICAgciA9IGFtZGdwdV9qb2JfYWxsb2Nfd2l0aF9pYihyaW5n
LT5hZGV2LCBpYl9zaXplX2R3ICogNCwNCkBAIC0yMjksNyArMjI5LDYgQEAgc3RhdGljIGludCB1
dmRfdjdfMF9lbmNfZ2V0X2NyZWF0ZV9tc2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCB1aW50
MzJfdCBoYW5kbGUNCiAgICAgICAgICAgICAgICByZXR1cm4gcjsNCg0KICAgICAgICBpYiA9ICZq
b2ItPmlic1swXTsNCi0gICAgICAgYWRkciA9IGFtZGdwdV9ib19ncHVfb2Zmc2V0KGJvKTsNCg0K
ICAgICAgICBpYi0+bGVuZ3RoX2R3ID0gMDsNCiAgICAgICAgaWItPnB0cltpYi0+bGVuZ3RoX2R3
KytdID0gMHgwMDAwMDAxODsNCkBAIC0yNzYsMTQgKzI3NSwxNCBAQCBzdGF0aWMgaW50IHV2ZF92
N18wX2VuY19nZXRfY3JlYXRlX21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHVpbnQzMl90
IGhhbmRsZQ0KICAqIENsb3NlIHVwIGEgc3RyZWFtIGZvciBIVyB0ZXN0IG9yIGlmIHVzZXJzcGFj
ZSBmYWlsZWQgdG8gZG8gc28NCiAgKi8NCiBzdGF0aWMgaW50IHV2ZF92N18wX2VuY19nZXRfZGVz
dHJveV9tc2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCB1aW50MzJfdCBoYW5kbGUsDQotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9ibyAqYm8s
DQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGFtZGdwdV9p
YiAqaWJfbXNnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVj
dCBkbWFfZmVuY2UgKipmZW5jZSkNCiB7DQogICAgICAgIGNvbnN0IHVuc2lnbmVkIGliX3NpemVf
ZHcgPSAxNjsNCiAgICAgICAgc3RydWN0IGFtZGdwdV9qb2IgKmpvYjsNCiAgICAgICAgc3RydWN0
IGFtZGdwdV9pYiAqaWI7DQogICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmYgPSBOVUxMOw0KLSAg
ICAgICB1aW50NjRfdCBhZGRyOw0KKyAgICAgICB1aW50NjRfdCBhZGRyID0gaWJfbXNnLT5ncHVf
YWRkcjsNCiAgICAgICAgaW50IGksIHI7DQoNCiAgICAgICAgciA9IGFtZGdwdV9qb2JfYWxsb2Nf
d2l0aF9pYihyaW5nLT5hZGV2LCBpYl9zaXplX2R3ICogNCwNCkBAIC0yOTIsNyArMjkxLDYgQEAg
c3RhdGljIGludCB1dmRfdjdfMF9lbmNfZ2V0X2Rlc3Ryb3lfbXNnKHN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZywgdWludDMyX3QgaGFuZGwNCiAgICAgICAgICAgICAgICByZXR1cm4gcjsNCg0KICAg
ICAgICBpYiA9ICZqb2ItPmlic1swXTsNCi0gICAgICAgYWRkciA9IGFtZGdwdV9ib19ncHVfb2Zm
c2V0KGJvKTsNCg0KICAgICAgICBpYi0+bGVuZ3RoX2R3ID0gMDsNCiAgICAgICAgaWItPnB0cltp
Yi0+bGVuZ3RoX2R3KytdID0gMHgwMDAwMDAxODsNCkBAIC0zMzcsMjEgKzMzNSwyMyBAQCBzdGF0
aWMgaW50IHV2ZF92N18wX2VuY19nZXRfZGVzdHJveV9tc2coc3RydWN0IGFtZGdwdV9yaW5nICpy
aW5nLCB1aW50MzJfdCBoYW5kbA0KICAqLw0KIHN0YXRpYyBpbnQgdXZkX3Y3XzBfZW5jX3Jpbmdf
dGVzdF9pYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIGxvbmcgdGltZW91dCkNCiB7DQorICAg
ICAgIHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gcmluZy0+YWRldjsNCiAgICAgICAgc3Ry
dWN0IGRtYV9mZW5jZSAqZmVuY2UgPSBOVUxMOw0KLSAgICAgICBzdHJ1Y3QgYW1kZ3B1X2JvICpi
byA9IE5VTEw7DQorICAgICAgIHN0cnVjdCBhbWRncHVfaWIgaWI7DQogICAgICAgIGxvbmcgcjsN
Cg0KLSAgICAgICByID0gYW1kZ3B1X2JvX2NyZWF0ZV9yZXNlcnZlZChyaW5nLT5hZGV2LCAxMjgg
KiAxMDI0LCBQQUdFX1NJWkUsDQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEFNREdQVV9HRU1fRE9NQUlOX1ZSQU0sDQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICZibywgTlVMTCwgTlVMTCk7DQorICAgICAgIG1lbXNldCgmaWIsIDAsIHNpemVvZihp
YikpOw0KKyAgICAgICByID0gYW1kZ3B1X2liX2dldChhZGV2LCBOVUxMLCAxMjggPDwgMTAsDQor
ICAgICAgICAgICAgICAgICAgICAgICBBTURHUFVfSUJfUE9PTF9ESVJFQ1QsDQorICAgICAgICAg
ICAgICAgICAgICAgICAmaWIpOw0KICAgICAgICBpZiAocikNCiAgICAgICAgICAgICAgICByZXR1
cm4gcjsNCg0KLSAgICAgICByID0gdXZkX3Y3XzBfZW5jX2dldF9jcmVhdGVfbXNnKHJpbmcsIDEs
IGJvLCBOVUxMKTsNCisgICAgICAgciA9IHV2ZF92N18wX2VuY19nZXRfY3JlYXRlX21zZyhyaW5n
LCAxLCAmaWIsIE5VTEwpOw0KICAgICAgICBpZiAocikNCiAgICAgICAgICAgICAgICBnb3RvIGVy
cm9yOw0KDQotICAgICAgIHIgPSB1dmRfdjdfMF9lbmNfZ2V0X2Rlc3Ryb3lfbXNnKHJpbmcsIDEs
IGJvLCAmZmVuY2UpOw0KKyAgICAgICByID0gdXZkX3Y3XzBfZW5jX2dldF9kZXN0cm95X21zZyhy
aW5nLCAxLCAmaWIsICZmZW5jZSk7DQogICAgICAgIGlmIChyKQ0KICAgICAgICAgICAgICAgIGdv
dG8gZXJyb3I7DQoNCkBAIC0zNjIsMTAgKzM2Miw4IEBAIHN0YXRpYyBpbnQgdXZkX3Y3XzBfZW5j
X3JpbmdfdGVzdF9pYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIGxvbmcgdGltZW91dCkNCiAg
ICAgICAgICAgICAgICByID0gMDsNCg0KIGVycm9yOg0KKyAgICAgICBhbWRncHVfaWJfZnJlZShh
ZGV2LCAmaWIsIGZlbmNlKTsNCiAgICAgICAgZG1hX2ZlbmNlX3B1dChmZW5jZSk7DQotICAgICAg
IGFtZGdwdV9ib191bnBpbihibyk7DQotICAgICAgIGFtZGdwdV9ib191bnJlc2VydmUoYm8pOw0K
LSAgICAgICBhbWRncHVfYm9fdW5yZWYoJmJvKTsNCiAgICAgICAgcmV0dXJuIHI7DQogfQ0KDQot
LQ0KMi4yNS4xDQoNCg==
