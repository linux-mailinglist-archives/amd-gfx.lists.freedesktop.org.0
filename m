Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3112E678DA
	for <lists+amd-gfx@lfdr.de>; Sat, 13 Jul 2019 08:42:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4DD036E3B4;
	Sat, 13 Jul 2019 06:42:38 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-BN3-obe.outbound.protection.outlook.com
 (mail-eopbgr740087.outbound.protection.outlook.com [40.107.74.87])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 55B706E3B4
 for <amd-gfx@lists.freedesktop.org>; Sat, 13 Jul 2019 06:42:36 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=B+BfrNO1VnWozvJeYGF3ijXhDml6eSxDjC0pcZqdWhi48LNpZvBsps0ZMXgeEO2rUCBGC+VZO0I3QNgXlgD9ClD9LS7Fn0Bo60+HVGZcH/cOLkFIjUlNIypxV2aabX7RN9pG0hfClieLsfsxRKr0UAB4jLta0kXNgDqvBhD50qxRuEJN2vSFYk4oVIe8Q0uPx8dNluu4NLeCNvvuNeZ9gelZ40HNg+vwVHAPVegYLdYAbIy5bZ+bmWdshv/fuqEh55i3mTHPfF+cGrUxFeDkYz369yXoA88l6u1quB97XO3ecRpLy1YXArIrV9ruTbDxsG7iSug4jryGY42aVdI59Q==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=R0k5euRFyX9bZoTgXV3z5+T6B7d87F0v4ynIrXIPONo=;
 b=bgFaA65U7q/jr+2PdopfjvzuguXVAaHU2Pm2y7Kp4r7eiYMewOqK6VJtnKUtB84P9XbX44sJy9j8QmEwLQn1efx62iqscXXQFbpgcaSTvk5cY5Js+hHdPTWX93ghKcTZcYGnRFbfK/JKL3JRzvs373/yf2BYIx10Z5ZFRL0QFlp9p65KbQcNTt74RZzrWdxSuijibzGYf+HQZDBAakhFeEDJMEFeqbhxrM0ToD3lDYFp/DKlulCqQbh1b2mxw9/Nzj+o3PeUTQ5Kt/hB/t1EN7W8ULDIn5xRU6yVewoNXnT5LY+olu4wepmn/har/zSJDyFe1l2bnoR8rF4BM9v5Dg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=pass
 smtp.mailfrom=amd.com;dmarc=pass action=none header.from=amd.com;dkim=pass
 header.d=amd.com;arc=none
Received: from DM6PR12MB3947.namprd12.prod.outlook.com (10.255.174.156) by
 DM6PR12MB3067.namprd12.prod.outlook.com (20.178.30.149) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2073.14; Sat, 13 Jul 2019 06:42:31 +0000
Received: from DM6PR12MB3947.namprd12.prod.outlook.com
 ([fe80::91a2:f9e7:8c86:f927]) by DM6PR12MB3947.namprd12.prod.outlook.com
 ([fe80::91a2:f9e7:8c86:f927%7]) with mapi id 15.20.2073.012; Sat, 13 Jul 2019
 06:42:31 +0000
From: "Kuehling, Felix" <Felix.Kuehling@amd.com>
To: "amd-gfx@lists.freedesktop.org" <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 1/2] drm/amdgpu: Dump PDEs and PTEs on VM faults (v3)
Thread-Topic: [PATCH 1/2] drm/amdgpu: Dump PDEs and PTEs on VM faults (v3)
Thread-Index: AQHVOUYlkGx2OrTk4U6vqwN1R3gUUQ==
Date: Sat, 13 Jul 2019 06:42:31 +0000
Message-ID: <20190713064211.20047-1-Felix.Kuehling@amd.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [165.204.55.251]
x-mailer: git-send-email 2.17.1
x-clientproxiedby: YTBPR01CA0020.CANPRD01.PROD.OUTLOOK.COM
 (2603:10b6:b01:14::33) To DM6PR12MB3947.namprd12.prod.outlook.com
 (2603:10b6:5:1cb::28)
x-ms-exchange-messagesentrepresentingtype: 1
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 19f4a27f-75a7-46a8-350f-08d7075d47bf
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(5600148)(711020)(4605104)(1401327)(4618075)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(2017052603328)(7193020);
 SRVR:DM6PR12MB3067; 
x-ms-traffictypediagnostic: DM6PR12MB3067:
x-microsoft-antispam-prvs: <DM6PR12MB3067958A24FDC253A688DD3592CD0@DM6PR12MB3067.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:284;
x-forefront-prvs: 00979FCB3A
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(979002)(4636009)(39860400002)(366004)(396003)(136003)(376002)(346002)(189003)(199004)(6486002)(186003)(8676002)(26005)(2616005)(476003)(1076003)(71190400001)(2501003)(14454004)(71200400001)(6512007)(6436002)(5640700003)(2906002)(53936002)(25786009)(99286004)(66446008)(64756008)(66476007)(66556008)(316002)(256004)(6916009)(36756003)(68736007)(478600001)(305945005)(7736002)(14444005)(5660300002)(6506007)(52116002)(102836004)(386003)(66066001)(86362001)(81156014)(486006)(50226002)(81166006)(8936002)(3846002)(2351001)(66946007)(6116002)(969003)(989001)(999001)(1009001)(1019001);
 DIR:OUT; SFP:1101; SCL:1; SRVR:DM6PR12MB3067;
 H:DM6PR12MB3947.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: TYp8afh5/NuiiE+j9+gwrQyLv0vw3zJSZ0lod+vlWEWpmpzHfIF49z5dDgWMxC6NpZDDGzHtpHE1btraJUdHZN03Cg3PFs2q/ZVq/sP4oePzzhVebTZmmOReztVefu44DmctEpy6RhrNv3bB5FL9DPkWbIeQJZS6OzFBBhg4iUqOmCf+Y8Q92ojtVIf2EgVFJ5fQTXkIshs/3CaVeBPw8U8IigxANnrgDCl4GkC660LZPyJ2cssIoh/EaEQLotEXUvMRh9mtfuWNrQjQznDddhgzJpkQzheKe1MGHo/pQLG186z5YFwDhmiVW9W+7rFX7lnnM6/MV/guMC27LBHMPwo1RmSQ9HQlRuJncBNr6sFpjTSzQu6AWS/4FX1iuYA0NDrjxw9F/jgsJy0+Xl3ZfgRpzkFusSL186pQrNaFrSI=
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 19f4a27f-75a7-46a8-350f-08d7075d47bf
X-MS-Exchange-CrossTenant-originalarrivaltime: 13 Jul 2019 06:42:31.6019 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: fkuehlin@amd.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM6PR12MB3067
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=R0k5euRFyX9bZoTgXV3z5+T6B7d87F0v4ynIrXIPONo=;
 b=iE4oMRjY6XJv/Qqo1bVv7cNTpMmwJbGKGfMwjQRoC88O1LGqUKU/kRykMEPsS/Yi1AMQkH5k9EWlBgH4g1CrDU8L0rYyaIBqQrseB355Bb8ALSGXdzUMRY8YMObm8a0zFrxAL65coHPcn/OtHauCRRqDhRAQkwHj8djVh/W23rQ=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Felix.Kuehling@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

V2FsayBwYWdlIHRhYmxlIGZvciB0aGUgZmF1bHRpbmcgYWRkcmVzcyBhbmQgZHVtcCBQREVzIGFu
ZCBQVEVzIGF0CmFsbCBsZXZlbHMuIEFsc28gZmxhZyBkaXNjcmVwYW5jaWVzIHdoZXJlIGEgUERF
IHBvaW50cyB0byBhIGRpZmZlcmVudAphZGRyZXNzIHRoYW4gdGhlIG5leHQgbGV2ZWwgUERCIG9y
IFBUQiBCTy4KCnYyOgoqIEZpeCBhZGRyZXNzIHNoaWZ0IGZvciBHRlh2OAoqIFJlZG8gUERCL1BU
QiBhZGRyZXNzIGNoZWNraW5nIHRvIHdvcmsgb24gYWxsIGdlbmVyYXRpb25zCgp2MzoKKiBTaW1w
bGlmaWVkIHBkZSBhZGRyZXNzIGFuZCBmbGFnIGNoZWNrCgpTaWduZWQtb2ZmLWJ5OiBGZWxpeCBL
dWVobGluZyA8RmVsaXguS3VlaGxpbmdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdHRtLmMgfCAgNSArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X3R0bS5oIHwgIDIgKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Zt
LmMgIHwgNzkgKysrKysrKysrKysrKysrKysrKysrKysrLQogZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X3ZtLmggIHwgIDcgKystCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9n
bWNfdjhfMC5jICAgfCAgNiArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAu
YyAgIHwgIDUgKy0KIDYgZmlsZXMgY2hhbmdlZCwgOTUgaW5zZXJ0aW9ucygrKSwgOSBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKaW5kZXggYmJiZjA2
OWVmYjc3Li43ODQ0MDc0OGM4N2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dHRtLmMKQEAgLTE1MDUsOSArMTUwNSw4IEBAIHN0YXRpYyBib29sIGFtZGdwdV90dG1fYm9fZXZp
Y3Rpb25fdmFsdWFibGUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKICAqIFRoaXMgaXMg
dXNlZCB0byBhY2Nlc3MgVlJBTSB0aGF0IGJhY2tzIGEgYnVmZmVyIG9iamVjdCB2aWEgTU1JTwog
ICogYWNjZXNzIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMuCiAgKi8KLXN0YXRpYyBpbnQgYW1kZ3B1
X3R0bV9hY2Nlc3NfbWVtb3J5KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCi0JCQkJICAg
IHVuc2lnbmVkIGxvbmcgb2Zmc2V0LAotCQkJCSAgICB2b2lkICpidWYsIGludCBsZW4sIGludCB3
cml0ZSkKK2ludCBhbWRncHVfdHRtX2FjY2Vzc19tZW1vcnkoc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICpibywgdW5zaWduZWQgbG9uZyBvZmZzZXQsCisJCQkgICAgIHZvaWQgKmJ1ZiwgaW50IGxl
biwgaW50IHdyaXRlKQogewogCXN0cnVjdCBhbWRncHVfYm8gKmFibyA9IHR0bV90b19hbWRncHVf
Ym8oYm8pOwogCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KGFi
by0+dGJvLmJkZXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3R0bS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5oCmluZGV4
IGJjY2I4YzQ5ZTU5Ny4uY2ZmYmFmZmZhOWQ3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfdHRtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X3R0bS5oCkBAIC04Myw2ICs4Myw4IEBAIHZvaWQgYW1kZ3B1X3R0bV9maW5pKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2KTsKIHZvaWQgYW1kZ3B1X3R0bV9zZXRfYnVmZmVyX2Z1bmNz
X3N0YXR1cyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCQkJYm9vbCBlbmFibGUpOwog
CitpbnQgYW1kZ3B1X3R0bV9hY2Nlc3NfbWVtb3J5KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAq
Ym8sIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LAorCQkJICAgICB2b2lkICpidWYsIGludCBsZW4sIGlu
dCB3cml0ZSk7CiBpbnQgYW1kZ3B1X2NvcHlfYnVmZmVyKHN0cnVjdCBhbWRncHVfcmluZyAqcmlu
ZywgdWludDY0X3Qgc3JjX29mZnNldCwKIAkJICAgICAgIHVpbnQ2NF90IGRzdF9vZmZzZXQsIHVp
bnQzMl90IGJ5dGVfY291bnQsCiAJCSAgICAgICBzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpy
ZXN2LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYwppbmRleCAxOTUxZjJhYmJk
YmMuLjY0ZWU0NmVhYTA0MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMK
QEAgLTU0NCw2ICs1NDQsNzggQEAgc3RhdGljIHZvaWQgYW1kZ3B1X3ZtX3B0X25leHRfZGZzKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCSAgICAgYW1kZ3B1X3ZtX3B0X2NvbnRpbnVlX2Rm
cygoc3RhcnQpLCAoZW50cnkpKTsJCQlcCiAJICAgICAoZW50cnkpID0gKGN1cnNvcikuZW50cnks
IGFtZGdwdV92bV9wdF9uZXh0X2RmcygoYWRldiksICYoY3Vyc29yKSkpCiAKKy8qKgorICogYW1k
Z3B1X3ZtX2R1bXBfcHRlIC0gZHVtcCBQVEVzIGFsb25nIGEgcGFnZSB0YWJsZSB3YWxrCisgKgor
ICogQGFkZXY6IGFtZGdwdSBkZXZpY2UgcG9pbnRlcgorICogQHZtOiBWTSBhZGRyZXNzIHNwYWNl
CisgKiBAYWRkcjogdmlydHVhbCBhZGRyZXNzCisgKgorICogV2Fsa3MgdGhlIHBhZ2UgdGFibGUg
b2YgQHZtIGF0IHRoZSBnaXZlbiBAYWRkciBhbmQgcHJpbnRzIHRoZSBQREVzCisgKiBhbmQgUFRF
cyBhbG9uZyB0aGUgd2F5IG9uIGEgc2luZ2xlIGxpbmUuCisgKi8KK3ZvaWQgYW1kZ3B1X3ZtX2R1
bXBfcHRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwK
KwkJCXVpbnQ2NF90IGFkZHIpCit7CisJc3RhdGljIGNvbnN0IGNoYXIgKmxldmVsX2VudHJ5WzRd
ID0geyJQREUyIiwgIlBERTEiLCAiUERFMCIsICJQVEUifTsKKwlzdGF0aWMgY29uc3QgY2hhciAq
bGV2ZWxfYmxvY2tbNF0gPSB7IlBEQjIiLCAiUERCMSIsICJQREIwIiwgIlBUQiJ9OworCXN0cnVj
dCBhbWRncHVfdm1fcHRfY3Vyc29yIGN1cnNvcjsKKwl1aW50NjRfdCBwZGVfYWRkciwgcGRlX2Zs
YWdzLCBsYXN0X3BkZTsKKwljaGFyIGJ1ZlsxMjhdOworCWludCBpID0gMDsKKworCWFtZGdwdV9n
bWNfZ2V0X3BkZV9mb3JfYm8odm0tPnJvb3QuYmFzZS5ibywgYWRldi0+dm1fbWFuYWdlci5yb290
X2xldmVsLAorCQkJCSAgJnBkZV9hZGRyLCAmcGRlX2ZsYWdzKTsKKwlsYXN0X3BkZSA9IHBkZV9h
ZGRyIHwgcGRlX2ZsYWdzOworCisJYW1kZ3B1X3ZtX3B0X3N0YXJ0KGFkZXYsIHZtLCBhZGRyID4+
IFBBR0VfU0hJRlQsICZjdXJzb3IpOworCisJZG8geworCQl1bnNpZ25lZCBpbnQgbWFzaywgc2hp
ZnQsIGlkeDsKKwkJc3RydWN0IGFtZGdwdV9ibyAqYm87CisJCXVpbnQ2NF90IHB0ZTsKKworCQlt
YXNrID0gYW1kZ3B1X3ZtX2VudHJpZXNfbWFzayhhZGV2LCBjdXJzb3IubGV2ZWwpOworCQlzaGlm
dCA9IGFtZGdwdV92bV9sZXZlbF9zaGlmdChhZGV2LCBjdXJzb3IubGV2ZWwpOworCQlpZHggPSAo
Y3Vyc29yLnBmbiA+PiBzaGlmdCkgJiBtYXNrOworCisJCWJvID0gY3Vyc29yLmVudHJ5LT5iYXNl
LmJvOworCQlpZiAoYm8pIHsKKwkJCS8qIEZsYWcgZGlzY3JlcGFuY3kgYmV0d2VlbiBwcmV2aW91
cyBsZXZlbCBQREUKKwkJCSAqIGFuZCB0aGUgYWN0dWFsIGFkZHJlc3Mgb2YgdGhpcyBQVEIgb3Ig
UERCLgorCQkJICovCisJCQlhbWRncHVfZ21jX2dldF9wZGVfZm9yX2JvKGJvLCBjdXJzb3IubGV2
ZWwsCisJCQkJCQkgICZwZGVfYWRkciwgJnBkZV9mbGFncyk7CisJCQlpZiAoKHBkZV9hZGRyIHwg
cGRlX2ZsYWdzKSAhPSBsYXN0X3BkZSkKKwkJCQlpICs9IHNucHJpbnRmKGJ1ZiArIGksIHNpemVv
ZihidWYpIC0gaSwgIiEiKTsKKworCQkJYW1kZ3B1X3R0bV9hY2Nlc3NfbWVtb3J5KCZiby0+dGJv
LCBpZHggKiBzaXplb2YocHRlKSwKKwkJCQkJCSAmcHRlLCBzaXplb2YocHRlKSwgZmFsc2UpOwor
CQkJaSArPSBzbnByaW50ZihidWYgKyBpLCBzaXplb2YoYnVmKSAtIGksCisJCQkJICAgICAgIiVz
WyVkXT0weCVsbHggIiwKKwkJCQkgICAgICBsZXZlbF9lbnRyeVtjdXJzb3IubGV2ZWxdLCBpZHgs
IHB0ZSk7CisJCQlsYXN0X3BkZSA9IHB0ZTsKKwkJfSBlbHNlIHsKKwkJCS8qIEZsYWcgZGlzY3Jl
cGFuY3kgaWYgcHJldmlvdXMgbGV2ZWwgUERFIGhhZAorCQkJICogYSB2YWxpZCBlbnRyeSBidXQg
dGhlcmUgaXMgbm8gUFRCIG9yIFBEQiBCTy4KKwkJCSAqLworCQkJaWYgKChsYXN0X3BkZSAmIEFN
REdQVV9QVEVfVkFMSUQpICYmCisJCQkgICAgIShsYXN0X3BkZSAmIEFNREdQVV9QREVfUFRFKSkK
KwkJCQlpICs9IHNucHJpbnRmKGJ1ZiArIGksIHNpemVvZihidWYpIC0gaSwgIiEiKTsKKwkJCWkg
Kz0gc25wcmludGYoYnVmICsgaSwgc2l6ZW9mKGJ1ZikgLSBpLAorCQkJCSAgICAgICJubyAlcyAi
LCBsZXZlbF9ibG9ja1tjdXJzb3IubGV2ZWxdKTsKKwkJCWxhc3RfcGRlID0gMDsKKwkJfQorCisJ
CSsrY3Vyc29yLmxldmVsOworCQljdXJzb3IucGFyZW50ID0gY3Vyc29yLmVudHJ5OworCQlpZiAo
IWN1cnNvci5lbnRyeS0+ZW50cmllcykKKwkJCWJyZWFrOworCQljdXJzb3IuZW50cnkgPSAmY3Vy
c29yLmVudHJ5LT5lbnRyaWVzW2lkeF07CisJfSB3aGlsZSAoY3Vyc29yLmVudHJ5KTsKKwlkZXZf
ZXJyKGFkZXYtPmRldiwgIiVzIiwgYnVmKTsKK30KKwogLyoqCiAgKiBhbWRncHVfdm1fZ2V0X3Bk
X2JvIC0gYWRkIHRoZSBWTSBQRCB0byBhIHZhbGlkYXRpb24gbGlzdAogICoKQEAgLTMwODEsOCAr
MzE1Myw5IEBAIGludCBhbWRncHVfdm1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxwKQogICogQHBhc2lkOiBQQVNJRCBpZGVudGlm
aWVyIGZvciBWTQogICogQHRhc2tfaW5mbzogdGFza19pbmZvIHRvIGZpbGwuCiAgKi8KLXZvaWQg
YW1kZ3B1X3ZtX2dldF90YXNrX2luZm8oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVuc2ln
bmVkIGludCBwYXNpZCwKLQkJCSBzdHJ1Y3QgYW1kZ3B1X3Rhc2tfaW5mbyAqdGFza19pbmZvKQor
c3RydWN0IGFtZGdwdV92bSAqYW1kZ3B1X3ZtX2dldF90YXNrX2luZm8oc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsCisJCQkJCSAgdW5zaWduZWQgaW50IHBhc2lkLAorCQkJCQkgIHN0cnVjdCBh
bWRncHVfdGFza19pbmZvICp0YXNrX2luZm8pCiB7CiAJc3RydWN0IGFtZGdwdV92bSAqdm07CiAJ
dW5zaWduZWQgbG9uZyBmbGFnczsKQEAgLTMwOTQsNiArMzE2Nyw4IEBAIHZvaWQgYW1kZ3B1X3Zt
X2dldF90YXNrX2luZm8oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVuc2lnbmVkIGludCBw
YXNpZCwKIAkJKnRhc2tfaW5mbyA9IHZtLT50YXNrX2luZm87CiAKIAlzcGluX3VubG9ja19pcnFy
ZXN0b3JlKCZhZGV2LT52bV9tYW5hZ2VyLnBhc2lkX2xvY2ssIGZsYWdzKTsKKworCXJldHVybiB2
bTsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdm0uaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5oCmluZGV4IDQ4
OWExNjJjYTYyMC4uNmE4YjgzM2QxODBlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdm0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdm0uaApAQCAtMzQ4LDYgKzM0OCw4IEBAIGludCBhbWRncHVfdm1faW5pdChzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV92bSAqdm0sCiBpbnQgYW1kZ3B1X3ZtX21h
a2VfY29tcHV0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV92bSAq
dm0sIHVuc2lnbmVkIGludCBwYXNpZCk7CiB2b2lkIGFtZGdwdV92bV9yZWxlYXNlX2NvbXB1dGUo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtKTsKIHZvaWQg
YW1kZ3B1X3ZtX2Zpbmkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVf
dm0gKnZtKTsKK3ZvaWQgYW1kZ3B1X3ZtX2R1bXBfcHRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LCBzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwKKwkJCXVpbnQ2NF90IGFkZHIpOwogdm9pZCBhbWRn
cHVfdm1fZ2V0X3BkX2JvKHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCQkJIHN0cnVjdCBsaXN0X2hl
YWQgKnZhbGlkYXRlZCwKIAkJCSBzdHJ1Y3QgYW1kZ3B1X2JvX2xpc3RfZW50cnkgKmVudHJ5KTsK
QEAgLTQwMSw4ICs0MDMsOSBAQCBib29sIGFtZGdwdV92bV9uZWVkX3BpcGVsaW5lX3N5bmMoc3Ry
dWN0IGFtZGdwdV9yaW5nICpyaW5nLAogCQkJCSAgc3RydWN0IGFtZGdwdV9qb2IgKmpvYik7CiB2
b2lkIGFtZGdwdV92bV9jaGVja19jb21wdXRlX2J1ZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
dik7CiAKLXZvaWQgYW1kZ3B1X3ZtX2dldF90YXNrX2luZm8oc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYsIHVuc2lnbmVkIGludCBwYXNpZCwKLQkJCSAgICAgc3RydWN0IGFtZGdwdV90YXNrX2lu
Zm8gKnRhc2tfaW5mbyk7CitzdHJ1Y3QgYW1kZ3B1X3ZtICphbWRncHVfdm1fZ2V0X3Rhc2tfaW5m
byhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKKwkJCQkJICB1bnNpZ25lZCBpbnQgcGFzaWQs
CisJCQkJCSAgc3RydWN0IGFtZGdwdV90YXNrX2luZm8gKnRhc2tfaW5mbyk7CiAKIHZvaWQgYW1k
Z3B1X3ZtX3NldF90YXNrX2luZm8oc3RydWN0IGFtZGdwdV92bSAqdm0pOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjhfMC5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvZ21jX3Y4XzAuYwppbmRleCA4YmYyYmEzMTBmZDkuLjE4MjA3ZWNmZDg1YyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y4XzAuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjhfMC5jCkBAIC0xNDQ4LDkgKzE0NDgsMTAg
QEAgc3RhdGljIGludCBnbWNfdjhfMF9wcm9jZXNzX2ludGVycnVwdChzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwKIAogCWlmIChwcmludGtfcmF0ZWxpbWl0KCkpIHsKIAkJc3RydWN0IGFtZGdw
dV90YXNrX2luZm8gdGFza19pbmZvOworCQlzdHJ1Y3QgYW1kZ3B1X3ZtICp2bTsKIAogCQltZW1z
ZXQoJnRhc2tfaW5mbywgMCwgc2l6ZW9mKHN0cnVjdCBhbWRncHVfdGFza19pbmZvKSk7Ci0JCWFt
ZGdwdV92bV9nZXRfdGFza19pbmZvKGFkZXYsIGVudHJ5LT5wYXNpZCwgJnRhc2tfaW5mbyk7CisJ
CXZtID0gYW1kZ3B1X3ZtX2dldF90YXNrX2luZm8oYWRldiwgZW50cnktPnBhc2lkLCAmdGFza19p
bmZvKTsKIAogCQlkZXZfZXJyKGFkZXYtPmRldiwgIkdQVSBmYXVsdCBkZXRlY3RlZDogJWQgMHgl
MDh4IGZvciBwcm9jZXNzICVzIHBpZCAlZCB0aHJlYWQgJXMgcGlkICVkXG4iLAogCQkJZW50cnkt
PnNyY19pZCwgZW50cnktPnNyY19kYXRhWzBdLCB0YXNrX2luZm8ucHJvY2Vzc19uYW1lLApAQCAt
MTQ2MSw2ICsxNDYyLDkgQEAgc3RhdGljIGludCBnbWNfdjhfMF9wcm9jZXNzX2ludGVycnVwdChz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCXN0YXR1cyk7CiAJCWdtY192OF8wX3ZtX2Rl
Y29kZV9mYXVsdChhZGV2LCBzdGF0dXMsIGFkZHIsIG1jX2NsaWVudCwKIAkJCQkJIGVudHJ5LT5w
YXNpZCk7CisJCWlmICh2bSkKKwkJCWFtZGdwdV92bV9kdW1wX3B0ZShhZGV2LCB2bSwgKHVpbnQ2
NF90KWFkZHIKKwkJCQkJICAgPDwgQU1ER1BVX0dQVV9QQUdFX1NISUZUKTsKIAl9CiAKIAl2bWlk
ID0gUkVHX0dFVF9GSUVMRChzdGF0dXMsIFZNX0NPTlRFWFQxX1BST1RFQ1RJT05fRkFVTFRfU1RB
VFVTLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8wLmMKaW5kZXggYmQ1ZDM2OTQ0NDgx
Li5mMjdlODhhZjQwMTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dt
Y192OV8wLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYwpAQCAt
MzMxLDkgKzMzMSwxMCBAQCBzdGF0aWMgaW50IGdtY192OV8wX3Byb2Nlc3NfaW50ZXJydXB0KHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCiAJaWYgKHByaW50a19yYXRlbGltaXQoKSkgewog
CQlzdHJ1Y3QgYW1kZ3B1X3Rhc2tfaW5mbyB0YXNrX2luZm87CisJCXN0cnVjdCBhbWRncHVfdm0g
KnZtOwogCiAJCW1lbXNldCgmdGFza19pbmZvLCAwLCBzaXplb2Yoc3RydWN0IGFtZGdwdV90YXNr
X2luZm8pKTsKLQkJYW1kZ3B1X3ZtX2dldF90YXNrX2luZm8oYWRldiwgZW50cnktPnBhc2lkLCAm
dGFza19pbmZvKTsKKwkJdm0gPSBhbWRncHVfdm1fZ2V0X3Rhc2tfaW5mbyhhZGV2LCBlbnRyeS0+
cGFzaWQsICZ0YXNrX2luZm8pOwogCiAJCWRldl9lcnIoYWRldi0+ZGV2LAogCQkJIlslc10gJXMg
cGFnZSBmYXVsdCAoc3JjX2lkOiV1IHJpbmc6JXUgdm1pZDoldSAiCkBAIC0zNDksNiArMzUwLDgg
QEAgc3RhdGljIGludCBnbWNfdjlfMF9wcm9jZXNzX2ludGVycnVwdChzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwKIAkJCWRldl9lcnIoYWRldi0+ZGV2LAogCQkJCSJWTV9MMl9QUk9URUNUSU9O
X0ZBVUxUX1NUQVRVUzoweCUwOFhcbiIsCiAJCQkJc3RhdHVzKTsKKwkJaWYgKHZtKQorCQkJYW1k
Z3B1X3ZtX2R1bXBfcHRlKGFkZXYsIHZtLCBhZGRyKTsKIAl9CiAKIAlyZXR1cm4gMDsKLS0gCjIu
MTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1k
LWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
