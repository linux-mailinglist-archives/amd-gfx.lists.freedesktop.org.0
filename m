Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8757C7BC4D
	for <lists+amd-gfx@lfdr.de>; Wed, 31 Jul 2019 10:54:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EC07589A59;
	Wed, 31 Jul 2019 08:54:35 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM04-BN3-obe.outbound.protection.outlook.com
 (mail-eopbgr680072.outbound.protection.outlook.com [40.107.68.72])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D6D3F89A59
 for <amd-gfx@lists.freedesktop.org>; Wed, 31 Jul 2019 08:54:34 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=LkKxrFD611ISN8CPgLvKhswLxsOY16X5I7VyPJXXMlp/F8+66LFFAFctblTuJs+cdiqpnTLeU215y4FCzGKcaaJHk/uRjjv01v/tyYzLr42pu60TrV/Es7NbrCsTnino8cb2CP0qBWky71ZpD3uZZc8RNLDoyzye+1cCDsPcUnKUB9ztCYUKb9kX0yvVuYD4yx3MRodJWgsy8s0rMg3enN7YDp/yjJwvOL2qkfZyrCkwr/KkNoamRrJSOCaTihAdE9kqBMmh+oL54XtOsys2wiCayHuSFZphHYY1WeAwauVcn1lkrMFcsUxzNr6+sEy7yHAABD7tJD62PuA2xN0mrg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=HJHXhkW9m0pg3dNMp3C3hbsOnIu49AOndbHfL/1ShIU=;
 b=RKrAwc8FFRsXfTbYPHorUmsz4H8E+T//v6RgrnyEc5+uLOtewINji8P01V7yCC3UyT9oqS62h1mLkPEhux/qaiCPWwvqeeZGzFCaZChTgx0XPJCKRx7cpZdihhTEoXK9nyb2qt0TDEiy/c7IejmFLY4vsSoUbIzfFPCNDJUcK5kRs1qp6TMwvsqhYvZb6toyvO9Qj9ck83HSeKyuzA60qgXFdygKwKWnpWWyGlXeirKG/wMOKTuPdgWSNO1S/bI57qFn+jOzYa1DwPVZs8VBa2N5R7+F/G0WBTpqe1nHxHNO5p3GlvZlzvavlIdz5gr2ma9BJNfU3gWsjEFuDrPRWQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1;spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org
 smtp.mailfrom=amd.com;dmarc=permerror action=none
 header.from=amd.com;dkim=none (message not signed);arc=none
Received: from MWHPR1201CA0016.namprd12.prod.outlook.com
 (2603:10b6:301:4a::26) by BN8PR12MB3506.namprd12.prod.outlook.com
 (2603:10b6:408:9e::16) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2115.15; Wed, 31 Jul
 2019 08:54:32 +0000
Received: from CO1NAM03FT040.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e48::201) by MWHPR1201CA0016.outlook.office365.com
 (2603:10b6:301:4a::26) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2136.13 via Frontend
 Transport; Wed, 31 Jul 2019 08:54:32 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV02.amd.com (165.204.84.17) by
 CO1NAM03FT040.mail.protection.outlook.com (10.152.81.183) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2115.10 via Frontend Transport; Wed, 31 Jul 2019 08:54:32 +0000
Received: from monk-build.amd.com (10.34.1.3) by SATLEXCHOV02.amd.com
 (10.181.40.72) with Microsoft SMTP Server id 14.3.389.1; Wed, 31 Jul 2019
 03:54:29 -0500
From: Monk Liu <Monk.Liu@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH] drm/amdgpu: fix double ucode load by PSP(v3)
Date: Wed, 31 Jul 2019 16:54:24 +0800
Message-ID: <1564563264-30902-1-git-send-email-Monk.Liu@amd.com>
X-Mailer: git-send-email 2.7.4
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(396003)(346002)(39860400002)(376002)(136003)(2980300002)(428003)(199004)(189003)(70586007)(70206006)(5660300002)(336012)(51416003)(16586007)(7696005)(426003)(186003)(6916009)(2906002)(48376002)(50466002)(47776003)(4326008)(26005)(316002)(53936002)(8936002)(8676002)(68736007)(86362001)(305945005)(81166006)(478600001)(81156014)(126002)(2351001)(2616005)(36756003)(486006)(476003)(14444005)(50226002)(53416004)(6666004)(356004);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN8PR12MB3506; H:SATLEXCHOV02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 6f25db62-8d7b-410a-d997-08d71594b47d
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(5600148)(711020)(4605104)(1401327)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(2017052603328);
 SRVR:BN8PR12MB3506; 
X-MS-TrafficTypeDiagnostic: BN8PR12MB3506:
X-Microsoft-Antispam-PRVS: <BN8PR12MB3506D62359571957D496300E84DF0@BN8PR12MB3506.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:989;
X-Forefront-PRVS: 011579F31F
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: lEpXACe0Mw0SJVQQA6WnJA+gsk/9+X2d7oPZ7j85cleT51KwM4+fa+lnFJW1lnThtmLAKza+OZs+p2t1DQLpDByQ6B6GjxR7el3sXC1Zv60tT8WFuC8AyyPdXmXCKdcpZRgLw4AFIwhWV/PcJhoNeQ+C/nIv5vvlEngZMLQW6+gtZTGA2eRihkYc9hgwgXsxoEMoWNy4CLfwUmP1Nhg+JhJIhmyP4+Ev9zmu8Z6IboyVTgSOtpyK0cVOmJNXJFm1207kYu+R6tDRUjjQT7XDfKPCXrQeJxK6OKiG3OIZV7qKzsYFC/dzUJEyiVuPDnBiNSFLOPcflR3lr1rVEQOj7lQ42jVQzUvgCZCusUGvVg2fS1sQK6D884WJKszav79xL4c11+6GftTjeaQDagWZxOHOecGzXPVsKeCsHidjZN8=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 31 Jul 2019 08:54:32.1862 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 6f25db62-8d7b-410a-d997-08d71594b47d
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN8PR12MB3506
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=HJHXhkW9m0pg3dNMp3C3hbsOnIu49AOndbHfL/1ShIU=;
 b=BafUhm90aEk2OeYG7mMx6m3n3ltq/5CkzAWh64Wr4fuSYmfa7H1nV2gJTg3HLfllTwDvF+Ab9Ix2iMJIw/Bha3Y+x4s+bV9rJhoF2dSN3pURTESJEhwigsVMjkOLIUkSbTd+1hBPxJwGUZNGlYrK85/kGO3ahxM9Vn3/iCVPA0M=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Monk Liu <Monk.Liu@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

cHJldmlvdXNseSB0aGUgdWNvZGUgbG9hZGluZyBvZiBQU1Agd2FzIHJlcHJlYXRlZCwgb25lIGV4
ZWN1dGVkIGluCnBoYXNlXzEgaW5pdC9yZS1pbml0L3Jlc3VtZSBhbmQgdGhlIG90aGVyIGluIGZ3
X2xvYWRpbmcgcm91dGluZQoKQXZvaWQgdGhpcyBkb3VibGUgbG9hZGluZyBieSBjbGVhcmluZyBp
cF9ibG9ja3Muc3RhdHVzLmh3IGluIHN1c3BlbmQgb3IgcmVzZXQKcHJpb3IgdG8gdGhlIEZXIGxv
YWRpbmcgYW5kIGFueSBibG9jaydzIGh3X2luaXQvcmVzdW1lCgp2MjoKc3RpbGwgZG8gdGhlIHNt
dSBmdyBsb2FkaW5nIHNpbmNlIGl0IGlzIG5lZWRlZCBieSBiYXJlLW1ldGFsCgp2MzoKZHJvcCB0
aGUgY2hhbmdlIGluIHJlaW5pdF9lYXJseV9zcmlvdiwganVzdCBjbGVhciBhbGwgYmxvY2sncyBz
dGF0dXMuaHcKaW4gdGhlIGhlYWQgcGxhY2UgYW5kIHNldCB0aGUgc3RhdHVzLmh3IGFmdGVyIGh3
X2luaXQgZG9uZSBpcyBlbm91Z2gKClNpZ25lZC1vZmYtYnk6IE1vbmsgTGl1IDxNb25rLkxpdUBh
bWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyB8
IDU5ICsrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDM4IGlu
c2VydGlvbnMoKyksIDIxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9kZXZpY2UuYwppbmRleCA2Y2IzNThjLi4zMDQzNmJhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCkBAIC0xNjczLDI4ICsxNjczLDM0IEBAIHN0
YXRpYyBpbnQgYW1kZ3B1X2RldmljZV9md19sb2FkaW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2KQogCiAJaWYgKGFkZXYtPmFzaWNfdHlwZSA+PSBDSElQX1ZFR0ExMCkgewogCQlmb3IgKGkg
PSAwOyBpIDwgYWRldi0+bnVtX2lwX2Jsb2NrczsgaSsrKSB7Ci0JCQlpZiAoYWRldi0+aXBfYmxv
Y2tzW2ldLnZlcnNpb24tPnR5cGUgPT0gQU1EX0lQX0JMT0NLX1RZUEVfUFNQKSB7Ci0JCQkJaWYg
KGFkZXYtPmluX2dwdV9yZXNldCB8fCBhZGV2LT5pbl9zdXNwZW5kKSB7Ci0JCQkJCWlmIChhbWRn
cHVfc3Jpb3ZfdmYoYWRldikgJiYgYWRldi0+aW5fZ3B1X3Jlc2V0KQotCQkJCQkJYnJlYWs7IC8q
IHNyaW92IGdwdSByZXNldCwgcHNwIG5lZWQgdG8gZG8gaHdfaW5pdCBiZWZvcmUgSUggYmVjYXVz
ZSBvZiBodyBsaW1pdCAqLwotCQkJCQlyID0gYWRldi0+aXBfYmxvY2tzW2ldLnZlcnNpb24tPmZ1
bmNzLT5yZXN1bWUoYWRldik7Ci0JCQkJCWlmIChyKSB7Ci0JCQkJCQlEUk1fRVJST1IoInJlc3Vt
ZSBvZiBJUCBibG9jayA8JXM+IGZhaWxlZCAlZFxuIiwKKwkJCWlmIChhZGV2LT5pcF9ibG9ja3Nb
aV0udmVyc2lvbi0+dHlwZSAhPSBBTURfSVBfQkxPQ0tfVFlQRV9QU1ApCisJCQkJY29udGludWU7
CisKKwkJCS8qIG5vIG5lZWQgdG8gZG8gdGhlIGZ3IGxvYWRpbmcgYWdhaW4gaWYgYWxyZWFkeSBk
b25lKi8KKwkJCWlmIChhZGV2LT5pcF9ibG9ja3NbaV0uc3RhdHVzLmh3ID09IHRydWUpCisJCQkJ
YnJlYWs7CisKKwkJCWlmIChhZGV2LT5pbl9ncHVfcmVzZXQgfHwgYWRldi0+aW5fc3VzcGVuZCkg
eworCQkJCXIgPSBhZGV2LT5pcF9ibG9ja3NbaV0udmVyc2lvbi0+ZnVuY3MtPnJlc3VtZShhZGV2
KTsKKwkJCQlpZiAocikgeworCQkJCQlEUk1fRVJST1IoInJlc3VtZSBvZiBJUCBibG9jayA8JXM+
IGZhaWxlZCAlZFxuIiwKIAkJCQkJCQkgIGFkZXYtPmlwX2Jsb2Nrc1tpXS52ZXJzaW9uLT5mdW5j
cy0+bmFtZSwgcik7Ci0JCQkJCQlyZXR1cm4gcjsKLQkJCQkJfQotCQkJCX0gZWxzZSB7Ci0JCQkJ
CXIgPSBhZGV2LT5pcF9ibG9ja3NbaV0udmVyc2lvbi0+ZnVuY3MtPmh3X2luaXQoYWRldik7Ci0J
CQkJCWlmIChyKSB7Ci0JCQkJCQlEUk1fRVJST1IoImh3X2luaXQgb2YgSVAgYmxvY2sgPCVzPiBm
YWlsZWQgJWRcbiIsCi0JCQkJCQkgIGFkZXYtPmlwX2Jsb2Nrc1tpXS52ZXJzaW9uLT5mdW5jcy0+
bmFtZSwgcik7Ci0JCQkJCQlyZXR1cm4gcjsKLQkJCQkJfQorCQkJCQlyZXR1cm4gcjsKKwkJCQl9
CisJCQl9IGVsc2UgeworCQkJCXIgPSBhZGV2LT5pcF9ibG9ja3NbaV0udmVyc2lvbi0+ZnVuY3Mt
Pmh3X2luaXQoYWRldik7CisJCQkJaWYgKHIpIHsKKwkJCQkJRFJNX0VSUk9SKCJod19pbml0IG9m
IElQIGJsb2NrIDwlcz4gZmFpbGVkICVkXG4iLAorCQkJCQkJCSAgYWRldi0+aXBfYmxvY2tzW2ld
LnZlcnNpb24tPmZ1bmNzLT5uYW1lLCByKTsKKwkJCQkJcmV0dXJuIHI7CiAJCQkJfQotCQkJCWFk
ZXYtPmlwX2Jsb2Nrc1tpXS5zdGF0dXMuaHcgPSB0cnVlOwogCQkJfQorCisJCQlhZGV2LT5pcF9i
bG9ja3NbaV0uc3RhdHVzLmh3ID0gdHJ1ZTsKKwkJCWJyZWFrOwogCQl9CiAJfQorCiAJciA9IGFt
ZGdwdV9wbV9sb2FkX3NtdV9maXJtd2FyZShhZGV2LCAmc211X3ZlcnNpb24pOwogCiAJcmV0dXJu
IHI7CkBAIC0yMTM2LDcgKzIxNDIsOSBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZXZpY2VfaXBfc3Vz
cGVuZF9waGFzZTEoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCQlpZiAocikgewogCQkJ
CURSTV9FUlJPUigic3VzcGVuZCBvZiBJUCBibG9jayA8JXM+IGZhaWxlZCAlZFxuIiwKIAkJCQkJ
ICBhZGV2LT5pcF9ibG9ja3NbaV0udmVyc2lvbi0+ZnVuY3MtPm5hbWUsIHIpOworCQkJCXJldHVy
biByOwogCQkJfQorCQkJYWRldi0+aXBfYmxvY2tzW2ldLnN0YXR1cy5odyA9IGZhbHNlOwogCQl9
CiAJfQogCkBAIC0yMTc2LDE0ICsyMTg0LDE2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RldmljZV9p
cF9zdXNwZW5kX3BoYXNlMihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAkJCWlmIChpc19z
dXBwb3J0X3N3X3NtdShhZGV2KSkgewogCQkJCS8qIHRvZG8gKi8KIAkJCX0gZWxzZSBpZiAoYWRl
di0+cG93ZXJwbGF5LnBwX2Z1bmNzICYmCi0JCQkJICAgYWRldi0+cG93ZXJwbGF5LnBwX2Z1bmNz
LT5zZXRfbXAxX3N0YXRlKSB7CisJCQkJCSAgIGFkZXYtPnBvd2VycGxheS5wcF9mdW5jcy0+c2V0
X21wMV9zdGF0ZSkgewogCQkJCXIgPSBhZGV2LT5wb3dlcnBsYXkucHBfZnVuY3MtPnNldF9tcDFf
c3RhdGUoCiAJCQkJCWFkZXYtPnBvd2VycGxheS5wcF9oYW5kbGUsCiAJCQkJCWFkZXYtPm1wMV9z
dGF0ZSk7CiAJCQkJaWYgKHIpIHsKIAkJCQkJRFJNX0VSUk9SKCJTTUMgZmFpbGVkIHRvIHNldCBt
cDEgc3RhdGUgJWQsICVkXG4iLAogCQkJCQkJICBhZGV2LT5tcDFfc3RhdGUsIHIpOworCQkJCQly
ZXR1cm4gcjsKIAkJCQl9CisJCQkJYWRldi0+aXBfYmxvY2tzW2ldLnN0YXR1cy5odyA9IGZhbHNl
OwogCQkJfQogCQl9CiAJfQpAQCAtMjIzOCw2ICsyMjQ4LDcgQEAgc3RhdGljIGludCBhbWRncHVf
ZGV2aWNlX2lwX3JlaW5pdF9lYXJseV9zcmlvdihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikK
IAkJZm9yIChqID0gMDsgaiA8IGFkZXYtPm51bV9pcF9ibG9ja3M7IGorKykgewogCQkJYmxvY2sg
PSAmYWRldi0+aXBfYmxvY2tzW2pdOwogCisJCQlibG9jay0+c3RhdHVzLmh3ID0gZmFsc2U7CiAJ
CQlpZiAoYmxvY2stPnZlcnNpb24tPnR5cGUgIT0gaXBfb3JkZXJbaV0gfHwKIAkJCQkhYmxvY2st
PnN0YXR1cy52YWxpZCkKIAkJCQljb250aW51ZTsKQEAgLTIyNDYsNiArMjI1Nyw3IEBAIHN0YXRp
YyBpbnQgYW1kZ3B1X2RldmljZV9pcF9yZWluaXRfZWFybHlfc3Jpb3Yoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYpCiAJCQlEUk1fSU5GTygiUkUtSU5JVC1lYXJseTogJXMgJXNcbiIsIGJsb2Nr
LT52ZXJzaW9uLT5mdW5jcy0+bmFtZSwgcj8iZmFpbGVkIjoic3VjY2VlZGVkIik7CiAJCQlpZiAo
cikKIAkJCQlyZXR1cm4gcjsKKwkJCWJsb2NrLT5zdGF0dXMuaHcgPSB0cnVlOwogCQl9CiAJfQog
CkBAIC0yMjczLDEzICsyMjg1LDE1IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RldmljZV9pcF9yZWlu
aXRfbGF0ZV9zcmlvdihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAkJCWJsb2NrID0gJmFk
ZXYtPmlwX2Jsb2Nrc1tqXTsKIAogCQkJaWYgKGJsb2NrLT52ZXJzaW9uLT50eXBlICE9IGlwX29y
ZGVyW2ldIHx8Ci0JCQkJIWJsb2NrLT5zdGF0dXMudmFsaWQpCisJCQkJIWJsb2NrLT5zdGF0dXMu
dmFsaWQgfHwKKwkJCQlibG9jay0+c3RhdHVzLmh3KQogCQkJCWNvbnRpbnVlOwogCiAJCQlyID0g
YmxvY2stPnZlcnNpb24tPmZ1bmNzLT5od19pbml0KGFkZXYpOwogCQkJRFJNX0lORk8oIlJFLUlO
SVQtbGF0ZTogJXMgJXNcbiIsIGJsb2NrLT52ZXJzaW9uLT5mdW5jcy0+bmFtZSwgcj8iZmFpbGVk
Ijoic3VjY2VlZGVkIik7CiAJCQlpZiAocikKIAkJCQlyZXR1cm4gcjsKKwkJCWJsb2NrLT5zdGF0
dXMuaHcgPSB0cnVlOwogCQl9CiAJfQogCkBAIC0yMzAzLDE3ICsyMzE3LDE5IEBAIHN0YXRpYyBp
bnQgYW1kZ3B1X2RldmljZV9pcF9yZXN1bWVfcGhhc2UxKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2KQogCWludCBpLCByOwogCiAJZm9yIChpID0gMDsgaSA8IGFkZXYtPm51bV9pcF9ibG9ja3M7
IGkrKykgewotCQlpZiAoIWFkZXYtPmlwX2Jsb2Nrc1tpXS5zdGF0dXMudmFsaWQpCisJCWlmICgh
YWRldi0+aXBfYmxvY2tzW2ldLnN0YXR1cy52YWxpZCB8fCBhZGV2LT5pcF9ibG9ja3NbaV0uc3Rh
dHVzLmh3KQogCQkJY29udGludWU7CiAJCWlmIChhZGV2LT5pcF9ibG9ja3NbaV0udmVyc2lvbi0+
dHlwZSA9PSBBTURfSVBfQkxPQ0tfVFlQRV9DT01NT04gfHwKIAkJICAgIGFkZXYtPmlwX2Jsb2Nr
c1tpXS52ZXJzaW9uLT50eXBlID09IEFNRF9JUF9CTE9DS19UWVBFX0dNQyB8fAogCQkgICAgYWRl
di0+aXBfYmxvY2tzW2ldLnZlcnNpb24tPnR5cGUgPT0gQU1EX0lQX0JMT0NLX1RZUEVfSUgpIHsK
KwogCQkJciA9IGFkZXYtPmlwX2Jsb2Nrc1tpXS52ZXJzaW9uLT5mdW5jcy0+cmVzdW1lKGFkZXYp
OwogCQkJaWYgKHIpIHsKIAkJCQlEUk1fRVJST1IoInJlc3VtZSBvZiBJUCBibG9jayA8JXM+IGZh
aWxlZCAlZFxuIiwKIAkJCQkJICBhZGV2LT5pcF9ibG9ja3NbaV0udmVyc2lvbi0+ZnVuY3MtPm5h
bWUsIHIpOwogCQkJCXJldHVybiByOwogCQkJfQorCQkJYWRldi0+aXBfYmxvY2tzW2ldLnN0YXR1
cy5odyA9IHRydWU7CiAJCX0KIAl9CiAKQEAgLTIzMzgsNyArMjM1NCw3IEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X2RldmljZV9pcF9yZXN1bWVfcGhhc2UyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
KQogCWludCBpLCByOwogCiAJZm9yIChpID0gMDsgaSA8IGFkZXYtPm51bV9pcF9ibG9ja3M7IGkr
KykgewotCQlpZiAoIWFkZXYtPmlwX2Jsb2Nrc1tpXS5zdGF0dXMudmFsaWQpCisJCWlmICghYWRl
di0+aXBfYmxvY2tzW2ldLnN0YXR1cy52YWxpZCB8fCBhZGV2LT5pcF9ibG9ja3NbaV0uc3RhdHVz
Lmh3KQogCQkJY29udGludWU7CiAJCWlmIChhZGV2LT5pcF9ibG9ja3NbaV0udmVyc2lvbi0+dHlw
ZSA9PSBBTURfSVBfQkxPQ0tfVFlQRV9DT01NT04gfHwKIAkJICAgIGFkZXYtPmlwX2Jsb2Nrc1tp
XS52ZXJzaW9uLT50eXBlID09IEFNRF9JUF9CTE9DS19UWVBFX0dNQyB8fApAQCAtMjM1MSw2ICsy
MzY3LDcgQEAgc3RhdGljIGludCBhbWRncHVfZGV2aWNlX2lwX3Jlc3VtZV9waGFzZTIoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCQkJICBhZGV2LT5pcF9ibG9ja3NbaV0udmVyc2lvbi0+
ZnVuY3MtPm5hbWUsIHIpOwogCQkJcmV0dXJuIHI7CiAJCX0KKwkJYWRldi0+aXBfYmxvY2tzW2ld
LnN0YXR1cy5odyA9IHRydWU7CiAJfQogCiAJcmV0dXJuIDA7Ci0tIAoyLjcuNAoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxp
c3QKYW1kLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9hbWQtZ2Z4
