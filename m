Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9603869E05
	for <lists+amd-gfx@lfdr.de>; Mon, 15 Jul 2019 23:25:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CC74E89DFE;
	Mon, 15 Jul 2019 21:25:03 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x843.google.com (mail-qt1-x843.google.com
 [IPv6:2607:f8b0:4864:20::843])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 55E9289DFE
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 21:25:02 +0000 (UTC)
Received: by mail-qt1-x843.google.com with SMTP id w17so17252025qto.10
 for <amd-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 14:25:02 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=axc0M5sVh4QcCwEXupKjp0Y4gXEajsdXNKh+1MnJLLo=;
 b=W/09olayTNkA0Y9CQWrDBiO/OUe+5CBkKHBGydI5JiZpeGFJ/cduDV187J4vmpB7fB
 B3B0qH7j63jAKoSc81IRoTpUqg1JtYKsihJ11qE0TQEylyfvphNWeYoZJGbq9yzKV7v1
 4zjkOBJgFCu20b8Qg2xk3Tk+MlUMgCwStTIracRhnKosC/rGTrrd5eegW4CiMNMvmSCA
 P25skWOZlMkw2riWa4/urhDv6jXAq1yExA0Lt1a/4BS3O0M1tilvV/lkR8OOnqlvN1gH
 jY6UAm6kIzlSk0Oe+yBg0Ctg7i/n6ynCx0DSEhFJok8Of1T2xju6gFa8qx58elQhO2sL
 Ym4g==
X-Gm-Message-State: APjAAAXqLn6OPFsRH6TTI0oyHXmLauStmUwQv2T3Jumpuq5nNoTZhIEq
 3SNX65ibj6Hwis2ApwENnN5nH6Qe
X-Google-Smtp-Source: APXvYqxnbblxFGVqku0Gq9TRbVblctK9kzVQ3dqlXLBPF4bqegklTvNiQGYCrU1bIlCVWtHGJHhnzA==
X-Received: by 2002:a0c:fb01:: with SMTP id c1mr20628221qvp.122.1563225901105; 
 Mon, 15 Jul 2019 14:25:01 -0700 (PDT)
Received: from localhost.localdomain ([71.219.21.119])
 by smtp.gmail.com with ESMTPSA id q56sm10274133qtq.64.2019.07.15.14.25.00
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 15 Jul 2019 14:25:00 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 018/102] drm/amdgpu: reorganize sdma v4 code to support more
 instances
Date: Mon, 15 Jul 2019 16:23:13 -0500
Message-Id: <20190715212437.31793-16-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190715212437.31793-1-alexander.deucher@amd.com>
References: <20190715212437.31793-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=axc0M5sVh4QcCwEXupKjp0Y4gXEajsdXNKh+1MnJLLo=;
 b=NhD43yV0rgNJ/R1ld+JJnCjCMwwvG/QUtl+/5JnJyPLcNmiRQ475AbXe5mLfECcVgq
 xWIUYRXUUnsNPwNIkLf0hvo4kW4YbNai8dNaK1mVrG+n9JwFfyOgnKHFKo1piRN5lYLs
 f35hYN0zN6KHYPgeGkW0nZXe71/4DMvmWsyyE67MVuR8f6NpRXA3Aw3EOMOj+sM39VjY
 4MBvGG47NfQQDoxG0yze2yky7EbpdXpOllZdguxeRCpS+UvEUZgl/yZZbNu8rEGwkEvq
 s63P1ylyLHgMgqd6hg59EntTQSm9J5w1ARiDlUd7Z5ZXQBnWpuws2pdXpR7mTbVbNj1Z
 G6WQ==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Snow Zhang <Snow.Zhang@amd.com>, Le Ma <le.ma@amd.com>,
 Alex Deucher <alexander.deucher@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGUgTWEgPGxlLm1hQGFtZC5jb20+CgpUaGlzIGNoYW5nZSBpcyBuZWVkZWQgZm9yIEFy
Y3R1cnVzIHdoaWNoIGhhcyA4IHNkbWEgaW5zdGFuY2VzLgpUaGUgQ0cvUEcgcGFydCBpcyBub3Qg
Y292ZXJlZCBmb3Igbm93LgoKU2lnbmVkLW9mZi1ieTogTGUgTWEgPGxlLm1hQGFtZC5jb20+CkFj
a2VkLWJ5OiBTbm93IFpoYW5nIDwgU25vdy5aaGFuZ0BhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBB
bGV4IERldWNoZXIgPGFsZXhhbmRlci5kZXVjaGVyQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3NkbWEuaCB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvc2RtYV92NF8wLmMgICB8IDE0NCArKysrKysrKysrKysrKysrLS0tLS0tLQogMiBm
aWxlcyBjaGFuZ2VkLCAxMDcgaW5zZXJ0aW9ucygrKSwgNDUgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3NkbWEuaCBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zZG1hLmgKaW5kZXggMzVkZDE1MmY5ZDVjLi5hOWFl
MGQ4YTA1ODkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9z
ZG1hLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3NkbWEuaApAQCAt
MjUsMTEgKzI1LDE3IEBACiAjZGVmaW5lIF9fQU1ER1BVX1NETUFfSF9fCiAKIC8qIG1heCBudW1i
ZXIgb2YgSVAgaW5zdGFuY2VzICovCi0jZGVmaW5lIEFNREdQVV9NQVhfU0RNQV9JTlNUQU5DRVMJ
CTIKKyNkZWZpbmUgQU1ER1BVX01BWF9TRE1BX0lOU1RBTkNFUwkJOAogCiBlbnVtIGFtZGdwdV9z
ZG1hX2lycSB7CiAJQU1ER1BVX1NETUFfSVJRX0lOU1RBTkNFMCAgPSAwLAogCUFNREdQVV9TRE1B
X0lSUV9JTlNUQU5DRTEsCisJQU1ER1BVX1NETUFfSVJRX0lOU1RBTkNFMiwKKwlBTURHUFVfU0RN
QV9JUlFfSU5TVEFOQ0UzLAorCUFNREdQVV9TRE1BX0lSUV9JTlNUQU5DRTQsCisJQU1ER1BVX1NE
TUFfSVJRX0lOU1RBTkNFNSwKKwlBTURHUFVfU0RNQV9JUlFfSU5TVEFOQ0U2LAorCUFNREdQVV9T
RE1BX0lSUV9JTlNUQU5DRTcsCiAJQU1ER1BVX1NETUFfSVJRX0xBU1QKIH07CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NkbWFfdjRfMC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvc2RtYV92NF8wLmMKaW5kZXggOGQ5ZWZiZDg4YTQ5Li5iNjUwOTUyNWY0
ZmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NkbWFfdjRfMC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NkbWFfdjRfMC5jCkBAIC0yMDIsOCArMjAy
LDc3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgc29jMTVfcmVnX2dvbGRlbiBnb2xkZW5fc2V0dGlu
Z3Nfc2RtYV9ydjJbXSA9CiBzdGF0aWMgdTMyIHNkbWFfdjRfMF9nZXRfcmVnX29mZnNldChzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJdTMyIGluc3RhbmNlLCB1MzIgb2Zmc2V0KQogewot
CXJldHVybiAoIDAgPT0gaW5zdGFuY2UgPyAoYWRldi0+cmVnX29mZnNldFtTRE1BMF9IV0lQXVsw
XVswXSArIG9mZnNldCkgOgotCQkJKGFkZXYtPnJlZ19vZmZzZXRbU0RNQTFfSFdJUF1bMF1bMF0g
KyBvZmZzZXQpKTsKKwlzd2l0Y2ggKGluc3RhbmNlKSB7CisJY2FzZSAwOgorCQlyZXR1cm4gKGFk
ZXYtPnJlZ19vZmZzZXRbU0RNQTBfSFdJUF1bMF1bMF0gKyBvZmZzZXQpOworCWNhc2UgMToKKwkJ
cmV0dXJuIChhZGV2LT5yZWdfb2Zmc2V0W1NETUExX0hXSVBdWzBdWzBdICsgb2Zmc2V0KTsKKwlj
YXNlIDI6CisJCXJldHVybiAoYWRldi0+cmVnX29mZnNldFtTRE1BMl9IV0lQXVswXVswXSArIG9m
ZnNldCk7CisJY2FzZSAzOgorCQlyZXR1cm4gKGFkZXYtPnJlZ19vZmZzZXRbU0RNQTNfSFdJUF1b
MF1bMF0gKyBvZmZzZXQpOworCWNhc2UgNDoKKwkJcmV0dXJuIChhZGV2LT5yZWdfb2Zmc2V0W1NE
TUE0X0hXSVBdWzBdWzBdICsgb2Zmc2V0KTsKKwljYXNlIDU6CisJCXJldHVybiAoYWRldi0+cmVn
X29mZnNldFtTRE1BNV9IV0lQXVswXVswXSArIG9mZnNldCk7CisJY2FzZSA2OgorCQlyZXR1cm4g
KGFkZXYtPnJlZ19vZmZzZXRbU0RNQTZfSFdJUF1bMF1bMF0gKyBvZmZzZXQpOworCWNhc2UgNzoK
KwkJcmV0dXJuIChhZGV2LT5yZWdfb2Zmc2V0W1NETUE3X0hXSVBdWzBdWzBdICsgb2Zmc2V0KTsK
KwlkZWZhdWx0OgorCQlicmVhazsKKwl9CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB1bnNpZ25l
ZCBzZG1hX3Y0XzBfc2VxX3RvX2lycV9pZChpbnQgc2VxX251bSkKK3sKKwlzd2l0Y2ggKHNlcV9u
dW0pIHsKKwljYXNlIDA6CisJCXJldHVybiBTT0MxNV9JSF9DTElFTlRJRF9TRE1BMDsKKwljYXNl
IDE6CisJCXJldHVybiBTT0MxNV9JSF9DTElFTlRJRF9TRE1BMTsKKwljYXNlIDI6CisJCXJldHVy
biBTT0MxNV9JSF9DTElFTlRJRF9TRE1BMjsKKwljYXNlIDM6CisJCXJldHVybiBTT0MxNV9JSF9D
TElFTlRJRF9TRE1BMzsKKwljYXNlIDQ6CisJCXJldHVybiBTT0MxNV9JSF9DTElFTlRJRF9TRE1B
NDsKKwljYXNlIDU6CisJCXJldHVybiBTT0MxNV9JSF9DTElFTlRJRF9TRE1BNTsKKwljYXNlIDY6
CisJCXJldHVybiBTT0MxNV9JSF9DTElFTlRJRF9TRE1BNjsKKwljYXNlIDc6CisJCXJldHVybiBT
T0MxNV9JSF9DTElFTlRJRF9TRE1BNzsKKwlkZWZhdWx0OgorCQlicmVhazsKKwl9CisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQgc2RtYV92NF8wX2lycV9pZF90b19zZXEodW5zaWduZWQgY2xp
ZW50X2lkKQoreworCXN3aXRjaCAoY2xpZW50X2lkKSB7CisJY2FzZSBTT0MxNV9JSF9DTElFTlRJ
RF9TRE1BMDoKKwkJcmV0dXJuIDA7CisJY2FzZSBTT0MxNV9JSF9DTElFTlRJRF9TRE1BMToKKwkJ
cmV0dXJuIDE7CisJY2FzZSBTT0MxNV9JSF9DTElFTlRJRF9TRE1BMjoKKwkJcmV0dXJuIDI7CisJ
Y2FzZSBTT0MxNV9JSF9DTElFTlRJRF9TRE1BMzoKKwkJcmV0dXJuIDM7CisJY2FzZSBTT0MxNV9J
SF9DTElFTlRJRF9TRE1BNDoKKwkJcmV0dXJuIDQ7CisJY2FzZSBTT0MxNV9JSF9DTElFTlRJRF9T
RE1BNToKKwkJcmV0dXJuIDU7CisJY2FzZSBTT0MxNV9JSF9DTElFTlRJRF9TRE1BNjoKKwkJcmV0
dXJuIDY7CisJY2FzZSBTT0MxNV9JSF9DTElFTlRJRF9TRE1BNzoKKwkJcmV0dXJuIDc7CisJZGVm
YXVsdDoKKwkJYnJlYWs7CisJfQorCXJldHVybiAwOwogfQogCiBzdGF0aWMgdm9pZCBzZG1hX3Y0
XzBfaW5pdF9nb2xkZW5fcmVnaXN0ZXJzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQpAQCAt
MzA1LDcgKzM3NCw3IEBAIHN0YXRpYyBpbnQgc2RtYV92NF8wX2luaXRfbWljcm9jb2RlKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2KQogCQlpZiAoaSA9PSAwKQogCQkJc25wcmludGYoZndfbmFt
ZSwgc2l6ZW9mKGZ3X25hbWUpLCAiYW1kZ3B1LyVzX3NkbWEuYmluIiwgY2hpcF9uYW1lKTsKIAkJ
ZWxzZQotCQkJc25wcmludGYoZndfbmFtZSwgc2l6ZW9mKGZ3X25hbWUpLCAiYW1kZ3B1LyVzX3Nk
bWExLmJpbiIsIGNoaXBfbmFtZSk7CisJCQlzbnByaW50Zihmd19uYW1lLCBzaXplb2YoZndfbmFt
ZSksICJhbWRncHUvJXNfc2RtYSVkLmJpbiIsIGNoaXBfbmFtZSwgaSk7CiAJCWVyciA9IHJlcXVl
c3RfZmlybXdhcmUoJmFkZXYtPnNkbWEuaW5zdGFuY2VbaV0uZncsIGZ3X25hbWUsIGFkZXYtPmRl
dik7CiAJCWlmIChlcnIpCiAJCQlnb3RvIG91dDsKQEAgLTYxNywyNiArNjg2LDI3IEBAIHN0YXRp
YyB2b2lkIHNkbWFfdjRfMF9yaW5nX2VtaXRfZmVuY2Uoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5n
LCB1NjQgYWRkciwgdTY0IHNlCiAgKi8KIHN0YXRpYyB2b2lkIHNkbWFfdjRfMF9nZnhfc3RvcChz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIHsKLQlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnNkbWEw
ID0gJmFkZXYtPnNkbWEuaW5zdGFuY2VbMF0ucmluZzsKLQlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnNk
bWExID0gJmFkZXYtPnNkbWEuaW5zdGFuY2VbMV0ucmluZzsKKwlzdHJ1Y3QgYW1kZ3B1X3Jpbmcg
KnNkbWFbQU1ER1BVX01BWF9TRE1BX0lOU1RBTkNFU107CiAJdTMyIHJiX2NudGwsIGliX2NudGw7
Ci0JaW50IGk7CisJaW50IGksIHVuc2V0ID0gMDsKIAotCWlmICgoYWRldi0+bW1hbi5idWZmZXJf
ZnVuY3NfcmluZyA9PSBzZG1hMCkgfHwKLQkgICAgKGFkZXYtPm1tYW4uYnVmZmVyX2Z1bmNzX3Jp
bmcgPT0gc2RtYTEpKQorCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5zZG1hLm51bV9pbnN0YW5jZXM7
IGkrKykgeworCQlzZG1hW2ldID0gJmFkZXYtPnNkbWEuaW5zdGFuY2VbaV0ucmluZzsKKworCQlp
ZiAoKGFkZXYtPm1tYW4uYnVmZmVyX2Z1bmNzX3JpbmcgPT0gc2RtYVtpXSkgJiYgdW5zZXQgIT0g
MSkgewogCQkJYW1kZ3B1X3R0bV9zZXRfYnVmZmVyX2Z1bmNzX3N0YXR1cyhhZGV2LCBmYWxzZSk7
CisJCQl1bnNldCA9IDE7CisJCX0KIAotCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5zZG1hLm51bV9p
bnN0YW5jZXM7IGkrKykgewogCQlyYl9jbnRsID0gUlJFRzMyX1NETUEoaSwgbW1TRE1BMF9HRlhf
UkJfQ05UTCk7CiAJCXJiX2NudGwgPSBSRUdfU0VUX0ZJRUxEKHJiX2NudGwsIFNETUEwX0dGWF9S
Ql9DTlRMLCBSQl9FTkFCTEUsIDApOwogCQlXUkVHMzJfU0RNQShpLCBtbVNETUEwX0dGWF9SQl9D
TlRMLCByYl9jbnRsKTsKIAkJaWJfY250bCA9IFJSRUczMl9TRE1BKGksIG1tU0RNQTBfR0ZYX0lC
X0NOVEwpOwogCQlpYl9jbnRsID0gUkVHX1NFVF9GSUVMRChpYl9jbnRsLCBTRE1BMF9HRlhfSUJf
Q05UTCwgSUJfRU5BQkxFLCAwKTsKIAkJV1JFRzMyX1NETUEoaSwgbW1TRE1BMF9HRlhfSUJfQ05U
TCwgaWJfY250bCk7Ci0JfQogCi0Jc2RtYTAtPnNjaGVkLnJlYWR5ID0gZmFsc2U7Ci0Jc2RtYTEt
PnNjaGVkLnJlYWR5ID0gZmFsc2U7CisJCXNkbWFbaV0tPnNjaGVkLnJlYWR5ID0gZmFsc2U7CisJ
fQogfQogCiAvKioKQEAgLTE2MDMsMTYgKzE2NzMsMTMgQEAgc3RhdGljIGludCBzZG1hX3Y0XzBf
c3dfaW5pdCh2b2lkICpoYW5kbGUpCiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKiloYW5kbGU7CiAKIAkvKiBTRE1BIHRyYXAgZXZlbnQgKi8KLQly
ID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRldiwgU09DMTVfSUhfQ0xJRU5USURfU0RNQTAsIFNETUEw
XzRfMF9fU1JDSURfX1NETUFfVFJBUCwKLQkJCSAgICAgICZhZGV2LT5zZG1hLnRyYXBfaXJxKTsK
LQlpZiAocikKLQkJcmV0dXJuIHI7Ci0KLQkvKiBTRE1BIHRyYXAgZXZlbnQgKi8KLQlyID0gYW1k
Z3B1X2lycV9hZGRfaWQoYWRldiwgU09DMTVfSUhfQ0xJRU5USURfU0RNQTEsIFNETUExXzRfMF9f
U1JDSURfX1NETUFfVFJBUCwKLQkJCSAgICAgICZhZGV2LT5zZG1hLnRyYXBfaXJxKTsKLQlpZiAo
cikKLQkJcmV0dXJuIHI7CisJZm9yIChpID0gMDsgaSA8IGFkZXYtPnNkbWEubnVtX2luc3RhbmNl
czsgaSsrKSB7CisJCXIgPSBhbWRncHVfaXJxX2FkZF9pZChhZGV2LCBzZG1hX3Y0XzBfc2VxX3Rv
X2lycV9pZChpKSwKKwkJCQkgICAgICBTRE1BMF80XzBfX1NSQ0lEX19TRE1BX1RSQVAsCisJCQkJ
ICAgICAgJmFkZXYtPnNkbWEudHJhcF9pcnEpOworCQlpZiAocikKKwkJCXJldHVybiByOworCX0K
IAogCS8qIFNETUEgU1JBTSBFQ0MgZXZlbnQgKi8KIAlyID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRl
diwgU09DMTVfSUhfQ0xJRU5USURfU0RNQTAsIFNETUEwXzRfMF9fU1JDSURfX1NETUFfU1JBTV9F
Q0MsCkBAIC0xNjM4LDExICsxNzA1LDggQEAgc3RhdGljIGludCBzZG1hX3Y0XzBfc3dfaW5pdCh2
b2lkICpoYW5kbGUpCiAJCXJpbmctPmRvb3JiZWxsX2luZGV4ID0gYWRldi0+ZG9vcmJlbGxfaW5k
ZXguc2RtYV9lbmdpbmVbaV0gPDwgMTsKIAogCQlzcHJpbnRmKHJpbmctPm5hbWUsICJzZG1hJWQi
LCBpKTsKLQkJciA9IGFtZGdwdV9yaW5nX2luaXQoYWRldiwgcmluZywgMTAyNCwKLQkJCQkgICAg
ICZhZGV2LT5zZG1hLnRyYXBfaXJxLAotCQkJCSAgICAgKGkgPT0gMCkgPwotCQkJCSAgICAgQU1E
R1BVX1NETUFfSVJRX0lOU1RBTkNFMCA6Ci0JCQkJICAgICBBTURHUFVfU0RNQV9JUlFfSU5TVEFO
Q0UxKTsKKwkJciA9IGFtZGdwdV9yaW5nX2luaXQoYWRldiwgcmluZywgMTAyNCwgJmFkZXYtPnNk
bWEudHJhcF9pcnEsCisJCQkJICAgICBBTURHUFVfU0RNQV9JUlFfSU5TVEFOQ0UwICsgaSk7CiAJ
CWlmIChyKQogCQkJcmV0dXJuIHI7CiAKQEAgLTE3NzMsMTUgKzE4MzcsMTcgQEAgc3RhdGljIGJv
b2wgc2RtYV92NF8wX2lzX2lkbGUodm9pZCAqaGFuZGxlKQogCiBzdGF0aWMgaW50IHNkbWFfdjRf
MF93YWl0X2Zvcl9pZGxlKHZvaWQgKmhhbmRsZSkKIHsKLQl1bnNpZ25lZCBpOwotCXUzMiBzZG1h
MCwgc2RtYTE7CisJdW5zaWduZWQgaSwgajsKKwl1MzIgc2RtYVtBTURHUFVfTUFYX1NETUFfSU5T
VEFOQ0VTXTsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqKWhhbmRsZTsKIAogCWZvciAoaSA9IDA7IGkgPCBhZGV2LT51c2VjX3RpbWVvdXQ7IGkr
KykgewotCQlzZG1hMCA9IFJSRUczMl9TRE1BKDAsIG1tU0RNQTBfU1RBVFVTX1JFRyk7Ci0JCXNk
bWExID0gUlJFRzMyX1NETUEoMSwgbW1TRE1BMF9TVEFUVVNfUkVHKTsKLQotCQlpZiAoc2RtYTAg
JiBzZG1hMSAmIFNETUEwX1NUQVRVU19SRUdfX0lETEVfTUFTSykKKwkJZm9yIChqID0gMDsgaiA8
IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsgaisrKSB7CisJCQlzZG1hW2pdID0gUlJFRzMyX1NE
TUEoaiwgbW1TRE1BMF9TVEFUVVNfUkVHKTsKKwkJCWlmICghKHNkbWFbal0gJiBTRE1BMF9TVEFU
VVNfUkVHX19JRExFX01BU0spKQorCQkJCWJyZWFrOworCQl9CisJCWlmIChqID09IGFkZXYtPnNk
bWEubnVtX2luc3RhbmNlcykKIAkJCXJldHVybiAwOwogCQl1ZGVsYXkoMSk7CiAJfQpAQCAtMTgx
NywxNyArMTg4Myw3IEBAIHN0YXRpYyBpbnQgc2RtYV92NF8wX3Byb2Nlc3NfdHJhcF9pcnEoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJdWludDMyX3QgaW5zdGFuY2U7CiAKIAlEUk1fREVC
VUcoIklIOiBTRE1BIHRyYXBcbiIpOwotCXN3aXRjaCAoZW50cnktPmNsaWVudF9pZCkgewotCWNh
c2UgU09DMTVfSUhfQ0xJRU5USURfU0RNQTA6Ci0JCWluc3RhbmNlID0gMDsKLQkJYnJlYWs7Ci0J
Y2FzZSBTT0MxNV9JSF9DTElFTlRJRF9TRE1BMToKLQkJaW5zdGFuY2UgPSAxOwotCQlicmVhazsK
LQlkZWZhdWx0OgotCQlyZXR1cm4gMDsKLQl9Ci0KKwlpbnN0YW5jZSA9IHNkbWFfdjRfMF9pcnFf
aWRfdG9fc2VxKGVudHJ5LT5jbGllbnRfaWQpOwogCXN3aXRjaCAoZW50cnktPnJpbmdfaWQpIHsK
IAljYXNlIDA6CiAJCWFtZGdwdV9mZW5jZV9wcm9jZXNzKCZhZGV2LT5zZG1hLmluc3RhbmNlW2lu
c3RhbmNlXS5yaW5nKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9hbWQtZ2Z4
