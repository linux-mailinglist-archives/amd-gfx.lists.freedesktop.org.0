Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 131C348E9D
	for <lists+amd-gfx@lfdr.de>; Mon, 17 Jun 2019 21:27:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 755E989872;
	Mon, 17 Jun 2019 19:27:27 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from mail-qt1-x841.google.com (mail-qt1-x841.google.com
 [IPv6:2607:f8b0:4864:20::841])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0FD428985A
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 19:27:25 +0000 (UTC)
Received: by mail-qt1-x841.google.com with SMTP id d23so12238835qto.2
 for <amd-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 12:27:25 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=KJXhUGVlySwL+LSiy8Z0byn2IxKlTGrb5BGt3PvhDI8=;
 b=qpQdJk4tuWP88LZa9uoyG5+6RYOdV+1CDEFnnFuDqcl3zQHk9bP1IiaUmQJa85lddi
 hG4WzOisGNAokkC63jhOGc1yqFedwe+vpPepgJBzrNT4LBGL84En3H8h/h72qFpjsmbP
 mCdb885GsqGZBLV8ho24ZetlaKIcwBBm+1NH4hAsJc8CYJKYMEZbY3cJu205vfXwa5r+
 Nsw0bYh2nHi+guw/ngM6ptJ6TIN9fz+vu1ttCVr4HgZSmB91XjzWG2Vt6/Ojihwp8BYW
 oiTxE31NYhTtU9LbN6j7Iuotr5wroATePcbW7lj/HkN2t2YO27GejmaXxTu87fkiyHtM
 DyNg==
X-Gm-Message-State: APjAAAWcBp87RsFMiBIB0cr9C0/xanIyEG62GPqtyoxx1Jil/wBlzV+D
 vEqm6PA0Hm+AHfXefcrOFHDXOZ78P84=
X-Google-Smtp-Source: APXvYqyN2GCsKw5WeTSSlMqOxghZTNLKX5bpuze+OSRrV429FzvRyKGdAHm0ppaVq0+8ICysmwbXOA==
X-Received: by 2002:a0c:d7c7:: with SMTP id g7mr23124742qvj.171.1560799642313; 
 Mon, 17 Jun 2019 12:27:22 -0700 (PDT)
Received: from localhost.localdomain ([71.219.5.136])
 by smtp.gmail.com with ESMTPSA id p37sm7715622qtc.35.2019.06.17.12.27.21
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 17 Jun 2019 12:27:21 -0700 (PDT)
From: Alex Deucher <alexdeucher@gmail.com>
X-Google-Original-From: Alex Deucher <alexander.deucher@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 111/459] drm/amdgpu: add initial support for sdma v5.0 (v6)
Date: Mon, 17 Jun 2019 14:25:36 -0500
Message-Id: <20190617192704.18038-12-alexander.deucher@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617192704.18038-1-alexander.deucher@amd.com>
References: <20190617192704.18038-1-alexander.deucher@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=KJXhUGVlySwL+LSiy8Z0byn2IxKlTGrb5BGt3PvhDI8=;
 b=I3XV/mdVYcuUnq9UW8oafs3Pv5BACMNVJG33I+yxIi1r2kemy8T5V8XV0ZmBaArUe3
 io4SyHzyPcxBYCzKRgpyCrmtorA6I2ldsvCAImFHqJOFBqTUR+2Tv99l/Vmr5sm4QA45
 HVG36H1wwtbqK55IfBwL15OIG8OYfwmTt4CSg7OjGyyLoNpCNLFd2+ux8fWTzO2n4/lo
 rpJLoUtjDtnMnm04CY/46yrup9Y7P36UcqPlyyCsmKJcKQcCU0s544z4em++CrcYz0kv
 L+fL5EARdUlYxi/FvyWx5OsfIvWI7opawTqQp0vZzXcoEtxr4/2rS0GgrqEw4zbL459a
 gOVA==
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Deucher <alexander.deucher@amd.com>,
 Hawking Zhang <Hawking.Zhang@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogSGF3a2luZyBaaGFuZyA8SGF3a2luZy5aaGFuZ0BhbWQuY29tPgoKU0RNQSAoU3lzdGVt
IERNQSkgaXMgYSBnZW5lcmFsIHB1cnBvc2UgRE1BIGVuZ2luZSB1c2FibGUKYnkgVU1EcyBmb3Ig
dHJhbnNmZXJzIG9yIHRoZSBrZXJuZWwgZm9yIHBhZ2luZyBvciBHUFVWTQp1cGRhdGVzLgoKdjE6
IHN1cHBvcnQgYmFzaWMgZnVuY2l0b25hbGl0ZXMgaW5jbHVkZXMgcmIsIGliLCB2bSwKICAgIGNv
cHkgYnVmZmVyIGFuZCB0cmFwIGlycQp2MjogY29udmVydCB0byB1c2UgbmV3IGdldF92bV9wZGUg
aW4gZW1pdF92bV9mbHVzaAp2MzogcmV0aXJlIGFtZGdwdV90dG1fc2V0X2FjdGl2ZV92cmFtX3Np
emUgZnJvbSBzZG1hIHY1CnY0OiByZXRpcmUgdGhlIHJlZHVuZGFudCBoZHBfaW52YWxpZGF0ZSBp
bXBsZW1lbnRhdGlvbgp2NTogc3F1YXNoIGluIHVwZGF0ZXMKdjY6IHNvbWUgZ29sZGVuIHJlZ3Mg
bW92ZWQgdG8gdmJpb3MKClNpZ25lZC1vZmYtYnk6IEhhd2tpbmcgWmhhbmcgPEhhd2tpbmcuWmhh
bmdAYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IEFsZXggRGV1Y2hlciA8YWxleGFuZGVyLmRldWNoZXJA
YW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogQWxleCBEZXVjaGVyIDxhbGV4YW5kZXIuZGV1Y2hlckBh
bWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L01ha2VmaWxlICAgIHwgICAg
MyArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2RtYV92NV8wLmMgfCAxNjg1ICsrKysr
KysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2RtYV92NV8w
LmggfCAgIDQ1ICsKIDMgZmlsZXMgY2hhbmdlZCwgMTczMiBpbnNlcnRpb25zKCspLCAxIGRlbGV0
aW9uKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2Rt
YV92NV8wLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9z
ZG1hX3Y1XzAuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L01ha2Vm
aWxlIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvTWFrZWZpbGUKaW5kZXggZTYyZjdjZGY4
ODIzLi4wZTdhNDAyZDVlZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L01ha2VmaWxlCkBAIC0x
MTcsNyArMTE3LDggQEAgYW1kZ3B1LXkgKz0gXAogCWFtZGdwdV9zZG1hLm8gXAogCXNkbWFfdjJf
NC5vIFwKIAlzZG1hX3YzXzAubyBcCi0Jc2RtYV92NF8wLm8KKwlzZG1hX3Y0XzAubyBcCisJc2Rt
YV92NV8wLm8KIAogIyBhZGQgVVZEIGJsb2NrCiBhbWRncHUteSArPSBcCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zZG1hX3Y1XzAuYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L3NkbWFfdjVfMC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uMDgzZjgxNjExZTI0Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvc2RtYV92NV8wLmMKQEAgLTAsMCArMSwxNjg1IEBACisvKgorICogQ29weXJpZ2h0
IDIwMTkgQWR2YW5jZWQgTWljcm8gRGV2aWNlcywgSW5jLgorICoKKyAqIFBlcm1pc3Npb24gaXMg
aGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBh
CisgKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBm
aWxlcyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91
dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICogdGhlIHJpZ2h0
cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1Ymxp
Y2Vuc2UsCisgKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVy
bWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBz
bywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3Zl
IGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5j
bHVkZWQgaW4KKyAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNv
ZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VU
IFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisgKiBJTVBMSUVELCBJTkNMVURJTkcg
QlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKyAq
IEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJ
TiBOTyBFVkVOVCBTSEFMTAorICogVEhFIENPUFlSSUdIVCBIT0xERVIoUykgT1IgQVVUSE9SKFMp
IEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SCisgKiBPVEhFUiBMSUFCSUxJVFks
IFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwKKyAq
IEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUg
T1IgVEhFIFVTRSBPUgorICogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgorICoKKyAq
LworCisjaW5jbHVkZSA8bGludXgvZmlybXdhcmUuaD4KKyNpbmNsdWRlIDxkcm0vZHJtUC5oPgor
I2luY2x1ZGUgImFtZGdwdS5oIgorI2luY2x1ZGUgImFtZGdwdV91Y29kZS5oIgorI2luY2x1ZGUg
ImFtZGdwdV90cmFjZS5oIgorCisjaW5jbHVkZSAiZ2MvZ2NfMTBfMV8wX29mZnNldC5oIgorI2lu
Y2x1ZGUgImdjL2djXzEwXzFfMF9zaF9tYXNrLmgiCisjaW5jbHVkZSAiaGRwL2hkcF81XzBfMF9v
ZmZzZXQuaCIKKyNpbmNsdWRlICJpdnNyY2lkL3NkbWEwL2lycXNyY3Nfc2RtYTBfNV8wLmgiCisj
aW5jbHVkZSAiaXZzcmNpZC9zZG1hMS9pcnFzcmNzX3NkbWExXzVfMC5oIgorCisjaW5jbHVkZSAi
c29jMTVfY29tbW9uLmgiCisjaW5jbHVkZSAic29jMTUuaCIKKyNpbmNsdWRlICJuYXZpMTBfc2Rt
YV9wa3Rfb3Blbi5oIgorI2luY2x1ZGUgIm5iaW9fdjJfMy5oIgorI2luY2x1ZGUgInNkbWFfdjVf
MC5oIgorCitNT0RVTEVfRklSTVdBUkUoImFtZGdwdS9uYXZpMTBfc2RtYS5iaW4iKTsKK01PRFVM
RV9GSVJNV0FSRSgiYW1kZ3B1L25hdmkxMF9zZG1hMS5iaW4iKTsKKworI2RlZmluZSBTRE1BMV9S
RUdfT0ZGU0VUIDB4NjAwCisjZGVmaW5lIFNETUEwX0hZUF9ERUNfUkVHX1NUQVJUIDB4NTg4MAor
I2RlZmluZSBTRE1BMF9IWVBfREVDX1JFR19FTkQgMHg1ODkzCisjZGVmaW5lIFNETUExX0hZUF9E
RUNfUkVHX09GRlNFVCAweDIwCisKK3N0YXRpYyB2b2lkIHNkbWFfdjVfMF9zZXRfcmluZ19mdW5j
cyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7CitzdGF0aWMgdm9pZCBzZG1hX3Y1XzBfc2V0
X2J1ZmZlcl9mdW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7CitzdGF0aWMgdm9pZCBz
ZG1hX3Y1XzBfc2V0X3ZtX3B0ZV9mdW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldik7Citz
dGF0aWMgdm9pZCBzZG1hX3Y1XzBfc2V0X2lycV9mdW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldik7CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgc29jMTVfcmVnX2dvbGRlbiBnb2xkZW5fc2V0
dGluZ3Nfc2RtYV81W10gPSB7CisJU09DMTVfUkVHX0dPTERFTl9WQUxVRShHQywgMCwgbW1TRE1B
MF9DSElDS0VOX0JJVFMsIDB4ZmZiZjFmMGYsIDB4MDNhYjAxMDcpLAorCVNPQzE1X1JFR19HT0xE
RU5fVkFMVUUoR0MsIDAsIG1tU0RNQTBfR0ZYX1JCX1dQVFJfUE9MTF9DTlRMLCAweGZmZmZmZmY3
LCAweDAwNDAzMDAwKSwKKwlTT0MxNV9SRUdfR09MREVOX1ZBTFVFKEdDLCAwLCBtbVNETUEwX1BB
R0VfUkJfV1BUUl9QT0xMX0NOVEwsIDB4ZmZmZmZmZjcsIDB4MDA0MDMwMDApLAorCVNPQzE1X1JF
R19HT0xERU5fVkFMVUUoR0MsIDAsIG1tU0RNQTBfUkxDMF9SQl9XUFRSX1BPTExfQ05UTCwgMHhm
ZmZmZmZmNywgMHgwMDQwMzAwMCksCisJU09DMTVfUkVHX0dPTERFTl9WQUxVRShHQywgMCwgbW1T
RE1BMF9STEMxX1JCX1dQVFJfUE9MTF9DTlRMLCAweGZmZmZmZmY3LCAweDAwNDAzMDAwKSwKKwlT
T0MxNV9SRUdfR09MREVOX1ZBTFVFKEdDLCAwLCBtbVNETUEwX1JMQzJfUkJfV1BUUl9QT0xMX0NO
VEwsIDB4ZmZmZmZmZjcsIDB4MDA0MDMwMDApLAorCVNPQzE1X1JFR19HT0xERU5fVkFMVUUoR0Ms
IDAsIG1tU0RNQTBfUkxDM19SQl9XUFRSX1BPTExfQ05UTCwgMHgwMDAwZmZmMCwgMHgwMDQwMzAw
MCksCisJU09DMTVfUkVHX0dPTERFTl9WQUxVRShHQywgMCwgbW1TRE1BMF9STEM0X1JCX1dQVFJf
UE9MTF9DTlRMLCAweGZmZmZmZmY3LCAweDAwNDAzMDAwKSwKKwlTT0MxNV9SRUdfR09MREVOX1ZB
TFVFKEdDLCAwLCBtbVNETUEwX1JMQzVfUkJfV1BUUl9QT0xMX0NOVEwsIDB4ZmZmZmZmZjcsIDB4
MDA0MDMwMDApLAorCVNPQzE1X1JFR19HT0xERU5fVkFMVUUoR0MsIDAsIG1tU0RNQTBfUkxDNl9S
Ql9XUFRSX1BPTExfQ05UTCwgMHhmZmZmZmZmNywgMHgwMDQwMzAwMCksCisJU09DMTVfUkVHX0dP
TERFTl9WQUxVRShHQywgMCwgbW1TRE1BMF9STEM3X1JCX1dQVFJfUE9MTF9DTlRMLCAweGZmZmZm
ZmY3LCAweDAwNDAzMDAwKSwKKwlTT0MxNV9SRUdfR09MREVOX1ZBTFVFKEdDLCAwLCBtbVNETUEw
X1VUQ0wxX1BBR0UsIDB4MDBmZmZmZmYsIDB4MDAwYzVjMDApLAorCVNPQzE1X1JFR19HT0xERU5f
VkFMVUUoR0MsIDAsIG1tU0RNQTFfQ0hJQ0tFTl9CSVRTLCAweGZmYmYxZjBmLCAweDAzYWIwMTA3
KSwKKwlTT0MxNV9SRUdfR09MREVOX1ZBTFVFKEdDLCAwLCBtbVNETUExX0dGWF9SQl9XUFRSX1BP
TExfQ05UTCwgMHhmZmZmZmZmNywgMHgwMDQwMzAwMCksCisJU09DMTVfUkVHX0dPTERFTl9WQUxV
RShHQywgMCwgbW1TRE1BMV9QQUdFX1JCX1dQVFJfUE9MTF9DTlRMLCAweGZmZmZmZmY3LCAweDAw
NDAzMDAwKSwKKwlTT0MxNV9SRUdfR09MREVOX1ZBTFVFKEdDLCAwLCBtbVNETUExX1JMQzBfUkJf
V1BUUl9QT0xMX0NOVEwsIDB4ZmZmZmZmZjcsIDB4MDA0MDMwMDApLAorCVNPQzE1X1JFR19HT0xE
RU5fVkFMVUUoR0MsIDAsIG1tU0RNQTFfUkxDMV9SQl9XUFRSX1BPTExfQ05UTCwgMHhmZmZmZmZm
NywgMHgwMDQwMzAwMCksCisJU09DMTVfUkVHX0dPTERFTl9WQUxVRShHQywgMCwgbW1TRE1BMV9S
TEMyX1JCX1dQVFJfUE9MTF9DTlRMLCAweGZmZmZmZmY3LCAweDAwNDAzMDAwKSwKKwlTT0MxNV9S
RUdfR09MREVOX1ZBTFVFKEdDLCAwLCBtbVNETUExX1JMQzNfUkJfV1BUUl9QT0xMX0NOVEwsIDB4
MDAwMGZmZjAsIDB4MDA0MDMwMDApLAorCVNPQzE1X1JFR19HT0xERU5fVkFMVUUoR0MsIDAsIG1t
U0RNQTFfUkxDNF9SQl9XUFRSX1BPTExfQ05UTCwgMHhmZmZmZmZmNywgMHgwMDQwMzAwMCksCisJ
U09DMTVfUkVHX0dPTERFTl9WQUxVRShHQywgMCwgbW1TRE1BMV9STEM1X1JCX1dQVFJfUE9MTF9D
TlRMLCAweGZmZmZmZmY3LCAweDAwNDAzMDAwKSwKKwlTT0MxNV9SRUdfR09MREVOX1ZBTFVFKEdD
LCAwLCBtbVNETUExX1JMQzZfUkJfV1BUUl9QT0xMX0NOVEwsIDB4ZmZmZmZmZjcsIDB4MDA0MDMw
MDApLAorCVNPQzE1X1JFR19HT0xERU5fVkFMVUUoR0MsIDAsIG1tU0RNQTFfUkxDN19SQl9XUFRS
X1BPTExfQ05UTCwgMHhmZmZmZmZmNywgMHgwMDQwMzAwMCksCisJU09DMTVfUkVHX0dPTERFTl9W
QUxVRShHQywgMCwgbW1TRE1BMV9VVENMMV9QQUdFLCAweDAwZmZmZmZmLCAweDAwMGM1YzAwKQor
fTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBzb2MxNV9yZWdfZ29sZGVuIGdvbGRlbl9zZXR0aW5n
c19zZG1hX252MTBbXSA9IHsKK307CisKK3N0YXRpYyB1MzIgc2RtYV92NV8wX2dldF9yZWdfb2Zm
c2V0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgaW5zdGFuY2UsIHUzMiBpbnRlcm5h
bF9vZmZzZXQpCit7CisJdTMyIGJhc2U7CisKKwlpZiAoaW50ZXJuYWxfb2Zmc2V0ID49IFNETUEw
X0hZUF9ERUNfUkVHX1NUQVJUICYmCisJICAgIGludGVybmFsX29mZnNldCA8PSBTRE1BMF9IWVBf
REVDX1JFR19FTkQpIHsKKwkJYmFzZSA9IGFkZXYtPnJlZ19vZmZzZXRbR0NfSFdJUF1bMF1bMV07
CisJCWlmIChpbnN0YW5jZSA9PSAxKQorCQkJaW50ZXJuYWxfb2Zmc2V0ICs9IFNETUExX0hZUF9E
RUNfUkVHX09GRlNFVDsKKwl9IGVsc2UgeworCQliYXNlID0gYWRldi0+cmVnX29mZnNldFtHQ19I
V0lQXVswXVswXTsKKwkJaWYgKGluc3RhbmNlID09IDEpCisJCQlpbnRlcm5hbF9vZmZzZXQgKz0g
U0RNQTFfUkVHX09GRlNFVDsKKwl9CisKKwlyZXR1cm4gYmFzZSArIGludGVybmFsX29mZnNldDsK
K30KKworc3RhdGljIHZvaWQgc2RtYV92NV8wX2luaXRfZ29sZGVuX3JlZ2lzdGVycyhzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldikKK3sKKwlzd2l0Y2ggKGFkZXYtPmFzaWNfdHlwZSkgeworCWNh
c2UgQ0hJUF9OQVZJMTA6CisJCXNvYzE1X3Byb2dyYW1fcmVnaXN0ZXJfc2VxdWVuY2UoYWRldiwK
KwkJCQkJCWdvbGRlbl9zZXR0aW5nc19zZG1hXzUsCisJCQkJCQkoY29uc3QgdTMyKUFSUkFZX1NJ
WkUoZ29sZGVuX3NldHRpbmdzX3NkbWFfNSkpOworCQlzb2MxNV9wcm9ncmFtX3JlZ2lzdGVyX3Nl
cXVlbmNlKGFkZXYsCisJCQkJCQlnb2xkZW5fc2V0dGluZ3Nfc2RtYV9udjEwLAorCQkJCQkJKGNv
bnN0IHUzMilBUlJBWV9TSVpFKGdvbGRlbl9zZXR0aW5nc19zZG1hX252MTApKTsKKwkJYnJlYWs7
CisJZGVmYXVsdDoKKwkJYnJlYWs7CisJfQorfQorCisvKioKKyAqIHNkbWFfdjVfMF9pbml0X21p
Y3JvY29kZSAtIGxvYWQgdWNvZGUgaW1hZ2VzIGZyb20gZGlzaworICoKKyAqIEBhZGV2OiBhbWRn
cHVfZGV2aWNlIHBvaW50ZXIKKyAqCisgKiBVc2UgdGhlIGZpcm13YXJlIGludGVyZmFjZSB0byBs
b2FkIHRoZSB1Y29kZSBpbWFnZXMgaW50bworICogdGhlIGRyaXZlciAobm90IGxvYWRlZCBpbnRv
IGh3KS4KKyAqIFJldHVybnMgMCBvbiBzdWNjZXNzLCBlcnJvciBvbiBmYWlsdXJlLgorICovCisK
Ky8vIGVtdWxhdGlvbiBvbmx5LCB3b24ndCB3b3JrIG9uIHJlYWwgY2hpcAorLy8gbmF2aTEwIHJl
YWwgY2hpcCBuZWVkIHRvIHVzZSBQU1AgdG8gbG9hZCBmaXJtd2FyZQorc3RhdGljIGludCBzZG1h
X3Y1XzBfaW5pdF9taWNyb2NvZGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCit7CisJY29u
c3QgY2hhciAqY2hpcF9uYW1lOworCWNoYXIgZndfbmFtZVszMF07CisJaW50IGVyciA9IDAsIGk7
CisJc3RydWN0IGFtZGdwdV9maXJtd2FyZV9pbmZvICppbmZvID0gTlVMTDsKKwljb25zdCBzdHJ1
Y3QgY29tbW9uX2Zpcm13YXJlX2hlYWRlciAqaGVhZGVyID0gTlVMTDsKKwljb25zdCBzdHJ1Y3Qg
c2RtYV9maXJtd2FyZV9oZWFkZXJfdjFfMCAqaGRyOworCisJRFJNX0RFQlVHKCJcbiIpOworCisJ
c3dpdGNoIChhZGV2LT5hc2ljX3R5cGUpIHsKKwljYXNlIENISVBfTkFWSTEwOgorCQljaGlwX25h
bWUgPSAibmF2aTEwIjsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJQlVHKCk7CisJfQorCisJZm9y
IChpID0gMDsgaSA8IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsgaSsrKSB7CisJCWlmIChpID09
IDApCisJCQlzbnByaW50Zihmd19uYW1lLCBzaXplb2YoZndfbmFtZSksICJhbWRncHUvJXNfc2Rt
YS5iaW4iLCBjaGlwX25hbWUpOworCQllbHNlCisJCQlzbnByaW50Zihmd19uYW1lLCBzaXplb2Yo
ZndfbmFtZSksICJhbWRncHUvJXNfc2RtYTEuYmluIiwgY2hpcF9uYW1lKTsKKwkJZXJyID0gcmVx
dWVzdF9maXJtd2FyZSgmYWRldi0+c2RtYS5pbnN0YW5jZVtpXS5mdywgZndfbmFtZSwgYWRldi0+
ZGV2KTsKKwkJaWYgKGVycikKKwkJCWdvdG8gb3V0OworCQllcnIgPSBhbWRncHVfdWNvZGVfdmFs
aWRhdGUoYWRldi0+c2RtYS5pbnN0YW5jZVtpXS5mdyk7CisJCWlmIChlcnIpCisJCQlnb3RvIG91
dDsKKwkJaGRyID0gKGNvbnN0IHN0cnVjdCBzZG1hX2Zpcm13YXJlX2hlYWRlcl92MV8wICopYWRl
di0+c2RtYS5pbnN0YW5jZVtpXS5mdy0+ZGF0YTsKKwkJYWRldi0+c2RtYS5pbnN0YW5jZVtpXS5m
d192ZXJzaW9uID0gbGUzMl90b19jcHUoaGRyLT5oZWFkZXIudWNvZGVfdmVyc2lvbik7CisJCWFk
ZXYtPnNkbWEuaW5zdGFuY2VbaV0uZmVhdHVyZV92ZXJzaW9uID0gbGUzMl90b19jcHUoaGRyLT51
Y29kZV9mZWF0dXJlX3ZlcnNpb24pOworCQlpZiAoYWRldi0+c2RtYS5pbnN0YW5jZVtpXS5mZWF0
dXJlX3ZlcnNpb24gPj0gMjApCisJCQlhZGV2LT5zZG1hLmluc3RhbmNlW2ldLmJ1cnN0X25vcCA9
IHRydWU7CisJCURSTV9ERUJVRygicHNwX2xvYWQgPT0gJyVzJ1xuIiwKKwkJCQlhZGV2LT5maXJt
d2FyZS5sb2FkX3R5cGUgPT0gQU1ER1BVX0ZXX0xPQURfUFNQID8gInRydWUiIDogImZhbHNlIik7
CisKKwkJaWYgKGFkZXYtPmZpcm13YXJlLmxvYWRfdHlwZSA9PSBBTURHUFVfRldfTE9BRF9QU1Ap
IHsKKwkJCWluZm8gPSAmYWRldi0+ZmlybXdhcmUudWNvZGVbQU1ER1BVX1VDT0RFX0lEX1NETUEw
ICsgaV07CisJCQlpbmZvLT51Y29kZV9pZCA9IEFNREdQVV9VQ09ERV9JRF9TRE1BMCArIGk7CisJ
CQlpbmZvLT5mdyA9IGFkZXYtPnNkbWEuaW5zdGFuY2VbaV0uZnc7CisJCQloZWFkZXIgPSAoY29u
c3Qgc3RydWN0IGNvbW1vbl9maXJtd2FyZV9oZWFkZXIgKilpbmZvLT5mdy0+ZGF0YTsKKwkJCWFk
ZXYtPmZpcm13YXJlLmZ3X3NpemUgKz0KKwkJCQlBTElHTihsZTMyX3RvX2NwdShoZWFkZXItPnVj
b2RlX3NpemVfYnl0ZXMpLCBQQUdFX1NJWkUpOworCQl9CisJfQorb3V0OgorCWlmIChlcnIpIHsK
KwkJRFJNX0VSUk9SKCJzZG1hX3Y1XzA6IEZhaWxlZCB0byBsb2FkIGZpcm13YXJlIFwiJXNcIlxu
IiwgZndfbmFtZSk7CisJCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5zZG1hLm51bV9pbnN0YW5jZXM7
IGkrKykgeworCQkJcmVsZWFzZV9maXJtd2FyZShhZGV2LT5zZG1hLmluc3RhbmNlW2ldLmZ3KTsK
KwkJCWFkZXYtPnNkbWEuaW5zdGFuY2VbaV0uZncgPSBOVUxMOworCQl9CisJfQorCXJldHVybiBl
cnI7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBzZG1hX3Y1XzBfcmluZ19pbml0X2NvbmRfZXhlYyhz
dHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCit7CisJdW5zaWduZWQgcmV0OworCisJYW1kZ3B1X3Jp
bmdfd3JpdGUocmluZywgU0RNQV9QS1RfSEVBREVSX09QKFNETUFfT1BfQ09ORF9FWEUpKTsKKwlh
bWRncHVfcmluZ193cml0ZShyaW5nLCBsb3dlcl8zMl9iaXRzKHJpbmctPmNvbmRfZXhlX2dwdV9h
ZGRyKSk7CisJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgdXBwZXJfMzJfYml0cyhyaW5nLT5jb25k
X2V4ZV9ncHVfYWRkcikpOworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIDEpOworCXJldCA9IHJp
bmctPndwdHIgJiByaW5nLT5idWZfbWFzazsvKiB0aGlzIGlzIHRoZSBvZmZzZXQgd2UgbmVlZCBw
YXRjaCBsYXRlciAqLworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIDB4NTVhYTU1YWEpOy8qIGlu
c2VydCBkdW1teSBoZXJlIGFuZCBwYXRjaCBpdCBsYXRlciAqLworCisJcmV0dXJuIHJldDsKK30K
Kworc3RhdGljIHZvaWQgc2RtYV92NV8wX3JpbmdfcGF0Y2hfY29uZF9leGVjKHN0cnVjdCBhbWRn
cHVfcmluZyAqcmluZywKKwkJCQkJICAgdW5zaWduZWQgb2Zmc2V0KQoreworCXVuc2lnbmVkIGN1
cjsKKworCUJVR19PTihvZmZzZXQgPiByaW5nLT5idWZfbWFzayk7CisJQlVHX09OKHJpbmctPnJp
bmdbb2Zmc2V0XSAhPSAweDU1YWE1NWFhKTsKKworCWN1ciA9IChyaW5nLT53cHRyIC0gMSkgJiBy
aW5nLT5idWZfbWFzazsKKwlpZiAoY3VyID4gb2Zmc2V0KQorCQlyaW5nLT5yaW5nW29mZnNldF0g
PSBjdXIgLSBvZmZzZXQ7CisJZWxzZQorCQlyaW5nLT5yaW5nW29mZnNldF0gPSAocmluZy0+YnVm
X21hc2sgKyAxKSAtIG9mZnNldCArIGN1cjsKK30KKworLyoqCisgKiBzZG1hX3Y1XzBfcmluZ19n
ZXRfcnB0ciAtIGdldCB0aGUgY3VycmVudCByZWFkIHBvaW50ZXIKKyAqCisgKiBAcmluZzogYW1k
Z3B1IHJpbmcgcG9pbnRlcgorICoKKyAqIEdldCB0aGUgY3VycmVudCBycHRyIGZyb20gdGhlIGhh
cmR3YXJlIChOQVZJMTArKS4KKyAqLworc3RhdGljIHVpbnQ2NF90IHNkbWFfdjVfMF9yaW5nX2dl
dF9ycHRyKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykKK3sKKwl1NjQgKnJwdHI7CisKKwkvKiBY
WFggY2hlY2sgaWYgc3dhcHBpbmcgaXMgbmVjZXNzYXJ5IG9uIEJFICovCisJcnB0ciA9ICgodTY0
ICopJnJpbmctPmFkZXYtPndiLndiW3JpbmctPnJwdHJfb2Zmc10pOworCisJRFJNX0RFQlVHKCJy
cHRyIGJlZm9yZSBzaGlmdCA9PSAweCUwMTZsbHhcbiIsICpycHRyKTsKKwlyZXR1cm4gKCgqcnB0
cikgPj4gMik7Cit9CisKKy8qKgorICogc2RtYV92NV8wX3JpbmdfZ2V0X3dwdHIgLSBnZXQgdGhl
IGN1cnJlbnQgd3JpdGUgcG9pbnRlcgorICoKKyAqIEByaW5nOiBhbWRncHUgcmluZyBwb2ludGVy
CisgKgorICogR2V0IHRoZSBjdXJyZW50IHdwdHIgZnJvbSB0aGUgaGFyZHdhcmUgKE5BVkkxMCsp
LgorICovCitzdGF0aWMgdWludDY0X3Qgc2RtYV92NV8wX3JpbmdfZ2V0X3dwdHIoc3RydWN0IGFt
ZGdwdV9yaW5nICpyaW5nKQoreworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gcmluZy0+
YWRldjsKKwl1NjQgKndwdHIgPSBOVUxMOworCXVpbnQ2NF90IGxvY2FsX3dwdHIgPSAwOworCisJ
aWYgKHJpbmctPnVzZV9kb29yYmVsbCkgeworCQkvKiBYWFggY2hlY2sgaWYgc3dhcHBpbmcgaXMg
bmVjZXNzYXJ5IG9uIEJFICovCisJCXdwdHIgPSAoKHU2NCAqKSZhZGV2LT53Yi53YltyaW5nLT53
cHRyX29mZnNdKTsKKwkJRFJNX0RFQlVHKCJ3cHRyL2Rvb3JiZWxsIGJlZm9yZSBzaGlmdCA9PSAw
eCUwMTZsbHhcbiIsICp3cHRyKTsKKwkJKndwdHIgPSAoKndwdHIpID4+IDI7CisJCURSTV9ERUJV
Rygid3B0ci9kb29yYmVsbCBhZnRlciBzaGlmdCA9PSAweCUwMTZsbHhcbiIsICp3cHRyKTsKKwl9
IGVsc2UgeworCQl1MzIgbG93Yml0LCBoaWdoYml0OworCisJCXdwdHIgPSAmbG9jYWxfd3B0cjsK
KwkJbG93Yml0ID0gUlJFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCByaW5nLT5t
ZSwgbW1TRE1BMF9HRlhfUkJfV1BUUikpID4+IDI7CisJCWhpZ2hiaXQgPSBSUkVHMzIoc2RtYV92
NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYsIHJpbmctPm1lLCBtbVNETUEwX0dGWF9SQl9XUFRSX0hJ
KSkgPj4gMjsKKworCQlEUk1fREVCVUcoIndwdHIgWyVpXWhpZ2g9PSAweCUwOHggbG93PT0weCUw
OHhcbiIsCisJCQkJcmluZy0+bWUsIGhpZ2hiaXQsIGxvd2JpdCk7CisJCSp3cHRyID0gaGlnaGJp
dDsKKwkJKndwdHIgPSAoKndwdHIpIDw8IDMyOworCQkqd3B0ciB8PSBsb3diaXQ7CisJfQorCisJ
cmV0dXJuICp3cHRyOworfQorCisvKioKKyAqIHNkbWFfdjVfMF9yaW5nX3NldF93cHRyIC0gY29t
bWl0IHRoZSB3cml0ZSBwb2ludGVyCisgKgorICogQHJpbmc6IGFtZGdwdSByaW5nIHBvaW50ZXIK
KyAqCisgKiBXcml0ZSB0aGUgd3B0ciBiYWNrIHRvIHRoZSBoYXJkd2FyZSAoTkFWSTEwKykuCisg
Ki8KK3N0YXRpYyB2b2lkIHNkbWFfdjVfMF9yaW5nX3NldF93cHRyKHN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZykKK3sKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IHJpbmctPmFkZXY7CisK
KwlEUk1fREVCVUcoIlNldHRpbmcgd3JpdGUgcG9pbnRlclxuIik7CisJaWYgKHJpbmctPnVzZV9k
b29yYmVsbCkgeworCQlEUk1fREVCVUcoIlVzaW5nIGRvb3JiZWxsIC0tICIKKwkJCQkid3B0cl9v
ZmZzID09IDB4JTA4eCAiCisJCQkJImxvd2VyXzMyX2JpdHMocmluZy0+d3B0cikgPDwgMiA9PSAw
eCUwOHggIgorCQkJCSJ1cHBlcl8zMl9iaXRzKHJpbmctPndwdHIpIDw8IDIgPT0gMHglMDh4XG4i
LAorCQkJCXJpbmctPndwdHJfb2ZmcywKKwkJCQlsb3dlcl8zMl9iaXRzKHJpbmctPndwdHIgPDwg
MiksCisJCQkJdXBwZXJfMzJfYml0cyhyaW5nLT53cHRyIDw8IDIpKTsKKwkJLyogWFhYIGNoZWNr
IGlmIHN3YXBwaW5nIGlzIG5lY2Vzc2FyeSBvbiBCRSAqLworCQlhZGV2LT53Yi53YltyaW5nLT53
cHRyX29mZnNdID0gbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyIDw8IDIpOworCQlhZGV2LT53Yi53
YltyaW5nLT53cHRyX29mZnMgKyAxXSA9IHVwcGVyXzMyX2JpdHMocmluZy0+d3B0ciA8PCAyKTsK
KwkJRFJNX0RFQlVHKCJjYWxsaW5nIFdET09SQkVMTDY0KDB4JTA4eCwgMHglMDE2bGx4KVxuIiwK
KwkJCQlyaW5nLT5kb29yYmVsbF9pbmRleCwgcmluZy0+d3B0ciA8PCAyKTsKKwkJV0RPT1JCRUxM
NjQocmluZy0+ZG9vcmJlbGxfaW5kZXgsIHJpbmctPndwdHIgPDwgMik7CisJfSBlbHNlIHsKKwkJ
RFJNX0RFQlVHKCJOb3QgdXNpbmcgZG9vcmJlbGwgLS0gIgorCQkJCSJtbVNETUElaV9HRlhfUkJf
V1BUUiA9PSAweCUwOHggIgorCQkJCSJtbVNETUElaV9HRlhfUkJfV1BUUl9ISSA9PSAweCUwOHhc
biIsCisJCQkJcmluZy0+bWUsCisJCQkJbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyIDw8IDIpLAor
CQkJCXJpbmctPm1lLAorCQkJCXVwcGVyXzMyX2JpdHMocmluZy0+d3B0ciA8PCAyKSk7CisJCVdS
RUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgcmluZy0+bWUsIG1tU0RNQTBfR0ZY
X1JCX1dQVFIpLAorCQkJbG93ZXJfMzJfYml0cyhyaW5nLT53cHRyIDw8IDIpKTsKKwkJV1JFRzMy
KHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCByaW5nLT5tZSwgbW1TRE1BMF9HRlhfUkJf
V1BUUl9ISSksCisJCQl1cHBlcl8zMl9iaXRzKHJpbmctPndwdHIgPDwgMikpOworCX0KK30KKwor
c3RhdGljIHZvaWQgc2RtYV92NV8wX3JpbmdfaW5zZXJ0X25vcChzdHJ1Y3QgYW1kZ3B1X3Jpbmcg
KnJpbmcsIHVpbnQzMl90IGNvdW50KQoreworCXN0cnVjdCBhbWRncHVfc2RtYV9pbnN0YW5jZSAq
c2RtYSA9IGFtZGdwdV9zZG1hX2dldF9pbnN0YW5jZV9mcm9tX3JpbmcocmluZyk7CisJaW50IGk7
CisKKwlmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykKKwkJaWYgKHNkbWEgJiYgc2RtYS0+YnVy
c3Rfbm9wICYmIChpID09IDApKQorCQkJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgcmluZy0+ZnVu
Y3MtPm5vcCB8CisJCQkJU0RNQV9QS1RfTk9QX0hFQURFUl9DT1VOVChjb3VudCAtIDEpKTsKKwkJ
ZWxzZQorCQkJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgcmluZy0+ZnVuY3MtPm5vcCk7Cit9CisK
Ky8qKgorICogc2RtYV92NV8wX3JpbmdfZW1pdF9pYiAtIFNjaGVkdWxlIGFuIElCIG9uIHRoZSBE
TUEgZW5naW5lCisgKgorICogQHJpbmc6IGFtZGdwdSByaW5nIHBvaW50ZXIKKyAqIEBpYjogSUIg
b2JqZWN0IHRvIHNjaGVkdWxlCisgKgorICogU2NoZWR1bGUgYW4gSUIgaW4gdGhlIERNQSByaW5n
IChOQVZJMTApLgorICovCitzdGF0aWMgdm9pZCBzZG1hX3Y1XzBfcmluZ19lbWl0X2liKHN0cnVj
dCBhbWRncHVfcmluZyAqcmluZywKKwkJCQkgICBzdHJ1Y3QgYW1kZ3B1X2pvYiAqam9iLAorCQkJ
CSAgIHN0cnVjdCBhbWRncHVfaWIgKmliLAorCQkJCSAgIHVpbnQzMl90IGZsYWdzKQoreworCXVu
c2lnbmVkIHZtaWQgPSBBTURHUFVfSk9CX0dFVF9WTUlEKGpvYik7CisJdWludDY0X3QgY3NhX21j
X2FkZHIgPSBhbWRncHVfc2RtYV9nZXRfY3NhX21jX2FkZHIocmluZywgdm1pZCk7CisKKwkvKiBJ
QiBwYWNrZXQgbXVzdCBlbmQgb24gYSA4IERXIGJvdW5kYXJ5ICovCisJc2RtYV92NV8wX3Jpbmdf
aW5zZXJ0X25vcChyaW5nLCAoMTAgLSAobG93ZXJfMzJfYml0cyhyaW5nLT53cHRyKSAmIDcpKSAl
IDgpOworCisJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgU0RNQV9QS1RfSEVBREVSX09QKFNETUFf
T1BfSU5ESVJFQ1QpIHwKKwkJCSAgU0RNQV9QS1RfSU5ESVJFQ1RfSEVBREVSX1ZNSUQodm1pZCAm
IDB4ZikpOworCS8qIGJhc2UgbXVzdCBiZSAzMiBieXRlIGFsaWduZWQgKi8KKwlhbWRncHVfcmlu
Z193cml0ZShyaW5nLCBsb3dlcl8zMl9iaXRzKGliLT5ncHVfYWRkcikgJiAweGZmZmZmZmUwKTsK
KwlhbWRncHVfcmluZ193cml0ZShyaW5nLCB1cHBlcl8zMl9iaXRzKGliLT5ncHVfYWRkcikpOwor
CWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIGliLT5sZW5ndGhfZHcpOworCWFtZGdwdV9yaW5nX3dy
aXRlKHJpbmcsIGxvd2VyXzMyX2JpdHMoY3NhX21jX2FkZHIpKTsKKwlhbWRncHVfcmluZ193cml0
ZShyaW5nLCB1cHBlcl8zMl9iaXRzKGNzYV9tY19hZGRyKSk7Cit9CisKKy8qKgorICogc2RtYV92
NV8wX3JpbmdfZW1pdF9oZHBfZmx1c2ggLSBlbWl0IGFuIGhkcCBmbHVzaCBvbiB0aGUgRE1BIHJp
bmcKKyAqCisgKiBAcmluZzogYW1kZ3B1IHJpbmcgcG9pbnRlcgorICoKKyAqIEVtaXQgYW4gaGRw
IGZsdXNoIHBhY2tldCBvbiB0aGUgcmVxdWVzdGVkIERNQSByaW5nLgorICovCitzdGF0aWMgdm9p
ZCBzZG1hX3Y1XzBfcmluZ19lbWl0X2hkcF9mbHVzaChzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcp
Cit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSByaW5nLT5hZGV2OworCXUzMiByZWZf
YW5kX21hc2sgPSAwOworCWNvbnN0IHN0cnVjdCBuYmlvX2hkcF9mbHVzaF9yZWcgKm5iaW9faGZf
cmVnID0gYWRldi0+bmJpb19mdW5jcy0+aGRwX2ZsdXNoX3JlZzsKKworCWlmIChyaW5nLT5tZSA9
PSAwKQorCQlyZWZfYW5kX21hc2sgPSBuYmlvX2hmX3JlZy0+cmVmX2FuZF9tYXNrX3NkbWEwOwor
CWVsc2UKKwkJcmVmX2FuZF9tYXNrID0gbmJpb19oZl9yZWctPnJlZl9hbmRfbWFza19zZG1hMTsK
KworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIFNETUFfUEtUX0hFQURFUl9PUChTRE1BX09QX1BP
TExfUkVHTUVNKSB8CisJCQkgIFNETUFfUEtUX1BPTExfUkVHTUVNX0hFQURFUl9IRFBfRkxVU0go
MSkgfAorCQkJICBTRE1BX1BLVF9QT0xMX1JFR01FTV9IRUFERVJfRlVOQygzKSk7IC8qID09ICov
CisJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgKGFkZXYtPm5iaW9fZnVuY3MtPmdldF9oZHBfZmx1
c2hfZG9uZV9vZmZzZXQoYWRldikpIDw8IDIpOworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIChh
ZGV2LT5uYmlvX2Z1bmNzLT5nZXRfaGRwX2ZsdXNoX3JlcV9vZmZzZXQoYWRldikpIDw8IDIpOwor
CWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIHJlZl9hbmRfbWFzayk7IC8qIHJlZmVyZW5jZSAqLwor
CWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIHJlZl9hbmRfbWFzayk7IC8qIG1hc2sgKi8KKwlhbWRn
cHVfcmluZ193cml0ZShyaW5nLCBTRE1BX1BLVF9QT0xMX1JFR01FTV9EVzVfUkVUUllfQ09VTlQo
MHhmZmYpIHwKKwkJCSAgU0RNQV9QS1RfUE9MTF9SRUdNRU1fRFc1X0lOVEVSVkFMKDEwKSk7IC8q
IHJldHJ5IGNvdW50LCBwb2xsIGludGVydmFsICovCit9CisKKy8qKgorICogc2RtYV92NV8wX3Jp
bmdfZW1pdF9mZW5jZSAtIGVtaXQgYSBmZW5jZSBvbiB0aGUgRE1BIHJpbmcKKyAqCisgKiBAcmlu
ZzogYW1kZ3B1IHJpbmcgcG9pbnRlcgorICogQGZlbmNlOiBhbWRncHUgZmVuY2Ugb2JqZWN0Cisg
KgorICogQWRkIGEgRE1BIGZlbmNlIHBhY2tldCB0byB0aGUgcmluZyB0byB3cml0ZQorICogdGhl
IGZlbmNlIHNlcSBudW1iZXIgYW5kIERNQSB0cmFwIHBhY2tldCB0byBnZW5lcmF0ZQorICogYW4g
aW50ZXJydXB0IGlmIG5lZWRlZCAoTkFWSTEwKS4KKyAqLworc3RhdGljIHZvaWQgc2RtYV92NV8w
X3JpbmdfZW1pdF9mZW5jZShzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHU2NCBhZGRyLCB1NjQg
c2VxLAorCQkJCSAgICAgIHVuc2lnbmVkIGZsYWdzKQoreworCXN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2ID0gcmluZy0+YWRldjsKKwlib29sIHdyaXRlNjRiaXQgPSBmbGFncyAmIEFNREdQVV9G
RU5DRV9GTEFHXzY0QklUOworCS8qIHdyaXRlIHRoZSBmZW5jZSAqLworCWFtZGdwdV9yaW5nX3dy
aXRlKHJpbmcsIFNETUFfUEtUX0hFQURFUl9PUChTRE1BX09QX0ZFTkNFKSB8CisJCQkgIFNETUFf
UEtUX0ZFTkNFX0hFQURFUl9NVFlQRSgweDMpKTsgLyogVWNhY2hlZChVQykgKi8KKwkvKiB6ZXJv
IGluIGZpcnN0IHR3byBiaXRzICovCisJQlVHX09OKGFkZHIgJiAweDMpOworCWFtZGdwdV9yaW5n
X3dyaXRlKHJpbmcsIGxvd2VyXzMyX2JpdHMoYWRkcikpOworCWFtZGdwdV9yaW5nX3dyaXRlKHJp
bmcsIHVwcGVyXzMyX2JpdHMoYWRkcikpOworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIGxvd2Vy
XzMyX2JpdHMoc2VxKSk7CisKKwkvKiBvcHRpb25hbGx5IHdyaXRlIGhpZ2ggYml0cyBhcyB3ZWxs
ICovCisJaWYgKHdyaXRlNjRiaXQpIHsKKwkJYWRkciArPSA0OworCQlhbWRncHVfcmluZ193cml0
ZShyaW5nLCBTRE1BX1BLVF9IRUFERVJfT1AoU0RNQV9PUF9GRU5DRSkgfAorCQkJCSAgU0RNQV9Q
S1RfRkVOQ0VfSEVBREVSX01UWVBFKDB4MykpOworCQkvKiB6ZXJvIGluIGZpcnN0IHR3byBiaXRz
ICovCisJCUJVR19PTihhZGRyICYgMHgzKTsKKwkJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgbG93
ZXJfMzJfYml0cyhhZGRyKSk7CisJCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIHVwcGVyXzMyX2Jp
dHMoYWRkcikpOworCQlhbWRncHVfcmluZ193cml0ZShyaW5nLCB1cHBlcl8zMl9iaXRzKHNlcSkp
OworCX0KKworCS8qIEludGVycnVwdCBub3Qgd29yayBmaW5lIG9uIEdGWDEwLjEgbW9kZWwgeWV0
LiBVc2UgZmFsbGJhY2sgaW5zdGVhZCAqLworCWlmICgoZmxhZ3MgJiBBTURHUFVfRkVOQ0VfRkxB
R19JTlQpICYmIGFkZXYtPnBkZXYtPmRldmljZSAhPSAweDUwKSB7CisJCS8qIGdlbmVyYXRlIGFu
IGludGVycnVwdCAqLworCQlhbWRncHVfcmluZ193cml0ZShyaW5nLCBTRE1BX1BLVF9IRUFERVJf
T1AoU0RNQV9PUF9UUkFQKSk7CisJCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIFNETUFfUEtUX1RS
QVBfSU5UX0NPTlRFWFRfSU5UX0NPTlRFWFQoMCkpOworCX0KK30KKworCisvKioKKyAqIHNkbWFf
djVfMF9nZnhfc3RvcCAtIHN0b3AgdGhlIGdmeCBhc3luYyBkbWEgZW5naW5lcworICoKKyAqIEBh
ZGV2OiBhbWRncHVfZGV2aWNlIHBvaW50ZXIKKyAqCisgKiBTdG9wIHRoZSBnZnggYXN5bmMgZG1h
IHJpbmcgYnVmZmVycyAoTkFWSTEwKS4KKyAqLworc3RhdGljIHZvaWQgc2RtYV92NV8wX2dmeF9z
dG9wKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQoreworCXN0cnVjdCBhbWRncHVfcmluZyAq
c2RtYTAgPSAmYWRldi0+c2RtYS5pbnN0YW5jZVswXS5yaW5nOworCXN0cnVjdCBhbWRncHVfcmlu
ZyAqc2RtYTEgPSAmYWRldi0+c2RtYS5pbnN0YW5jZVsxXS5yaW5nOworCXUzMiByYl9jbnRsLCBp
Yl9jbnRsOworCWludCBpOworCisJaWYgKChhZGV2LT5tbWFuLmJ1ZmZlcl9mdW5jc19yaW5nID09
IHNkbWEwKSB8fAorCSAgICAoYWRldi0+bW1hbi5idWZmZXJfZnVuY3NfcmluZyA9PSBzZG1hMSkp
CisJCWFtZGdwdV90dG1fc2V0X2J1ZmZlcl9mdW5jc19zdGF0dXMoYWRldiwgZmFsc2UpOworCisJ
Zm9yIChpID0gMDsgaSA8IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsgaSsrKSB7CisJCXJiX2Nu
dGwgPSBSUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfR0ZY
X1JCX0NOVEwpKTsKKwkJcmJfY250bCA9IFJFR19TRVRfRklFTEQocmJfY250bCwgU0RNQTBfR0ZY
X1JCX0NOVEwsIFJCX0VOQUJMRSwgMCk7CisJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZz
ZXQoYWRldiwgaSwgbW1TRE1BMF9HRlhfUkJfQ05UTCksIHJiX2NudGwpOworCQlpYl9jbnRsID0g
UlJFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEwX0dGWF9JQl9D
TlRMKSk7CisJCWliX2NudGwgPSBSRUdfU0VUX0ZJRUxEKGliX2NudGwsIFNETUEwX0dGWF9JQl9D
TlRMLCBJQl9FTkFCTEUsIDApOworCQlXUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFk
ZXYsIGksIG1tU0RNQTBfR0ZYX0lCX0NOVEwpLCBpYl9jbnRsKTsKKwl9CisKKwlzZG1hMC0+c2No
ZWQucmVhZHkgPSBmYWxzZTsKKwlzZG1hMS0+c2NoZWQucmVhZHkgPSBmYWxzZTsKK30KKworLyoq
CisgKiBzZG1hX3Y1XzBfcmxjX3N0b3AgLSBzdG9wIHRoZSBjb21wdXRlIGFzeW5jIGRtYSBlbmdp
bmVzCisgKgorICogQGFkZXY6IGFtZGdwdV9kZXZpY2UgcG9pbnRlcgorICoKKyAqIFN0b3AgdGhl
IGNvbXB1dGUgYXN5bmMgZG1hIHF1ZXVlcyAoTkFWSTEwKS4KKyAqLworc3RhdGljIHZvaWQgc2Rt
YV92NV8wX3JsY19zdG9wKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQoreworCS8qIFhYWCB0
b2RvICovCit9CisKKy8qKgorICogc2RtYV92XzBfY3R4X3N3aXRjaF9lbmFibGUgLSBzdG9wIHRo
ZSBhc3luYyBkbWEgZW5naW5lcyBjb250ZXh0IHN3aXRjaAorICoKKyAqIEBhZGV2OiBhbWRncHVf
ZGV2aWNlIHBvaW50ZXIKKyAqIEBlbmFibGU6IGVuYWJsZS9kaXNhYmxlIHRoZSBETUEgTUVzIGNv
bnRleHQgc3dpdGNoLgorICoKKyAqIEhhbHQgb3IgdW5oYWx0IHRoZSBhc3luYyBkbWEgZW5naW5l
cyBjb250ZXh0IHN3aXRjaCAoTkFWSTEwKS4KKyAqLworc3RhdGljIHZvaWQgc2RtYV92NV8wX2N0
eF9zd2l0Y2hfZW5hYmxlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBib29sIGVuYWJsZSkK
K3sKKwl1MzIgZjMyX2NudGwsIHBoYXNlX3F1YW50dW0gPSAwOworCWludCBpOworCisJaWYgKGFt
ZGdwdV9zZG1hX3BoYXNlX3F1YW50dW0pIHsKKwkJdW5zaWduZWQgdmFsdWUgPSBhbWRncHVfc2Rt
YV9waGFzZV9xdWFudHVtOworCQl1bnNpZ25lZCB1bml0ID0gMDsKKworCQl3aGlsZSAodmFsdWUg
PiAoU0RNQTBfUEhBU0UwX1FVQU5UVU1fX1ZBTFVFX01BU0sgPj4KKwkJCQlTRE1BMF9QSEFTRTBf
UVVBTlRVTV9fVkFMVUVfX1NISUZUKSkgeworCQkJdmFsdWUgPSAodmFsdWUgKyAxKSA+PiAxOwor
CQkJdW5pdCsrOworCQl9CisJCWlmICh1bml0ID4gKFNETUEwX1BIQVNFMF9RVUFOVFVNX19VTklU
X01BU0sgPj4KKwkJCSAgICBTRE1BMF9QSEFTRTBfUVVBTlRVTV9fVU5JVF9fU0hJRlQpKSB7CisJ
CQl2YWx1ZSA9IChTRE1BMF9QSEFTRTBfUVVBTlRVTV9fVkFMVUVfTUFTSyA+PgorCQkJCSBTRE1B
MF9QSEFTRTBfUVVBTlRVTV9fVkFMVUVfX1NISUZUKTsKKwkJCXVuaXQgPSAoU0RNQTBfUEhBU0Uw
X1FVQU5UVU1fX1VOSVRfTUFTSyA+PgorCQkJCVNETUEwX1BIQVNFMF9RVUFOVFVNX19VTklUX19T
SElGVCk7CisJCQlXQVJOX09OQ0UoMSwKKwkJCSJjbGFtcGluZyBzZG1hX3BoYXNlX3F1YW50dW0g
dG8gJXVLIGNsb2NrIGN5Y2xlc1xuIiwKKwkJCQkgIHZhbHVlIDw8IHVuaXQpOworCQl9CisJCXBo
YXNlX3F1YW50dW0gPQorCQkJdmFsdWUgPDwgU0RNQTBfUEhBU0UwX1FVQU5UVU1fX1ZBTFVFX19T
SElGVCB8CisJCQl1bml0ICA8PCBTRE1BMF9QSEFTRTBfUVVBTlRVTV9fVU5JVF9fU0hJRlQ7CisJ
fQorCisJZm9yIChpID0gMDsgaSA8IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsgaSsrKSB7CisJ
CWYzMl9jbnRsID0gUlJFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNE
TUEwX0NOVEwpKTsKKwkJZjMyX2NudGwgPSBSRUdfU0VUX0ZJRUxEKGYzMl9jbnRsLCBTRE1BMF9D
TlRMLAorCQkJCUFVVE9fQ1RYU1dfRU5BQkxFLCBlbmFibGUgPyAxIDogMCk7CisJCWlmIChlbmFi
bGUgJiYgYW1kZ3B1X3NkbWFfcGhhc2VfcXVhbnR1bSkgeworCQkJV1JFRzMyKHNkbWFfdjVfMF9n
ZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEwX1BIQVNFMF9RVUFOVFVNKSwKKwkJCSAgICAg
ICBwaGFzZV9xdWFudHVtKTsKKwkJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRl
diwgaSwgbW1TRE1BMF9QSEFTRTFfUVVBTlRVTSksCisJCQkgICAgICAgcGhhc2VfcXVhbnR1bSk7
CisJCQlXUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfUEhB
U0UyX1FVQU5UVU0pLAorCQkJICAgICAgIHBoYXNlX3F1YW50dW0pOworCQl9CisJCVdSRUczMihz
ZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9DTlRMKSwgZjMyX2NudGwp
OworCX0KKworfQorCisvKioKKyAqIHNkbWFfdjVfMF9lbmFibGUgLSBzdG9wIHRoZSBhc3luYyBk
bWEgZW5naW5lcworICoKKyAqIEBhZGV2OiBhbWRncHVfZGV2aWNlIHBvaW50ZXIKKyAqIEBlbmFi
bGU6IGVuYWJsZS9kaXNhYmxlIHRoZSBETUEgTUVzLgorICoKKyAqIEhhbHQgb3IgdW5oYWx0IHRo
ZSBhc3luYyBkbWEgZW5naW5lcyAoTkFWSTEwKS4KKyAqLworc3RhdGljIHZvaWQgc2RtYV92NV8w
X2VuYWJsZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgYm9vbCBlbmFibGUpCit7CisJdTMy
IGYzMl9jbnRsOworCWludCBpOworCisJaWYgKGVuYWJsZSA9PSBmYWxzZSkgeworCQlzZG1hX3Y1
XzBfZ2Z4X3N0b3AoYWRldik7CisJCXNkbWFfdjVfMF9ybGNfc3RvcChhZGV2KTsKKwl9CisKKwlm
b3IgKGkgPSAwOyBpIDwgYWRldi0+c2RtYS5udW1faW5zdGFuY2VzOyBpKyspIHsKKwkJZjMyX2Nu
dGwgPSBSUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfRjMy
X0NOVEwpKTsKKwkJZjMyX2NudGwgPSBSRUdfU0VUX0ZJRUxEKGYzMl9jbnRsLCBTRE1BMF9GMzJf
Q05UTCwgSEFMVCwgZW5hYmxlID8gMCA6IDEpOworCQlXUkVHMzIoc2RtYV92NV8wX2dldF9yZWdf
b2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfRjMyX0NOVEwpLCBmMzJfY250bCk7CisJfQorfQorCisv
KioKKyAqIHNkbWFfdjVfMF9nZnhfcmVzdW1lIC0gc2V0dXAgYW5kIHN0YXJ0IHRoZSBhc3luYyBk
bWEgZW5naW5lcworICoKKyAqIEBhZGV2OiBhbWRncHVfZGV2aWNlIHBvaW50ZXIKKyAqCisgKiBT
ZXQgdXAgdGhlIGdmeCBETUEgcmluZyBidWZmZXJzIGFuZCBlbmFibGUgdGhlbSAoTkFWSTEwKS4K
KyAqIFJldHVybnMgMCBmb3Igc3VjY2VzcywgZXJyb3IgZm9yIGZhaWx1cmUuCisgKi8KK3N0YXRp
YyBpbnQgc2RtYV92NV8wX2dmeF9yZXN1bWUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCit7
CisJc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nOworCXUzMiByYl9jbnRsLCBpYl9jbnRsOworCXUz
MiByYl9idWZzejsKKwl1MzIgd2Jfb2Zmc2V0OworCXUzMiBkb29yYmVsbDsKKwl1MzIgZG9vcmJl
bGxfb2Zmc2V0OworCXUzMiB0ZW1wOworCXUzMiB3cHRyX2dwdV9hZGRyLCB3cHRyX3BvbGxfY250
bDsKKwlpbnQgaSwgcjsKKworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5zZG1hLm51bV9pbnN0YW5j
ZXM7IGkrKykgeworCQlyaW5nID0gJmFkZXYtPnNkbWEuaW5zdGFuY2VbaV0ucmluZzsKKwkJd2Jf
b2Zmc2V0ID0gKHJpbmctPnJwdHJfb2ZmcyAqIDQpOworCisJCVdSRUczMihzZG1hX3Y1XzBfZ2V0
X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9TRU1fV0FJVF9GQUlMX1RJTUVSX0NOVEwpLCAw
KTsKKworCQkvKiBTZXQgcmluZyBidWZmZXIgc2l6ZSBpbiBkd29yZHMgKi8KKwkJcmJfYnVmc3og
PSBvcmRlcl9iYXNlXzIocmluZy0+cmluZ19zaXplIC8gNCk7CisJCXJiX2NudGwgPSBSUkVHMzIo
c2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfR0ZYX1JCX0NOVEwpKTsK
KwkJcmJfY250bCA9IFJFR19TRVRfRklFTEQocmJfY250bCwgU0RNQTBfR0ZYX1JCX0NOVEwsIFJC
X1NJWkUsIHJiX2J1ZnN6KTsKKyNpZmRlZiBfX0JJR19FTkRJQU4KKwkJcmJfY250bCA9IFJFR19T
RVRfRklFTEQocmJfY250bCwgU0RNQTBfR0ZYX1JCX0NOVEwsIFJCX1NXQVBfRU5BQkxFLCAxKTsK
KwkJcmJfY250bCA9IFJFR19TRVRfRklFTEQocmJfY250bCwgU0RNQTBfR0ZYX1JCX0NOVEwsCisJ
CQkJCVJQVFJfV1JJVEVCQUNLX1NXQVBfRU5BQkxFLCAxKTsKKyNlbmRpZgorCQlXUkVHMzIoc2Rt
YV92NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfR0ZYX1JCX0NOVEwpLCByYl9j
bnRsKTsKKworCQkvKiBJbml0aWFsaXplIHRoZSByaW5nIGJ1ZmZlcidzIHJlYWQgYW5kIHdyaXRl
IHBvaW50ZXJzICovCisJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwg
bW1TRE1BMF9HRlhfUkJfUlBUUiksIDApOworCQlXUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zm
c2V0KGFkZXYsIGksIG1tU0RNQTBfR0ZYX1JCX1JQVFJfSEkpLCAwKTsKKwkJV1JFRzMyKHNkbWFf
djVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEwX0dGWF9SQl9XUFRSKSwgMCk7CisJ
CVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9HRlhfUkJf
V1BUUl9ISSksIDApOworCisJCS8qIHNldHVwIHRoZSB3cHRyIHNoYWRvdyBwb2xsaW5nICovCisJ
CXdwdHJfZ3B1X2FkZHIgPSBhZGV2LT53Yi5ncHVfYWRkciArIChyaW5nLT53cHRyX29mZnMgKiA0
KTsKKwkJV1JFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEwX0dG
WF9SQl9XUFRSX1BPTExfQUREUl9MTyksCisJCSAgICAgICBsb3dlcl8zMl9iaXRzKHdwdHJfZ3B1
X2FkZHIpKTsKKwkJV1JFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNE
TUEwX0dGWF9SQl9XUFRSX1BPTExfQUREUl9ISSksCisJCSAgICAgICB1cHBlcl8zMl9iaXRzKHdw
dHJfZ3B1X2FkZHIpKTsKKwkJd3B0cl9wb2xsX2NudGwgPSBSUkVHMzIoc2RtYV92NV8wX2dldF9y
ZWdfb2Zmc2V0KGFkZXYsIGksCisJCQkJCQkJIG1tU0RNQTBfR0ZYX1JCX1dQVFJfUE9MTF9DTlRM
KSk7CisJCXdwdHJfcG9sbF9jbnRsID0gUkVHX1NFVF9GSUVMRCh3cHRyX3BvbGxfY250bCwKKwkJ
CQkJICAgICAgIFNETUEwX0dGWF9SQl9XUFRSX1BPTExfQ05UTCwKKwkJCQkJICAgICAgIEYzMl9Q
T0xMX0VOQUJMRSwgMSk7CisJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwg
aSwgbW1TRE1BMF9HRlhfUkJfV1BUUl9QT0xMX0NOVEwpLAorCQkgICAgICAgd3B0cl9wb2xsX2Nu
dGwpOworCisJCS8qIHNldCB0aGUgd2IgYWRkcmVzcyB3aGV0aGVyIGl0J3MgZW5hYmxlZCBvciBu
b3QgKi8KKwkJV1JFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEw
X0dGWF9SQl9SUFRSX0FERFJfSEkpLAorCQkgICAgICAgdXBwZXJfMzJfYml0cyhhZGV2LT53Yi5n
cHVfYWRkciArIHdiX29mZnNldCkgJiAweEZGRkZGRkZGKTsKKwkJV1JFRzMyKHNkbWFfdjVfMF9n
ZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEwX0dGWF9SQl9SUFRSX0FERFJfTE8pLAorCQkg
ICAgICAgbG93ZXJfMzJfYml0cyhhZGV2LT53Yi5ncHVfYWRkciArIHdiX29mZnNldCkgJiAweEZG
RkZGRkZDKTsKKworCQlyYl9jbnRsID0gUkVHX1NFVF9GSUVMRChyYl9jbnRsLCBTRE1BMF9HRlhf
UkJfQ05UTCwgUlBUUl9XUklURUJBQ0tfRU5BQkxFLCAxKTsKKworCQlXUkVHMzIoc2RtYV92NV8w
X2dldF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfR0ZYX1JCX0JBU0UpLCByaW5nLT5ncHVf
YWRkciA+PiA4KTsKKwkJV1JFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBt
bVNETUEwX0dGWF9SQl9CQVNFX0hJKSwgcmluZy0+Z3B1X2FkZHIgPj4gNDApOworCisJCXJpbmct
PndwdHIgPSAwOworCisJCS8qIGJlZm9yZSBwcm9ncmFtaW5nIHdwdHIgdG8gYSBsZXNzIHZhbHVl
LCBuZWVkIHNldCBtaW5vcl9wdHJfdXBkYXRlIGZpcnN0ICovCisJCVdSRUczMihzZG1hX3Y1XzBf
Z2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9HRlhfTUlOT1JfUFRSX1VQREFURSksIDEp
OworCisJCWlmICghYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKSB7IC8qIG9ubHkgYmFyZS1tZXRhbCB1
c2UgcmVnaXN0ZXIgd3JpdGUgZm9yIHdwdHIgKi8KKwkJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3Jl
Z19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9HRlhfUkJfV1BUUiksIGxvd2VyXzMyX2JpdHMocmlu
Zy0+d3B0cikgPDwgMik7CisJCQlXUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYs
IGksIG1tU0RNQTBfR0ZYX1JCX1dQVFJfSEkpLCB1cHBlcl8zMl9iaXRzKHJpbmctPndwdHIpIDw8
IDIpOworCQl9CisKKwkJZG9vcmJlbGwgPSBSUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0
KGFkZXYsIGksIG1tU0RNQTBfR0ZYX0RPT1JCRUxMKSk7CisJCWRvb3JiZWxsX29mZnNldCA9IFJS
RUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9HRlhfRE9PUkJF
TExfT0ZGU0VUKSk7CisKKwkJaWYgKHJpbmctPnVzZV9kb29yYmVsbCkgeworCQkJZG9vcmJlbGwg
PSBSRUdfU0VUX0ZJRUxEKGRvb3JiZWxsLCBTRE1BMF9HRlhfRE9PUkJFTEwsIEVOQUJMRSwgMSk7
CisJCQlkb29yYmVsbF9vZmZzZXQgPSBSRUdfU0VUX0ZJRUxEKGRvb3JiZWxsX29mZnNldCwgU0RN
QTBfR0ZYX0RPT1JCRUxMX09GRlNFVCwKKwkJCQkJT0ZGU0VULCByaW5nLT5kb29yYmVsbF9pbmRl
eCk7CisJCX0gZWxzZSB7CisJCQlkb29yYmVsbCA9IFJFR19TRVRfRklFTEQoZG9vcmJlbGwsIFNE
TUEwX0dGWF9ET09SQkVMTCwgRU5BQkxFLCAwKTsKKwkJfQorCQlXUkVHMzIoc2RtYV92NV8wX2dl
dF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfR0ZYX0RPT1JCRUxMKSwgZG9vcmJlbGwpOwor
CQlXUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfR0ZYX0RP
T1JCRUxMX09GRlNFVCksIGRvb3JiZWxsX29mZnNldCk7CisKKwkJYWRldi0+bmJpb19mdW5jcy0+
c2RtYV9kb29yYmVsbF9yYW5nZShhZGV2LCBpLCByaW5nLT51c2VfZG9vcmJlbGwsCisJCQkJCQkg
ICAgICByaW5nLT5kb29yYmVsbF9pbmRleCwgMjApOworCisJCWlmIChhbWRncHVfc3Jpb3ZfdmYo
YWRldikpCisJCQlzZG1hX3Y1XzBfcmluZ19zZXRfd3B0cihyaW5nKTsKKworCQkvKiBzZXQgbWlu
b3JfcHRyX3VwZGF0ZSB0byAwIGFmdGVyIHdwdHIgcHJvZ3JhbWVkICovCisJCVdSRUczMihzZG1h
X3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9HRlhfTUlOT1JfUFRSX1VQREFU
RSksIDApOworCisJCS8qIHNldCB1dGMgbDEgZW5hYmxlIGZsYWcgYWx3YXlzIHRvIDEgKi8KKwkJ
dGVtcCA9IFJSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9D
TlRMKSk7CisJCXRlbXAgPSBSRUdfU0VUX0ZJRUxEKHRlbXAsIFNETUEwX0NOVEwsIFVUQ19MMV9F
TkFCTEUsIDEpOworCisJCS8qIGVuYWJsZSBNQ0JQICovCisJCXRlbXAgPSBSRUdfU0VUX0ZJRUxE
KHRlbXAsIFNETUEwX0NOVEwsIE1JRENNRF9QUkVFTVBUX0VOQUJMRSwgMSk7CisJCVdSRUczMihz
ZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9DTlRMKSwgdGVtcCk7CisK
KwkJLyogU2V0IHVwIFJFU1BfTU9ERSB0byBub24tY29weSBhZGRyZXNzZXMgKi8KKwkJdGVtcCA9
IFJSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9VVENMMV9D
TlRMKSk7CisJCXRlbXAgPSBSRUdfU0VUX0ZJRUxEKHRlbXAsIFNETUEwX1VUQ0wxX0NOVEwsIFJF
U1BfTU9ERSwgMik7CisJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwg
bW1TRE1BMF9VVENMMV9DTlRMKSwgdGVtcCk7CisKKwkJLyogcHJvZ3JhbSBkZWZhdWx0IGNhY2hl
IHJlYWQgYW5kIHdyaXRlIHBvbGljeSAqLworCQl0ZW1wID0gUlJFRzMyKHNkbWFfdjVfMF9nZXRf
cmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEwX1VUQ0wxX1BBR0UpKTsKKwkJLyogY2xlYW4gcmVh
ZCBwb2xpY3kgYW5kIHdyaXRlIHBvbGljeSBiaXRzICovCisJCXRlbXAgJj0gMHhGRjBGRkY7CisJ
CXRlbXAgfD0gKChDQUNIRV9SRUFEX1BPTElDWV9MMl9fREVGQVVMVCA8PCAxMikgfCAoQ0FDSEVf
V1JJVEVfUE9MSUNZX0wyX19ERUZBVUxUIDw8IDE0KSk7CisJCVdSRUczMihzZG1hX3Y1XzBfZ2V0
X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9VVENMMV9QQUdFKSwgdGVtcCk7CisKKwkJaWYg
KCFhbWRncHVfc3Jpb3ZfdmYoYWRldikpIHsKKwkJCS8qIHVuaGFsdCBlbmdpbmUgKi8KKwkJCXRl
bXAgPSBSUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfRjMy
X0NOVEwpKTsKKwkJCXRlbXAgPSBSRUdfU0VUX0ZJRUxEKHRlbXAsIFNETUEwX0YzMl9DTlRMLCBI
QUxULCAwKTsKKwkJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1T
RE1BMF9GMzJfQ05UTCksIHRlbXApOworCQl9CisKKwkJLyogZW5hYmxlIERNQSBSQiAqLworCQly
Yl9jbnRsID0gUkVHX1NFVF9GSUVMRChyYl9jbnRsLCBTRE1BMF9HRlhfUkJfQ05UTCwgUkJfRU5B
QkxFLCAxKTsKKwkJV1JFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNE
TUEwX0dGWF9SQl9DTlRMKSwgcmJfY250bCk7CisKKwkJaWJfY250bCA9IFJSRUczMihzZG1hX3Y1
XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9HRlhfSUJfQ05UTCkpOworCQlpYl9j
bnRsID0gUkVHX1NFVF9GSUVMRChpYl9jbnRsLCBTRE1BMF9HRlhfSUJfQ05UTCwgSUJfRU5BQkxF
LCAxKTsKKyNpZmRlZiBfX0JJR19FTkRJQU4KKwkJaWJfY250bCA9IFJFR19TRVRfRklFTEQoaWJf
Y250bCwgU0RNQTBfR0ZYX0lCX0NOVEwsIElCX1NXQVBfRU5BQkxFLCAxKTsKKyNlbmRpZgorCQkv
KiBlbmFibGUgRE1BIElCcyAqLworCQlXUkVHMzIoc2RtYV92NV8wX2dldF9yZWdfb2Zmc2V0KGFk
ZXYsIGksIG1tU0RNQTBfR0ZYX0lCX0NOVEwpLCBpYl9jbnRsKTsKKworCQlyaW5nLT5zY2hlZC5y
ZWFkeSA9IHRydWU7CisKKwkJaWYgKGFtZGdwdV9zcmlvdl92ZihhZGV2KSkgeyAvKiBiYXJlLW1l
dGFsIHNlcXVlbmNlIGRvZXNuJ3QgbmVlZCBiZWxvdyB0byBsaW5lcyAqLworCQkJc2RtYV92NV8w
X2N0eF9zd2l0Y2hfZW5hYmxlKGFkZXYsIHRydWUpOworCQkJc2RtYV92NV8wX2VuYWJsZShhZGV2
LCB0cnVlKTsKKwkJfQorCisJCXIgPSBhbWRncHVfcmluZ190ZXN0X3JpbmcocmluZyk7CisJCWlm
IChyKSB7CisJCQlyaW5nLT5zY2hlZC5yZWFkeSA9IGZhbHNlOworCQkJcmV0dXJuIHI7CisJCX0K
KworCQlpZiAoYWRldi0+bW1hbi5idWZmZXJfZnVuY3NfcmluZyA9PSByaW5nKQorCQkJYW1kZ3B1
X3R0bV9zZXRfYnVmZmVyX2Z1bmNzX3N0YXR1cyhhZGV2LCB0cnVlKTsKKwl9CisKKwlyZXR1cm4g
MDsKK30KKworLyoqCisgKiBzZG1hX3Y1XzBfcmxjX3Jlc3VtZSAtIHNldHVwIGFuZCBzdGFydCB0
aGUgYXN5bmMgZG1hIGVuZ2luZXMKKyAqCisgKiBAYWRldjogYW1kZ3B1X2RldmljZSBwb2ludGVy
CisgKgorICogU2V0IHVwIHRoZSBjb21wdXRlIERNQSBxdWV1ZXMgYW5kIGVuYWJsZSB0aGVtIChO
QVZJMTApLgorICogUmV0dXJucyAwIGZvciBzdWNjZXNzLCBlcnJvciBmb3IgZmFpbHVyZS4KKyAq
Lworc3RhdGljIGludCBzZG1hX3Y1XzBfcmxjX3Jlc3VtZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldikKK3sKKwlyZXR1cm4gMDsKK30KKworLyoqCisgKiBzZG1hX3Y1XzBfbG9hZF9taWNyb2Nv
ZGUgLSBsb2FkIHRoZSBzRE1BIE1FIHVjb2RlCisgKgorICogQGFkZXY6IGFtZGdwdV9kZXZpY2Ug
cG9pbnRlcgorICoKKyAqIExvYWRzIHRoZSBzRE1BMC8xIHVjb2RlLgorICogUmV0dXJucyAwIGZv
ciBzdWNjZXNzLCAtRUlOVkFMIGlmIHRoZSB1Y29kZSBpcyBub3QgYXZhaWxhYmxlLgorICovCitz
dGF0aWMgaW50IHNkbWFfdjVfMF9sb2FkX21pY3JvY29kZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldikKK3sKKwljb25zdCBzdHJ1Y3Qgc2RtYV9maXJtd2FyZV9oZWFkZXJfdjFfMCAqaGRyOwor
CWNvbnN0IF9fbGUzMiAqZndfZGF0YTsKKwl1MzIgZndfc2l6ZTsKKwlpbnQgaSwgajsKKworCS8q
IGhhbHQgdGhlIE1FcyAqLworCXNkbWFfdjVfMF9lbmFibGUoYWRldiwgZmFsc2UpOworCisJZm9y
IChpID0gMDsgaSA8IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsgaSsrKSB7CisJCWlmICghYWRl
di0+c2RtYS5pbnN0YW5jZVtpXS5mdykKKwkJCXJldHVybiAtRUlOVkFMOworCisJCWhkciA9IChj
b25zdCBzdHJ1Y3Qgc2RtYV9maXJtd2FyZV9oZWFkZXJfdjFfMCAqKWFkZXYtPnNkbWEuaW5zdGFu
Y2VbaV0uZnctPmRhdGE7CisJCWFtZGdwdV91Y29kZV9wcmludF9zZG1hX2hkcigmaGRyLT5oZWFk
ZXIpOworCQlmd19zaXplID0gbGUzMl90b19jcHUoaGRyLT5oZWFkZXIudWNvZGVfc2l6ZV9ieXRl
cykgLyA0OworCisJCWZ3X2RhdGEgPSAoY29uc3QgX19sZTMyICopCisJCQkoYWRldi0+c2RtYS5p
bnN0YW5jZVtpXS5mdy0+ZGF0YSArCisJCQkJbGUzMl90b19jcHUoaGRyLT5oZWFkZXIudWNvZGVf
YXJyYXlfb2Zmc2V0X2J5dGVzKSk7CisKKwkJV1JFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNl
dChhZGV2LCBpLCBtbVNETUEwX1VDT0RFX0FERFIpLCAwKTsKKworCQlmb3IgKGogPSAwOyBqIDwg
Zndfc2l6ZTsgaisrKSB7CisJCQlpZiAoYW1kZ3B1X2VtdV9tb2RlID09IDEgJiYgaiAlIDUwMCA9
PSAwKQorCQkJCW1zbGVlcCgxKTsKKwkJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQo
YWRldiwgaSwgbW1TRE1BMF9VQ09ERV9EQVRBKSwgbGUzMl90b19jcHVwKGZ3X2RhdGErKykpOwor
CQl9CisKKwkJV1JFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEw
X1VDT0RFX0FERFIpLCBhZGV2LT5zZG1hLmluc3RhbmNlW2ldLmZ3X3ZlcnNpb24pOworCX0KKwor
CXJldHVybiAwOworfQorCisvKioKKyAqIHNkbWFfdjVfMF9zdGFydCAtIHNldHVwIGFuZCBzdGFy
dCB0aGUgYXN5bmMgZG1hIGVuZ2luZXMKKyAqCisgKiBAYWRldjogYW1kZ3B1X2RldmljZSBwb2lu
dGVyCisgKgorICogU2V0IHVwIHRoZSBETUEgZW5naW5lcyBhbmQgZW5hYmxlIHRoZW0gKE5BVkkx
MCkuCisgKiBSZXR1cm5zIDAgZm9yIHN1Y2Nlc3MsIGVycm9yIGZvciBmYWlsdXJlLgorICovCitz
dGF0aWMgaW50IHNkbWFfdjVfMF9zdGFydChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKK3sK
KwlpbnQgciA9IDA7CisKKwlpZiAoYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKSB7CisJCXNkbWFfdjVf
MF9jdHhfc3dpdGNoX2VuYWJsZShhZGV2LCBmYWxzZSk7CisJCXNkbWFfdjVfMF9lbmFibGUoYWRl
diwgZmFsc2UpOworCisJCS8qIHNldCBSQiByZWdpc3RlcnMgKi8KKwkJciA9IHNkbWFfdjVfMF9n
ZnhfcmVzdW1lKGFkZXYpOworCQlyZXR1cm4gcjsKKwl9CisKKwlpZiAoYWRldi0+ZmlybXdhcmUu
bG9hZF90eXBlID09IEFNREdQVV9GV19MT0FEX0RJUkVDVCkgeworCQlyID0gc2RtYV92NV8wX2xv
YWRfbWljcm9jb2RlKGFkZXYpOworCQlpZiAocikKKwkJCXJldHVybiByOworCisJCS8qIFRoZSB2
YWx1ZSBvZiBtbVNETUFfRjMyX0NOVEwgaXMgaW52YWxpZCB0aGUgbW9tZW50IGFmdGVyIGxvYWRp
bmcgZncgKi8KKwkJaWYgKGFtZGdwdV9lbXVfbW9kZSA9PSAxICYmIGFkZXYtPnBkZXYtPmRldmlj
ZSA9PSAweDRkKQorCQkJbXNsZWVwKDEwMDApOworCX0KKworCS8qIHVuaGFsdCB0aGUgTUVzICov
CisJc2RtYV92NV8wX2VuYWJsZShhZGV2LCB0cnVlKTsKKwkvKiBlbmFibGUgc2RtYSByaW5nIHBy
ZWVtcHRpb24gKi8KKwlzZG1hX3Y1XzBfY3R4X3N3aXRjaF9lbmFibGUoYWRldiwgdHJ1ZSk7CisK
KwkvKiBzdGFydCB0aGUgZ2Z4IHJpbmdzIGFuZCBybGMgY29tcHV0ZSBxdWV1ZXMgKi8KKwlyID0g
c2RtYV92NV8wX2dmeF9yZXN1bWUoYWRldik7CisJaWYgKHIpCisJCXJldHVybiByOworCXIgPSBz
ZG1hX3Y1XzBfcmxjX3Jlc3VtZShhZGV2KTsKKworCXJldHVybiByOworfQorCisvKioKKyAqIHNk
bWFfdjVfMF9yaW5nX3Rlc3RfcmluZyAtIHNpbXBsZSBhc3luYyBkbWEgZW5naW5lIHRlc3QKKyAq
CisgKiBAcmluZzogYW1kZ3B1X3Jpbmcgc3RydWN0dXJlIGhvbGRpbmcgcmluZyBpbmZvcm1hdGlv
bgorICoKKyAqIFRlc3QgdGhlIERNQSBlbmdpbmUgYnkgd3JpdGluZyB1c2luZyBpdCB0byB3cml0
ZSBhbgorICogdmFsdWUgdG8gbWVtb3J5LiAoTkFWSTEwKS4KKyAqIFJldHVybnMgMCBmb3Igc3Vj
Y2VzcywgZXJyb3IgZm9yIGZhaWx1cmUuCisgKi8KK3N0YXRpYyBpbnQgc2RtYV92NV8wX3Jpbmdf
dGVzdF9yaW5nKHN0cnVjdCBhbWRncHVfcmluZyAqcmluZykKK3sKKwlzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiA9IHJpbmctPmFkZXY7CisJdW5zaWduZWQgaTsKKwl1bnNpZ25lZCBpbmRleDsK
KwlpbnQgcjsKKwl1MzIgdG1wOworCXU2NCBncHVfYWRkcjsKKworCXIgPSBhbWRncHVfZGV2aWNl
X3diX2dldChhZGV2LCAmaW5kZXgpOworCWlmIChyKSB7CisJCWRldl9lcnIoYWRldi0+ZGV2LCAi
KCVkKSBmYWlsZWQgdG8gYWxsb2NhdGUgd2Igc2xvdFxuIiwgcik7CisJCXJldHVybiByOworCX0K
KworCWdwdV9hZGRyID0gYWRldi0+d2IuZ3B1X2FkZHIgKyAoaW5kZXggKiA0KTsKKwl0bXAgPSAw
eENBRkVERUFEOworCWFkZXYtPndiLndiW2luZGV4XSA9IGNwdV90b19sZTMyKHRtcCk7CisKKwly
ID0gYW1kZ3B1X3JpbmdfYWxsb2MocmluZywgNSk7CisJaWYgKHIpIHsKKwkJRFJNX0VSUk9SKCJh
bWRncHU6IGRtYSBmYWlsZWQgdG8gbG9jayByaW5nICVkICglZCkuXG4iLCByaW5nLT5pZHgsIHIp
OworCQlhbWRncHVfZGV2aWNlX3diX2ZyZWUoYWRldiwgaW5kZXgpOworCQlyZXR1cm4gcjsKKwl9
CisKKwlhbWRncHVfcmluZ193cml0ZShyaW5nLCBTRE1BX1BLVF9IRUFERVJfT1AoU0RNQV9PUF9X
UklURSkgfAorCQkJICBTRE1BX1BLVF9IRUFERVJfU1VCX09QKFNETUFfU1VCT1BfV1JJVEVfTElO
RUFSKSk7CisJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgbG93ZXJfMzJfYml0cyhncHVfYWRkcikp
OworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIHVwcGVyXzMyX2JpdHMoZ3B1X2FkZHIpKTsKKwlh
bWRncHVfcmluZ193cml0ZShyaW5nLCBTRE1BX1BLVF9XUklURV9VTlRJTEVEX0RXXzNfQ09VTlQo
MCkpOworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIDB4REVBREJFRUYpOworCWFtZGdwdV9yaW5n
X2NvbW1pdChyaW5nKTsKKworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT51c2VjX3RpbWVvdXQ7IGkr
KykgeworCQl0bXAgPSBsZTMyX3RvX2NwdShhZGV2LT53Yi53YltpbmRleF0pOworCQlpZiAodG1w
ID09IDB4REVBREJFRUYpCisJCQlicmVhazsKKwkJaWYgKGFtZGdwdV9lbXVfbW9kZSA9PSAxKQor
CQkJbXNsZWVwKDEpOworCQllbHNlCisJCQlEUk1fVURFTEFZKDEpOworCX0KKworCWlmIChpIDwg
YWRldi0+dXNlY190aW1lb3V0KSB7CisJCWlmIChhbWRncHVfZW11X21vZGUgPT0gMSkKKwkJCURS
TV9JTkZPKCJyaW5nIHRlc3Qgb24gJWQgc3VjY2VlZGVkIGluICVkIG1zZWNzXG4iLCByaW5nLT5p
ZHgsIGkpOworCQllbHNlCisJCQlEUk1fSU5GTygicmluZyB0ZXN0IG9uICVkIHN1Y2NlZWRlZCBp
biAlZCB1c2Vjc1xuIiwgcmluZy0+aWR4LCBpKTsKKwl9IGVsc2UgeworCQlEUk1fRVJST1IoImFt
ZGdwdTogcmluZyAlZCB0ZXN0IGZhaWxlZCAoMHglMDhYKVxuIiwKKwkJCSAgcmluZy0+aWR4LCB0
bXApOworCQlyID0gLUVJTlZBTDsKKwl9CisJYW1kZ3B1X2RldmljZV93Yl9mcmVlKGFkZXYsIGlu
ZGV4KTsKKworCXJldHVybiByOworfQorCisvKioKKyAqIHNkbWFfdjVfMF9yaW5nX3Rlc3RfaWIg
LSB0ZXN0IGFuIElCIG9uIHRoZSBETUEgZW5naW5lCisgKgorICogQHJpbmc6IGFtZGdwdV9yaW5n
IHN0cnVjdHVyZSBob2xkaW5nIHJpbmcgaW5mb3JtYXRpb24KKyAqCisgKiBUZXN0IGEgc2ltcGxl
IElCIGluIHRoZSBETUEgcmluZyAoTkFWSTEwKS4KKyAqIFJldHVybnMgMCBvbiBzdWNjZXNzLCBl
cnJvciBvbiBmYWlsdXJlLgorICovCitzdGF0aWMgaW50IHNkbWFfdjVfMF9yaW5nX3Rlc3RfaWIo
c3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCBsb25nIHRpbWVvdXQpCit7CisJc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYgPSByaW5nLT5hZGV2OworCXN0cnVjdCBhbWRncHVfaWIgaWI7CisJc3Ry
dWN0IGRtYV9mZW5jZSAqZiA9IE5VTEw7CisJdW5zaWduZWQgaW5kZXg7CisJbG9uZyByOworCXUz
MiB0bXAgPSAwOworCXU2NCBncHVfYWRkcjsKKworCXIgPSBhbWRncHVfZGV2aWNlX3diX2dldChh
ZGV2LCAmaW5kZXgpOworCWlmIChyKSB7CisJCWRldl9lcnIoYWRldi0+ZGV2LCAiKCVsZCkgZmFp
bGVkIHRvIGFsbG9jYXRlIHdiIHNsb3RcbiIsIHIpOworCQlyZXR1cm4gcjsKKwl9CisKKwlncHVf
YWRkciA9IGFkZXYtPndiLmdwdV9hZGRyICsgKGluZGV4ICogNCk7CisJdG1wID0gMHhDQUZFREVB
RDsKKwlhZGV2LT53Yi53YltpbmRleF0gPSBjcHVfdG9fbGUzMih0bXApOworCW1lbXNldCgmaWIs
IDAsIHNpemVvZihpYikpOworCXIgPSBhbWRncHVfaWJfZ2V0KGFkZXYsIE5VTEwsIDI1NiwgJmli
KTsKKwlpZiAocikgeworCQlEUk1fRVJST1IoImFtZGdwdTogZmFpbGVkIHRvIGdldCBpYiAoJWxk
KS5cbiIsIHIpOworCQlnb3RvIGVycjA7CisJfQorCisJaWIucHRyWzBdID0gU0RNQV9QS1RfSEVB
REVSX09QKFNETUFfT1BfV1JJVEUpIHwKKwkJU0RNQV9QS1RfSEVBREVSX1NVQl9PUChTRE1BX1NV
Qk9QX1dSSVRFX0xJTkVBUik7CisJaWIucHRyWzFdID0gbG93ZXJfMzJfYml0cyhncHVfYWRkcik7
CisJaWIucHRyWzJdID0gdXBwZXJfMzJfYml0cyhncHVfYWRkcik7CisJaWIucHRyWzNdID0gU0RN
QV9QS1RfV1JJVEVfVU5USUxFRF9EV18zX0NPVU5UKDApOworCWliLnB0cls0XSA9IDB4REVBREJF
RUY7CisJaWIucHRyWzVdID0gU0RNQV9QS1RfTk9QX0hFQURFUl9PUChTRE1BX09QX05PUCk7CisJ
aWIucHRyWzZdID0gU0RNQV9QS1RfTk9QX0hFQURFUl9PUChTRE1BX09QX05PUCk7CisJaWIucHRy
WzddID0gU0RNQV9QS1RfTk9QX0hFQURFUl9PUChTRE1BX09QX05PUCk7CisJaWIubGVuZ3RoX2R3
ID0gODsKKworCXIgPSBhbWRncHVfaWJfc2NoZWR1bGUocmluZywgMSwgJmliLCBOVUxMLCAmZik7
CisJaWYgKHIpCisJCWdvdG8gZXJyMTsKKworCXIgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGYs
IGZhbHNlLCB0aW1lb3V0KTsKKwlpZiAociA9PSAwKSB7CisJCURSTV9FUlJPUigiYW1kZ3B1OiBJ
QiB0ZXN0IHRpbWVkIG91dFxuIik7CisJCXIgPSAtRVRJTUVET1VUOworCQlnb3RvIGVycjE7CisJ
fSBlbHNlIGlmIChyIDwgMCkgeworCQlEUk1fRVJST1IoImFtZGdwdTogZmVuY2Ugd2FpdCBmYWls
ZWQgKCVsZCkuXG4iLCByKTsKKwkJZ290byBlcnIxOworCX0KKwl0bXAgPSBsZTMyX3RvX2NwdShh
ZGV2LT53Yi53YltpbmRleF0pOworCWlmICh0bXAgPT0gMHhERUFEQkVFRikgeworCQlEUk1fSU5G
TygiaWIgdGVzdCBvbiByaW5nICVkIHN1Y2NlZWRlZFxuIiwgcmluZy0+aWR4KTsKKwkJciA9IDA7
CisJfSBlbHNlIHsKKwkJRFJNX0VSUk9SKCJhbWRncHU6IGliIHRlc3QgZmFpbGVkICgweCUwOFgp
XG4iLCB0bXApOworCQlyID0gLUVJTlZBTDsKKwl9CisKK2VycjE6CisJYW1kZ3B1X2liX2ZyZWUo
YWRldiwgJmliLCBOVUxMKTsKKwlkbWFfZmVuY2VfcHV0KGYpOworZXJyMDoKKwlhbWRncHVfZGV2
aWNlX3diX2ZyZWUoYWRldiwgaW5kZXgpOworCXJldHVybiByOworfQorCisKKy8qKgorICogc2Rt
YV92NV8wX3ZtX2NvcHlfcHRlIC0gdXBkYXRlIFBURXMgYnkgY29weWluZyB0aGVtIGZyb20gdGhl
IEdBUlQKKyAqCisgKiBAaWI6IGluZGlyZWN0IGJ1ZmZlciB0byBmaWxsIHdpdGggY29tbWFuZHMK
KyAqIEBwZTogYWRkciBvZiB0aGUgcGFnZSBlbnRyeQorICogQHNyYzogc3JjIGFkZHIgdG8gY29w
eSBmcm9tCisgKiBAY291bnQ6IG51bWJlciBvZiBwYWdlIGVudHJpZXMgdG8gdXBkYXRlCisgKgor
ICogVXBkYXRlIFBURXMgYnkgY29weWluZyB0aGVtIGZyb20gdGhlIEdBUlQgdXNpbmcgc0RNQSAo
TkFWSTEwKS4KKyAqLworc3RhdGljIHZvaWQgc2RtYV92NV8wX3ZtX2NvcHlfcHRlKHN0cnVjdCBh
bWRncHVfaWIgKmliLAorCQkJCSAgdWludDY0X3QgcGUsIHVpbnQ2NF90IHNyYywKKwkJCQkgIHVu
c2lnbmVkIGNvdW50KQoreworCXVuc2lnbmVkIGJ5dGVzID0gY291bnQgKiA4OworCisJaWItPnB0
cltpYi0+bGVuZ3RoX2R3KytdID0gU0RNQV9QS1RfSEVBREVSX09QKFNETUFfT1BfQ09QWSkgfAor
CQlTRE1BX1BLVF9IRUFERVJfU1VCX09QKFNETUFfU1VCT1BfQ09QWV9MSU5FQVIpOworCWliLT5w
dHJbaWItPmxlbmd0aF9kdysrXSA9IGJ5dGVzIC0gMTsKKwlpYi0+cHRyW2liLT5sZW5ndGhfZHcr
K10gPSAwOyAvKiBzcmMvZHN0IGVuZGlhbiBzd2FwICovCisJaWItPnB0cltpYi0+bGVuZ3RoX2R3
KytdID0gbG93ZXJfMzJfYml0cyhzcmMpOworCWliLT5wdHJbaWItPmxlbmd0aF9kdysrXSA9IHVw
cGVyXzMyX2JpdHMoc3JjKTsKKwlpYi0+cHRyW2liLT5sZW5ndGhfZHcrK10gPSBsb3dlcl8zMl9i
aXRzKHBlKTsKKwlpYi0+cHRyW2liLT5sZW5ndGhfZHcrK10gPSB1cHBlcl8zMl9iaXRzKHBlKTsK
KworfQorCisvKioKKyAqIHNkbWFfdjVfMF92bV93cml0ZV9wdGUgLSB1cGRhdGUgUFRFcyBieSB3
cml0aW5nIHRoZW0gbWFudWFsbHkKKyAqCisgKiBAaWI6IGluZGlyZWN0IGJ1ZmZlciB0byBmaWxs
IHdpdGggY29tbWFuZHMKKyAqIEBwZTogYWRkciBvZiB0aGUgcGFnZSBlbnRyeQorICogQGFkZHI6
IGRzdCBhZGRyIHRvIHdyaXRlIGludG8gcGUKKyAqIEBjb3VudDogbnVtYmVyIG9mIHBhZ2UgZW50
cmllcyB0byB1cGRhdGUKKyAqIEBpbmNyOiBpbmNyZWFzZSBuZXh0IGFkZHIgYnkgaW5jciBieXRl
cworICogQGZsYWdzOiBhY2Nlc3MgZmxhZ3MKKyAqCisgKiBVcGRhdGUgUFRFcyBieSB3cml0aW5n
IHRoZW0gbWFudWFsbHkgdXNpbmcgc0RNQSAoTkFWSTEwKS4KKyAqLworc3RhdGljIHZvaWQgc2Rt
YV92NV8wX3ZtX3dyaXRlX3B0ZShzdHJ1Y3QgYW1kZ3B1X2liICppYiwgdWludDY0X3QgcGUsCisJ
CQkJICAgdWludDY0X3QgdmFsdWUsIHVuc2lnbmVkIGNvdW50LAorCQkJCSAgIHVpbnQzMl90IGlu
Y3IpCit7CisJdW5zaWduZWQgbmR3ID0gY291bnQgKiAyOworCisJaWItPnB0cltpYi0+bGVuZ3Ro
X2R3KytdID0gU0RNQV9QS1RfSEVBREVSX09QKFNETUFfT1BfV1JJVEUpIHwKKwkJU0RNQV9QS1Rf
SEVBREVSX1NVQl9PUChTRE1BX1NVQk9QX1dSSVRFX0xJTkVBUik7CisJaWItPnB0cltpYi0+bGVu
Z3RoX2R3KytdID0gbG93ZXJfMzJfYml0cyhwZSk7CisJaWItPnB0cltpYi0+bGVuZ3RoX2R3Kytd
ID0gdXBwZXJfMzJfYml0cyhwZSk7CisJaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gbmR3IC0g
MTsKKwlmb3IgKDsgbmR3ID4gMDsgbmR3IC09IDIpIHsKKwkJaWItPnB0cltpYi0+bGVuZ3RoX2R3
KytdID0gbG93ZXJfMzJfYml0cyh2YWx1ZSk7CisJCWliLT5wdHJbaWItPmxlbmd0aF9kdysrXSA9
IHVwcGVyXzMyX2JpdHModmFsdWUpOworCQl2YWx1ZSArPSBpbmNyOworCX0KK30KKworLyoqCisg
KiBzZG1hX3Y1XzBfdm1fc2V0X3B0ZV9wZGUgLSB1cGRhdGUgdGhlIHBhZ2UgdGFibGVzIHVzaW5n
IHNETUEKKyAqCisgKiBAaWI6IGluZGlyZWN0IGJ1ZmZlciB0byBmaWxsIHdpdGggY29tbWFuZHMK
KyAqIEBwZTogYWRkciBvZiB0aGUgcGFnZSBlbnRyeQorICogQGFkZHI6IGRzdCBhZGRyIHRvIHdy
aXRlIGludG8gcGUKKyAqIEBjb3VudDogbnVtYmVyIG9mIHBhZ2UgZW50cmllcyB0byB1cGRhdGUK
KyAqIEBpbmNyOiBpbmNyZWFzZSBuZXh0IGFkZHIgYnkgaW5jciBieXRlcworICogQGZsYWdzOiBh
Y2Nlc3MgZmxhZ3MKKyAqCisgKiBVcGRhdGUgdGhlIHBhZ2UgdGFibGVzIHVzaW5nIHNETUEgKE5B
VkkxMCkuCisgKi8KK3N0YXRpYyB2b2lkIHNkbWFfdjVfMF92bV9zZXRfcHRlX3BkZShzdHJ1Y3Qg
YW1kZ3B1X2liICppYiwKKwkJCQkgICAgIHVpbnQ2NF90IHBlLAorCQkJCSAgICAgdWludDY0X3Qg
YWRkciwgdW5zaWduZWQgY291bnQsCisJCQkJICAgICB1aW50MzJfdCBpbmNyLCB1aW50NjRfdCBm
bGFncykKK3sKKwkvKiBmb3IgcGh5c2ljYWxseSBjb250aWd1b3VzIHBhZ2VzICh2cmFtKSAqLwor
CWliLT5wdHJbaWItPmxlbmd0aF9kdysrXSA9IFNETUFfUEtUX0hFQURFUl9PUChTRE1BX09QX1BU
RVBERSk7CisJaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gbG93ZXJfMzJfYml0cyhwZSk7IC8q
IGRzdCBhZGRyICovCisJaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gdXBwZXJfMzJfYml0cyhw
ZSk7CisJaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gbG93ZXJfMzJfYml0cyhmbGFncyk7IC8q
IG1hc2sgKi8KKwlpYi0+cHRyW2liLT5sZW5ndGhfZHcrK10gPSB1cHBlcl8zMl9iaXRzKGZsYWdz
KTsKKwlpYi0+cHRyW2liLT5sZW5ndGhfZHcrK10gPSBsb3dlcl8zMl9iaXRzKGFkZHIpOyAvKiB2
YWx1ZSAqLworCWliLT5wdHJbaWItPmxlbmd0aF9kdysrXSA9IHVwcGVyXzMyX2JpdHMoYWRkcik7
CisJaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gaW5jcjsgLyogaW5jcmVtZW50IHNpemUgKi8K
KwlpYi0+cHRyW2liLT5sZW5ndGhfZHcrK10gPSAwOworCWliLT5wdHJbaWItPmxlbmd0aF9kdysr
XSA9IGNvdW50IC0gMTsgLyogbnVtYmVyIG9mIGVudHJpZXMgKi8KK30KKworLyoqCisgKiBzZG1h
X3Y1XzBfcmluZ19wYWRfaWIgLSBwYWQgdGhlIElCIHRvIHRoZSByZXF1aXJlZCBudW1iZXIgb2Yg
ZHcKKyAqCisgKiBAaWI6IGluZGlyZWN0IGJ1ZmZlciB0byBmaWxsIHdpdGggcGFkZGluZworICoK
KyAqLworc3RhdGljIHZvaWQgc2RtYV92NV8wX3JpbmdfcGFkX2liKHN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZywgc3RydWN0IGFtZGdwdV9pYiAqaWIpCit7CisJc3RydWN0IGFtZGdwdV9zZG1hX2lu
c3RhbmNlICpzZG1hID0gYW1kZ3B1X3NkbWFfZ2V0X2luc3RhbmNlX2Zyb21fcmluZyhyaW5nKTsK
Kwl1MzIgcGFkX2NvdW50OworCWludCBpOworCisJcGFkX2NvdW50ID0gKDggLSAoaWItPmxlbmd0
aF9kdyAmIDB4NykpICUgODsKKwlmb3IgKGkgPSAwOyBpIDwgcGFkX2NvdW50OyBpKyspCisJCWlm
IChzZG1hICYmIHNkbWEtPmJ1cnN0X25vcCAmJiAoaSA9PSAwKSkKKwkJCWliLT5wdHJbaWItPmxl
bmd0aF9kdysrXSA9CisJCQkJU0RNQV9QS1RfSEVBREVSX09QKFNETUFfT1BfTk9QKSB8CisJCQkJ
U0RNQV9QS1RfTk9QX0hFQURFUl9DT1VOVChwYWRfY291bnQgLSAxKTsKKwkJZWxzZQorCQkJaWIt
PnB0cltpYi0+bGVuZ3RoX2R3KytdID0KKwkJCQlTRE1BX1BLVF9IRUFERVJfT1AoU0RNQV9PUF9O
T1ApOworfQorCisKKy8qKgorICogc2RtYV92NV8wX3JpbmdfZW1pdF9waXBlbGluZV9zeW5jIC0g
c3luYyB0aGUgcGlwZWxpbmUKKyAqCisgKiBAcmluZzogYW1kZ3B1X3JpbmcgcG9pbnRlcgorICoK
KyAqIE1ha2Ugc3VyZSBhbGwgcHJldmlvdXMgb3BlcmF0aW9ucyBhcmUgY29tcGxldGVkIChDSUsp
LgorICovCitzdGF0aWMgdm9pZCBzZG1hX3Y1XzBfcmluZ19lbWl0X3BpcGVsaW5lX3N5bmMoc3Ry
dWN0IGFtZGdwdV9yaW5nICpyaW5nKQoreworCXVpbnQzMl90IHNlcSA9IHJpbmctPmZlbmNlX2Ry
di5zeW5jX3NlcTsKKwl1aW50NjRfdCBhZGRyID0gcmluZy0+ZmVuY2VfZHJ2LmdwdV9hZGRyOwor
CisJLyogd2FpdCBmb3IgaWRsZSAqLworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIFNETUFfUEtU
X0hFQURFUl9PUChTRE1BX09QX1BPTExfUkVHTUVNKSB8CisJCQkgIFNETUFfUEtUX1BPTExfUkVH
TUVNX0hFQURFUl9IRFBfRkxVU0goMCkgfAorCQkJICBTRE1BX1BLVF9QT0xMX1JFR01FTV9IRUFE
RVJfRlVOQygzKSB8IC8qIGVxdWFsICovCisJCQkgIFNETUFfUEtUX1BPTExfUkVHTUVNX0hFQURF
Ul9NRU1fUE9MTCgxKSk7CisJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgYWRkciAmIDB4ZmZmZmZm
ZmMpOworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIHVwcGVyXzMyX2JpdHMoYWRkcikgJiAweGZm
ZmZmZmZmKTsKKwlhbWRncHVfcmluZ193cml0ZShyaW5nLCBzZXEpOyAvKiByZWZlcmVuY2UgKi8K
KwlhbWRncHVfcmluZ193cml0ZShyaW5nLCAweGZmZmZmZmYpOyAvKiBtYXNrICovCisJYW1kZ3B1
X3Jpbmdfd3JpdGUocmluZywgU0RNQV9QS1RfUE9MTF9SRUdNRU1fRFc1X1JFVFJZX0NPVU5UKDB4
ZmZmKSB8CisJCQkgIFNETUFfUEtUX1BPTExfUkVHTUVNX0RXNV9JTlRFUlZBTCg0KSk7IC8qIHJl
dHJ5IGNvdW50LCBwb2xsIGludGVydmFsICovCit9CisKKworLyoqCisgKiBzZG1hX3Y1XzBfcmlu
Z19lbWl0X3ZtX2ZsdXNoIC0gdm0gZmx1c2ggdXNpbmcgc0RNQQorICoKKyAqIEByaW5nOiBhbWRn
cHVfcmluZyBwb2ludGVyCisgKiBAdm06IGFtZGdwdV92bSBwb2ludGVyCisgKgorICogVXBkYXRl
IHRoZSBwYWdlIHRhYmxlIGJhc2UgYW5kIGZsdXNoIHRoZSBWTSBUTEIKKyAqIHVzaW5nIHNETUEg
KE5BVkkxMCkuCisgKi8KK3N0YXRpYyB2b2lkIHNkbWFfdjVfMF9yaW5nX2VtaXRfdm1fZmx1c2go
c3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLAorCQkJCQkgdW5zaWduZWQgdm1pZCwgdWludDY0X3Qg
cGRfYWRkcikKK3sKKwlhbWRncHVfZ21jX2VtaXRfZmx1c2hfZ3B1X3RsYihyaW5nLCB2bWlkLCBw
ZF9hZGRyKTsKK30KKworc3RhdGljIHZvaWQgc2RtYV92NV8wX3JpbmdfZW1pdF93cmVnKHN0cnVj
dCBhbWRncHVfcmluZyAqcmluZywKKwkJCQkgICAgIHVpbnQzMl90IHJlZywgdWludDMyX3QgdmFs
KQoreworCWFtZGdwdV9yaW5nX3dyaXRlKHJpbmcsIFNETUFfUEtUX0hFQURFUl9PUChTRE1BX09Q
X1NSQk1fV1JJVEUpIHwKKwkJCSAgU0RNQV9QS1RfU1JCTV9XUklURV9IRUFERVJfQllURV9FTigw
eGYpKTsKKwlhbWRncHVfcmluZ193cml0ZShyaW5nLCByZWcpOworCWFtZGdwdV9yaW5nX3dyaXRl
KHJpbmcsIHZhbCk7Cit9CisKK3N0YXRpYyB2b2lkIHNkbWFfdjVfMF9yaW5nX2VtaXRfcmVnX3dh
aXQoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCB1aW50MzJfdCByZWcsCisJCQkJCSB1aW50MzJf
dCB2YWwsIHVpbnQzMl90IG1hc2spCit7CisJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgU0RNQV9Q
S1RfSEVBREVSX09QKFNETUFfT1BfUE9MTF9SRUdNRU0pIHwKKwkJCSAgU0RNQV9QS1RfUE9MTF9S
RUdNRU1fSEVBREVSX0hEUF9GTFVTSCgwKSB8CisJCQkgIFNETUFfUEtUX1BPTExfUkVHTUVNX0hF
QURFUl9GVU5DKDMpKTsgLyogZXF1YWwgKi8KKwlhbWRncHVfcmluZ193cml0ZShyaW5nLCByZWcg
PDwgMik7CisJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgMCk7CisJYW1kZ3B1X3Jpbmdfd3JpdGUo
cmluZywgdmFsKTsgLyogcmVmZXJlbmNlICovCisJYW1kZ3B1X3Jpbmdfd3JpdGUocmluZywgbWFz
ayk7IC8qIG1hc2sgKi8KKwlhbWRncHVfcmluZ193cml0ZShyaW5nLCBTRE1BX1BLVF9QT0xMX1JF
R01FTV9EVzVfUkVUUllfQ09VTlQoMHhmZmYpIHwKKwkJCSAgU0RNQV9QS1RfUE9MTF9SRUdNRU1f
RFc1X0lOVEVSVkFMKDEwKSk7Cit9CisKK3N0YXRpYyBpbnQgc2RtYV92NV8wX2Vhcmx5X2luaXQo
dm9pZCAqaGFuZGxlKQoreworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBh
bWRncHVfZGV2aWNlICopaGFuZGxlOworCisJYWRldi0+c2RtYS5udW1faW5zdGFuY2VzID0gMjsK
KworCXNkbWFfdjVfMF9zZXRfcmluZ19mdW5jcyhhZGV2KTsKKwlzZG1hX3Y1XzBfc2V0X2J1ZmZl
cl9mdW5jcyhhZGV2KTsKKwlzZG1hX3Y1XzBfc2V0X3ZtX3B0ZV9mdW5jcyhhZGV2KTsKKwlzZG1h
X3Y1XzBfc2V0X2lycV9mdW5jcyhhZGV2KTsKKworCXJldHVybiAwOworfQorCisKK3N0YXRpYyBp
bnQgc2RtYV92NV8wX3N3X2luaXQodm9pZCAqaGFuZGxlKQoreworCXN0cnVjdCBhbWRncHVfcmlu
ZyAqcmluZzsKKwlpbnQgciwgaTsKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqKWhhbmRsZTsKKworCS8qIFNETUEgdHJhcCBldmVudCAqLworCXIg
PSBhbWRncHVfaXJxX2FkZF9pZChhZGV2LCBTT0MxNV9JSF9DTElFTlRJRF9TRE1BMCwKKwkJCSAg
ICAgIFNETUEwXzVfMF9fU1JDSURfX1NETUFfVFJBUCwKKwkJCSAgICAgICZhZGV2LT5zZG1hLnRy
YXBfaXJxKTsKKwlpZiAocikKKwkJcmV0dXJuIHI7CisKKwkvKiBTRE1BIHRyYXAgZXZlbnQgKi8K
KwlyID0gYW1kZ3B1X2lycV9hZGRfaWQoYWRldiwgU09DMTVfSUhfQ0xJRU5USURfU0RNQTEsCisJ
CQkgICAgICBTRE1BMV81XzBfX1NSQ0lEX19TRE1BX1RSQVAsCisJCQkgICAgICAmYWRldi0+c2Rt
YS50cmFwX2lycSk7CisJaWYgKHIpCisJCXJldHVybiByOworCisJciA9IHNkbWFfdjVfMF9pbml0
X21pY3JvY29kZShhZGV2KTsKKwlpZiAocikgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBsb2Fk
IHNkbWEgZmlybXdhcmUhXG4iKTsKKwkJcmV0dXJuIHI7CisJfQorCisJZm9yIChpID0gMDsgaSA8
IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsgaSsrKSB7CisJCXJpbmcgPSAmYWRldi0+c2RtYS5p
bnN0YW5jZVtpXS5yaW5nOworCQlyaW5nLT5yaW5nX29iaiA9IE5VTEw7CisJCXJpbmctPnVzZV9k
b29yYmVsbCA9IHRydWU7CisKKwkJRFJNX0lORk8oInVzZV9kb29yYmVsbCBiZWluZyBzZXQgdG86
IFslc11cbiIsCisJCQkJcmluZy0+dXNlX2Rvb3JiZWxsPyJ0cnVlIjoiZmFsc2UiKTsKKworCQly
aW5nLT5kb29yYmVsbF9pbmRleCA9IChpID09IDApID8KKwkJCShhZGV2LT5kb29yYmVsbF9pbmRl
eC5zZG1hX2VuZ2luZVswXSA8PCAxKSAvL2dldCBEV09SRCBvZmZzZXQKKwkJCTogKGFkZXYtPmRv
b3JiZWxsX2luZGV4LnNkbWFfZW5naW5lWzFdIDw8IDEpOyAvLyBnZXQgRFdPUkQgb2Zmc2V0CisK
KwkJc3ByaW50ZihyaW5nLT5uYW1lLCAic2RtYSVkIiwgaSk7CisJCXIgPSBhbWRncHVfcmluZ19p
bml0KGFkZXYsIHJpbmcsIDEwMjQsCisJCQkJICAgICAmYWRldi0+c2RtYS50cmFwX2lycSwKKwkJ
CQkgICAgIChpID09IDApID8KKwkJCQkgICAgIEFNREdQVV9TRE1BX0lSUV9JTlNUQU5DRTAgOgor
CQkJCSAgICAgQU1ER1BVX1NETUFfSVJRX0lOU1RBTkNFMSk7CisJCWlmIChyKQorCQkJcmV0dXJu
IHI7CisJfQorCisJcmV0dXJuIHI7Cit9CisKK3N0YXRpYyBpbnQgc2RtYV92NV8wX3N3X2Zpbmko
dm9pZCAqaGFuZGxlKQoreworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gKHN0cnVjdCBh
bWRncHVfZGV2aWNlICopaGFuZGxlOworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IGFkZXYt
PnNkbWEubnVtX2luc3RhbmNlczsgaSsrKQorCQlhbWRncHVfcmluZ19maW5pKCZhZGV2LT5zZG1h
Lmluc3RhbmNlW2ldLnJpbmcpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgc2RtYV92
NV8wX2h3X2luaXQodm9pZCAqaGFuZGxlKQoreworCWludCByOworCXN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2ID0gKHN0cnVjdCBhbWRncHVfZGV2aWNlICopaGFuZGxlOworCisJc2RtYV92NV8w
X2luaXRfZ29sZGVuX3JlZ2lzdGVycyhhZGV2KTsKKworCXIgPSBzZG1hX3Y1XzBfc3RhcnQoYWRl
dik7CisKKwlyZXR1cm4gcjsKK30KKworc3RhdGljIGludCBzZG1hX3Y1XzBfaHdfZmluaSh2b2lk
ICpoYW5kbGUpCit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKiloYW5kbGU7CisKKwlpZiAoYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKQorCQlyZXR1
cm4gMDsKKworCXNkbWFfdjVfMF9jdHhfc3dpdGNoX2VuYWJsZShhZGV2LCBmYWxzZSk7CisJc2Rt
YV92NV8wX2VuYWJsZShhZGV2LCBmYWxzZSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlu
dCBzZG1hX3Y1XzBfc3VzcGVuZCh2b2lkICpoYW5kbGUpCit7CisJc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYgPSAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKiloYW5kbGU7CisKKwlyZXR1cm4gc2Rt
YV92NV8wX2h3X2ZpbmkoYWRldik7Cit9CisKK3N0YXRpYyBpbnQgc2RtYV92NV8wX3Jlc3VtZSh2
b2lkICpoYW5kbGUpCit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKiloYW5kbGU7CisKKwlyZXR1cm4gc2RtYV92NV8wX2h3X2luaXQoYWRldik7
Cit9CisKK3N0YXRpYyBib29sIHNkbWFfdjVfMF9pc19pZGxlKHZvaWQgKmhhbmRsZSkKK3sKKwlz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWhhbmRs
ZTsKKwl1MzIgaTsKKworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5zZG1hLm51bV9pbnN0YW5jZXM7
IGkrKykgeworCQl1MzIgdG1wID0gUlJFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2
LCBpLCBtbVNETUEwX1NUQVRVU19SRUcpKTsKKworCQlpZiAoISh0bXAgJiBTRE1BMF9TVEFUVVNf
UkVHX19JRExFX01BU0spKQorCQkJcmV0dXJuIGZhbHNlOworCX0KKworCXJldHVybiB0cnVlOwor
fQorCitzdGF0aWMgaW50IHNkbWFfdjVfMF93YWl0X2Zvcl9pZGxlKHZvaWQgKmhhbmRsZSkKK3sK
Kwl1bnNpZ25lZCBpOworCXUzMiBzZG1hMCwgc2RtYTE7CisJc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYgPSAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKiloYW5kbGU7CisKKwlmb3IgKGkgPSAwOyBp
IDwgYWRldi0+dXNlY190aW1lb3V0OyBpKyspIHsKKwkJc2RtYTAgPSBSUkVHMzIoc2RtYV92NV8w
X2dldF9yZWdfb2Zmc2V0KGFkZXYsIDAsIG1tU0RNQTBfU1RBVFVTX1JFRykpOworCQlzZG1hMSA9
IFJSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgMSwgbW1TRE1BMF9TVEFUVVNf
UkVHKSk7CisKKwkJaWYgKHNkbWEwICYgc2RtYTEgJiBTRE1BMF9TVEFUVVNfUkVHX19JRExFX01B
U0spCisJCQlyZXR1cm4gMDsKKwkJdWRlbGF5KDEpOworCX0KKwlyZXR1cm4gLUVUSU1FRE9VVDsK
K30KKworc3RhdGljIGludCBzZG1hX3Y1XzBfc29mdF9yZXNldCh2b2lkICpoYW5kbGUpCit7CisJ
LyogdG9kbyAqLworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgc2RtYV92NV8wX3Jpbmdf
cHJlZW1wdF9pYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcpCit7CisJaW50IGksIHIgPSAwOwor
CXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gcmluZy0+YWRldjsKKwl1MzIgaW5kZXggPSAw
OworCXU2NCBzZG1hX2dmeF9wcmVlbXB0OworCisJYW1kZ3B1X3NkbWFfZ2V0X2luZGV4X2Zyb21f
cmluZyhyaW5nLCAmaW5kZXgpOworCWlmIChpbmRleCA9PSAwKQorCQlzZG1hX2dmeF9wcmVlbXB0
ID0gbW1TRE1BMF9HRlhfUFJFRU1QVDsKKwllbHNlCisJCXNkbWFfZ2Z4X3ByZWVtcHQgPSBtbVNE
TUExX0dGWF9QUkVFTVBUOworCisJLyogYXNzZXJ0IHByZWVtcHRpb24gY29uZGl0aW9uICovCisJ
YW1kZ3B1X3Jpbmdfc2V0X3ByZWVtcHRfY29uZF9leGVjKHJpbmcsIGZhbHNlKTsKKworCS8qIGVt
aXQgdGhlIHRyYWlsaW5nIGZlbmNlICovCisJcmluZy0+dHJhaWxfc2VxICs9IDE7CisJYW1kZ3B1
X3JpbmdfYWxsb2MocmluZywgMTApOworCXNkbWFfdjVfMF9yaW5nX2VtaXRfZmVuY2UocmluZywg
cmluZy0+dHJhaWxfZmVuY2VfZ3B1X2FkZHIsCisJCQkJICByaW5nLT50cmFpbF9zZXEsIDApOwor
CWFtZGdwdV9yaW5nX2NvbW1pdChyaW5nKTsKKworCS8qIGFzc2VydCBJQiBwcmVlbXB0aW9uICov
CisJV1JFRzMyKHNkbWFfZ2Z4X3ByZWVtcHQsIDEpOworCisJLyogcG9sbCB0aGUgdHJhaWxpbmcg
ZmVuY2UgKi8KKwlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dXNlY190aW1lb3V0OyBpKyspIHsKKwkJ
aWYgKHJpbmctPnRyYWlsX3NlcSA9PQorCQkgICAgbGUzMl90b19jcHUoKihyaW5nLT50cmFpbF9m
ZW5jZV9jcHVfYWRkcikpKQorCQkJYnJlYWs7CisJCURSTV9VREVMQVkoMSk7CisJfQorCisJaWYg
KGkgPj0gYWRldi0+dXNlY190aW1lb3V0KSB7CisJCXIgPSAtRUlOVkFMOworCQlEUk1fRVJST1Io
InJpbmcgJWQgZmFpbGVkIHRvIGJlIHByZWVtcHRlZFxuIiwgcmluZy0+aWR4KTsKKwl9CisKKwkv
KiBkZWFzc2VydCBJQiBwcmVlbXB0aW9uICovCisJV1JFRzMyKHNkbWFfZ2Z4X3ByZWVtcHQsIDAp
OworCisJLyogZGVhc3NlcnQgdGhlIHByZWVtcHRpb24gY29uZGl0aW9uICovCisJYW1kZ3B1X3Jp
bmdfc2V0X3ByZWVtcHRfY29uZF9leGVjKHJpbmcsIHRydWUpOworCXJldHVybiByOworfQorCitz
dGF0aWMgaW50IHNkbWFfdjVfMF9zZXRfdHJhcF9pcnFfc3RhdGUoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsCisJCQkJCXN0cnVjdCBhbWRncHVfaXJxX3NyYyAqc291cmNlLAorCQkJCQl1bnNp
Z25lZCB0eXBlLAorCQkJCQllbnVtIGFtZGdwdV9pbnRlcnJ1cHRfc3RhdGUgc3RhdGUpCit7CisJ
dTMyIHNkbWFfY250bDsKKworCXUzMiByZWdfb2Zmc2V0ID0gKHR5cGUgPT0gQU1ER1BVX1NETUFf
SVJRX0lOU1RBTkNFMCkgPworCQlzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgMCwgbW1T
RE1BMF9DTlRMKSA6CisJCXNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCAxLCBtbVNETUEw
X0NOVEwpOworCisJc2RtYV9jbnRsID0gUlJFRzMyKHJlZ19vZmZzZXQpOworCXNkbWFfY250bCA9
IFJFR19TRVRfRklFTEQoc2RtYV9jbnRsLCBTRE1BMF9DTlRMLCBUUkFQX0VOQUJMRSwKKwkJICAg
ICAgIHN0YXRlID09IEFNREdQVV9JUlFfU1RBVEVfRU5BQkxFID8gMSA6IDApOworCVdSRUczMihy
ZWdfb2Zmc2V0LCBzZG1hX2NudGwpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgc2Rt
YV92NV8wX3Byb2Nlc3NfdHJhcF9pcnEoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJCQkJ
ICAgICAgc3RydWN0IGFtZGdwdV9pcnFfc3JjICpzb3VyY2UsCisJCQkJICAgICAgc3RydWN0IGFt
ZGdwdV9pdl9lbnRyeSAqZW50cnkpCit7CisJRFJNX0RFQlVHKCJJSDogU0RNQSB0cmFwXG4iKTsK
Kwlzd2l0Y2ggKGVudHJ5LT5jbGllbnRfaWQpIHsKKwljYXNlIFNPQzE1X0lIX0NMSUVOVElEX1NE
TUEwOgorCQlzd2l0Y2ggKGVudHJ5LT5yaW5nX2lkKSB7CisJCWNhc2UgMDoKKwkJCWFtZGdwdV9m
ZW5jZV9wcm9jZXNzKCZhZGV2LT5zZG1hLmluc3RhbmNlWzBdLnJpbmcpOworCQkJYnJlYWs7CisJ
CWNhc2UgMToKKwkJCS8qIFhYWCBjb21wdXRlICovCisJCQlicmVhazsKKwkJY2FzZSAyOgorCQkJ
LyogWFhYIGNvbXB1dGUgKi8KKwkJCWJyZWFrOworCQljYXNlIDM6CisJCQkvKiBYWFggcGFnZSBx
dWV1ZSovCisJCQlicmVhazsKKwkJfQorCQlicmVhazsKKwljYXNlIFNPQzE1X0lIX0NMSUVOVElE
X1NETUExOgorCQlzd2l0Y2ggKGVudHJ5LT5yaW5nX2lkKSB7CisJCWNhc2UgMDoKKwkJCWFtZGdw
dV9mZW5jZV9wcm9jZXNzKCZhZGV2LT5zZG1hLmluc3RhbmNlWzFdLnJpbmcpOworCQkJYnJlYWs7
CisJCWNhc2UgMToKKwkJCS8qIFhYWCBjb21wdXRlICovCisJCQlicmVhazsKKwkJY2FzZSAyOgor
CQkJLyogWFhYIGNvbXB1dGUgKi8KKwkJCWJyZWFrOworCQljYXNlIDM6CisJCQkvKiBYWFggcGFn
ZSBxdWV1ZSovCisJCQlicmVhazsKKwkJfQorCQlicmVhazsKKwl9CisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQgc2RtYV92NV8wX3Byb2Nlc3NfaWxsZWdhbF9pbnN0X2lycShzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKKwkJCQkJICAgICAgc3RydWN0IGFtZGdwdV9pcnFfc3JjICpzb3Vy
Y2UsCisJCQkJCSAgICAgIHN0cnVjdCBhbWRncHVfaXZfZW50cnkgKmVudHJ5KQoreworCXJldHVy
biAwOworfQorCitzdGF0aWMgdm9pZCBzZG1hX3Y1XzBfdXBkYXRlX21lZGl1bV9ncmFpbl9jbG9j
a19nYXRpbmcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJCQkJCQkgICAgICAgYm9vbCBl
bmFibGUpCit7CisJdWludDMyX3QgZGF0YSwgZGVmOworCWludCBpOworCisJZm9yIChpID0gMDsg
aSA8IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsgaSsrKSB7CisJCWlmIChlbmFibGUgJiYgKGFk
ZXYtPmNnX2ZsYWdzICYgQU1EX0NHX1NVUFBPUlRfU0RNQV9NR0NHKSkgeworCQkJLyogRW5hYmxl
IHNkbWEgY2xvY2sgZ2F0aW5nICovCisJCQlkZWYgPSBkYXRhID0gUlJFRzMyKHNkbWFfdjVfMF9n
ZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEwX0NMS19DVFJMKSk7CisJCQlkYXRhICY9IH4o
U0RNQTBfQ0xLX0NUUkxfX1NPRlRfT1ZFUlJJREU3X01BU0sgfAorCQkJCSAgU0RNQTBfQ0xLX0NU
UkxfX1NPRlRfT1ZFUlJJREU2X01BU0sgfAorCQkJCSAgU0RNQTBfQ0xLX0NUUkxfX1NPRlRfT1ZF
UlJJREU1X01BU0sgfAorCQkJCSAgU0RNQTBfQ0xLX0NUUkxfX1NPRlRfT1ZFUlJJREU0X01BU0sg
fAorCQkJCSAgU0RNQTBfQ0xLX0NUUkxfX1NPRlRfT1ZFUlJJREUzX01BU0sgfAorCQkJCSAgU0RN
QTBfQ0xLX0NUUkxfX1NPRlRfT1ZFUlJJREUyX01BU0sgfAorCQkJCSAgU0RNQTBfQ0xLX0NUUkxf
X1NPRlRfT1ZFUlJJREUxX01BU0sgfAorCQkJCSAgU0RNQTBfQ0xLX0NUUkxfX1NPRlRfT1ZFUlJJ
REUwX01BU0spOworCQkJaWYgKGRlZiAhPSBkYXRhKQorCQkJCVdSRUczMihzZG1hX3Y1XzBfZ2V0
X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9DTEtfQ1RSTCksIGRhdGEpOworCQl9IGVsc2Ug
eworCQkJLyogRGlzYWJsZSBzZG1hIGNsb2NrIGdhdGluZyAqLworCQkJZGVmID0gZGF0YSA9IFJS
RUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9DTEtfQ1RSTCkp
OworCQkJZGF0YSB8PSAoU0RNQTBfQ0xLX0NUUkxfX1NPRlRfT1ZFUlJJREU3X01BU0sgfAorCQkJ
CSBTRE1BMF9DTEtfQ1RSTF9fU09GVF9PVkVSUklERTZfTUFTSyB8CisJCQkJIFNETUEwX0NMS19D
VFJMX19TT0ZUX09WRVJSSURFNV9NQVNLIHwKKwkJCQkgU0RNQTBfQ0xLX0NUUkxfX1NPRlRfT1ZF
UlJJREU0X01BU0sgfAorCQkJCSBTRE1BMF9DTEtfQ1RSTF9fU09GVF9PVkVSUklERTNfTUFTSyB8
CisJCQkJIFNETUEwX0NMS19DVFJMX19TT0ZUX09WRVJSSURFMl9NQVNLIHwKKwkJCQkgU0RNQTBf
Q0xLX0NUUkxfX1NPRlRfT1ZFUlJJREUxX01BU0sgfAorCQkJCSBTRE1BMF9DTEtfQ1RSTF9fU09G
VF9PVkVSUklERTBfTUFTSyk7CisJCQlpZiAoZGVmICE9IGRhdGEpCisJCQkJV1JFRzMyKHNkbWFf
djVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNETUEwX0NMS19DVFJMKSwgZGF0YSk7CisJ
CX0KKwl9Cit9CisKK3N0YXRpYyB2b2lkIHNkbWFfdjVfMF91cGRhdGVfbWVkaXVtX2dyYWluX2xp
Z2h0X3NsZWVwKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAorCQkJCQkJICAgICAgYm9vbCBl
bmFibGUpCit7CisJdWludDMyX3QgZGF0YSwgZGVmOworCWludCBpOworCisJZm9yIChpID0gMDsg
aSA8IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsgaSsrKSB7CisJCWlmIChlbmFibGUgJiYgKGFk
ZXYtPmNnX2ZsYWdzICYgQU1EX0NHX1NVUFBPUlRfU0RNQV9MUykpIHsKKwkJCS8qIEVuYWJsZSBz
ZG1hIG1lbSBsaWdodCBzbGVlcCAqLworCQkJZGVmID0gZGF0YSA9IFJSRUczMihzZG1hX3Y1XzBf
Z2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1TRE1BMF9QT1dFUl9DTlRMKSk7CisJCQlkYXRhIHw9
IFNETUEwX1BPV0VSX0NOVExfX01FTV9QT1dFUl9PVkVSUklERV9NQVNLOworCQkJaWYgKGRlZiAh
PSBkYXRhKQorCQkJCVdSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgaSwgbW1T
RE1BMF9QT1dFUl9DTlRMKSwgZGF0YSk7CisKKwkJfSBlbHNlIHsKKwkJCS8qIERpc2FibGUgc2Rt
YSBtZW0gbGlnaHQgc2xlZXAgKi8KKwkJCWRlZiA9IGRhdGEgPSBSUkVHMzIoc2RtYV92NV8wX2dl
dF9yZWdfb2Zmc2V0KGFkZXYsIGksIG1tU0RNQTBfUE9XRVJfQ05UTCkpOworCQkJZGF0YSAmPSB+
U0RNQTBfUE9XRVJfQ05UTF9fTUVNX1BPV0VSX09WRVJSSURFX01BU0s7CisJCQlpZiAoZGVmICE9
IGRhdGEpCisJCQkJV1JFRzMyKHNkbWFfdjVfMF9nZXRfcmVnX29mZnNldChhZGV2LCBpLCBtbVNE
TUEwX1BPV0VSX0NOVEwpLCBkYXRhKTsKKworCQl9CisJfQorfQorCitzdGF0aWMgaW50IHNkbWFf
djVfMF9zZXRfY2xvY2tnYXRpbmdfc3RhdGUodm9pZCAqaGFuZGxlLAorCQkJCQkgICBlbnVtIGFt
ZF9jbG9ja2dhdGluZ19zdGF0ZSBzdGF0ZSkKK3sKKwlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
diA9IChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqKWhhbmRsZTsKKworCWlmIChhbWRncHVfc3Jpb3Zf
dmYoYWRldikpCisJCXJldHVybiAwOworCisJc3dpdGNoIChhZGV2LT5hc2ljX3R5cGUpIHsKKwlj
YXNlIENISVBfTkFWSTEwOgorCQlzZG1hX3Y1XzBfdXBkYXRlX21lZGl1bV9ncmFpbl9jbG9ja19n
YXRpbmcoYWRldiwKKwkJCQlzdGF0ZSA9PSBBTURfQ0dfU1RBVEVfR0FURSA/IHRydWUgOiBmYWxz
ZSk7CisJCXNkbWFfdjVfMF91cGRhdGVfbWVkaXVtX2dyYWluX2xpZ2h0X3NsZWVwKGFkZXYsCisJ
CQkJc3RhdGUgPT0gQU1EX0NHX1NUQVRFX0dBVEUgPyB0cnVlIDogZmFsc2UpOworCQlicmVhazsK
KwlkZWZhdWx0OgorCQlicmVhazsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBz
ZG1hX3Y1XzBfc2V0X3Bvd2VyZ2F0aW5nX3N0YXRlKHZvaWQgKmhhbmRsZSwKKwkJCQkJICBlbnVt
IGFtZF9wb3dlcmdhdGluZ19zdGF0ZSBzdGF0ZSkKK3sKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IHZvaWQgc2RtYV92NV8wX2dldF9jbG9ja2dhdGluZ19zdGF0ZSh2b2lkICpoYW5kbGUsIHUzMiAq
ZmxhZ3MpCit7CisJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSAoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKiloYW5kbGU7CisJaW50IGRhdGE7CisKKwlpZiAoYW1kZ3B1X3NyaW92X3ZmKGFkZXYp
KQorCQkqZmxhZ3MgPSAwOworCisJLyogQU1EX0NHX1NVUFBPUlRfU0RNQV9NR0NHICovCisJZGF0
YSA9IFJSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZzZXQoYWRldiwgMCwgbW1TRE1BMF9DTEtf
Q1RSTCkpOworCWlmICghKGRhdGEgJiBTRE1BMF9DTEtfQ1RSTF9fU09GVF9PVkVSUklERTdfTUFT
SykpCisJCSpmbGFncyB8PSBBTURfQ0dfU1VQUE9SVF9TRE1BX01HQ0c7CisKKwkvKiBBTURfQ0df
U1VQUE9SVF9TRE1BX0xTICovCisJZGF0YSA9IFJSRUczMihzZG1hX3Y1XzBfZ2V0X3JlZ19vZmZz
ZXQoYWRldiwgMCwgbW1TRE1BMF9QT1dFUl9DTlRMKSk7CisJaWYgKGRhdGEgJiBTRE1BMF9QT1dF
Ul9DTlRMX19NRU1fUE9XRVJfT1ZFUlJJREVfTUFTSykKKwkJKmZsYWdzIHw9IEFNRF9DR19TVVBQ
T1JUX1NETUFfTFM7Cit9CisKK2NvbnN0IHN0cnVjdCBhbWRfaXBfZnVuY3Mgc2RtYV92NV8wX2lw
X2Z1bmNzID0geworCS5uYW1lID0gInNkbWFfdjVfMCIsCisJLmVhcmx5X2luaXQgPSBzZG1hX3Y1
XzBfZWFybHlfaW5pdCwKKwkubGF0ZV9pbml0ID0gTlVMTCwKKwkuc3dfaW5pdCA9IHNkbWFfdjVf
MF9zd19pbml0LAorCS5zd19maW5pID0gc2RtYV92NV8wX3N3X2ZpbmksCisJLmh3X2luaXQgPSBz
ZG1hX3Y1XzBfaHdfaW5pdCwKKwkuaHdfZmluaSA9IHNkbWFfdjVfMF9od19maW5pLAorCS5zdXNw
ZW5kID0gc2RtYV92NV8wX3N1c3BlbmQsCisJLnJlc3VtZSA9IHNkbWFfdjVfMF9yZXN1bWUsCisJ
LmlzX2lkbGUgPSBzZG1hX3Y1XzBfaXNfaWRsZSwKKwkud2FpdF9mb3JfaWRsZSA9IHNkbWFfdjVf
MF93YWl0X2Zvcl9pZGxlLAorCS5zb2Z0X3Jlc2V0ID0gc2RtYV92NV8wX3NvZnRfcmVzZXQsCisJ
LnNldF9jbG9ja2dhdGluZ19zdGF0ZSA9IHNkbWFfdjVfMF9zZXRfY2xvY2tnYXRpbmdfc3RhdGUs
CisJLnNldF9wb3dlcmdhdGluZ19zdGF0ZSA9IHNkbWFfdjVfMF9zZXRfcG93ZXJnYXRpbmdfc3Rh
dGUsCisJLmdldF9jbG9ja2dhdGluZ19zdGF0ZSA9IHNkbWFfdjVfMF9nZXRfY2xvY2tnYXRpbmdf
c3RhdGUsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGFtZGdwdV9yaW5nX2Z1bmNzIHNkbWFf
djVfMF9yaW5nX2Z1bmNzID0geworCS50eXBlID0gQU1ER1BVX1JJTkdfVFlQRV9TRE1BLAorCS5h
bGlnbl9tYXNrID0gMHhmLAorCS5ub3AgPSBTRE1BX1BLVF9OT1BfSEVBREVSX09QKFNETUFfT1Bf
Tk9QKSwKKwkuc3VwcG9ydF82NGJpdF9wdHJzID0gdHJ1ZSwKKwkudm1odWIgPSBBTURHUFVfR0ZY
SFVCLAorCS5nZXRfcnB0ciA9IHNkbWFfdjVfMF9yaW5nX2dldF9ycHRyLAorCS5nZXRfd3B0ciA9
IHNkbWFfdjVfMF9yaW5nX2dldF93cHRyLAorCS5zZXRfd3B0ciA9IHNkbWFfdjVfMF9yaW5nX3Nl
dF93cHRyLAorCS5lbWl0X2ZyYW1lX3NpemUgPQorCQk1ICsgLyogc2RtYV92NV8wX3JpbmdfaW5p
dF9jb25kX2V4ZWMgKi8KKwkJNiArIC8qIHNkbWFfdjVfMF9yaW5nX2VtaXRfaGRwX2ZsdXNoICov
CisJCTMgKyAvKiBoZHBfaW52YWxpZGF0ZSAqLworCQk2ICsgLyogc2RtYV92NV8wX3JpbmdfZW1p
dF9waXBlbGluZV9zeW5jICovCisJCS8qIHNkbWFfdjVfMF9yaW5nX2VtaXRfdm1fZmx1c2ggKi8K
KwkJU09DMTVfRkxVU0hfR1BVX1RMQl9OVU1fV1JFRyAqIDMgKworCQlTT0MxNV9GTFVTSF9HUFVf
VExCX05VTV9SRUdfV0FJVCAqIDYgKworCQkxMCArIDEwICsgMTAsIC8qIHNkbWFfdjVfMF9yaW5n
X2VtaXRfZmVuY2UgeDMgZm9yIHVzZXIgZmVuY2UsIHZtIGZlbmNlICovCisJLmVtaXRfaWJfc2l6
ZSA9IDcgKyA2LCAvKiBzZG1hX3Y1XzBfcmluZ19lbWl0X2liICovCisJLmVtaXRfaWIgPSBzZG1h
X3Y1XzBfcmluZ19lbWl0X2liLAorCS5lbWl0X2ZlbmNlID0gc2RtYV92NV8wX3JpbmdfZW1pdF9m
ZW5jZSwKKwkuZW1pdF9waXBlbGluZV9zeW5jID0gc2RtYV92NV8wX3JpbmdfZW1pdF9waXBlbGlu
ZV9zeW5jLAorCS5lbWl0X3ZtX2ZsdXNoID0gc2RtYV92NV8wX3JpbmdfZW1pdF92bV9mbHVzaCwK
KwkuZW1pdF9oZHBfZmx1c2ggPSBzZG1hX3Y1XzBfcmluZ19lbWl0X2hkcF9mbHVzaCwKKwkudGVz
dF9yaW5nID0gc2RtYV92NV8wX3JpbmdfdGVzdF9yaW5nLAorCS50ZXN0X2liID0gc2RtYV92NV8w
X3JpbmdfdGVzdF9pYiwKKwkuaW5zZXJ0X25vcCA9IHNkbWFfdjVfMF9yaW5nX2luc2VydF9ub3As
CisJLnBhZF9pYiA9IHNkbWFfdjVfMF9yaW5nX3BhZF9pYiwKKwkuZW1pdF93cmVnID0gc2RtYV92
NV8wX3JpbmdfZW1pdF93cmVnLAorCS5lbWl0X3JlZ193YWl0ID0gc2RtYV92NV8wX3JpbmdfZW1p
dF9yZWdfd2FpdCwKKwkuaW5pdF9jb25kX2V4ZWMgPSBzZG1hX3Y1XzBfcmluZ19pbml0X2NvbmRf
ZXhlYywKKwkucGF0Y2hfY29uZF9leGVjID0gc2RtYV92NV8wX3JpbmdfcGF0Y2hfY29uZF9leGVj
LAorCS5wcmVlbXB0X2liID0gc2RtYV92NV8wX3JpbmdfcHJlZW1wdF9pYiwKK307CisKK3N0YXRp
YyB2b2lkIHNkbWFfdjVfMF9zZXRfcmluZ19mdW5jcyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRl
dikKK3sKKwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBhZGV2LT5zZG1hLm51bV9pbnN0YW5j
ZXM7IGkrKykgeworCQlhZGV2LT5zZG1hLmluc3RhbmNlW2ldLnJpbmcuZnVuY3MgPSAmc2RtYV92
NV8wX3JpbmdfZnVuY3M7CisJCWFkZXYtPnNkbWEuaW5zdGFuY2VbaV0ucmluZy5tZSA9IGk7CisJ
fQorfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGFtZGdwdV9pcnFfc3JjX2Z1bmNzIHNkbWFfdjVf
MF90cmFwX2lycV9mdW5jcyA9IHsKKwkuc2V0ID0gc2RtYV92NV8wX3NldF90cmFwX2lycV9zdGF0
ZSwKKwkucHJvY2VzcyA9IHNkbWFfdjVfMF9wcm9jZXNzX3RyYXBfaXJxLAorfTsKKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBhbWRncHVfaXJxX3NyY19mdW5jcyBzZG1hX3Y1XzBfaWxsZWdhbF9pbnN0
X2lycV9mdW5jcyA9IHsKKwkucHJvY2VzcyA9IHNkbWFfdjVfMF9wcm9jZXNzX2lsbGVnYWxfaW5z
dF9pcnEsCit9OworCitzdGF0aWMgdm9pZCBzZG1hX3Y1XzBfc2V0X2lycV9mdW5jcyhzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldikKK3sKKwlhZGV2LT5zZG1hLnRyYXBfaXJxLm51bV90eXBlcyA9
IEFNREdQVV9TRE1BX0lSUV9MQVNUOworCWFkZXYtPnNkbWEudHJhcF9pcnEuZnVuY3MgPSAmc2Rt
YV92NV8wX3RyYXBfaXJxX2Z1bmNzOworCWFkZXYtPnNkbWEuaWxsZWdhbF9pbnN0X2lycS5mdW5j
cyA9ICZzZG1hX3Y1XzBfaWxsZWdhbF9pbnN0X2lycV9mdW5jczsKK30KKworLyoqCisgKiBzZG1h
X3Y1XzBfZW1pdF9jb3B5X2J1ZmZlciAtIGNvcHkgYnVmZmVyIHVzaW5nIHRoZSBzRE1BIGVuZ2lu
ZQorICoKKyAqIEByaW5nOiBhbWRncHVfcmluZyBzdHJ1Y3R1cmUgaG9sZGluZyByaW5nIGluZm9y
bWF0aW9uCisgKiBAc3JjX29mZnNldDogc3JjIEdQVSBhZGRyZXNzCisgKiBAZHN0X29mZnNldDog
ZHN0IEdQVSBhZGRyZXNzCisgKiBAYnl0ZV9jb3VudDogbnVtYmVyIG9mIGJ5dGVzIHRvIHhmZXIK
KyAqCisgKiBDb3B5IEdQVSBidWZmZXJzIHVzaW5nIHRoZSBETUEgZW5naW5lIChOQVZJMTApLgor
ICogVXNlZCBieSB0aGUgYW1kZ3B1IHR0bSBpbXBsZW1lbnRhdGlvbiB0byBtb3ZlIHBhZ2VzIGlm
CisgKiByZWdpc3RlcmVkIGFzIHRoZSBhc2ljIGNvcHkgY2FsbGJhY2suCisgKi8KK3N0YXRpYyB2
b2lkIHNkbWFfdjVfMF9lbWl0X2NvcHlfYnVmZmVyKHN0cnVjdCBhbWRncHVfaWIgKmliLAorCQkJ
CSAgICAgICB1aW50NjRfdCBzcmNfb2Zmc2V0LAorCQkJCSAgICAgICB1aW50NjRfdCBkc3Rfb2Zm
c2V0LAorCQkJCSAgICAgICB1aW50MzJfdCBieXRlX2NvdW50KQoreworCWliLT5wdHJbaWItPmxl
bmd0aF9kdysrXSA9IFNETUFfUEtUX0hFQURFUl9PUChTRE1BX09QX0NPUFkpIHwKKwkJU0RNQV9Q
S1RfSEVBREVSX1NVQl9PUChTRE1BX1NVQk9QX0NPUFlfTElORUFSKTsKKwlpYi0+cHRyW2liLT5s
ZW5ndGhfZHcrK10gPSBieXRlX2NvdW50IC0gMTsKKwlpYi0+cHRyW2liLT5sZW5ndGhfZHcrK10g
PSAwOyAvKiBzcmMvZHN0IGVuZGlhbiBzd2FwICovCisJaWItPnB0cltpYi0+bGVuZ3RoX2R3Kytd
ID0gbG93ZXJfMzJfYml0cyhzcmNfb2Zmc2V0KTsKKwlpYi0+cHRyW2liLT5sZW5ndGhfZHcrK10g
PSB1cHBlcl8zMl9iaXRzKHNyY19vZmZzZXQpOworCWliLT5wdHJbaWItPmxlbmd0aF9kdysrXSA9
IGxvd2VyXzMyX2JpdHMoZHN0X29mZnNldCk7CisJaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0g
dXBwZXJfMzJfYml0cyhkc3Rfb2Zmc2V0KTsKK30KKworLyoqCisgKiBzZG1hX3Y1XzBfZW1pdF9m
aWxsX2J1ZmZlciAtIGZpbGwgYnVmZmVyIHVzaW5nIHRoZSBzRE1BIGVuZ2luZQorICoKKyAqIEBy
aW5nOiBhbWRncHVfcmluZyBzdHJ1Y3R1cmUgaG9sZGluZyByaW5nIGluZm9ybWF0aW9uCisgKiBA
c3JjX2RhdGE6IHZhbHVlIHRvIHdyaXRlIHRvIGJ1ZmZlcgorICogQGRzdF9vZmZzZXQ6IGRzdCBH
UFUgYWRkcmVzcworICogQGJ5dGVfY291bnQ6IG51bWJlciBvZiBieXRlcyB0byB4ZmVyCisgKgor
ICogRmlsbCBHUFUgYnVmZmVycyB1c2luZyB0aGUgRE1BIGVuZ2luZSAoTkFWSTEwKS4KKyAqLwor
c3RhdGljIHZvaWQgc2RtYV92NV8wX2VtaXRfZmlsbF9idWZmZXIoc3RydWN0IGFtZGdwdV9pYiAq
aWIsCisJCQkJICAgICAgIHVpbnQzMl90IHNyY19kYXRhLAorCQkJCSAgICAgICB1aW50NjRfdCBk
c3Rfb2Zmc2V0LAorCQkJCSAgICAgICB1aW50MzJfdCBieXRlX2NvdW50KQoreworCWliLT5wdHJb
aWItPmxlbmd0aF9kdysrXSA9IFNETUFfUEtUX0hFQURFUl9PUChTRE1BX09QX0NPTlNUX0ZJTEwp
OworCWliLT5wdHJbaWItPmxlbmd0aF9kdysrXSA9IGxvd2VyXzMyX2JpdHMoZHN0X29mZnNldCk7
CisJaWItPnB0cltpYi0+bGVuZ3RoX2R3KytdID0gdXBwZXJfMzJfYml0cyhkc3Rfb2Zmc2V0KTsK
KwlpYi0+cHRyW2liLT5sZW5ndGhfZHcrK10gPSBzcmNfZGF0YTsKKwlpYi0+cHRyW2liLT5sZW5n
dGhfZHcrK10gPSBieXRlX2NvdW50IC0gMTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBhbWRn
cHVfYnVmZmVyX2Z1bmNzIHNkbWFfdjVfMF9idWZmZXJfZnVuY3MgPSB7CisJLmNvcHlfbWF4X2J5
dGVzID0gMHg0MDAwMDAsCisJLmNvcHlfbnVtX2R3ID0gNywKKwkuZW1pdF9jb3B5X2J1ZmZlciA9
IHNkbWFfdjVfMF9lbWl0X2NvcHlfYnVmZmVyLAorCisJLmZpbGxfbWF4X2J5dGVzID0gMHg0MDAw
MDAsCisJLmZpbGxfbnVtX2R3ID0gNSwKKwkuZW1pdF9maWxsX2J1ZmZlciA9IHNkbWFfdjVfMF9l
bWl0X2ZpbGxfYnVmZmVyLAorfTsKKworc3RhdGljIHZvaWQgc2RtYV92NV8wX3NldF9idWZmZXJf
ZnVuY3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCit7CisJaWYgKGFkZXYtPm1tYW4uYnVm
ZmVyX2Z1bmNzID09IE5VTEwpIHsKKwkJYWRldi0+bW1hbi5idWZmZXJfZnVuY3MgPSAmc2RtYV92
NV8wX2J1ZmZlcl9mdW5jczsKKwkJYWRldi0+bW1hbi5idWZmZXJfZnVuY3NfcmluZyA9ICZhZGV2
LT5zZG1hLmluc3RhbmNlWzBdLnJpbmc7CisJfQorfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGFt
ZGdwdV92bV9wdGVfZnVuY3Mgc2RtYV92NV8wX3ZtX3B0ZV9mdW5jcyA9IHsKKwkuY29weV9wdGVf
bnVtX2R3ID0gNywKKwkuY29weV9wdGUgPSBzZG1hX3Y1XzBfdm1fY29weV9wdGUsCisJLndyaXRl
X3B0ZSA9IHNkbWFfdjVfMF92bV93cml0ZV9wdGUsCisJLnNldF9wdGVfcGRlID0gc2RtYV92NV8w
X3ZtX3NldF9wdGVfcGRlLAorfTsKKworc3RhdGljIHZvaWQgc2RtYV92NV8wX3NldF92bV9wdGVf
ZnVuY3Moc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCit7CisJc3RydWN0IGRybV9ncHVfc2No
ZWR1bGVyICpzY2hlZDsKKwl1bnNpZ25lZCBpOworCisJaWYgKGFkZXYtPnZtX21hbmFnZXIudm1f
cHRlX2Z1bmNzID09IE5VTEwpIHsKKwkJYWRldi0+dm1fbWFuYWdlci52bV9wdGVfZnVuY3MgPSAm
c2RtYV92NV8wX3ZtX3B0ZV9mdW5jczsKKwkJZm9yIChpID0gMDsgaSA8IGFkZXYtPnNkbWEubnVt
X2luc3RhbmNlczsgaSsrKSB7CisJCQlzY2hlZCA9ICZhZGV2LT5zZG1hLmluc3RhbmNlW2ldLnJp
bmcuc2NoZWQ7CisJCQlhZGV2LT52bV9tYW5hZ2VyLnZtX3B0ZV9ycXNbaV0gPQorCQkJCSZzY2hl
ZC0+c2NoZWRfcnFbRFJNX1NDSEVEX1BSSU9SSVRZX0tFUk5FTF07CisJCX0KKwkJYWRldi0+dm1f
bWFuYWdlci52bV9wdGVfbnVtX3JxcyA9IGFkZXYtPnNkbWEubnVtX2luc3RhbmNlczsKKwl9Cit9
CisKK2NvbnN0IHN0cnVjdCBhbWRncHVfaXBfYmxvY2tfdmVyc2lvbiBzZG1hX3Y1XzBfaXBfYmxv
Y2sgPSB7CisJLnR5cGUgPSBBTURfSVBfQkxPQ0tfVFlQRV9TRE1BLAorCS5tYWpvciA9IDUsCisJ
Lm1pbm9yID0gMCwKKwkucmV2ID0gMCwKKwkuZnVuY3MgPSAmc2RtYV92NV8wX2lwX2Z1bmNzLAor
fTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NkbWFfdjVfMC5oIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2RtYV92NV8wLmgKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5kNWE5NGUzZDE4MWMKLS0tIC9kZXYvbnVsbAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zZG1hX3Y1XzAuaApAQCAtMCwwICsxLDQ1IEBACisv
KgorICogQ29weXJpZ2h0IDIwMTkgQWR2YW5jZWQgTWljcm8gRGV2aWNlcywgSW5jLgorICoKKyAq
IFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVy
c29uIG9idGFpbmluZyBhCisgKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQg
ZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUg
U29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlv
bgorICogdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRp
c3RyaWJ1dGUsIHN1YmxpY2Vuc2UsCisgKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3
YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1
cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Cisg
KgorICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3Rp
Y2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KKyAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9y
dGlvbnMgb2YgdGhlIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAi
QVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisgKiBJTVBM
SUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNI
QU5UQUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05J
TkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAorICogVEhFIENPUFlSSUdIVCBIT0xERVIo
UykgT1IgQVVUSE9SKFMpIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SCisgKiBP
VEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9S
IE9USEVSV0lTRSwKKyAqIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lU
SCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUgorICogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNP
RlRXQVJFLgorICoKKyAqLworCisjaWZuZGVmIF9fU0RNQV9WNV8wX0hfXworI2RlZmluZSBfX1NE
TUFfVjVfMF9IX18KKworZW51bSBzZG1hX3Y1XzBfdXRjbDJfY2FjaGVfcmVhZF9wb2xpY3kgewor
CUNBQ0hFX1JFQURfUE9MSUNZX0wyX19MUlUgICAgPSAweDAwMDAwMDAwLAorCUNBQ0hFX1JFQURf
UE9MSUNZX0wyX19TVFJFQU0gPSAweDAwMDAwMDAxLAorCUNBQ0hFX1JFQURfUE9MSUNZX0wyX19O
T0EgICAgPSAweDAwMDAwMDAyLAorCUNBQ0hFX1JFQURfUE9MSUNZX0wyX19ERUZBVUxUID0gQ0FD
SEVfUkVBRF9QT0xJQ1lfTDJfX05PQSwKK307CisKK2VudW0gc2RtYV92NV8wX3V0Y2wyX2NhY2hl
X3dyaXRlX3BvbGljeSB7CisJQ0FDSEVfV1JJVEVfUE9MSUNZX0wyX19MUlUgICAgPSAweDAwMDAw
MDAwLAorCUNBQ0hFX1dSSVRFX1BPTElDWV9MMl9fU1RSRUFNID0gMHgwMDAwMDAwMSwKKwlDQUNI
RV9XUklURV9QT0xJQ1lfTDJfX05PQSAgICA9IDB4MDAwMDAwMDIsCisJQ0FDSEVfV1JJVEVfUE9M
SUNZX0wyX19CWVBBU1MgPSAweDAwMDAwMDAzLAorCUNBQ0hFX1dSSVRFX1BPTElDWV9MMl9fREVG
QVVMVCA9IENBQ0hFX1dSSVRFX1BPTElDWV9MMl9fQllQQVNTLAorfTsKKworZXh0ZXJuIGNvbnN0
IHN0cnVjdCBhbWRfaXBfZnVuY3Mgc2RtYV92NV8wX2lwX2Z1bmNzOworZXh0ZXJuIGNvbnN0IHN0
cnVjdCBhbWRncHVfaXBfYmxvY2tfdmVyc2lvbiBzZG1hX3Y1XzBfaXBfYmxvY2s7CisKKyNlbmRp
ZiAvKiBfX1NETUFfVjVfMF9IX18gKi8KLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9hbWQtZ2Z4
