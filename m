Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A09221055FC
	for <lists+amd-gfx@lfdr.de>; Thu, 21 Nov 2019 16:47:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 314BB6F40A;
	Thu, 21 Nov 2019 15:47:41 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr770059.outbound.protection.outlook.com [40.107.77.59])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 90AEC6F3D0
 for <amd-gfx@lists.freedesktop.org>; Thu, 21 Nov 2019 15:47:39 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=Ox3UbfKMso5dDIIYYHgvrflIT/qNepb0JFl16ZVMWDatvxJzmKhG1N+u2KPEO2Hakwpi7d5OJ6MCdZdmze4X+VEDF5qPmiV2TsM8+ge6sXIPyOGx1Kf8Q/fbsTAyRVuZ7cE9vyekVsxfrvACc79naxnKE6LA1+oGHle5Eu8NYggvVt4Epf0J+Sdrk1vOjF30NtV9sQwiR9ls+gtL+Saefzge9ssNe5xFdNLNyvkds4vnAsdwf0tVRUAzEA3GpKCyWvrgoetH3SpglQBCm/mXVkUZ4sxZ5wiROAbQL+uJQDk/Q/+z8hrXYQLLsq/78c06O8y0GF1LylRpUUkCS3I8xg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=06ROjdFKjWiokvq+PJMWB0wfC6Gn7si72aRzaIOOlLg=;
 b=Y7YbPVo5Qqo9+sp38KAy0O0S7RB9yd/durQJJZMhIXeHK734g0vwd2HM+5TdtZr5O9waPVvh5BcdhqkIwwdKI1djHaSJHDFVUUUbJsLo1oDzYlj84Xgm2DWLeyY1Bb45H5rVPa4wsPJuV6APXenby2J4kMT9JBylYcy/EqC6auy1EB0Lr1JABaAgorFKPYTfsvLX96HfqrWfJ3a7CJR3SIrVxy1JXUL0B3i+ANx+tE22yp6hWQIa/8v/dwaQGiuPuxbnUYwTQGL/EATZqbpnvR0Q0CYGc37jOPiPjwBWea2lgaIuhTNjds12vd4eewAv6UglNnXno7fLXGQjnfG8kg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=amd.com; dmarc=pass action=none header.from=amd.com; dkim=pass
 header.d=amd.com; arc=none
Received: from MN2PR12MB2896.namprd12.prod.outlook.com (20.179.80.214) by
 MN2PR12MB3981.namprd12.prod.outlook.com (10.255.237.24) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2474.16; Thu, 21 Nov 2019 15:47:37 +0000
Received: from MN2PR12MB2896.namprd12.prod.outlook.com
 ([fe80::9821:4373:684f:f580]) by MN2PR12MB2896.namprd12.prod.outlook.com
 ([fe80::9821:4373:684f:f580%6]) with mapi id 15.20.2451.031; Thu, 21 Nov 2019
 15:47:37 +0000
From: "Changfeng.Zhu" <changfeng.zhu@amd.com>
To: Christian.Koenig@amd.com, Jack.Xiao@amd.com, Tao.Zhou1@amd.com,
 Ray.Huang@amd.com, Xinmei.Huang@amd.com, amd-gfx@lists.freedesktop.org
Subject: [PATCH] drm/amdgpu: invalidate mmhub semphore workaround in gmc9/gmc10
Date: Thu, 21 Nov 2019 23:47:15 +0800
Message-Id: <20191121154715.19874-1-changfeng.zhu@amd.com>
X-Mailer: git-send-email 2.17.1
X-ClientProxiedBy: HK2PR02CA0173.apcprd02.prod.outlook.com
 (2603:1096:201:1f::33) To MN2PR12MB2896.namprd12.prod.outlook.com
 (2603:10b6:208:ab::22)
MIME-Version: 1.0
X-Mailer: git-send-email 2.17.1
X-Originating-IP: [180.167.199.189]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-HT: Tenant
X-MS-Office365-Filtering-Correlation-Id: f7012814-6dd5-41bd-675b-08d76e9a222a
X-MS-TrafficTypeDiagnostic: MN2PR12MB3981:|MN2PR12MB3981:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <MN2PR12MB3981F6121D08CB77B598BB63FD4E0@MN2PR12MB3981.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:6108;
X-Forefront-PRVS: 0228DDDDD7
X-Forefront-Antispam-Report: SFV:NSPM;
 SFS:(10009020)(4636009)(39860400002)(396003)(376002)(346002)(136003)(366004)(199004)(189003)(16586007)(8676002)(81156014)(81166006)(4326008)(8936002)(50226002)(2906002)(6486002)(7736002)(316002)(6506007)(51416003)(6116002)(5660300002)(66556008)(186003)(66946007)(66476007)(86362001)(52116002)(3846002)(14444005)(386003)(26005)(99286004)(47776003)(1076003)(6666004)(478600001)(14454004)(50466002)(48376002)(6436002)(305945005)(36756003)(2616005)(66066001)(6512007)(25786009);
 DIR:OUT; SFP:1101; SCL:1; SRVR:MN2PR12MB3981;
 H:MN2PR12MB2896.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: VVAaZBfd1FjYs4YuLKGyu+XOPsYc4yaV7a0zYGseSx+sE02frVp2+WKyCwvzTwidnjdkFzxy14XYa/pOeQC4SXPFB+CBX/MQyJ02gZmGrYCHyg/IGYIqmNiF/fORuDNSsZRZeFXtj82xZ+oB6DgsrTK296TJNR1rDYN6X74pEHD7ea8BpotzXtlg+4QCCdsKI5XROoqTRS6K7nXDPHohrcySrKr8oAIH4UBAO+IjwjRALpjh8Q4P0oVgZiNj183YiKQuihMK18zG05/jGfVNw9MctoKRXa51HNGDUHMi3vzOOv1nhAhwovhy0aFxEtVvh3sPmrllrXM9wDvLRqHCkDLFXBF1u0mMfD87ne8fKluHcAzdZuV/LpV7ySUdwfgICN+Emru2R+mcSBl7S3WRFHCyqtFG9UH2wbyvVzqweeZLurqhjkdZbyLJdOgeGfsI
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: f7012814-6dd5-41bd-675b-08d76e9a222a
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 21 Nov 2019 15:47:37.6326 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: ah7rZ9yQw3QowB40BwDjjecGN0cuuxMSLTMobO6TnnkgSLQVOPsTZk2Xiuj0AVnjsSTB2cZr2AKZjPyZ+I/CLw==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MN2PR12MB3981
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=06ROjdFKjWiokvq+PJMWB0wfC6Gn7si72aRzaIOOlLg=;
 b=LtxNqkE+ME+kmagk0swDwFA+XXQ9e7jj+Cqju7WyPWOhdPe295CUYIgj5sEnYdhiwPZ6asLEl90Y5XSLQvnBv4ahdqQqwO5+1R+KqxXeaCL2S1TNwzNk4VVZhQqI/5NdiQinWMs0ytJS0eukPyX12+fj41hNrnLgixbQGS+nicM=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Changfeng.Zhu@amd.com; 
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: changzhu <Changfeng.Zhu@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogY2hhbmd6aHUgPENoYW5nZmVuZy5aaHVAYW1kLmNvbT4KCkl0IG1heSBsb3NlIGdwdXZt
IGludmFsaWRhdGUgYWNrbm93bGRlZ2Ugc3RhdGUgYWNyb3NzIHBvd2VyLWdhdGluZyBvZmYKY3lj
bGUuIFRvIGF2b2lkIHRoaXMgaXNzdWUgaW4gZ21jOS9nbWMxMCBpbnZhbGlkYXRpb24sIGFkZCBz
ZW1hcGhvcmUgYWNxdWlyZQpiZWZvcmUgaW52YWxpZGF0aW9uIGFuZCBzZW1hcGhvcmUgcmVsZWFz
ZSBhZnRlciBpbnZhbGlkYXRpb24uCgpBZnRlciBhZGRpbmcgc2VtYXBob3JlIGFjcXVpcmUgYmVm
b3JlIGludmFsaWRhdGlvbiwgdGhlIHNlbWFwaG9yZQpyZWdpc3RlciBiZWNvbWUgcmVhZC1vbmx5
IGlmIGFub3RoZXIgcHJvY2VzcyB0cnkgdG8gYWNxdWlyZSBzZW1hcGhvcmUuClRoZW4gaXQgd2ls
bCBub3QgYmUgYWJsZSB0byByZWxlYXNlIHRoaXMgc2VtYXBob3JlLiBUaGVuIGl0IG1heSBjYXVz
ZQpkZWFkbG9jayBwcm9ibGVtLiBJZiB0aGlzIGRlYWRsb2NrIHByb2JsZW0gaGFwcGVucywgaXQg
bmVlZHMgYSBzZW1hcGhvcmUKZmlybXdhcmUgZml4LgoKQ2hhbmdlLUlkOiBJOTk0MmEyZjQ1MTI2
NWMxZjEwMzhjY2ZlMmY3MDA0MmM3YzgxMThhZgpTaWduZWQtb2ZmLWJ5OiBjaGFuZ3podSA8Q2hh
bmdmZW5nLlpodUBhbWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192
MTBfMC5jIHwgNTIgKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2dtY192OV8wLmMgIHwgNTIgKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NvYzE1LmggICAgIHwgIDQgKy0KIDMgZmlsZXMgY2hh
bmdlZCwgMTA2IGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3YxMF8wLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9nbWNfdjEwXzAuYwppbmRleCBhZjI2MTViYTUyYWEuLmUwMTA0Yjk4NWM0MiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3YxMF8wLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3YxMF8wLmMKQEAgLTIzNCw2ICsyMzQsMjcgQEAg
c3RhdGljIHZvaWQgZ21jX3YxMF8wX2ZsdXNoX3ZtX2h1YihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiwgdWludDMyX3Qgdm1pZCwKIAljb25zdCB1bnNpZ25lZCBlbmcgPSAxNzsKIAl1bnNpZ25l
ZCBpbnQgaTsKIAorCXNwaW5fbG9jaygmYWRldi0+Z21jLmludmFsaWRhdGVfbG9jayk7CisJLyoK
KwkgKiBJdCBtYXkgbG9zZSBncHV2bSBpbnZhbGlkYXRlIGFja25vd2xkZWdlIHN0YXRlIGFjcm9z
cyBwb3dlci1nYXRpbmcKKwkgKiBvZmYgY3ljbGUsIGFkZCBzZW1hcGhvcmUgYWNxdWlyZSBiZWZv
cmUgaW52YWxpZGF0aW9uIGFuZCBzZW1hcGhvcmUKKwkgKiByZWxlYXNlIGFmdGVyIGludmFsaWRh
dGlvbiB0byBhdm9pZCBlbnRlcmluZyBwb3dlciBnYXRlZCBzdGF0ZQorCSAqIHRvIFdBIHRoZSBJ
c3N1ZQorCSAqLworCWlmICh2bWh1YiA9PSBBTURHUFVfTU1IVUJfMCB8fAorCSAgICB2bWh1YiA9
PSBBTURHUFVfTU1IVUJfMSkgeworCQlmb3IgKGkgPSAwOyBpIDwgYWRldi0+dXNlY190aW1lb3V0
OyBpKyspIHsKKwkJCS8qIGEgcmVhZCByZXR1cm4gdmFsdWUgb2YgMSBtZWFucyBzZW1hcGhvcmUg
YWN1cWlyZSAqLworCQkJdG1wID0gUlJFRzMyX05PX0tJUShodWItPnZtX2ludl9lbmcwX3NlbSAr
IGVuZyk7CisJCQlpZiAodG1wICYgMHgxKQorCQkJCWJyZWFrOworCQkJdWRlbGF5KDEpOworCQl9
CisKKwkJaWYgKGkgPj0gYWRldi0+dXNlY190aW1lb3V0KQorCQkJRFJNX0VSUk9SKCJUaW1lb3V0
IHdhaXRpbmcgZm9yIHNlbSBhY3F1aXJlIGluIFZNIGZsdXNoIVxuIik7CisJfQorCiAJV1JFRzMy
X05PX0tJUShodWItPnZtX2ludl9lbmcwX3JlcSArIGVuZywgdG1wKTsKIAogCS8qCkBAIC0yNTMs
NiArMjc0LDE2IEBAIHN0YXRpYyB2b2lkIGdtY192MTBfMF9mbHVzaF92bV9odWIoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IHZtaWQsCiAJCXVkZWxheSgxKTsKIAl9CiAKKwkv
KgorCSAqIGFkZCBzZW1hcGhvcmUgcmVsZWFzZSBhZnRlciBpbnZhbGlkYXRpb24sCisJICogd3Jp
dGUgd2l0aCAwIG1lYW5zIHNlbWFwaG9yZSByZWxlYXNlCisJICovCisJaWYgKHZtaHViID09IEFN
REdQVV9NTUhVQl8wIHx8CisJICAgIHZtaHViID09IEFNREdQVV9NTUhVQl8xKQorCQlXUkVHMzJf
Tk9fS0lRKGh1Yi0+dm1faW52X2VuZzBfc2VtICsgZW5nLCAwKTsKKworCXNwaW5fdW5sb2NrKCZh
ZGV2LT5nbWMuaW52YWxpZGF0ZV9sb2NrKTsKKwogCWlmIChpIDwgYWRldi0+dXNlY190aW1lb3V0
KQogCQlyZXR1cm47CiAKQEAgLTMzOCw2ICszNjksMTkgQEAgc3RhdGljIHVpbnQ2NF90IGdtY192
MTBfMF9lbWl0X2ZsdXNoX2dwdV90bGIoc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLAogCXVpbnQz
Ml90IHJlcSA9IGdtY192MTBfMF9nZXRfaW52YWxpZGF0ZV9yZXEodm1pZCwgMCk7CiAJdW5zaWdu
ZWQgZW5nID0gcmluZy0+dm1faW52X2VuZzsKIAorCS8qCisJICogSXQgbWF5IGxvc2UgZ3B1dm0g
aW52YWxpZGF0ZSBhY2tub3dsZGVnZSBzdGF0ZSBhY3Jvc3MgcG93ZXItZ2F0aW5nCisJICogb2Zm
IGN5Y2xlLCBhZGQgc2VtYXBob3JlIGFjcXVpcmUgYmVmb3JlIGludmFsaWRhdGlvbiBhbmQgc2Vt
YXBob3JlCisJICogcmVsZWFzZSBhZnRlciBpbnZhbGlkYXRpb24gdG8gYXZvaWQgZW50ZXJpbmcg
cG93ZXIgZ2F0ZWQgc3RhdGUKKwkgKiB0byBXQSB0aGUgSXNzdWUKKwkgKi8KKworCS8qIGEgcmVh
ZCByZXR1cm4gdmFsdWUgb2YgMSBtZWFucyBzZW1hcGhvcmUgYWN1cWlyZSAqLworCWlmIChyaW5n
LT5mdW5jcy0+dm1odWIgPT0gQU1ER1BVX01NSFVCXzAgfHwKKwkgICAgcmluZy0+ZnVuY3MtPnZt
aHViID09IEFNREdQVV9NTUhVQl8xKQorCQlhbWRncHVfcmluZ19lbWl0X3JlZ193YWl0KHJpbmcs
CisJCQkJCSAgaHViLT52bV9pbnZfZW5nMF9zZW0gKyBlbmcsIDB4MSwgMHgxKTsKKwogCWFtZGdw
dV9yaW5nX2VtaXRfd3JlZyhyaW5nLCBodWItPmN0eDBfcHRiX2FkZHJfbG8zMiArICgyICogdm1p
ZCksCiAJCQkgICAgICBsb3dlcl8zMl9iaXRzKHBkX2FkZHIpKTsKIApAQCAtMzQ4LDYgKzM5Miwx
NCBAQCBzdGF0aWMgdWludDY0X3QgZ21jX3YxMF8wX2VtaXRfZmx1c2hfZ3B1X3RsYihzdHJ1Y3Qg
YW1kZ3B1X3JpbmcgKnJpbmcsCiAJCQkJCSAgICBodWItPnZtX2ludl9lbmcwX2FjayArIGVuZywK
IAkJCQkJICAgIHJlcSwgMSA8PCB2bWlkKTsKIAorCS8qCisJICogYWRkIHNlbWFwaG9yZSByZWxl
YXNlIGFmdGVyIGludmFsaWRhdGlvbiwKKwkgKiB3cml0ZSB3aXRoIDAgbWVhbnMgc2VtYXBob3Jl
IHJlbGVhc2UKKwkgKi8KKwlpZiAocmluZy0+ZnVuY3MtPnZtaHViID09IEFNREdQVV9NTUhVQl8w
IHx8CisJICAgIHJpbmctPmZ1bmNzLT52bWh1YiA9PSBBTURHUFVfTU1IVUJfMSkKKwkJYW1kZ3B1
X3JpbmdfZW1pdF93cmVnKHJpbmcsIGh1Yi0+dm1faW52X2VuZzBfc2VtICsgZW5nLCAwKTsKKwog
CXJldHVybiBwZF9hZGRyOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9nbWNfdjlfMC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYwpp
bmRleCBiN2YyYjE4NGU5YjguLjgxNmZkZDYwMmM4NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9nbWNfdjlfMC5jCkBAIC00NTUsNiArNDU1LDI3IEBAIHN0YXRpYyB2b2lkIGdtY192OV8wX2Zs
dXNoX2dwdV90bGIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHVpbnQzMl90IHZtaWQsCiAJ
fQogCiAJc3Bpbl9sb2NrKCZhZGV2LT5nbWMuaW52YWxpZGF0ZV9sb2NrKTsKKworCS8qCisJICog
SXQgbWF5IGxvc2UgZ3B1dm0gaW52YWxpZGF0ZSBhY2tub3dsZGVnZSBzdGF0ZSBhY3Jvc3MgcG93
ZXItZ2F0aW5nCisJICogb2ZmIGN5Y2xlLCBhZGQgc2VtYXBob3JlIGFjcXVpcmUgYmVmb3JlIGlu
dmFsaWRhdGlvbiBhbmQgc2VtYXBob3JlCisJICogcmVsZWFzZSBhZnRlciBpbnZhbGlkYXRpb24g
dG8gYXZvaWQgZW50ZXJpbmcgcG93ZXIgZ2F0ZWQgc3RhdGUKKwkgKiB0byBXQSB0aGUgSXNzdWUK
KwkgKi8KKwlpZiAodm1odWIgPT0gQU1ER1BVX01NSFVCXzAgfHwKKwkgICAgdm1odWIgPT0gQU1E
R1BVX01NSFVCXzEpIHsKKwkJZm9yIChqID0gMDsgaiA8IGFkZXYtPnVzZWNfdGltZW91dDsgaisr
KSB7CisJCQkvKiBhIHJlYWQgcmV0dXJuIHZhbHVlIG9mIDEgbWVhbnMgc2VtYXBob3JlIGFjdXFp
cmUgKi8KKwkJCXRtcCA9IFJSRUczMl9OT19LSVEoaHViLT52bV9pbnZfZW5nMF9zZW0gKyBlbmcp
OworCQkJaWYgKHRtcCAmIDB4MSkKKwkJCQlicmVhazsKKwkJCXVkZWxheSgxKTsKKwkJfQorCisJ
CWlmIChqID49IGFkZXYtPnVzZWNfdGltZW91dCkKKwkJCURSTV9FUlJPUigiVGltZW91dCB3YWl0
aW5nIGZvciBzZW0gYWNxdWlyZSBpbiBWTSBmbHVzaCFcbiIpOworCX0KKwogCVdSRUczMl9OT19L
SVEoaHViLT52bV9pbnZfZW5nMF9yZXEgKyBlbmcsIHRtcCk7CiAKIAkvKgpAQCAtNDcwLDcgKzQ5
MSwxNyBAQCBzdGF0aWMgdm9pZCBnbWNfdjlfMF9mbHVzaF9ncHVfdGxiKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LCB1aW50MzJfdCB2bWlkLAogCQkJYnJlYWs7CiAJCXVkZWxheSgxKTsKIAl9
CisKKwkvKgorCSAqIGFkZCBzZW1hcGhvcmUgcmVsZWFzZSBhZnRlciBpbnZhbGlkYXRpb24sCisJ
ICogd3JpdGUgd2l0aCAwIG1lYW5zIHNlbWFwaG9yZSByZWxlYXNlCisJICovCisJaWYgKHZtaHVi
ID09IEFNREdQVV9NTUhVQl8wIHx8CisJICAgIHZtaHViID09IEFNREdQVV9NTUhVQl8xKQorCQlX
UkVHMzJfTk9fS0lRKGh1Yi0+dm1faW52X2VuZzBfc2VtICsgZW5nLCAwKTsKKwogCXNwaW5fdW5s
b2NrKCZhZGV2LT5nbWMuaW52YWxpZGF0ZV9sb2NrKTsKKwogCWlmIChqIDwgYWRldi0+dXNlY190
aW1lb3V0KQogCQlyZXR1cm47CiAKQEAgLTQ4NSw2ICs1MTYsMTkgQEAgc3RhdGljIHVpbnQ2NF90
IGdtY192OV8wX2VtaXRfZmx1c2hfZ3B1X3RsYihzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsCiAJ
dWludDMyX3QgcmVxID0gZ21jX3Y5XzBfZ2V0X2ludmFsaWRhdGVfcmVxKHZtaWQsIDApOwogCXVu
c2lnbmVkIGVuZyA9IHJpbmctPnZtX2ludl9lbmc7CiAKKwkvKgorCSAqIEl0IG1heSBsb3NlIGdw
dXZtIGludmFsaWRhdGUgYWNrbm93bGRlZ2Ugc3RhdGUgYWNyb3NzIHBvd2VyLWdhdGluZworCSAq
IG9mZiBjeWNsZSwgYWRkIHNlbWFwaG9yZSBhY3F1aXJlIGJlZm9yZSBpbnZhbGlkYXRpb24gYW5k
IHNlbWFwaG9yZQorCSAqIHJlbGVhc2UgYWZ0ZXIgaW52YWxpZGF0aW9uIHRvIGF2b2lkIGVudGVy
aW5nIHBvd2VyIGdhdGVkIHN0YXRlCisJICogdG8gV0EgdGhlIElzc3VlCisJICovCisKKwkvKiBh
IHJlYWQgcmV0dXJuIHZhbHVlIG9mIDEgbWVhbnMgc2VtYXBob3JlIGFjdXFpcmUgKi8KKwlpZiAo
cmluZy0+ZnVuY3MtPnZtaHViID09IEFNREdQVV9NTUhVQl8wIHx8CisJICAgIHJpbmctPmZ1bmNz
LT52bWh1YiA9PSBBTURHUFVfTU1IVUJfMSkKKwkJYW1kZ3B1X3JpbmdfZW1pdF9yZWdfd2FpdChy
aW5nLAorCQkJCQkgIGh1Yi0+dm1faW52X2VuZzBfc2VtICsgZW5nLCAweDEsIDB4MSk7CisKIAlh
bWRncHVfcmluZ19lbWl0X3dyZWcocmluZywgaHViLT5jdHgwX3B0Yl9hZGRyX2xvMzIgKyAoMiAq
IHZtaWQpLAogCQkJICAgICAgbG93ZXJfMzJfYml0cyhwZF9hZGRyKSk7CiAKQEAgLTQ5NSw2ICs1
MzksMTQgQEAgc3RhdGljIHVpbnQ2NF90IGdtY192OV8wX2VtaXRfZmx1c2hfZ3B1X3RsYihzdHJ1
Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsCiAJCQkJCSAgICBodWItPnZtX2ludl9lbmcwX2FjayArIGVu
ZywKIAkJCQkJICAgIHJlcSwgMSA8PCB2bWlkKTsKIAorCS8qCisJICogYWRkIHNlbWFwaG9yZSBy
ZWxlYXNlIGFmdGVyIGludmFsaWRhdGlvbiwKKwkgKiB3cml0ZSB3aXRoIDAgbWVhbnMgc2VtYXBo
b3JlIHJlbGVhc2UKKwkgKi8KKwlpZiAocmluZy0+ZnVuY3MtPnZtaHViID09IEFNREdQVV9NTUhV
Ql8wIHx8CisJICAgIHJpbmctPmZ1bmNzLT52bWh1YiA9PSBBTURHUFVfTU1IVUJfMSkKKwkJYW1k
Z3B1X3JpbmdfZW1pdF93cmVnKHJpbmcsIGh1Yi0+dm1faW52X2VuZzBfc2VtICsgZW5nLCAwKTsK
KwogCXJldHVybiBwZF9hZGRyOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9zb2MxNS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc29jMTUuaAppbmRl
eCAzNDQyODBiODY5YzQuLmQwZmI3YTY3YzFhMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvc29jMTUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zb2Mx
NS5oCkBAIC0yOCw4ICsyOCw4IEBACiAjaW5jbHVkZSAibmJpb192N18wLmgiCiAjaW5jbHVkZSAi
bmJpb192N180LmgiCiAKLSNkZWZpbmUgU09DMTVfRkxVU0hfR1BVX1RMQl9OVU1fV1JFRwkJNAot
I2RlZmluZSBTT0MxNV9GTFVTSF9HUFVfVExCX05VTV9SRUdfV0FJVAkxCisjZGVmaW5lIFNPQzE1
X0ZMVVNIX0dQVV9UTEJfTlVNX1dSRUcJCTYKKyNkZWZpbmUgU09DMTVfRkxVU0hfR1BVX1RMQl9O
VU1fUkVHX1dBSVQJMwogCiBleHRlcm4gY29uc3Qgc3RydWN0IGFtZF9pcF9mdW5jcyBzb2MxNV9j
b21tb25faXBfZnVuY3M7CiAKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KYW1kLWdmeCBtYWlsaW5nIGxpc3QKYW1kLWdmeEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9hbWQtZ2Z4
