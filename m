Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 257DDA0C09
	for <lists+amd-gfx@lfdr.de>; Wed, 28 Aug 2019 23:04:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 25E3489F31;
	Wed, 28 Aug 2019 21:04:18 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr820088.outbound.protection.outlook.com [40.107.82.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2CA5189F19
 for <amd-gfx@lists.freedesktop.org>; Wed, 28 Aug 2019 21:04:16 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=Vj3jOXh0/J5EcBFuRmmmI7SwPNSeSMegAy4dkRhZEqBaI1fOh+G2NWYPmpqI2bve9aVed8eXD6Pjvt81TWsx7da6Wb0OQqcEXHjspd1RGJkk0KiSuDnSGF2SloqHXXMF33QdYQVQrRxfwKc4Ji0/axqJ6Cvmr+EBLEJJ22YELZcn2o8BYNjjDttrkagROC43xtHSMy0fHFpRTPFAKE/Gt5CpoUux2d0pqOEThRhm6M0L8CcB3eUCGn4e2IZdaX+uNntt+7IYhkGy3G3qQGGhcRkh3dXGWD/WfdwkXZLagA37QhKyBlfUByQu0dOW78DenLBV45XMJ3jzM7IuC2j/mw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=2QJnbfA5ry6UNY3fFlDcDgnYGpaqV/NutTi+5+2UhoA=;
 b=F7EXHT+dUxk4P3E0RBklzhEYTwap2KuwVtBsoUs6px1GO73DVLTdhQAODmlvXc03HtT5sGQGWE/a4dPKi9Q9hl3mNqWlTQ+kYKQoFxziFM8nFwQ4FsAa4XRXxJtIp2MFsPBxNxYWbgNZBiqorq5CK2XNYJcHPIICTYYqxzUyiB7CLZ/KJSyULP0WIvuZObN/PtYHpuJq8EIXtw3OVk0vv444wFoz+lalKsdWg99X7e2gNY3oRgWQWCSySV8m/d+fGtCUr0wkG/Q3WAsghp+Btzha0YrHTbEco4KzhwAbN/IZAY48BKWhDXxEwU1YA+SH4GERPui44zzaUw3SoZmPpg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org smtp.mailfrom=amd.com; 
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from DM3PR12CA0050.namprd12.prod.outlook.com (2603:10b6:0:56::18) by
 BN6PR12MB1523.namprd12.prod.outlook.com (2603:10b6:405:10::15) with
 Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2199.21; Wed, 28 Aug 2019 21:04:13 +0000
Received: from BY2NAM03FT004.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e4a::202) by DM3PR12CA0050.outlook.office365.com
 (2603:10b6:0:56::18) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id 15.20.2199.15 via Frontend
 Transport; Wed, 28 Aug 2019 21:04:12 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV01.amd.com (165.204.84.17) by
 BY2NAM03FT004.mail.protection.outlook.com (10.152.84.66) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2220.16 via Frontend Transport; Wed, 28 Aug 2019 21:04:12 +0000
Received: from blakha.amd.com (10.180.168.240) by SATLEXCHOV01.amd.com
 (10.181.40.71) with Microsoft SMTP Server id 14.3.389.1; Wed, 28 Aug 2019
 16:04:04 -0500
From: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 09/17] drm/amd/display: update navi to use new surface
 programming behaviour
Date: Wed, 28 Aug 2019 17:03:46 -0400
Message-ID: <20190828210354.21464-10-Bhawanpreet.Lakha@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190828210354.21464-1-Bhawanpreet.Lakha@amd.com>
References: <20190828210354.21464-1-Bhawanpreet.Lakha@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(376002)(346002)(136003)(396003)(39860400002)(2980300002)(428003)(189003)(199004)(486006)(476003)(86362001)(4326008)(446003)(50226002)(53946003)(26005)(2616005)(126002)(11346002)(53936002)(53416004)(8676002)(186003)(6916009)(81156014)(316002)(2351001)(51416003)(8936002)(7696005)(76176011)(16586007)(336012)(1076003)(356004)(6666004)(5660300002)(14444005)(50466002)(70206006)(15650500001)(426003)(30864003)(2906002)(478600001)(48376002)(81166006)(305945005)(70586007)(36756003)(47776003);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN6PR12MB1523; H:SATLEXCHOV01.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 63515b8b-b04f-4246-3ca7-08d72bfb4721
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600166)(711020)(4605104)(1401327)(4618075)(2017052603328);
 SRVR:BN6PR12MB1523; 
X-MS-TrafficTypeDiagnostic: BN6PR12MB1523:
X-Microsoft-Antispam-PRVS: <BN6PR12MB1523175E33F134129BB155AFF9A30@BN6PR12MB1523.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:1388;
X-Forefront-PRVS: 014304E855
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: wQodhy98+fmtRgIRqERRpfPQHPHLNwGsr0z4UEEJqVaODYyX/LViQPJpOaWbrLQUsylwte5IC7hYWEq5ZRrUpUgHejAYpD+YJcKOIgEihZk2A+iQAGhTWeoTrTZjtixALZr2mvY+p9imCA2kfuEsJUaX1OzrWEcd4IhV/qSBmQKHpriJSp6tlyamT+hFZ0McUZJG7E08YKrUw1pW93TdZm32h/50nrMf/C7sEy1RXqz4J701p3+169IvGHaKMawFs4tfbA7mHNdI6rZF5FHtqOA8oXpjjdS73RtEYPot3c21SS4e686SyYXnh+R9otsLRLabJBdCZGX7Tx93nhxUHsXIV8OaAzHwtZdd/ROxWEO5hJ3jGG1bbWbZTJefi6LIvloNiqq0WTQGDy8sqsu2F1ICqp2+0p5NAX6gKRChvhs=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 28 Aug 2019 21:04:12.4819 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 63515b8b-b04f-4246-3ca7-08d72bfb4721
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV01.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN6PR12MB1523
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=2QJnbfA5ry6UNY3fFlDcDgnYGpaqV/NutTi+5+2UhoA=;
 b=slAuUBr4YIk7mnA6T3tgBLZ8SsvB9HvHmOrG57arEgm6k/RBbpdL2Fj2xLmsNlWxYWUGoFjYbf//WBlV0pvrARgs7bJJGdvXuwHcPWgju3Flg4D21BmKw1hCawmZkkXDYFJUTBvXJTJQUImzQSfgxg5sRHkD57GGzpOOhBS7xBU=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogRG15dHJvIExha3R5dXNoa2luIDxEbXl0cm8uTGFrdHl1c2hraW5AYW1kLmNvbT4KCk5l
dyBiZWhhdmlvdXIgd2lsbCB0cmFjayBnbG9iYWwgdXBkYXRlcyBhbmQgdXBkYXRlIGFueSBodyB0
aGF0IGlzbid0CnJlbGF0ZWQgdG8gY3VycmVudCBzdHJlYW0gYmVpbmcgdXBkYXRlZC4KClRoaXMg
c2hvdWxkIGZpeCBhbnkgaXNzdWVzIGNhdXNlZCBieSBwaXBlIHNwbGl0IHBpcGVzIGJlaW5nIHRh
a2VuCmJ5IG90aGVyIHN0cmVhbXMuCgpTaWduZWQtb2ZmLWJ5OiBEbXl0cm8gTGFrdHl1c2hraW4g
PERteXRyby5MYWt0eXVzaGtpbkBhbWQuY29tPgpSZXZpZXdlZC1ieTogQ2hhcmxlbmUgTGl1IDxD
aGFybGVuZS5MaXVAYW1kLmNvbT4KQWNrZWQtYnk6IEJoYXdhbnByZWV0IExha2hhIDxCaGF3YW5w
cmVldC5MYWtoYUBhbWQuY29tPgotLS0KIC4uLi9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9k
bS9hbWRncHVfZG0uYyB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2Nv
cmUvZGMuYyAgICAgIHwgMTA1ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9k
Y19zdHJlYW0uaCAgICB8ICAxOCArCiAuLi4vZHJtL2FtZC9kaXNwbGF5L2RjL2RjbjIwL2RjbjIw
X2h3c2VxLmMgICAgfCA1NzYgKysrKysrKysrKysrKy0tLS0tCiAuLi4vZ3B1L2RybS9hbWQvZGlz
cGxheS9kYy9pbmMvaHdfc2VxdWVuY2VyLmggfCAgIDMgKwogNSBmaWxlcyBjaGFuZ2VkLCA1MTAg
aW5zZXJ0aW9ucygrKSwgMTk4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCmluZGV4IDE2MGFmMGM4YjQwYy4uNjU0
Njc5YzRmZGVkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1
X2RtL2FtZGdwdV9kbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVf
ZG0vYW1kZ3B1X2RtLmMKQEAgLTU4MTEsNiArNTgxMSw3IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9k
bV9jb21taXRfcGxhbmVzKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkvKiBVcGRh
dGUgdGhlIHBsYW5lcyBpZiBjaGFuZ2VkIG9yIGRpc2FibGUgaWYgd2UgZG9uJ3QgaGF2ZSBhbnku
ICovCiAJaWYgKChwbGFuZXNfY291bnQgfHwgYWNydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgPT0g
MCkgJiYKIAkJYWNydGNfc3RhdGUtPnN0cmVhbSkgeworCQlidW5kbGUtPnN0cmVhbV91cGRhdGUu
c3RyZWFtID0gYWNydGNfc3RhdGUtPnN0cmVhbTsKIAkJaWYgKG5ld19wY3J0Y19zdGF0ZS0+bW9k
ZV9jaGFuZ2VkKSB7CiAJCQlidW5kbGUtPnN0cmVhbV91cGRhdGUuc3JjID0gYWNydGNfc3RhdGUt
PnN0cmVhbS0+c3JjOwogCQkJYnVuZGxlLT5zdHJlYW1fdXBkYXRlLmRzdCA9IGFjcnRjX3N0YXRl
LT5zdHJlYW0tPmRzdDsKQEAgLTYyMjIsOSArNjIyMywxMCBAQCBzdGF0aWMgdm9pZCBhbWRncHVf
ZG1fYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJ
CQkoZG1fbmV3X2NydGNfc3RhdGUtPmFibV9sZXZlbCA9PSBkbV9vbGRfY3J0Y19zdGF0ZS0+YWJt
X2xldmVsKSkKIAkJCWNvbnRpbnVlOwogCisJCXN0cmVhbV91cGRhdGUuc3RyZWFtID0gZG1fbmV3
X2NydGNfc3RhdGUtPnN0cmVhbTsKIAkJaWYgKGlzX3NjYWxpbmdfc3RhdGVfZGlmZmVyZW50KGRt
X25ld19jb25fc3RhdGUsIGRtX29sZF9jb25fc3RhdGUpKSB7CiAJCQl1cGRhdGVfc3RyZWFtX3Nj
YWxpbmdfc2V0dGluZ3MoJmRtX25ld19jb25fc3RhdGUtPmJhc2UuY3J0Yy0+bW9kZSwKLQkJCQkJ
ZG1fbmV3X2Nvbl9zdGF0ZSwgKHN0cnVjdCBkY19zdHJlYW1fc3RhdGUgKilkbV9uZXdfY3J0Y19z
dGF0ZS0+c3RyZWFtKTsKKwkJCQkJZG1fbmV3X2Nvbl9zdGF0ZSwgZG1fbmV3X2NydGNfc3RhdGUt
PnN0cmVhbSk7CiAKIAkJCXN0cmVhbV91cGRhdGUuc3JjID0gZG1fbmV3X2NydGNfc3RhdGUtPnN0
cmVhbS0+c3JjOwogCQkJc3RyZWFtX3VwZGF0ZS5kc3QgPSBkbV9uZXdfY3J0Y19zdGF0ZS0+c3Ry
ZWFtLT5kc3Q7CkBAIC03MDgzLDcgKzcwODUsNyBAQCBkbV9kZXRlcm1pbmVfdXBkYXRlX3R5cGVf
Zm9yX2NvbW1pdChzdHJ1Y3QgYW1kZ3B1X2Rpc3BsYXlfbWFuYWdlciAqZG0sCiAKIAkJc3RhdHVz
ID0gZGNfc3RyZWFtX2dldF9zdGF0dXNfZnJvbV9zdGF0ZShvbGRfZG1fc3RhdGUtPmNvbnRleHQs
CiAJCQkJCQkJIG5ld19kbV9jcnRjX3N0YXRlLT5zdHJlYW0pOwotCisJCXN0cmVhbV91cGRhdGUu
c3RyZWFtID0gbmV3X2RtX2NydGNfc3RhdGUtPnN0cmVhbTsKIAkJLyoKIAkJICogVE9ETzogREMg
bW9kaWZpZXMgdGhlIHN1cmZhY2UgZHVyaW5nIHRoaXMgY2FsbCBzbyB3ZSBuZWVkCiAJCSAqIHRv
IGxvY2sgaGVyZSAtIGZpbmQgYSB3YXkgdG8gZG8gdGhpcyB3aXRob3V0IGxvY2tpbmcuCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kYy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2NvcmUvZGMuYwppbmRleCBlNDZhYWZmNTVmYjkuLjJl
ZmE2YzY0MTZlMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2Nv
cmUvZGMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvY29yZS9kYy5jCkBA
IC03NTMsOCArNzUzLDEzIEBAIHN0YXRpYyB2b2lkIGRpc2FibGVfZGFuZ2xpbmdfcGxhbmUoc3Ry
dWN0IGRjICpkYywgc3RydWN0IGRjX3N0YXRlICpjb250ZXh0KQogI2lmIGRlZmluZWQoQ09ORklH
X0RSTV9BTURfRENfRENOMl8wKQogCQkJZGlzYWJsZV9hbGxfd3JpdGViYWNrX3BpcGVzX2Zvcl9z
dHJlYW0oZGMsIG9sZF9zdHJlYW0sIGRhbmdsaW5nX2NvbnRleHQpOwogI2VuZGlmCi0JCQlkYy0+
aHdzcy5hcHBseV9jdHhfZm9yX3N1cmZhY2UoZGMsIG9sZF9zdHJlYW0sIDAsIGRhbmdsaW5nX2Nv
bnRleHQpOworCQkJaWYgKGRjLT5od3NzLmFwcGx5X2N0eF9mb3Jfc3VyZmFjZSkKKwkJCQlkYy0+
aHdzcy5hcHBseV9jdHhfZm9yX3N1cmZhY2UoZGMsIG9sZF9zdHJlYW0sIDAsIGRhbmdsaW5nX2Nv
bnRleHQpOwogCQl9CisjaWYgZGVmaW5lZChDT05GSUdfRFJNX0FNRF9EQ19EQ04yXzApCisJCWlm
IChkYy0+aHdzcy5wcm9ncmFtX2Zyb250X2VuZF9mb3JfY3R4KQorCQkJZGMtPmh3c3MucHJvZ3Jh
bV9mcm9udF9lbmRfZm9yX2N0eChkYywgZGFuZ2xpbmdfY29udGV4dCk7CisjZW5kaWYKIAl9CiAK
IAljdXJyZW50X2N0eCA9IGRjLT5jdXJyZW50X3N0YXRlOwpAQCAtMTA2NSwxNSArMTA3MCwyMCBA
QCBzdGF0aWMgZW51bSBkY19zdGF0dXMgZGNfY29tbWl0X3N0YXRlX25vX2NoZWNrKHN0cnVjdCBk
YyAqZGMsIHN0cnVjdCBkY19zdGF0ZSAqYwogCS8qIHJlLXByb2dyYW0gcGxhbmVzIGZvciBleGlz
dGluZyBzdHJlYW0sIGluIGNhc2Ugd2UgbmVlZCB0bwogCSAqIGZyZWUgdXAgcGxhbmUgcmVzb3Vy
Y2UgZm9yIGxhdGVyIHVzZQogCSAqLwotCWZvciAoaSA9IDA7IGkgPCBjb250ZXh0LT5zdHJlYW1f
Y291bnQ7IGkrKykgewotCQlpZiAoY29udGV4dC0+c3RyZWFtc1tpXS0+bW9kZV9jaGFuZ2VkKQot
CQkJY29udGludWU7CisJaWYgKGRjLT5od3NzLmFwcGx5X2N0eF9mb3Jfc3VyZmFjZSkKKwkJZm9y
IChpID0gMDsgaSA8IGNvbnRleHQtPnN0cmVhbV9jb3VudDsgaSsrKSB7CisJCQlpZiAoY29udGV4
dC0+c3RyZWFtc1tpXS0+bW9kZV9jaGFuZ2VkKQorCQkJCWNvbnRpbnVlOwogCi0JCWRjLT5od3Nz
LmFwcGx5X2N0eF9mb3Jfc3VyZmFjZSgKLQkJCWRjLCBjb250ZXh0LT5zdHJlYW1zW2ldLAotCQkJ
Y29udGV4dC0+c3RyZWFtX3N0YXR1c1tpXS5wbGFuZV9jb3VudCwKLQkJCWNvbnRleHQpOyAvKiB1
c2UgbmV3IHBpcGUgY29uZmlnIGluIG5ldyBjb250ZXh0ICovCi0JfQorCQkJZGMtPmh3c3MuYXBw
bHlfY3R4X2Zvcl9zdXJmYWNlKAorCQkJCWRjLCBjb250ZXh0LT5zdHJlYW1zW2ldLAorCQkJCWNv
bnRleHQtPnN0cmVhbV9zdGF0dXNbaV0ucGxhbmVfY291bnQsCisJCQkJY29udGV4dCk7IC8qIHVz
ZSBuZXcgcGlwZSBjb25maWcgaW4gbmV3IGNvbnRleHQgKi8KKwkJfQorI2lmIGRlZmluZWQoQ09O
RklHX0RSTV9BTURfRENfRENOMl8wKQorCWlmIChkYy0+aHdzcy5wcm9ncmFtX2Zyb250X2VuZF9m
b3JfY3R4KQorCQlkYy0+aHdzcy5wcm9ncmFtX2Zyb250X2VuZF9mb3JfY3R4KGRjLCBjb250ZXh0
KTsKKyNlbmRpZgogCiAJLyogUHJvZ3JhbSBoYXJkd2FyZSAqLwogCWZvciAoaSA9IDA7IGkgPCBk
Yy0+cmVzX3Bvb2wtPnBpcGVfY291bnQ7IGkrKykgewpAQCAtMTA5MiwxNiArMTEwMiwyMSBAQCBz
dGF0aWMgZW51bSBkY19zdGF0dXMgZGNfY29tbWl0X3N0YXRlX25vX2NoZWNrKHN0cnVjdCBkYyAq
ZGMsIHN0cnVjdCBkY19zdGF0ZSAqYwogCX0KIAogCS8qIFByb2dyYW0gYWxsIHBsYW5lcyB3aXRo
aW4gbmV3IGNvbnRleHQqLworI2lmIGRlZmluZWQoQ09ORklHX0RSTV9BTURfRENfRENOMl8wKQor
CWlmIChkYy0+aHdzcy5wcm9ncmFtX2Zyb250X2VuZF9mb3JfY3R4KQorCQlkYy0+aHdzcy5wcm9n
cmFtX2Zyb250X2VuZF9mb3JfY3R4KGRjLCBjb250ZXh0KTsKKyNlbmRpZgogCWZvciAoaSA9IDA7
IGkgPCBjb250ZXh0LT5zdHJlYW1fY291bnQ7IGkrKykgewogCQljb25zdCBzdHJ1Y3QgZGNfbGlu
ayAqbGluayA9IGNvbnRleHQtPnN0cmVhbXNbaV0tPmxpbms7CiAKIAkJaWYgKCFjb250ZXh0LT5z
dHJlYW1zW2ldLT5tb2RlX2NoYW5nZWQpCiAJCQljb250aW51ZTsKIAotCQlkYy0+aHdzcy5hcHBs
eV9jdHhfZm9yX3N1cmZhY2UoCi0JCQkJZGMsIGNvbnRleHQtPnN0cmVhbXNbaV0sCi0JCQkJY29u
dGV4dC0+c3RyZWFtX3N0YXR1c1tpXS5wbGFuZV9jb3VudCwKLQkJCQljb250ZXh0KTsKKwkJaWYg
KGRjLT5od3NzLmFwcGx5X2N0eF9mb3Jfc3VyZmFjZSkKKwkJCWRjLT5od3NzLmFwcGx5X2N0eF9m
b3Jfc3VyZmFjZSgKKwkJCQkJZGMsIGNvbnRleHQtPnN0cmVhbXNbaV0sCisJCQkJCWNvbnRleHQt
PnN0cmVhbV9zdGF0dXNbaV0ucGxhbmVfY291bnQsCisJCQkJCWNvbnRleHQpOwogCiAJCS8qCiAJ
CSAqIGVuYWJsZSBzdGVyZW8KQEAgLTE0ODQsMjAgKzE0OTksMTUgQEAgc3RhdGljIGVudW0gc3Vy
ZmFjZV91cGRhdGVfdHlwZSBkZXRfc3VyZmFjZV91cGRhdGUoY29uc3Qgc3RydWN0IGRjICpkYywK
IAllbnVtIHN1cmZhY2VfdXBkYXRlX3R5cGUgb3ZlcmFsbF90eXBlID0gVVBEQVRFX1RZUEVfRkFT
VDsKIAl1bmlvbiBzdXJmYWNlX3VwZGF0ZV9mbGFncyAqdXBkYXRlX2ZsYWdzID0gJnUtPnN1cmZh
Y2UtPnVwZGF0ZV9mbGFnczsKIAotCXVwZGF0ZV9mbGFncy0+cmF3ID0gMDsgLy8gUmVzZXQgYWxs
IGZsYWdzCi0KIAlpZiAodS0+ZmxpcF9hZGRyKQogCQl1cGRhdGVfZmxhZ3MtPmJpdHMuYWRkcl91
cGRhdGUgPSAxOwogCi0JaWYgKCFpc19zdXJmYWNlX2luX2NvbnRleHQoY29udGV4dCwgdS0+c3Vy
ZmFjZSkpIHsKLQkJdXBkYXRlX2ZsYWdzLT5iaXRzLm5ld19wbGFuZSA9IDE7CisJaWYgKCFpc19z
dXJmYWNlX2luX2NvbnRleHQoY29udGV4dCwgdS0+c3VyZmFjZSkgfHwgdS0+c3VyZmFjZS0+Zm9y
Y2VfZnVsbF91cGRhdGUpIHsKKwkJdXBkYXRlX2ZsYWdzLT5yYXcgPSAweEZGRkZGRkZGOwogCQly
ZXR1cm4gVVBEQVRFX1RZUEVfRlVMTDsKIAl9CiAKLQlpZiAodS0+c3VyZmFjZS0+Zm9yY2VfZnVs
bF91cGRhdGUpIHsKLQkJdXBkYXRlX2ZsYWdzLT5iaXRzLmZ1bGxfdXBkYXRlID0gMTsKLQkJcmV0
dXJuIFVQREFURV9UWVBFX0ZVTEw7Ci0JfQorCXVwZGF0ZV9mbGFncy0+cmF3ID0gMDsgLy8gUmVz
ZXQgYWxsIGZsYWdzCiAKIAl0eXBlID0gZ2V0X3BsYW5lX2luZm9fdXBkYXRlX3R5cGUodSk7CiAJ
ZWxldmF0ZV91cGRhdGVfdHlwZSgmb3ZlcmFsbF90eXBlLCB0eXBlKTsKQEAgLTE1NTUsNDAgKzE1
NjUsNDMgQEAgc3RhdGljIGVudW0gc3VyZmFjZV91cGRhdGVfdHlwZSBjaGVja191cGRhdGVfc3Vy
ZmFjZXNfZm9yX3N0cmVhbSgKIAllbnVtIHN1cmZhY2VfdXBkYXRlX3R5cGUgb3ZlcmFsbF90eXBl
ID0gVVBEQVRFX1RZUEVfRkFTVDsKIAogCWlmIChzdHJlYW1fc3RhdHVzID09IE5VTEwgfHwgc3Ry
ZWFtX3N0YXR1cy0+cGxhbmVfY291bnQgIT0gc3VyZmFjZV9jb3VudCkKLQkJcmV0dXJuIFVQREFU
RV9UWVBFX0ZVTEw7CisJCW92ZXJhbGxfdHlwZSA9IFVQREFURV9UWVBFX0ZVTEw7CiAKIAkvKiBz
b21lIHN0cmVhbSB1cGRhdGVzIHJlcXVpcmUgcGFzc2l2ZSB1cGRhdGUgKi8KIAlpZiAoc3RyZWFt
X3VwZGF0ZSkgewotCQlpZiAoKHN0cmVhbV91cGRhdGUtPnNyYy5oZWlnaHQgIT0gMCkgJiYKLQkJ
CQkoc3RyZWFtX3VwZGF0ZS0+c3JjLndpZHRoICE9IDApKQotCQkJcmV0dXJuIFVQREFURV9UWVBF
X0ZVTEw7CisJCXVuaW9uIHN0cmVhbV91cGRhdGVfZmxhZ3MgKnN1X2ZsYWdzID0gJnN0cmVhbV91
cGRhdGUtPnN0cmVhbS0+dXBkYXRlX2ZsYWdzOwogCi0JCWlmICgoc3RyZWFtX3VwZGF0ZS0+ZHN0
LmhlaWdodCAhPSAwKSAmJgotCQkJCShzdHJlYW1fdXBkYXRlLT5kc3Qud2lkdGggIT0gMCkpCi0J
CQlyZXR1cm4gVVBEQVRFX1RZUEVfRlVMTDsKKwkJaWYgKChzdHJlYW1fdXBkYXRlLT5zcmMuaGVp
Z2h0ICE9IDAgJiYgc3RyZWFtX3VwZGF0ZS0+c3JjLndpZHRoICE9IDApIHx8CisJCQkJKHN0cmVh
bV91cGRhdGUtPmRzdC5oZWlnaHQgIT0gMCAmJiBzdHJlYW1fdXBkYXRlLT5kc3Qud2lkdGggIT0g
MCkpCisJCQlzdV9mbGFncy0+Yml0cy5zY2FsaW5nID0gMTsKIAogCQlpZiAoc3RyZWFtX3VwZGF0
ZS0+b3V0X3RyYW5zZmVyX2Z1bmMpCi0JCQlyZXR1cm4gVVBEQVRFX1RZUEVfRlVMTDsKKwkJCXN1
X2ZsYWdzLT5iaXRzLm91dF90ZiA9IDE7CiAKIAkJaWYgKHN0cmVhbV91cGRhdGUtPmFibV9sZXZl
bCkKLQkJCXJldHVybiBVUERBVEVfVFlQRV9GVUxMOworCQkJc3VfZmxhZ3MtPmJpdHMuYWJtX2xl
dmVsID0gMTsKIAogCQlpZiAoc3RyZWFtX3VwZGF0ZS0+ZHBtc19vZmYpCi0JCQlyZXR1cm4gVVBE
QVRFX1RZUEVfRlVMTDsKKwkJCXN1X2ZsYWdzLT5iaXRzLmRwbXNfb2ZmID0gMTsKKworCQlpZiAo
c3RyZWFtX3VwZGF0ZS0+Z2FtdXRfcmVtYXApCisJCQlzdV9mbGFncy0+Yml0cy5nYW11dF9yZW1h
cCA9IDE7CiAKICNpZiBkZWZpbmVkKENPTkZJR19EUk1fQU1EX0RDX0RDTjJfMCkKIAkJaWYgKHN0
cmVhbV91cGRhdGUtPndiX3VwZGF0ZSkKLQkJCXJldHVybiBVUERBVEVfVFlQRV9GVUxMOworCQkJ
c3VfZmxhZ3MtPmJpdHMud2JfdXBkYXRlID0gMTsKICNlbmRpZgorCQlpZiAoc3VfZmxhZ3MtPnJh
dyAhPSAwKQorCQkJb3ZlcmFsbF90eXBlID0gVVBEQVRFX1RZUEVfRlVMTDsKKworCQlpZiAoc3Ry
ZWFtX3VwZGF0ZS0+b3V0cHV0X2NzY190cmFuc2Zvcm0gfHwgc3RyZWFtX3VwZGF0ZS0+b3V0cHV0
X2NvbG9yX3NwYWNlKQorCQkJc3VfZmxhZ3MtPmJpdHMub3V0X2NzYyA9IDE7CiAJfQogCiAJZm9y
IChpID0gMCA7IGkgPCBzdXJmYWNlX2NvdW50OyBpKyspIHsKIAkJZW51bSBzdXJmYWNlX3VwZGF0
ZV90eXBlIHR5cGUgPQogCQkJCWRldF9zdXJmYWNlX3VwZGF0ZShkYywgJnVwZGF0ZXNbaV0pOwog
Ci0JCWlmICh0eXBlID09IFVQREFURV9UWVBFX0ZVTEwpCi0JCQlyZXR1cm4gdHlwZTsKLQogCQll
bGV2YXRlX3VwZGF0ZV90eXBlKCZvdmVyYWxsX3R5cGUsIHR5cGUpOwogCX0KIApAQCAtMTYxMCwx
MyArMTYyMywxOCBAQCBlbnVtIHN1cmZhY2VfdXBkYXRlX3R5cGUgZGNfY2hlY2tfdXBkYXRlX3N1
cmZhY2VzX2Zvcl9zdHJlYW0oCiAJaW50IGk7CiAJZW51bSBzdXJmYWNlX3VwZGF0ZV90eXBlIHR5
cGU7CiAKKwlpZiAoc3RyZWFtX3VwZGF0ZSkKKwkJc3RyZWFtX3VwZGF0ZS0+c3RyZWFtLT51cGRh
dGVfZmxhZ3MucmF3ID0gMDsKIAlmb3IgKGkgPSAwOyBpIDwgc3VyZmFjZV9jb3VudDsgaSsrKQog
CQl1cGRhdGVzW2ldLnN1cmZhY2UtPnVwZGF0ZV9mbGFncy5yYXcgPSAwOwogCiAJdHlwZSA9IGNo
ZWNrX3VwZGF0ZV9zdXJmYWNlc19mb3Jfc3RyZWFtKGRjLCB1cGRhdGVzLCBzdXJmYWNlX2NvdW50
LCBzdHJlYW1fdXBkYXRlLCBzdHJlYW1fc3RhdHVzKTsKLQlpZiAodHlwZSA9PSBVUERBVEVfVFlQ
RV9GVUxMKQorCWlmICh0eXBlID09IFVQREFURV9UWVBFX0ZVTEwpIHsKKwkJaWYgKHN0cmVhbV91
cGRhdGUpCisJCQlzdHJlYW1fdXBkYXRlLT5zdHJlYW0tPnVwZGF0ZV9mbGFncy5yYXcgPSAweEZG
RkZGRkZGOwogCQlmb3IgKGkgPSAwOyBpIDwgc3VyZmFjZV9jb3VudDsgaSsrKQogCQkJdXBkYXRl
c1tpXS5zdXJmYWNlLT51cGRhdGVfZmxhZ3MucmF3ID0gMHhGRkZGRkZGRjsKKwl9CiAKIAlpZiAo
dHlwZSA9PSBVUERBVEVfVFlQRV9GQVNUICYmIG1lbWNtcCgmZGMtPmN1cnJlbnRfc3RhdGUtPmJ3
X2N0eC5idy5kY24uY2xrLCAmZGMtPmNsa19tZ3ItPmNsa3MsIG9mZnNldG9mKHN0cnVjdCBkY19j
bG9ja3MsIHByZXZfcF9zdGF0ZV9jaGFuZ2Vfc3VwcG9ydCkpICE9IDApCiAJCWRjLT5vcHRpbWl6
ZWRfcmVxdWlyZWQgPSB0cnVlOwpAQCAtMTk5Miw3ICsyMDEwLDEzIEBAIHN0YXRpYyB2b2lkIGNv
bW1pdF9wbGFuZXNfZm9yX3N0cmVhbShzdHJ1Y3QgZGMgKmRjLAogCQkgKiBJbiBjYXNlIG9mIHR1
cm5pbmcgb2ZmIHNjcmVlbiwgbm8gbmVlZCB0byBwcm9ncmFtIGZyb250IGVuZCBhIHNlY29uZCB0
aW1lLgogCQkgKiBqdXN0IHJldHVybiBhZnRlciBwcm9ncmFtIGJsYW5rLgogCQkgKi8KLQkJZGMt
Pmh3c3MuYXBwbHlfY3R4X2Zvcl9zdXJmYWNlKGRjLCBzdHJlYW0sIDAsIGNvbnRleHQpOworCQlp
ZiAoZGMtPmh3c3MuYXBwbHlfY3R4X2Zvcl9zdXJmYWNlKQorCQkJZGMtPmh3c3MuYXBwbHlfY3R4
X2Zvcl9zdXJmYWNlKGRjLCBzdHJlYW0sIDAsIGNvbnRleHQpOworI2lmIGRlZmluZWQoQ09ORklH
X0RSTV9BTURfRENfRENOMl8wKQorCQlpZiAoZGMtPmh3c3MucHJvZ3JhbV9mcm9udF9lbmRfZm9y
X2N0eCkKKwkJCWRjLT5od3NzLnByb2dyYW1fZnJvbnRfZW5kX2Zvcl9jdHgoZGMsIGNvbnRleHQp
OworI2VuZGlmCisKIAkJcmV0dXJuOwogCX0KIApAQCAtMjA1MiwxMCArMjA3NiwxNSBAQCBzdGF0
aWMgdm9pZCBjb21taXRfcGxhbmVzX2Zvcl9zdHJlYW0oc3RydWN0IGRjICpkYywKIAkJCXN0cmVh
bV9zdGF0dXMgPQogCQkJCXN0cmVhbV9nZXRfc3RhdHVzKGNvbnRleHQsIHBpcGVfY3R4LT5zdHJl
YW0pOwogCi0JCQlkYy0+aHdzcy5hcHBseV9jdHhfZm9yX3N1cmZhY2UoCisJCQlpZiAoZGMtPmh3
c3MuYXBwbHlfY3R4X2Zvcl9zdXJmYWNlKQorCQkJCWRjLT5od3NzLmFwcGx5X2N0eF9mb3Jfc3Vy
ZmFjZSgKIAkJCQkJZGMsIHBpcGVfY3R4LT5zdHJlYW0sIHN0cmVhbV9zdGF0dXMtPnBsYW5lX2Nv
dW50LCBjb250ZXh0KTsKIAkJfQogCX0KKyNpZiBkZWZpbmVkKENPTkZJR19EUk1fQU1EX0RDX0RD
TjJfMCkKKwlpZiAoZGMtPmh3c3MucHJvZ3JhbV9mcm9udF9lbmRfZm9yX2N0eCAmJiB1cGRhdGVf
dHlwZSAhPSBVUERBVEVfVFlQRV9GQVNUKQorCQlkYy0+aHdzcy5wcm9ncmFtX2Zyb250X2VuZF9m
b3JfY3R4KGRjLCBjb250ZXh0KTsKKyNlbmRpZgogCiAJLy8gVXBkYXRlIFR5cGUgRkFTVCwgU3Vy
ZmFjZSB1cGRhdGVzCiAJaWYgKHVwZGF0ZV90eXBlID09IFVQREFURV9UWVBFX0ZBU1QpIHsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY19zdHJlYW0uaCBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY19zdHJlYW0uaAppbmRleCAwZmExYzI2YmMy
MGQuLmUyZDllMTFiZTRiMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5
L2RjL2RjX3N0cmVhbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY19z
dHJlYW0uaApAQCAtMTEzLDYgKzExMywyMSBAQCBzdHJ1Y3QgcGVyaW9kaWNfaW50ZXJydXB0X2Nv
bmZpZyB7CiAJaW50IGxpbmVzX29mZnNldDsKIH07CiAKK3VuaW9uIHN0cmVhbV91cGRhdGVfZmxh
Z3MgeworCXN0cnVjdCB7CisJCXVpbnQzMl90IHNjYWxpbmc6MTsKKwkJdWludDMyX3Qgb3V0X3Rm
OjE7CisJCXVpbnQzMl90IG91dF9jc2M6MTsKKwkJdWludDMyX3QgYWJtX2xldmVsOjE7CisJCXVp
bnQzMl90IGRwbXNfb2ZmOjE7CisJCXVpbnQzMl90IGdhbXV0X3JlbWFwOjE7CisjaWYgZGVmaW5l
ZChDT05GSUdfRFJNX0FNRF9EQ19EQ04yXzApCisJCXVpbnQzMl90IHdiX3VwZGF0ZToxOworI2Vu
ZGlmCisJfSBiaXRzOworCisJdWludDMyX3QgcmF3OworfTsKIAogc3RydWN0IGRjX3N0cmVhbV9z
dGF0ZSB7CiAJLy8gc2luayBpcyBkZXByZWNhdGVkLCBuZXcgY29kZSBzaG91bGQgbm90IHJlZmVy
ZW5jZQpAQCAtMjE0LDkgKzIyOSwxMiBAQCBzdHJ1Y3QgZGNfc3RyZWFtX3N0YXRlIHsKICNpZmRl
ZiBDT05GSUdfRFJNX0FNRF9EQ19EU0NfU1VQUE9SVAogCWJvb2wgaXNfZHNjX2VuYWJsZWQ7CiAj
ZW5kaWYKKwl1bmlvbiBzdHJlYW1fdXBkYXRlX2ZsYWdzIHVwZGF0ZV9mbGFnczsKIH07CiAKIHN0
cnVjdCBkY19zdHJlYW1fdXBkYXRlIHsKKwlzdHJ1Y3QgZGNfc3RyZWFtX3N0YXRlICpzdHJlYW07
CisKIAlzdHJ1Y3QgcmVjdCBzcmM7CiAJc3RydWN0IHJlY3QgZHN0OwogCXN0cnVjdCBkY190cmFu
c2Zlcl9mdW5jICpvdXRfdHJhbnNmZXJfZnVuYzsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24yMF9od3NlcS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9kaXNwbGF5L2RjL2RjbjIwL2RjbjIwX2h3c2VxLmMKaW5kZXggMTIxMmRhMTJjNDE0Li5iNWI1
ZDkxNDVmNmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24y
MC9kY24yMF9od3NlcS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24y
MC9kY24yMF9od3NlcS5jCkBAIC01MDgsNyArNTA4LDcgQEAgc3RhdGljIHZvaWQgZGNuMjBfcGxh
bmVfYXRvbWljX2Rpc2FibGUoc3RydWN0IGRjICpkYywgc3RydWN0IHBpcGVfY3R4ICpwaXBlX2N0
eCkKIH0KIAogCi12b2lkIGRjbjIwX2Rpc2FibGVfcGxhbmUoc3RydWN0IGRjICpkYywgc3RydWN0
IHBpcGVfY3R4ICpwaXBlX2N0eCkKK3N0YXRpYyB2b2lkIGRjbjIwX2Rpc2FibGVfcGxhbmUoc3Ry
dWN0IGRjICpkYywgc3RydWN0IHBpcGVfY3R4ICpwaXBlX2N0eCkKIHsKIAlEQ19MT0dHRVJfSU5J
VChkYy0+Y3R4LT5sb2dnZXIpOwogCkBAIC05MjMsNyArOTIzLDcgQEAgc3RhdGljIHZvaWQgZGNu
MjBfcG93ZXJfb25fcGxhbmUoCiAJfQogfQogCi12b2lkIGRjbjIwX2VuYWJsZV9wbGFuZSgKK3N0
YXRpYyB2b2lkIGRjbjIwX2VuYWJsZV9wbGFuZSgKIAlzdHJ1Y3QgZGMgKmRjLAogCXN0cnVjdCBw
aXBlX2N0eCAqcGlwZV9jdHgsCiAJc3RydWN0IGRjX3N0YXRlICpjb250ZXh0KQpAQCAtOTk5LDcy
ICs5OTksNiBAQCB2b2lkIGRjbjIwX2VuYWJsZV9wbGFuZSgKIH0KIAogCi1zdGF0aWMgdm9pZCBk
Y24yMF9wcm9ncmFtX3BpcGUoCi0JCXN0cnVjdCBkYyAqZGMsCi0JCXN0cnVjdCBwaXBlX2N0eCAq
cGlwZV9jdHgsCi0JCXN0cnVjdCBkY19zdGF0ZSAqY29udGV4dCkKLXsKLQlwaXBlX2N0eC0+cGxh
bmVfc3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRzLmZ1bGxfdXBkYXRlID0KLQkJCWNvbnRleHQtPmNv
bW1pdF9oaW50cy5mdWxsX3VwZGF0ZV9uZWVkZWQgPyAxIDogcGlwZV9jdHgtPnBsYW5lX3N0YXRl
LT51cGRhdGVfZmxhZ3MuYml0cy5mdWxsX3VwZGF0ZTsKLQotCWlmIChwaXBlX2N0eC0+cGxhbmVf
c3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRzLmZ1bGxfdXBkYXRlKQotCQlkY24yMF9lbmFibGVfcGxh
bmUoZGMsIHBpcGVfY3R4LCBjb250ZXh0KTsKLQotCXVwZGF0ZV9kY2h1YnBfZHBwKGRjLCBwaXBl
X2N0eCwgY29udGV4dCk7Ci0KLQlzZXRfaGRyX211bHRpcGxpZXIocGlwZV9jdHgpOwotCi0JaWYg
KHBpcGVfY3R4LT5wbGFuZV9zdGF0ZS0+dXBkYXRlX2ZsYWdzLmJpdHMuZnVsbF91cGRhdGUgfHwK
LQkJCXBpcGVfY3R4LT5wbGFuZV9zdGF0ZS0+dXBkYXRlX2ZsYWdzLmJpdHMuaW5fdHJhbnNmZXJf
ZnVuY19jaGFuZ2UgfHwKLQkJCXBpcGVfY3R4LT5wbGFuZV9zdGF0ZS0+dXBkYXRlX2ZsYWdzLmJp
dHMuZ2FtbWFfY2hhbmdlKQotCQlkYy0+aHdzcy5zZXRfaW5wdXRfdHJhbnNmZXJfZnVuYyhwaXBl
X2N0eCwgcGlwZV9jdHgtPnBsYW5lX3N0YXRlKTsKLQotCS8qIGRjbjEwX3RyYW5zbGF0ZV9yZWdh
bW1hX3RvX2h3X2Zvcm1hdCB0YWtlcyA3NTB1cyB0byBmaW5pc2gKLQkgKiBvbmx5IGRvIGdhbW1h
IHByb2dyYW1taW5nIGZvciBmdWxsIHVwZGF0ZS4KLQkgKiBUT0RPOiBUaGlzIGNhbiBiZSBmdXJ0
aGVyIG9wdGltaXplZC9jbGVhbmVkIHVwCi0JICogQWx3YXlzIGNhbGwgdGhpcyBmb3Igbm93IHNp
bmNlIGl0IGRvZXMgbWVtY21wIGluc2lkZSBiZWZvcmUKLQkgKiBkb2luZyBoZWF2eSBjYWxjdWxh
dGlvbiBhbmQgcHJvZ3JhbW1pbmcKLQkgKi8KLQlpZiAocGlwZV9jdHgtPnBsYW5lX3N0YXRlLT51
cGRhdGVfZmxhZ3MuYml0cy5mdWxsX3VwZGF0ZSkKLQkJZGMtPmh3c3Muc2V0X291dHB1dF90cmFu
c2Zlcl9mdW5jKHBpcGVfY3R4LCBwaXBlX2N0eC0+c3RyZWFtKTsKLX0KLQotc3RhdGljIHZvaWQg
ZGNuMjBfcHJvZ3JhbV9hbGxfcGlwZV9pbl90cmVlKAotCQlzdHJ1Y3QgZGMgKmRjLAotCQlzdHJ1
Y3QgcGlwZV9jdHggKnBpcGVfY3R4LAotCQlzdHJ1Y3QgZGNfc3RhdGUgKmNvbnRleHQpCi17Ci0J
aWYgKHBpcGVfY3R4LT50b3BfcGlwZSA9PSBOVUxMICYmICFwaXBlX2N0eC0+cHJldl9vZG1fcGlw
ZSkgewotCQlib29sIGJsYW5rID0gIWlzX3BpcGVfdHJlZV92aXNpYmxlKHBpcGVfY3R4KTsKLQot
CQlwaXBlX2N0eC0+c3RyZWFtX3Jlcy50Zy0+ZnVuY3MtPnByb2dyYW1fZ2xvYmFsX3N5bmMoCi0J
CQkJcGlwZV9jdHgtPnN0cmVhbV9yZXMudGcsCi0JCQkJcGlwZV9jdHgtPnBpcGVfZGxnX3BhcmFt
LnZyZWFkeV9vZmZzZXQsCi0JCQkJcGlwZV9jdHgtPnBpcGVfZGxnX3BhcmFtLnZzdGFydHVwX3N0
YXJ0LAotCQkJCXBpcGVfY3R4LT5waXBlX2RsZ19wYXJhbS52dXBkYXRlX29mZnNldCwKLQkJCQlw
aXBlX2N0eC0+cGlwZV9kbGdfcGFyYW0udnVwZGF0ZV93aWR0aCk7Ci0KLQkJcGlwZV9jdHgtPnN0
cmVhbV9yZXMudGctPmZ1bmNzLT5zZXRfdnRnX3BhcmFtcygKLQkJCQlwaXBlX2N0eC0+c3RyZWFt
X3Jlcy50ZywgJnBpcGVfY3R4LT5zdHJlYW0tPnRpbWluZyk7Ci0KLQkJZGMtPmh3c3MuYmxhbmtf
cGl4ZWxfZGF0YShkYywgcGlwZV9jdHgsIGJsYW5rKTsKLQotCQlpZiAoZGMtPmh3c3MudXBkYXRl
X29kbSkKLQkJCWRjLT5od3NzLnVwZGF0ZV9vZG0oZGMsIGNvbnRleHQsIHBpcGVfY3R4KTsKLQl9
Ci0KLQlpZiAocGlwZV9jdHgtPnBsYW5lX3N0YXRlICE9IE5VTEwpCi0JCWRjbjIwX3Byb2dyYW1f
cGlwZShkYywgcGlwZV9jdHgsIGNvbnRleHQpOwotCi0JaWYgKHBpcGVfY3R4LT5ib3R0b21fcGlw
ZSAhPSBOVUxMKSB7Ci0JCUFTU0VSVChwaXBlX2N0eC0+Ym90dG9tX3BpcGUgIT0gcGlwZV9jdHgp
OwotCQlkY24yMF9wcm9ncmFtX2FsbF9waXBlX2luX3RyZWUoZGMsIHBpcGVfY3R4LT5ib3R0b21f
cGlwZSwgY29udGV4dCk7Ci0JfSBlbHNlIGlmIChwaXBlX2N0eC0+bmV4dF9vZG1fcGlwZSAhPSBO
VUxMKSB7Ci0JCUFTU0VSVChwaXBlX2N0eC0+bmV4dF9vZG1fcGlwZSAhPSBwaXBlX2N0eCk7Ci0J
CWRjbjIwX3Byb2dyYW1fYWxsX3BpcGVfaW5fdHJlZShkYywgcGlwZV9jdHgtPm5leHRfb2RtX3Bp
cGUsIGNvbnRleHQpOwotCX0KLX0KLQogdm9pZCBkY24yMF9waXBlX2NvbnRyb2xfbG9ja19nbG9i
YWwoCiAJCXN0cnVjdCBkYyAqZGMsCiAJCXN0cnVjdCBwaXBlX2N0eCAqcGlwZSwKQEAgLTEwODcs
NyArMTAyMSw3IEBAIHZvaWQgZGNuMjBfcGlwZV9jb250cm9sX2xvY2tfZ2xvYmFsKAogCX0KIH0K
IAotdm9pZCBkY24yMF9waXBlX2NvbnRyb2xfbG9jaygKK3N0YXRpYyB2b2lkIGRjbjIwX3BpcGVf
Y29udHJvbF9sb2NrKAogCXN0cnVjdCBkYyAqZGMsCiAJc3RydWN0IHBpcGVfY3R4ICpwaXBlLAog
CWJvb2wgbG9jaykKQEAgLTExMjQsMTE0ICsxMDU4LDQzNiBAQCB2b2lkIGRjbjIwX3BpcGVfY29u
dHJvbF9sb2NrKAogCX0KIH0KIAotc3RhdGljIHZvaWQgZGNuMjBfYXBwbHlfY3R4X2Zvcl9zdXJm
YWNlKAotCQlzdHJ1Y3QgZGMgKmRjLAotCQljb25zdCBzdHJ1Y3QgZGNfc3RyZWFtX3N0YXRlICpz
dHJlYW0sCi0JCWludCBudW1fcGxhbmVzLAotCQlzdHJ1Y3QgZGNfc3RhdGUgKmNvbnRleHQpCitz
dGF0aWMgdm9pZCBkY24yMF9kZXRlY3RfcGlwZV9jaGFuZ2VzKHN0cnVjdCBwaXBlX2N0eCAqb2xk
X3BpcGUsIHN0cnVjdCBwaXBlX2N0eCAqbmV3X3BpcGUpCiB7Ci0JY29uc3QgdW5zaWduZWQgaW50
IFRJTUVPVVRfRk9SX1BJUEVfRU5BQkxFX01TID0gMTAwOwotCWludCBpOwotCXN0cnVjdCB0aW1p
bmdfZ2VuZXJhdG9yICp0ZzsKLQlib29sIHJlbW92ZWRfcGlwZVs2XSA9IHsgZmFsc2UgfTsKLQli
b29sIGludGVyZGVwZW5kZW50X3VwZGF0ZSA9IGZhbHNlOwotCXN0cnVjdCBwaXBlX2N0eCAqdG9w
X3BpcGVfdG9fcHJvZ3JhbSA9Ci0JCQlmaW5kX3RvcF9waXBlX2Zvcl9zdHJlYW0oZGMsIGNvbnRl
eHQsIHN0cmVhbSk7Ci0Jc3RydWN0IHBpcGVfY3R4ICpwcmV2X3RvcF9waXBlX3RvX3Byb2dyYW0g
PQotCQkJZmluZF90b3BfcGlwZV9mb3Jfc3RyZWFtKGRjLCBkYy0+Y3VycmVudF9zdGF0ZSwgc3Ry
ZWFtKTsKLQlEQ19MT0dHRVJfSU5JVChkYy0+Y3R4LT5sb2dnZXIpOworCW5ld19waXBlLT51cGRh
dGVfZmxhZ3MucmF3ID0gMDsKIAotCWlmICghdG9wX3BpcGVfdG9fcHJvZ3JhbSkKKwkvKiBFeGl0
IG9uIHVuY2hhbmdlZCwgdW51c2VkIHBpcGUgKi8KKwlpZiAoIW9sZF9waXBlLT5wbGFuZV9zdGF0
ZSAmJiAhbmV3X3BpcGUtPnBsYW5lX3N0YXRlKQogCQlyZXR1cm47CisJLyogRGV0ZWN0IHBpcGUg
ZW5hYmxlL2Rpc2FibGUgKi8KKwlpZiAoIW9sZF9waXBlLT5wbGFuZV9zdGF0ZSAmJiBuZXdfcGlw
ZS0+cGxhbmVfc3RhdGUpIHsKKwkJbmV3X3BpcGUtPnVwZGF0ZV9mbGFncy5iaXRzLmVuYWJsZSA9
IDE7CisJCW5ld19waXBlLT51cGRhdGVfZmxhZ3MuYml0cy5tcGNjID0gMTsKKwkJbmV3X3BpcGUt
PnVwZGF0ZV9mbGFncy5iaXRzLmRwcGNsayA9IDE7CisJCW5ld19waXBlLT51cGRhdGVfZmxhZ3Mu
Yml0cy5odWJwX2ludGVyZGVwZW5kZW50ID0gMTsKKwkJbmV3X3BpcGUtPnVwZGF0ZV9mbGFncy5i
aXRzLmh1YnBfcnFfZGxnX3R0dSA9IDE7CisJCW5ld19waXBlLT51cGRhdGVfZmxhZ3MuYml0cy5n
YW11dF9yZW1hcCA9IDE7CisJCW5ld19waXBlLT51cGRhdGVfZmxhZ3MuYml0cy5zY2FsZXIgPSAx
OworCQluZXdfcGlwZS0+dXBkYXRlX2ZsYWdzLmJpdHMudmlld3BvcnQgPSAxOworCQlpZiAoIW5l
d19waXBlLT50b3BfcGlwZSAmJiAhbmV3X3BpcGUtPnByZXZfb2RtX3BpcGUpIHsKKwkJCW5ld19w
aXBlLT51cGRhdGVfZmxhZ3MuYml0cy5vZG0gPSAxOworCQkJbmV3X3BpcGUtPnVwZGF0ZV9mbGFn
cy5iaXRzLmdsb2JhbF9zeW5jID0gMTsKKwkJfQorCQlyZXR1cm47CisJfQorCWlmIChvbGRfcGlw
ZS0+cGxhbmVfc3RhdGUgJiYgIW5ld19waXBlLT5wbGFuZV9zdGF0ZSkgeworCQluZXdfcGlwZS0+
dXBkYXRlX2ZsYWdzLmJpdHMuZGlzYWJsZSA9IDE7CisJCXJldHVybjsKKwl9CiAKLQkvKiBDYXJy
eSBvdmVyIEdTTCBncm91cHMgaW4gY2FzZSB0aGUgY29udGV4dCBpcyBjaGFuZ2luZy4gKi8KLQlm
b3IgKGkgPSAwOyBpIDwgZGMtPnJlc19wb29sLT5waXBlX2NvdW50OyBpKyspIHsKLQkJc3RydWN0
IHBpcGVfY3R4ICpwaXBlX2N0eCA9ICZjb250ZXh0LT5yZXNfY3R4LnBpcGVfY3R4W2ldOwotCQlz
dHJ1Y3QgcGlwZV9jdHggKm9sZF9waXBlX2N0eCA9Ci0JCQkmZGMtPmN1cnJlbnRfc3RhdGUtPnJl
c19jdHgucGlwZV9jdHhbaV07CisJLyogRGV0ZWN0IHRvcCBwaXBlIG9ubHkgY2hhbmdlcyAqLwor
CWlmICghbmV3X3BpcGUtPnRvcF9waXBlICYmICFuZXdfcGlwZS0+cHJldl9vZG1fcGlwZSkgewor
CQkvKiBEZXRlY3Qgb2RtIGNoYW5nZXMgKi8KKwkJaWYgKChvbGRfcGlwZS0+bmV4dF9vZG1fcGlw
ZSAmJiBuZXdfcGlwZS0+bmV4dF9vZG1fcGlwZQorCQkJJiYgb2xkX3BpcGUtPm5leHRfb2RtX3Bp
cGUtPnBpcGVfaWR4ICE9IG5ld19waXBlLT5uZXh0X29kbV9waXBlLT5waXBlX2lkeCkKKwkJCQl8
fCAoIW9sZF9waXBlLT5uZXh0X29kbV9waXBlICYmIG5ld19waXBlLT5uZXh0X29kbV9waXBlKQor
CQkJCXx8IChvbGRfcGlwZS0+bmV4dF9vZG1fcGlwZSAmJiAhbmV3X3BpcGUtPm5leHRfb2RtX3Bp
cGUpCisJCQkJfHwgb2xkX3BpcGUtPnN0cmVhbV9yZXMub3BwICE9IG5ld19waXBlLT5zdHJlYW1f
cmVzLm9wcCkKKwkJCW5ld19waXBlLT51cGRhdGVfZmxhZ3MuYml0cy5vZG0gPSAxOworCisJCS8q
IERldGVjdCBnbG9iYWwgc3luYyBjaGFuZ2VzICovCisJCWlmIChvbGRfcGlwZS0+cGlwZV9kbGdf
cGFyYW0udnJlYWR5X29mZnNldCAhPSBuZXdfcGlwZS0+cGlwZV9kbGdfcGFyYW0udnJlYWR5X29m
ZnNldAorCQkJCXx8IG9sZF9waXBlLT5waXBlX2RsZ19wYXJhbS52c3RhcnR1cF9zdGFydCAhPSBu
ZXdfcGlwZS0+cGlwZV9kbGdfcGFyYW0udnN0YXJ0dXBfc3RhcnQKKwkJCQl8fCBvbGRfcGlwZS0+
cGlwZV9kbGdfcGFyYW0udnVwZGF0ZV9vZmZzZXQgIT0gbmV3X3BpcGUtPnBpcGVfZGxnX3BhcmFt
LnZ1cGRhdGVfb2Zmc2V0CisJCQkJfHwgb2xkX3BpcGUtPnBpcGVfZGxnX3BhcmFtLnZ1cGRhdGVf
d2lkdGggIT0gbmV3X3BpcGUtPnBpcGVfZGxnX3BhcmFtLnZ1cGRhdGVfd2lkdGgpCisJCQluZXdf
cGlwZS0+dXBkYXRlX2ZsYWdzLmJpdHMuZ2xvYmFsX3N5bmMgPSAxOworCX0KIAotCQlpZiAocGlw
ZV9jdHgtPnN0cmVhbSA9PSBzdHJlYW0gJiYKLQkJICAgIHBpcGVfY3R4LT5zdHJlYW0gPT0gb2xk
X3BpcGVfY3R4LT5zdHJlYW0pCi0JCQlwaXBlX2N0eC0+c3RyZWFtX3Jlcy5nc2xfZ3JvdXAgPQot
CQkJCW9sZF9waXBlX2N0eC0+c3RyZWFtX3Jlcy5nc2xfZ3JvdXA7CisJLyoKKwkgKiBEZXRlY3Qg
b3BwIC8gdGcgY2hhbmdlLCBvbmx5IHNldCBvbiBjaGFuZ2UsIG5vdCBvbiBlbmFibGUKKwkgKiBB
c3N1bWUgbXBjYyBpbnN0ID0gcGlwZSBpbmRleCwgaWYgbm90IHRoaXMgY29kZSBuZWVkcyB0byBi
ZSB1cGRhdGVkCisJICogc2luY2UgbXBjYyBpcyB3aGF0IGlzIGFmZmVjdGVkIGJ5IHRoZXNlLiBJ
biBmYWN0IGFsbCBvZiBvdXIgc2VxdWVuY2UKKwkgKiBtYWtlcyB0aGlzIGFzc3VtcHRpb24gYXQg
dGhlIG1vbWVudCB3aXRoIGhvdyBodWJwIHJlc2V0IGlzIG1hdGNoZWQgdG8KKwkgKiBzYW1lIGlu
ZGV4IG1wY2MgcmVzZXQuCisJICovCisJaWYgKG9sZF9waXBlLT5zdHJlYW1fcmVzLm9wcCAhPSBu
ZXdfcGlwZS0+c3RyZWFtX3Jlcy5vcHApCisJCW5ld19waXBlLT51cGRhdGVfZmxhZ3MuYml0cy5v
cHBfY2hhbmdlZCA9IDE7CisJaWYgKG9sZF9waXBlLT5zdHJlYW1fcmVzLnRnICE9IG5ld19waXBl
LT5zdHJlYW1fcmVzLnRnKQorCQluZXdfcGlwZS0+dXBkYXRlX2ZsYWdzLmJpdHMudGdfY2hhbmdl
ZCA9IDE7CisKKwkvKiBEZXRlY3QgbXBjYyBibGVuZGluZyBjaGFuZ2VzLCBvbmx5IGRwcCBpbnN0
IGFuZCBib3QgbWF0dGVyIGhlcmUgKi8KKwlpZiAob2xkX3BpcGUtPnBsYW5lX3Jlcy5kcHAgIT0g
bmV3X3BpcGUtPnBsYW5lX3Jlcy5kcHAKKwkJCXx8IG9sZF9waXBlLT5zdHJlYW1fcmVzLm9wcCAh
PSBuZXdfcGlwZS0+c3RyZWFtX3Jlcy5vcHAKKwkJCXx8ICghb2xkX3BpcGUtPmJvdHRvbV9waXBl
ICYmIG5ld19waXBlLT5ib3R0b21fcGlwZSkKKwkJCXx8IChvbGRfcGlwZS0+Ym90dG9tX3BpcGUg
JiYgIW5ld19waXBlLT5ib3R0b21fcGlwZSkKKwkJCXx8IChvbGRfcGlwZS0+Ym90dG9tX3BpcGUg
JiYgbmV3X3BpcGUtPmJvdHRvbV9waXBlCisJCQkJJiYgb2xkX3BpcGUtPmJvdHRvbV9waXBlLT5w
bGFuZV9yZXMubXBjY19pbnN0CisJCQkJCSE9IG5ld19waXBlLT5ib3R0b21fcGlwZS0+cGxhbmVf
cmVzLm1wY2NfaW5zdCkpCisJCW5ld19waXBlLT51cGRhdGVfZmxhZ3MuYml0cy5tcGNjID0gMTsK
KworCS8qIERldGVjdCBkcHBjbGsgY2hhbmdlICovCisJaWYgKG9sZF9waXBlLT5wbGFuZV9yZXMu
YncuZHBwY2xrX2toeiAhPSBuZXdfcGlwZS0+cGxhbmVfcmVzLmJ3LmRwcGNsa19raHopCisJCW5l
d19waXBlLT51cGRhdGVfZmxhZ3MuYml0cy5kcHBjbGsgPSAxOworCisJLyogQ2hlY2sgZm9yIHNj
bCB1cGRhdGUgKi8KKwlpZiAobWVtY21wKCZvbGRfcGlwZS0+cGxhbmVfcmVzLnNjbF9kYXRhLCAm
bmV3X3BpcGUtPnBsYW5lX3Jlcy5zY2xfZGF0YSwgc2l6ZW9mKHN0cnVjdCBzY2FsZXJfZGF0YSkp
KQorCQkJbmV3X3BpcGUtPnVwZGF0ZV9mbGFncy5iaXRzLnNjYWxlciA9IDE7CisJLyogQ2hlY2sg
Zm9yIHZwIHVwZGF0ZSAqLworCWlmIChtZW1jbXAoJm9sZF9waXBlLT5wbGFuZV9yZXMuc2NsX2Rh
dGEudmlld3BvcnQsICZuZXdfcGlwZS0+cGxhbmVfcmVzLnNjbF9kYXRhLnZpZXdwb3J0LCBzaXpl
b2Yoc3RydWN0IHJlY3QpKQorCQkJfHwgbWVtY21wKCZvbGRfcGlwZS0+cGxhbmVfcmVzLnNjbF9k
YXRhLnZpZXdwb3J0X2MsCisJCQkJJm5ld19waXBlLT5wbGFuZV9yZXMuc2NsX2RhdGEudmlld3Bv
cnRfYywgc2l6ZW9mKHN0cnVjdCByZWN0KSkpCisJCW5ld19waXBlLT51cGRhdGVfZmxhZ3MuYml0
cy52aWV3cG9ydCA9IDE7CisKKwkvKiBEZXRlY3QgZGxnL3R0dS9ycSB1cGRhdGVzICovCisJewor
CQlzdHJ1Y3QgX3Zjc19kcGlfZGlzcGxheV9kbGdfcmVnc19zdCBvbGRfZGxnX2F0dHIgPSBvbGRf
cGlwZS0+ZGxnX3JlZ3M7CisJCXN0cnVjdCBfdmNzX2RwaV9kaXNwbGF5X3R0dV9yZWdzX3N0IG9s
ZF90dHVfYXR0ciA9IG9sZF9waXBlLT50dHVfcmVnczsKKwkJc3RydWN0IF92Y3NfZHBpX2Rpc3Bs
YXlfZGxnX3JlZ3Nfc3QgKm5ld19kbGdfYXR0ciA9ICZuZXdfcGlwZS0+ZGxnX3JlZ3M7CisJCXN0
cnVjdCBfdmNzX2RwaV9kaXNwbGF5X3R0dV9yZWdzX3N0ICpuZXdfdHR1X2F0dHIgPSAmbmV3X3Bp
cGUtPnR0dV9yZWdzOworCisJCS8qIERldGVjdCBwaXBlIGludGVyZGVwZW5kZW50IHVwZGF0ZXMg
Ki8KKwkJaWYgKG9sZF9kbGdfYXR0ci5kc3RfeV9wcmVmZXRjaCAhPSBuZXdfZGxnX2F0dHItPmRz
dF95X3ByZWZldGNoIHx8CisJCQkJb2xkX2RsZ19hdHRyLnZyYXRpb19wcmVmZXRjaCAhPSBuZXdf
ZGxnX2F0dHItPnZyYXRpb19wcmVmZXRjaCB8fAorCQkJCW9sZF9kbGdfYXR0ci52cmF0aW9fcHJl
ZmV0Y2hfYyAhPSBuZXdfZGxnX2F0dHItPnZyYXRpb19wcmVmZXRjaF9jIHx8CisJCQkJb2xkX2Rs
Z19hdHRyLmRzdF95X3Blcl92bV92YmxhbmsgIT0gbmV3X2RsZ19hdHRyLT5kc3RfeV9wZXJfdm1f
dmJsYW5rIHx8CisJCQkJb2xkX2RsZ19hdHRyLmRzdF95X3Blcl9yb3dfdmJsYW5rICE9IG5ld19k
bGdfYXR0ci0+ZHN0X3lfcGVyX3Jvd192YmxhbmsgfHwKKwkJCQlvbGRfZGxnX2F0dHIuZHN0X3lf
cGVyX3ZtX2ZsaXAgIT0gbmV3X2RsZ19hdHRyLT5kc3RfeV9wZXJfdm1fZmxpcCB8fAorCQkJCW9s
ZF9kbGdfYXR0ci5kc3RfeV9wZXJfcm93X2ZsaXAgIT0gbmV3X2RsZ19hdHRyLT5kc3RfeV9wZXJf
cm93X2ZsaXAgfHwKKwkJCQlvbGRfZGxnX2F0dHIucmVmY3ljX3Blcl9tZXRhX2NodW5rX3ZibGFu
a19sICE9IG5ld19kbGdfYXR0ci0+cmVmY3ljX3Blcl9tZXRhX2NodW5rX3ZibGFua19sIHx8CisJ
CQkJb2xkX2RsZ19hdHRyLnJlZmN5Y19wZXJfbWV0YV9jaHVua192YmxhbmtfYyAhPSBuZXdfZGxn
X2F0dHItPnJlZmN5Y19wZXJfbWV0YV9jaHVua192YmxhbmtfYyB8fAorCQkJCW9sZF9kbGdfYXR0
ci5yZWZjeWNfcGVyX21ldGFfY2h1bmtfZmxpcF9sICE9IG5ld19kbGdfYXR0ci0+cmVmY3ljX3Bl
cl9tZXRhX2NodW5rX2ZsaXBfbCB8fAorCQkJCW9sZF9kbGdfYXR0ci5yZWZjeWNfcGVyX2xpbmVf
ZGVsaXZlcnlfcHJlX2wgIT0gbmV3X2RsZ19hdHRyLT5yZWZjeWNfcGVyX2xpbmVfZGVsaXZlcnlf
cHJlX2wgfHwKKwkJCQlvbGRfZGxnX2F0dHIucmVmY3ljX3Blcl9saW5lX2RlbGl2ZXJ5X3ByZV9j
ICE9IG5ld19kbGdfYXR0ci0+cmVmY3ljX3Blcl9saW5lX2RlbGl2ZXJ5X3ByZV9jIHx8CisJCQkJ
b2xkX3R0dV9hdHRyLnJlZmN5Y19wZXJfcmVxX2RlbGl2ZXJ5X3ByZV9sICE9IG5ld190dHVfYXR0
ci0+cmVmY3ljX3Blcl9yZXFfZGVsaXZlcnlfcHJlX2wgfHwKKwkJCQlvbGRfdHR1X2F0dHIucmVm
Y3ljX3Blcl9yZXFfZGVsaXZlcnlfcHJlX2MgIT0gbmV3X3R0dV9hdHRyLT5yZWZjeWNfcGVyX3Jl
cV9kZWxpdmVyeV9wcmVfYyB8fAorCQkJCW9sZF90dHVfYXR0ci5yZWZjeWNfcGVyX3JlcV9kZWxp
dmVyeV9wcmVfY3VyMCAhPSBuZXdfdHR1X2F0dHItPnJlZmN5Y19wZXJfcmVxX2RlbGl2ZXJ5X3By
ZV9jdXIwIHx8CisJCQkJb2xkX3R0dV9hdHRyLnJlZmN5Y19wZXJfcmVxX2RlbGl2ZXJ5X3ByZV9j
dXIxICE9IG5ld190dHVfYXR0ci0+cmVmY3ljX3Blcl9yZXFfZGVsaXZlcnlfcHJlX2N1cjEgfHwK
KwkJCQlvbGRfdHR1X2F0dHIubWluX3R0dV92YmxhbmsgIT0gbmV3X3R0dV9hdHRyLT5taW5fdHR1
X3ZibGFuayB8fAorCQkJCW9sZF90dHVfYXR0ci5xb3NfbGV2ZWxfZmxpcCAhPSBuZXdfdHR1X2F0
dHItPnFvc19sZXZlbF9mbGlwKSB7CisJCQlvbGRfZGxnX2F0dHIuZHN0X3lfcHJlZmV0Y2ggPSBu
ZXdfZGxnX2F0dHItPmRzdF95X3ByZWZldGNoOworCQkJb2xkX2RsZ19hdHRyLnZyYXRpb19wcmVm
ZXRjaCA9IG5ld19kbGdfYXR0ci0+dnJhdGlvX3ByZWZldGNoOworCQkJb2xkX2RsZ19hdHRyLnZy
YXRpb19wcmVmZXRjaF9jID0gbmV3X2RsZ19hdHRyLT52cmF0aW9fcHJlZmV0Y2hfYzsKKwkJCW9s
ZF9kbGdfYXR0ci5kc3RfeV9wZXJfdm1fdmJsYW5rID0gbmV3X2RsZ19hdHRyLT5kc3RfeV9wZXJf
dm1fdmJsYW5rOworCQkJb2xkX2RsZ19hdHRyLmRzdF95X3Blcl9yb3dfdmJsYW5rID0gbmV3X2Rs
Z19hdHRyLT5kc3RfeV9wZXJfcm93X3ZibGFuazsKKwkJCW9sZF9kbGdfYXR0ci5kc3RfeV9wZXJf
dm1fZmxpcCA9IG5ld19kbGdfYXR0ci0+ZHN0X3lfcGVyX3ZtX2ZsaXA7CisJCQlvbGRfZGxnX2F0
dHIuZHN0X3lfcGVyX3Jvd19mbGlwID0gbmV3X2RsZ19hdHRyLT5kc3RfeV9wZXJfcm93X2ZsaXA7
CisJCQlvbGRfZGxnX2F0dHIucmVmY3ljX3Blcl9tZXRhX2NodW5rX3ZibGFua19sID0gbmV3X2Rs
Z19hdHRyLT5yZWZjeWNfcGVyX21ldGFfY2h1bmtfdmJsYW5rX2w7CisJCQlvbGRfZGxnX2F0dHIu
cmVmY3ljX3Blcl9tZXRhX2NodW5rX3ZibGFua19jID0gbmV3X2RsZ19hdHRyLT5yZWZjeWNfcGVy
X21ldGFfY2h1bmtfdmJsYW5rX2M7CisJCQlvbGRfZGxnX2F0dHIucmVmY3ljX3Blcl9tZXRhX2No
dW5rX2ZsaXBfbCA9IG5ld19kbGdfYXR0ci0+cmVmY3ljX3Blcl9tZXRhX2NodW5rX2ZsaXBfbDsK
KwkJCW9sZF9kbGdfYXR0ci5yZWZjeWNfcGVyX2xpbmVfZGVsaXZlcnlfcHJlX2wgPSBuZXdfZGxn
X2F0dHItPnJlZmN5Y19wZXJfbGluZV9kZWxpdmVyeV9wcmVfbDsKKwkJCW9sZF9kbGdfYXR0ci5y
ZWZjeWNfcGVyX2xpbmVfZGVsaXZlcnlfcHJlX2MgPSBuZXdfZGxnX2F0dHItPnJlZmN5Y19wZXJf
bGluZV9kZWxpdmVyeV9wcmVfYzsKKwkJCW9sZF90dHVfYXR0ci5yZWZjeWNfcGVyX3JlcV9kZWxp
dmVyeV9wcmVfbCA9IG5ld190dHVfYXR0ci0+cmVmY3ljX3Blcl9yZXFfZGVsaXZlcnlfcHJlX2w7
CisJCQlvbGRfdHR1X2F0dHIucmVmY3ljX3Blcl9yZXFfZGVsaXZlcnlfcHJlX2MgPSBuZXdfdHR1
X2F0dHItPnJlZmN5Y19wZXJfcmVxX2RlbGl2ZXJ5X3ByZV9jOworCQkJb2xkX3R0dV9hdHRyLnJl
ZmN5Y19wZXJfcmVxX2RlbGl2ZXJ5X3ByZV9jdXIwID0gbmV3X3R0dV9hdHRyLT5yZWZjeWNfcGVy
X3JlcV9kZWxpdmVyeV9wcmVfY3VyMDsKKwkJCW9sZF90dHVfYXR0ci5yZWZjeWNfcGVyX3JlcV9k
ZWxpdmVyeV9wcmVfY3VyMSA9IG5ld190dHVfYXR0ci0+cmVmY3ljX3Blcl9yZXFfZGVsaXZlcnlf
cHJlX2N1cjE7CisJCQlvbGRfdHR1X2F0dHIubWluX3R0dV92YmxhbmsgPSBuZXdfdHR1X2F0dHIt
Pm1pbl90dHVfdmJsYW5rOworCQkJb2xkX3R0dV9hdHRyLnFvc19sZXZlbF9mbGlwID0gbmV3X3R0
dV9hdHRyLT5xb3NfbGV2ZWxfZmxpcDsKKwkJCW5ld19waXBlLT51cGRhdGVfZmxhZ3MuYml0cy5o
dWJwX2ludGVyZGVwZW5kZW50ID0gMTsKKwkJfQorCQkvKiBEZXRlY3QgYW55IG90aGVyIHVwZGF0
ZXMgdG8gdHR1L3JxL2RsZyAqLworCQlpZiAobWVtY21wKCZvbGRfZGxnX2F0dHIsICZuZXdfcGlw
ZS0+ZGxnX3JlZ3MsIHNpemVvZihvbGRfZGxnX2F0dHIpKSB8fAorCQkJCW1lbWNtcCgmb2xkX3R0
dV9hdHRyLCAmbmV3X3BpcGUtPnR0dV9yZWdzLCBzaXplb2Yob2xkX3R0dV9hdHRyKSkgfHwKKwkJ
CQltZW1jbXAoJm9sZF9waXBlLT5ycV9yZWdzLCAmbmV3X3BpcGUtPnJxX3JlZ3MsIHNpemVvZihv
bGRfcGlwZS0+cnFfcmVncykpKQorCQkJbmV3X3BpcGUtPnVwZGF0ZV9mbGFncy5iaXRzLmh1YnBf
cnFfZGxnX3R0dSA9IDE7CiAJfQorfQogCi0JdGcgPSB0b3BfcGlwZV90b19wcm9ncmFtLT5zdHJl
YW1fcmVzLnRnOworc3RhdGljIHZvaWQgZGNuMjBfdXBkYXRlX2RjaHVicF9kcHAoCisJc3RydWN0
IGRjICpkYywKKwlzdHJ1Y3QgcGlwZV9jdHggKnBpcGVfY3R4LAorCXN0cnVjdCBkY19zdGF0ZSAq
Y29udGV4dCkKK3sKKwlzdHJ1Y3QgaHVicCAqaHVicCA9IHBpcGVfY3R4LT5wbGFuZV9yZXMuaHVi
cDsKKwlzdHJ1Y3QgZHBwICpkcHAgPSBwaXBlX2N0eC0+cGxhbmVfcmVzLmRwcDsKKwlzdHJ1Y3Qg
ZGNfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlID0gcGlwZV9jdHgtPnBsYW5lX3N0YXRlOwogCi0J
aW50ZXJkZXBlbmRlbnRfdXBkYXRlID0gdG9wX3BpcGVfdG9fcHJvZ3JhbS0+cGxhbmVfc3RhdGUg
JiYKLQkJdG9wX3BpcGVfdG9fcHJvZ3JhbS0+cGxhbmVfc3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRz
LmZ1bGxfdXBkYXRlOworCWlmIChwaXBlX2N0eC0+dXBkYXRlX2ZsYWdzLmJpdHMuZHBwY2xrKSB7
CisJCWRwcC0+ZnVuY3MtPmRwcF9kcHBjbGtfY29udHJvbChkcHAsIGZhbHNlLCB0cnVlKTsKIAot
CWlmIChpbnRlcmRlcGVuZGVudF91cGRhdGUpCi0JCWxvY2tfYWxsX3BpcGVzKGRjLCBjb250ZXh0
LCB0cnVlKTsKLQllbHNlCi0JCWRjbjIwX3BpcGVfY29udHJvbF9sb2NrKGRjLCB0b3BfcGlwZV90
b19wcm9ncmFtLCB0cnVlKTsKKwkJZGMtPnJlc19wb29sLT5kY2NnLT5mdW5jcy0+dXBkYXRlX2Rw
cF9kdG8oCisJCQkJZGMtPnJlc19wb29sLT5kY2NnLAorCQkJCWRwcC0+aW5zdCwKKwkJCQlwaXBl
X2N0eC0+cGxhbmVfcmVzLmJ3LmRwcGNsa19raHosCisJCQkJZmFsc2UpOworCX0KIAotCWlmIChu
dW1fcGxhbmVzID09IDApIHsKLQkJLyogT1RHIGJsYW5rIGJlZm9yZSByZW1vdmUgYWxsIGZyb250
IGVuZCAqLwotCQlkYy0+aHdzcy5ibGFua19waXhlbF9kYXRhKGRjLCB0b3BfcGlwZV90b19wcm9n
cmFtLCB0cnVlKTsKKwkvKiBUT0RPOiBOZWVkIGlucHV0IHBhcmFtZXRlciB0byB0ZWxsIGN1cnJl
bnQgRENIVUIgcGlwZSB0aWUgdG8gd2hpY2ggT1RHCisJICogVlRHIGlzIHdpdGhpbiBEQ0hVQkJV
QiB3aGljaCBpcyBjb21tb25kIGJsb2NrIHNoYXJlIGJ5IGVhY2ggcGlwZSBIVUJQLgorCSAqIFZU
RyBpcyAxOjEgbWFwcGluZyB3aXRoIE9URy4gRWFjaCBwaXBlIEhVQlAgd2lsbCBzZWxlY3Qgd2hp
Y2ggVlRHCisJICovCisJaWYgKHBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5odWJwX3JxX2Rs
Z190dHUpIHsKKwkJaHVicC0+ZnVuY3MtPmh1YnBfdnRnX3NlbChodWJwLCBwaXBlX2N0eC0+c3Ry
ZWFtX3Jlcy50Zy0+aW5zdCk7CisKKwkJaHVicC0+ZnVuY3MtPmh1YnBfc2V0dXAoCisJCQlodWJw
LAorCQkJJnBpcGVfY3R4LT5kbGdfcmVncywKKwkJCSZwaXBlX2N0eC0+dHR1X3JlZ3MsCisJCQkm
cGlwZV9jdHgtPnJxX3JlZ3MsCisJCQkmcGlwZV9jdHgtPnBpcGVfZGxnX3BhcmFtKTsKKwl9CisJ
aWYgKHBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5odWJwX2ludGVyZGVwZW5kZW50KQorCQlo
dWJwLT5mdW5jcy0+aHVicF9zZXR1cF9pbnRlcmRlcGVuZGVudCgKKwkJCWh1YnAsCisJCQkmcGlw
ZV9jdHgtPmRsZ19yZWdzLAorCQkJJnBpcGVfY3R4LT50dHVfcmVncyk7CisKKwlpZiAocGlwZV9j
dHgtPnVwZGF0ZV9mbGFncy5iaXRzLmVuYWJsZSB8fAorCQkJcGxhbmVfc3RhdGUtPnVwZGF0ZV9m
bGFncy5iaXRzLmJwcF9jaGFuZ2UgfHwKKwkJCXBsYW5lX3N0YXRlLT51cGRhdGVfZmxhZ3MuYml0
cy5pbnB1dF9jc2NfY2hhbmdlIHx8CisJCQlwbGFuZV9zdGF0ZS0+dXBkYXRlX2ZsYWdzLmJpdHMu
Y29sb3Jfc3BhY2VfY2hhbmdlIHx8CisJCQlwbGFuZV9zdGF0ZS0+dXBkYXRlX2ZsYWdzLmJpdHMu
Y29lZmZfcmVkdWN0aW9uX2NoYW5nZSkgeworCQlzdHJ1Y3QgZGNfYmlhc19hbmRfc2NhbGUgYm5z
X3BhcmFtcyA9IHswfTsKKworCQkvLyBwcm9ncmFtIHRoZSBpbnB1dCBjc2MKKwkJZHBwLT5mdW5j
cy0+ZHBwX3NldHVwKGRwcCwKKwkJCQlwbGFuZV9zdGF0ZS0+Zm9ybWF0LAorCQkJCUVYUEFOU0lP
Tl9NT0RFX1pFUk8sCisJCQkJcGxhbmVfc3RhdGUtPmlucHV0X2NzY19jb2xvcl9tYXRyaXgsCisJ
CQkJcGxhbmVfc3RhdGUtPmNvbG9yX3NwYWNlLAorCQkJCU5VTEwpOworCisJCWlmIChkcHAtPmZ1
bmNzLT5kcHBfcHJvZ3JhbV9iaWFzX2FuZF9zY2FsZSkgeworCQkJLy9UT0RPIDpmb3IgQ05WQyBz
ZXQgc2NhbGUgYW5kIGJpYXMgcmVnaXN0ZXJzIGlmIG5lY2Vzc2FyeQorCQkJZGNuMTBfYnVpbGRf
cHJlc2NhbGVfcGFyYW1zKCZibnNfcGFyYW1zLCBwbGFuZV9zdGF0ZSk7CisJCQlkcHAtPmZ1bmNz
LT5kcHBfcHJvZ3JhbV9iaWFzX2FuZF9zY2FsZShkcHAsICZibnNfcGFyYW1zKTsKKwkJfQogCX0K
IAotCS8qIERpc2Nvbm5lY3QgdW51c2VkIG1wY2MgKi8KLQlmb3IgKGkgPSAwOyBpIDwgZGMtPnJl
c19wb29sLT5waXBlX2NvdW50OyBpKyspIHsKLQkJc3RydWN0IHBpcGVfY3R4ICpwaXBlX2N0eCA9
ICZjb250ZXh0LT5yZXNfY3R4LnBpcGVfY3R4W2ldOwotCQlzdHJ1Y3QgcGlwZV9jdHggKm9sZF9w
aXBlX2N0eCA9Ci0JCQkJJmRjLT5jdXJyZW50X3N0YXRlLT5yZXNfY3R4LnBpcGVfY3R4W2ldOwot
CQkvKgotCQkgKiBQb3dlcmdhdGUgcmV1c2VkIHBpcGVzIHRoYXQgYXJlIG5vdCBwb3dlcmdhdGVk
Ci0JCSAqIGZhaXJseSBoYWNreSByaWdodCBub3csIHVzaW5nIG9wcF9pZCBhcyBpbmRpY2F0b3IK
LQkJICogVE9ETzogQWZ0ZXIgbW92ZSBkY19wb3N0IHRvIGRjX3VwZGF0ZSwgdGhpcyB3aWxsCi0J
CSAqIGJlIHJlbW92ZWQuCi0JCSAqLwotCQlpZiAocGlwZV9jdHgtPnBsYW5lX3N0YXRlICYmICFv
bGRfcGlwZV9jdHgtPnBsYW5lX3N0YXRlKSB7Ci0JCQlpZiAob2xkX3BpcGVfY3R4LT5zdHJlYW1f
cmVzLnRnID09IHRnICYmCi0JCQkgICAgb2xkX3BpcGVfY3R4LT5wbGFuZV9yZXMuaHVicCAmJgot
CQkJICAgIG9sZF9waXBlX2N0eC0+cGxhbmVfcmVzLmh1YnAtPm9wcF9pZCAhPSBPUFBfSURfSU5W
QUxJRCkKLQkJCQlkYy0+aHdzcy5kaXNhYmxlX3BsYW5lKGRjLCBvbGRfcGlwZV9jdHgpOworCWlm
IChwaXBlX2N0eC0+dXBkYXRlX2ZsYWdzLmJpdHMubXBjYworCQkJfHwgcGxhbmVfc3RhdGUtPnVw
ZGF0ZV9mbGFncy5iaXRzLmdsb2JhbF9hbHBoYV9jaGFuZ2UKKwkJCXx8IHBsYW5lX3N0YXRlLT51
cGRhdGVfZmxhZ3MuYml0cy5wZXJfcGl4ZWxfYWxwaGFfY2hhbmdlKSB7CisJCS8qIE5lZWQgbXBj
YyB0byBiZSBpZGxlIGlmIGNoYW5naW5nIG9wcCAqLworCQlpZiAocGlwZV9jdHgtPnVwZGF0ZV9m
bGFncy5iaXRzLm9wcF9jaGFuZ2VkKSB7CisJCQlzdHJ1Y3QgcGlwZV9jdHggKm9sZF9waXBlX2N0
eCA9ICZkYy0+Y3VycmVudF9zdGF0ZS0+cmVzX2N0eC5waXBlX2N0eFtwaXBlX2N0eC0+cGlwZV9p
ZHhdOworCQkJaW50IG1wY2NfaW5zdDsKKworCQkJZm9yIChtcGNjX2luc3QgPSAwOyBtcGNjX2lu
c3QgPCBNQVhfUElQRVM7IG1wY2NfaW5zdCsrKSB7CisJCQkJaWYgKCFvbGRfcGlwZV9jdHgtPnN0
cmVhbV9yZXMub3BwLT5tcGNjX2Rpc2Nvbm5lY3RfcGVuZGluZ1ttcGNjX2luc3RdKQorCQkJCQlj
b250aW51ZTsKKwkJCQlkYy0+cmVzX3Bvb2wtPm1wYy0+ZnVuY3MtPndhaXRfZm9yX2lkbGUoZGMt
PnJlc19wb29sLT5tcGMsIG1wY2NfaW5zdCk7CisJCQkJb2xkX3BpcGVfY3R4LT5zdHJlYW1fcmVz
Lm9wcC0+bXBjY19kaXNjb25uZWN0X3BlbmRpbmdbbXBjY19pbnN0XSA9IGZhbHNlOworCQkJfQog
CQl9CisJCWRjLT5od3NzLnVwZGF0ZV9tcGNjKGRjLCBwaXBlX2N0eCk7CisJfQogCi0JCWlmICgo
IXBpcGVfY3R4LT5wbGFuZV9zdGF0ZSB8fAotCQkgICAgIHBpcGVfY3R4LT5zdHJlYW1fcmVzLnRn
ICE9IG9sZF9waXBlX2N0eC0+c3RyZWFtX3Jlcy50ZykgJiYKLQkJICAgICBvbGRfcGlwZV9jdHgt
PnBsYW5lX3N0YXRlICYmCi0JCSAgICAgb2xkX3BpcGVfY3R4LT5zdHJlYW1fcmVzLnRnID09IHRn
KSB7CisJaWYgKHBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5zY2FsZXIgfHwKKwkJCXBsYW5l
X3N0YXRlLT51cGRhdGVfZmxhZ3MuYml0cy5zY2FsaW5nX2NoYW5nZSB8fAorCQkJcGxhbmVfc3Rh
dGUtPnVwZGF0ZV9mbGFncy5iaXRzLnBvc2l0aW9uX2NoYW5nZSB8fAorCQkJcGxhbmVfc3RhdGUt
PnVwZGF0ZV9mbGFncy5iaXRzLnBlcl9waXhlbF9hbHBoYV9jaGFuZ2UgfHwKKwkJCXBpcGVfY3R4
LT5zdHJlYW0tPnVwZGF0ZV9mbGFncy5iaXRzLnNjYWxpbmcpIHsKKwkJcGlwZV9jdHgtPnBsYW5l
X3Jlcy5zY2xfZGF0YS5sYl9wYXJhbXMuYWxwaGFfZW4gPSBwaXBlX2N0eC0+cGxhbmVfc3RhdGUt
PnBlcl9waXhlbF9hbHBoYTsKKwkJQVNTRVJUKHBpcGVfY3R4LT5wbGFuZV9yZXMuc2NsX2RhdGEu
bGJfcGFyYW1zLmRlcHRoID09IExCX1BJWEVMX0RFUFRIXzMwQlBQKTsKKwkJLyogc2NhbGVyIGNv
bmZpZ3VyYXRpb24gKi8KKwkJcGlwZV9jdHgtPnBsYW5lX3Jlcy5kcHAtPmZ1bmNzLT5kcHBfc2V0
X3NjYWxlcigKKwkJCQlwaXBlX2N0eC0+cGxhbmVfcmVzLmRwcCwgJnBpcGVfY3R4LT5wbGFuZV9y
ZXMuc2NsX2RhdGEpOworCX0KIAotCQkJZGMtPmh3c3MucGxhbmVfYXRvbWljX2Rpc2Nvbm5lY3Qo
ZGMsIG9sZF9waXBlX2N0eCk7Ci0JCQlyZW1vdmVkX3BpcGVbaV0gPSB0cnVlOworCWlmIChwaXBl
X2N0eC0+dXBkYXRlX2ZsYWdzLmJpdHMudmlld3BvcnQgfHwKKwkJCShjb250ZXh0ID09IGRjLT5j
dXJyZW50X3N0YXRlICYmIHBsYW5lX3N0YXRlLT51cGRhdGVfZmxhZ3MuYml0cy5zY2FsaW5nX2No
YW5nZSkgfHwKKwkJCShjb250ZXh0ID09IGRjLT5jdXJyZW50X3N0YXRlICYmIHBpcGVfY3R4LT5z
dHJlYW0tPnVwZGF0ZV9mbGFncy5iaXRzLnNjYWxpbmcpKQorCQlodWJwLT5mdW5jcy0+bWVtX3By
b2dyYW1fdmlld3BvcnQoCisJCQlodWJwLAorCQkJJnBpcGVfY3R4LT5wbGFuZV9yZXMuc2NsX2Rh
dGEudmlld3BvcnQsCisJCQkmcGlwZV9jdHgtPnBsYW5lX3Jlcy5zY2xfZGF0YS52aWV3cG9ydF9j
KTsKKworCS8qIEFueSB1cGRhdGVzIGFyZSBoYW5kbGVkIGluIGRjIGludGVyZmFjZSwganVzdCBu
ZWVkIHRvIGFwcGx5IGV4aXN0aW5nIGZvciBwbGFuZSBlbmFibGUgKi8KKwlpZiAoKHBpcGVfY3R4
LT51cGRhdGVfZmxhZ3MuYml0cy5lbmFibGUgfHwgcGlwZV9jdHgtPnVwZGF0ZV9mbGFncy5iaXRz
Lm9wcF9jaGFuZ2VkKQorCQkJJiYgcGlwZV9jdHgtPnN0cmVhbS0+Y3Vyc29yX2F0dHJpYnV0ZXMu
YWRkcmVzcy5xdWFkX3BhcnQgIT0gMCkgeworCQlkYy0+aHdzcy5zZXRfY3Vyc29yX3Bvc2l0aW9u
KHBpcGVfY3R4KTsKKwkJZGMtPmh3c3Muc2V0X2N1cnNvcl9hdHRyaWJ1dGUocGlwZV9jdHgpOwor
CisJCWlmIChkYy0+aHdzcy5zZXRfY3Vyc29yX3Nkcl93aGl0ZV9sZXZlbCkKKwkJCWRjLT5od3Nz
LnNldF9jdXJzb3Jfc2RyX3doaXRlX2xldmVsKHBpcGVfY3R4KTsKKwl9CiAKLQkJCURDX0xPR19E
QygiUmVzZXQgbXBjYyBmb3IgcGlwZSAlZFxuIiwKLQkJCQkJb2xkX3BpcGVfY3R4LT5waXBlX2lk
eCk7Ci0JCX0KKwkvKiBBbnkgdXBkYXRlcyBhcmUgaGFuZGxlZCBpbiBkYyBpbnRlcmZhY2UsIGp1
c3QgbmVlZAorCSAqIHRvIGFwcGx5IGV4aXN0aW5nIGZvciBwbGFuZSBlbmFibGUgLyBvcHAgY2hh
bmdlICovCisJaWYgKHBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5lbmFibGUgfHwgcGlwZV9j
dHgtPnVwZGF0ZV9mbGFncy5iaXRzLm9wcF9jaGFuZ2VkCisJCQl8fCBwaXBlX2N0eC0+c3RyZWFt
LT51cGRhdGVfZmxhZ3MuYml0cy5nYW11dF9yZW1hcAorCQkJfHwgcGlwZV9jdHgtPnN0cmVhbS0+
dXBkYXRlX2ZsYWdzLmJpdHMub3V0X2NzYykgeworCQkJLyogZHBwL2NtIGdhbXV0IHJlbWFwKi8K
KwkJCWRjLT5od3NzLnByb2dyYW1fZ2FtdXRfcmVtYXAocGlwZV9jdHgpOworCisJCS8qY2FsbCB0
aGUgZGNuMiBtZXRob2Qgd2hpY2ggdXNlcyBtcGMgY3NjKi8KKwkJZGMtPmh3c3MucHJvZ3JhbV9v
dXRwdXRfY3NjKGRjLAorCQkJCXBpcGVfY3R4LAorCQkJCXBpcGVfY3R4LT5zdHJlYW0tPm91dHB1
dF9jb2xvcl9zcGFjZSwKKwkJCQlwaXBlX2N0eC0+c3RyZWFtLT5jc2NfY29sb3JfbWF0cml4Lm1h
dHJpeCwKKwkJCQlodWJwLT5vcHBfaWQpOwogCX0KIAotCWlmIChudW1fcGxhbmVzID4gMCkKLQkJ
ZGNuMjBfcHJvZ3JhbV9hbGxfcGlwZV9pbl90cmVlKGRjLCB0b3BfcGlwZV90b19wcm9ncmFtLCBj
b250ZXh0KTsKKwlpZiAocGlwZV9jdHgtPnVwZGF0ZV9mbGFncy5iaXRzLmVuYWJsZSB8fAorCQkJ
cGlwZV9jdHgtPnVwZGF0ZV9mbGFncy5iaXRzLm9wcF9jaGFuZ2VkIHx8CisJCQlwbGFuZV9zdGF0
ZS0+dXBkYXRlX2ZsYWdzLmJpdHMucGl4ZWxfZm9ybWF0X2NoYW5nZSB8fAorCQkJcGxhbmVfc3Rh
dGUtPnVwZGF0ZV9mbGFncy5iaXRzLmhvcml6b250YWxfbWlycm9yX2NoYW5nZSB8fAorCQkJcGxh
bmVfc3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRzLnJvdGF0aW9uX2NoYW5nZSB8fAorCQkJcGxhbmVf
c3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRzLnN3aXp6bGVfY2hhbmdlIHx8CisJCQlwbGFuZV9zdGF0
ZS0+dXBkYXRlX2ZsYWdzLmJpdHMuZGNjX2NoYW5nZSB8fAorCQkJcGxhbmVfc3RhdGUtPnVwZGF0
ZV9mbGFncy5iaXRzLmJwcF9jaGFuZ2UgfHwKKwkJCXBsYW5lX3N0YXRlLT51cGRhdGVfZmxhZ3Mu
Yml0cy5zY2FsaW5nX2NoYW5nZSB8fAorCQkJcGxhbmVfc3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRz
LnBsYW5lX3NpemVfY2hhbmdlKSB7CisJCXN0cnVjdCBwbGFuZV9zaXplIHNpemUgPSBwbGFuZV9z
dGF0ZS0+cGxhbmVfc2l6ZTsKKworCQlzaXplLnN1cmZhY2Vfc2l6ZSA9IHBpcGVfY3R4LT5wbGFu
ZV9yZXMuc2NsX2RhdGEudmlld3BvcnQ7CisJCWh1YnAtPmZ1bmNzLT5odWJwX3Byb2dyYW1fc3Vy
ZmFjZV9jb25maWcoCisJCQlodWJwLAorCQkJcGxhbmVfc3RhdGUtPmZvcm1hdCwKKwkJCSZwbGFu
ZV9zdGF0ZS0+dGlsaW5nX2luZm8sCisJCQkmc2l6ZSwKKwkJCXBsYW5lX3N0YXRlLT5yb3RhdGlv
biwKKwkJCSZwbGFuZV9zdGF0ZS0+ZGNjLAorCQkJcGxhbmVfc3RhdGUtPmhvcml6b250YWxfbWly
cm9yLAorCQkJMCk7CisJCWh1YnAtPnBvd2VyX2dhdGVkID0gZmFsc2U7CisJfQorCisJaWYgKHBp
cGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5lbmFibGUgfHwgcGxhbmVfc3RhdGUtPnVwZGF0ZV9m
bGFncy5iaXRzLmFkZHJfdXBkYXRlKQorCQlkYy0+aHdzcy51cGRhdGVfcGxhbmVfYWRkcihkYywg
cGlwZV9jdHgpOworCisJaWYgKHBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5lbmFibGUpCisJ
CWh1YnAtPmZ1bmNzLT5zZXRfYmxhbmsoaHVicCwgZmFsc2UpOworfQorCisKK3N0YXRpYyB2b2lk
IGRjbjIwX3Byb2dyYW1fcGlwZSgKKwkJc3RydWN0IGRjICpkYywKKwkJc3RydWN0IHBpcGVfY3R4
ICpwaXBlX2N0eCwKKwkJc3RydWN0IGRjX3N0YXRlICpjb250ZXh0KQoreworCS8qIE9ubHkgbmVl
ZCB0byB1bmJsYW5rIG9uIHRvcCBwaXBlICovCisJaWYgKChwaXBlX2N0eC0+dXBkYXRlX2ZsYWdz
LmJpdHMuZW5hYmxlIHx8IHBpcGVfY3R4LT5zdHJlYW0tPnVwZGF0ZV9mbGFncy5iaXRzLmFibV9s
ZXZlbCkKKwkJCSYmICFwaXBlX2N0eC0+dG9wX3BpcGUgJiYgIXBpcGVfY3R4LT5wcmV2X29kbV9w
aXBlKQorCQlkYy0+aHdzcy5ibGFua19waXhlbF9kYXRhKGRjLCBwaXBlX2N0eCwgIXBpcGVfY3R4
LT5wbGFuZV9zdGF0ZS0+dmlzaWJsZSk7CisKKwlpZiAocGlwZV9jdHgtPnVwZGF0ZV9mbGFncy5i
aXRzLmdsb2JhbF9zeW5jKQorCQlwaXBlX2N0eC0+c3RyZWFtX3Jlcy50Zy0+ZnVuY3MtPnByb2dy
YW1fZ2xvYmFsX3N5bmMoCisJCQkJcGlwZV9jdHgtPnN0cmVhbV9yZXMudGcsCisJCQkJcGlwZV9j
dHgtPnBpcGVfZGxnX3BhcmFtLnZyZWFkeV9vZmZzZXQsCisJCQkJcGlwZV9jdHgtPnBpcGVfZGxn
X3BhcmFtLnZzdGFydHVwX3N0YXJ0LAorCQkJCXBpcGVfY3R4LT5waXBlX2RsZ19wYXJhbS52dXBk
YXRlX29mZnNldCwKKwkJCQlwaXBlX2N0eC0+cGlwZV9kbGdfcGFyYW0udnVwZGF0ZV93aWR0aCk7
CisKKwlpZiAocGlwZV9jdHgtPnVwZGF0ZV9mbGFncy5iaXRzLm9kbSkKKwkJZGMtPmh3c3MudXBk
YXRlX29kbShkYywgY29udGV4dCwgcGlwZV9jdHgpOworCisJaWYgKHBpcGVfY3R4LT51cGRhdGVf
ZmxhZ3MuYml0cy5lbmFibGUpCisJCWRjbjIwX2VuYWJsZV9wbGFuZShkYywgcGlwZV9jdHgsIGNv
bnRleHQpOworCisJaWYgKHBpcGVfY3R4LT51cGRhdGVfZmxhZ3MucmF3IHx8IHBpcGVfY3R4LT5w
bGFuZV9zdGF0ZS0+dXBkYXRlX2ZsYWdzLnJhdykKKwkJZGNuMjBfdXBkYXRlX2RjaHVicF9kcHAo
ZGMsIHBpcGVfY3R4LCBjb250ZXh0KTsKKworCWlmIChwaXBlX2N0eC0+dXBkYXRlX2ZsYWdzLmJp
dHMuZW5hYmxlCisJCQl8fCBwaXBlX2N0eC0+cGxhbmVfc3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRz
LnNkcl93aGl0ZV9sZXZlbCkKKwkJc2V0X2hkcl9tdWx0aXBsaWVyKHBpcGVfY3R4KTsKKworCWlm
IChwaXBlX2N0eC0+dXBkYXRlX2ZsYWdzLmJpdHMuZW5hYmxlIHx8CisJCQlwaXBlX2N0eC0+cGxh
bmVfc3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRzLmluX3RyYW5zZmVyX2Z1bmNfY2hhbmdlIHx8CisJ
CQlwaXBlX2N0eC0+cGxhbmVfc3RhdGUtPnVwZGF0ZV9mbGFncy5iaXRzLmdhbW1hX2NoYW5nZSkK
KwkJZGMtPmh3c3Muc2V0X2lucHV0X3RyYW5zZmVyX2Z1bmMocGlwZV9jdHgsIHBpcGVfY3R4LT5w
bGFuZV9zdGF0ZSk7CisKKwkvKiBkY24xMF90cmFuc2xhdGVfcmVnYW1tYV90b19od19mb3JtYXQg
dGFrZXMgNzUwdXMgdG8gZmluaXNoCisJICogb25seSBkbyBnYW1tYSBwcm9ncmFtbWluZyBmb3Ig
cG93ZXJpbmcgb24sIGludGVybmFsIG1lbWNtcCB0byBhdm9pZAorCSAqIHVwZGF0aW5nIG9uIHNs
YXZlIHBsYW5lcworCSAqLworCWlmIChwaXBlX2N0eC0+dXBkYXRlX2ZsYWdzLmJpdHMuZW5hYmxl
IHx8IHBpcGVfY3R4LT5zdHJlYW0tPnVwZGF0ZV9mbGFncy5iaXRzLm91dF90ZikKKwkJZGMtPmh3
c3Muc2V0X291dHB1dF90cmFuc2Zlcl9mdW5jKHBpcGVfY3R4LCBwaXBlX2N0eC0+c3RyZWFtKTsK
K30KKworc3RhdGljIGJvb2wgZG9lc19waXBlX25lZWRfbG9jayhzdHJ1Y3QgcGlwZV9jdHggKnBp
cGUpCit7CisJaWYgKChwaXBlLT5wbGFuZV9zdGF0ZSAmJiBwaXBlLT5wbGFuZV9zdGF0ZS0+dXBk
YXRlX2ZsYWdzLnJhdykKKwkJCXx8IHBpcGUtPnVwZGF0ZV9mbGFncy5yYXcpCisJCXJldHVybiB0
cnVlOworCWlmIChwaXBlLT5ib3R0b21fcGlwZSkKKwkJcmV0dXJuIGRvZXNfcGlwZV9uZWVkX2xv
Y2socGlwZS0+Ym90dG9tX3BpcGUpOwogCi0JLyogUHJvZ3JhbSBzZWNvbmRhcnkgYmxlbmRpbmcg
dHJlZSBhbmQgd3JpdGViYWNrIHBpcGVzICovCi0JaWYgKChzdHJlYW0tPm51bV93Yl9pbmZvID4g
MCkgJiYgKGRjLT5od3NzLnByb2dyYW1fYWxsX3dyaXRlYmFja19waXBlc19pbl90cmVlKSkKLQkJ
ZGMtPmh3c3MucHJvZ3JhbV9hbGxfd3JpdGViYWNrX3BpcGVzX2luX3RyZWUoZGMsIHN0cmVhbSwg
Y29udGV4dCk7CisJcmV0dXJuIGZhbHNlOworfQogCi0JaWYgKGludGVyZGVwZW5kZW50X3VwZGF0
ZSkKLQkJZm9yIChpID0gMDsgaSA8IGRjLT5yZXNfcG9vbC0+cGlwZV9jb3VudDsgaSsrKSB7Citz
dGF0aWMgdm9pZCBkY24yMF9wcm9ncmFtX2Zyb250X2VuZF9mb3JfY3R4KAorCQlzdHJ1Y3QgZGMg
KmRjLAorCQlzdHJ1Y3QgZGNfc3RhdGUgKmNvbnRleHQpCit7CisJY29uc3QgdW5zaWduZWQgaW50
IFRJTUVPVVRfRk9SX1BJUEVfRU5BQkxFX01TID0gMTAwOworCWludCBpOworCWJvb2wgcGlwZV9s
b2NrZWRbTUFYX1BJUEVTXSA9IHtmYWxzZX07CisJRENfTE9HR0VSX0lOSVQoZGMtPmN0eC0+bG9n
Z2VyKTsKKworCS8qIENhcnJ5IG92ZXIgR1NMIGdyb3VwcyBpbiBjYXNlIHRoZSBjb250ZXh0IGlz
IGNoYW5naW5nLiAqLworCWZvciAoaSA9IDA7IGkgPCBkYy0+cmVzX3Bvb2wtPnBpcGVfY291bnQ7
IGkrKykKKwkJaWYgKGNvbnRleHQtPnJlc19jdHgucGlwZV9jdHhbaV0uc3RyZWFtID09IGRjLT5j
dXJyZW50X3N0YXRlLT5yZXNfY3R4LnBpcGVfY3R4W2ldLnN0cmVhbSkKKwkJCWNvbnRleHQtPnJl
c19jdHgucGlwZV9jdHhbaV0uc3RyZWFtX3Jlcy5nc2xfZ3JvdXAgPQorCQkJCWRjLT5jdXJyZW50
X3N0YXRlLT5yZXNfY3R4LnBpcGVfY3R4W2ldLnN0cmVhbV9yZXMuZ3NsX2dyb3VwOworCisJLyog
U2V0IHBpcGUgdXBkYXRlIGZsYWdzIGFuZCBsb2NrIHBpcGVzICovCisJZm9yIChpID0gMDsgaSA8
IGRjLT5yZXNfcG9vbC0+cGlwZV9jb3VudDsgaSsrKQorCQlkY24yMF9kZXRlY3RfcGlwZV9jaGFu
Z2VzKCZkYy0+Y3VycmVudF9zdGF0ZS0+cmVzX2N0eC5waXBlX2N0eFtpXSwKKwkJCQkmY29udGV4
dC0+cmVzX2N0eC5waXBlX2N0eFtpXSk7CisJZm9yIChpID0gMDsgaSA8IGRjLT5yZXNfcG9vbC0+
cGlwZV9jb3VudDsgaSsrKQorCQlpZiAoIWNvbnRleHQtPnJlc19jdHgucGlwZV9jdHhbaV0udG9w
X3BpcGUgJiYKKwkJCQlkb2VzX3BpcGVfbmVlZF9sb2NrKCZjb250ZXh0LT5yZXNfY3R4LnBpcGVf
Y3R4W2ldKSkgewogCQkJc3RydWN0IHBpcGVfY3R4ICpwaXBlX2N0eCA9ICZjb250ZXh0LT5yZXNf
Y3R4LnBpcGVfY3R4W2ldOwogCi0JCQkvKiBTa2lwIGluYWN0aXZlIHBpcGVzIGFuZCBvbmVzIGFs
cmVhZHkgdXBkYXRlZCAqLwotCQkJaWYgKCFwaXBlX2N0eC0+c3RyZWFtIHx8IHBpcGVfY3R4LT5z
dHJlYW0gPT0gc3RyZWFtIHx8Ci0JCQkgICAgIXBpcGVfY3R4LT5wbGFuZV9zdGF0ZSB8fCAhdGct
PmZ1bmNzLT5pc190Z19lbmFibGVkKHRnKSkKLQkJCQljb250aW51ZTsKKwkJCWlmIChwaXBlX2N0
eC0+dXBkYXRlX2ZsYWdzLmJpdHMudGdfY2hhbmdlZCB8fCBwaXBlX2N0eC0+dXBkYXRlX2ZsYWdz
LmJpdHMuZW5hYmxlKQorCQkJCWRjLT5od3NzLnBpcGVfY29udHJvbF9sb2NrKGRjLCBwaXBlX2N0
eCwgdHJ1ZSk7CisJCQlpZiAoIXBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5lbmFibGUpCisJ
CQkJZGMtPmh3c3MucGlwZV9jb250cm9sX2xvY2soZGMsICZkYy0+Y3VycmVudF9zdGF0ZS0+cmVz
X2N0eC5waXBlX2N0eFtpXSwgdHJ1ZSk7CisJCQlwaXBlX2xvY2tlZFtpXSA9IHRydWU7CisJCX0K
IAotCQkJcGlwZV9jdHgtPnBsYW5lX3Jlcy5odWJwLT5mdW5jcy0+aHVicF9zZXR1cF9pbnRlcmRl
cGVuZGVudCgKLQkJCQlwaXBlX2N0eC0+cGxhbmVfcmVzLmh1YnAsCi0JCQkJJnBpcGVfY3R4LT5k
bGdfcmVncywKLQkJCQkmcGlwZV9jdHgtPnR0dV9yZWdzKTsKKwkvKiBPVEcgYmxhbmsgYmVmb3Jl
IGRpc2FibGluZyBhbGwgZnJvbnQgZW5kcyAqLworCWZvciAoaSA9IDA7IGkgPCBkYy0+cmVzX3Bv
b2wtPnBpcGVfY291bnQ7IGkrKykKKwkJaWYgKGNvbnRleHQtPnJlc19jdHgucGlwZV9jdHhbaV0u
dXBkYXRlX2ZsYWdzLmJpdHMuZGlzYWJsZQorCQkJCSYmICFjb250ZXh0LT5yZXNfY3R4LnBpcGVf
Y3R4W2ldLnRvcF9waXBlCisJCQkJJiYgIWNvbnRleHQtPnJlc19jdHgucGlwZV9jdHhbaV0ucHJl
dl9vZG1fcGlwZQorCQkJCSYmIGNvbnRleHQtPnJlc19jdHgucGlwZV9jdHhbaV0uc3RyZWFtKQor
CQkJZGMtPmh3c3MuYmxhbmtfcGl4ZWxfZGF0YShkYywgJmNvbnRleHQtPnJlc19jdHgucGlwZV9j
dHhbaV0sIHRydWUpOworCisJLyogRGlzY29ubmVjdCBtcGNjICovCisJZm9yIChpID0gMDsgaSA8
IGRjLT5yZXNfcG9vbC0+cGlwZV9jb3VudDsgaSsrKQorCQlpZiAoY29udGV4dC0+cmVzX2N0eC5w
aXBlX2N0eFtpXS51cGRhdGVfZmxhZ3MuYml0cy5kaXNhYmxlCisJCQkJfHwgY29udGV4dC0+cmVz
X2N0eC5waXBlX2N0eFtpXS51cGRhdGVfZmxhZ3MuYml0cy5vcHBfY2hhbmdlZCkgeworCQkJZGMt
Pmh3c3MucGxhbmVfYXRvbWljX2Rpc2Nvbm5lY3QoZGMsICZkYy0+Y3VycmVudF9zdGF0ZS0+cmVz
X2N0eC5waXBlX2N0eFtpXSk7CisJCQlEQ19MT0dfREMoIlJlc2V0IG1wY2MgZm9yIHBpcGUgJWRc
biIsIGRjLT5jdXJyZW50X3N0YXRlLT5yZXNfY3R4LnBpcGVfY3R4W2ldLnBpcGVfaWR4KTsKIAkJ
fQogCi0JaWYgKGludGVyZGVwZW5kZW50X3VwZGF0ZSkKLQkJbG9ja19hbGxfcGlwZXMoZGMsIGNv
bnRleHQsIGZhbHNlKTsKLQllbHNlCi0JCWRjbjIwX3BpcGVfY29udHJvbF9sb2NrKGRjLCB0b3Bf
cGlwZV90b19wcm9ncmFtLCBmYWxzZSk7CisJLyoKKwkgKiBQcm9ncmFtIGFsbCB1cGRhdGVkIHBp
cGVzLCBvcmRlciBtYXR0ZXJzIGZvciBtcGNjIHNldHVwLiBTdGFydCB3aXRoCisJICogdG9wIHBp
cGUgYW5kIHByb2dyYW0gYWxsIHBpcGVzIHRoYXQgZm9sbG93IGluIG9yZGVyCisJICovCisJZm9y
IChpID0gMDsgaSA8IGRjLT5yZXNfcG9vbC0+cGlwZV9jb3VudDsgaSsrKSB7CisJCXN0cnVjdCBw
aXBlX2N0eCAqcGlwZSA9ICZjb250ZXh0LT5yZXNfY3R4LnBpcGVfY3R4W2ldOwogCisJCWlmIChw
aXBlLT5wbGFuZV9zdGF0ZSAmJiAhcGlwZS0+dG9wX3BpcGUpIHsKKwkJCXdoaWxlIChwaXBlKSB7
CisJCQkJZGNuMjBfcHJvZ3JhbV9waXBlKGRjLCBwaXBlLCBjb250ZXh0KTsKKwkJCQlwaXBlID0g
cGlwZS0+Ym90dG9tX3BpcGU7CisJCQl9CisJCQkvKiBQcm9ncmFtIHNlY29uZGFyeSBibGVuZGlu
ZyB0cmVlIGFuZCB3cml0ZWJhY2sgcGlwZXMgKi8KKwkJCXBpcGUgPSAmY29udGV4dC0+cmVzX2N0
eC5waXBlX2N0eFtpXTsKKwkJCWlmICghcGlwZS0+cHJldl9vZG1fcGlwZSAmJiBwaXBlLT5zdHJl
YW0tPm51bV93Yl9pbmZvID4gMAorCQkJCQkmJiAocGlwZS0+dXBkYXRlX2ZsYWdzLnJhdyB8fCBw
aXBlLT5wbGFuZV9zdGF0ZS0+dXBkYXRlX2ZsYWdzLnJhdyB8fCBwaXBlLT5zdHJlYW0tPnVwZGF0
ZV9mbGFncy5yYXcpCisJCQkJCSYmIGRjLT5od3NzLnByb2dyYW1fYWxsX3dyaXRlYmFja19waXBl
c19pbl90cmVlKQorCQkJCWRjLT5od3NzLnByb2dyYW1fYWxsX3dyaXRlYmFja19waXBlc19pbl90
cmVlKGRjLCBwaXBlLT5zdHJlYW0sIGNvbnRleHQpOworCQl9CisJfQorCisJLyogVW5sb2NrIGFs
bCBsb2NrZWQgcGlwZXMgKi8KIAlmb3IgKGkgPSAwOyBpIDwgZGMtPnJlc19wb29sLT5waXBlX2Nv
dW50OyBpKyspCi0JCWlmIChyZW1vdmVkX3BpcGVbaV0pCi0JCQlkY24yMF9kaXNhYmxlX3BsYW5l
KGRjLCAmZGMtPmN1cnJlbnRfc3RhdGUtPnJlc19jdHgucGlwZV9jdHhbaV0pOworCQlpZiAocGlw
ZV9sb2NrZWRbaV0pIHsKKwkJCXN0cnVjdCBwaXBlX2N0eCAqcGlwZV9jdHggPSAmY29udGV4dC0+
cmVzX2N0eC5waXBlX2N0eFtpXTsKKworCQkJaWYgKHBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0
cy50Z19jaGFuZ2VkIHx8IHBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5lbmFibGUpCisJCQkJ
ZGMtPmh3c3MucGlwZV9jb250cm9sX2xvY2soZGMsIHBpcGVfY3R4LCBmYWxzZSk7CisJCQlpZiAo
IXBpcGVfY3R4LT51cGRhdGVfZmxhZ3MuYml0cy5lbmFibGUpCisJCQkJZGMtPmh3c3MucGlwZV9j
b250cm9sX2xvY2soZGMsICZkYy0+Y3VycmVudF9zdGF0ZS0+cmVzX2N0eC5waXBlX2N0eFtpXSwg
ZmFsc2UpOworCQl9CisKKwlmb3IgKGkgPSAwOyBpIDwgZGMtPnJlc19wb29sLT5waXBlX2NvdW50
OyBpKyspCisJCWlmIChjb250ZXh0LT5yZXNfY3R4LnBpcGVfY3R4W2ldLnVwZGF0ZV9mbGFncy5i
aXRzLmRpc2FibGUpCisJCQlkYy0+aHdzcy5kaXNhYmxlX3BsYW5lKGRjLCAmZGMtPmN1cnJlbnRf
c3RhdGUtPnJlc19jdHgucGlwZV9jdHhbaV0pOwogCiAJLyoKIAkgKiBJZiB3ZSBhcmUgZW5hYmxp
bmcgYSBwaXBlLCB3ZSBuZWVkIHRvIHdhaXQgZm9yIHBlbmRpbmcgY2xlYXIgYXMgdGhpcyBpcyBh
IGNyaXRpY2FsCkBAIC0xMjM5LDEzICsxNDk1LDE2IEBAIHN0YXRpYyB2b2lkIGRjbjIwX2FwcGx5
X2N0eF9mb3Jfc3VyZmFjZSgKIAkgKiB3aWxsIGNhdXNlIEhXIHRvIHBlcmZvcm0gYW4gImltbWVk
aWF0ZSBlbmFibGUiIChhcyBvcHBvc2VkIHRvICJ2c3luYyBlbmFibGUiKSB3aGljaAogCSAqIGlz
IHVuc3VwcG9ydGVkIG9uIERDTi4KIAkgKi8KLQlpID0gMDsKLQlpZiAobnVtX3BsYW5lcyA+IDAg
JiYgdG9wX3BpcGVfdG9fcHJvZ3JhbSAmJgotCQkJKHByZXZfdG9wX3BpcGVfdG9fcHJvZ3JhbSA9
PSBOVUxMIHx8IHByZXZfdG9wX3BpcGVfdG9fcHJvZ3JhbS0+cGxhbmVfc3RhdGUgPT0gTlVMTCkp
IHsKLQkJd2hpbGUgKGkgPCBUSU1FT1VUX0ZPUl9QSVBFX0VOQUJMRV9NUyAmJgotCQkJCXRvcF9w
aXBlX3RvX3Byb2dyYW0tPnBsYW5lX3Jlcy5odWJwLT5mdW5jcy0+aHVicF9pc19mbGlwX3BlbmRp
bmcodG9wX3BpcGVfdG9fcHJvZ3JhbS0+cGxhbmVfcmVzLmh1YnApKSB7Ci0JCQlpICs9IDE7Ci0J
CQltc2xlZXAoMSk7CisJZm9yIChpID0gMDsgaSA8IGRjLT5yZXNfcG9vbC0+cGlwZV9jb3VudDsg
aSsrKSB7CisJCXN0cnVjdCBwaXBlX2N0eCAqcGlwZSA9ICZjb250ZXh0LT5yZXNfY3R4LnBpcGVf
Y3R4W2ldOworCisJCWlmIChwaXBlLT5wbGFuZV9zdGF0ZSAmJiAhcGlwZS0+dG9wX3BpcGUgJiYg
cGlwZS0+dXBkYXRlX2ZsYWdzLmJpdHMuZW5hYmxlKSB7CisJCQlzdHJ1Y3QgaHVicCAqaHVicCA9
IHBpcGUtPnBsYW5lX3Jlcy5odWJwOworCQkJaW50IGogPSAwOworCisJCQlmb3IgKGogPSAwOyBq
IDwgVElNRU9VVF9GT1JfUElQRV9FTkFCTEVfTVMKKwkJCQkJJiYgaHVicC0+ZnVuY3MtPmh1YnBf
aXNfZmxpcF9wZW5kaW5nKGh1YnApOyBqKyspCisJCQkJbXNsZWVwKDEpOwogCQl9CiAJfQogfQpA
QCAtMjA5NSw3ICsyMzU0LDggQEAgdm9pZCBkY24yMF9od19zZXF1ZW5jZXJfY29uc3RydWN0KHN0
cnVjdCBkYyAqZGMpCiAJZGMtPmh3c3MucHJvZ3JhbV90cmlwbGVidWZmZXIgPSBkY24yMF9wcm9n
cmFtX3RyaXBsZUJ1ZmZlcjsKIAlkYy0+aHdzcy5zZXRfaW5wdXRfdHJhbnNmZXJfZnVuYyA9IGRj
bjIwX3NldF9pbnB1dF90cmFuc2Zlcl9mdW5jOwogCWRjLT5od3NzLnNldF9vdXRwdXRfdHJhbnNm
ZXJfZnVuYyA9IGRjbjIwX3NldF9vdXRwdXRfdHJhbnNmZXJfZnVuYzsKLQlkYy0+aHdzcy5hcHBs
eV9jdHhfZm9yX3N1cmZhY2UgPSBkY24yMF9hcHBseV9jdHhfZm9yX3N1cmZhY2U7CisJZGMtPmh3
c3MuYXBwbHlfY3R4X2Zvcl9zdXJmYWNlID0gTlVMTDsKKwlkYy0+aHdzcy5wcm9ncmFtX2Zyb250
X2VuZF9mb3JfY3R4ID0gZGNuMjBfcHJvZ3JhbV9mcm9udF9lbmRfZm9yX2N0eDsKIAlkYy0+aHdz
cy5waXBlX2NvbnRyb2xfbG9jayA9IGRjbjIwX3BpcGVfY29udHJvbF9sb2NrOwogCWRjLT5od3Nz
LnBpcGVfY29udHJvbF9sb2NrX2dsb2JhbCA9IGRjbjIwX3BpcGVfY29udHJvbF9sb2NrX2dsb2Jh
bDsKIAlkYy0+aHdzcy5vcHRpbWl6ZV9iYW5kd2lkdGggPSBkY24yMF9vcHRpbWl6ZV9iYW5kd2lk
dGg7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvaW5jL2h3X3Nl
cXVlbmNlci5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2luYy9od19zZXF1ZW5j
ZXIuaAppbmRleCA3MzJhOTNkZjE4NDQuLjRlOTY0YzMzOWIyZCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2luYy9od19zZXF1ZW5jZXIuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvaW5jL2h3X3NlcXVlbmNlci5oCkBAIC0xMTMsNiArMTEz
LDkgQEAgc3RydWN0IGh3X3NlcXVlbmNlcl9mdW5jcyB7CiAJCQlpbnQgb3BwX2lkKTsKIAogI2lm
IGRlZmluZWQoQ09ORklHX0RSTV9BTURfRENfRENOMl8wKQorCXZvaWQgKCpwcm9ncmFtX2Zyb250
X2VuZF9mb3JfY3R4KSgKKwkJCXN0cnVjdCBkYyAqZGMsCisJCQlzdHJ1Y3QgZGNfc3RhdGUgKmNv
bnRleHQpOwogCXZvaWQgKCpwcm9ncmFtX3RyaXBsZWJ1ZmZlcikoCiAJCWNvbnN0IHN0cnVjdCBk
YyAqZGMsCiAJCXN0cnVjdCBwaXBlX2N0eCAqcGlwZV9jdHgsCi0tIAoyLjE3LjEKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmFtZC1nZnggbWFpbGluZyBs
aXN0CmFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vYW1kLWdmeA==
