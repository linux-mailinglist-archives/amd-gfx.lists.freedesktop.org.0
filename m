Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7AE6CA70D7
	for <lists+amd-gfx@lfdr.de>; Tue,  3 Sep 2019 18:44:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0AA388982C;
	Tue,  3 Sep 2019 16:44:20 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM01-BN3-obe.outbound.protection.outlook.com
 (mail-eopbgr740072.outbound.protection.outlook.com [40.107.74.72])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DD66589838
 for <amd-gfx@lists.freedesktop.org>; Tue,  3 Sep 2019 16:44:16 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=UU05AxiMhmiO5p+lrWgnwcPeFL2voMbWf/kAoX/oYN3qOoDNY0j+VyB7O5hurKCyT9aDgoKDGBAvRfPGNOkH+ZlbmdE9sq7Ciwfs8n8Yc9to7ky7J/5hMzs7V7rvne5w+7PPNDEPobO22dPG4izyCA+Sq/w9SlOwfnsiNU+S9cDHvJnazmKkOj9zqEZz3YQIuR1eXgGAZhFnmh8NuOgB1FJ3W0gVWV3qU/HEqtqzsMkcFTz+NQlRMOcUYGooQ2yMlY6hZMLa2Wc31logywkcPJzqahINwZ28kl4cYclk/w7xMUQ5Jr5xu8bsYnqKEcwG8O5aVMiN+w1100YKpWtgew==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=c5hnEVMB22U/qASW8CpoUFjTiJQiN44UGI1+NOCTq7E=;
 b=L16h1/Fi9tfDt+RYzjXef8fC7YL/PB79JX1V2UFV17OY6ECIsItq46UWeBm0mT1wgoglEKhcOiesX/7kpT6WxlQQF8Ea2H8gyJ1Wfu8iaZBtX86e6FL6Yc9qYj2dUQknb/njp8utKjJSKP8nn8ZjYUmH6hIJgc51ssRsmptM1Q3G7YpjzcSO9kRmiUmXI8vq7tTj1MB9MIGJmUAkcdQ1ecj2Tu557XqzrGfDR73W+PVjenUhA6XL0GP/e/kd4dmzG2YCEDHmjm5hU6RidPsMQSba+YnJ69fmpdUzMMMaia4B7eS8MjqzilD1XWIhCRvzMpAJQEKo3ayCpLEDMU7eZg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=gmail.com smtp.mailfrom=amd.com;
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from BN6PR12CA0042.namprd12.prod.outlook.com (2603:10b6:405:70::28)
 by CH2PR12MB4263.namprd12.prod.outlook.com (2603:10b6:610:a6::8) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2220.21; Tue, 3 Sep
 2019 16:44:12 +0000
Received: from DM3NAM03FT025.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e49::209) by BN6PR12CA0042.outlook.office365.com
 (2603:10b6:405:70::28) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2220.19 via Frontend
 Transport; Tue, 3 Sep 2019 16:44:12 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV01.amd.com (165.204.84.17) by
 DM3NAM03FT025.mail.protection.outlook.com (10.152.82.181) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2220.16 via Frontend Transport; Tue, 3 Sep 2019 16:44:09 +0000
Received: from agrodzovsky-All-Series.amd.com (10.180.168.240) by
 SATLEXCHOV01.amd.com (10.181.40.71) with Microsoft SMTP Server id 14.3.389.1; 
 Tue, 3 Sep 2019 11:44:07 -0500
From: Andrey Grodzovsky <andrey.grodzovsky@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH v4 2/3] dmr/amdgpu: Avoid HW GPU reset for RAS.
Date: Tue, 3 Sep 2019 12:44:03 -0400
Message-ID: <1567529044-5918-2-git-send-email-andrey.grodzovsky@amd.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1567529044-5918-1-git-send-email-andrey.grodzovsky@amd.com>
References: <1567529044-5918-1-git-send-email-andrey.grodzovsky@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(136003)(39860400002)(396003)(346002)(376002)(2980300002)(428003)(189003)(199004)(446003)(478600001)(8676002)(305945005)(336012)(5660300002)(6916009)(51416003)(2351001)(7696005)(76176011)(8936002)(81156014)(54906003)(16586007)(186003)(426003)(26005)(81166006)(2906002)(30864003)(70206006)(70586007)(316002)(86362001)(48376002)(356004)(53936002)(4326008)(14444005)(6666004)(50226002)(36756003)(126002)(2616005)(476003)(44832011)(53416004)(486006)(47776003)(50466002)(11346002)(309714004);
 DIR:OUT; SFP:1101; SCL:1; SRVR:CH2PR12MB4263; H:SATLEXCHOV01.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 5ca4601e-973e-4837-061b-08d7308df22a
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600166)(711020)(4605104)(1401327)(4618075)(2017052603328);
 SRVR:CH2PR12MB4263; 
X-MS-TrafficTypeDiagnostic: CH2PR12MB4263:
X-Microsoft-Antispam-PRVS: <CH2PR12MB4263E32B77306F9AB0D1EEB8EAB90@CH2PR12MB4263.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:949;
X-Forefront-PRVS: 01494FA7F7
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: timgW8XTTH9qJhM7R9W5pfNlEjUsiq9RfzYUmNMfCM2Y1EqZjYkqDfkmkmP+mb8YOJfFm7PVuyyLN5/+koiotHIDcu6mFVQJT0iE02UaJAV74Brfyyv3rP6OwlJSkqfSwyWxwA0+Yr/6nn7963dWW8k/SOqE+s0a3AU3oiPH2hQeNpWoLh5VrxPe/fB1FyJg2F3JBrSt5HvkLSm4mB+9dyuP+FXhO8MmXMT7fJFjOXtynidSiDZaANmTFO68l7zTrUVNswoIpa081PqV2cJbsewk8g1vnTO63atMiQl2sRG1zy4EM9mlrm1ZEAbNouQFaqSyUnCSaY1biedF8GKFtM0i2N1LFny/Rrie1/ZyljRC7tAH6HXM+VzIAS4VIKeig0BCpbKR7Eg6h7VvbMXJjuwqAi7fEI99KZ4ep5cZ2KM=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 03 Sep 2019 16:44:09.3885 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 5ca4601e-973e-4837-061b-08d7308df22a
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV01.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: CH2PR12MB4263
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=c5hnEVMB22U/qASW8CpoUFjTiJQiN44UGI1+NOCTq7E=;
 b=YSmS3hAOH1ZKKYhB2aLb9KdK7+ocLJgx+CRCbb6bQN8cwVznJ98D29iqFKklC7HzvkPGNsyVbXOy1KLmHJ1dmrqANliA9d5NS9aI+lqhlmS/PcjbzQDIOwyWWa/3SYkG0PM7QVFdDqWW0JXWt3ZO8JKbuw85JaNjLd9PKPbivNI=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; gmail.com; dkim=none (message not signed)
 header.d=none;gmail.com; dmarc=permerror action=none header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: alexdeucher@gmail.com, ckoenig.leichtzumerken@gmail.com, Tao.Zhou1@amd.com,
 Andrey Grodzovsky <andrey.grodzovsky@amd.com>, Hawking.Zhang@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

UHJvYmxlbToKVW5kZXIgY2VydGFpbiBjb25kaXRpb25zLCB3aGVuIHNvbWUgSVAgYm9ja3MgdGFr
ZSBhIFJBUyBlcnJvciwKd2UgY2FuIGdldCBpbnRvIGEgc2l0dWF0aW9uIHdoZXJlIGEgR1BVIHJl
c2V0IGlzIG5vdCBwb3NzaWJsZQpkdWUgdG8gaXNzdWVzIGluIFJBUyBpbiBTTVUvUFNQLgoKVGVt
cG9yYXJ5IGZpeCB1bnRpbCBwcm9wZXIgc29sdXRpb24gaW4gUFNQL1NNVSBpcyByZWFkeToKV2hl
biB1bmNvcnJlY3RhYmxlIGVycm9yIGhhcHBlbnMgdGhlIERGIHdpbGwgdW5jb25kaXRpb25hbGx5
CmJyb2FkY2FzdCBlcnJvciBldmVudCBwYWNrZXRzIHRvIGFsbCBpdHMgY2xpZW50cy9zbGF2ZSB1
cG9uCnJlY2VpdmluZyBmYXRhbCBlcnJvciBldmVudCBhbmQgZnJlZXplIGFsbCBpdHMgb3V0Ym91
bmQgcXVldWVzLAplcnJfZXZlbnRfYXRodWIgaW50ZXJydXB0ICB3aWxsIGJlIHRyaWdnZXJlZC4K
SW4gc3VjaCBjYXNlIGFuZCB3ZSB1c2UgdGhpcyBpbnRlcnJ1cHQKdG8gaXNzdWUgR1BVIHJlc2V0
LiBUSGUgR1BVIHJlc2V0IGNvZGUgaXMgbW9kaWZpZWQgZm9yIHN1Y2ggY2FzZSB0byBhdm9pZCBI
VwpyZXNldCwgb25seSBzdG9wcyBzY2hlZHVsZXJzLCBkZWF0Y2hlcyBhbGwgaW4gcHJvZ3Jlc3Mg
YW5kIG5vdCB5ZXQgc2NoZWR1bGVkCmpvYidzIGZlbmNlcywgc2V0IGVycm9yIGNvZGUgb24gdGhl
bSBhbmQgc2lnbmFscy4KQWxzbyByZWplY3QgYW55IG5ldyBpbmNvbWluZyBqb2Igc3VibWlzc2lv
bnMgZnJvbSB1c2VyIHNwYWNlLgpBbGwgdGhpcyBpcyBkb25lIHRvIG5vdGlmeSB0aGUgYXBwbGlj
YXRpb25zIG9mIHRoZSBwcm9ibGVtLgoKdjI6CkV4dHJhY3QgYW1kZ3B1X2FtZGtmZF9wcmUvcG9z
dF9yZXNldCBmcm9tIGFtZGdwdV9kZXZpY2VfbG9jay91bmxvY2tfYWRldgpNb3ZlIGFtZGdwdV9q
b2Jfc3RvcF9hbGxfam9ic19vbl9zY2hlZCB0byBhbWRncHVfam9iLmMKUmVtb3ZlIHByaW50IHBh
cmFtIGZyb20gYW1kZ3B1X3Jhc19xdWVyeV9lcnJvcl9jb3VudAoKdjM6ClVwZGF0ZSBiYXNlZCBv
biBwcmV2b2l1cyBidWcgZml4aW5nIHBhdGNoIHRvIHByb3Blcmx5IGNhbGwgYW1kZ3B1X2FtZGtm
ZF9wcmVfcmVzZXQKZm9yIG90aGVyIFhHTUkgaGl2ZSBtZW1lYmVycy4KClNpZ25lZC1vZmYtYnk6
IEFuZHJleSBHcm9kem92c2t5IDxhbmRyZXkuZ3JvZHpvdnNreUBhbWQuY29tPgpBY2tlZC1ieTog
RmVsaXggS3VlaGxpbmcgPEZlbGl4Lkt1ZWhsaW5nQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgICAgIHwgIDQgKysrKwogZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jIHwgMzggKysrKysrKysrKysrKysrKysrKysrKy0t
LS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMgICAgfCAgNSAr
KysrCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMgICAgfCAzOCArKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9qb2IuaCAgICB8ICAzICsrKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2ttcy5jICAgIHwgIDYgKysrKysKIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9y
YXMuYyAgICB8IDIyICsrKysrKysrKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfcmFzLmggICAgfCAxMCArKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvZ2Z4X3Y5XzAuYyAgICAgIHwgMTAgKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2dtY192OV8wLmMgICAgICB8IDI0ICsrKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L25iaW9fdjdfNC5jICAgICB8ICA1ICsrKysKIGRyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L3NkbWFfdjRfMC5jICAgICB8IDMyICsrKysrKysrKysrKystLS0tLS0tLS0t
LS0KIDEyIGZpbGVzIGNoYW5nZWQsIDE1NSBpbnNlcnRpb25zKCspLCA0MiBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCmluZGV4IGQ4NjAxNzAuLjQ5NGMz
ODQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCkBAIC0zOCw2ICszOCw3
IEBACiAjaW5jbHVkZSAiYW1kZ3B1X2dtYy5oIgogI2luY2x1ZGUgImFtZGdwdV9nZW0uaCIKICNp
bmNsdWRlICJhbWRncHVfZGlzcGxheS5oIgorI2luY2x1ZGUgImFtZGdwdV9yYXMuaCIKIAogc3Rh
dGljIGludCBhbWRncHVfY3NfdXNlcl9mZW5jZV9jaHVuayhzdHJ1Y3QgYW1kZ3B1X2NzX3BhcnNl
ciAqcCwKIAkJCQkgICAgICBzdHJ1Y3QgZHJtX2FtZGdwdV9jc19jaHVua19mZW5jZSAqZGF0YSwK
QEAgLTE0MzgsNiArMTQzOSw5IEBAIGludCBhbWRncHVfY3NfaW9jdGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxwKQogCWJvb2wgcmVzZXJ2
ZWRfYnVmZmVycyA9IGZhbHNlOwogCWludCBpLCByOwogCisJaWYgKGFtZGdwdV9yYXNfaW50cl90
cmlnZ2VyZWQoKSkKKwkJcmV0dXJuIC1FSFdQT0lTT047CisKIAlpZiAoIWFkZXYtPmFjY2VsX3dv
cmtpbmcpCiAJCXJldHVybiAtRUJVU1k7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9kZXZpY2UuYwppbmRleCA2ZjA3ZTZkLi5iZTUyMzE4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2RldmljZS5jCkBAIC0zNzI3LDI1ICszNzI3LDE4IEBAIHN0YXRp
YyBib29sIGFtZGdwdV9kZXZpY2VfbG9ja19hZGV2KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
LCBib29sIHRyeWxvY2spCiAJCWFkZXYtPm1wMV9zdGF0ZSA9IFBQX01QMV9TVEFURV9OT05FOwog
CQlicmVhazsKIAl9Ci0JLyogQmxvY2sga2ZkOiBTUklPViB3b3VsZCBkbyBpdCBzZXBhcmF0ZWx5
ICovCi0JaWYgKCFhbWRncHVfc3Jpb3ZfdmYoYWRldikpCi0gICAgICAgICAgICAgICAgYW1kZ3B1
X2FtZGtmZF9wcmVfcmVzZXQoYWRldik7CiAKIAlyZXR1cm4gdHJ1ZTsKIH0KIAogc3RhdGljIHZv
aWQgYW1kZ3B1X2RldmljZV91bmxvY2tfYWRldihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikK
IHsKLQkvKnVubG9jayBrZmQ6IFNSSU9WIHdvdWxkIGRvIGl0IHNlcGFyYXRlbHkgKi8KLQlpZiAo
IWFtZGdwdV9zcmlvdl92ZihhZGV2KSkKLSAgICAgICAgICAgICAgICBhbWRncHVfYW1ka2ZkX3Bv
c3RfcmVzZXQoYWRldik7CiAJYW1kZ3B1X3ZmX2Vycm9yX3RyYW5zX2FsbChhZGV2KTsKIAlhZGV2
LT5tcDFfc3RhdGUgPSBQUF9NUDFfU1RBVEVfTk9ORTsKIAlhZGV2LT5pbl9ncHVfcmVzZXQgPSAw
OwogCW11dGV4X3VubG9jaygmYWRldi0+bG9ja19yZXNldCk7CiB9CiAKLQogLyoqCiAgKiBhbWRn
cHVfZGV2aWNlX2dwdV9yZWNvdmVyIC0gcmVzZXQgdGhlIGFzaWMgYW5kIHJlY292ZXIgc2NoZWR1
bGVyCiAgKgpAQCAtMzc2NSwxMSArMzc1OCwxMiBAQCBpbnQgYW1kZ3B1X2RldmljZV9ncHVfcmVj
b3ZlcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAlzdHJ1Y3QgYW1kZ3B1X2hpdmVfaW5m
byAqaGl2ZSA9IE5VTEw7CiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKnRtcF9hZGV2ID0gTlVMTDsK
IAlpbnQgaSwgciA9IDA7CisJYm9vbCBpbl9yYXNfaW50ciA9IGFtZGdwdV9yYXNfaW50cl90cmln
Z2VyZWQoKTsKIAogCW5lZWRfZnVsbF9yZXNldCA9IGpvYl9zaWduYWxlZCA9IGZhbHNlOwogCUlO
SVRfTElTVF9IRUFEKCZkZXZpY2VfbGlzdCk7CiAKLQlkZXZfaW5mbyhhZGV2LT5kZXYsICJHUFUg
cmVzZXQgYmVnaW4hXG4iKTsKKwlkZXZfaW5mbyhhZGV2LT5kZXYsICJHUFUgJXMgYmVnaW4hXG4i
LCBpbl9yYXNfaW50ciA/ICJqb2JzIHN0b3AiOiJyZXNldCIpOwogCiAJY2FuY2VsX2RlbGF5ZWRf
d29ya19zeW5jKCZhZGV2LT5kZWxheWVkX2luaXRfd29yayk7CiAKQEAgLTM3OTYsOSArMzc5MCwx
NiBAQCBpbnQgYW1kZ3B1X2RldmljZV9ncHVfcmVjb3ZlcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiwKIAkJcmV0dXJuIDA7CiAJfQogCisJLyogQmxvY2sga2ZkOiBTUklPViB3b3VsZCBkbyBp
dCBzZXBhcmF0ZWx5ICovCisJaWYgKCFhbWRncHVfc3Jpb3ZfdmYoYWRldikpCisgICAgICAgICAg
ICAgICAgYW1kZ3B1X2FtZGtmZF9wcmVfcmVzZXQoYWRldik7CisKIAkvKiBCdWlsZCBsaXN0IG9m
IGRldmljZXMgdG8gcmVzZXQgKi8KIAlpZiAgKGFkZXYtPmdtYy54Z21pLm51bV9waHlzaWNhbF9u
b2RlcyA+IDEpIHsKIAkJaWYgKCFoaXZlKSB7CisJCQkvKnVubG9jayBrZmQ6IFNSSU9WIHdvdWxk
IGRvIGl0IHNlcGFyYXRlbHkgKi8KKwkJCWlmICghYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKQorCQkg
ICAgICAgICAgICAgICAgYW1kZ3B1X2FtZGtmZF9wb3N0X3Jlc2V0KGFkZXYpOwogCQkJYW1kZ3B1
X2RldmljZV91bmxvY2tfYWRldihhZGV2KTsKIAkJCXJldHVybiAtRU5PREVWOwogCQl9CkBAIC0z
ODE2LDggKzM4MTcsMTIgQEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1X3JlY292ZXIoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsCiAKIAkvKiBibG9jayBhbGwgc2NoZWR1bGVycyBhbmQgcmVzZXQg
Z2l2ZW4gam9iJ3MgcmluZyAqLwogCWxpc3RfZm9yX2VhY2hfZW50cnkodG1wX2FkZXYsIGRldmlj
ZV9saXN0X2hhbmRsZSwgZ21jLnhnbWkuaGVhZCkgewotCQlpZiAodG1wX2FkZXYgIT0gYWRldikK
KwkJaWYgKHRtcF9hZGV2ICE9IGFkZXYpIHsKIAkJCWFtZGdwdV9kZXZpY2VfbG9ja19hZGV2KHRt
cF9hZGV2LCBmYWxzZSk7CisJCQlpZiAoIWFtZGdwdV9zcmlvdl92Zih0bXBfYWRldikpCisJCQkg
ICAgICAgICAgICAgICAgYW1kZ3B1X2FtZGtmZF9wcmVfcmVzZXQodG1wX2FkZXYpOworCQl9CisK
IAkJLyoKIAkJICogTWFyayB0aGVzZSBBU0lDcyB0byBiZSByZXNldGVkIGFzIHVudHJhY2tlZCBm
aXJzdAogCQkgKiBBbmQgYWRkIHRoZW0gYmFjayBhZnRlciByZXNldCBjb21wbGV0ZWQKQEAgLTM4
MjUsNyArMzgzMCw3IEBAIGludCBhbWRncHVfZGV2aWNlX2dwdV9yZWNvdmVyKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LAogCQlhbWRncHVfdW5yZWdpc3Rlcl9ncHVfaW5zdGFuY2UodG1wX2Fk
ZXYpOwogCiAJCS8qIGRpc2FibGUgcmFzIG9uIEFMTCBJUHMgKi8KLQkJaWYgKGFtZGdwdV9kZXZp
Y2VfaXBfbmVlZF9mdWxsX3Jlc2V0KHRtcF9hZGV2KSkKKwkJaWYgKCFpbl9yYXNfaW50ciAmJiBh
bWRncHVfZGV2aWNlX2lwX25lZWRfZnVsbF9yZXNldCh0bXBfYWRldikpCiAJCQlhbWRncHVfcmFz
X3N1c3BlbmQodG1wX2FkZXYpOwogCiAJCWZvciAoaSA9IDA7IGkgPCBBTURHUFVfTUFYX1JJTkdT
OyArK2kpIHsKQEAgLTM4MzUsMTAgKzM4NDAsMTYgQEAgaW50IGFtZGdwdV9kZXZpY2VfZ3B1X3Jl
Y292ZXIoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCQkJY29udGludWU7CiAKIAkJCWRy
bV9zY2hlZF9zdG9wKCZyaW5nLT5zY2hlZCwgam9iID8gJmpvYi0+YmFzZSA6IE5VTEwpOworCisJ
CQlpZiAoaW5fcmFzX2ludHIpCisJCQkJYW1kZ3B1X2pvYl9zdG9wX2FsbF9qb2JzX29uX3NjaGVk
KCZyaW5nLT5zY2hlZCk7CiAJCX0KIAl9CiAKIAorCWlmIChpbl9yYXNfaW50cikKKwkJZ290byBz
a2lwX3NjaGVkX3Jlc3VtZTsKKwogCS8qCiAJICogTXVzdCBjaGVjayBndWlsdHkgc2lnbmFsIGhl
cmUgc2luY2UgYWZ0ZXIgdGhpcyBwb2ludCBhbGwgb2xkCiAJICogSFcgZmVuY2VzIGFyZSBmb3Jj
ZSBzaWduYWxlZC4KQEAgLTM4OTcsNiArMzkwOCw3IEBAIGludCBhbWRncHVfZGV2aWNlX2dwdV9y
ZWNvdmVyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCiAJLyogUG9zdCBBU0lDIHJlc2V0
IGZvciBhbGwgZGV2cyAuKi8KIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHRtcF9hZGV2LCBkZXZpY2Vf
bGlzdF9oYW5kbGUsIGdtYy54Z21pLmhlYWQpIHsKKwogCQlmb3IgKGkgPSAwOyBpIDwgQU1ER1BV
X01BWF9SSU5HUzsgKytpKSB7CiAJCQlzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcgPSB0bXBfYWRl
di0+cmluZ3NbaV07CiAKQEAgLTM5MjMsNyArMzkzNSwxMyBAQCBpbnQgYW1kZ3B1X2RldmljZV9n
cHVfcmVjb3ZlcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJfSBlbHNlIHsKIAkJCWRl
dl9pbmZvKHRtcF9hZGV2LT5kZXYsICJHUFUgcmVzZXQoJWQpIHN1Y2NlZWRlZCFcbiIsIGF0b21p
Y19yZWFkKCZ0bXBfYWRldi0+Z3B1X3Jlc2V0X2NvdW50ZXIpKTsKIAkJfQorCX0KIAorc2tpcF9z
Y2hlZF9yZXN1bWU6CisJbGlzdF9mb3JfZWFjaF9lbnRyeSh0bXBfYWRldiwgZGV2aWNlX2xpc3Rf
aGFuZGxlLCBnbWMueGdtaS5oZWFkKSB7CisJCS8qdW5sb2NrIGtmZDogU1JJT1Ygd291bGQgZG8g
aXQgc2VwYXJhdGVseSAqLworCQlpZiAoIWluX3Jhc19pbnRyICYmICFhbWRncHVfc3Jpb3ZfdmYo
dG1wX2FkZXYpKQorCSAgICAgICAgICAgICAgICBhbWRncHVfYW1ka2ZkX3Bvc3RfcmVzZXQodG1w
X2FkZXYpOwogCQlhbWRncHVfZGV2aWNlX3VubG9ja19hZGV2KHRtcF9hZGV2KTsKIAl9CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYwppbmRleCA3Njc5ZmU4Li5jNzNkMjZh
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCkBAIC00MCw2ICs0MCw4
IEBACiAKICNpbmNsdWRlICJhbWRncHVfYW1ka2ZkLmgiCiAKKyNpbmNsdWRlICJhbWRncHVfcmFz
LmgiCisKIC8qCiAgKiBLTVMgd3JhcHBlci4KICAqIC0gMy4wLjAgLSBpbml0aWFsIGRyaXZlcgpA
QCAtMTE4MCw2ICsxMTgyLDkgQEAgYW1kZ3B1X3BjaV9zaHV0ZG93bihzdHJ1Y3QgcGNpX2RldiAq
cGRldikKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gcGNpX2dldF9kcnZkYXRhKHBkZXYpOwog
CXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKIAorCWlmIChh
bWRncHVfcmFzX2ludHJfdHJpZ2dlcmVkKCkpCisJCXJldHVybjsKKwogCS8qIGlmIHdlIGFyZSBy
dW5uaW5nIGluIGEgVk0sIG1ha2Ugc3VyZSB0aGUgZGV2aWNlCiAJICogdG9ybiBkb3duIHByb3Bl
cmx5IG9uIHJlYm9vdC9zaHV0ZG93bi4KIAkgKiB1bmZvcnR1bmF0ZWx5IHdlIGNhbid0IGRldGVj
dCBjZXJ0YWluCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
am9iLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmMKaW5kZXggNGQ2
N2I3Ny4uYjEyOTgxZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2pvYi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9qb2IuYwpA
QCAtMjUwLDYgKzI1MCw0NCBAQCBzdGF0aWMgc3RydWN0IGRtYV9mZW5jZSAqYW1kZ3B1X2pvYl9y
dW4oc3RydWN0IGRybV9zY2hlZF9qb2IgKnNjaGVkX2pvYikKIAlyZXR1cm4gZmVuY2U7CiB9CiAK
KyNkZWZpbmUgdG9fZHJtX3NjaGVkX2pvYihzY2hlZF9qb2IpCQlcCisJCWNvbnRhaW5lcl9vZigo
c2NoZWRfam9iKSwgc3RydWN0IGRybV9zY2hlZF9qb2IsIHF1ZXVlX25vZGUpCisKK3ZvaWQgYW1k
Z3B1X2pvYl9zdG9wX2FsbF9qb2JzX29uX3NjaGVkKHN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciAq
c2NoZWQpCit7CisJc3RydWN0IGRybV9zY2hlZF9qb2IgKnNfam9iOworCXN0cnVjdCBkcm1fc2No
ZWRfZW50aXR5ICpzX2VudGl0eSA9IE5VTEw7CisJaW50IGk7CisKKwkvKiBTaWduYWwgYWxsIGpv
YnMgbm90IHlldCBzY2hlZHVsZWQgKi8KKwlmb3IgKGkgPSBEUk1fU0NIRURfUFJJT1JJVFlfTUFY
IC0gMTsgaSA+PSBEUk1fU0NIRURfUFJJT1JJVFlfTUlOOyBpLS0pIHsKKwkJc3RydWN0IGRybV9z
Y2hlZF9ycSAqcnEgPSAmc2NoZWQtPnNjaGVkX3JxW2ldOworCisJCWlmICghcnEpCisJCQljb250
aW51ZTsKKworCQlzcGluX2xvY2soJnJxLT5sb2NrKTsKKwkJbGlzdF9mb3JfZWFjaF9lbnRyeShz
X2VudGl0eSwgJnJxLT5lbnRpdGllcywgbGlzdCkgeworCQkJd2hpbGUgKChzX2pvYiA9IHRvX2Ry
bV9zY2hlZF9qb2Ioc3BzY19xdWV1ZV9wb3AoJnNfZW50aXR5LT5qb2JfcXVldWUpKSkpIHsKKwkJ
CQlzdHJ1Y3QgZHJtX3NjaGVkX2ZlbmNlICpzX2ZlbmNlID0gc19qb2ItPnNfZmVuY2U7CisKKwkJ
CQlkbWFfZmVuY2Vfc2lnbmFsKCZzX2ZlbmNlLT5zY2hlZHVsZWQpOworCQkJCWRtYV9mZW5jZV9z
ZXRfZXJyb3IoJnNfZmVuY2UtPmZpbmlzaGVkLCAtRUhXUE9JU09OKTsKKwkJCQlkbWFfZmVuY2Vf
c2lnbmFsKCZzX2ZlbmNlLT5maW5pc2hlZCk7CisJCQl9CisJCX0KKwkJc3Bpbl91bmxvY2soJnJx
LT5sb2NrKTsKKwl9CisKKwkvKiBTaWduYWwgYWxsIGpvYnMgYWxyZWFkeSBzY2hlZHVsZWQgdG8g
SFcgKi8KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHNfam9iLCAmc2NoZWQtPnJpbmdfbWlycm9yX2xp
c3QsIG5vZGUpIHsKKwkJc3RydWN0IGRybV9zY2hlZF9mZW5jZSAqc19mZW5jZSA9IHNfam9iLT5z
X2ZlbmNlOworCisJCWRtYV9mZW5jZV9zZXRfZXJyb3IoJnNfZmVuY2UtPmZpbmlzaGVkLCAtRUhX
UE9JU09OKTsKKwkJZG1hX2ZlbmNlX3NpZ25hbCgmc19mZW5jZS0+ZmluaXNoZWQpOworCX0KK30K
KwogY29uc3Qgc3RydWN0IGRybV9zY2hlZF9iYWNrZW5kX29wcyBhbWRncHVfc2NoZWRfb3BzID0g
ewogCS5kZXBlbmRlbmN5ID0gYW1kZ3B1X2pvYl9kZXBlbmRlbmN5LAogCS5ydW5fam9iID0gYW1k
Z3B1X2pvYl9ydW4sCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfam9iLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfam9iLmgKaW5kZXgg
NTFlNjI1MC4uZGM3ZWU5MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2pvYi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9qb2Iu
aApAQCAtNzYsNCArNzYsNyBAQCBpbnQgYW1kZ3B1X2pvYl9zdWJtaXQoc3RydWN0IGFtZGdwdV9q
b2IgKmpvYiwgc3RydWN0IGRybV9zY2hlZF9lbnRpdHkgKmVudGl0eSwKIAkJICAgICAgdm9pZCAq
b3duZXIsIHN0cnVjdCBkbWFfZmVuY2UgKipmKTsKIGludCBhbWRncHVfam9iX3N1Ym1pdF9kaXJl
Y3Qoc3RydWN0IGFtZGdwdV9qb2IgKmpvYiwgc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLAogCQkJ
ICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICoqZmVuY2UpOworCit2b2lkIGFtZGdwdV9qb2Jfc3RvcF9h
bGxfam9ic19vbl9zY2hlZChzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVkKTsKKwogI2Vu
ZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMKaW5kZXggMzVhMDg2Ni4u
NTM1ZjY5MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2tt
cy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwpAQCAtMTA0
Niw2ICsxMDQ2LDEyIEBAIGludCBhbWRncHVfZHJpdmVyX29wZW5fa21zKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KQogCS8qIEVuc3VyZSBJQiB0ZXN0
cyBhcmUgcnVuIG9uIHJpbmcgKi8KIAlmbHVzaF9kZWxheWVkX3dvcmsoJmFkZXYtPmRlbGF5ZWRf
aW5pdF93b3JrKTsKIAorCisJaWYgKGFtZGdwdV9yYXNfaW50cl90cmlnZ2VyZWQoKSkgeworCQlE
Uk1fRVJST1IoIlJBUyBJbnRyIHRyaWdnZXJlZCwgZGV2aWNlIGRpc2FibGVkISEiKTsKKwkJcmV0
dXJuIC1FSFdQT0lTT047CisJfQorCiAJZmlsZV9wcml2LT5kcml2ZXJfcHJpdiA9IE5VTEw7CiAK
IAlyID0gcG1fcnVudGltZV9nZXRfc3luYyhkZXYtPmRldik7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfcmFzLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfcmFzLmMKaW5kZXggYWE1MWMwMC4uMWNjMzRkZSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Jhcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMuYwpAQCAtMjQsNiArMjQsOCBAQAogI2luY2x1ZGUgPGxp
bnV4L2RlYnVnZnMuaD4KICNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CiAjaW5jbHVkZSA8bGludXgv
bW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvcmVib290Lmg+CisjaW5jbHVkZSA8bGludXgvc3lz
Y2FsbHMuaD4KICNpbmNsdWRlICJhbWRncHUuaCIKICNpbmNsdWRlICJhbWRncHVfcmFzLmgiCiAj
aW5jbHVkZSAiYW1kZ3B1X2F0b21maXJtd2FyZS5oIgpAQCAtNjQsNiArNjYsOSBAQCBjb25zdCBj
aGFyICpyYXNfYmxvY2tfc3RyaW5nW10gPSB7CiAvKiBpbmplY3QgYWRkcmVzcyBpcyA1MiBiaXRz
ICovCiAjZGVmaW5lCVJBU19VTUNfSU5KRUNUX0FERFJfTElNSVQJKDB4MVVMTCA8PCA1MikKIAor
CithdG9taWNfdCBhbWRncHVfcmFzX2luX2ludHIgPSBBVE9NSUNfSU5JVCgwKTsKKwogc3RhdGlj
IGludCBhbWRncHVfcmFzX3Jlc2VydmVfdnJhbShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwK
IAkJdWludDY0X3Qgb2Zmc2V0LCB1aW50NjRfdCBzaXplLAogCQlzdHJ1Y3QgYW1kZ3B1X2JvICoq
Ym9fcHRyKTsKQEAgLTE4OCw2ICsxOTMsMTAgQEAgc3RhdGljIGludCBhbWRncHVfcmFzX2RlYnVn
ZnNfY3RybF9wYXJzZV9kYXRhKHN0cnVjdCBmaWxlICpmLAogCiAJcmV0dXJuIDA7CiB9CisKK3N0
YXRpYyBzdHJ1Y3QgcmFzX21hbmFnZXIgKmFtZGdwdV9yYXNfZmluZF9vYmooc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsCisJCXN0cnVjdCByYXNfY29tbW9uX2lmICpoZWFkKTsKKwogLyoqCiAg
KiBET0M6IEFNREdQVSBSQVMgZGVidWdmcyBjb250cm9sIGludGVyZmFjZQogICoKQEAgLTYyNywx
MiArNjM2LDE0IEBAIGludCBhbWRncHVfcmFzX2Vycm9yX3F1ZXJ5KHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LAogCWluZm8tPnVlX2NvdW50ID0gb2JqLT5lcnJfZGF0YS51ZV9jb3VudDsKIAlp
bmZvLT5jZV9jb3VudCA9IG9iai0+ZXJyX2RhdGEuY2VfY291bnQ7CiAKLQlpZiAoZXJyX2RhdGEu
Y2VfY291bnQpCisJaWYgKGVycl9kYXRhLmNlX2NvdW50KSB7CiAJCWRldl9pbmZvKGFkZXYtPmRl
diwgIiVsZCBjb3JyZWN0YWJsZSBlcnJvcnMgZGV0ZWN0ZWQgaW4gJXMgYmxvY2tcbiIsCiAJCQkg
b2JqLT5lcnJfZGF0YS5jZV9jb3VudCwgcmFzX2Jsb2NrX3N0cihpbmZvLT5oZWFkLmJsb2NrKSk7
Ci0JaWYgKGVycl9kYXRhLnVlX2NvdW50KQorCX0KKwlpZiAoZXJyX2RhdGEudWVfY291bnQpIHsK
IAkJZGV2X2luZm8oYWRldi0+ZGV2LCAiJWxkIHVuY29ycmVjdGFibGUgZXJyb3JzIGRldGVjdGVk
IGluICVzIGJsb2NrXG4iLAogCQkJIG9iai0+ZXJyX2RhdGEudWVfY291bnQsIHJhc19ibG9ja19z
dHIoaW5mby0+aGVhZC5ibG9jaykpOworCX0KIAogCXJldHVybiAwOwogfQpAQCAtMTcxOCwzICsx
NzI5LDEwIEBAIGludCBhbWRncHVfcmFzX2Zpbmkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYp
CiAKIAlyZXR1cm4gMDsKIH0KKwordm9pZCBhbWRncHVfcmFzX2dsb2JhbF9yYXNfaXNyKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2KQoreworCWlmIChhdG9taWNfY21weGNoZygmYW1kZ3B1X3Jh
c19pbl9pbnRyLCAwLCAxKSA9PSAwKSB7CisJCURSTV9XQVJOKCJSQVMgZXZlbnQgb2YgdHlwZSBF
UlJFVkVOVF9BVEhVQl9JTlRFUlJVUFQgZGV0ZWN0ZWQhIFN0b3BwaW5nIGFsbCBHUFUgam9icy5c
biIpOworCX0KK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9yYXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9yYXMuaAppbmRleCBm
YzRmYjBmLi4zZWMyYTg3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfcmFzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3Jhcy5o
CkBAIC02MDAsNCArNjAwLDE0IEBAIGludCBhbWRncHVfcmFzX2ludGVycnVwdF9yZW1vdmVfaGFu
ZGxlcihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAogaW50IGFtZGdwdV9yYXNfaW50ZXJy
dXB0X2Rpc3BhdGNoKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQlzdHJ1Y3QgcmFzX2Rp
c3BhdGNoX2lmICppbmZvKTsKKworZXh0ZXJuIGF0b21pY190IGFtZGdwdV9yYXNfaW5faW50cjsK
Kworc3RhdGljIGlubGluZSBib29sIGFtZGdwdV9yYXNfaW50cl90cmlnZ2VyZWQodm9pZCkKK3sK
KwlyZXR1cm4gISFhdG9taWNfcmVhZCgmYW1kZ3B1X3Jhc19pbl9pbnRyKTsKK30KKwordm9pZCBh
bWRncHVfcmFzX2dsb2JhbF9yYXNfaXNyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KTsKKwog
I2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjlfMC5j
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ2Z4X3Y5XzAuYwppbmRleCA5M2UzZTg5Li44
MTc5OTdiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nZnhfdjlfMC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dmeF92OV8wLmMKQEAgLTU2NzYsMTAg
KzU2NzYsMTIgQEAgc3RhdGljIGludCBnZnhfdjlfMF9wcm9jZXNzX3Jhc19kYXRhX2NiKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2LAogCQlzdHJ1Y3QgYW1kZ3B1X2l2X2VudHJ5ICplbnRyeSkK
IHsKIAkvKiBUT0RPIHVlIHdpbGwgdHJpZ2dlciBhbiBpbnRlcnJ1cHQuICovCi0Ja2dkMmtmZF9z
ZXRfc3JhbV9lY2NfZmxhZyhhZGV2LT5rZmQuZGV2KTsKLQlpZiAoYWRldi0+Z2Z4LmZ1bmNzLT5x
dWVyeV9yYXNfZXJyb3JfY291bnQpCi0JCWFkZXYtPmdmeC5mdW5jcy0+cXVlcnlfcmFzX2Vycm9y
X2NvdW50KGFkZXYsIGVycl9kYXRhKTsKLQlhbWRncHVfcmFzX3Jlc2V0X2dwdShhZGV2LCAwKTsK
KwlpZiAoIWFtZGdwdV9yYXNfaXNfc3VwcG9ydGVkKGFkZXYsIEFNREdQVV9SQVNfQkxPQ0tfX0dG
WCkpIHsKKwkJa2dkMmtmZF9zZXRfc3JhbV9lY2NfZmxhZyhhZGV2LT5rZmQuZGV2KTsKKwkJaWYg
KGFkZXYtPmdmeC5mdW5jcy0+cXVlcnlfcmFzX2Vycm9yX2NvdW50KQorCQkJYWRldi0+Z2Z4LmZ1
bmNzLT5xdWVyeV9yYXNfZXJyb3JfY291bnQoYWRldiwgZXJyX2RhdGEpOworCQlhbWRncHVfcmFz
X3Jlc2V0X2dwdShhZGV2LCAwKTsKKwl9CiAJcmV0dXJuIEFNREdQVV9SQVNfU1VDQ0VTUzsKIH0K
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2dtY192OV8wLmMKaW5kZXggNWViMTdjNy4uMmE2YWM2
MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZ21jX3Y5XzAuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9nbWNfdjlfMC5jCkBAIC0yNDMsMTggKzI0Mywy
MCBAQCBzdGF0aWMgaW50IGdtY192OV8wX3Byb2Nlc3NfcmFzX2RhdGFfY2Ioc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsCiAJCXN0cnVjdCByYXNfZXJyX2RhdGEgKmVycl9kYXRhLAogCQlzdHJ1
Y3QgYW1kZ3B1X2l2X2VudHJ5ICplbnRyeSkKIHsKLQlrZ2Qya2ZkX3NldF9zcmFtX2VjY19mbGFn
KGFkZXYtPmtmZC5kZXYpOwotCWlmIChhZGV2LT51bWMuZnVuY3MtPnF1ZXJ5X3Jhc19lcnJvcl9j
b3VudCkKLQkJYWRldi0+dW1jLmZ1bmNzLT5xdWVyeV9yYXNfZXJyb3JfY291bnQoYWRldiwgZXJy
X2RhdGEpOwotCS8qIHVtYyBxdWVyeV9yYXNfZXJyb3JfYWRkcmVzcyBpcyBhbHNvIHJlc3BvbnNp
YmxlIGZvciBjbGVhcmluZwotCSAqIGVycm9yIHN0YXR1cwotCSAqLwotCWlmIChhZGV2LT51bWMu
ZnVuY3MtPnF1ZXJ5X3Jhc19lcnJvcl9hZGRyZXNzKQotCQlhZGV2LT51bWMuZnVuY3MtPnF1ZXJ5
X3Jhc19lcnJvcl9hZGRyZXNzKGFkZXYsIGVycl9kYXRhKTsKKwlpZiAoIWFtZGdwdV9yYXNfaXNf
c3VwcG9ydGVkKGFkZXYsIEFNREdQVV9SQVNfQkxPQ0tfX0dGWCkpIHsKKwkJa2dkMmtmZF9zZXRf
c3JhbV9lY2NfZmxhZyhhZGV2LT5rZmQuZGV2KTsKKwkJaWYgKGFkZXYtPnVtYy5mdW5jcy0+cXVl
cnlfcmFzX2Vycm9yX2NvdW50KQorCQkJYWRldi0+dW1jLmZ1bmNzLT5xdWVyeV9yYXNfZXJyb3Jf
Y291bnQoYWRldiwgZXJyX2RhdGEpOworCQkvKiB1bWMgcXVlcnlfcmFzX2Vycm9yX2FkZHJlc3Mg
aXMgYWxzbyByZXNwb25zaWJsZSBmb3IgY2xlYXJpbmcKKwkJICogZXJyb3Igc3RhdHVzCisJCSAq
LworCQlpZiAoYWRldi0+dW1jLmZ1bmNzLT5xdWVyeV9yYXNfZXJyb3JfYWRkcmVzcykKKwkJCWFk
ZXYtPnVtYy5mdW5jcy0+cXVlcnlfcmFzX2Vycm9yX2FkZHJlc3MoYWRldiwgZXJyX2RhdGEpOwog
Ci0JLyogb25seSB1bmNvcnJlY3RhYmxlIGVycm9yIG5lZWRzIGdwdSByZXNldCAqLwotCWlmIChl
cnJfZGF0YS0+dWVfY291bnQpCi0JCWFtZGdwdV9yYXNfcmVzZXRfZ3B1KGFkZXYsIDApOworCQkv
KiBvbmx5IHVuY29ycmVjdGFibGUgZXJyb3IgbmVlZHMgZ3B1IHJlc2V0ICovCisJCWlmIChlcnJf
ZGF0YS0+dWVfY291bnQpCisJCQlhbWRncHVfcmFzX3Jlc2V0X2dwdShhZGV2LCAwKTsKKwl9CiAK
IAlyZXR1cm4gQU1ER1BVX1JBU19TVUNDRVNTOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvbmJpb192N180LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9u
YmlvX3Y3XzQuYwppbmRleCAzNjdmOWQ2Li41NDU5OTBjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9uYmlvX3Y3XzQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9uYmlvX3Y3XzQuYwpAQCAtMzAsNiArMzAsNyBAQAogI2luY2x1ZGUgIm5iaW8vbmJpb183
XzRfMF9zbW4uaCIKICNpbmNsdWRlICJpdnNyY2lkL25iaW8vaXJxc3Jjc19uYmlmXzdfNC5oIgog
I2luY2x1ZGUgPHVhcGkvbGludXgva2ZkX2lvY3RsLmg+CisjaW5jbHVkZSAiYW1kZ3B1X3Jhcy5o
IgogCiAjZGVmaW5lIHNtbk5CSUZfTUdDR19DVFJMX0xDTEsJMHgxMDEzYTIxYwogCkBAIC0zMjks
NiArMzMwLDggQEAgc3RhdGljIHZvaWQgbmJpb192N180X2hhbmRsZV9yYXNfY29udHJvbGxlcl9p
bnRyX25vX2JpZnJpbmcoc3RydWN0IGFtZGdwdV9kZXZpY2UKIAkJCQkJCUJJRl9ET09SQkVMTF9J
TlRfQ05UTCwKIAkJCQkJCVJBU19DTlRMUl9JTlRFUlJVUFRfQ0xFQVIsIDEpOwogCQlXUkVHMzJf
U09DMTUoTkJJTywgMCwgbW1CSUZfRE9PUkJFTExfSU5UX0NOVEwsIGJpZl9kb29yYmVsbF9pbnRy
X2NudGwpOworCisJCWFtZGdwdV9yYXNfZ2xvYmFsX3Jhc19pc3IoYWRldik7CiAJfQogfQogCkBA
IC0zNDQsNiArMzQ3LDggQEAgc3RhdGljIHZvaWQgbmJpb192N180X2hhbmRsZV9yYXNfZXJyX2V2
ZW50X2F0aHViX2ludHJfbm9fYmlmcmluZyhzdHJ1Y3QgYW1kZ3B1X2QKIAkJCQkJCUJJRl9ET09S
QkVMTF9JTlRfQ05UTCwKIAkJCQkJCVJBU19BVEhVQl9FUlJfRVZFTlRfSU5URVJSVVBUX0NMRUFS
LCAxKTsKIAkJV1JFRzMyX1NPQzE1KE5CSU8sIDAsIG1tQklGX0RPT1JCRUxMX0lOVF9DTlRMLCBi
aWZfZG9vcmJlbGxfaW50cl9jbnRsKTsKKworCQlhbWRncHVfcmFzX2dsb2JhbF9yYXNfaXNyKGFk
ZXYpOwogCX0KIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2Rt
YV92NF8wLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zZG1hX3Y0XzAuYwppbmRleCBi
M2VkNTMzLi5iMDU0MjhmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9z
ZG1hX3Y0XzAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zZG1hX3Y0XzAuYwpA
QCAtMTk3MiwyNCArMTk3MiwyNiBAQCBzdGF0aWMgaW50IHNkbWFfdjRfMF9wcm9jZXNzX3Jhc19k
YXRhX2NiKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCXVpbnQzMl90IGVycl9zb3VyY2U7
CiAJaW50IGluc3RhbmNlOwogCi0JaW5zdGFuY2UgPSBzZG1hX3Y0XzBfaXJxX2lkX3RvX3NlcShl
bnRyeS0+Y2xpZW50X2lkKTsKLQlpZiAoaW5zdGFuY2UgPCAwKQotCQlyZXR1cm4gMDsKKwlpZiAo
IWFtZGdwdV9yYXNfaXNfc3VwcG9ydGVkKGFkZXYsIEFNREdQVV9SQVNfQkxPQ0tfX0dGWCkpIHsK
KwkJaW5zdGFuY2UgPSBzZG1hX3Y0XzBfaXJxX2lkX3RvX3NlcShlbnRyeS0+Y2xpZW50X2lkKTsK
KwkJaWYgKGluc3RhbmNlIDwgMCkKKwkJCXJldHVybiAwOwogCi0Jc3dpdGNoIChlbnRyeS0+c3Jj
X2lkKSB7Ci0JY2FzZSBTRE1BMF80XzBfX1NSQ0lEX19TRE1BX1NSQU1fRUNDOgotCQllcnJfc291
cmNlID0gMDsKLQkJYnJlYWs7Ci0JY2FzZSBTRE1BMF80XzBfX1NSQ0lEX19TRE1BX0VDQzoKLQkJ
ZXJyX3NvdXJjZSA9IDE7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCXJldHVybiAwOwotCX0KKwkJ
c3dpdGNoIChlbnRyeS0+c3JjX2lkKSB7CisJCWNhc2UgU0RNQTBfNF8wX19TUkNJRF9fU0RNQV9T
UkFNX0VDQzoKKwkJCWVycl9zb3VyY2UgPSAwOworCQkJYnJlYWs7CisJCWNhc2UgU0RNQTBfNF8w
X19TUkNJRF9fU0RNQV9FQ0M6CisJCQllcnJfc291cmNlID0gMTsKKwkJCWJyZWFrOworCQlkZWZh
dWx0OgorCQkJcmV0dXJuIDA7CisJCX0KIAotCWtnZDJrZmRfc2V0X3NyYW1fZWNjX2ZsYWcoYWRl
di0+a2ZkLmRldik7CisJCWtnZDJrZmRfc2V0X3NyYW1fZWNjX2ZsYWcoYWRldi0+a2ZkLmRldik7
CiAKLQlhbWRncHVfcmFzX3Jlc2V0X2dwdShhZGV2LCAwKTsKKwkJYW1kZ3B1X3Jhc19yZXNldF9n
cHUoYWRldiwgMCk7CisJfQogCiAJcmV0dXJuIEFNREdQVV9SQVNfU1VDQ0VTUzsKIH0KLS0gCjIu
Ny40CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQt
Z2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2FtZC1nZng=
