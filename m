Return-Path: <amd-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+amd-gfx@lfdr.de
Delivered-To: lists+amd-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 895AD10187
	for <lists+amd-gfx@lfdr.de>; Tue, 30 Apr 2019 23:10:12 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6491789293;
	Tue, 30 Apr 2019 21:10:08 +0000 (UTC)
X-Original-To: amd-gfx@lists.freedesktop.org
Delivered-To: amd-gfx@lists.freedesktop.org
Received: from NAM02-CY1-obe.outbound.protection.outlook.com
 (mail-eopbgr760054.outbound.protection.outlook.com [40.107.76.54])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 20D7489261
 for <amd-gfx@lists.freedesktop.org>; Tue, 30 Apr 2019 21:10:05 +0000 (UTC)
Received: from SN1PR12CA0063.namprd12.prod.outlook.com (2603:10b6:802:20::34)
 by BLUPR12MB0643.namprd12.prod.outlook.com (2a01:111:e400:594e::25)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.1835.13; Tue, 30 Apr
 2019 21:10:02 +0000
Received: from BY2NAM03FT031.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e4a::202) by SN1PR12CA0063.outlook.office365.com
 (2603:10b6:802:20::34) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id 15.20.1856.10 via Frontend
 Transport; Tue, 30 Apr 2019 21:10:02 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV01.amd.com (165.204.84.17) by
 BY2NAM03FT031.mail.protection.outlook.com (10.152.84.216) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.1835.14 via Frontend Transport; Tue, 30 Apr 2019 21:10:02 +0000
Received: from blakha.amd.com (10.180.168.240) by SATLEXCHOV01.amd.com
 (10.181.40.71) with Microsoft SMTP Server id 14.3.389.1; Tue, 30 Apr 2019
 16:09:52 -0500
From: Bhawanpreet Lakha <Bhawanpreet.Lakha@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH 12/20] drm/amd/display: Rework DC plane filling and surface
 updates
Date: Tue, 30 Apr 2019 17:09:22 -0400
Message-ID: <20190430210938.32335-25-Bhawanpreet.Lakha@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190430210938.32335-1-Bhawanpreet.Lakha@amd.com>
References: <20190430210938.32335-1-Bhawanpreet.Lakha@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(376002)(136003)(39860400002)(346002)(396003)(2980300002)(428003)(199004)(189003)(7696005)(26005)(4326008)(68736007)(8936002)(81166006)(8676002)(77096007)(305945005)(81156014)(2351001)(51416003)(53416004)(6916009)(86362001)(50226002)(47776003)(76176011)(486006)(30864003)(476003)(336012)(15650500001)(426003)(1076003)(16586007)(316002)(11346002)(2906002)(70206006)(50466002)(14444005)(478600001)(53936002)(126002)(72206003)(186003)(48376002)(356004)(446003)(70586007)(6666004)(36756003)(5660300002)(2616005);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BLUPR12MB0643; H:SATLEXCHOV01.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 7296fe74-b5c4-4b7d-7718-08d6cdb03609
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600141)(711020)(4605104)(2017052603328);
 SRVR:BLUPR12MB0643; 
X-MS-TrafficTypeDiagnostic: BLUPR12MB0643:
X-Microsoft-Antispam-PRVS: <BLUPR12MB0643E09DAA70C1C618694065F93A0@BLUPR12MB0643.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:5236;
X-Forefront-PRVS: 00235A1EEF
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: 8efpSbQkDOq15ycSf0gzFHC5jLUjcwVyKktCAwnefMrhaU89W9elZmhE/ImGXmaJKzfvGpeEgQUqxKqR/UsfQO3W8VI5wuJVyEJONOuYZ2Gze+wRlSzjcZ/e1lr6y6r5CBL1TvRowkgelvcdklk40BLmNNV3dtizCH7BwTVhYp8ygxN6nbeB5BTxFI978oeHe5qDLbuewzhjg55zpfwYeNXxZn0VEGlggW+c6JWO6W/sFpdELmhYJJDKf1BEeS2AgRLYnEbSSw6Eovd1ZE+XJezEPGykPBUB+Cdzet+XWBMj9BxpXMCscpmTqt7hn6ESd4eYUnCPOoVIra6Kh6bJYMN5LODgE2FwViAggYBaS3vd+dWf28QMk/aMDi3yFnhbA63WE+KXlTI1A2mdfSE/qYQNFNEvXd/8KY3GGT1hbZQ=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 30 Apr 2019 21:10:02.2160 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 7296fe74-b5c4-4b7d-7718-08d6cdb03609
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV01.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BLUPR12MB0643
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amd-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=LiOwDzbf6191kDVXLchL/VUQ1x81InbL0IQM/1X4ukY=;
 b=kXMZcF05BTgUmBrN3KpTYzUmWmx/WpYizGKNPo9O4ZK35WJf34+qtXzkt51RYi0CRhBK3fckUbxxUEQtzFSeqP3B9KK1KX7fjpE13NvBW7V///wlI7eqouGZl3ITPFaqqJ87FPfBy/IbpTu3B6ve+So+Zku6EMEGr+MgOElzES0=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: amd-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Discussion list for AMD gfx <amd-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/amd-gfx>
List-Post: <mailto:amd-gfx@lists.freedesktop.org>
List-Help: <mailto:amd-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/amd-gfx>,
 <mailto:amd-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Nicholas Kazlauskas <nicholas.kazlauskas@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: amd-gfx-bounces@lists.freedesktop.org
Sender: "amd-gfx" <amd-gfx-bounces@lists.freedesktop.org>

RnJvbTogTmljaG9sYXMgS2F6bGF1c2thcyA8bmljaG9sYXMua2F6bGF1c2thc0BhbWQuY29tPgoK
W1doeV0KV2UgY3VycmVudGx5IGRvbid0IGRvIERDIHZhbGlkYXRpb24gZm9yIG1lZGl1bSBvciBm
dWxsIHVwZGF0ZXMgd2hlcmUKdGhlIHBsYW5lIHN0YXRlIGlzbid0IGNyZWF0ZWQuIFRoZXJlIGFy
ZSBzb21lIG1lZGl1bSBhbmQgZnVsbCB1cGRhdGVzCnRoYXQgY2FuIGNhdXNlIGJhbmR3aWR0aCBv
ciBjbG9jayBjaGFuZ2VzIHRvIG9jY3VyIHJlc3VsdGluZyBpbgp1bmRlcmZsb3cgb3IgY29ycnVw
dGlvbi4KCldlIG5lZWQgdG8gYmUgYWJsZSB0byBmaWxsIHN1cmZhY2UgYW5kIHBsYW5lIGluZm8g
dXBkYXRlcyBkdXJpbmcKYXRvbWljIGNvbW1pdCBmb3IgZG1fZGV0ZXJtaW5lX3VwZGF0ZV90eXBl
IGZvciBjb21taXQuIFNpbmNlIHdlIGFscmVhZHkKZG8gdGhpcyBkdXJpbmcgYXRvbWljIGNvbW1p
dCB0YWlsIGl0IHdvdWxkIGJlIGdvb2QgaWYgd2UgaGFkIHRoZSBzYW1lCmxvZ2ljIGluIGJvdGgg
cGxhY2VzIGZvciBjcmVhdGluZyB0aGVzZSBzdHJ1Y3R1cmVzLgoKW0hvd10KSW50cm9kdWNlIGZp
bGxfZGNfc2NhbGluZ19pbmZvIGFuZCBmaWxsX2RjX3BsYW5lX2luZm9fYW5kX2FkZHIuClRoZXNl
IHR3byBmdW5jdGlvbnMgY292ZXIgdGhlIGZvbGxvd2luZyB0aHJlZSB1cGRhdGUgc3RydWN0dXJl
czoKCi0gc3RydWN0IGRjX3NjYWxpbmdfaW5mbwotIHN0cnVjdCBkY19wbGFuZV9pbmZvCi0gc3Ry
dWN0IGRjX3BsYW5lX2FkZHJlc3MKCkNsZWFudXAgYW5kIGFkYXB0ZXIgdGhlIGV4aXN0aW5nIGZp
bGxfcGxhbmVfKiBoZWxwZXJzIHRvIHdvcmsgd2l0aAp0aGVzZSBmdW5jdGlvbnMuCgpVcGRhdGUg
Y2FsbCBzaXRlcyB0aGF0IHVzZWQgbW9zdCBvZiB0aGVzZSBzdWIgaGVscGVycyBkaXJlY3RseSB0
byB3b3JrCndpdGggdGhlIG5ldyBmdW5jdGlvbnMuIFRoZSBleGNlcHRpb24gYmVpbmcgcHJlcGFy
ZV9mYiAtIHdlIGp1c3Qgd2FudAp0aGUgbmV3IGJ1ZmZlciBhdHRyaWJ1dGVzIHNwZWNpZmljYWxs
eSBpbiB0aGUgY2FzZSB3aGVyZSB3ZSdyZQpjcmVhdGluZyB0aGUgcGxhbmUuIFRoaXMgaXMgbmVl
ZGVkIGZvciBkY19jb21taXRfc3RhdGUgaW4gdGhlIGNhc2UKd2hlcmUgdGhlIEZCIGhhc24ndCBi
ZWVuIHByZXZpb3VzbHkgYmVlbiB1c2VkLgoKVGhpcyBpc24ndCBxdWl0ZSBhIHJlZmFjdG9yLCBi
dXQgZnVuY3Rpb25hbGx5IGRyaXZlciBiZWhhdmlvciBzaG91bGQKYmUgbW9zdGx5IHRoZSBzbWFl
IGFzIGJlZm9yZS4gVGhlIG9uZSBleGNlcHRpb24gaXMgdGhhdCB3ZSBub3cgY2hlY2sKdGhlIHJl
dHVybiBjb2RlIGZvciBmaWxsX3BsYW5lX2J1ZmZlcl9hdHRyaWJ1dGVzIHdoaWNoIG1lYW5zIHRo
YXQKY29tbWl0cyB3aWxsIGJlIHJlamVjdGVkIHRoYXQgdHJ5IHRvIGVuYWJsZSBEQ0Mgd2l0aCBl
cnJvbmVvdXMKcGFyYW1ldGVycy4KCkNoYW5nZS1JZDogSWU5Y2VkOGM0MmY5YzYyYWZkODMxNjkz
MDAwNzNmNjE2Zjc0ZjA3MjQKU2lnbmVkLW9mZi1ieTogTmljaG9sYXMgS2F6bGF1c2thcyA8bmlj
aG9sYXMua2F6bGF1c2thc0BhbWQuY29tPgpSZXZpZXdlZC1ieTogRGF2aWQgRnJhbmNpcyA8RGF2
aWQuRnJhbmNpc0BhbWQuY29tPgpBY2tlZC1ieTogQmhhd2FucHJlZXQgTGFraGEgPEJoYXdhbnBy
ZWV0IExha2hhQGFtZC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2Rt
L2FtZGdwdV9kbS5jIHwgNDA2ICsrKysrKysrKy0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDIw
NCBpbnNlcnRpb25zKCspLCAyMDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMKaW5kZXggZWU0NzM4NjM2YWEwLi4y
ZTU2ODk0MTI4NzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRn
cHVfZG0vYW1kZ3B1X2RtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdw
dV9kbS9hbWRncHVfZG0uYwpAQCAtMjQ1OCw1OSArMjQ1OCw0OCBAQCBzdGF0aWMgY29uc3Qgc3Ry
dWN0IGRybV9lbmNvZGVyX2Z1bmNzIGFtZGdwdV9kbV9lbmNvZGVyX2Z1bmNzID0gewogCS5kZXN0
cm95ID0gYW1kZ3B1X2RtX2VuY29kZXJfZGVzdHJveSwKIH07CiAKLXN0YXRpYyBib29sIGZpbGxf
cmVjdHNfZnJvbV9wbGFuZV9zdGF0ZShjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0
ZSwKLQkJCQkJc3RydWN0IHJlY3QgKnNyY19yZWN0LAotCQkJCQlzdHJ1Y3QgcmVjdCAqZHN0X3Jl
Y3QsCi0JCQkJCXN0cnVjdCByZWN0ICpjbGlwX3JlY3QsCi0JCQkJCWVudW0gZGNfcm90YXRpb25f
YW5nbGUgKnJvdGF0aW9uKQotewotCXNyY19yZWN0LT54ID0gc3RhdGUtPnNyY194ID4+IDE2Owot
CXNyY19yZWN0LT55ID0gc3RhdGUtPnNyY195ID4+IDE2OwotCS8qIHdlIGlnbm9yZSB0aGUgbWFu
dGlzc2EgZm9yIG5vdyBhbmQgZG8gbm90IGRlYWwgd2l0aCBmbG9hdGluZyBwaXhlbHMgOiggKi8K
LQlzcmNfcmVjdC0+d2lkdGggPSBzdGF0ZS0+c3JjX3cgPj4gMTY7Ci0KLQlpZiAoc3JjX3JlY3Qt
PndpZHRoID09IDApCi0JCXJldHVybiBmYWxzZTsKIAotCXNyY19yZWN0LT5oZWlnaHQgPSBzdGF0
ZS0+c3JjX2ggPj4gMTY7Ci0JaWYgKHNyY19yZWN0LT5oZWlnaHQgPT0gMCkKLQkJcmV0dXJuIGZh
bHNlOworc3RhdGljIGludCBmaWxsX2RjX3NjYWxpbmdfaW5mbyhjb25zdCBzdHJ1Y3QgZHJtX3Bs
YW5lX3N0YXRlICpzdGF0ZSwKKwkJCQlzdHJ1Y3QgZGNfc2NhbGluZ19pbmZvICpzY2FsaW5nX2lu
Zm8pCit7CisJbWVtc2V0KHNjYWxpbmdfaW5mbywgMCwgc2l6ZW9mKCpzY2FsaW5nX2luZm8pKTsK
IAotCWRzdF9yZWN0LT54ID0gc3RhdGUtPmNydGNfeDsKLQlkc3RfcmVjdC0+eSA9IHN0YXRlLT5j
cnRjX3k7CisJLyogU291cmNlIGlzIGZpeGVkIDE2LjE2IGJ1dCB3ZSBpZ25vcmUgbWFudGlzc2Eg
Zm9yIG5vdy4uLiAqLworCXNjYWxpbmdfaW5mby0+c3JjX3JlY3QueCA9IHN0YXRlLT5zcmNfeCA+
PiAxNjsKKwlzY2FsaW5nX2luZm8tPnNyY19yZWN0LnkgPSBzdGF0ZS0+c3JjX3kgPj4gMTY7CisK
KwlzY2FsaW5nX2luZm8tPnNyY19yZWN0LndpZHRoID0gc3RhdGUtPnNyY193ID4+IDE2OworCWlm
IChzY2FsaW5nX2luZm8tPnNyY19yZWN0LndpZHRoID09IDApCisJCXJldHVybiAtRUlOVkFMOwor
CisJc2NhbGluZ19pbmZvLT5zcmNfcmVjdC5oZWlnaHQgPSBzdGF0ZS0+c3JjX2ggPj4gMTY7CisJ
aWYgKHNjYWxpbmdfaW5mby0+c3JjX3JlY3QuaGVpZ2h0ID09IDApCisJCXJldHVybiAtRUlOVkFM
OworCisJc2NhbGluZ19pbmZvLT5kc3RfcmVjdC54ID0gc3RhdGUtPmNydGNfeDsKKwlzY2FsaW5n
X2luZm8tPmRzdF9yZWN0LnkgPSBzdGF0ZS0+Y3J0Y195OwogCiAJaWYgKHN0YXRlLT5jcnRjX3cg
PT0gMCkKLQkJcmV0dXJuIGZhbHNlOworCQlyZXR1cm4gLUVJTlZBTDsKIAotCWRzdF9yZWN0LT53
aWR0aCA9IHN0YXRlLT5jcnRjX3c7CisJc2NhbGluZ19pbmZvLT5kc3RfcmVjdC53aWR0aCA9IHN0
YXRlLT5jcnRjX3c7CiAKIAlpZiAoc3RhdGUtPmNydGNfaCA9PSAwKQotCQlyZXR1cm4gZmFsc2U7
CisJCXJldHVybiAtRUlOVkFMOwogCi0JZHN0X3JlY3QtPmhlaWdodCA9IHN0YXRlLT5jcnRjX2g7
CisJc2NhbGluZ19pbmZvLT5kc3RfcmVjdC5oZWlnaHQgPSBzdGF0ZS0+Y3J0Y19oOwogCi0JKmNs
aXBfcmVjdCA9ICpkc3RfcmVjdDsKKwkvKiBEUk0gZG9lc24ndCBzcGVjaWZ5IGNsaXBwaW5nIG9u
IGRlc3RpbmF0aW9uIG91dHB1dC4gKi8KKwlzY2FsaW5nX2luZm8tPmNsaXBfcmVjdCA9IHNjYWxp
bmdfaW5mby0+ZHN0X3JlY3Q7CiAKLQlzd2l0Y2ggKHN0YXRlLT5yb3RhdGlvbiAmIERSTV9NT0RF
X1JPVEFURV9NQVNLKSB7Ci0JY2FzZSBEUk1fTU9ERV9ST1RBVEVfMDoKLQkJKnJvdGF0aW9uID0g
Uk9UQVRJT05fQU5HTEVfMDsKLQkJYnJlYWs7Ci0JY2FzZSBEUk1fTU9ERV9ST1RBVEVfOTA6Ci0J
CSpyb3RhdGlvbiA9IFJPVEFUSU9OX0FOR0xFXzkwOwotCQlicmVhazsKLQljYXNlIERSTV9NT0RF
X1JPVEFURV8xODA6Ci0JCSpyb3RhdGlvbiA9IFJPVEFUSU9OX0FOR0xFXzE4MDsKLQkJYnJlYWs7
Ci0JY2FzZSBEUk1fTU9ERV9ST1RBVEVfMjcwOgotCQkqcm90YXRpb24gPSBST1RBVElPTl9BTkdM
RV8yNzA7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCSpyb3RhdGlvbiA9IFJPVEFUSU9OX0FOR0xF
XzA7Ci0JCWJyZWFrOwotCX0KKwkvKgorCSAqIFRoZSAic2NhbGluZ19xdWFsaXR5IiBjYW4gYmUg
aWdub3JlZCBmb3Igbm93LCBxdWFsaXR5ID0gMCBoYXMgREMKKwkgKiBhc3N1bWUgcmVhc29uYWJs
ZSBkZWZhdWx0cyBiYXNlZCBvbiB0aGUgZm9ybWF0LgorCSAqLwogCi0JcmV0dXJuIHRydWU7CisJ
cmV0dXJuIDA7CiB9CisKIHN0YXRpYyBpbnQgZ2V0X2ZiX2luZm8oY29uc3Qgc3RydWN0IGFtZGdw
dV9mcmFtZWJ1ZmZlciAqYW1kZ3B1X2ZiLAogCQkgICAgICAgdWludDY0X3QgKnRpbGluZ19mbGFn
cykKIHsKQEAgLTI1MzksMTIgKzI1MjgsMTYgQEAgc3RhdGljIGlubGluZSB1aW50NjRfdCBnZXRf
ZGNjX2FkZHJlc3ModWludDY0X3QgYWRkcmVzcywgdWludDY0X3QgdGlsaW5nX2ZsYWdzKQogCXJl
dHVybiBvZmZzZXQgPyAoYWRkcmVzcyArIG9mZnNldCAqIDI1NikgOiAwOwogfQogCi1zdGF0aWMg
aW50IGZpbGxfcGxhbmVfZGNjX2F0dHJpYnV0ZXMoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYs
Ci0JCQkJICAgICAgY29uc3Qgc3RydWN0IGFtZGdwdV9mcmFtZWJ1ZmZlciAqYWZiLAotCQkJCSAg
ICAgIGNvbnN0IHN0cnVjdCBkY19wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0JCQkJICAgICAg
c3RydWN0IGRjX3BsYW5lX2RjY19wYXJhbSAqZGNjLAotCQkJCSAgICAgIHN0cnVjdCBkY19wbGFu
ZV9hZGRyZXNzICphZGRyZXNzLAotCQkJCSAgICAgIHVpbnQ2NF90IGluZm8pCitzdGF0aWMgaW50
CitmaWxsX3BsYW5lX2RjY19hdHRyaWJ1dGVzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAor
CQkJICBjb25zdCBzdHJ1Y3QgYW1kZ3B1X2ZyYW1lYnVmZmVyICphZmIsCisJCQkgIGNvbnN0IGVu
dW0gc3VyZmFjZV9waXhlbF9mb3JtYXQgZm9ybWF0LAorCQkJICBjb25zdCBlbnVtIGRjX3JvdGF0
aW9uX2FuZ2xlIHJvdGF0aW9uLAorCQkJICBjb25zdCB1bmlvbiBwbGFuZV9zaXplICpwbGFuZV9z
aXplLAorCQkJICBjb25zdCB1bmlvbiBkY190aWxpbmdfaW5mbyAqdGlsaW5nX2luZm8sCisJCQkg
IGNvbnN0IHVpbnQ2NF90IGluZm8sCisJCQkgIHN0cnVjdCBkY19wbGFuZV9kY2NfcGFyYW0gKmRj
YywKKwkJCSAgc3RydWN0IGRjX3BsYW5lX2FkZHJlc3MgKmFkZHJlc3MpCiB7CiAJc3RydWN0IGRj
ICpkYyA9IGFkZXYtPmRtLmRjOwogCXN0cnVjdCBkY19kY2Nfc3VyZmFjZV9wYXJhbSBpbnB1dDsK
QEAgLTI1NTksMjQgKzI1NTIsMjAgQEAgc3RhdGljIGludCBmaWxsX3BsYW5lX2RjY19hdHRyaWJ1
dGVzKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCWlmICghb2Zmc2V0KQogCQlyZXR1cm4g
MDsKIAotCWlmIChwbGFuZV9zdGF0ZS0+YWRkcmVzcy50eXBlICE9IFBMTl9BRERSX1RZUEVfR1JB
UEhJQ1MpCisJaWYgKGZvcm1hdCA+PSBTVVJGQUNFX1BJWEVMX0ZPUk1BVF9WSURFT19CRUdJTikK
IAkJcmV0dXJuIDA7CiAKIAlpZiAoIWRjLT5jYXBfZnVuY3MuZ2V0X2RjY19jb21wcmVzc2lvbl9j
YXApCiAJCXJldHVybiAtRUlOVkFMOwogCi0JaW5wdXQuZm9ybWF0ID0gcGxhbmVfc3RhdGUtPmZv
cm1hdDsKLQlpbnB1dC5zdXJmYWNlX3NpemUud2lkdGggPQotCQlwbGFuZV9zdGF0ZS0+cGxhbmVf
c2l6ZS5ncnBoLnN1cmZhY2Vfc2l6ZS53aWR0aDsKLQlpbnB1dC5zdXJmYWNlX3NpemUuaGVpZ2h0
ID0KLQkJcGxhbmVfc3RhdGUtPnBsYW5lX3NpemUuZ3JwaC5zdXJmYWNlX3NpemUuaGVpZ2h0Owot
CWlucHV0LnN3aXp6bGVfbW9kZSA9IHBsYW5lX3N0YXRlLT50aWxpbmdfaW5mby5nZng5LnN3aXp6
bGU7CisJaW5wdXQuZm9ybWF0ID0gZm9ybWF0OworCWlucHV0LnN1cmZhY2Vfc2l6ZS53aWR0aCA9
IHBsYW5lX3NpemUtPmdycGguc3VyZmFjZV9zaXplLndpZHRoOworCWlucHV0LnN1cmZhY2Vfc2l6
ZS5oZWlnaHQgPSBwbGFuZV9zaXplLT5ncnBoLnN1cmZhY2Vfc2l6ZS5oZWlnaHQ7CisJaW5wdXQu
c3dpenpsZV9tb2RlID0gdGlsaW5nX2luZm8tPmdmeDkuc3dpenpsZTsKIAotCWlmIChwbGFuZV9z
dGF0ZS0+cm90YXRpb24gPT0gUk9UQVRJT05fQU5HTEVfMCB8fAotCSAgICBwbGFuZV9zdGF0ZS0+
cm90YXRpb24gPT0gUk9UQVRJT05fQU5HTEVfMTgwKQorCWlmIChyb3RhdGlvbiA9PSBST1RBVElP
Tl9BTkdMRV8wIHx8IHJvdGF0aW9uID09IFJPVEFUSU9OX0FOR0xFXzE4MCkKIAkJaW5wdXQuc2Nh
biA9IFNDQU5fRElSRUNUSU9OX0hPUklaT05UQUw7Ci0JZWxzZSBpZiAocGxhbmVfc3RhdGUtPnJv
dGF0aW9uID09IFJPVEFUSU9OX0FOR0xFXzkwIHx8Ci0JCSBwbGFuZV9zdGF0ZS0+cm90YXRpb24g
PT0gUk9UQVRJT05fQU5HTEVfMjcwKQorCWVsc2UgaWYgKHJvdGF0aW9uID09IFJPVEFUSU9OX0FO
R0xFXzkwIHx8IHJvdGF0aW9uID09IFJPVEFUSU9OX0FOR0xFXzI3MCkKIAkJaW5wdXQuc2NhbiA9
IFNDQU5fRElSRUNUSU9OX1ZFUlRJQ0FMOwogCiAJaWYgKCFkYy0+Y2FwX2Z1bmNzLmdldF9kY2Nf
Y29tcHJlc3Npb25fY2FwKGRjLCAmaW5wdXQsICZvdXRwdXQpKQpAQCAtMjYwMywxMiArMjU5Miwx
MyBAQCBzdGF0aWMgaW50IGZpbGxfcGxhbmVfZGNjX2F0dHJpYnV0ZXMoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsCiBzdGF0aWMgaW50CiBmaWxsX3BsYW5lX2J1ZmZlcl9hdHRyaWJ1dGVzKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQkJICAgICBjb25zdCBzdHJ1Y3QgYW1kZ3B1X2Zy
YW1lYnVmZmVyICphZmIsCi0JCQkgICAgIGNvbnN0IHN0cnVjdCBkY19wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUsCisJCQkgICAgIGNvbnN0IGVudW0gc3VyZmFjZV9waXhlbF9mb3JtYXQgZm9ybWF0
LAorCQkJICAgICBjb25zdCBlbnVtIGRjX3JvdGF0aW9uX2FuZ2xlIHJvdGF0aW9uLAorCQkJICAg
ICBjb25zdCB1aW50NjRfdCB0aWxpbmdfZmxhZ3MsCiAJCQkgICAgIHVuaW9uIGRjX3RpbGluZ19p
bmZvICp0aWxpbmdfaW5mbywKIAkJCSAgICAgdW5pb24gcGxhbmVfc2l6ZSAqcGxhbmVfc2l6ZSwK
IAkJCSAgICAgc3RydWN0IGRjX3BsYW5lX2RjY19wYXJhbSAqZGNjLAotCQkJICAgICBzdHJ1Y3Qg
ZGNfcGxhbmVfYWRkcmVzcyAqYWRkcmVzcywKLQkJCSAgICAgdWludDY0X3QgdGlsaW5nX2ZsYWdz
KQorCQkJICAgICBzdHJ1Y3QgZGNfcGxhbmVfYWRkcmVzcyAqYWRkcmVzcykKIHsKIAljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9ICZhZmItPmJhc2U7CiAJaW50IHJldDsKQEAgLTI2
MTgsNyArMjYwOCw3IEBAIGZpbGxfcGxhbmVfYnVmZmVyX2F0dHJpYnV0ZXMoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsCiAJbWVtc2V0KGRjYywgMCwgc2l6ZW9mKCpkY2MpKTsKIAltZW1zZXQo
YWRkcmVzcywgMCwgc2l6ZW9mKCphZGRyZXNzKSk7CiAKLQlpZiAocGxhbmVfc3RhdGUtPmZvcm1h
dCA8IFNVUkZBQ0VfUElYRUxfRk9STUFUX1ZJREVPX0JFR0lOKSB7CisJaWYgKGZvcm1hdCA8IFNV
UkZBQ0VfUElYRUxfRk9STUFUX1ZJREVPX0JFR0lOKSB7CiAJCXBsYW5lX3NpemUtPmdycGguc3Vy
ZmFjZV9zaXplLnggPSAwOwogCQlwbGFuZV9zaXplLT5ncnBoLnN1cmZhY2Vfc2l6ZS55ID0gMDsK
IAkJcGxhbmVfc2l6ZS0+Z3JwaC5zdXJmYWNlX3NpemUud2lkdGggPSBmYi0+d2lkdGg7CkBAIC0y
NzA4LDggKzI2OTgsOSBAQCBmaWxsX3BsYW5lX2J1ZmZlcl9hdHRyaWJ1dGVzKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LAogCQkJQU1ER1BVX1RJTElOR19HRVQodGlsaW5nX2ZsYWdzLCBTV0la
WkxFX01PREUpOwogCQl0aWxpbmdfaW5mby0+Z2Z4OS5zaGFkZXJFbmFibGUgPSAxOwogCi0JCXJl
dCA9IGZpbGxfcGxhbmVfZGNjX2F0dHJpYnV0ZXMoYWRldiwgYWZiLCBwbGFuZV9zdGF0ZSwgZGNj
LAotCQkJCQkJYWRkcmVzcywgdGlsaW5nX2ZsYWdzKTsKKwkJcmV0ID0gZmlsbF9wbGFuZV9kY2Nf
YXR0cmlidXRlcyhhZGV2LCBhZmIsIGZvcm1hdCwgcm90YXRpb24sCisJCQkJCQlwbGFuZV9zaXpl
LCB0aWxpbmdfaW5mbywKKwkJCQkJCXRpbGluZ19mbGFncywgZGNjLCBhZGRyZXNzKTsKIAkJaWYg
KHJldCkKIAkJCXJldHVybiByZXQ7CiAJfQpAQCAtMjcxNyw4MCArMjcwOCw4IEBAIGZpbGxfcGxh
bmVfYnVmZmVyX2F0dHJpYnV0ZXMoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJcmV0dXJu
IDA7CiB9CiAKLXN0YXRpYyBpbnQgZmlsbF9wbGFuZV9hdHRyaWJ1dGVzX2Zyb21fZmIoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsCi0JCQkJCSBzdHJ1Y3QgZGNfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlLAotCQkJCQkgY29uc3Qgc3RydWN0IGFtZGdwdV9mcmFtZWJ1ZmZlciAqYW1kZ3B1X2Zi
KQotewotCXVpbnQ2NF90IHRpbGluZ19mbGFnczsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9ICZhbWRncHVfZmItPmJhc2U7Ci0JaW50IHJldCA9IDA7Ci0Jc3RydWN0IGRybV9m
b3JtYXRfbmFtZV9idWYgZm9ybWF0X25hbWU7Ci0KLQlyZXQgPSBnZXRfZmJfaW5mbygKLQkJYW1k
Z3B1X2ZiLAotCQkmdGlsaW5nX2ZsYWdzKTsKLQotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0K
LQlzd2l0Y2ggKGZiLT5mb3JtYXQtPmZvcm1hdCkgewotCWNhc2UgRFJNX0ZPUk1BVF9DODoKLQkJ
cGxhbmVfc3RhdGUtPmZvcm1hdCA9IFNVUkZBQ0VfUElYRUxfRk9STUFUX0dSUEhfUEFMRVRBXzI1
Nl9DT0xPUlM7Ci0JCWJyZWFrOwotCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6Ci0JCXBsYW5lX3N0
YXRlLT5mb3JtYXQgPSBTVVJGQUNFX1BJWEVMX0ZPUk1BVF9HUlBIX1JHQjU2NTsKLQkJYnJlYWs7
Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4ODoK
LQkJcGxhbmVfc3RhdGUtPmZvcm1hdCA9IFNVUkZBQ0VfUElYRUxfRk9STUFUX0dSUEhfQVJHQjg4
ODg7Ci0JCWJyZWFrOwotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKLQljYXNlIERSTV9G
T1JNQVRfQVJHQjIxMDEwMTA6Ci0JCXBsYW5lX3N0YXRlLT5mb3JtYXQgPSBTVVJGQUNFX1BJWEVM
X0ZPUk1BVF9HUlBIX0FSR0IyMTAxMDEwOwotCQlicmVhazsKLQljYXNlIERSTV9GT1JNQVRfWEJH
UjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1IyMTAxMDEwOgotCQlwbGFuZV9zdGF0ZS0+
Zm9ybWF0ID0gU1VSRkFDRV9QSVhFTF9GT1JNQVRfR1JQSF9BQkdSMjEwMTAxMDsKLQkJYnJlYWs7
Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoK
LQkJcGxhbmVfc3RhdGUtPmZvcm1hdCA9IFNVUkZBQ0VfUElYRUxfRk9STUFUX0dSUEhfQUJHUjg4
ODg7Ci0JCWJyZWFrOwotCWNhc2UgRFJNX0ZPUk1BVF9OVjIxOgotCQlwbGFuZV9zdGF0ZS0+Zm9y
bWF0ID0gU1VSRkFDRV9QSVhFTF9GT1JNQVRfVklERU9fNDIwX1lDYkNyOwotCQlicmVhazsKLQlj
YXNlIERSTV9GT1JNQVRfTlYxMjoKLQkJcGxhbmVfc3RhdGUtPmZvcm1hdCA9IFNVUkZBQ0VfUElY
RUxfRk9STUFUX1ZJREVPXzQyMF9ZQ3JDYjsKLQkJYnJlYWs7Ci0JZGVmYXVsdDoKLQkJRFJNX0VS
Uk9SKCJVbnN1cHBvcnRlZCBzY3JlZW4gZm9ybWF0ICVzXG4iLAotCQkJICBkcm1fZ2V0X2Zvcm1h
dF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1hdF9uYW1lKSk7Ci0JCXJldHVybiAtRUlO
VkFMOwotCX0KLQotCWZpbGxfcGxhbmVfYnVmZmVyX2F0dHJpYnV0ZXMoYWRldiwgYW1kZ3B1X2Zi
LCBwbGFuZV9zdGF0ZSwKLQkJCQkgICAgICZwbGFuZV9zdGF0ZS0+dGlsaW5nX2luZm8sCi0JCQkJ
ICAgICAmcGxhbmVfc3RhdGUtPnBsYW5lX3NpemUsCi0JCQkJICAgICAmcGxhbmVfc3RhdGUtPmRj
YywKLQkJCQkgICAgICZwbGFuZV9zdGF0ZS0+YWRkcmVzcywKLQkJCQkgICAgIHRpbGluZ19mbGFn
cyk7Ci0KLQlwbGFuZV9zdGF0ZS0+dmlzaWJsZSA9IHRydWU7Ci0JcGxhbmVfc3RhdGUtPnNjYWxp
bmdfcXVhbGl0eS5oX3RhcHNfYyA9IDA7Ci0JcGxhbmVfc3RhdGUtPnNjYWxpbmdfcXVhbGl0eS52
X3RhcHNfYyA9IDA7Ci0KLQkvKiBpcyB0aGlzIG5lZWRlZD8gaXMgcGxhbmVfc3RhdGUgemVyb2Vk
IGF0IGFsbG9jYXRpb24/ICovCi0JcGxhbmVfc3RhdGUtPnNjYWxpbmdfcXVhbGl0eS5oX3RhcHMg
PSAwOwotCXBsYW5lX3N0YXRlLT5zY2FsaW5nX3F1YWxpdHkudl90YXBzID0gMDsKLQlwbGFuZV9z
dGF0ZS0+c3RlcmVvX2Zvcm1hdCA9IFBMQU5FX1NURVJFT19GT1JNQVRfTk9ORTsKLQotCXJldHVy
biByZXQ7Ci0KLX0KLQogc3RhdGljIHZvaWQKLWZpbGxfYmxlbmRpbmdfZnJvbV9wbGFuZV9zdGF0
ZShzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJCSAgICAgICBjb25zdCBz
dHJ1Y3QgZGNfcGxhbmVfc3RhdGUgKmRjX3BsYW5lX3N0YXRlLAorZmlsbF9ibGVuZGluZ19mcm9t
X3BsYW5lX3N0YXRlKGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAog
CQkJICAgICAgIGJvb2wgKnBlcl9waXhlbF9hbHBoYSwgYm9vbCAqZ2xvYmFsX2FscGhhLAogCQkJ
ICAgICAgIGludCAqZ2xvYmFsX2FscGhhX3ZhbHVlKQogewpAQCAtMjgyNiw3ICsyNzQ1LDcgQEAg
ZmlsbF9ibGVuZGluZ19mcm9tX3BsYW5lX3N0YXRlKHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlLAogCiBzdGF0aWMgaW50CiBmaWxsX3BsYW5lX2NvbG9yX2F0dHJpYnV0ZXMoY29u
c3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0JCQkgICAgY29uc3Qgc3Ry
dWN0IGRjX3BsYW5lX3N0YXRlICpkY19wbGFuZV9zdGF0ZSwKKwkJCSAgICBjb25zdCBlbnVtIHN1
cmZhY2VfcGl4ZWxfZm9ybWF0IGZvcm1hdCwKIAkJCSAgICBlbnVtIGRjX2NvbG9yX3NwYWNlICpj
b2xvcl9zcGFjZSkKIHsKIAlib29sIGZ1bGxfcmFuZ2U7CkBAIC0yODM0LDcgKzI3NTMsNyBAQCBm
aWxsX3BsYW5lX2NvbG9yX2F0dHJpYnV0ZXMoY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUsCiAJKmNvbG9yX3NwYWNlID0gQ09MT1JfU1BBQ0VfU1JHQjsKIAogCS8qIERS
TSBjb2xvciBwcm9wZXJ0aWVzIG9ubHkgYWZmZWN0IG5vbi1SR0IgZm9ybWF0cy4gKi8KLQlpZiAo
ZGNfcGxhbmVfc3RhdGUtPmZvcm1hdCA8IFNVUkZBQ0VfUElYRUxfRk9STUFUX1ZJREVPX0JFR0lO
KQorCWlmIChmb3JtYXQgPCBTVVJGQUNFX1BJWEVMX0ZPUk1BVF9WSURFT19CRUdJTikKIAkJcmV0
dXJuIDA7CiAKIAlmdWxsX3JhbmdlID0gKHBsYW5lX3N0YXRlLT5jb2xvcl9yYW5nZSA9PSBEUk1f
Q09MT1JfWUNCQ1JfRlVMTF9SQU5HRSk7CkBAIC0yODY4LDM2ICsyNzg3LDE0NCBAQCBmaWxsX3Bs
YW5lX2NvbG9yX2F0dHJpYnV0ZXMoY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgZmlsbF9wbGFuZV9hdHRyaWJ1dGVz
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAotCQkJCSBzdHJ1Y3QgZGNfcGxhbmVfc3RhdGUg
KmRjX3BsYW5lX3N0YXRlLAotCQkJCSBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSwKLQkJCQkgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQorc3RhdGljIGludAor
ZmlsbF9kY19wbGFuZV9pbmZvX2FuZF9hZGRyKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAor
CQkJICAgIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAorCQkJICAg
IGNvbnN0IHVpbnQ2NF90IHRpbGluZ19mbGFncywKKwkJCSAgICBzdHJ1Y3QgZGNfcGxhbmVfaW5m
byAqcGxhbmVfaW5mbywKKwkJCSAgICBzdHJ1Y3QgZGNfcGxhbmVfYWRkcmVzcyAqYWRkcmVzcykK
K3sKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5mYjsK
Kwljb25zdCBzdHJ1Y3QgYW1kZ3B1X2ZyYW1lYnVmZmVyICphZmIgPQorCQl0b19hbWRncHVfZnJh
bWVidWZmZXIocGxhbmVfc3RhdGUtPmZiKTsKKwlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1ZiBm
b3JtYXRfbmFtZTsKKwlpbnQgcmV0OworCisJbWVtc2V0KHBsYW5lX2luZm8sIDAsIHNpemVvZigq
cGxhbmVfaW5mbykpOworCisJc3dpdGNoIChmYi0+Zm9ybWF0LT5mb3JtYXQpIHsKKwljYXNlIERS
TV9GT1JNQVRfQzg6CisJCXBsYW5lX2luZm8tPmZvcm1hdCA9CisJCQlTVVJGQUNFX1BJWEVMX0ZP
Uk1BVF9HUlBIX1BBTEVUQV8yNTZfQ09MT1JTOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRf
UkdCNTY1OgorCQlwbGFuZV9pbmZvLT5mb3JtYXQgPSBTVVJGQUNFX1BJWEVMX0ZPUk1BVF9HUlBI
X1JHQjU2NTsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCWNhc2UgRFJN
X0ZPUk1BVF9BUkdCODg4ODoKKwkJcGxhbmVfaW5mby0+Zm9ybWF0ID0gU1VSRkFDRV9QSVhFTF9G
T1JNQVRfR1JQSF9BUkdCODg4ODsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAx
MDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKKwkJcGxhbmVfaW5mby0+Zm9ybWF0
ID0gU1VSRkFDRV9QSVhFTF9GT1JNQVRfR1JQSF9BUkdCMjEwMTAxMDsKKwkJYnJlYWs7CisJY2Fz
ZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoK
KwkJcGxhbmVfaW5mby0+Zm9ybWF0ID0gU1VSRkFDRV9QSVhFTF9GT1JNQVRfR1JQSF9BQkdSMjEw
MTAxMDsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1hCR1I4ODg4OgorCWNhc2UgRFJNX0ZP
Uk1BVF9BQkdSODg4ODoKKwkJcGxhbmVfaW5mby0+Zm9ybWF0ID0gU1VSRkFDRV9QSVhFTF9GT1JN
QVRfR1JQSF9BQkdSODg4ODsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX05WMjE6CisJCXBs
YW5lX2luZm8tPmZvcm1hdCA9IFNVUkZBQ0VfUElYRUxfRk9STUFUX1ZJREVPXzQyMF9ZQ2JDcjsK
KwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX05WMTI6CisJCXBsYW5lX2luZm8tPmZvcm1hdCA9
IFNVUkZBQ0VfUElYRUxfRk9STUFUX1ZJREVPXzQyMF9ZQ3JDYjsKKwkJYnJlYWs7CisJZGVmYXVs
dDoKKwkJRFJNX0VSUk9SKAorCQkJIlVuc3VwcG9ydGVkIHNjcmVlbiBmb3JtYXQgJXNcbiIsCisJ
CQlkcm1fZ2V0X2Zvcm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1hdF9uYW1lKSk7
CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXN3aXRjaCAocGxhbmVfc3RhdGUtPnJvdGF0aW9u
ICYgRFJNX01PREVfUk9UQVRFX01BU0spIHsKKwljYXNlIERSTV9NT0RFX1JPVEFURV8wOgorCQlw
bGFuZV9pbmZvLT5yb3RhdGlvbiA9IFJPVEFUSU9OX0FOR0xFXzA7CisJCWJyZWFrOworCWNhc2Ug
RFJNX01PREVfUk9UQVRFXzkwOgorCQlwbGFuZV9pbmZvLT5yb3RhdGlvbiA9IFJPVEFUSU9OX0FO
R0xFXzkwOworCQlicmVhazsKKwljYXNlIERSTV9NT0RFX1JPVEFURV8xODA6CisJCXBsYW5lX2lu
Zm8tPnJvdGF0aW9uID0gUk9UQVRJT05fQU5HTEVfMTgwOworCQlicmVhazsKKwljYXNlIERSTV9N
T0RFX1JPVEFURV8yNzA6CisJCXBsYW5lX2luZm8tPnJvdGF0aW9uID0gUk9UQVRJT05fQU5HTEVf
MjcwOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlwbGFuZV9pbmZvLT5yb3RhdGlvbiA9IFJPVEFU
SU9OX0FOR0xFXzA7CisJCWJyZWFrOworCX0KKworCXBsYW5lX2luZm8tPnZpc2libGUgPSB0cnVl
OworCXBsYW5lX2luZm8tPnN0ZXJlb19mb3JtYXQgPSBQTEFORV9TVEVSRU9fRk9STUFUX05PTkU7
CisKKwlyZXQgPSBmaWxsX3BsYW5lX2NvbG9yX2F0dHJpYnV0ZXMocGxhbmVfc3RhdGUsIHBsYW5l
X2luZm8tPmZvcm1hdCwKKwkJCQkJICAmcGxhbmVfaW5mby0+Y29sb3Jfc3BhY2UpOworCWlmIChy
ZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBmaWxsX3BsYW5lX2J1ZmZlcl9hdHRyaWJ1dGVz
KGFkZXYsIGFmYiwgcGxhbmVfaW5mby0+Zm9ybWF0LAorCQkJCQkgICBwbGFuZV9pbmZvLT5yb3Rh
dGlvbiwgdGlsaW5nX2ZsYWdzLAorCQkJCQkgICAmcGxhbmVfaW5mby0+dGlsaW5nX2luZm8sCisJ
CQkJCSAgICZwbGFuZV9pbmZvLT5wbGFuZV9zaXplLAorCQkJCQkgICAmcGxhbmVfaW5mby0+ZGNj
LCBhZGRyZXNzKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZmlsbF9ibGVuZGluZ19m
cm9tX3BsYW5lX3N0YXRlKAorCQlwbGFuZV9zdGF0ZSwgJnBsYW5lX2luZm8tPnBlcl9waXhlbF9h
bHBoYSwKKwkJJnBsYW5lX2luZm8tPmdsb2JhbF9hbHBoYSwgJnBsYW5lX2luZm8tPmdsb2JhbF9h
bHBoYV92YWx1ZSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBmaWxsX2RjX3BsYW5l
X2F0dHJpYnV0ZXMoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCisJCQkJICAgIHN0cnVjdCBk
Y19wbGFuZV9zdGF0ZSAqZGNfcGxhbmVfc3RhdGUsCisJCQkJICAgIHN0cnVjdCBkcm1fcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlLAorCQkJCSAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGFtZGdwdV9mcmFtZWJ1ZmZlciAqYW1kZ3B1X2ZiID0K
IAkJdG9fYW1kZ3B1X2ZyYW1lYnVmZmVyKHBsYW5lX3N0YXRlLT5mYik7Ci0JY29uc3Qgc3RydWN0
IGRybV9jcnRjICpjcnRjID0gcGxhbmVfc3RhdGUtPmNydGM7Ci0JaW50IHJldCA9IDA7CisJc3Ry
dWN0IGRjX3NjYWxpbmdfaW5mbyBzY2FsaW5nX2luZm87CisJc3RydWN0IGRjX3BsYW5lX2luZm8g
cGxhbmVfaW5mbzsKKwl1aW50NjRfdCB0aWxpbmdfZmxhZ3M7CisJaW50IHJldDsKIAotCWlmICgh
ZmlsbF9yZWN0c19mcm9tX3BsYW5lX3N0YXRlKHBsYW5lX3N0YXRlLAotCQkJCQkgJmRjX3BsYW5l
X3N0YXRlLT5zcmNfcmVjdCwKLQkJCQkJICZkY19wbGFuZV9zdGF0ZS0+ZHN0X3JlY3QsCi0JCQkJ
CSAmZGNfcGxhbmVfc3RhdGUtPmNsaXBfcmVjdCwKLQkJCQkJICZkY19wbGFuZV9zdGF0ZS0+cm90
YXRpb24pKQotCQlyZXR1cm4gLUVJTlZBTDsKKwlyZXQgPSBmaWxsX2RjX3NjYWxpbmdfaW5mbyhw
bGFuZV9zdGF0ZSwgJnNjYWxpbmdfaW5mbyk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAot
CXJldCA9IGZpbGxfcGxhbmVfYXR0cmlidXRlc19mcm9tX2ZiKAotCQljcnRjLT5kZXYtPmRldl9w
cml2YXRlLAotCQlkY19wbGFuZV9zdGF0ZSwKLQkJYW1kZ3B1X2ZiKTsKKwlkY19wbGFuZV9zdGF0
ZS0+c3JjX3JlY3QgPSBzY2FsaW5nX2luZm8uc3JjX3JlY3Q7CisJZGNfcGxhbmVfc3RhdGUtPmRz
dF9yZWN0ID0gc2NhbGluZ19pbmZvLmRzdF9yZWN0OworCWRjX3BsYW5lX3N0YXRlLT5jbGlwX3Jl
Y3QgPSBzY2FsaW5nX2luZm8uY2xpcF9yZWN0OworCWRjX3BsYW5lX3N0YXRlLT5zY2FsaW5nX3F1
YWxpdHkgPSBzY2FsaW5nX2luZm8uc2NhbGluZ19xdWFsaXR5OwogCisJcmV0ID0gZ2V0X2ZiX2lu
Zm8oYW1kZ3B1X2ZiLCAmdGlsaW5nX2ZsYWdzKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0Owog
Ci0JcmV0ID0gZmlsbF9wbGFuZV9jb2xvcl9hdHRyaWJ1dGVzKHBsYW5lX3N0YXRlLCBkY19wbGFu
ZV9zdGF0ZSwKLQkJCQkJICAmZGNfcGxhbmVfc3RhdGUtPmNvbG9yX3NwYWNlKTsKKwlyZXQgPSBm
aWxsX2RjX3BsYW5lX2luZm9fYW5kX2FkZHIoYWRldiwgcGxhbmVfc3RhdGUsIHRpbGluZ19mbGFn
cywKKwkJCQkJICAmcGxhbmVfaW5mbywKKwkJCQkJICAmZGNfcGxhbmVfc3RhdGUtPmFkZHJlc3Mp
OwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKKwlkY19wbGFuZV9zdGF0ZS0+Zm9ybWF0ID0g
cGxhbmVfaW5mby5mb3JtYXQ7CisJZGNfcGxhbmVfc3RhdGUtPmNvbG9yX3NwYWNlID0gcGxhbmVf
aW5mby5jb2xvcl9zcGFjZTsKKwlkY19wbGFuZV9zdGF0ZS0+Zm9ybWF0ID0gcGxhbmVfaW5mby5m
b3JtYXQ7CisJZGNfcGxhbmVfc3RhdGUtPnBsYW5lX3NpemUgPSBwbGFuZV9pbmZvLnBsYW5lX3Np
emU7CisJZGNfcGxhbmVfc3RhdGUtPnJvdGF0aW9uID0gcGxhbmVfaW5mby5yb3RhdGlvbjsKKwlk
Y19wbGFuZV9zdGF0ZS0+aG9yaXpvbnRhbF9taXJyb3IgPSBwbGFuZV9pbmZvLmhvcml6b250YWxf
bWlycm9yOworCWRjX3BsYW5lX3N0YXRlLT5zdGVyZW9fZm9ybWF0ID0gcGxhbmVfaW5mby5zdGVy
ZW9fZm9ybWF0OworCWRjX3BsYW5lX3N0YXRlLT50aWxpbmdfaW5mbyA9IHBsYW5lX2luZm8udGls
aW5nX2luZm87CisJZGNfcGxhbmVfc3RhdGUtPnZpc2libGUgPSBwbGFuZV9pbmZvLnZpc2libGU7
CisJZGNfcGxhbmVfc3RhdGUtPnBlcl9waXhlbF9hbHBoYSA9IHBsYW5lX2luZm8ucGVyX3BpeGVs
X2FscGhhOworCWRjX3BsYW5lX3N0YXRlLT5nbG9iYWxfYWxwaGEgPSBwbGFuZV9pbmZvLmdsb2Jh
bF9hbHBoYTsKKwlkY19wbGFuZV9zdGF0ZS0+Z2xvYmFsX2FscGhhX3ZhbHVlID0gcGxhbmVfaW5m
by5nbG9iYWxfYWxwaGFfdmFsdWU7CisJZGNfcGxhbmVfc3RhdGUtPmRjYyA9IHBsYW5lX2luZm8u
ZGNjOworCiAJLyoKIAkgKiBBbHdheXMgc2V0IGlucHV0IHRyYW5zZmVyIGZ1bmN0aW9uLCBzaW5j
ZSBwbGFuZSBzdGF0ZSBpcyByZWZyZXNoZWQKIAkgKiBldmVyeSB0aW1lLgpAQCAtMjkwOCwxMSAr
MjkzNSw2IEBAIHN0YXRpYyBpbnQgZmlsbF9wbGFuZV9hdHRyaWJ1dGVzKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LAogCQlkY19wbGFuZV9zdGF0ZS0+aW5fdHJhbnNmZXJfZnVuYyA9IE5VTEw7
CiAJfQogCi0JZmlsbF9ibGVuZGluZ19mcm9tX3BsYW5lX3N0YXRlKHBsYW5lX3N0YXRlLCBkY19w
bGFuZV9zdGF0ZSwKLQkJCQkgICAgICAgJmRjX3BsYW5lX3N0YXRlLT5wZXJfcGl4ZWxfYWxwaGEs
Ci0JCQkJICAgICAgICZkY19wbGFuZV9zdGF0ZS0+Z2xvYmFsX2FscGhhLAotCQkJCSAgICAgICAm
ZGNfcGxhbmVfc3RhdGUtPmdsb2JhbF9hbHBoYV92YWx1ZSk7Ci0KIAlyZXR1cm4gcmV0OwogfQog
CkBAIC00MDgxLDkgKzQxMDMsMTAgQEAgc3RhdGljIGludCBkbV9wbGFuZV9oZWxwZXJfcHJlcGFy
ZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkJc3RydWN0IGRjX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSA9IGRtX3BsYW5lX3N0YXRlX25ldy0+ZGNfc3RhdGU7CiAKIAkJZmlsbF9wbGFu
ZV9idWZmZXJfYXR0cmlidXRlcygKLQkJCWFkZXYsIGFmYiwgcGxhbmVfc3RhdGUsICZwbGFuZV9z
dGF0ZS0+dGlsaW5nX2luZm8sCisJCQlhZGV2LCBhZmIsIHBsYW5lX3N0YXRlLT5mb3JtYXQsIHBs
YW5lX3N0YXRlLT5yb3RhdGlvbiwKKwkJCXRpbGluZ19mbGFncywgJnBsYW5lX3N0YXRlLT50aWxp
bmdfaW5mbywKIAkJCSZwbGFuZV9zdGF0ZS0+cGxhbmVfc2l6ZSwgJnBsYW5lX3N0YXRlLT5kY2Ms
Ci0JCQkmcGxhbmVfc3RhdGUtPmFkZHJlc3MsIHRpbGluZ19mbGFncyk7CisJCQkmcGxhbmVfc3Rh
dGUtPmFkZHJlc3MpOwogCX0KIAogCXJldHVybiAwOwpAQCAtNDExNiwxNyArNDEzOSwxNyBAQCBz
dGF0aWMgaW50IGRtX3BsYW5lX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwK
IAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IHBsYW5lLT5kZXYtPmRldl9wcml2YXRlOwog
CXN0cnVjdCBkYyAqZGMgPSBhZGV2LT5kbS5kYzsKIAlzdHJ1Y3QgZG1fcGxhbmVfc3RhdGUgKmRt
X3BsYW5lX3N0YXRlOwotCXN0cnVjdCByZWN0IHNyY19yZWN0LCBkc3RfcmVjdCwgY2xpcF9yZWN0
OwotCWVudW0gZGNfcm90YXRpb25fYW5nbGUgcm90YXRpb247CisJc3RydWN0IGRjX3NjYWxpbmdf
aW5mbyBzY2FsaW5nX2luZm87CisJaW50IHJldDsKIAogCWRtX3BsYW5lX3N0YXRlID0gdG9fZG1f
cGxhbmVfc3RhdGUoc3RhdGUpOwogCiAJaWYgKCFkbV9wbGFuZV9zdGF0ZS0+ZGNfc3RhdGUpCiAJ
CXJldHVybiAwOwogCi0JaWYgKCFmaWxsX3JlY3RzX2Zyb21fcGxhbmVfc3RhdGUoc3RhdGUsICZz
cmNfcmVjdCwgJmRzdF9yZWN0LAotCQkJCQkgJmNsaXBfcmVjdCwgJnJvdGF0aW9uKSkKLQkJcmV0
dXJuIC1FSU5WQUw7CisJcmV0ID0gZmlsbF9kY19zY2FsaW5nX2luZm8oc3RhdGUsICZzY2FsaW5n
X2luZm8pOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKIAlpZiAoZGNfdmFsaWRhdGVfcGxh
bmUoZGMsIGRtX3BsYW5lX3N0YXRlLT5kY19zdGF0ZSkgPT0gRENfT0spCiAJCXJldHVybiAwOwpA
QCAtNTE3OCw3ICs1MjAxLDYgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X2RtX2NvbW1pdF9wbGFuZXMo
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMg
PSBuZXdfcGxhbmVfc3RhdGUtPmNydGM7CiAJCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2Ny
dGNfc3RhdGU7CiAJCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbmV3X3BsYW5lX3N0YXRl
LT5mYjsKLQkJc3RydWN0IGFtZGdwdV9mcmFtZWJ1ZmZlciAqYWZiID0gdG9fYW1kZ3B1X2ZyYW1l
YnVmZmVyKGZiKTsKIAkJYm9vbCBwbGFuZV9uZWVkc19mbGlwOwogCQlzdHJ1Y3QgZGNfcGxhbmVf
c3RhdGUgKmRjX3BsYW5lOwogCQlzdHJ1Y3QgZG1fcGxhbmVfc3RhdGUgKmRtX25ld19wbGFuZV9z
dGF0ZSA9IHRvX2RtX3BsYW5lX3N0YXRlKG5ld19wbGFuZV9zdGF0ZSk7CkBAIC01MjAyLDMyICs1
MjI0LDExIEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9kbV9jb21taXRfcGxhbmVzKHN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCWJ1bmRsZS0+c3VyZmFjZV91cGRhdGVzW3BsYW5lc19j
b3VudF0uaW5fdHJhbnNmZXJfZnVuYyA9IGRjX3BsYW5lLT5pbl90cmFuc2Zlcl9mdW5jOwogCQl9
CiAKKwkJZmlsbF9kY19zY2FsaW5nX2luZm8obmV3X3BsYW5lX3N0YXRlLAorCQkJCSAgICAgJmJ1
bmRsZS0+c2NhbGluZ19pbmZvc1twbGFuZXNfY291bnRdKTsKIAotCQlidW5kbGUtPnNjYWxpbmdf
aW5mb3NbcGxhbmVzX2NvdW50XS5zY2FsaW5nX3F1YWxpdHkgPSBkY19wbGFuZS0+c2NhbGluZ19x
dWFsaXR5OwotCi0JCWZpbGxfcmVjdHNfZnJvbV9wbGFuZV9zdGF0ZShuZXdfcGxhbmVfc3RhdGUs
Ci0JCQkmYnVuZGxlLT5zY2FsaW5nX2luZm9zW3BsYW5lc19jb3VudF0uc3JjX3JlY3QsCi0JCQkm
YnVuZGxlLT5zY2FsaW5nX2luZm9zW3BsYW5lc19jb3VudF0uZHN0X3JlY3QsCi0JCQkmYnVuZGxl
LT5zY2FsaW5nX2luZm9zW3BsYW5lc19jb3VudF0uY2xpcF9yZWN0LAotCQkJJmJ1bmRsZS0+cGxh
bmVfaW5mb3NbcGxhbmVzX2NvdW50XS5yb3RhdGlvbik7Ci0KLQkJYnVuZGxlLT5zdXJmYWNlX3Vw
ZGF0ZXNbcGxhbmVzX2NvdW50XS5zY2FsaW5nX2luZm8gPSAmYnVuZGxlLT5zY2FsaW5nX2luZm9z
W3BsYW5lc19jb3VudF07Ci0KLQkJZmlsbF9wbGFuZV9jb2xvcl9hdHRyaWJ1dGVzKAotCQkJbmV3
X3BsYW5lX3N0YXRlLCBkY19wbGFuZSwKLQkJCSZidW5kbGUtPnBsYW5lX2luZm9zW3BsYW5lc19j
b3VudF0uY29sb3Jfc3BhY2UpOwotCi0JCWJ1bmRsZS0+cGxhbmVfaW5mb3NbcGxhbmVzX2NvdW50
XS5mb3JtYXQgPSBkY19wbGFuZS0+Zm9ybWF0OwotCQlidW5kbGUtPnBsYW5lX2luZm9zW3BsYW5l
c19jb3VudF0ucGxhbmVfc2l6ZSA9IGRjX3BsYW5lLT5wbGFuZV9zaXplOwotCQlidW5kbGUtPnBs
YW5lX2luZm9zW3BsYW5lc19jb3VudF0uaG9yaXpvbnRhbF9taXJyb3IgPSBkY19wbGFuZS0+aG9y
aXpvbnRhbF9taXJyb3I7Ci0JCWJ1bmRsZS0+cGxhbmVfaW5mb3NbcGxhbmVzX2NvdW50XS5zdGVy
ZW9fZm9ybWF0ID0gZGNfcGxhbmUtPnN0ZXJlb19mb3JtYXQ7Ci0JCWJ1bmRsZS0+cGxhbmVfaW5m
b3NbcGxhbmVzX2NvdW50XS50aWxpbmdfaW5mbyA9IGRjX3BsYW5lLT50aWxpbmdfaW5mbzsKLQkJ
YnVuZGxlLT5wbGFuZV9pbmZvc1twbGFuZXNfY291bnRdLnZpc2libGUgPSBkY19wbGFuZS0+dmlz
aWJsZTsKLQkJYnVuZGxlLT5wbGFuZV9pbmZvc1twbGFuZXNfY291bnRdLmdsb2JhbF9hbHBoYSA9
IGRjX3BsYW5lLT5nbG9iYWxfYWxwaGE7Ci0JCWJ1bmRsZS0+cGxhbmVfaW5mb3NbcGxhbmVzX2Nv
dW50XS5nbG9iYWxfYWxwaGFfdmFsdWUgPSBkY19wbGFuZS0+Z2xvYmFsX2FscGhhX3ZhbHVlOwot
CQlidW5kbGUtPnBsYW5lX2luZm9zW3BsYW5lc19jb3VudF0ucGVyX3BpeGVsX2FscGhhID0gZGNf
cGxhbmUtPnBlcl9waXhlbF9hbHBoYTsKLQkJYnVuZGxlLT5wbGFuZV9pbmZvc1twbGFuZXNfY291
bnRdLmRjYyA9IGRjX3BsYW5lLT5kY2M7Ci0JCWJ1bmRsZS0+c3VyZmFjZV91cGRhdGVzW3BsYW5l
c19jb3VudF0ucGxhbmVfaW5mbyA9ICZidW5kbGUtPnBsYW5lX2luZm9zW3BsYW5lc19jb3VudF07
CisJCWJ1bmRsZS0+c3VyZmFjZV91cGRhdGVzW3BsYW5lc19jb3VudF0uc2NhbGluZ19pbmZvID0K
KwkJCSZidW5kbGUtPnNjYWxpbmdfaW5mb3NbcGxhbmVzX2NvdW50XTsKIAogCQlwbGFuZV9uZWVk
c19mbGlwID0gb2xkX3BsYW5lX3N0YXRlLT5mYiAmJiBuZXdfcGxhbmVfc3RhdGUtPmZiOwogCkBA
IC01MjU5LDEyICs1MjYwLDEzIEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9kbV9jb21taXRfcGxhbmVz
KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKIAogCQlhbWRncHVfYm9fdW5yZXNlcnZl
KGFibyk7CiAKLQkJZmlsbF9wbGFuZV9idWZmZXJfYXR0cmlidXRlcyhkbS0+YWRldiwgYWZiLCBk
Y19wbGFuZSwKLQkJCSZidW5kbGUtPnBsYW5lX2luZm9zW3BsYW5lc19jb3VudF0udGlsaW5nX2lu
Zm8sCi0JCQkmYnVuZGxlLT5wbGFuZV9pbmZvc1twbGFuZXNfY291bnRdLnBsYW5lX3NpemUsCi0J
CQkmYnVuZGxlLT5wbGFuZV9pbmZvc1twbGFuZXNfY291bnRdLmRjYywKLQkJCSZidW5kbGUtPmZs
aXBfYWRkcnNbcGxhbmVzX2NvdW50XS5hZGRyZXNzLAotCQkJdGlsaW5nX2ZsYWdzKTsKKwkJZmls
bF9kY19wbGFuZV9pbmZvX2FuZF9hZGRyKAorCQkJZG0tPmFkZXYsIG5ld19wbGFuZV9zdGF0ZSwg
dGlsaW5nX2ZsYWdzLAorCQkJJmJ1bmRsZS0+cGxhbmVfaW5mb3NbcGxhbmVzX2NvdW50XSwKKwkJ
CSZidW5kbGUtPmZsaXBfYWRkcnNbcGxhbmVzX2NvdW50XS5hZGRyZXNzKTsKKworCQlidW5kbGUt
PnN1cmZhY2VfdXBkYXRlc1twbGFuZXNfY291bnRdLnBsYW5lX2luZm8gPQorCQkJJmJ1bmRsZS0+
cGxhbmVfaW5mb3NbcGxhbmVzX2NvdW50XTsKIAogCQlidW5kbGUtPmZsaXBfYWRkcnNbcGxhbmVz
X2NvdW50XS5mbGlwX2ltbWVkaWF0ZSA9CiAJCQkJKGNydGMtPnN0YXRlLT5wYWdlZmxpcF9mbGFn
cyAmIERSTV9NT0RFX1BBR0VfRkxJUF9BU1lOQykgIT0gMDsKQEAgLTYzMTAsNyArNjMxMiw3IEBA
IHN0YXRpYyBpbnQgZG1fdXBkYXRlX3BsYW5lX3N0YXRlKHN0cnVjdCBkYyAqZGMsCiAJCURSTV9E
RUJVR19EUklWRVIoIkVuYWJsaW5nIERSTSBwbGFuZTogJWQgb24gRFJNIGNydGMgJWRcbiIsCiAJ
CQkJcGxhbmUtPmJhc2UuaWQsIG5ld19wbGFuZV9jcnRjLT5iYXNlLmlkKTsKIAotCQlyZXQgPSBm
aWxsX3BsYW5lX2F0dHJpYnV0ZXMoCisJCXJldCA9IGZpbGxfZGNfcGxhbmVfYXR0cmlidXRlcygK
IAkJCW5ld19wbGFuZV9jcnRjLT5kZXYtPmRldl9wcml2YXRlLAogCQkJZGNfbmV3X3BsYW5lX3N0
YXRlLAogCQkJbmV3X3BsYW5lX3N0YXRlLAotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwphbWQtZ2Z4IG1haWxpbmcgbGlzdAphbWQtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2FtZC1nZng=
